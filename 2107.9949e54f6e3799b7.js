"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[2107],{64488:(L,p,n)=>{n.r(p),n.d(p,{ControlAccountDialog:()=>V,QuickAccoutViewModel:()=>E});var f=n(92014),d=n(6532),a=n(5349),T=n(1077),I=n(81322),i=n(9659),A=n(76962),m=n(21430),j=n(16856),u=n(66148),O=n(76199),g=n(70061),S=n(9503),_=n(75842),y=n(14848),G=n(35235),P=n(19439),M=n(90673),C=n(4884);class E extends O.g{get AccountID(){return this._AccountID}set AccountID(t){this._AccountID=t,this.obj.AccountID=t}FillAccountTypes(t,e,r){if(0==e&&(e=1),null!=t){let b=t.SelectedValue;if(t.Items.Clear(),this.IsControlAccounts){let l=[];1==this.ControlType?l=this.dtTypes.filter(s=>6==s.AccountTypeID||7==s.AccountTypeID):2==this.ControlType?(e=7,t.DefaultValue="7",l=this.dtTypes.filter(s=>7!=s.AccountTypeID)):3==this.ControlType&&(e=6,t.DefaultValue="6",l=this.dtTypes.filter(s=>6!=s.AccountTypeID)),l.forEach(s=>{this.dtTypes.Remove(s)})}this.dtTypes.forEach(l=>{let s=parseInt(l.AccountTypeID);(1==r||(4==e||8==e||11==e||5==e||9==e||12==e)&&(4==s||8==s||11==s||5==s||9==s||12==s)||(1==e||2==e||7==e||10==e||13==e||15==e||3==e||6==e||14==e||16==e)&&(1==s||2==s||7==s||10==s||13==s||15==e||3==s||6==s||14==s||16==e))&&t.Items.push(a._p.ComboBoxItems_2(l.ResourceData,l.AccountTypeID))}),t.SelectedValue=0!=e?e.toString():b}else this.iAccountType=e;this.OnAccountTypeSelectionChanged(null)}constructor(t,e,r,b,l,s){if(super(),this.ScreenObject=new f.ControlGenerator,this.DefaultValuation=1,this.AccountCode=null,this.AccountName=null,this.Status=null,this.ParentId=0,this.GParentID=0,this.Parent=null,this.obj={},this.Height="",this.AccountType=null,this.BillWise=null,this.Group=null,this._AccountID=0,this._Parent=0,this.RetValue=0,this.IsControlAccounts=!1,this.iAccountType=0,this.ControlType=0,this.ButtonSave=new I.v,this.lstEventCtrls=[],this.sAccType="",this.sBillWise="",i.d.SessionManager.Preferences.ContainsKey("IsControlAccounts")&&"TRUE"==i.d.SessionManager.Preferences.IsControlAccounts.toUpperCase()&&(this.IsControlAccounts=!0,0==s&&(s=1)),this.AccountID=t,this.obj.IsGroup=b,this.obj.AccountID=this.AccountID,this.ParentId=r,this.ControlType=s,this.ScreenObject.LoadQuickScreen(this,2,b),this.OnLoad(),this.dtTypes=this.ScreenObject.Data.Tables[4],s>0&&(2==s?l=7:3==s&&(l=6)),this.iAccountType=l,null!=this.AccountType&&(this.AccountType.SelectedValue=l.toString()),0==this.obj.AccountID&&(null!=this.Group&&(this.Group.SelectedValue=this.ParentId,this.Group.DefaultValue=this.Group.SelectedValue.toString()),0!=e&&(this.obj.SelectedNodeID=e)),this.FillAccountTypes(this.AccountType,l,0==r||1==r?1:-1),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>8&&this.ScreenObject.Data.Columns[8].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[8].length>0){this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[8],b);var h=this.ScreenObject.StaticFields.find(c=>26721==c.DBColumnID);if(h&&(h.Visible=!(!b||!this.ScreenObject.IsAutoCode)),null!=this.AccountName){let c=this.ScreenObject.Data.Tables[5].filter(D=>"CapsLock"==D.Name);c.length>0&&(0,A.yG0)(c[0].Value)&&(this.AccountName.IsAllCaps=!0),c=this.ScreenObject.Data.Tables[5].filter(D=>"CapsToFirstLetter"==D.Name),c.length>0&&(0,A.yG0)(c[0].Value)&&(this.AccountName.IsFirstLetterCaps=!0)}}if(0!=this.obj.AccountID?(this.LoadEditData(),null!=this.Group&&(this.Group.Enable=!1)):(null!=this.Group&&(this.Group.SelectedValue=this.ParentId),this.obj.GUID=""),this.DisplayName=this.ScreenName,this.obj.SelectedNodeID=e,this.AutoGenerateCode(),0==this.AccountID)this.LoadParentData();else if(this.ScreenObject.IsAutoCode&&this.ScreenObject.IsShowAutoManual){let c=!1;c=this.ScreenObject.IsParentAutoCode(this.obj.IsGroup,this.ParentId,this.ScreenObject.Data.Tables[8]),this.AccountCode.Enable=!c}if(this.Title=i.d.GetResource(b?0!=this.AccountID?"Account_EditGroup":"Account_AddGroup":0!=this.AccountID?"Account_EditAccount":"Account_AddAccount"),this.DisplayName=this.Title,i.d.SessionManager.IsActionAssigned(2,"DefaultInActive")){let c=this.ScreenObject.GetQuickCombo(242);null!=c&&(c.DefaultValue="34",0==this.AccountID&&(c.SelectedValue="34"))}let o;null!=this.AccountName&&this.lstEventCtrls.push(this.AccountName.DBColumnID),null!=this.AccountType&&this.lstEventCtrls.push(this.AccountType.DBColumnID),null!=this.Group&&this.lstEventCtrls.push(this.Group.DBColumnID);for(let c=0;c<this.ScreenObject.StaticFields.length;c++)o=this.ScreenObject.StaticFields[c],o&&null!=o.ToolTipFooterTitle&&null!=o.KeyTip&&!this.lstEventCtrls.Contains(o.DBColumnID)?this.SetControlEvent(o):this.AccountID>0&&o&&null!=o.ToolTipFooterTitle&&null!=o.KeyTip&&19==o.Mode&&this.OnGetExtFunctionData(o)}SetControlEvent(t){try{t instanceof d.Dw?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof a.y$?t.SelectionChangedCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof M.I||t instanceof d.L6?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof T.y$?t.OnPactListBoxValueChanged.Subscribe(this,"OnGetExtFunctionData"):(t instanceof C.Lc||t instanceof C.P6||t instanceof C.C_)&&t.SelectedDateChanged.Subscribe(this,"OnGetExtFunctionData"),this.AccountID>0&&19==t.Mode&&this.OnGetExtFunctionData(t)}catch{}}OnGetExtFunctionData(t){null!=t.ToolTipFooterTitle&&!u.J0.IsEmpty(t.KeyTip)&&"lostfocus"==t.KeyTip.toLowerCase()&&this.ScreenObject.ValidateExtData(t,null,!0)&&this.ScreenObject.GetExternalFuncData(t.Mode,this.AccountID,t.ToolTipFooterTitle,t.ToolTipFooterDescription,t.ToolTipDescription,null,null)}OnLoad(){if(this.ButtonSave=new I.v,0==this.AccountID?i.d.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=i.d.SessionManager.IsActionAssigned(2,"Create"):this.ButtonSave.Enable=i.d.SessionManager.IsActionAssigned(2,"Create"):(this.ScreenObject.IsEdit=!0,i.d.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=i.d.SessionManager.IsActionAssigned(2,"Update"):this.ButtonSave.Enable=i.d.SessionManager.IsActionAssigned(2,"Update")),this.QuickAssign=new g.d,this.QuickAssign.QuickAssignGrid_1(2,this.ScreenObject.Data,this.obj.IsGroup),this.AccountCode=this.ScreenObject.GetQuickCode(238),this.AccountName=this.ScreenObject.GetQuickText(239),null!=this.AccountName&&this.AccountName.LostFocusCommand.Subscribe(this,"OnNameLostFocus"),this.Status=this.ScreenObject.GetQuickCombo(242),null!=this.Status&&(this.ScreenObject.Data.Tables[3].forEach(t=>{this.Status.Items.push(a._p.ComboBoxItems_2(t.Status.toString(),t.StatusID.toString()))}),this.ScreenObject.Data.Tables[3].length>0&&(this.Status.SelectedValue=this.ScreenObject.Data.Tables[3][0].StatusID.toString())),this.AccountType=this.ScreenObject.GetQuickCombo(241),null!=this.AccountType&&(this.ScreenObject.Data.Tables[4].forEach(t=>{this.AccountType.Items.push(a._p.ComboBoxItems_2(t.ResourceData.toString(),t.AccountTypeID.toString()))}),this.AccountType.SelectionChangedCommand.Subscribe(this,"OnAccountTypeSelectionChanged"),this.ControlType>1&&(this.AccountType.Enable=!1),this.OnAccountTypeSelectionChanged(null)),this.Group=this.ScreenObject.GetQuickField(247),null!=this.Group){if(this.IsControlAccounts)this.SetControlWhere(this.Group,this.ControlType);else if(this.ScreenObject.Data.Tables[4].length<14){let t="";this.ScreenObject.Data.Tables[4].forEach(e=>{t.length>0&&(t+=","),t+=e[Object.keys(e)[0]].toString()}),this.Group.CustomWhere="(A.AccountID=1 or A.AccountTypeID IN ("+t+"))"}this.Group.SelectionChangedCommand.Subscribe(this,"OnGroupSelectionChanged")}this.oCombo=this.ScreenObject.GetQuickCombo(252),null!=this.oCombo&&(this.oCombo.Items.push(a._p.ComboBoxItems_2(i.d.GetResource("Com_Yes"),"1")),this.oCombo.Items.push(a._p.ComboBoxItems_2(i.d.GetResource("Com_No"),"0")),this.obj.IsBillwise=(0,A.yG0)(i.d.SessionManager.Preferences.On),this.oCombo.SelectedValue=this.obj.IsBillwise?"1":"0",this.BillWise=this.oCombo),this.oCombo=this.ScreenObject.GetQuickCombo(7082),null!=this.oCombo&&this.ScreenObject.Data.Tables[6].forEach(t=>{this.oCombo.Items.push(a._p.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString()))}),this.oCombo=this.ScreenObject.GetQuickCombo(50393),null!=this.oCombo&&(this.oCombo.Items.push(a._p.ComboBoxItems_2("","")),this.ScreenObject.Data.Tables[7].forEach(t=>{this.oCombo.Items.push(a._p.ComboBoxItems_2(t.ProfileName.toString(),t.ProfileID.toString()))})),this.oCombo=this.ScreenObject.GetQuickCombo(890),null!=this.oCombo&&(this.oCombo.Items.push(a._p.ComboBoxItems_2("Normal","0")),this.oCombo.Items.push(a._p.ComboBoxItems_2("Daily","1")),this.oCombo.Items.push(a._p.ComboBoxItems_2("Monthly","2"))),this.ScreenObject.StaticFields.forEach(t=>{if(2==this.ScreenObject.CostCenterID&&t instanceof d.L6&&("CreditDays"==t.DBColumnName||"DebitDays"==t.DBColumnName)){let e=t;e.Items.push(a._p.ComboBoxItems_2("Due Date","0")),e.Items.push(a._p.ComboBoxItems_2("First Day of Month","1")),e.Items.push(a._p.ComboBoxItems_2("Last Day of Month","2")),e.Items.push(a._p.ComboBoxItems_2("Last Day of Next Month","8")),e.Items.push(a._p.ComboBoxItems_2("BillingCycle","3")),e.Items.push(a._p.ComboBoxItems_2("Due date as First Day of Month","4")),e.Items.push(a._p.ComboBoxItems_2("Due date as Last Day of Month","5")),e.Items.push(a._p.ComboBoxItems_2("Doc date as First Day of Month","6")),e.Items.push(a._p.ComboBoxItems_2("Doc date as Last Day of Month","7")),e.SelectedValue=e.Items[0].Value}})}SetControlWhere(t,e){let r="";1==e?r="#COATEE#":2==e?r="#DEBTORTEE#":3==e&&(r="#CREDITORTEE#"),t.CustomWhere=u.J0.StringIsNullOrEmpty(t.CustomWhere)?r:"("+t.CustomWhere+") and "+r}AutoGenerateCode(){null!=this.AccountCode&&(this.obj.SelectedNodeID=null!=this.Group?this.Group.SelectedValue:this.ParentId,this.ScreenObject.SetAutoCode(this.AccountCode,this.obj.IsGroup,this.obj.SelectedNodeID,this.ScreenObject.Data.Tables[8]))}OnGroupSelectionChanged(t){this.Group.SelectedValue>0&&this.Group.SelectedValue.toString()!=this.Group.DefaultValue&&(this.Group.DefaultValue=this.Group.SelectedValue.toString(),this.FillAccountTypes(this.AccountType,i.d.accounting.GetAccountType(this.Group.SelectedValue),this.Group.SelectedValue),this.AutoGenerateCode(),this.LoadParentData())}OnAccountTypeSelectionChanged(t){null!=this.AccountType&&this.ScreenObject.SetViewByType(this.AccountType.SelectedValue,this.obj.IsGroup)}LoadEditData(){let t=i.d.accounting.GetAccountDetails(this.obj.AccountID);Object.assign(this.obj,t.obj),this.AccountID=this.obj.AccountID,this.QuickAssign.LoadGrid(this.obj.AccountID,t.Tables[12]),null!=this.AccountCode&&(this.AccountCode.Text=this.obj.AccountCode,(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.AccountCode.Enable=parseInt(t.Tables[0][0].Depth)<=1&&!this.ScreenObject.IsRootAutoCode)),this.ScreenObject.FillControls(t.Tables[0][0],t.Tables[1][0],t.Tables[5].length>0?t.Tables[5][0]:null,null,t.Tables[17],t.Tables[4]),this.ScreenObject.CanApprove(t.Tables[0][0],t.Tables[19][0],this.ButtonSave),t.Tables[5].length>0&&this.ScreenObject.LoadCustomFieldsCCData(t.Tables[5],t.Tables[17]),i.d.SessionManager.IsOffline&&this.AccountID>0&&(this.ButtonSave.Visible=!1),null!=this.ScreenObject.StatusAssignGrid&&this.ScreenObject.StatusAssignGrid.Load(t.Tables[18]),null!=this.Group&&(this.Group.SelectedValue=parseInt(t.Tables[0][0].ParentID),this.Group.DefaultValue=this.Group.SelectedValue.toString()),this.ParentId=parseInt(t.Tables[0][0].ParentID),this.ControlType>1&&((null!=this.AccountType&&2==this.ControlType&&"7"!=this.AccountType.SelectedValue||3==this.ControlType&&"6"!=this.AccountType.SelectedValue)&&(this.ButtonSave.Visible=!1),null!=this.AccountType&&(this.AccountType.Enable=!1)),this.sAccType=this.sBillWise="",null!=this.AccountType&&(this.ScreenObject.SetViewByType(this.AccountType.SelectedValue,this.obj.IsGroup),this.sAccType=this.AccountType.SelectedValue),null!=this.BillWise&&(this.sBillWise=this.BillWise.SelectedValue)}OnSaveAccount(t){if("Details"==t)i.d.page.ShowLoading=!0,setTimeout(()=>{i.d.page.HideDialog(this.PopUpGUID),null!=this.AccountType&&(this.iAccountType=parseInt(this.AccountType.SelectedValue));let e=new j.AddEditAccountViewModel(this.obj.AccountID,this.obj.SelectedNodeID,this.ParentId,this.iAccountType.toString(),this.obj.IsGroup,this.ControlType),r={obj:e};null!=this.AccountName&&(e.AccountName.Text=this.AccountName.Text),null!=this.AccountCode&&(e.AccountCode.Text=this.AccountCode.Text,e.AccountCode.PrefixCode=this.AccountCode.PrefixCode),e.OnGroupSelectionChanged("Group"),e.ScreenObject.CopyQuickToDetail(this.ScreenObject.StaticFields,[null!=this.AccountCode?this.AccountCode.DBColumnID:0,null!=this.AccountName?this.AccountName.DBColumnID:0]),e.OnGroupSelectionChanged("Type"),i.d.page.addNewTab({title:"Account Edit",component:m.AddEditAccountComponent,params:r})},50);else if("ApproveMaster"==t){let e=new G.i(2,this.AccountID,this.ScreenObject,this);i.d.page.ShowDialog(e,P.R,{ShowCenter:!0,Title:i.d.GetResource("ApproveReject")})}else try{this.SaveMethod(t)}catch(e){i.d.SessionManager.Logger.ErrorLog("QuickAddAccountScreenViewModel:: OnSaveAccount"+e.stack)}}SaveMethod(t){let e=0;if(this.DisplayMessage=this.ScreenObject.ValidateData(),!(this.DisplayMessage.length>0))if(null!=this.Group&&this.IsControlAccounts&&(0==this.Group.SelectedValue||1==this.Group.SelectedValue)&&(2==this.ControlType?(this.ParentId=parseInt(i.d.SessionManager.Preferences.DebtorsControlGroup),this.Group.SelectedValue=this.ParentId):3==this.ControlType&&(this.ParentId=parseInt(i.d.SessionManager.Preferences.CreditorsControlGroup),this.Group.SelectedValue=this.ParentId)),0==this.obj.AccountID){if(null!=this.AccountCode&&(this.obj.AccountCode=this.AccountCode.Text),null!=this.AccountName&&(this.obj.AccountName=this.AccountName.Text),this.obj.AliasName=this.ScreenObject.GetTextComboValue_string(240,this.obj.AccountName),this.obj.AccountTypeID=null==this.AccountType||u.J0.StringIsNullOrEmpty(this.AccountType.SelectedValue)?this.iAccountType:parseInt(this.AccountType.SelectedValue),this.obj.StatusID=i.d.SessionManager.IsActionAssigned(2,"DefaultInActive")?this.ScreenObject.GetTextComboValue_int(242,34):this.ScreenObject.GetTextComboValue_int(242,33),this.obj.CreditDays=this.ScreenObject.GetTextComboValue_int(248,0),this.obj.CreditLimit=this.ScreenObject.GetTextComboValue_double(249,0),this.obj.DebitDays=this.ScreenObject.GetTextComboValue_int(7081,0),this.obj.Debitlimit=this.ScreenObject.GetTextComboValue_double(7080,0),this.ScreenObject.StaticFields.forEach(s=>{s instanceof d.L6&&7081==s.DBColumnID?(""!=s.SelectedValue&&(this.obj.DebitDaysOpt=parseInt(s.SelectedValue)),s.Enable&&null!=s.Text&&""!=s.Text&&(this.obj.DebitDays=parseInt(s.Text))):s instanceof d.L6&&248==s.DBColumnID&&(""!=s.SelectedValue&&(this.obj.CreditDaysOpt=parseInt(s.SelectedValue)),s.Enable&&null!=s.Text&&""!=s.Text&&(this.obj.CreditDays=parseInt(s.Text)))}),!this.obj.IsGroup&&0==this.obj.AccountID&&(this.obj.IsBillwise=6==this.obj.AccountTypeID||7==this.obj.AccountTypeID,this.obj.SelectedNodeID=null!=this.Group?this.Group.SelectedValue:this.ParentId,null!=this.AccountType&&(this.AccountType.SelectedValue=this.obj.AccountTypeID.toString())),this.oCombo=this.ScreenObject.GetQuickCombo(252),null!=this.oCombo&&(this.obj.IsBillwise="1"==this.oCombo.SelectedValue),null!=this.AccountCode){let s={StrCode:this.obj.AccountCode,CodePrefix:this.obj.CodePrefix,CodeNumber:this.obj.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.AccountCode,this.obj.SelectedNodeID,this.ScreenObject.Data.Tables[8],s),this.obj.AccountCode=s.StrCode,this.obj.CodePrefix=s.CodePrefix,this.obj.CodeNumber=s.CodeNumber,this.DisplayMessage.length>0)return}if(!this.obj.IsGroup){e=0;let s=this.ScreenObject.Data.Tables[0].filter(h=>250==h.CostCenterColID);s.length>0&&!u.J0.StringIsNullOrEmpty(s[0].UserDefaultValue)&&(e=u.J0.Double(s[0].UserDefaultValue)),this.obj.PurchaseAccount=this.ScreenObject.GetPactListValue(250,e),e=0,s=this.ScreenObject.Data.Tables[0].filter(h=>251==h.CostCenterColID),s.length>0&&!u.J0.StringIsNullOrEmpty(s[0].UserDefaultValue)&&(e=u.J0.Double(s[0].UserDefaultValue)),this.obj.SalesAccount=this.ScreenObject.GetPactListValue(251,e),e=0,s=this.ScreenObject.Data.Tables[0].filter(h=>23845==h.CostCenterColID),s.length>0&&!u.J0.StringIsNullOrEmpty(s[0].UserDefaultValue)&&(e=u.J0.Double(s[0].UserDefaultValue)),this.obj.COGSAccount=this.ScreenObject.GetPactListValue(23845,e),e=0,s=this.ScreenObject.Data.Tables[0].filter(h=>23846==h.CostCenterColID),s.length>0&&!u.J0.StringIsNullOrEmpty(s[0].UserDefaultValue)&&(e=u.J0.Double(s[0].UserDefaultValue)),this.obj.ClosingStkAccount=this.ScreenObject.GetPactListValue(23846,e),this.obj.PDCReceivableAccount=this.ScreenObject.GetPactListValue(26581,0),this.obj.PDCPayableAccount=this.ScreenObject.GetPactListValue(26582,0),this.obj.PDCOnReplaceAccount=this.ScreenObject.GetPactListValue(16836,0),this.obj.PaymentTerms=this.ScreenObject.GetTextComboValue_int(50393,0),this.obj.LetterofCredit=this.ScreenObject.GetTextComboValue_double(53357,0),this.obj.TrustReceipt=this.ScreenObject.GetTextComboValue_double(53358,0),this.obj.TrustReceiptAccount=this.ScreenObject.GetPactListValue(53526,0),this.obj.MarginAccount=this.ScreenObject.GetPactListValue(53527,0),this.obj.Currency=this.ScreenObject.GetTextComboValue_int(7082,1)}this.obj.TB=0,this.obj.PL=0,this.obj.BS=0,this.obj.PLT=0,this.obj.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.obj.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.obj.HistoryXML=this.ScreenObject.HistoryCCXML,this.obj.StatusXML=null!=this.ScreenObject.StatusAssignGrid?this.ScreenObject.StatusAssignGrid.GetXML():"",this.obj.ContactsXML="",this.obj.NotesXML="",this.obj.AttachmetsXML=this.ScreenObject.GetExtraAttachmentXML(),this.obj.AddressXML="",this.obj.IsCode=!1;let b={};if(this.DisplayMessage=this.QuickAssign.GetXML(b),this.obj.CCMapXML=b.strXML,!u.J0.StringIsNullOrEmpty(this.DisplayMessage)||!this.ScreenObject.ValidateDataonSave())return;let l={Message:""};if(!this.obj.IsGroup&&!this.ScreenObject.ValidateGSTRules(this.obj.AccountTypeID,l))return this.DisplayMessage=l.Message,void(this.MessageVisibility=!0);var r=this.ScreenObject.StaticFields.find(s=>26721==s.DBColumnID);this.obj.GroupSeqNoLength=r&&this.obj.IsGroup?parseInt(r.Text):0,this.obj.WID=this.ScreenObject.CheckWorkFlow(),i.d.accounting.SaveAccount(this.obj,"SaveAccount").subscribe(s=>{this.SaveCallBack(s)},s=>{console.log("Quick Account Save : "+JSON.stringify(s))})}else{let b=this.ScreenObject.GetStaticFieldsQuery();if(null!=this.AccountType||null!=this.BillWise){let o=i.d.report.ReportDataSet("RPT022",!1,"Select COUNT(AccDocDetailsID) as AccCount From ACC_DocDetails WITH(NOLOCK) Where (DebitAccount="+this.obj.AccountID+" OR CreditAccount="+this.obj.AccountID+")\n                                 Select COUNT(DocNo) as AccCount From COM_BillWise WITH(NOLOCK) Where AccountID="+this.obj.AccountID);if(null!=this.AccountType&&this.AccountType.SelectedValue!=this.sAccType&&null!=o&&o.Tables.length>0&&o.Tables[0].length>0&&!u.J0.IsEmpty(o.Tables[0][0].AccCount)&&parseInt(o.Tables[0][0].AccCount.toString())>0&&!confirm("Accounting documents are Posted, changing of Account Type Field will effect in Financial Reports.\nDo you want to Proceed.?"))return;if(null!=this.BillWise&&this.BillWise.SelectedValue!=this.sBillWise&&null!=o&&o.Tables.length>0&&(o.Tables[0].length>0&&!u.J0.IsEmpty(o.Tables[0][0].AccCount)&&parseInt(o.Tables[0][0].AccCount.toString())>0||o.Tables[1].length>0&&!u.J0.IsEmpty(o.Tables[1][0].AccCount)&&parseInt(o.Tables[1][0].AccCount.toString())>0)){let c=new _.MessageDialogViewModel;return c.MessageDialogViewModel_5("Accounting documents are Posted, changing of Bill wise Field is not allowed.","Ok"),void i.d.page.ShowDialog(c,y.MessageDialogViewModelComponent,{ShowCenter:!0,Title:i.d.GetResource("Warning")})}}null!=this.AccountCode&&(this.obj.AccountCode=this.AccountCode.Text),null!=this.AccountName&&(this.obj.AccountName=this.AccountName.Text),this.obj.StaticFieldsQuery=b,this.obj.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.obj.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.obj.HistoryXML=this.ScreenObject.HistoryCCXML,this.obj.StatusXML=null!=this.ScreenObject.StatusAssignGrid?this.ScreenObject.StatusAssignGrid.GetXML():"";let l={};if(this.DisplayMessage=this.QuickAssign.GetXML(l),this.obj.CCMapXML=l.strXML,!u.J0.StringIsNullOrEmpty(this.DisplayMessage)||!this.ScreenObject.ValidateDataonSave())return;let s={Message:""};if(!this.obj.IsGroup&&!this.ScreenObject.ValidateGSTRules(this.obj.AccountTypeID,s))return this.DisplayMessage=s.Message,void(this.MessageVisibility=!0);this.obj.WID=this.ScreenObject.CheckWorkFlow(),i.d.accounting.SaveAccount(this.obj,"SaveAccountQuick").subscribe(h=>{this.SaveCallBack(h)},h=>{alert(JSON.stringify(h)),console.log("Quick Account Save : "+JSON.stringify(h))})}}SaveCallBack(t){t.Message&&(this.DisplayMessage=t.Message,this.RetValue=t.RetValue,(this.RetValue>0||this.RetValue<-1e4)&&(this.sAccType="",this.sBillWise="",this.AccountID=0,this.QuickAssign.Clear(),this.ScreenObject.Clear(),this.Title=i.d.GetResource(this.obj.IsGroup?"Account_AddGroup":"Account_AddAccount"),this.AccountCode&&(this.AccountCode.Text=""),this.Group&&(this.Group.SelectedValue=this.ParentId),this.AutoGenerateCode(),this.LoadParentData()),this.Parent&&(this.Parent.obj.SelectedNode&&(this.Parent.obj.SetFocusNodeID=this.Parent.obj.SelectedNode.Id),this.Parent.Refresh()))}OnNameLostFocus(t){if(!u.J0.StringIsNullOrEmpty(this.AccountName.Text)){let e=this.iAccountType;null!=this.AccountType&&(e=this.AccountType.Visible&&this.AccountType.Enable?parseInt(this.AccountType.SelectedValue):0==this.AccountID?parseInt(this.AccountType.DefaultValue):this.obj.AccountTypeID)}this.ScreenObject.onTextBoxLostFocus(t)}LoadParentData(){if(this.ScreenObject.dsParentData=null,0!=this.AccountID||0==this.ParentId||this.obj.IsGroup)return;let t=this.ScreenObject.Data.Tables[5].filter(e=>"Copygroupdatatonode"==e.Name);if(0!=t.length&&""!=t[0].Value.toString()&&(0,A.yG0)(t[0].Value)){if(this.ScreenObject.dsParentData=i.d.accounting.GetCopyAccountDetails(this.ParentId),0==this.ScreenObject.dsParentData.Tables[0].length)return void(this.ScreenObject.dsParentData=null);this.ScreenObject.FillParentData(this.ScreenObject.dsParentData.Tables[0][0],this.ScreenObject.dsParentData.Tables[1][0],this.ScreenObject.dsParentData.Tables[5][0],["AccountCode","AccountName","AccountGroup","IsGroup"]),this.IsControlAccounts&&(2==this.ControlType?this.AccountType.SelectedValue="7":3==this.ControlType&&(this.AccountType.SelectedValue="6"))}}}class V{constructor(){this.PopUpGUID="",this.IsCOA=!1,this.IsCustomer=!1,this.IsVendor=!1,this.ControlType=0,this.ControlAccounts=new S.Q,this.ControlAccounts.Items.push(new S.u("Chart of Account",1,"ctrlAccount")),this.ControlAccounts.Items.push(new S.u("Accounts Receivable",2,"ctrlAccount")),this.ControlAccounts.Items.push(new S.u("Accounts Payable",3,"ctrlAccount")),i.d.SessionManager.IsActionAssigned(2,"Read")||(this.ControlAccounts.Items[0].Visible=!1),i.d.SessionManager.IsActionAssigned(2,"Accounts Receivable")||(this.ControlAccounts.Items[1].Visible=!1),i.d.SessionManager.IsActionAssigned(2,"Accounts Payable")||(this.ControlAccounts.Items[2].Visible=!1),this.ControlAccounts.Items[0].Label="Chart of Account",this.ControlAccounts.Items[1].Label="Accounts Receivable",this.ControlAccounts.Items[2].Label="Accounts Payable";var t=this.ControlAccounts.Items.filter(e=>1==e.Visible);if(1==t.length&&(this.ControlType=t[0].FeatureID),i.d.SessionManager.PersonalSettings.ContainsKey("ControlAccountType")){let e=parseInt(i.d.SessionManager.PersonalSettings.ControlAccountType);e>0&&this.ControlAccounts.Items[e-1].Visible&&(this.ControlAccounts.Items[e-1].IsChecked=!0)}}OnButtonClick(t){"OK"==t?(this.ControlAccounts.Items[0].IsChecked?this.ControlType=1:this.ControlAccounts.Items[1].IsChecked?this.ControlType=2:this.ControlAccounts.Items[2].IsChecked&&(this.ControlType=3),this.ControlType>0&&u.J0.SetPersonalize("ControlAccountType",this.ControlType.toString()),i.d.page.HideDialog(this.PopUpGUID)):(this.ControlType=0,i.d.page.HideDialog(this.PopUpGUID))}}}}]);