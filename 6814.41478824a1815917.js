"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[6814],{56814:(le,x,Q)=>{Q.r(x),Q.d(x,{INV_ComparisonReport:()=>ie});var O=Q(74523),T=Q(32040),c=Q(43767),K=Q(76260),W=Q(7321),S=Q(61488),H=Q(89731),y=Q(26336),j=Q(98580),L=Q(27730),N=Q(84151),P=Q(21774),F=Q(11798),o=Q(96598),_=Q(43357),U=Q(67700),q=Q(96336);function X(A,e){if(1&A&&(o.j41(0,"div",7),o.EFF(1,"\n            "),o.eu8(2,8),o.EFF(3,"\n        "),o.k0s()),2&A){const s=o.XpG();o.R7$(2),o.Y8G("obj",s.obj.VendorsList)("group",s.form)}}function Y(A,e){if(1&A&&(o.j41(0,"div",7),o.EFF(1,"\n            "),o.eu8(2,8),o.EFF(3,"\n        "),o.k0s()),2&A){const s=o.XpG();o.R7$(2),o.Y8G("obj",s.obj.Quantity)("group",s.form)}}function $(A,e){if(1&A){const s=o.RV6();o.j41(0,"div",7),o.EFF(1,"       \n                  "),o.j41(2,"label",9),o.EFF(3,"Select Percentage"),o.k0s(),o.EFF(4,"\n            "),o.j41(5,"input",10),o.mxI("ngModelChange",function(a){o.eBV(s);const d=o.XpG();return o.DH7(d.obj.Percentage,a)||(d.obj.Percentage=a),o.Njj(a)}),o.k0s(),o.EFF(6," \n            "),o.k0s()}if(2&A){const s=o.XpG();o.R7$(5),o.R50("ngModel",s.obj.Percentage)}}function z(A,e){if(1&A&&(o.j41(0,"div",7),o.EFF(1,"        \n           "),o.j41(2,"label",9),o.EFF(3,"Rank"),o.k0s(),o.EFF(4,"     \n          "),o.j41(5,"label",9),o.EFF(6),o.k0s(),o.EFF(7,"\n          "),o.k0s()),2&A){const s=o.XpG();o.R7$(6),o.JRh(s.obj.PopShowLevel)}}function Z(A,e){if(1&A&&(o.j41(0,"div",7),o.EFF(1,"\n          "),o.eu8(2,8),o.EFF(3,"\n      "),o.k0s()),2&A){const s=o.XpG();o.R7$(2),o.Y8G("obj",s.obj.Remarks)("group",s.form)}}let G=(()=>{class A{constructor(){this.form=new F.gE({})}ngOnInit(){}static{this.\u0275fac=function(i){return new(i||A)}}static{this.\u0275cmp=o.VBU({type:A,selectors:[["app-comparetive-report-dialog"]],inputs:{obj:"obj"},standalone:!1,decls:31,vars:11,consts:[[1,"master-screen",2,"padding-bottom","4px","width","400px"],[1,"PACTHeaderFields","dialogSubBody"],["class","form-group row form-row col PACTControl",4,"ngIf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[1,"form-group","row","form-row","col","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"input_cntrl_label"],["type","text",3,"ngModelChange","ngModel"]],template:function(i,a){1&i&&(o.j41(0,"div",0),o.EFF(1,"\n    "),o.j41(2,"div",1),o.EFF(3,"\n        "),o.DNE(4,X,4,2,"div",2),o.EFF(5,"\n        "),o.DNE(6,Y,4,2,"div",2),o.EFF(7,"\n        "),o.DNE(8,$,7,1,"div",2),o.EFF(9,"  \n     \n          "),o.DNE(10,z,8,1,"div",2),o.EFF(11,"    \n       "),o.DNE(12,Z,4,2,"div",2),o.EFF(13,"\n    "),o.k0s(),o.EFF(14,"\n    "),o.j41(15,"div",3),o.EFF(16,"\n      "),o.j41(17,"div"),o.EFF(18,"\n        "),o.j41(19,"button",4),o.bIt("click",function(){return a.obj.OnButtonClick("OK")}),o.EFF(20),o.nI1(21,"translate"),o.k0s(),o.EFF(22,"\n        "),o.j41(23,"button",5),o.bIt("click",function(){return a.obj.OnButtonClick("Cancel")}),o.nrm(24,"i",6),o.EFF(25),o.nI1(26,"translate"),o.k0s(),o.EFF(27,"\n      "),o.k0s(),o.EFF(28,"\n  "),o.k0s(),o.EFF(29,"\n"),o.k0s(),o.EFF(30,"\n")),2&i&&(o.R7$(4),o.Y8G("ngIf",a.obj.VendorsList.Visible),o.R7$(2),o.Y8G("ngIf",a.obj.Quantity.Visible),o.R7$(2),o.Y8G("ngIf",a.obj.blnPercentage),o.R7$(2),o.Y8G("ngIf",a.obj.blnPopShowLevel),o.R7$(2),o.Y8G("ngIf",a.obj.Remarks.Visible),o.R7$(8),o.JRh(o.bMT(21,7,"Com_OK")),o.R7$(5),o.JRh(o.bMT(26,9,"Cancel")))},dependencies:[_.bT,U._,F.me,F.BC,F.vS,q.D9],encapsulation:2})}}return A})();var k=Q(61301),ee=Q(30786),B=Q(58170),te=Q(39026),se=Q(54581);class J{constructor(){this.DocSeqNo=0,this.InvID_QTN=0,this.InvID_MRN=0,this.UsedQty=0,this.ReqQty=0,this.Remarks="",this.Rank=""}}class ie extends K.A{get Grid(){return this.ViewModel.ComparisonGrid}set Grid(e){this.ViewModel.ComparisonGrid=e}constructor(e){super(e),this.i=0,this.k=0,this.ds=null,this.AttachReportWithPO=!1,this.ShowRevisedDocs=!1,this.AttachReportWithPOPrint=!1,this.CanApproveAll=!1,this.dvQuotations=null,this.dvQuotationsTable=null,this.EnquiryVoucher="",this.strLinkedInvDocDetailsIDs="",this.QuotationDocument=0,this.PurchaseOrderDocument=0,this.QuotationComparisonDocument=0,this.Userlevel=0,this.ccid=0,this.docid=0,this.WID=0,this.QtnIDs="",this.cntGroups=0,this.cntCols=0,this.cntHiddenCols=0,this.cntHiddenGroups=0,this.cntVisibleGroups=0,this.Quotations=new Array,this.QuotationDate=new Array,this.strQuotationNumericFields="",this.AllProductRows=new Array,this.TagID=0,this.IsAvgRate=0,this.fldDict=new y.bT,this.EnableGroupWise=!1,this.ComparisonDocID=0,this.ComparisonQtyField="",this.ComparisonStatusField="",this.linkedRankColumnID="",this.ComparisonRemarksField="",this.ComparisonRankField="",this.QtnCols=new Array,this.rankColumnIndex=0,this.isConfirm_Web="No",this.lstParents=[],this.lstLinkCount=0,this.oDocument=null}NewReportRow(){let e=new S.Ji(this.ViewModel.ReportColumns.length,this.ViewModel.RowHeight);return e.Type=S.QS.Detail,e}LoadReport(){if(this.EnquiryVoucher=this.ViewModel.Preferences.EnquiryNo,this.QuotationDocument=parseInt(this.ViewModel.Preferences.QuotationDocument),!this.ViewModel.ButtonAction.Visible&&"DONE"!=this.ViewModel.ButtonAction.SysColumnName){this.ViewModel.ButtonAction.SysColumnName="DONE";let e=T.d.report.ReportDataTable("RPT022",this.ViewModel.IsReportDB,"select PrefValue from com_documentpreferences with(nolock) where CostCenterID="+this.QuotationDocument+" and PrefName='ApprOnComparitiveAnalysis' and PrefValue='True'");e.length>0&&c.J0.hasprop(e[0],"PrefValue")&&(this.ViewModel.ButtonAction.AccDimInUse=!0)}if(this.ViewModel.DocumentFiltersIDs.ContainsKey("23148")&&(this.strLinkedInvDocDetailsIDs=this.ViewModel.DocumentFiltersIDs[23148]),this.ViewModel.Preferences.ContainsKey("PurchaseOrderDocument")&&this.ViewModel.Preferences.PurchaseOrderDocument.length>0&&(this.PurchaseOrderDocument=parseInt(this.ViewModel.Preferences.PurchaseOrderDocument)),this.ViewModel.Preferences.ContainsKey("QuotationComparisonDocument")&&this.ViewModel.Preferences.QuotationComparisonDocument.length>0&&(this.QuotationComparisonDocument=parseInt(this.ViewModel.Preferences.QuotationComparisonDocument),this.ComparisonQtyField=this.ViewModel.Preferences.ContainsKey("QTNComp_Qty")?this.ViewModel.Preferences.QTNComp_Qty:"",this.ComparisonStatusField=this.ViewModel.Preferences.ContainsKey("QTNComp_Status")?this.ViewModel.Preferences.QTNComp_Status:"",this.ComparisonRemarksField=this.ViewModel.Preferences.ContainsKey("QTNComp_Remarks")?this.ViewModel.Preferences.QTNComp_Remarks:"",this.ComparisonRankField=this.ViewModel.Preferences.ContainsKey("QTNComp_Rank")?this.ViewModel.Preferences.QTNComp_Rank:""),this.ViewModel.Preferences.ContainsKey("QuotationNumericFields")&&this.ViewModel.Preferences.QuotationNumericFields.length>0)this.strQuotationNumericFields=this.ViewModel.Preferences.QuotationNumericFields,this.NumericFields=this.ViewModel.Preferences.QuotationNumericFields.split(","),this.NumericFieldsBold=new Array(this.NumericFields.length).fill(!1),this.NumericFieldsIgnoreTotal=new Array(this.NumericFields.length).fill(!1);else if(this.ViewModel.Preferences.ContainsKey("QuotationNumericFieldsXML")&&this.ViewModel.Preferences.QuotationNumericFieldsXML.length>0){let e=new c.VB;e.LoadXml("<xml>"+this.ViewModel.Preferences.QuotationNumericFieldsXML+"</xml>"),this.NumericFields=new Array(e.DocumentElement.children.length),this.NumericFieldsBold=new Array(this.NumericFields.length).fill(!1),this.NumericFieldsIgnoreTotal=new Array(this.NumericFields.length).fill(!1);let s=0;for(let i=0;i<e.DocumentElement.children.length;i++){let a=e.DocumentElement.children[i];this.NumericFields[s]=a.attributes.ID.value,this.strQuotationNumericFields.length>0&&(this.strQuotationNumericFields+=","),this.strQuotationNumericFields+=a.attributes.ID.value,null!=a.attributes.Bold&&"1"==a.attributes.Bold.value&&(this.NumericFieldsBold[s]=!0),null!=a.attributes.IgnoreAtTotal&&"1"==a.attributes.IgnoreAtTotal.value&&(this.NumericFieldsIgnoreTotal[s]=!0),s++}}else this.NumericFields=[];this.TextFields=this.ViewModel.Preferences.QuotationTextFields.length>0?this.ViewModel.Preferences.QuotationTextFields.split(","):[],this.IsAvgRate=this.ViewModel.ColumnSource.filter(e=>"AvgRate"==e.ID).length,T.d.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(this.TagID=c.J0.Int(T.d.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==this.TagID&&"true"==c.J0.StringValue(T.d.SessionManager.Preferences.EnableLocationWise).toLowerCase()&&("True"==T.d.SessionManager.Preferences["LW Reports"]||"True"==T.d.SessionManager.Preferences.ShowLocationFilterInReport)&&(this.TagID=50002),this.AttachReportWithPO=!(!this.ViewModel.Preferences.ContainsKey("AttachReportWithPO")||"1"!=this.ViewModel.Preferences.AttachReportWithPO),this.AttachReportWithPOPrint=!(!this.ViewModel.Preferences.ContainsKey("AttachReportWithPOPrint")||"1"!=this.ViewModel.Preferences.AttachReportWithPOPrint),this.RateKPIColumn=this.ViewModel.Preferences.ContainsKey("RateKPIColumn")?this.ViewModel.Preferences.RateKPIColumn:"",this.RateKPIColumnColor=this.ViewModel.Preferences.ContainsKey("RateKPIColumnColor")?this.ViewModel.Preferences.RateKPIColumnColor:"Green",this.ExecutedClr=this.ViewModel.Preferences.ContainsKey("ExecutedClr")?this.ViewModel.Preferences.ExecutedClr:"#FFC4BFC0",this.PartialExecutedClr=this.ViewModel.Preferences.ContainsKey("PartialExecutedClr")?this.ViewModel.Preferences.PartialExecutedClr:"#FFE6E6FA",this.FullSelectedClr=this.ViewModel.Preferences.ContainsKey("FullSelectedClr")?this.ViewModel.Preferences.FullSelectedClr:"",this.PartialSelectedClr=this.ViewModel.Preferences.ContainsKey("PartialSelectedClr")?this.ViewModel.Preferences.PartialSelectedClr:"",this.GrandTotalColumnID=this.ViewModel.Preferences.ContainsKey("GrandTotalColumn")?this.ViewModel.Preferences.GrandTotalColumn:"",this.ShowRevisedDocs=!(!this.ViewModel.Preferences.ContainsKey("ShowRevisedDocs")||"1"!=this.ViewModel.Preferences.ShowRevisedDocs),this.ViewModel.Preferences.ContainsKey("HideRegenerate")&&(this.ViewModel.RegenerateVisibility=!1),this.ViewModel.lstGroup.length>0&&(this.EnableGroupWise=!0),this.LoadDataSet().then(()=>{if(null==this.ds)return;this.Quotations.Clear(),this.QuotationDate.Clear(),this.ds.Tables.length>1&&this.ds.Tables[1].forEach(t=>{this.Quotations.Contains(c.J0.StringValue(t.VoucherNo))||(this.Quotations.push(c.J0.StringValue(t.VoucherNo)),this.QuotationDate.push(c.J0.ParseDate(t.DocDate).ToString(T.d.SessionManager.Preferences["Date Format"])))}),this.cntCols=0,this.cntGroups=0,this.cntHiddenCols=0,this.cntHiddenGroups=0,this.QtnCols.Clear();let s,e=new Array;for(let t=0;t<this.ViewModel.ColumnSource.length;t++)t>=this.ViewModel.RepeatStartIndex&&t<=this.ViewModel.RepeatStartIndex+this.ViewModel.RepeatNextCols?(this.cntCols++,this.QtnCols.push(this.ViewModel.ColumnSource[t]),this.ViewModel.ColumnSource[t].HeaderAppearance.IsVisible||this.cntHiddenCols++):(this.cntGroups++,e.push(this.ViewModel.ColumnSource[t].Clone()),this.ViewModel.ColumnSource[t].HeaderAppearance.IsVisible||this.cntHiddenGroups++);this.cntVisibleGroups=this.cntGroups-this.cntHiddenGroups;for(let t=0;t<this.Quotations.length;t++)for(let R=0;R<this.QtnCols.length;R++)e.push(this.QtnCols[R].Clone()),e[e.length-1].MatixRepeatID=t.toString();this.ViewModel.ConstructFormulaFields(!1),this.eval=new H.CC,this.eval.ThrowException=!1,this.eval.SetKeyWords("REPORT"),this.QtnCols.forEach(t=>{this.fldDict.ContainsKey(t.ID)||(s=new H.Nl,s.setFieldDetails(t.ID,3,1,"",0,!1,!1),this.fldDict.push(t.ID,s))});let a=this.NewReportRow_3(S.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance,e.length),d=this.ShowRevisedDocs?this.NewReportRow_3(S.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance,e.length):null,C=this.NewReportRow_3(S.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance,e.length),n=this.NewReportRow_3(S.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance,e.length),h=this.ViewModel.Preferences.ContainsKey("ShowStatus")?this.NewReportRow_3(S.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance,e.length):null,D=this.ViewModel.Preferences.ContainsKey("ShowApprovalRemarks")?this.NewReportRow_3(S.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance,e.length):null;for(let t=0;t<this.Quotations.length;t++)this.dvQuotations=this.dvQuotationsTable.filter(R=>R.VoucherNo==this.Quotations[t]),this.dvQuotations.length>0&&(a.Cells[this.cntGroups+t*this.cntCols].Text=this.dvQuotations[0].CreditAccountName.toString(),this.ViewModel.ButtonPost.Visible&&(a.Cells[this.cntGroups+t*this.cntCols].CellAppearance.ColumnType="LINK_VENDOR"),null!=h&&(h.Cells[this.cntGroups+t*this.cntCols].Text="Posted"==c.J0.String(this.dvQuotations[0].QTNStatus)?T.d.GetResource("Reports_LblPosted"):"Un Approved"==c.J0.String(this.dvQuotations[0].QTNStatus)?T.d.GetResource("Reports_LblUnApproved"):"Approved"==c.J0.String(this.dvQuotations[0].QTNStatus)?T.d.GetResource("Reports_LblApproved"):"Rejected"==c.J0.String(this.dvQuotations[0].QTNStatus)?T.d.GetResource("Reports_LblRjected"):c.J0.String(this.dvQuotations[0].QTNStatus),h.Cells[this.cntGroups+t*this.cntCols].Value=this.dvQuotations[0].DocID,h.Cells[this.cntGroups+t*this.cntCols].CellAppearance.Alignment="Left",h.Cells[this.cntGroups+t*this.cntCols].ColSpan=this.cntCols-this.cntHiddenCols,h.Cells[this.cntGroups+t*this.cntCols].CellAppearance.IsBold=!1,h.Cells[this.cntGroups+t*this.cntCols].CellAppearance.ColumnType="LINK_STATUS",h.Cells[this.cntGroups+t*this.cntCols].Text.startsWith("Rejected")&&(h.Cells[this.cntGroups+t*this.cntCols].CellAppearance.ForeColor="Red")),null!=D&&(D.Cells[this.cntGroups+t*this.cntCols].Text=c.J0.StringValue(this.dvQuotations[0].QTNApprovalRemarks),D.Cells[this.cntGroups+t*this.cntCols].CellAppearance.Alignment="Left",D.Cells[this.cntGroups+t*this.cntCols].ColSpan=this.cntCols-this.cntHiddenCols,D.Cells[this.cntGroups+t*this.cntCols].CellAppearance.IsBold=!1),null!=d&&(d.Cells[this.cntGroups+t*this.cntCols].Text="R"+this.dvQuotations[0].VersionNo.ToString(),d.Cells[this.cntGroups+t*this.cntCols].CellAppearance.Alignment="Left",d.Cells[this.cntGroups+t*this.cntCols].ColSpan=this.cntCols-this.cntHiddenCols,d.Cells[this.cntGroups+t*this.cntCols].CellAppearance.IsBold=!0)),a.Cells[this.cntGroups+t*this.cntCols].CellAppearance.Alignment="Left",a.Cells[this.cntGroups+t*this.cntCols].ColSpan=this.cntCols-this.cntHiddenCols,a.Cells[this.cntGroups+t*this.cntCols].CellAppearance.IsBold=!1,C.Cells[this.cntGroups+t*this.cntCols].Text=this.QuotationDate[t],C.Cells[this.cntGroups+t*this.cntCols].CellAppearance.Alignment="Left",C.Cells[this.cntGroups+t*this.cntCols].ColSpan=this.cntCols-this.cntHiddenCols,C.Cells[this.cntGroups+t*this.cntCols].CellAppearance.IsBold=!1,n.Cells[this.cntGroups+t*this.cntCols].Text=this.Quotations[t],n.Cells[this.cntGroups+t*this.cntCols].CellAppearance.Alignment="Left",n.Cells[this.cntGroups+t*this.cntCols].CellAppearance.ColumnType="LINK_DOCUMENT",n.Cells[this.cntGroups+t*this.cntCols].ColSpan=this.cntCols-this.cntHiddenCols,n.Cells[this.cntGroups+t*this.cntCols].CellAppearance.IsBold=!1;let u=this.cntGroups-this.cntHiddenGroups>3?2:1;a.Cells[u].Text=T.d.GetResource("Reports_LblNameofthesupplier"),C.Cells[u].Text=T.d.GetResource("Reports_LblDocDate"),n.Cells[u].Text=T.d.GetResource("Reports_LblDocNo"),this.cntGroups-this.cntHiddenGroups>3?(a.Cells[2].ColSpan=C.Cells[2].ColSpan=n.Cells[2].ColSpan=this.cntGroups-(2+this.cntHiddenGroups),a.Cells[2].CellAppearance.Alignment=C.Cells[2].CellAppearance.Alignment=n.Cells[2].CellAppearance.Alignment="Left",this.ds.Tables[0].length>0&&(C.Cells[0].Text=c.J0.ParseDate(this.ds.Tables[0][0].DocDate).ToString(T.d.SessionManager.Preferences["Date Format"]),C.Cells[0].CellAppearance.IsBold=!1,n.Cells[0].Text=c.J0.StringValue(this.ds.Tables[0][0].VoucherNo),n.Cells[0].CellAppearance.ColumnType="LINK_DOCUMENT",n.Cells[0].CellAppearance.IsBold=!1),a.Cells[0].ColSpan=C.Cells[0].ColSpan=n.Cells[0].ColSpan=2,null!=h&&(h.Cells[0].ColSpan=2),null!=D&&(D.Cells[0].ColSpan=2),null!=d&&(d.Cells[0].ColSpan=2)):(a.Cells[1].ColSpan=C.Cells[1].ColSpan=n.Cells[1].ColSpan=this.cntGroups-(1+this.cntHiddenGroups),a.Cells[1].CellAppearance.Alignment=C.Cells[1].CellAppearance.Alignment=n.Cells[1].CellAppearance.Alignment="Left",null!=h&&(h.Cells[1].ColSpan=this.cntGroups-(1+this.cntHiddenGroups),h.Cells[1].CellAppearance.Alignment="Left"),null!=D&&(D.Cells[1].ColSpan=this.cntGroups-(1+this.cntHiddenGroups),D.Cells[1].CellAppearance.Alignment="Left"),null!=d&&(d.Cells[1].ColSpan=this.cntGroups-(1+this.cntHiddenGroups),d.Cells[1].CellAppearance.Alignment="Center"),C.Cells[0].Text=c.J0.ParseDate(this.ds.Tables[0][0].DocDate).ToString(T.d.SessionManager.Preferences["Date Format"]),C.Cells[0].CellAppearance.IsBold=!1,n.Cells[0].Text=c.J0.StringValue(this.ds.Tables[0][0].VoucherNo),n.Cells[0].CellAppearance.IsBold=!1),null!=h&&(h.Cells[u].Text=T.d.GetResource("Reports_LblDocStatus"),h.Cells[u].ColSpan=n.Cells[u].ColSpan,h.Cells[u].CellAppearance.Alignment="Left"),null!=D&&(D.Cells[u].Text="Approval Remarks",D.Cells[u].ColSpan=n.Cells[u].ColSpan,D.Cells[u].CellAppearance.Alignment="Left"),null!=d&&(d.Cells[u].Text="Revisions",d.Cells[u].ColSpan=n.Cells[u].ColSpan,d.Cells[u].CellAppearance.Alignment="Left"),this.oHeadiQtyRate=new S.Ji(e.length,this.ViewModel.RowHeight+2),this.oHeadiQtyRate.Type=S.QS.Header;for(let t=0;t<e.length;t++)this.oHeadiQtyRate.Cells[t].Text=e[t].HeaderText,this.oHeadiQtyRate.Cells[t].CellAppearance=e[t].HeaderAppearance,this.oHeadiQtyRate.Cells[t].IsNormal=!1;for(let t=0;t<e.length;t++)e[t].HeaderText="";this.oColumns=e,this.ViewModel.ReportColumns=e,this.ViewModel.colSNoIndex=this.ViewModel.ReportColumns.indexOf(this.ViewModel.ReportColumns.find(t=>0==c.J0.stringCompare(t.Formula,"SNO",!0))),this.ViewModel.IsTotalColsAdded=!0,this.ViewModel.totals=c.J0.NumArray(this.oColumns.length,this.ViewModel.lstGroup.length+1),(!this.ViewModel.Preferences.ContainsKey("HideSupplier")||"0"==this.ViewModel.Preferences.HideSupplier)&&this.ViewModel.addRow(a),null!=d&&this.ShowRevisedDocs&&this.ViewModel.addRow(d),this.ViewModel.addRow(C),null!=h&&this.ViewModel.addRow(h),null!=D&&this.ViewModel.addRow(D),this.ViewModel.addRow(n),this.ViewModel.addRow(this.oHeadiQtyRate),this.AddRows(),this.EnableGroupWise&&this.ds.Tables.length>0&&this.ViewModel.CheckAndAddSubTotals(this.ds.Tables[0]),this.EnableGroupWise?this.AddReportTotals(this.ViewModel.GrpReportTotal,0):this.ViewModel.AddSubtotals_RT(this.ViewModel.GrpReportTotal,0),(!this.ViewModel.Preferences.ContainsKey("HideBasicTotal")||"0"==this.ViewModel.Preferences.HideBasicTotal)&&this.ViewModel.addRow(this.oBasicValueRow);for(let t=0;t<this.NumericRows.length;t++)this.ViewModel.addRow(this.NumericRows[t]);(!this.ViewModel.Preferences.ContainsKey("HideGrandTotal")||"0"==this.ViewModel.Preferences.HideGrandTotal)&&this.ViewModel.addRow(this.oTotalRow);for(let t=0;t<this.TextRows.length;t++)this.ViewModel.addRow(this.TextRows[t]);if(this.ViewModel.Preferences.ContainsKey("ShowPTProfile")&&"1"==this.ViewModel.Preferences.ShowPTProfile){this.oRow=this.NewReportRow(),this.oRow.Cells[0].Text="Payment Terms",this.oRow.Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups,this.oRow.Cells[0].IsNormal=!1,this.oRow.Cells[0].CellAppearance=this.ViewModel.GrpReportTotal.SubTotalAppearance_Data.Clone(),this.oRow.Cells[0].CellAppearance.Alignment="Left";for(let t=0;t<this.Quotations.length;t++){let R=this.oRow.Cells[this.cntGroups+t*this.cntCols];R.IsNormal=!1,R.ColSpan=this.cntCols-this.cntHiddenCols,R.CellAppearance=this.ViewModel.ReportColumns[1+t*this.cntCols].DataAppearance.Clone(),R.CellAppearance.Alignment="Left",this.dvQuotations=this.dvQuotationsTable.filter(m=>m.VoucherNo==this.Quotations[t]),this.dvQuotations.length>0&&(R.Text=c.J0.String(this.dvQuotations[0].PayTermProfile),R.Text.length>0&&(R.Value=this.Quotations[t],R.CellAppearance.ColumnType="LINK_PAYTERM"))}this.ViewModel.addRow(this.oRow)}if(this.ViewModel.Preferences.ContainsKey("ShowAttachments")){this.oRow=this.NewReportRow(),this.oRow.Cells[0].Text=T.d.GetResource("Reports_LblAttachments"),this.oRow.Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups,this.oRow.Cells[0].IsNormal=!1,this.oRow.Cells[0].CellAppearance=this.ViewModel.GrpReportTotal.SubTotalAppearance_Data.Clone(),this.oRow.Cells[0].CellAppearance.Alignment="Left";for(let t=0;t<this.Quotations.length;t++){let R=this.oRow.Cells[this.cntGroups+t*this.cntCols];R.IsNormal=!1,R.ColSpan=this.cntCols-this.cntHiddenCols,this.dvQuotations=this.dvQuotationsTable.filter(m=>m.VoucherNo==this.Quotations[t]),this.dvQuotations.length>0&&(R.Text=c.J0.String(this.dvQuotations[0].QTNAttachments),R.Value=c.J0.String(this.dvQuotations[0].QTNAttachments_ID)),R.CellAppearance=this.ViewModel.ReportColumns[1+t*this.cntCols].DataAppearance.Clone(),R.CellAppearance.Alignment="Left",R.CellAppearance.ColumnType="LINK_ATTACHMENT"}this.ViewModel.addRow(this.oRow)}this.QuotationComparisonDocument>4e4&&this.InitGrid()}).then(()=>{this.ViewModel.process_RunWorkerCompleted()})}LoadDataSet(){let e=this.strQuotationNumericFields;this.ViewModel.Preferences.QuotationTextFields.length>0&&(e.length>0&&(e+=","),e+=this.ViewModel.Preferences.QuotationTextFields),e="'"+e.Replace(",","','")+"'",this.ViewModel.FromTag.Contains("DCC.")&&(this.ViewModel.FromTag=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "+this.ViewModel.FromTag);let s,i,a=this.ViewModel.SelectTag,d=this.ViewModel.FromTag,C=new Array;var n=this.ViewModel.BaseReportColumns.find(f=>!c.J0.IsEmpty(f.RepeatType.SelectedValue)&&parseInt(f.RepeatType.SelectedValue)>0);let h=this.ViewModel.BaseReportColumns.indexOf(n);if(-1!=h)for(let f=h;f<=h+this.ViewModel.RepeatNextCols;f++)C.push(this.ViewModel.BaseReportColumns[f]);this.ViewModel.Entities.Clear(),this.ViewModel.Entities.push("Documents","D"),this.ViewModel.SetQuery(C,!0),this.ViewModel.FromTag.Contains("DCC.")&&(this.ViewModel.FromTag=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID "+this.ViewModel.FromTag),s=this.ViewModel.SelectTag,i=this.ViewModel.FromTag,this.ViewModel.Preferences.ContainsKey("ShowPTProfile")&&"1"==this.ViewModel.Preferences.ShowPTProfile&&(s+=",(SELECT top 1 PD.ProfileName PaymentTerm_ProfileName FROM COM_DocPayTerms P with(nolock) \nleft join Acc_PaymentDiscountProfile PD with(nolock) on P.ProfileID=PD.ProfileID WHERE VoucherNo=D.VoucherNo) PayTermProfile"),this.ViewModel.Preferences.ContainsKey("ShowAttachments")&&(s+=",stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID=D.CostCenterID AND FeaturePK=D.DocID FOR XML PATH('')),1,1,'') QTNAttachments_ID,stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID=D.CostCenterID AND FeaturePK=D.DocID FOR XML PATH('')),1,2,'') QTNAttachments"),this.ViewModel.Preferences.ContainsKey("ShowStatus")&&(s+=",S.Status+case when W.LevelName is null then '' else ' ('+W.LevelName+')' end QTNStatus",i+=" left join COM_Status S with(nolock) on S.StatusID=D.StatusID",i+=" left join COM_WorkFlow W with(nolock) on W.WorkFlowID=D.WorkFlowID and W.LevelID=D.WorkFlowLevel"),this.ViewModel.Preferences.ContainsKey("ShowApprovalRemarks")&&(s+=",(select Remarks from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and ccid=D.costcenterid and ccnodeid=D.DocID AND (DocDetID=0 OR DocDetID=D.InvDocDetailsID) order by ApprovalID desc)) QTNApprovalRemarks"),this.ViewModel.Preferences.ContainsKey("QTNSelect")&&(s+=this.ViewModel.Preferences.QTNSelect),this.ViewModel.Preferences.ContainsKey("QTNJoin")&&(!i.Contains("COM_DocCCData")&&this.ViewModel.Preferences.QTNJoin.Contains("dcCCNID")&&(i+=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=D.InvDocDetailsID"),i+=this.ViewModel.Preferences.QTNJoin),s=s.Replace("@CCWHERE@","");let D="";this.TagID>5e4&&T.d.SessionManager.LocationID>0&&(D=" AND DCC.DCCCNID"+(this.TagID-5e4).toString()+" IN ("+T.d.SessionManager.LocationID+")");let u=this.GetDimensionFilter("DCC.dcCCNID");var t=this.ViewModel.oReportDialog.CostCenterFilters.find(f=>3==f.CostCenterID);if(t&&null!=t.SelectedNodes&&t.SelectedNodes.length>0)if(1==t.SelectedNodes.length)u+=" AND D.ProductID="+t.SelectedNodes[0].Id;else{u+=" AND D.ProductID IN (";for(let f=0;f<t.SelectedNodes.length;f++)f>0&&(u+=","),u+=t.SelectedNodes[f].Id;u+=")"}let R,m="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(m=c.J0.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN (-1)":" AND dcCCNID"+(this.ViewModel.oReportDialog.Locations.DBColumnID-5e4)+" IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),R=a.Replace("@CCWHERE@",m.length>0?" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON A.InvDocDetailsID=DCC.InvDocDetailsID "+m:"");let p=[];return p.push(this.EnquiryVoucher),p.push(R),p.push(d),p.push(u),p.push(this.QuotationDocument),p.push(this.QuotationComparisonDocument),p.push(this.PurchaseOrderDocument),p.push(s),p.push(i),this.ComparisonQtyField.startsWith("dcNum")?p.push(",N."+this.ComparisonQtyField+" SelectedQty"):p.push(0==this.ComparisonQtyField.length?"":",D."+this.ComparisonQtyField+" SelectedQty"),this.ComparisonStatusField.startsWith("dcAlpha")?p.push("TXT."+this.ComparisonStatusField):p.push(""),this.ComparisonRemarksField.startsWith("dcAlpha")?p.push("TXT."+this.ComparisonStatusField):p.push(""),this.ComparisonRankField.startsWith("dcAlpha")?p.push("TXT."+this.ComparisonRankField):p.push(""),p.push(e),p.push(this.IsAvgRate),p.push(D),p.push(this.strLinkedInvDocDetailsIDs),p.push(this.ViewModel.Preferences.ContainsKey("ShowQtnAddOns")),p.push(this.ShowRevisedDocs),p.push(T.d.SessionManager.LanguageID),T.d.report.GetComperativeStmt(p,this.ViewModel.IsReportDB).then(f=>{if(this.ds=f,this.ds.Columns.length>0&&(this.ds.Columns[0].push("ProductCode_ID"),this.ds.Columns[0].push("ProductName_ID")),this.dvQuotations=this.dvQuotationsTable=this.ds.Tables[1],this.ViewModel.Preferences.ContainsKey("ShowLinkedPrds")&&"1"==this.ViewModel.Preferences.ShowLinkedPrds)for(let M=this.ds.Tables[0].length-1;M>=0;M--)0==this.ds.Tables[1].filter(v=>v.LinkedInvDocDetailsID==parseInt(this.ds.Tables[0][M].InvDocDetailsID)).length&&this.ds.Tables[0].RemoveAt(M);if(this.ViewModel.Preferences.ContainsKey("ShowPOPendingPrds")&&"1"==this.ViewModel.Preferences.ShowPOPendingPrds)for(let M=this.ds.Tables[2].length-1;M>=0;M--)this.ds.Tables[1].filter(l=>l.InvDocDetailsID==this.ds.Tables[2][M].LinkedInvDocDetailsID).forEach(l=>{let r=this.ds.Tables[0].filter(w=>w.InvDocDetailsID==l.LinkedInvDocDetailsID);for(let w=0;w<r.length;w++)this.ds.Tables[0].Remove(r[w])});if(this.dvFields=this.dvFieldsTable=this.ds.Tables[3],this.IsAvgRate>0){let M;this.ds.Columns[0].push("AvgRate"),this.ds.Tables[0].forEach(v=>{M=this.ds.Tables[4].filter(l=>l.ProductID==v.ProductID),M.length>0&&(v.AvgRate=M[0].AvgRate)})}let g=null;if(this.ViewModel.ButtonAction.AccDimInUse){this.ViewModel.ButtonPost.Visible=!1;let M=this.dvQuotations.ToTable(!0,["DocID"]);this.QtnIDs="";for(let v=0;v<M.length;v++)v>0&&(this.QtnIDs+=","),this.QtnIDs+=c.J0.StringValue(M[v].DocID);0==this.QtnIDs.length?this.ViewModel.ButtonAction.Visible=!1:(null!=this.ds&&this.ds.Tables.length>0&&this.ds.Tables[0].length>0&&(this.docid=parseInt(c.J0.StringValue(this.ds.Tables[0][0].docid)),this.ccid=parseInt(c.J0.StringValue(this.ds.Tables[0][0].costcenterid))),g=T.d.report.GetWorkflowCanApprove(this.docid,this.ccid,this.dvQuotations[0].InvDocDetailsID.toString(),this.QtnIDs),c.J0.IsEmpty(g.Tables[0][0].userlevel)||(this.Userlevel=parseInt(c.J0.StringValue(g.Tables[0][0].userlevel)),c.J0.IsEmpty(g.Tables[0][0].WorkFlowID)||(this.WID=parseInt(c.J0.StringValue(g.Tables[0][0].WorkFlowID))),this.ViewModel.ButtonAction.Visible="1"==c.J0.StringValue(g.Tables[0][0].canApprove),"1"==c.J0.StringValue(g.Tables[0][0].canPost)&&(this.ViewModel.ButtonPost.Visible=!0),this.Userlevel>1&&"1"==c.J0.StringValue(g.Tables[0][0].Appall)&&(this.CanApproveAll=!0)))}this.QuotationComparisonDocument>4e4&&(this.ViewModel.ComparisonQuotationVisible=!(this.ViewModel.ButtonPost.Visible||null==g||!g.Columns[0].Contains("StatusID")||"369"!=c.J0.StringValue(g.Tables[0][0].StatusID))||this.ViewModel.ButtonPost.Visible)})}LoadReportWithPostFilters(e){}AddReportTotals(e,s){try{let n,h,C=!1;-100==s&&(s=0,C=!0);let D=new S.Ji(this.ViewModel.ReportColumns.length,24);e.SubTotalBorder<0&&D.Cells.forEach(t=>t.Border=e.SubTotalBorder);var i=this.ViewModel.ReportColumns.find(t=>t.ID==e.SubTotalShowUnder);let u=0;if(null!=i&&(u=this.ViewModel.ReportColumns.indexOf(i)),e.TotalCols.length>0){let t=Math.min.apply(null,e.TotalCols.values);D.Cells[u].ColSpan=t-u,D.Cells[u].ColSpan<=0&&(D.Cells[u].ColSpan=1)}null==D&&(D=new S.Ji(this.ViewModel.ReportColumns.length,24),D.Type=S.QS.SubTotal,D.LevelNo=s+1,D.Cells[u].ColSpan=D.Cells[u].ColSpan,e.SubTotalBorder<0&&D.Cells.forEach(t=>t.Border=e.SubTotalBorder)),this.oRow=D,e.SubTotalHeight>0&&(D.Height=e.SubTotalHeight),this.oRow.Type=S.QS.ReportTotal,this.oRow.Cells[u].Text=e.SubTotalPrefix[0],this.oRow.Cells[u].DataFormat=e.GroupFormat,this.oRow.Cells[u].CellAppearance=e.GroupAppearance,this.oRow.Cells[u].IsNormal=!1,this.oRow.Cells[u].level=0;for(let t=0;t<this.Quotations.length;t++)for(let R=0;R<e.TotalCols.length;R++){let m={Key:e.TotalCols.keys[R],Value:e.TotalCols.values[R]};var a=this.ViewModel.ReportColumns.find(p=>p.ID==m.Key);if(null!=a?n=this.ViewModel.totals[m.Value+t*this.cntCols][s]:(a=this.ViewModel.HiddenNumericColumns.find(p=>p.ID==m.Key),n=this.ViewModel.hiddenTotals[s]),null!=a){if(!c.J0.IsEmpty(a.DataFormat.PercentageOn))if("REPORT_TOTAL"==a.DataFormat.PercentageOn)n=100;else{if(h=0,e.TotalCols.ContainsKey(a.DataFormat.PercentageOn))h=c.J0.Double(this.ViewModel.totals[e.TotalCols[a.DataFormat.PercentageOn][s]].toString());else{var d=this.ViewModel.HiddenNumericColumns.find(p=>p.ID==a.DataFormat.PercentageOn);if(null!=d)try{h=this.ViewModel.totals[this.ViewModel.ReportColumns.length+this.ViewModel.HiddenNumericColumns.indexOf(d)][s]}catch{}}if(0==n||0==h)return null;n=100*n/h}if(null==this.oRow&&(this.oRow=new S.Ji(this.ViewModel.ReportColumns.length,e.SubTotalHeight),e.SubTotalBorder<0&&this.oRow.Cells.forEach(p=>p.Border=e.SubTotalBorder),this.oRow.Type=S.QS.ReportTotal,this.oRow.LevelNo=0),u=0==a.Row?m.Value+t*this.cntCols:a.Column+t*this.cntCols,a.DataFormat.ShowAvg){if(!(this.ViewModel.iCurrGroupDetailRows>0))return null;n/=this.ViewModel.iCurrGroupDetailRows}te.ReportViewModel.SetCellValue(n,a.DataFormat,"FLOAT",0,this.oRow.Cells[u],a.ID),this.oRow.Cells[u].DataFormat=e.SubTotalFormat,this.ViewModel.ReportColumns[u].DataAppearance.Alignment==e.SubTotalAppearance_Data.Alignment?this.oRow.Cells[u].CellAppearance=e.SubTotalAppearance_Data:(this.oRow.Cells[u].CellAppearance=e.SubTotalAppearance_Data.Clone(),this.oRow.Cells[u].CellAppearance.Alignment=this.ViewModel.ReportColumns[u].DataAppearance.Alignment),this.oRow.Cells[u].Border=e.SubTotalBorder,this.oRow.Cells[u].IsNormal=!1,e.SubTotalHeight>0&&(this.oRow.Cells[u].height=e.SubTotalHeight)}}if((e.SubTotalAppearance.IsVisible||C)&&(null==this.ViewModel.ParentReport||(0,se.yG0)(this.ViewModel.Reportds.Tables[0][0].ShowTotals))&&(D.PrintVisible=e.SubTotalAppearance.IsPrintVisible,this.ViewModel.Data.push(D)),this.ViewModel.IsSummary=!1,s>0)for(let t=0;t<this.ViewModel.ReportColumns.length;t++)this.ViewModel.totals[t][s-1]+=this.ViewModel.totals[t][s],this.ViewModel.totals[t][s]=0;return D}catch(C){return Logger.ErrorLog("ReportViewModel::Error Report Totals",C),null}}InitGrid(){this.Grid=new W.vv,this.Grid.CanEvaluateFormulas=!1,this.Grid.Width="",this.Grid.HeaderHeight=40,this.Grid.Table=[],this.Grid.OnBeginEdit.Subscribe(this,"Grid_BeginEdit"),this.Grid.OnCellEditEnding.Subscribe(this,"Grid_EndEdit");let e,s=new Array,i=0,a=0;for(i=0;i<this.cntVisibleGroups;i++){let n=this.ViewModel.ReportColumns[i];e=new P.O7,e.Header=n.HeaderText,e.Header=this.oHeadiQtyRate.Cells[i].Text,e.DisplayMember="C"+i,e.ReadOnly=!0,a+=parseInt(n.width),e.IsFrozen=i<this.cntVisibleGroups&&a<600,e.Width=parseInt(n.width),e.DisableTab=!0,"FLOAT"==n.ColumnType?(i>=this.cntVisibleGroups&&(e.ReadOnly=!1),e.DataType="FLOAT",e.DecimalPoints=n.DataFormat.DecimalsPoints,this.Grid.TableColumns.push(e.DisplayMember)):this.Grid.TableColumns.push(e.DisplayMember),s.push(e)}let d=T.d.SessionManager.Preferences.DecimalsinQty;var C=this.ViewModel.BaseReportColumns.find(n=>null!=n.CDGDO&&"1"==n.Visibility.SelectedValue&&"Quantity"==n.CDGDO.Column);if(C){let n=this.ViewModel.ReportColumns.find(h=>h.ID==C.ID);n&&(d=n.DataFormat.DecimalsPoints)}for(i=0;i<this.Quotations.length;i++)e=new P.O7,e.Header=T.d.GetResource("Reports_LblReqQty")+" ["+this.Quotations[i]+"]",this.dvQuotations=this.dvQuotationsTable.filter(n=>n.VoucherNo==this.Quotations[i]),this.dvQuotations.length>0&&(e.Header+="\r\n"+c.J0.StringValue(this.dvQuotations[0].CreditAccountName)),e.DisplayMember="ReqQty"+i,e.ReadOnly=!0,e.Width=180,e.DisableTab=!1,e.DataType="FLOAT",e.DecimalPoints=d,this.Grid.TableColumns.push(e.DisplayMember),this.Grid.TableColumns.push("ExeQty"+i),s.push(e),e=new P.O7,e.Header="Remarks ["+this.Quotations[i]+"]",this.dvQuotations=this.dvQuotationsTable.filter(n=>n.VoucherNo==this.Quotations[i]),this.dvQuotations.length>0&&(e.Header+="\r\n"+c.J0.StringValue(this.dvQuotations[0].CreditAccountName)),e.DisplayMember="Remarks"+i,e.ReadOnly=!0,e.Width=180,e.DisableTab=!1,e.DataType="TEXT",e.DecimalPoints=d,this.Grid.TableColumns.push(e.DisplayMember),s.push(e),e=new P.O7,e.Header="Rank ["+this.Quotations[i]+"]",this.dvQuotations=this.dvQuotationsTable.filter(n=>n.VoucherNo==this.Quotations[i]),this.dvQuotations.length>0&&(e.Header+="\r\n"+c.J0.StringValue(this.dvQuotations[0].CreditAccountName)),e.DisplayMember="Rank"+i,e.ReadOnly=!0,e.Width=180,e.DisableTab=!1,e.DataType="TEXT",e.DecimalPoints=d,this.Grid.TableColumns.push(e.DisplayMember),s.push(e);this.Grid.TableColumns.push("ReportRowId"),this.Grid.Columns=s,this.ds.Tables[2].length>0?(this.ComparisonDocID=parseInt(this.ds.Tables[2][0].DocID),this.ds.Columns[2].Contains("VoucherNo")&&(this.ViewModel.ComparisonINTERQTN=c.J0.StringValue(this.ds.Tables[2][0].VoucherNo))):(this.ComparisonDocID=0,this.ViewModel.ComparisonINTERQTN="");for(let n=0;n<this.ViewModel.Data.length;n++){let h=this.ViewModel.Data[n];if(null==h.DataRow)continue;let D=!1,u=this.Grid.NewRow();for(u.ReportRowId=n,i=0;i<this.Quotations.length;i++)if(null!=h.DataRow["InvDocDetailsID_QTN"+i]){let t=this.ds.Tables[2].filter(R=>R.SelectedQty>0&&R.LinkedInvDocDetailsID==h.DataRow["InvDocDetailsID_QTN"+i]);0==t.length?u["ReqQty"+i]=0:(u["ExeQty"+i]=t[0].POQty,this.ds.Columns[2].Contains("SelectedQty")&&(u["ReqQty"+i]=t[0].SelectedQty),D=!0)}if(D){for(i=0;i<this.cntVisibleGroups;i++)if(null!=h.Cells[i].Text)try{u[this.Grid.TableColumns[i]]="FLOAT"==this.ViewModel.ReportColumns[i].ColumnType?h.Cells[i].Value:h.Cells[i].Text}catch{}this.Grid.addRow(u),this.SetSelectedColor(u)}}this.Grid.Height=160,console.log(this.Grid)}AddRows(){let s,i,a,d,e=1;for(let l=this.cntGroups;l<=this.cntGroups+this.ViewModel.RepeatNextCols;l++)"Gross"==this.ViewModel.ColumnSource[l].ID&&(e=l-this.cntGroups),"RANK_ID"==this.ViewModel.ColumnSource[l].HeaderText&&(this.ViewModel.rankindex=l,this.linkedRankColumnID=this.ViewModel.ColumnSource[l].Formula,this.ViewModel.EnableRanking=!0,this.ViewModel.NoOfQuotations=this.Quotations.length,this.ViewModel.cntCols=this.cntCols);for(let l=this.cntGroups;l<=this.cntGroups+this.ViewModel.RepeatNextCols;l++)this.ViewModel.ColumnSource[l].ID==this.linkedRankColumnID&&(this.ViewModel.rankColumnindex=l);if(this.ViewModel.Preferences.ContainsKey("ShowQtnAddOns"))for(let r=0;r<this.ds.Tables[1].length;r++){let w=this.ds.Tables[1][r];if(null!=w.LinkedInvDocDetailsID)continue;let I=this.ds.Tables[0].filter(V=>V.ProductID==w.ProductID&&V.InvDocDetailsID==-parseInt(w.InvDocDetailsID));if(0==I.length)if(0!=I.length)parseFloat(I[0].Quantity)<parseFloat(w.Quantity)&&(I[0].Quantity=w.Quantity),w.LinkedInvDocDetailsID=I[0].InvDocDetailsID;else{let V={};this.ds.Tables[0].length>0&&(V.CostCenterID=this.ds.Tables[0][0].CostCenterID),this.ds.Columns[0].forEach(b=>{this.ds.Columns[1].Contains(b)&&(V[b]=w[b])}),V.InvDocDetailsID=-parseInt(V.InvDocDetailsID),w.LinkedInvDocDetailsID=V.InvDocDetailsID,this.ds.Tables[0].push(V)}}this.NumericRows=new Array(this.NumericFields.length),this.TextRows=new Array(this.TextFields.length),this.ProductRows=new Array(this.ds.Tables[0].length),this.oBasicValueRow=this.NewReportRow_2(S.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.oBasicValueRow.Cells[0].Text=T.d.GetResource("Reports_LblTotalBasicValue"),this.oBasicValueRow.Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups,this.oBasicValueRow.Cells[0].CellAppearance.Alignment="Left",this.oTotalRow=this.NewReportRow_2(S.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.oTotalRow.Cells[0].Text=T.d.GetResource("Reports_LblTotal"),this.oTotalRow.Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups,this.oTotalRow.Cells[0].CellAppearance.Alignment="Left",this.ViewModel.SNo=0;let C=new Array(this.Quotations.length).fill(0),n=new Array(this.Quotations.length).fill(0),h=c.J0.NumArray(this.NumericFields.length,this.Quotations.length),D=new y.G9,u=new y.G9,t=new y.G9,R=new y.G9;for(this.ds.Columns[0].push("KPICols"),this.i=0;this.i<this.Quotations.length;this.i++)this.ds.Columns[0].push("InvDocDetailsID_QTN"+this.i);let m,p,f=new Array,g=this.ds.Tables[0];if(this.EnableGroupWise){let l="";this.ViewModel.lstGroup.forEach(r=>{l.length>0&&(l+=","),l+=r.ID}),l.length>0&&g.SortBy(l.split(",")),this.ViewModel.iGroupRowsAdded=0,this.ViewModel.iCurrGroupDetailRows=0,this.ViewModel.lstParents=[],this.ViewModel.lstTotal=[],this.ViewModel.lstParents.push(new S.Ji(this.ViewModel.ReportColumns.length,this.ViewModel.RowHeight)),this.ViewModel.lstTotal.push(new Array(this.ViewModel.ReportColumns.length+this.ViewModel.HiddenNumericColumns.length).fill(0));for(let r=0;r<this.ViewModel.lstGroup.length;r++)this.ViewModel.lstParents.push(new S.Ji(this.ViewModel.ReportColumns.length,this.ViewModel.RowHeight)),this.ViewModel.lstTotal.push(new Array(this.ViewModel.ReportColumns.length+this.ViewModel.HiddenNumericColumns.length).fill(0))}for(this.i=0;this.i<g.length;this.i++){this.EnableGroupWise&&this.ViewModel.AddGroupRows(g,this.i,this.cntGroups),f.Clear(),f.push(new S.Ji(this.oColumns.length,this.ViewModel.RowHeight)),f[0].DataRow=g[this.i];for(let l=0;l<this.cntGroups;l++){if(this.oColumns[l].Row>0){if(f.length-1<this.oColumns[l].Row)for(let w=0;w<=this.oColumns[l].Row;w++)f.length-1<w&&(f.push(new S.Ji(this.oColumns.length,this.ViewModel.SubRowHeight)),f[f.length-1].Type=S.QS.Detail);m=this.oColumns[l].Row,p=this.oColumns[l].Column,f[m].Cells[p].IsNormal=!1,f[m].Cells[p].CellAppearance=this.oColumns[l].DataAppearance}else m=0,p=l;let r="";""!=this.oColumns[l].Formula&&"LATEST"!=this.oColumns[l].Formula&&"OLDEST"!=this.oColumns[l].Formula?r=this.ViewModel.CalculateFormula_1(this.oColumns[l].Formula,g[this.i],f):this.ds.Columns[0].Contains(this.oColumns[l].ID)&&(r=c.J0.String(g[this.i][this.oColumns[l].ID])),""!=r&&(this.ViewModel.SetCellValue(r,this.oColumns[l].DataFormat,this.oColumns[l].ColumnType,f[m].Cells[p]),this.ViewModel.TotalCols.Contains(this.oColumns[l].ID)&&(this.ViewModel.totals[l][this.ViewModel.lstGroup.length]+=c.J0.Double(r)),this.EnableGroupWise&&this.ViewModel.TotalCols.Contains(this.oColumns[l].ID)&&(this.ViewModel.lstTotal[this.ViewModel.lstTotal.length-1][l]+=c.J0.Double(r)))}if(-1!=this.ViewModel.colSNoIndex&&(f[0].Cells[this.ViewModel.colSNoIndex].Value=++this.ViewModel.SNo,f[0].Cells[this.ViewModel.colSNoIndex].Text=this.ViewModel.SNo.toString()),this.PurchaseOrderDocument>0){let l=parseFloat(g[this.i].Quantity),r=parseFloat(g[this.i].ExeQty);if(0!=r)for(let w=0;w<this.ViewModel.ReportColumns.length;w++)null==f[0].Cells[w].CellAppearance&&(f[0].Cells[w].CellAppearance=this.ViewModel.ReportColumns[w].DataAppearance.Clone()),f[0].Cells[w].IsNormal=!1,f[0].Cells[w].CellAppearance.BackColor=l<=r?this.ExecutedClr:this.PartialExecutedClr}this.oRow=f[0],D.Clear(),u.Clear(),t.Clear(),R.Clear();for(let l=0;l<this.Quotations.length;l++)if(this.dvQuotations=this.dvQuotationsTable.filter(r=>r.VoucherNo==this.Quotations[l]&&r.LinkedInvDocDetailsID==this.ds.Tables[0][this.i].InvDocDetailsID),this.dvQuotations.length>0){f[0].DataRow["InvDocDetailsID_QTN"+l]=this.dvQuotations[0].InvDocDetailsID;for(let r=this.cntGroups;r<=this.cntGroups+this.ViewModel.RepeatNextCols;r++){if(this.oColumns[r].Row>0){if(f.length-1<this.oColumns[r].Row)for(let I=0;I<=this.oColumns[r].Row;I++)f.length-1<I&&(f.push(new S.Ji(this.oColumns.length,this.ViewModel.SubRowHeight)),f[f.length-1].Type=S.QS.Detail);m=this.oColumns[r].Row,p=this.oColumns[r].Column,f[m].Cells[p+l*this.cntCols].IsNormal=!1,f[m].Cells[p+l*this.cntCols].CellAppearance=this.oColumns[r].DataAppearance.Clone()}else m=0,p=r;let w="";""!=this.oColumns[r].Formula&&this.CalculateFormula(this.oColumns[r],this.dvQuotations[0]),c.J0.IsEmpty(this.dvQuotations[0][this.oColumns[r].ID])||(w=this.dvQuotations[0][this.oColumns[r].ID].toString()),""!=w&&(d=f[m].Cells[p+l*this.cntCols],this.ViewModel.SetCellValue(w,this.oColumns[r].DataFormat,"FLOAT",d),this.ViewModel.TotalCols.Contains(this.oColumns[r].ID)&&(this.ViewModel.totals[p+l*this.cntCols][this.ViewModel.lstGroup.length]+=c.J0.Double(w)),this.EnableGroupWise&&this.ViewModel.TotalCols.Contains(this.oColumns[r].ID)&&(this.ViewModel.lstTotal[this.ViewModel.lstTotal.length-1][p+l*this.cntCols]+=c.J0.Double(w)),this.oColumns[r].ID==this.GrandTotalColumnID&&(n[l]+=c.J0.Double(w)),this.oColumns[r].ID==this.RateKPIColumn&&(D.push(p+l*this.cntCols,parseFloat(w)),u.push(p+l*this.cntCols,d)),this.oColumns[r].ID==this.linkedRankColumnID&&(t.push(this.ViewModel.rankindex+l*this.cntCols,parseFloat(w)),R.push(this.ViewModel.rankindex+l*this.cntCols,f[m].Cells[this.ViewModel.rankindex+l*this.cntCols])))}C[l]+=parseFloat(this.dvQuotations[0].Gross)}if(this.ProductRows[this.i]=f[0],this.ViewModel.EnableRanking&&t.length>0&&t.length>0){let r=1;t.keys.forEach(w=>{null==R[w].CellAppearance&&(R[w].CellAppearance=this.ViewModel.ReportColumns[w].DataAppearance.Clone()),R[w].IsNormal=!1,this.ViewModel.SetCellValue("L"+r++,this.oColumns[w].DataFormat,this.oColumns[w].ColumnType,R[w])})}if(this.ViewModel.IsSummary||(f.forEach(l=>{l.LevelNo=this.ViewModel.lstGroup.length,(!this.ViewModel.HideEmptyRows||null!=l.Cells.find(r=>!c.J0.IsEmptySpace(r.Text)))&&(!this.ViewModel.IsNoDataGroups||null!=l.Cells.find(r=>!c.J0.IsEmptySpace(r.Text)))&&this.ViewModel.Data.push(l)}),this.ViewModel.iGroupRowsAdded++,this.ViewModel.iCurrGroupDetailRows++),D.length>0){var M=D.values.filter(l=>0!=l);if(M.length>0){let l=Math.min.apply(null,M);D.keys.forEach(r=>{l==D[r]&&(null==u[r].CellAppearance&&(u[r].CellAppearance=this.ViewModel.ReportColumns[r].DataAppearance.Clone()),u[r].IsNormal=!1,u[r].CellAppearance.BackColor=this.RateKPIColumnColor,u[r].CellAppearance.ForeColor="White",this.oRow.Cells.Contains(u[r])&&(this.oRow.DataRow.KPICols=c.J0.IsEmpty(this.oRow.DataRow.KPICols)?r:c.J0.String(this.oRow.DataRow.KPICols)+","+r))})}}}if(this.EnableGroupWise)for(let l=0;l<this.ViewModel.lstGroup.length;l++)this.ViewModel.UpdateTreeTotals(l);for(let l=0;l<this.Quotations.length;l++)this.ViewModel.SetCellValue(C[l],this.oColumns[this.cntGroups+l*this.cntCols+e].DataFormat,"FLOAT",this.oBasicValueRow.Cells[this.cntGroups+l*this.cntCols+e]);for(this.i=0;this.i<this.NumericFields.length;this.i++){this.NumericRows[this.i]=this.NewReportRow(),this.dvFields=this.dvFieldsTable.filter(r=>r.SysColumnName==this.NumericFields[this.i]),this.NumericRows[this.i].Cells[0].Text=this.dvFields.length>0?c.J0.StringValue(this.dvFields[0].UserColumnName):this.NumericFields[this.i],this.NumericRows[this.i].Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups,this.NumericFieldsBold[this.i]&&(this.NumericRows[this.i].Cells[0].IsNormal=!1,this.NumericRows[this.i].Cells[0].CellAppearance=this.oColumns[0].DataAppearance.Clone(),this.NumericRows[this.i].Cells[0].CellAppearance.IsBold=!0);let l=new Array;for(let r=0;r<this.Quotations.length;r++){for(a=0,l.Clear(),this.dvQuotations=this.dvQuotationsTable.filter(w=>w.VoucherNo==this.Quotations[r]),this.k=0;this.k<this.dvQuotations.length;this.k++)i=c.J0.Double(this.dvQuotations[this.k][this.NumericFields[this.i].Insert(2,"Calc")]),h[this.i][r]+=i,i=c.J0.Double(this.dvQuotations[this.k][this.NumericFields[this.i]]),a+=i,l.Contains(i)||l.push(i);if(this.NumericFieldsIgnoreTotal[this.i]||(C[r]+=h[this.i][r]),this.ViewModel.SetCellValue(h[this.i][r],this.oColumns[this.cntGroups+r*this.cntCols+1].DataFormat,"FLOAT",this.NumericRows[this.i].Cells[this.cntGroups+r*this.cntCols+e]),this.NumericFieldsBold[this.i]&&(this.NumericRows[this.i].Cells[this.cntGroups+r*this.cntCols+e].IsNormal=!1,this.NumericRows[this.i].Cells[this.cntGroups+r*this.cntCols+e].CellAppearance=this.oColumns[this.cntGroups+r*this.cntCols+e].DataAppearance.Clone(),this.NumericRows[this.i].Cells[this.cntGroups+r*this.cntCols+e].CellAppearance.IsBold=!0),Math.abs(a-h[this.i][r])>.001&&(d=this.NumericRows[this.i].Cells[this.cntGroups+r*this.cntCols+e-1],d.IsNormal=!1,d.CellAppearance=this.ViewModel.ReportColumns[this.cntGroups+e].DataAppearance.Clone(),d.CellAppearance.Alignment="Left",this.NumericFieldsBold[this.i]&&(d.CellAppearance.IsBold=!0),l.length>0)){let w="";l.sort((I,V)=>I-V);for(let I=0;I<l.length;I++)w.length>0&&(w+=", "),w+=l[I].toString();d.Text="@"+w}}}let v=new Array;for(this.i=0;this.i<this.TextFields.length;this.i++){this.TextRows[this.i]=this.NewReportRow(),this.dvFields=this.dvFieldsTable.filter(l=>l.SysColumnName==this.TextFields[this.i]),this.TextRows[this.i].Cells[0].Text=this.dvFields.length>0?c.J0.StringValue(this.dvFields[0].UserColumnName):this.TextFields[this.i],this.TextRows[this.i].Cells[0].ColSpan=this.cntGroups-this.cntHiddenGroups;for(let l=0;l<this.Quotations.length;l++)for(d=this.TextRows[this.i].Cells[this.cntGroups+l*this.cntCols],d.IsNormal=!1,d.ColSpan=this.cntCols-this.cntHiddenCols,d.Text="",d.CellAppearance=this.ViewModel.ReportColumns[1+l*this.cntCols].DataAppearance.Clone(),d.CellAppearance.Alignment="Left",v.Clear(),this.dvQuotations=this.dvQuotationsTable.filter(r=>r.VoucherNo==this.Quotations[l]),this.k=0;this.k<this.dvQuotations.length;this.k++)s=this.TextFields[this.i].startsWith("dcAlpha")?c.J0.String(this.dvQuotations[this.k][this.TextFields[this.i]]):c.J0.String(this.dvQuotations[this.k][this.TextFields[this.i]+"Name"]),s.length>0&&!v.Contains(s)&&(v.push(s),d.Text.length>0&&(d.Text+=","),d.Text+=s)}if(C.length>0)if(c.J0.IsEmpty(this.GrandTotalColumnID)){let l=Math.min.apply(null,C);for(let r=0;r<this.Quotations.length;r++)this.ViewModel.SetCellValue(C[r],this.oColumns[this.cntGroups+r*this.cntCols+e].DataFormat,"FLOAT",this.oTotalRow.Cells[this.cntGroups+r*this.cntCols+e]),l==C[r]&&(this.oTotalRow.Cells[this.cntGroups+r*this.cntCols+e].CellAppearance.BackColor=this.RateKPIColumnColor,this.oTotalRow.Cells[this.cntGroups+r*this.cntCols+e].CellAppearance.ForeColor="White")}else{let l=Math.min.apply(null,n);for(let r=0;r<this.Quotations.length;r++)this.ViewModel.SetCellValue(n[r],this.oColumns[this.cntGroups+r*this.cntCols+e].DataFormat,"FLOAT",this.oTotalRow.Cells[this.cntGroups+r*this.cntCols+e]),l==n[r]&&(this.oTotalRow.Cells[this.cntGroups+r*this.cntCols+e].CellAppearance.BackColor=this.RateKPIColumnColor,this.oTotalRow.Cells[this.cntGroups+r*this.cntCols+e].CellAppearance.ForeColor="White")}}CalculateFormula(e,s){let i=this.fldDict;for(let a=0;a<this.fldDict.keys.length;a++){let d={Key:this.fldDict.keys[a]};c.J0.IsEmpty(s[d.Key])?this.fldDict[d.Key].setFieldValue(0):this.fldDict[d.Key].setFieldValue(null!=s[d.Key]?s[d.Key]:"")}if(!c.J0.IsEmpty(e.Formula))try{s[e.ID]=c.J0.StringValue(this.eval.EvaluateExpression(e.Formula,i))}catch{}return!1}RowDblClick(e,s){if(parseFloat(e.DataRow.Quantity)!=parseFloat(e.DataRow.ExeQty))if(0!=this.QuotationComparisonDocument){let i,a=this.ViewModel.Data.indexOf(e);if(-1==a)return void(this.ViewModel.DisplayMessage="Product Row Not Found");{let d="";-1!=s&&s>=this.cntVisibleGroups&&!c.J0.IsEmpty(this.ViewModel.ReportColumns[s].MatixRepeatID)&&(d=this.Quotations[parseInt(this.ViewModel.ReportColumns[s].MatixRepeatID)]);let C=new E(this,d,e.DataRow,a,!1,!1);if(0==C.VendorsList.Items.length)return void(this.ViewModel.DisplayMessage="No quotations raised for selected product");this.ViewModel.EnableRanking&&(C.blnPopShowLevel=!0,C.PopShowLevel=e.Cells[this.ViewModel.rankindex+parseInt(C.VendorsList.GetselectedItem().Parent)*this.cntCols].Text),T.d.page.ShowDialog(C,G,{ShowCenter:!0}).subscribe(()=>{if(!C.IsOkClick)return;let n,h=!1,D=this.Grid.Table.filter(m=>m.ReportRowId==a);0==D.length?(h=!0,n=this.Grid.NewRow(),n.ReportRowId=this.ViewModel.Data.indexOf(e)):n=D[0];let t,R,u=this.Quotations.indexOf(C.VendorsList.SelectedValue);if(t=c.J0.Double(C.Quantity.Text),R=c.J0.Double(C.Percentage),t*=R/100,n["ReqQty"+u]=t,n["Remarks"+u]=c.J0.String(C.Remarks.Text),n["Rank"+u]=e.Cells[this.ViewModel.rankindex+parseInt(C.VendorsList.GetselectedItem().Parent)*this.cntCols].Text,h){for(i=0;i<this.cntVisibleGroups;i++)if(null!=e.Cells[i].Text)try{n[this.Grid.TableColumns[i]]="FLOAT"==this.ViewModel.ReportColumns[i].ColumnType?e.Cells[i].Value:e.Cells[i].Text}catch{}this.Grid.addRow(n)}this.SetSelectedColor(n)})}}else{let i=c.J0.String(e.DataRow.KPICols).split(",");e.IsSelected=!e.IsSelected;for(let a=0;a<e.Cells.length;a++)i.Contains(a.toString())||(null==e.Cells[a].CellAppearance&&(e.Cells[a].CellAppearance=this.ViewModel.ReportColumns[a].DataAppearance.Clone()),e.Cells[a].IsNormal=!1,e.Cells[a].CellAppearance.ForeColor=e.IsSelected?"#FF00A9DA":"Black");this.ViewModel.updateRow(e),this.ViewModel.refreshDataView(e),this.ViewModel.SelectedRow=e}}SelectAllRows(e){var s=this;return(0,O.A)(function*(){if(0==s.QuotationComparisonDocument)return;s.ViewModel.ReportColumns.indexOf(e);let a="";if(c.J0.IsEmpty(e.MatixRepeatID)||(a=s.Quotations[parseInt(e.MatixRepeatID)]),""==a)return void(s.ViewModel.DisplayMessage="Please Click On Quotation Columns");let d=new E(s,a,null,0,!0,!1);if(yield T.d.page.openDialog(d,G,{ShowCenter:!0,Title:"Post",NoWidth:!0}),!d.IsOkClick)return;if(s.Grid.Table.length>0){if(!confirm("Quoation already selected. Do you want to change?"))return;s.Grid.Clear()}let C=parseInt(e.MatixRepeatID);for(let n=0;n<s.ViewModel.Data.length;n++){if(s.oRow=s.ViewModel.Data[n],null==s.oRow.DataRow||null==s.oRow.DataRow["InvDocDetailsID_QTN"+C])continue;let h,t,R,D=!1,u=s.Grid.Table.filter(m=>m.ReportRowId==n);if(0==u.length?(D=!0,h=s.Grid.NewRow(),h.ReportRowId=n):h=u[0],s.dvQuotations=s.dvQuotationsTable.filter(m=>m.InvDocDetailsID==s.oRow.DataRow["InvDocDetailsID_QTN"+C]),0!=s.dvQuotations.length&&(t=d.Percentage,R=s.dvQuotations[0].Quantity,h["ReqQty"+C]=R*(t/100),D)){for(let m=0;m<s.cntVisibleGroups;m++)if(null!=s.oRow.Cells[m].Text)try{h[s.Grid.TableColumns[m]]="FLOAT"==s.ViewModel.ReportColumns[m].ColumnType?s.oRow.Cells[m].Value:s.oRow.Cells[m].Text}catch{}s.Grid.addRow(h)}}s.ViewModel.DisplayMessage=a+" - All Rows Added"})()}Grid_BeginEdit(e,s,i){if((s=e.args.column.field).startsWith("ReqQty")){let a=parseInt(s.Replace("ReqQty","")),d=parseInt(e.ReportRowId);if(null==this.ViewModel.Data[d].DataRow["InvDocDetailsID_QTN"+a])return e.args.Cancel=!0,!0}return e.args.Cancel=!1,!1}Grid_EndEdit(e,s,i){if(s.startsWith("ReqQty")){this.ViewModel.DisplayMessage="";let a=parseInt(s.Replace("ReqQty",""));parseFloat(e["ReqQty"+a])<parseFloat(e["ExeQty"+a])&&(e["ReqQty"+a]=e["ExeQty"+a],this.ViewModel.DisplayMessage="Please enter required qty greater than executed qty")}}Post(){if(null!=this.ProductRows)if(0==this.ProductRows.length)this.ViewModel.DisplayMessage="No products found";else if(0==this.Quotations.length)this.ViewModel.DisplayMessage="No vendors found to post";else if(this.QuotationComparisonDocument>4e4){if(0==this.Grid.Table.length)return void(this.ViewModel.DisplayMessage="Select products to post");this.PostQuotationComparison()}else{let e=new E(this,"",null,0,!1,!1);T.d.page.ShowDialog(e,G,{ShowCenter:!0,Title:"Post",NoWidth:!0}).subscribe(()=>{e.IsOkClick&&this.PostPO(e)})}}PostPO(e){var s=this;return(0,O.A)(function*(){let a=s.ProductRows.filter(C=>1==C.IsSelected);0==a.length&&(a=s.ProductRows);let d=0;if(s.ViewModel.Preferences.ContainsKey("PurchaseOrderDocument")&&s.ViewModel.Preferences.PurchaseOrderDocument.length>0&&(d=parseInt(s.ViewModel.Preferences.PurchaseOrderDocument)),0==d)s.ViewModel.DisplayMessage="Purchase Order document is not configured";else{T.d.page.ShowLoading=!0;let C="",n=new Array;null==e.VendorsList.SelectedIndex&&(e.VendorsList.SelectedIndex=0);let h="InvDocDetailsID_QTN"+e.VendorsList.SelectedIndex;a.forEach(u=>{null!=u.DataRow[h]&&(0==C.length&&(C=c.J0.StringValue(u.DataRow[h])),n.push(c.J0.StringValue(u.DataRow[h])))});let D=null;C.length>0&&(D=T.d.report.ReportDataTable("RPT045",s.ViewModel.IsReportDB,C),0==D.length&&(D=null)),k.RibbonExtViewModel.GetDocumentObject(d,"",null==D,D).then(u=>{var t=u.ScreenObject.Link.LinkCombo.Items.find(m=>m.Parent==s.QuotationDocument.toString());if(t){var R=e.VendorsList.GetselectedItem();null!=R&&null!=u.ScreenObject.CreditAccount&&(u.ScreenObject.CreditAccount.SelectedValue=R.CurrID);let m=u.ScreenObject.GetLinkDocDetails(e.VendorsList.SelectedValue,parseInt(t.Value));for(let p=0;p<m.Tables[0].length;p++)if(n.Contains(m.Tables[0][p].DocDetailsID.toString())){let f=m.Tables[0].filter(g=>g.DynamicInvDocDetailsID==m.Tables[0][p].DocDetailsID);p+=f.length}else{let f=m.Tables[0].filter(g=>g.DynamicInvDocDetailsID==m.Tables[0][p].DocDetailsID);for(let g=0;g<f.length;g++)m.Tables[0].RemoveAt(p),m.Tables[1].RemoveAt(p),m.Tables[2].RemoveAt(p),m.Tables[3].RemoveAt(p);m.Tables[0].RemoveAt(p),m.Tables[1].RemoveAt(p),m.Tables[2].RemoveAt(p),m.Tables[3].RemoveAt(p),p--,p-=f.length}u.LoadLinkData(m,new Array,0,new Array,null),T.d.page.addNewTab({component:ee.AddEditDocumentComponent,params:{obj:u}})}else s.ViewModel.DisplayMessage="Please place linking between Quotation and Purchase Order Docuemnt"})}})()}PostQuotationComparison(){let e=this.ViewModel.Preferences.ContainsKey("PQDCIPostOnlySelected"),i=this.ProductRows.filter(d=>1==d.IsSelected);0==i.length&&(i=this.ProductRows);let a=null;0==this.ComparisonDocID&&this.Quotations.length>0&&(a=T.d.report.ReportDataTable("RPT022",this.ViewModel.IsReportDB,"select top  1 DCC.* from inv_docdetails D with(nolock) join com_docccdata DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID where D.VoucherNo='"+this.Quotations[0]+"'"),0==a.length&&(a=null)),k.RibbonExtViewModel.GetDocumentObject(this.QuotationComparisonDocument,"Post Document",this.ComparisonDocID>0,a).then(d=>{if(this.oDocument=d,0==this.ComparisonDocID&&!this.oDocument.DialogResult)return!1;this.oDocument.SaveCallBack=new B.Yk,this.oDocument.SaveCallBack.Subscribe(this,"OnSaveCallBack");var C=this.oDocument.ScreenObject.Link.LinkCombo.Items.find(h=>h.Parent==this.QuotationDocument.toString());if(C){let h,D="",u="",t="",R=new Array,m=new Array;for(let f=0;f<this.Grid.Table.length;f++){let g=this.Grid.Table[f];for(let M=0;M<this.Quotations.length;M++){if(null==g["ReqQty"+M]||(h=parseFloat(g["ReqQty"+M]),u=c.J0.String(g["Remarks"+M]),t=c.J0.String(g["Rank"+M]),h<=0))continue;let v=parseInt(g.ReportRowId),l=this.ViewModel.Data[v].DataRow,r={InvDocDetailsID:null};r.InvDocDetailsID=parseInt(l["InvDocDetailsID_QTN"+M]),e&&R.push(r);let w=new J;w.InvID_QTN=parseInt(l["InvDocDetailsID_QTN"+M]),w.UsedQty=0,w.ReqQty=h,w.Remarks=u,w.Rank=t,m.push(w),this.lstLinkCount++}}for(let f=0;f<this.Quotations.length;f++)f>0&&(D+=","),D+="'"+this.Quotations[f]+"'";if(this.ComparisonDocID>0&&k.RibbonExtViewModel.OnDocPrefixChanged(this.oDocument,this.ComparisonDocID),D.length>0){let g,M,f=new Array;for(let I=0;I<this.oDocument.GRIDTABLE.length;I++)null!=this.oDocument.GRIDTABLE[I].LinkedInvDocDetailsID&&0!=parseInt(this.oDocument.GRIDTABLE[I].LinkedInvDocDetailsID)&&f.push(I);D=D.Trim("'"),this.oDocument.FillLink(D,parseInt(C.Value),R,new Array);for(let I=0;I<this.oDocument.GRIDTABLE.length;I++)if(f.Contains(I)){g=this.oDocument.GRIDTABLE[I];for(let V=I+1;V<this.oDocument.GRIDTABLE.length;V++)M=this.oDocument.GRIDTABLE[V],null!=M.LinkedInvDocDetailsID&&parseInt(g.LinkedInvDocDetailsID)==parseInt(M.LinkedInvDocDetailsID)&&this.oDocument.GRIDTABLE.RemoveAt(V)}for(let I=0;I<this.oDocument.GRIDTABLE.length;I++){let V=this.oDocument.GRIDTABLE[I];if(V[this.ComparisonQtyField]=0,V[this.ComparisonStatusField]="",V[this.ComparisonRemarksField]="",V[this.ComparisonRankField]="",null!=V.LinkedInvDocDetailsID){var n=m.find(b=>b.InvID_QTN==parseInt(V.LinkedInvDocDetailsID));n&&(this.ComparisonQtyField.length>0&&this.oDocument.ScreenObject.GridDataColumns.Contains(this.ComparisonQtyField)&&(V[this.ComparisonQtyField]=n.ReqQty+n.UsedQty),this.ComparisonStatusField.length>0&&this.oDocument.ScreenObject.GridDataColumns.Contains(this.ComparisonStatusField)&&(V[this.ComparisonStatusField]="SELECTED"),this.ComparisonRemarksField.length>0&&this.oDocument.ScreenObject.GridDataColumns.Contains(this.ComparisonRemarksField)&&(V[this.ComparisonRemarksField]=n.Remarks),this.ComparisonRankField.length>0&&this.oDocument.ScreenObject.GridDataColumns.Contains(this.ComparisonRankField)&&(V[this.ComparisonRankField]=n.Rank))}}let v=new Array,l=this.ds.Tables[1];l.Sort="LinkedInvDocDetailsID";for(let I=0;I<l.length;I++){let V=l[I];if(null==V.LinkedInvDocDetailsID)continue;let b=new J;b.InvID_QTN=parseInt(V.InvDocDetailsID),b.InvID_MRN=parseInt(V.LinkedInvDocDetailsID),v.push(b)}for(let I=0;I<this.oDocument.GRIDTABLE.length;I++){let V=this.oDocument.GRIDTABLE[I];V.IndentID=0,null!=V.LinkedInvDocDetailsID&&0!=parseInt(V.LinkedInvDocDetailsID)&&(this.dvQuotations=this.dvQuotationsTable.filter(b=>b.InvDocDetailsID==V.LinkedInvDocDetailsID),this.dvQuotations.length>0&&(V.IndentID=this.dvQuotations[0].LinkedInvDocDetailsID))}let r=this.oDocument.GRIDTABLE.filter(I=>c.J0.IsNum(I.ProductID_Key)&&0!=I.ProductID_Key);r.SortBy(["IndentID"]);for(let I=0;I<r.length;I++)r[I].DocSeqNo=I+1;if(this.ComparisonRemarksField.length>0){let I=new E(this,"",null,0,!0,!0);T.d.page.ShowDialog(I,G,{ShowCenter:!0,Title:"Post",NoWidth:!0}).subscribe(()=>{var V;I.IsOkClick&&(null!=(V=this.oDocument.ScreenObject.HeaderFields.find(b=>b instanceof B.MI&&"CommonNarration"==b.DBColumnName.toString()))&&this.oDocument.ScreenObject.fillcontrolValue(V,c.J0.String(I.Remarks.Text)))})}let w=!1;return w=this.oDocument.SaveInventoryDocument(0!=this.oDocument.DocID?"Revise":"Save",!0,!0,"SYNC_SAVE"),w}return this.ViewModel.DisplayMessage="Please enter PO Qty.",!1}return this.ViewModel.DisplayMessage="Please place linking between Quotation and Comparison Docuemnt",!1})}OnSaveCallBack(e,s){return null!=this.oDocument&&(this.ComparisonDocID=s,this.ViewModel.ComparisonINTERQTN=this.oDocument.ScreenObject.VoucherNo,this.ViewModel.DisplayMessage=this.oDocument.DisplayMessage,this.ViewModel.ShowMessageBox(this.oDocument.DisplayMessage,"Alert")),""}SetSelectedColor(e,s=!1){if(0==this.FullSelectedClr.length&&0==this.PartialSelectedClr.length)return;let i=0;if(!s)for(let h=0;h<this.Quotations.length;h++)null!=e["ReqQty"+h]&&(i+=parseFloat(e["ReqQty"+h]));let a=parseInt(e.ReportRowId),d=this.ViewModel.Data[a],C=parseFloat(d.DataRow.Quantity);for(let h=0;h<this.ViewModel.ReportColumns.length;h++)null==d.Cells[h].CellAppearance&&(d.Cells[h].CellAppearance=this.ViewModel.ReportColumns[h].DataAppearance.Clone()),d.Cells[h].IsNormal=!1,0==i?d.Cells[h].CellAppearance.ForeColor=this.ViewModel.ReportColumns[h].DataAppearance.ForeColor:i<C&&this.PartialSelectedClr.length>0?d.Cells[h].CellAppearance.ForeColor=this.PartialSelectedClr:i>=C&&this.FullSelectedClr.length>0&&(d.Cells[h].CellAppearance.ForeColor=this.FullSelectedClr);this.ViewModel.Data.RemoveAt(a),this.ViewModel.Data.Insert(a,d),this.ViewModel.SelectedRow==d&&(this.ViewModel.SelectedRow=null,this.ViewModel.SelectedRow=d)}}class E extends j.g{get Percentage(){return this._Percentage}set Percentage(e){this._Percentage!=e&&(this._Percentage=e)}get PopShowLevel(){return this._PopShowLevel}set PopShowLevel(e){this._PopShowLevel!=e&&(this._PopShowLevel=e)}get blnPopShowLevel(){return this._blnPopShowLevel}set blnPopShowLevel(e){this._blnPopShowLevel!=e&&(this._blnPopShowLevel=e)}constructor(e,s,i,a,d,C){if(super(),this.IsOkClick=!1,this.IsFrmVendor=!1,this.IsHeaderWiseRemark=!1,this.blnPercentage=!0,this.iRowId=0,this.QTNCol="",this.MRNQty=0,this._Percentage="100",this._PopShowLevel="",this._blnPopShowLevel=!1,C)return this.VendorsList=new L.y$,this.Quantity=new N.Dw,this.Remarks=new N.hV,this.VendorsList.Visible=!1,this.Quantity.Visible=!1,this.IsHeaderWiseRemark=C,void(this.blnPercentage=!1);this.oComp=e,this.IsFrmVendor=d,this.VendorsList=new L.y$,this.Quantity=new N.Dw,this.Remarks=new N.hV,this.Remarks.Label="Justification",this.Remarks.Row=0,this.Remarks.Column=3,this.VendorsList.Label="Select Vendor",this.Quantity.Label="Select Quantity",this.blnPercentage=!0,this.IsHeaderWiseRemark=!1;for(let n=0;n<e.Quotations.length;n++)e.dvQuotations=e.dvQuotationsTable.filter(h=>h.VoucherNo==e.Quotations[n]),(null==i||null!=i["InvDocDetailsID_QTN"+n])&&(null!=i&&(this.MRNQty=parseFloat(i.Quantity)),this.VendorsList.Items.push(L._p.ComboBoxItems_3(e.dvQuotations[0].CreditAccountName.toString()+" ["+e.Quotations[n]+"]",e.Quotations[n],n.toString())),this.VendorsList.Items[this.VendorsList.Items.length-1].CurrID=parseInt(e.dvQuotations[0].CreditAccount),null!=i&&null!=i["InvDocDetailsID_QTN"+n]&&(e.dvQuotations=e.dvQuotationsTable.filter(h=>h.InvDocDetailsID==i["InvDocDetailsID_QTN"+n]),e.dvQuotations.length>0&&(this.VendorsList.Items[this.VendorsList.Items.length-1].Aliasname=e.dvQuotations[0].Quantity.toString())));this.VendorsList.SelectedValue=!c.J0.IsEmpty(s)&&this.VendorsList.Items.find(n=>n.Value==s)?s:this.VendorsList.Items[0].Value,this.IsFrmVendor&&(this.VendorsList.Enable=!1,this.VendorsList.IsReadOnly=!0,this.Percentage="100"),0==e.QuotationComparisonDocument||this.IsFrmVendor?(this.Quantity.Visible=!1,this.Remarks.Visible=!1):(this.Quantity.Text="0",this.Remarks.Text="",this.iRowId=a,this.VendorsList.SelectionChangedCommand.Subscribe(this,"OnVendorChange"),this.OnVendorChange(null)),e.ViewModel.Preferences.ContainsKey("RestrictQTNQtyEdit")&&(this.Quantity.Enable=!1)}OnVendorChange(e){let s=0;var i=this.VendorsList.GetselectedItem();let a=this.oComp.Grid.Table.filter(d=>d.ReportRowId==this.iRowId);this.QTNCol=i.Parent,a.length>0&&(s=null!=a[0]["ReqQty"+i.Parent]?parseFloat(a[0]["ReqQty"+i.Parent]):0),0==s&&null!=i&&!c.J0.IsEmpty(i.Aliasname)&&(s=parseFloat(i.Aliasname)),this.Quantity.Text=s.ToString("N"+T.d.SessionManager.Preferences.DecimalsinQty)}OnButtonClick(e){if(this.IsHeaderWiseRemark?(this.IsOkClick=!0,T.d.page.HideDialog(this.PopUpGUID),e=""):this.oComp.ViewModel.DisplayMessage="","Cancel"==e)T.d.page.HideDialog(this.PopUpGUID);else if("OK"==e){if(this.oComp.QuotationComparisonDocument>4e4&&!this.IsFrmVendor){let d,i=c.J0.Double(this.Quantity.Text),a=0;d=c.J0.Double(this.Percentage),i*=d/100;let C=this.oComp.Grid.Table.filter(n=>n.ReportRowId==this.iRowId);if(C.length>0&&(a=null!=C[0]["ExeQty"+this.QTNCol]?parseFloat(C[0]["ExeQty"+this.QTNCol]):0),i<0)return void(this.oComp.ViewModel.DisplayMessage="Please enter valid quantity");if(0==i){if(0==C.length)return void(this.oComp.ViewModel.DisplayMessage="Please enter valid quantity");{let n=!1;for(let h=0;h<this.oComp.Quotations.length;h++)if(h.toString()!=this.QTNCol&&null!=C[0]["ReqQty"+h]&&parseFloat(C[0]["ReqQty"+h])>0){n=!0;break}if(!n)return this.oComp.SetSelectedColor(C[0],!0),this.oComp.Grid.removeRow(C[0]),this.IsOkClick=!1,void T.d.page.HideDialog(this.PopUpGUID)}}else{if(i<a)return void(this.oComp.ViewModel.DisplayMessage="Quantity should not be less than executed quantity");var s=this.VendorsList.GetselectedItem();if(null!=s&&!c.J0.IsEmpty(s.Aliasname)&&this.oComp.ViewModel.Preferences.ContainsKey("QTNC_MRNQtyCheck")&&"1"==this.oComp.ViewModel.Preferences.QTNC_MRNQtyCheck){let n=i;if(C.length>0)for(let h=0;h<this.oComp.Quotations.length;h++)h.toString()!=this.QTNCol&&null!=C[0]["ReqQty"+h]&&parseFloat(C[0]["ReqQty"+h])>0&&(n+=parseFloat(C[0]["ReqQty"+h]));if(this.MRNQty<n)return void(this.oComp.ViewModel.DisplayMessage="Quantity should not be greater than requisition quantity")}}}this.IsOkClick=!0,T.d.page.HideDialog(this.PopUpGUID)}}}}}]);