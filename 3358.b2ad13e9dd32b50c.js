"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[3358],{33358:(F,B,p)=>{p.r(B),p.d(B,{AddEditBudgetViewModel:()=>H});var u=p(32040),h=p(43767),S=p(54581),m=p(98580),r=p(27730),R=p(84151),f=p(82503),M=p(7321),C=p(21774),T=p(31884),G=p(58941),I=p(60540),P=p(71434),y=p(11592),w=p(81361);class V extends m.g{constructor(){super(...arguments),this.SaveVisible=!0,this.SelectedList=null,this.Dimensions=new r.v4,this.CurrRow=null,this.IsLink=!1,this.linktype=0,this.CostCenterColID=0,this.CallType=null}DocumentListViewModel_1(t,s){this.linktype=s,this.parent=t,this.Dimensions.Visible=!1,this.BudgetField=new r.y$,this.BudgetField.Visible=!1,this.BudgetField.Label="Numeric Field",this.BudgetField.LblWidth="120",this.Fields=new w.o,this.Fields.PactListBoxViewModel_2(new Array),this.Fields.Visible=!1,this.DocumentsWithTree=new r.v4,this.DocumentsWithTree.Visible=!1,this.ReportsWithTree=new r.v4,this.ReportsWithTree.Visible=!1,this.CopyWithLinking=new y.c,this.CopyWithLinking.Visible=!1,this.CopyLayout=new y.c,this.CopyLayout.Visible=!1,this.CopyActions=new y.c,this.CopyActions.Visible=!1,this.ExcludeUnApprovedQty=new y.c,this.ExcludeUnApprovedQty.Visible=!1}DocumentListViewModel_2(t,s,e,i=null,o=0,l=0){if(this.linktype=l,this.IsLink=e,this.parent=s,this.CallType=i,this.CostCenterColID=o,"MultipleCopy"!=i&&(this.Fields=new w.o,this.Fields.PactListBoxViewModel_2(new Array),this.Fields.Visible=!1),null==t||!t.Table.Columns.Contains("Link_Data")||"23821"!=t.Link_Data.toString()&&"50051"!=t.Link_Data.toString()&&"24062"!=t.Link_Data.toString()&&"23820"!=t.Link_Data.toString()&&"55479"!=t.Link_Data.toString())this.Dimensions.Visible=!1;else{this.Dimensions.Visible=!0;let n=t.VoucherXML.toString(),d=[];n.Contains("~")&&(n=n.substr(n.indexOf("~")+1),d=n.split(",")),this.parent.CostCenterDt.forEach(g=>{if(""!=g.Header.toString()){let c=new r.oN;c.Name=g.Header.toString(),c.Value=g.ColumnCostCenterID.toString(),d.Contains(c.Value)&&(c.IsChecked=!0),this.Dimensions.Items.push(c)}})}this.BudgetField=new r.y$,this.BudgetField.Visible=!1,this.BudgetField.Label="Numeric Field",this.BudgetField.LblWidth="120",this.CopyWithLinking=new y.c,this.CopyWithLinking.Visible=!1,this.CopyLayout=new y.c,this.CopyLayout.Visible=!1,this.CopyActions=new y.c,this.CopyActions.Visible=!1,this.ExcludeUnApprovedQty=new y.c,this.ExcludeUnApprovedQty.Visible=!1,this.CurrRow=t,10!=this.linktype&&this.LoadData()}LoadData(){let t="";this.IsLink&&null!=this.CurrRow&&this.CurrRow.Table.Columns.Contains("DocumentList")?t=this.CurrRow.DocumentList.toString():this.IsLink||null==this.CurrRow||!this.CurrRow.Table.Columns.Contains("VoucherXML")||this.CurrRow.VoucherXML.toString().Contains("XML")?null!=this.CurrRow&&this.CurrRow.Table.Columns.Contains("PaymentModes")&&!this.CurrRow.PaymentModes.toString().Contains("XML")&&(t=this.CurrRow.PaymentModes.toString()):(t=this.CurrRow.VoucherXML.toString(),this.Dimensions.Visible&&t.Contains("~")&&(t=t.substr(0,t.indexOf("~"))));let e,s=t.split(",");if(this.Documents=new r.v4,null!=this.CurrRow&&this.CurrRow.Table.Columns.Contains("LinkCostCenterID")&&"2"==this.CurrRow.LinkCostCenterID.toString()&&"DocumentDesignerViewModel"==this.parent.ClassName)this.Documents.Label=" Documents List",this.Title=this.DisplayName=" Documents List",this.parent.CostCenterDt.forEach(l=>{""!=l.Header.toString()&&(e=new r.oN,e.Name=l.Header.toString(),e.Value=l.ColumnCostCenterID.toString(),s.Contains(e.Value)&&(e.IsChecked=!0),this.Documents.Items.push(e))});else if(null!=this.CurrRow&&this.CurrRow.Table.Columns.Contains("FieldType")&&"9"==this.CurrRow.FieldType.toString()&&"DocumentDesignerViewModel"==this.parent.ClassName){this.Documents.Label="Gift voucher types",this.DisplayName="Gift voucher types";var i=u.d.report.DataSet("RPT022","select NodeID,Name from com_lookup WITH(NOLOCK)\n                where lookuptype=70 ");if(null!=i&&i.Tables.length>0&&i.Columns[0].Contains("Name"))for(let l=0;l<i.Tables[0].length;l++){const n=i.Tables[0][l];e=new r.oN,e.Name=n.Name.toString(),e.Value=n.NodeID.toString(),s.Contains(e.Value)&&(e.IsChecked=!0),this.Documents.Items.push(e)}}else if(!this.IsLink&&null!=this.CurrRow&&this.CurrRow.Table.Columns.Contains("ColumnType")&&"-9"==this.CurrRow.ColumnType.toString()&&"DocumentDesignerViewModel"==this.parent.ClassName)this.Documents.Label=" Dimensions List",this.Title=this.DisplayName=" Dimensions List",e=new r.oN,e.Name="Product",e.Value="3",s.Contains(e.Value)&&(e.IsChecked=!0),this.Documents.Items.push(e),this.parent.CostCenterDt.forEach(n=>{""!=n.Header.toString()&&(e=new r.oN,e.Name=n.Header.toString(),e.Value=n.ColumnCostCenterID.toString(),s.Contains(e.Value)&&(e.IsChecked=!0),this.Documents.Items.push(e))});else if("AddEditBudgetViewModel"==this.parent.ClassName){let l=this.parent;if("ShowAccountTypes"==l.PopupCall){this.Documents.Label=" Account Types",this.Title=this.DisplayName=" Account Types";let n=u.d.common.GetDataSet("COM004","");s=l.AccountTypes.DefaultValue.split(","),n.Tables[0].forEach(d=>{e=new r.oN,e.Name=d.AccountType.toString(),e.Value=d.AccountTypeID.toString(),s.Contains(e.Value)&&(e.IsChecked=!0),this.Documents.Items.push(e)})}else{this.Documents.Label=" Documents List",this.Title=this.DisplayName=" Documents List";let n="True";"ShowInvAccountingDocs"==l.PopupCall&&(n="False");let d=u.d.common.GetDataSet("COM005",n);this.BudgetField.Visible=!0,this.BudgetField.Items.push(r._p.ComboBoxItems_2("None","0"));for(let g=1;g<50;g++)this.BudgetField.Items.push(r._p.ComboBoxItems_2("Field "+g,g.toString()));"False"==n?(this.BudgetField.SelectedValue=this.parent.InvAccDocsField,s=this.parent.strInvAccountingDocs.split(",")):(this.BudgetField.SelectedValue=this.parent.NonAccDocsField,s=this.parent.strNonAccountingDocs.split(",")),h.J0.IsEmpty(this.BudgetField.SelectedValue)&&(this.BudgetField.SelectedValue=this.BudgetField.Items[0].Value),d.Tables[0].forEach(g=>{e=new r.oN,e.Name=g.DocumentName.toString(),e.Value=g.CostCenterID.toString(),s.Contains(e.Value)&&(e.IsChecked=!0),this.Documents.Items.push(e)})}}this.DocumentsWithSearch=new w.o,this.DocumentsWithSearch.PactListBoxViewModel_2(this.Documents.Items),this.DocumentsWithSearch.Label="Documents",h.J0.StringIsNullOrEmpty(this.Documents.Label)||(this.DocumentsWithSearch.Label=this.Documents.Label),this.ReportsWithTree=new r.v4,this.DocumentsWithTree=new r.v4,new Array,this.CostCenterColID>0||"MultipleCopy"==this.CallType?(this.Title=this.DisplayName="Copy Field",this.DocumentsWithSearch.Visible=!1,this.CopyWithLinking.Visible=!0,this.CopyActions.Visible=!0,this.CopyLayout.Visible=!0):(this.ReportsWithTree=new r.v4,this.ReportsWithTree.Visible=!1,this.DocumentsWithTree.Visible=!1,"AssignRole"==this.CallType&&"RoleDataViewModel"==this.parent.ClassName&&(this.DocumentsWithSearch.Label=""))}OnSave(t){if("Cancel"==t)u.d.page.HideDialog(this.PopUpGUID);else if("OK"==t){let s="";for(let e=0;e<this.Documents.Items.length;e++)this.Documents.Items[e].IsChecked&&(s.length>0&&(s+=","),s+=this.Documents.Items[e].Value.toString());if("PreferencesViewModel"==this.parent.ClassName){if(4!=this.linktype)if(10==this.linktype){if(null!=this.CurrRow&&this.CurrRow.Table.Columns.Contains("DimFilter")){let e="";for(let i=0;i<this.Dimensions.Items.length;i++)this.Dimensions.Items[i].IsChecked&&(e.length>0&&(e+=","),e+=this.Dimensions.Items[i].Value.toString());this.CurrRow.DimFilter=e}}else null!=this.CurrRow&&this.CurrRow.Table.Columns.Contains("PaymentModes")&&(this.CurrRow.PaymentModes=s)}else if("RoleDataViewModel"==this.parent.ClassName)if("AssignRole"==this.CallType){if(!this.parent.AssignToRoles(s))return}else this.parent.DimensionsList=s;else if("AddEditBudgetViewModel"==this.parent.ClassName){let e=this.parent;if("ShowAccountTypes"==e.PopupCall)e.AccountTypes.DefaultValue=s,e.AccountTypes.Mandatory=e.AccountTypes.DefaultValue.length>0;else{if(e.DisplayMessage="","ShowInvAccountingDocs"==e.PopupCall?e.strInvAccountingDocs=s:e.strNonAccountingDocs=s,s.length>0&&h.J0.IsEmpty(this.BudgetField.SelectedValue)||e.ProductBasedOn.Items[0].IsChecked&&"0"==this.BudgetField.SelectedValue)return void(e.DisplayMessage="Please select field");"ShowInvAccountingDocs"==e.PopupCall?e.InvAccDocsField=this.BudgetField.SelectedValue:e.NonAccDocsField=this.BudgetField.SelectedValue}}u.d.page.HideDialog(this.PopUpGUID)}}}var a=p(96598),L=p(43357),O=p(67700),E=p(89443),N=p(96336);function v(D,t){if(1&D&&(a.j41(0,"div",7),a.EFF(1,"\n                "),a.eu8(2,8),a.EFF(3,"\n            "),a.k0s()),2&D){const s=a.XpG(2);a.R7$(2),a.Y8G("obj",s.obj.BudgetField)("group",s.form)}}function x(D,t){if(1&D&&a.nrm(0,"app-pact-search-list-box",9),2&D){const s=a.XpG(2);a.Y8G("obj",s.obj.DocumentsWithSearch)}}function k(D,t){if(1&D&&(a.j41(0,"div"),a.EFF(1,"\n            "),a.DNE(2,v,4,2,"div",5),a.EFF(3,"\n            "),a.DNE(4,x,1,1,"app-pact-search-list-box",6),a.EFF(5,"\n        "),a.k0s()),2&D){const s=a.XpG();a.R7$(2),a.Y8G("ngIf",s.obj.BudgetField.Visible),a.R7$(2),a.Y8G("ngIf",s.obj.DocumentsWithSearch.Visible)}}function Q(D,t){if(1&D){const s=a.RV6();a.j41(0,"button",10),a.bIt("click",function(){a.eBV(s);const i=a.XpG();return a.Njj(i.obj.OnSave("OK"))}),a.EFF(1),a.nI1(2,"translate"),a.k0s()}2&D&&(a.R7$(),a.JRh(a.bMT(2,1,"Com_OK")))}let A=(()=>{class D{constructor(){}ngOnInit(){}static{this.\u0275fac=function(e){return new(e||D)}}static{this.\u0275cmp=a.VBU({type:D,selectors:[["app-document-list"]],standalone:!1,decls:20,vars:5,consts:[[1,"PACTHeaderFields","row","form-row","dialogSubBody"],[4,"ngIf"],[1,"Pactdailogfooter"],["class","primary-btn-wicon",3,"click",4,"ngIf"],[1,"secondary-btn-wicon",3,"click"],["class","form-group col PACTControl",4,"ngIf"],[3,"obj",4,"ngIf"],[1,"form-group","col","PACTControl"],["FieldDirective","",3,"obj","group"],[3,"obj"],[1,"primary-btn-wicon",3,"click"]],template:function(e,i){1&e&&(a.j41(0,"div"),a.EFF(1,"\n    "),a.j41(2,"div",0),a.EFF(3,"\n        "),a.DNE(4,k,6,2,"div",1),a.EFF(5,"\n    "),a.k0s(),a.EFF(6,"\n    "),a.j41(7,"div",2),a.EFF(8,"\n      "),a.j41(9,"div"),a.EFF(10,"\n        "),a.DNE(11,Q,3,3,"button",3),a.EFF(12,"\n        "),a.j41(13,"button",4),a.bIt("click",function(){return i.obj.OnSave("Cancel")}),a.EFF(14),a.nI1(15,"translate"),a.k0s(),a.EFF(16,"\n      "),a.k0s(),a.EFF(17,"\n    "),a.k0s(),a.EFF(18,"\n"),a.k0s(),a.EFF(19,"\n")),2&e&&(a.R7$(4),a.Y8G("ngIf",i.obj.Documents.Visible),a.R7$(7),a.Y8G("ngIf",i.obj.SaveVisible),a.R7$(3),a.JRh(a.bMT(15,3,"Com_Cancel")))},dependencies:[L.bT,O._,E.f,N.D9],encapsulation:2})}}return D})();class H extends m.g{get dt(){return this.PstBudgetGrid.Table}get dtColumns(){return this.PstBudgetGrid.TableColumns}constructor(t,s,e,i){super(),this.BudgetDefID=0,this.GroupID=0,this.SelectedNodeID=0,this.PopupCall="",this.DataCollection=null,this.timespan=0,this.Label=null,this.Status=new r.y$(0),this.QtyType=new r.y$(0),this.BudgetName=new R.Dw(0),this.BudgetType=new r.y$(0),this.Group=new r.y$(0),this.LeftDimensions=new r.y$(0),this.RightDimensions=new r.y$(0),this.CodeListView=new r.y$(0),this.StartYear=new f.Lc(0),this.lstBasicColumns=new Array,this.CCCount=0,this.PreviousBudgetType=" ",this.CurrentBudgetType=" ",this.IsForeignCurrency=!1,this.IsBudgetFromDocument=!1,this.ConfigVisible=!1,this.BudgetVisible=!1,this.strNonAccountingDocs="",this.NonAccDocsField="",this.strInvAccountingDocs="",this.InvAccDocsField="",this.ChkBudgetOnlyForDefnAccountsObj=new y.c,this.budgetInput=[],this.budgetTable=new Array,this.ClassName="AddEditBudgetViewModel",this.SelectedNodeID=s,this.GroupID=i,this.DataCollection=new P.t,this.BudgetDefID=t,this.DataCollection.isGroup=e,this.AccountTypes=new G.v,this.AccountTypes.DefaultValue="",this.StartYear.Label=u.d.GetResource("Appointment_Date"),this.BudgetType.Label=u.d.GetResource("Budget_BudgetType"),this.BudgetName.Label=u.d.GetResource("Budget_BudgetName"),this.Status.Label=u.d.GetResource("Budget_Status"),this.Group.Label=u.d.GetResource("Budget_Group"),this.ChkBudgetOnlyForDefnAccountsObj.Label="Check budget only for defined accounts",this.QtyType.Label="Type",this.QtyType.LblWidth="60",this.LeftDimensions.OptionsSize=10,this.RightDimensions.OptionsSize=8,this.RightDimensions.SelectionChangedCommand.Subscribe(this,"ListViewSelectionChange","Right"),this.BudgetType.SelectionChangedCommand.Subscribe(this,"OnSelectionChanged"),this.CodeListView.SelectionChangedCommand.Subscribe(this,"ListViewSelectionChange","CodeListViewChanged"),this.CodeListView.LblWidth="0",this.DecimalsinAmount="N"+u.d.SessionManager.Preferences.DecimalsinAmount,this.Status.Items.push(r._p.ComboBoxItems_2(u.d.GetResource("Budget_InActive"),"0")),this.Status.Items.push(r._p.ComboBoxItems_2(u.d.GetResource("Budget_Active"),"1")),this.Status.SelectedValue="1",this.QtyType.Items.push(r._p.ComboBoxItems_2("Both","0")),this.QtyType.Items.push(r._p.ComboBoxItems_2("Only free","1")),this.QtyType.Items.push(r._p.ComboBoxItems_2("Only qty","2")),this.QtyType.SelectedValue="0",this.BudgetType.Items.push(r._p.ComboBoxItems_2(u.d.GetResource("Budget_Annual"),"0")),this.BudgetType.Items.push(r._p.ComboBoxItems_2(u.d.GetResource("Budget_Halfyearely"),"1")),this.BudgetType.Items.push(r._p.ComboBoxItems_2(u.d.GetResource("Budget_Quarterly"),"2")),this.BudgetType.Items.push(r._p.ComboBoxItems_2(u.d.GetResource("Budget_Monthly"),"3")),this.BudgetType.SelectedValue="0",this.ProductBasedOn=new T.Q(""),this.ProductBasedOn.IsHorizontalOrientation=!0,this.ProductBasedOn.Label="Based On",this.ProductBasedOn.Items.push(new T.u("Amount",0)),this.ProductBasedOn.Items[0].Label=u.d.GetResource("DocumentDesigner_Amount"),this.ProductBasedOn.Items[0].IsChecked=!0,this.ProductBasedOn.Items.push(new T.u("Qty",1)),this.ProductBasedOn.Items[1].Label=u.d.GetResource("Packages_Qty"),this.ProductBasedOn.Items.push(new T.u("Value",2)),this.ProductBasedOn.Items[2].Label=u.d.GetResource("Service_Value"),this.ProductBasedOn.Items[0].CheckedChangedCommand.Subscribe(this,"OnQtyCheckedChanged"),this.ProductBasedOn.Items[1].CheckedChangedCommand.Subscribe(this,"OnQtyCheckedChanged"),this.ProductBasedOn.Items[2].CheckedChangedCommand.Subscribe(this,"OnQtyCheckedChanged"),this.ProductBasedOn.Items[0].Group=this.ProductBasedOn,this.ProductBasedOn.Items[1].Group=this.ProductBasedOn,this.ProductBasedOn.Items[2].Group=this.ProductBasedOn,this.ds=this.DataCollection.GetBudgetScreenDetails(0,0),this.Title=u.d.GetResource(e?t>0?"Budget_EditGroup":"Budget_AddGroup":t>0?"Budget_EditBudget":"Budget_AddBudget");for(let o=0;o<=this.ds.Tables[0].length-1;o++)this.LeftDimensions.Items.push(r._p.ComboBoxItems_2(this.ds.Tables[0][o].NAME.toString(),this.ds.Tables[0][o].ID.toString()));if(this.ds.Tables.length>1&&this.ds.Tables[1].length>0){for(let o=0;o<this.ds.Tables[1].length;o++)this.Group.Items.push(r._p.ComboBoxItems_2(this.ds.Tables[1][o].BudgetName.toString(),this.ds.Tables[1][o].BudgetDefID.toString()));this.Group.SelectedValue="1"}this.PstBudgetGrid=new M.vv,this.PstBudgetGrid.Height=0,this.PstBudgetGrid.SearchVisible=!0,this.PstBudgetGrid.IsReadOnly=!0,this.PstBudgetGrid.Width="",this.PstBudgetGrid.Table=[],this.PstBudgetGrid.OnLinkClick.Subscribe(this,"OnGridLinkClick"),this.EntryGrid=new M.vv,this.EntryGrid.Height=80,this.EntryGrid.Width="",this.EntryGrid.Table=[],this.EntryGrid.OnCellEditEnding.Subscribe(this,"OnGridCellEditEnding"),this.EntryGrid.OnLinkClick.Subscribe(this,"OnEntryGridLinkClick"),this.EntryGrid.OnBeginEdit.Subscribe(this,"OnEntryGridBeginEdit"),this.EntryGrid.CanUserDeleteRows=!0,this.InitBasicGrid(),t>0?(this.BudgetVisible=!0,this.ConfigVisible=!1,this.LoadData()):(this.BudgetVisible=!1,this.ConfigVisible=!0)}LoadData(){this.budgetTable.Clear();let t=this.DataCollection.GetBudgetScreenDetails(0,this.BudgetDefID);this.StartYear.Date=h.J0.ParseDate(t.Tables[0][0].StartYear),this.BudgetName.Text=h.J0.String(t.Tables[0][0].BudgetName),this.BudgetType.SelectedValue=h.J0.String(t.Tables[0][0].BudgetTypeID),this.QtyType.SelectedValue=h.J0.String(t.Tables[0][0].QtyType),this.Status.SelectedValue=h.J0.String(t.Tables[0][0].StatusID),this.strNonAccountingDocs=h.J0.String(t.Tables[0][0].NonAccDocs),this.NonAccDocsField=h.J0.String(t.Tables[0][0].NonAccDocsField),this.strInvAccountingDocs=h.J0.String(t.Tables[0][0].InvAccDocs),this.InvAccDocsField=h.J0.String(t.Tables[0][0].InvAccDocsField),this.AccountTypes.DefaultValue=h.J0.String(t.Tables[0][0].AccountTypes),this.AccountTypes.Mandatory=this.AccountTypes.DefaultValue.length>0,this.ChkBudgetOnlyForDefnAccountsObj.IsChecked=(0,S.yG0)(t.Tables[0][0].ChkBudgetOnlyForDefnAccounts),0==parseInt(t.Tables[0][0].QtyBudget)?(this.ProductBasedOn.Items[0].IsChecked=!0,this.ProductBasedOn.Items[1].IsChecked=!1,this.ProductBasedOn.Items[2].IsChecked=!1):1==parseInt(t.Tables[0][0].QtyBudget)?(this.ProductBasedOn.Items[0].IsChecked=!1,this.ProductBasedOn.Items[1].IsChecked=!0,this.ProductBasedOn.Items[2].IsChecked=!1):(this.ProductBasedOn.Items[0].IsChecked=!1,this.ProductBasedOn.Items[1].IsChecked=!1,this.ProductBasedOn.Items[2].IsChecked=!0),this.Group.SelectedValue=this.GroupID.toString(),this.Group.Enable=!1;for(let s=0;s<t.Tables[2].length;s++)for(let e=0;e<this.LeftDimensions.Items.length;e++)h.J0.String(t.Tables[2][s][t.Columns[2][1]])==this.LeftDimensions.Items[e].Value&&(this.RightDimensions.Items.push(this.LeftDimensions.Items[e]),this.LeftDimensions.Items.RemoveAt(e),t.Columns[2].Contains("CCCodeTypeID")&&(this.RightDimensions.Items[this.RightDimensions.Items.length-1].Aliasname=t.Tables[2][s].CCCodeTypeID.toString()));this.IsBudgetFromDocument=t.Tables[3].length>0,this.AddYearColumns(!1);for(let s=0;s<t.Tables[1].length;s++){this.PstBudgetGrid.Table.length-1<=s&&(this.PstBudgetGrid.Table.push(),this.PstBudgetGrid.Table.push(),this.PstBudgetGrid.Table.push());for(let e=0;e<this.RightDimensions.Items.length;e++)"2"==this.RightDimensions.Items[e].Value?this.PstBudgetGrid.Table[s].CC2_Key=t.Tables[1][s].AccountID.toString():"3"==this.RightDimensions.Items[e].Value?this.PstBudgetGrid.Table[s].CC3_Key=t.Tables[1][s].ProductID.toString():this.PstBudgetGrid.Table[s]["CC"+this.RightDimensions.Items[e].Value+"_Key"]=t.Tables[1][s]["CCNID"+(parseInt(this.RightDimensions.Items[e].Value)-5e4)].toString();this.PstBudgetGrid.Table[s].RowID=t.Tables[1][s].BudgetAllocID,this.PstBudgetGrid.Table[s].Action="Edit",this.PstBudgetGrid.Table[s].Delete="Delete",this.PstBudgetGrid.Table[s].CF=t.Tables[1][s].CF,this.PstBudgetGrid.Table[s].Budget=t.Tables[1][s].AnnualAmount,this.PstBudgetGrid.Table[s].Y0=t.Tables[1][s].AnnualAmount,this.PstBudgetGrid.Table[s].H0=t.Tables[1][s].YearH1Amount,this.PstBudgetGrid.Table[s].H1=t.Tables[1][s].YearH2Amount,this.PstBudgetGrid.Table[s].Q0=t.Tables[1][s].Qtr1Amount,this.PstBudgetGrid.Table[s].Q1=t.Tables[1][s].Qtr2Amount,this.PstBudgetGrid.Table[s].Q2=t.Tables[1][s].Qtr3Amount,this.PstBudgetGrid.Table[s].Q3=t.Tables[1][s].Qtr4Amount,this.PstBudgetGrid.Table[s].M0=t.Tables[1][s].Month1Amount,this.PstBudgetGrid.Table[s].M1=t.Tables[1][s].Month2Amount,this.PstBudgetGrid.Table[s].M2=t.Tables[1][s].Month3Amount,this.PstBudgetGrid.Table[s].M3=t.Tables[1][s].Month4Amount,this.PstBudgetGrid.Table[s].M4=t.Tables[1][s].Month5Amount,this.PstBudgetGrid.Table[s].M5=t.Tables[1][s].Month6Amount,this.PstBudgetGrid.Table[s].M6=t.Tables[1][s].Month7Amount,this.PstBudgetGrid.Table[s].M7=t.Tables[1][s].Month8Amount,this.PstBudgetGrid.Table[s].M8=t.Tables[1][s].Month9Amount,this.PstBudgetGrid.Table[s].M9=t.Tables[1][s].Month10Amount,this.PstBudgetGrid.Table[s].M10=t.Tables[1][s].Month11Amount,this.PstBudgetGrid.Table[s].M11=t.Tables[1][s].Month12Amount,this.PstBudgetGrid.Table[s].dcNumField1=t.Tables[1][s].dcNumField1,this.PstBudgetGrid.Table[s].dcNumField2=t.Tables[1][s].dcNumField2,this.PstBudgetGrid.Table[s].dcNumField3=t.Tables[1][s].dcNumField3,this.PstBudgetGrid.Table[s].dcNumField4=t.Tables[1][s].dcNumField4,this.PstBudgetGrid.Table[s].dcNumField5=t.Tables[1][s].dcNumField5,this.PstBudgetGrid.Table[s].Currency_Key=t.Tables[1][s].CurrencyID,this.PstBudgetGrid.Table[s].ExchangeRate=t.Tables[1][s].ExchangeRT,this.PstBudgetGrid.Table[s].Rate=t.Tables[1][s].Rate,this.PstBudgetGrid.Table.length<=2500?(this.ValidateBudgetRow_1(this.PstBudgetGrid.Table[s]),this.PstBudgetGrid.Table[s].Sno=this.budgetTable.length):this.PstBudgetGrid.Table[s].Sno=t.Tables[1][s].RowID}this.PstBudgetGrid.refreshDataView(),console.log(this.PstBudgetGrid.Table),console.log(this.PstBudgetGrid.Columns)}InitBasicGrid(){let t;this.IsForeignCurrency=(0,S.yG0)(u.d.SessionManager.Preferences["Use Foreign Currency"]),this.dtColumns.push("Sno"),this.dtColumns.push("Action"),this.dtColumns.push("Delete"),this.dtColumns.push("RowID"),this.dtColumns.push("CF"),this.dtColumns.push("CF_Key"),this.dtColumns.push("Budget"),this.dtColumns.push("Utilized"),this.dtColumns.push("Balance"),this.dtColumns.push("Currency"),this.dtColumns.push("Currency_Key"),this.dtColumns.push("ExchangeRate"),this.dtColumns.push("Rate"),this.dtColumns.push("Y0"),this.dtColumns.push("H0"),this.dtColumns.push("H1"),this.dtColumns.push("Q0"),this.dtColumns.push("Q1"),this.dtColumns.push("Q2"),this.dtColumns.push("Q3"),this.dtColumns.push("M0"),this.dtColumns.push("M1"),this.dtColumns.push("M2"),this.dtColumns.push("M3"),this.dtColumns.push("M4"),this.dtColumns.push("M5"),this.dtColumns.push("M6"),this.dtColumns.push("M7"),this.dtColumns.push("M8"),this.dtColumns.push("M9"),this.dtColumns.push("M10"),this.dtColumns.push("M11"),this.dtColumns.push("dcNumField1"),this.dtColumns.push("dcNumField2"),this.dtColumns.push("dcNumField3"),this.dtColumns.push("dcNumField4"),this.dtColumns.push("dcNumField5"),t=new C.O7,t.Header=u.d.GetResource("Row No"),t.DisplayMember="Sno",t.DataType="TextBlock",t.IsVisible=!0,t.ReadOnly=!0,t.IsFrozen=!0,t.Width=60,this.lstBasicColumns.push(t),t=new C.O7,t.Header=u.d.GetResource("Service_Action"),t.DisplayMember="Action",t.DataType="LINK",t.ReadOnly=!0,t.IsFrozen=!0,t.Width=50,this.lstBasicColumns.push(t),t=new C.O7,t.Header=u.d.GetResource("Delete"),t.DisplayMember="Delete",t.ID="Delete",t.DataType="LINK",t.IsVisible=!1,t.ReadOnly=!0,t.IsFrozen=!0,t.Width=50,this.lstBasicColumns.push(t),t=new C.O7,t.ID="CF",t.Header="CarryForward",t.DataType="PactComboBox",t.ValueBinding="CF",t.DisplayMember="CF",t.ValueMember="CF_Key",t.Width=100;let s=[];s.push({CF:"",CF_Key:""}),s.push({CF:"Monthly",CF_Key:"M"}),t.ComboData=s,this.lstBasicColumns.push(t),t=new C.O7,t.Header=u.d.GetResource("Budget_Budget"),t.DisplayMember="Budget",t.DataType="FLOAT",t.ReadOnly=!1,t.Width=100,t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount,this.lstBasicColumns.push(t),t=new C.O7,t.Header=u.d.GetResource("Budget_Utilized"),t.DisplayMember="Utilized",t.DataType="FLOAT",t.ReadOnly=!0,t.IsVisible=!1,t.Width=100,t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount,this.lstBasicColumns.push(t),t=new C.O7,t.Header=u.d.GetResource("Budget_Balance"),t.DisplayMember="Balance",t.DataType="FLOAT",t.ReadOnly=!0,t.IsVisible=!1,t.Width=100,t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount,this.lstBasicColumns.push(t),t=new C.O7,t.Header=u.d.GetResource("Budget_Currency"),t.DisplayMember="Currency",t.ValueMember="Currency_Key",t.DataType="LISTBOX",t.CostCenterID=12,t.TypeID=1,t.ReadOnly=!1,t.Width=90,t.IsVisible=this.IsForeignCurrency,this.lstBasicColumns.push(t),t=new C.O7,t.Header=u.d.GetResource("Budget_ExchangeRate"),t.DisplayMember="ExchangeRate",t.DataType="FLOAT",t.ReadOnly=!1,t.Width=70,t.IsVisible=this.IsForeignCurrency,this.lstBasicColumns.push(t),t=new C.O7,t.Header=u.d.GetResource("Inv_CCRate_Rate"),t.DisplayMember="Rate",t.DataType="FLOAT",t.ReadOnly=!1,t.IsVisible=!1,t.Width=70,t.IsVisible=this.IsForeignCurrency,this.lstBasicColumns.push(t);for(let e=1;e<=5;e++){t=new C.O7,t.DisplayMember="dcNumField"+e,t.DataType="FLOAT",t.ReadOnly=!1,t.Width=70;let i=this.ds.Tables[2].filter(o=>o.SysColumnName=="dcNumField"+e);i.length>0?(t.Header=i[0].Caption.toString(),t.IsVisible=!0):t.IsVisible=!1,this.lstBasicColumns.push(t)}for(let e=0;e<45;e++)this.dt.push([])}AddYearColumns(t){let e,i,s=new Array;this.RightDimensions.Items.forEach(l=>{if(this.CCCount++,e=new C.O7,e.Header=u.d.GetResource(l.Name),e.ValueMember="CC"+l.Value+"_Key",e.DisplayMember="CC"+l.Value,this.dtColumns.Contains(e.ValueMember)||(this.dtColumns.push(e.ValueMember),this.dtColumns.push(e.DisplayMember)),e.ReadOnly=!1,e.DataType="LISTBOX",e.CostCenterID=parseInt(l.Value),e.ShowRootDimension=!0,e.Width=120,e.IsFrozen=!0,e.TypeID="2"==l.Value?2:"3"==l.Value?10:1,s.push(e),e.CostCenterID>0&&!h.J0.IsEmpty(l.Aliasname)&&parseInt(l.Aliasname)>0){let n=e.Clone();n.Header=n.Header+"Code",n.TypeID=parseInt(l.Aliasname),n.DisplayMember=n.DisplayMember+"Code",s.push(n),this.dtColumns.Contains(n.DisplayMember)||this.dtColumns.push(n.DisplayMember)}});for(let l=0;l<this.lstBasicColumns.length;l++)l<=2?s.Insert(l,this.lstBasicColumns[l]):s.push(this.lstBasicColumns[l]);"0"==this.BudgetType.SelectedValue?(this.CurrentBudgetType="Y",this.timespan=1):"1"==this.BudgetType.SelectedValue?(this.CurrentBudgetType="H",this.timespan=2):"2"==this.BudgetType.SelectedValue?(this.CurrentBudgetType="Q",this.timespan=4):"3"==this.BudgetType.SelectedValue&&(this.CurrentBudgetType="M",this.timespan=12);for(let l=0;l<this.timespan;l++){e=new C.O7,i=new C.O7,e.DisplayMember=this.CurrentBudgetType.toString()+l,i.DisplayMember="U"+e.DisplayMember,i.DisableTab=!0,i.ID="Util",i.IsVisible=!1,this.dtColumns.Contains(e.DisplayMember)||this.dtColumns.push(i.DisplayMember);let n="";"Y"==this.CurrentBudgetType?n=this.StartYear.Date.getFullYear().toString():"H"==this.CurrentBudgetType?n=l+1+"/"+this.StartYear.Date.getFullYear():"M"==this.CurrentBudgetType?n=this.StartYear.Date.AddMonths(l).ToString("MMM/yyyy"):"Q"==this.CurrentBudgetType&&(n=(l+1+"/"+this.StartYear.Date.getFullYear()).toString()),e.Header=n,i.Header=u.d.GetResource("Budget_Utilized"),e.DecimalPoints=i.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount,e.DataType=i.DataType="FLOAT",e.ReadOnly=i.ReadOnly=!1,e.Width=i.Width=90,s.push(e),"Y"!=this.CurrentBudgetType&&s.push(i)}t&&this.DistrbuteAmounts(),this.PreviousBudgetType=this.CurrentBudgetType;let o=new Array;s.forEach(l=>{let n=new C.O7;n.ID=l.ID,n.Header=l.Header,n.DisplayMember=l.DisplayMember,n.ValueMember=l.ValueMember,n.ValueBinding=l.ValueBinding,n.ComboData=l.ComboData,n.ReadOnly=l.ReadOnly,n.DataType=l.DataType,n.CostCenterID=l.CostCenterID,n.Width=l.Width,n.DecimalPoints=l.DecimalPoints,n.TypeID=l.TypeID,n.ShowRootDimension=!0,n.IsVisible=l.IsVisible,n.IsFrozen=l.IsFrozen,o.push(n),n.ReadOnly||(n.ReadOnly=!0),"Delete"==n.ID?n.IsVisible=!0:"Rate"==n.DisplayMember&&(l.IsVisible=n.IsVisible=this.ProductBasedOn.Items[0].IsChecked)}),this.PstBudgetGrid.Columns=o,this.EntryGrid.Columns=s,this.EntryGrid.Table.Clear(),this.EntryGrid.TableColumns=this.dtColumns,this.IsBudgetFromDocument&&(this.EntryGrid.Columns[1].IsVisible=!1,this.PstBudgetGrid.Columns[1].IsVisible=!1,this.PstBudgetGrid.Columns[2].IsVisible=!1),this.ClearEntryGrid(),this.AccountTypes.Visible=!!this.ProductBasedOn.Items[0].IsChecked&&null==this.RightDimensions.Items.find(l=>"2"==l.Value)}DistrbuteAmounts(){let t=0,s=0,e=0,i=0;"Y"==this.PreviousBudgetType?t=1:"H"==this.PreviousBudgetType?t=2:"Q"==this.PreviousBudgetType?t=4:"M"==this.PreviousBudgetType&&(t=12),"Y"==this.CurrentBudgetType?s=1:"H"==this.CurrentBudgetType?s=2:"Q"==this.CurrentBudgetType?s=4:"M"==this.CurrentBudgetType&&(s=12);let o=0;if(s>t){o=s/t;for(let l=0;l<this.dt.length;l++){let n=this.dt[l];if(""==h.J0.String(n.Budget))break;let d=0;for(let g=0;g<t;g++)for(i=h.J0.Double(n[this.PreviousBudgetType.toString()+g]),e=i/o,e=parseFloat(e.ToString(this.DecimalsinAmount));d<s;)if(n[this.CurrentBudgetType.toString()+d]=e.ToString(this.DecimalsinAmount),d++,d%o==0){n[this.CurrentBudgetType.toString()+(d-1)]=(i-e*(o-1)).ToString(this.DecimalsinAmount);break}}}else{o=t/s;for(let l=0;l<this.dt.length;l++){let n=this.dt[l];if(""==h.J0.String(n.Budget))break;let d=0;for(let g=0;g<s;g++){for(e=0;d<t;){try{e+=parseFloat(n[this.PreviousBudgetType.toString()+d])}catch{}if(d++,d%o==0)break}n[this.CurrentBudgetType.toString()+g]=e}}}}ListViewSelectionChange(t){if("Right"==t.toString()){if(this.RightDimensions.SetSelectedIndex(),-1!=this.RightDimensions.SelectedIndex&&this.RightDimensions.Items.length>0){if(this.CodeListView.Items.Clear(),this.CodeListView.Items.push(r._p.ComboBoxItems_2("","0")),this.ds.Tables.length>3&&this.ds.Tables[3].length>0){let s=this.ds.Tables[3].filter(e=>e.CostCenterID==this.RightDimensions.Items[this.RightDimensions.SelectedIndex].Value);if(null!=s&&s.length>0)for(let e=0;e<s.length;e++)this.CodeListView.Items.push(r._p.ComboBoxItems_2(s[e].ListViewName.toString(),s[e].ListViewTypeID.toString()))}this.CodeListView.SelectedValue=this.RightDimensions.Items[this.RightDimensions.SelectedIndex].Aliasname}}else"CodeListViewChanged"==t.toString()&&(this.RightDimensions.SetSelectedIndex(),-1!=this.RightDimensions.SelectedIndex&&this.RightDimensions.Items.length>0&&(this.RightDimensions.Items[this.RightDimensions.SelectedIndex].Aliasname=this.CodeListView.SelectedValue))}OnSelectionChanged(t){this.AddYearColumns(!0)}OnQtyCheckedChanged(t){this.AddYearColumns(!1)}OnSave(t){if(this.DisplayMessage="","ConfigureOK"==t.toString())this.DisplayMessage="",this.AddYearColumns(!1),this.BudgetVisible=!0,this.ConfigVisible=!1;else if("Configure"==t.toString())this.DisplayMessage="",this.budgetTable.length>0?this.DisplayMessage="Dimensions can not be configured after entering budget data.":(this.BudgetVisible=!1,this.ConfigVisible=!0);else if("Save"==t.toString())this.DataCollection.Budgetid=this.BudgetDefID,this.SaveMethod();else if("SaveAs"==t.toString())this.DataCollection.Budgetid=0,this.SaveMethod();else if("ShowNonAccountingDocs"==t.toString()){this.PopupCall="ShowNonAccountingDocs";let s=new V;s.DocumentListViewModel_2(null,this,!1),u.d.page.ShowDialog(s,A,{ShowCenter:!0,NoWidth:!0})}else if("ShowInvAccountingDocs"==t.toString()){this.PopupCall="ShowInvAccountingDocs";let s=new V;s.DocumentListViewModel_2(null,this,!1),u.d.page.ShowDialog(s,A,{ShowCenter:!0,NoWidth:!0})}else if("ShowAccountTypes"==t.toString()){this.PopupCall="ShowAccountTypes";let s=new V;s.DocumentListViewModel_2(null,this,!1),u.d.page.ShowDialog(s,A,{ShowCenter:!0,NoWidth:!0})}else if("Validate"==t.toString())for(let s=0;s<this.PstBudgetGrid.Table.length;s++)h.J0.IsEmpty(this.PstBudgetGrid.Table[s].Budget)||(this.ValidateBudgetRow_1(this.PstBudgetGrid.Table[s]),this.PstBudgetGrid.Table[s].Sno=this.budgetTable.length)}SaveMethod(){if(this.DataCollection.NumDimensions=0,this.DataCollection.CCList="",h.J0.IsEmptySpace(this.BudgetName.Text))return void(this.DisplayMessage="Enter Budget Name");this.DataCollection.BudgetName=this.BudgetName.Text.Trim(),this.RightDimensions.Items.forEach(i=>{this.DataCollection.NumDimensions++,this.DataCollection.CCList+='<Row CC="'+i.Value+'" CCCodeTypeID="'+(h.J0.IsEmpty(i.Aliasname)?"0":i.Aliasname)+'" />'}),this.DataCollection.CCList.length>0&&(this.DataCollection.CCList="<XML>"+this.DataCollection.CCList+"</XML>");let s,e="";if(!this.IsBudgetFromDocument)for(let i=0;i<this.PstBudgetGrid.Table.length;i++)if(!h.J0.IsEmpty(this.PstBudgetGrid.Table[i].Budget)){let o=0,l=0;if("0"==this.BudgetType.SelectedValue){if(parseFloat(this.dt[i].Budget)!=parseFloat(this.dt[i].Y0))return this.DisplayMessage="Budget not Matched in Row : "+(i+1),void(this.MessageVisibility=!0)}else if("1"==this.BudgetType.SelectedValue){if(parseFloat(this.dt[i].Budget)!=parseFloat(this.dt[i].H0)+parseFloat(this.dt[i].H1))return this.DisplayMessage="Budget not Matched in Row : "+(i+1),void(this.MessageVisibility=!0)}else if("2"==this.BudgetType.SelectedValue){for(let n=0;n<4;n++)o=parseFloat(this.dt[i]["Q"+n]),l+=o;if(parseInt(this.dt[i].Budget)!=l)return this.DisplayMessage="Budget not Matched in Row : "+(i+1),void(this.MessageVisibility=!0)}else if("3"==this.BudgetType.SelectedValue){for(let n=0;n<12;n++)o=parseFloat(this.dt[i]["M"+n]),l+=o;if(Math.abs(parseFloat(this.dt[i].Budget)-l)>.01)return this.DisplayMessage="Budget not Matched in Row : "+(i+1),void(this.MessageVisibility=!0)}e+='<Row Budget="'+this.dt[i].Budget.toString()+'" ',e+=' Sno="'+this.dt[i].Sno.toString()+'" ',e+=' CF="'+h.J0.String(this.dt[i].CF)+'" ',e+=' Utilized="'+h.J0.String(this.dt[i].Utilized)+'" ',e+=' Balance="'+h.J0.String(this.dt[i].Balance)+'" ',e+=' Currency="'+h.J0.String(this.dt[i].Currency_Key)+'" ',e+=' ExchangeRate="'+this.dt[i].ExchangeRate.toString()+'" ',e+=' Rate="'+h.J0.String(this.dt[i].Rate)+'" ',e+="0"!=this.BudgetType.SelectedValue?' AnnualAmount="'+this.dt[i].Budget.toString()+'" ':' AnnualAmount="'+this.dt[i].Y0.toString()+'" ',e+=' YearH1Amount="'+this.dt[i].H0.toString()+'" ',e+=' YearH2Amount="'+this.dt[i].H1.toString()+'" ',e+=' Qtr1Amount="'+this.dt[i].Q0.toString()+'" ',e+=' Qtr2Amount="'+this.dt[i].Q1.toString()+'" ',e+=' Qtr3Amount="'+this.dt[i].Q2.toString()+'" ',e+=' Qtr4Amount="'+this.dt[i].Q3.toString()+'" ',e+=' Month1Amount="'+this.dt[i].M0.toString()+'" ',e+=' Month2Amount="'+this.dt[i].M1.toString()+'" ',e+=' Month3Amount="'+this.dt[i].M2.toString()+'" ',e+=' Month4Amount="'+this.dt[i].M3.toString()+'" ',e+=' Month5Amount="'+this.dt[i].M4.toString()+'" ',e+=' Month6Amount="'+this.dt[i].M5.toString()+'" ',e+=' Month7Amount="'+this.dt[i].M6.toString()+'" ',e+=' Month8Amount="'+this.dt[i].M7.toString()+'" ',e+=' Month9Amount="'+this.dt[i].M8.toString()+'" ',e+=' Month10Amount="'+this.dt[i].M9.toString()+'" ',e+=' Month11Amount="'+this.dt[i].M10.toString()+'" ',e+=' Month12Amount="'+this.dt[i].M11.toString()+'" ',e+=' dcNumField1="'+h.J0.String(this.dt[i].dcNumField1)+'" ',e+=' dcNumField2="'+h.J0.String(this.dt[i].dcNumField2)+'" ',e+=' dcNumField3="'+h.J0.String(this.dt[i].dcNumField3)+'" ',e+=' dcNumField4="'+h.J0.String(this.dt[i].dcNumField4)+'" ',e+=' dcNumField5="'+h.J0.String(this.dt[i].dcNumField5)+'" ',this.RightDimensions.Items.forEach(n=>{e+="2"==n.Value?" AccountID":"3"==n.Value?" ProductID":" CC"+(parseInt(n.Value)-5e4),s=0,s=h.J0.Int(this.PstBudgetGrid.Table[i]["CC"+n.Value+"_Key"]),0==s&&(s=1),e+='="'+s+'"'}),e+="/>"}if(e.length>0||this.IsBudgetFromDocument){this.IsBudgetFromDocument?this.DataCollection.SbXML=null:(e="<XML>"+e+"</XML>",this.DataCollection.SbXML=e.toString()),e="",this.IsBudgetFromDocument||(this.budgetTable.forEach(l=>{l.childSet.forEach(n=>{e+='<Row PID="'+l.rowID+'"',e+=' CID="'+n+'"/>'})}),e.length>0&&(e="<Relations>"+e+"</Relations>")),this.DataCollection.RelationsXML=e.toString(),this.DataCollection.StartYear=this.StartYear.Date,this.DataCollection.BudgetTypeID=parseInt(this.BudgetType.SelectedValue),this.DataCollection.BudgetType=this.BudgetType.Text,this.DataCollection.Status=parseInt(this.Status.SelectedValue),this.DataCollection.IsQtyBudget=this.ProductBasedOn.Items[1].IsChecked?1:this.ProductBasedOn.Items[2].IsChecked?2:0,this.DataCollection.QtyType=h.J0.Int(this.QtyType.SelectedValue),this.DataCollection.ChkBudgetOnlyForDefnAccounts=this.ChkBudgetOnlyForDefnAccountsObj.IsChecked,this.DataCollection.strNonAccountingDocs=this.strNonAccountingDocs,this.DataCollection.NonAccDocsField=this.NonAccDocsField,this.DataCollection.strInvAccountingDocs=this.strInvAccountingDocs,this.DataCollection.InvAccDocsField=this.InvAccDocsField,this.DataCollection.AccountTypes=this.AccountTypes.Visible?this.AccountTypes.DefaultValue:"",this.DataCollection.SelectedNodeID=this.SelectedNodeID;let i=0,o=this.DataCollection.SaveBudgetScreenDetails();this.DisplayMessage=o.Message,i=o.RetValue,i>0&&(this.BudgetDefID=i)}}OnEntryGridBeginEdit(t,s,e){return!!(s.startsWith("CC")&&parseInt(t.Sno)>0)}OnEntryGridLinkClick(t,s,e){if(this.DisplayMessage="","Action"==s&&!h.J0.IsEmpty(t.Budget)){let i=0;for(let d=0;d<this.RightDimensions.Items.length;d++){const g=this.RightDimensions.Items[d];if(i=h.J0.Int(t["CC"+g.Value+"_Key"]),i<=1)return void(this.DisplayMessage="Default Dimension Value can't Define at : "+g.Name)}let o=0,l=0,n=0;if(l=parseFloat(t.Budget),"0"==this.BudgetType.SelectedValue)n=parseFloat(t.Y0);else if("1"==this.BudgetType.SelectedValue)n=parseFloat(t.H0)+parseFloat(t.H1);else if("2"==this.BudgetType.SelectedValue)for(let d=0;d<4;d++)o=parseFloat(t["Q"+d].toString()),n+=o;else if("3"==this.BudgetType.SelectedValue)for(let d=0;d<12;d++)o=parseFloat(t["M"+d].toString()),n+=o;if(n=parseFloat(n.ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount)),l!=n)return void(this.DisplayMessage="Budget not Matched.");if(this.DistrbuteAmounts_dr(t),i=parseInt(this.EntryGrid.Table[0].Sno),this.ValidateBudgetRow_2(t,i),h.J0.IsEmpty(this.DisplayMessage)){let d=null;if(0==i){for(let c=0;c<this.PstBudgetGrid.Table.length;c++)if(h.J0.IsEmpty(this.PstBudgetGrid.Table[c].Sno)){d=this.PstBudgetGrid.Table[c];break}}else for(let c=0;c<this.PstBudgetGrid.Table.length;c++)if(h.J0.String(this.PstBudgetGrid.Table[c].Sno)==h.J0.String(t.Sno)){d=this.PstBudgetGrid.Table[c];break}null==d&&(d=this.PstBudgetGrid.NewRow(),this.PstBudgetGrid.addRow(d));let g=0;g=h.J0.Int(t.Currency_Key),0==g&&(t.Currency_Key=1,t.ExchangeRate=1);for(let c=0;c<this.EntryGrid.TableColumns.length;c++)d[this.EntryGrid.TableColumns[c]]=t[this.EntryGrid.TableColumns[c]];0==i&&(d.Sno=this.budgetTable[this.budgetTable.length-1].rowID),d.Action="Edit",d.Delete="Delete",this.PstBudgetGrid.updateRow(d),this.ClearEntryGrid()}}}EntryGrid_RowDeleted(t,s){let e=this.EntryGrid.NewRow();e.Action="Submit",this.EntryGrid.addRow(e),this.EntryGrid.SelectedIndex=this.EntryGrid.Table.indexOf(e)}OnGridCellEditEnding(t,s,e){let i=0;if("Budget"==s){let o=0;if(i=h.J0.Double(t.Budget),"0"==this.BudgetType.SelectedValue)t.Y0=i;else if("1"==this.BudgetType.SelectedValue)h.J0.IsEmpty(t.H0)||(o=parseFloat(t.H0)),h.J0.IsEmpty(t.H1)||(o+=parseFloat(t.H1)),i!=o&&this.DistributeWithDecimals(t,"H",i,2);else if("2"==this.BudgetType.SelectedValue)h.J0.IsEmpty(t.Q0)||(o=parseFloat(t.Q0)),h.J0.IsEmpty(t.Q1)||(o+=parseFloat(t.Q1)),h.J0.IsEmpty(t.Q2)||(o+=parseFloat(t.Q2)),h.J0.IsEmpty(t.Q3)||(o+=parseFloat(t.Q3)),i!=o&&this.DistributeWithDecimals(t,"Q",i,4);else{for(let l=0;l<12;l++)h.J0.IsEmpty(t["M"+l])||(o+=parseFloat(t["M"+l]));i!=o&&this.DistributeWithDecimals(t,"M",i,12)}this.EntryGrid.updateRow(t)}else if("Y0"==s)t.Budget=t.Y0,this.EntryGrid.updateRow(t);else if("1"==this.BudgetType.SelectedValue&&s.startsWith("H"))h.J0.IsEmpty(t.H0)||(i=parseFloat(t.H0)),h.J0.IsEmpty(t.H1)||(i+=parseFloat(t.H1)),t.Budget=i.ToString(this.DecimalsinAmount),this.EntryGrid.updateRow(t);else if("2"==this.BudgetType.SelectedValue&&s.startsWith("Q"))h.J0.IsEmpty(t.Q0)||(i=parseFloat(t.Q0)),h.J0.IsEmpty(t.Q1)||(i+=parseFloat(t.Q1)),h.J0.IsEmpty(t.Q2)||(i+=parseFloat(t.Q2)),h.J0.IsEmpty(t.Q3)||(i+=parseFloat(t.Q3)),t.Budget=i.ToString(this.DecimalsinAmount),this.EntryGrid.updateRow(t);else if("3"==this.BudgetType.SelectedValue&&s.startsWith("M")){for(let o=0;o<12;o++)h.J0.IsEmpty(t["M"+o])||(i+=parseFloat(t["M"+o]));t.Budget=i.ToString(this.DecimalsinAmount),this.EntryGrid.updateRow(t)}}DistributeWithDecimals(t,s,e,i){let o=0,l=e/i;l=parseFloat(l.ToString(this.DecimalsinAmount));for(let n=0;n<i-1;n++)o+=l,t[s+n]=l.ToString(this.DecimalsinAmount);t[s+(i-1)]=(e-o).ToString(this.DecimalsinAmount)}OnGridLinkClick(t,s,e){if(this.DisplayMessage="","Action"==s){for(let i=0;i<this.EntryGrid.TableColumns.length;i++)this.EntryGrid.Table[0][this.EntryGrid.TableColumns[i]]=t[this.EntryGrid.TableColumns[i]];this.EntryGrid.Table[0].Action="Submit",this.EntryGrid.updateRow(this.EntryGrid.Table[0])}else"Delete"==s&&confirm(u.d.GetResource("DeleteMessage"))&&this.OnDeleteCallBack()}ClearEntryGrid(){this.EntryGrid.Clear(),this.EntryGrid.addEmptyRow(),this.EntryGrid.Table[0].Sno="0",this.EntryGrid.Table[0].Action="Submit",this.EntryGrid.SelectedIndex=0,this.EntryGrid.updateRow(this.EntryGrid.Table[0])}OnDeleteCallBack(){let t=this.PstBudgetGrid.SelectedItem,e_errMsg=(parseInt(t.Sno),"");try{this.inpRow=new I.zd(0,""),this.RightDimensions.Items.forEach(n=>{h.J0.String(t["CC"+n.Value+"_Key"]).length>0&&parseInt(t["CC"+n.Value+"_Key"])>0?this.inpRow.addDimValue(t["CC"+n.Value+"_Key"].toString()):this.inpRow.addDimValue("")}),this.budgetInput.Clear(),this.budgetInput.push(this.inpRow);let o=[];this.myBudget=new I.__(this.budgetTable,this.RightDimensions.Items.length),this.myBudget.deleteBudgetDimRow(this.inpRow,o,e_errMsg)>0?this.DisplayMessage=e_errMsg:(this.ClearEntryGrid(),this.PstBudgetGrid.removeRow(t),this.strTransLog="")}catch(o){throw o}}OnMoveItem(t){switch(t){case"Left":this.LeftDimensions.SetSelectedIndex(),-1!=this.LeftDimensions.SelectedIndex&&(this.RightDimensions.Items.push(this.LeftDimensions.Items[this.LeftDimensions.SelectedIndex]),this.LeftDimensions.Items.RemoveAt(this.LeftDimensions.SelectedIndex));break;case"Right":this.RightDimensions.SetSelectedIndex(),-1!=this.RightDimensions.SelectedIndex&&(this.LeftDimensions.Items.push(this.RightDimensions.Items[this.RightDimensions.SelectedIndex]),this.RightDimensions.Items.RemoveAt(this.RightDimensions.SelectedIndex))}}OnMoveDirection(t){let s=-1;switch(this.RightDimensions.SetSelectedIndex(),t){case"Up":if(0!=this.RightDimensions.SelectedIndex&&-1!=this.RightDimensions.SelectedIndex){s=this.RightDimensions.SelectedIndex;let e=this.RightDimensions.Items[this.RightDimensions.SelectedIndex];this.RightDimensions.Items.RemoveAt(this.RightDimensions.SelectedIndex),this.RightDimensions.Items.Insert(s-1,e),this.RightDimensions.SelectedValue=e.Value}break;case"Down":if(-1!=this.RightDimensions.SelectedIndex&&this.RightDimensions.SelectedIndex<this.RightDimensions.Items.length-1){let e=this.RightDimensions.Items[this.RightDimensions.SelectedIndex];this.RightDimensions.Items.Insert(this.RightDimensions.SelectedIndex+2,e),this.RightDimensions.Items.RemoveAt(this.RightDimensions.SelectedIndex),this.RightDimensions.SelectedValue=e.Value}}}DistrbuteAmounts_dr(t){let s=0,e=0,i=0,o=0,l=null;"Y"==this.CurrentBudgetType?(s=1,l=["M","H","Q"]):"H"==this.CurrentBudgetType?(s=2,l=["M","Y","Q"]):"Q"==this.CurrentBudgetType?(s=4,l=["M","H","Y"]):"M"==this.CurrentBudgetType&&(s=12,l=["Y","H","Q"]);for(let n=0;n<l.length;n++){let d=l[n];"Y"==d?e=1:"H"==d?e=2:"Q"==d?e=4:"M"==d&&(e=12);let g=0;if(e>s){if(g=e/s,""==h.J0.String(t.Budget))return;let c=0;for(let b=0;b<s;b++)for(o=h.J0.Double(t[this.CurrentBudgetType.toString()+b]),i=o/g,i=parseFloat(i.ToString(this.DecimalsinAmount));c<e;)if(t[d.toString()+c]=i.ToString(this.DecimalsinAmount),c++,c%g==0){t[d.toString()+(c-1)]=(o-i*(g-1)).ToString(this.DecimalsinAmount);break}}else{if(g=s/e,""==h.J0.String(t.Budget))return;let c=0;for(let b=0;b<e;b++){for(i=0;c<s;){try{i+=parseFloat(t[this.CurrentBudgetType.toString()+c])}catch{}if(c++,c%g==0)break}t[d.toString()+b]=i}}}}ValidateBudgetRow_1(t){this.ValidateBudgetRow_2(t,0)}ValidateBudgetRow_2(t,s){this.DisplayMessage="";let e=null;s<=0?(e=new I.zd(0,""),e.amount=parseFloat(t.Budget),this.RightDimensions.Items.forEach(o=>{t["CC"+o.Value+"_Key"].toString().length>0?e.addDimValue(t["CC"+o.Value+"_Key"].toString()):e.addDimValue("1")})):(e=new I.zd,e.rowID=s,e.amount=parseFloat(t.Budget),this.RightDimensions.Items.forEach(o=>{t["CC"+o.Value+"_Key"].toString().length>0&&parseInt(t["CC"+o.Value+"_Key"])>1?e.addDimValue(t["CC"+o.Value+"_Key"].toString()):e.addDimValue("")})),this.inpRow=e,this.budgetInput.Clear(),this.budgetInput.push(this.inpRow);let i={errMsg:""};if(this.myBudget=new I.__(this.budgetTable,this.RightDimensions.Items.length),s<=0){let o=[],l=this.myBudget.checkAddBudgetConflicts(this.inpRow,o,i);if(0!=l)return this.DisplayMessage=i.errMsg,this.inpRow.linkedDimRows="",void(this.inpRow.tempLinkedDimRows=0);{let n=1;if(this.budgetTable.length>0&&(n=this.budgetTable[this.budgetTable.length-1].rowID+1),l=this.myBudget.updateDimsRowsWithNewRowId(this.inpRow,o,n),0==l){let d={strTransLog:this.strTransLog};this.myBudget.getTransactionLogSummary(o,d),this.strTransLog=d.strTransLog;let c=new I.zd;c.DimensionRow_1(this.inpRow),c.rowID=n,this.budgetTable.push(c)}}}else{if(this.myBudget.checkEditBudgetConflicts(this.inpRow,i)>0)return void(this.DisplayMessage=i.errMsg);{let l={tmpRow:null};0==this.getDimensionRow(this.inpRow.rowID,l)&&(e=l.tmpRow,this.assignDimRowValues(this.inpRow,e))}}}getDimensionRow(t,s){for(let i=0;i<this.budgetTable.length;i++)if(s.tmpRow=this.budgetTable[i],s.tmpRow.rowID==t)return 0;return 1}assignDimRowValues(t,s){s.rowID=t.rowID,s.amount=t.amount,s.totalAmount=t.totalAmount,s.budgetUsed=t.budgetUsed,s.linkedDimRows=t.linkedDimRows,s.nAnys=t.nAnys,s.nAnysComputed=t.nAnysComputed,s.tempLinkedDimRows=t.tempLinkedDimRows,s.row.Clear();for(let e=0;e<t.row.length;e++)s.row.push(t.row[e])}GetDocsTotal(t,s){let e=0;return t.RowFilter=s,t.forEach(i=>{e+=parseFloat(i.Balance)}),e}}},71434:(F,B,p)=>{p.d(B,{t:()=>h});var u=p(32040);class h{constructor(){this.CCID=0,this.Status=0,this.BudgetTypeID=0,this.BugetID=0,this.NumDimensions=0,this.QtyType=0,this.IsQtyBudget=0,this.isGroup=!1,this.ChkBudgetOnlyForDefnAccounts=!1,this.Budgetid=0,this.SelectedNodeID=0,this.SbXML=null,this.RelationsXML=null,this.BudgetName=null,this.BudgetType=null,this.CCList="",this.strNonAccountingDocs=null,this.NonAccDocsField=null,this.strInvAccountingDocs=null,this.InvAccDocsField=null,this.AccountTypes=null}GetBudgetScreenDetails(m,r,R=""){let f=[];return f.push(m),f.push(r),f.push(R),f.push(u.d.SessionManager.UserID),f.push(u.d.SessionManager.LanguageID),u.d.common.GetBudgetScreenDetails(f)}SaveBudgetScreenDetails(){let m=[];return m.push(this.SbXML),m.push(this.NumDimensions),m.push(this.CCList),m.push(this.RelationsXML),m.push(this.StartYear),m.push(this.BudgetName),m.push(this.BudgetTypeID),m.push(this.BudgetType),m.push(this.Status),m.push(this.IsQtyBudget),m.push(this.Budgetid),m.push(this.SelectedNodeID),m.push(this.isGroup),m.push(this.QtyType),m.push(this.ChkBudgetOnlyForDefnAccounts),m.push(this.strNonAccountingDocs),m.push(this.NonAccDocsField),m.push(this.strInvAccountingDocs),m.push(this.InvAccDocsField),m.push(this.AccountTypes),m.push(u.d.SessionManager.CompanyGUID),m.push(u.d.SessionManager.UserName),m.push(u.d.SessionManager.UserID),m.push(u.d.SessionManager.LanguageID),u.d.common.SaveBudgetScreenDetails(m)}}}}]);