"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[1884,5477,9503],{31884:(b,C,n)=>{n.d(C,{Q:()=>N,u:()=>r});var i=n(58170);class r extends i.MI{constructor(h="",D=0,g=""){super(),this._IsChecked=!1,this.CheckedChangedCommand=new i.Yk,this.DBColumnName=h,this.FeatureID=D,this.GroupName=g}get IsChecked(){return this._IsChecked}set IsChecked(h){"General"==this.GroupName&&this._IsChecked&&h?this._IsChecked=!1:this._IsChecked!=h&&(null!=this.Group&&h&&this.UncheckItems(),this._IsChecked=h)}UncheckItems(){this.Group.Items.forEach(h=>{h.IsChecked&&h!=this&&(h.IsChecked=!1)})}}class N extends i.MI{constructor(h=""){super(),this.IsHorizontalOrientation=!1,this.Items=[],this.Label=h}get CheckedItem(){for(let h=0;h<this.Items.length;h++)if(this.Items[h]._IsChecked)return this._CheckedItem=this.Items[h],this.Items[h];return null}set CheckedItem(h){this._CheckedItem=h}SetSelectedItem(h){for(let D=0;D<this.Items.length;D++)this.Items[D]._IsChecked=this.Items[D].DBColumnName==h}}},67858:(b,C,n)=>{n.r(C),n.d(C,{DocumentFlowChartViewModel:()=>L});var i=n(32040),r=n(43767),N=n(98580),I=n(26336),h=n(27730),D=n(31884),g=n(84151),T=n(61301);class L extends N.g{get DocNumber(){return this._DocNumber}set DocNumber(t){t!=this._DocNumber&&(this._DocNumber=t,this.UpdateVoucherNo())}get VoucherNo(){return this.VoucherNoObj.Text}set VoucherNo(t){this.VoucherNoObj.Text=t}get NodeHeight(){return this.ActualNodeHeight+this.NodePaddingTop}get NodeWidth(){return this.ActualNodeWidth+this.NodePaddingLeft}constructor(t,o,e=0,s=!0){super(),this.dtDocs=null,this.dtDocsDetail=null,this.RootNodes=[],this.lstDocNodes=new I.bT,this.DocsFlowData=[],this.DocsArrowData=[],this.DocsArrowDataTemp=[],this.lstRibbonDocs=new I.G9,this._DocNumber="",this.VoucherNoObj=new g.Dw,this.IsInv=!0,this.IsDialog=!1,this.Width=null,this.Height=null,this.MaxNodeHeight=0,this.arrLevelMax=[],this.ActualNodeHeight=80,this.NodePaddingTop=30,this.NodePaddingLeft=60,this.ActualNodeWidth=140,this.IsLinkFlowCall=!1,this.HideValue=!1,this.HideQty=!1,this.HideDocDate=!1,this.Width="800",this.Height="600",this.VoucherNoObj.SetFocus=!0,this.VoucherNoObj.Label=i.d.GetResource("DFCVoucherNo"),this.ShowData=new D.Q,this.ShowData.GroupName="ShowData",this.ShowData.Items.push(new D.u("Summary",0,"ShowData")),this.ShowData.Items.push(new D.u("Detail",1,"ShowData")),this.ShowData.Items[0].Label=i.d.GetResource("DFCSummary"),this.ShowData.Items[0].Group=this.ShowData,this.ShowData.Items[1].Group=this.ShowData,this.ShowData.Items[1].Label=i.d.GetResource("DFCDetail"),i.d.SessionManager.PersonalSettings.ContainsKey("DocumentFlowShowData")&&"1"==i.d.SessionManager.PersonalSettings.DocumentFlowShowData?this.ShowData.Items[1].IsChecked=!0:this.ShowData.Items[0].IsChecked=!0,this.ShowData.Items[0].CheckedChangedCommand.Subscribe(this,"OnNameCheckedChanged"),this.ShowData.Items[1].CheckedChangedCommand.Subscribe(this,"OnNameCheckedChanged"),this.HideValue=i.d.SessionManager.IsActionAssigned(131,"Hide Value"),this.HideQty=i.d.SessionManager.IsActionAssigned(131,"Hide Qty"),this.HideDocDate=i.d.SessionManager.IsActionAssigned(131,"Hide DocDate"),this.Title="Link Map",this.IsDialog=t,this.VoucherNo=o,this.IsInv=s,this.DocumentType=new h.y$(0),this.DocumentType.Label=i.d.GetResource("Document Type"),this.DocPrefix=new h.y$(0),this.DocPrefix.Label=i.d.GetResource("DocPrefix"),this.DocumentType.SelectionChangedCommand.Subscribe(this,"OnDocumentChange"),this.DocPrefix.SelectionChangedCommand.Subscribe(this,"OnDocPrefix");let c=i.d.report.GetReportData(3,parseInt(i.d.SessionManager.UserID),null);this.DocumentType.Items.push(h._p.ComboBoxItems_2("","0")),null!=c&&(c.Tables[0].forEach(d=>{this.DocumentType.Items.push(h._p.ComboBoxItems_3(d[c.Columns[0][1]].toString(),d[c.Columns[0][0]].toString(),d.DocumentAbbr.toString()))}),e>0&&(this.DocumentType.SelectedValue=e.toString())),r.J0.IsEmpty(o)||this.ConstructTree()}OnNameCheckedChanged(t){r.J0.SetPersonalize("DocumentFlowShowData",this.ShowData.Items[1].IsChecked?"1":"0"),this.OnButtonClick("Submit")}OnDocumentChange(t){!r.J0.IsEmpty(this.DocumentType.SelectedValue)&&parseInt(this.DocumentType.SelectedValue)>0&&(this.DocPrefix.Items.Clear(),i.d.common.GetDataSet("DOC048",this.DocumentType.SelectedValue).Tables[0].forEach(e=>{this.DocPrefix.Items.push(h._p.ComboBoxItems_3(e.CodePrefix.toString(),e.CodePrefix.toString(),e.CurrentCodeNumber.toString()))}),this.DocNumber=""),this.UpdateVoucherNo()}OnDocPrefix(t){this.DocNumber=null==this.DocPrefix.SelectedItem||r.J0.IsEmpty(this.DocPrefix.SelectedItem.Parent)?"":this.DocPrefix.SelectedItem.Parent,this.UpdateVoucherNo()}UpdateVoucherNo(){let t="";!r.J0.IsEmpty(this.DocumentType.SelectedValue)&&parseInt(this.DocumentType.SelectedValue)>0&&(t=this.DocumentType.SelectedItem.Parent+"-",r.J0.IsEmpty(this.DocPrefix.SelectedValue)||(t+=this.DocPrefix.SelectedValue),r.J0.IsEmpty(this.DocNumber)||(t+=this.DocNumber)),this.VoucherNo=t}OnButtonClick(t){if(this.DisplayMessage="","Submit"==t){if(r.J0.IsEmpty(this.VoucherNo))return void(this.DisplayMessage="Enter Voucher No");this.ActualNodeWidth=140,this.ConstructTree()}else if("LinkFlow"==t){if(null==this.DocumentType.SelectedValue)return void(this.DisplayMessage="Select Document Type");this.ConstructTree(!0)}else"Close"==t&&i.d.page.HideDialog(this.PopUpGUID)}OnDocumentClick(t){if(this.DisplayMessage="",1!==i.d.SessionManager.DonotAllowDataEntry&&!r.J0.IsEmpty(t)){i.d.page.ShowLoading=!0;let o=i.d.report.GetDocumentDetailsByVoucherNo(t);if(r.J0.Int(o.obj)>0){let s;s=o.Tables[0].length>0?o.Tables[0][0]:o.Tables[1][0],T.RibbonExtViewModel.LoadDocument(s),this.IsDialog&&i.d.page.HideDialog(this.PopUpGUID)}else this.DisplayMessage="Document not found";i.d.page.ShowLoading=!1}}OnDocumentDefClick(t){}ConstructTree(t=!1){let o;if(this.DocsArrowData.Clear(),this.DocsArrowDataTemp.Clear(),this.arrLevelMax.Clear(),this.lstDocNodes.Clear(),this.RootNodes.Clear(),this.lstRibbonDocs.Clear(),this.IsLinkFlowCall=t,t)i.d.SessionManager.MenuTabs.forEach(a=>{a.Groups.forEach(l=>{for(let u=0;u<l.Items.length;u++){let m=l.Items[u];m.FeatureID>4e4&&m.FeatureID<5e4&&!this.lstRibbonDocs.keys.Contains(m.FeatureID)&&this.lstRibbonDocs.push(m.FeatureID,m)}})}),this.TempDVNode=new Array,o=i.d.report.GetDocsLinkTree(this.DocumentType.SelectedValue,this.ShowData.Items[0].IsChecked?1:0,this.IsInv);else{let a;this.TempVNode=[],a=this.VoucherNo.startsWith("LINEID:")?this.VoucherNo.split("~"):[this.VoucherNo],o=i.d.report.GetDocsLinkTree(a[0],this.ShowData.Items[0].IsChecked?1:0,this.IsInv),a.length>1&&(this.VoucherNo=a[1]),o.Tables.length>2&&o.Columns[2].Contains("BWDocNo")&&o.Tables[2].forEach(l=>{let u={CostCenterID:0};u.VoucherNo=l.BWDocNo,u.ParentVoucherNo=l.ParentVoucherNo,u.DocDate=l.DocDate,o.Tables[0].push(u)})}if(0==o.Tables.length)return;this.dtDocs=o.Tables[0],this.dtDocsDetail=o.Tables[1];let e=o.Tables[0].filter(a=>null==a.ParentVoucherNo||"-1"==a.ParentVoucherNo||""==a.ParentVoucherNo);if(this.arrLevelMax.push(0),o.Columns[0].Contains("DocDate"),e.forEach(a=>{let l=this.GetNode(a,0);l&&(this.RootNodes.push(l),this.AddChildren(l))}),this.lstDocNodes.length>0)if(t)(c=this.lstDocNodes.values.find(a=>a.CostCenterID==parseInt(this.DocumentType.SelectedValue)))&&(c.ForeColor="Red");else{var c;(c=this.lstDocNodes.values.find(l=>l.DocNo.toString().toLowerCase()==this.VoucherNo.toLowerCase()))&&(c.ForeColor="Red")}this.arrLevelMax[0]=this.RootNodes.length,this.MaxNodeHeight=Math.max(...this.arrLevelMax)*this.NodeHeight,this.RootNodes.forEach(a=>{a.Top=this.MaxNodeHeight/(this.arrLevelMax[0]+1)-this.NodeHeight;let l=this.MaxNodeHeight/this.arrLevelMax[a.Level];a.Top=l*(a.LevelIndex+1)-((l-this.ActualNodeHeight)/2+this.ActualNodeHeight),a.Margin="0,"+a.Top.toString()+",0,0",this.AssignMargin(a)});let d=[];t?this.TempDVNode.forEach(a=>{d.push(a)}):this.TempVNode.forEach(a=>{d.push(a)}),this.DocsFlowData=d;let V=[];V.AddRange(this.DocsArrowData),this.DocsArrowDataTemp.push(V)}GetNode(t,o){if(this.lstDocNodes.ContainsKey(t.VoucherNo.toString()))return null;let e=new S;if(e.DocNo=t.VoucherNo.toString(),e.CostCenterID=parseInt(t.CostCenterID),this.IsLinkFlowCall)e=new w,e.DocNo=t.VoucherNo.toString(),e.CostCenterID=parseInt(t.CostCenterID),this.lstRibbonDocs.keys.Contains(e.CostCenterID)?e.SmallImage=this.lstRibbonDocs[e.CostCenterID].SmallImage:(e.BtnBorderColor="Gray",e.IsEnable=!1);else{e=new S,e.DocNo=t.VoucherNo.toString(),e.CostCenterID=parseInt(t.CostCenterID),!this.HideDocDate&&null!=t.DocDate&&(e.DocDate=r.J0.ParseDate(t.DocDate).ToString(i.d.SessionManager.Preferences["Date Format"]));let s=this.dtDocsDetail.filter(c=>c.VoucherNo==e.DocNo);s.length>0&&(!this.HideQty&&null!=s[0].Qty&&(e.Qty=parseFloat(s[0].Qty).Commas("N"+i.d.SessionManager.Preferences.DecimalsinQty)),!this.HideValue&&null!=s[0].Value&&(e.Value=parseFloat(s[0].Value).Commas("N"+i.d.SessionManager.Preferences.DecimalsinAmount)))}return this.lstDocNodes.push(t.VoucherNo.toString(),e),this.ActualNodeWidth/t.VoucherNo.toString().length<7&&(this.ActualNodeWidth=3+7*t.VoucherNo.toString().length),e.Width=this.ActualNodeWidth,e.Height=this.ActualNodeHeight,e.Level=o,this.arrLevelMax.length<=e.Level&&this.arrLevelMax.push(0),e.LevelIndex=this.arrLevelMax[e.Level],this.arrLevelMax[e.Level]++,this.IsLinkFlowCall?this.TempDVNode.push(e):this.TempVNode.push(e),e}AddChildren(t){this.dtDocs.filter(o=>o.ParentVoucherNo==t.DocNo).forEach(o=>{let e=o.VoucherNo.toString();if(this.lstDocNodes.ContainsKey(e))t.Children.find(s=>s.DocNo==e)||t.Children.push(this.lstDocNodes[e]);else{let s=this.GetNode(o,t.Level+1);null!=s&&(t.Children.push(s),this.AddChildren(s))}})}AssignMargin(t){for(let o=0;o<t.Children.length;o++){let e=t.Children[o];if(!e.IsRead){e.IsRead=!0,e.Left=e.Level*this.NodeWidth;let s=this.MaxNodeHeight/this.arrLevelMax[e.Level];e.Top=s*(e.LevelIndex+1)-((s-this.ActualNodeHeight)/2+this.ActualNodeHeight),e.Margin=e.Left+","+e.Top.toString()+",0,0",this.AssignMargin(e)}if(!this.DocsArrowData.find(s=>s.FromDocNo==t.DocNo&&s.ToDocNo==e.DocNo)){let s=new M;s.FromDocNo=t.DocNo,s.ToDocNo=e.DocNo,s.X1=t.Left,t.Left<e.Left&&(s.X1+=this.ActualNodeWidth),s.Y1=t.Top+this.ActualNodeHeight/2,s.X2=e.Left,e.Left<t.Left&&(s.X2+=this.ActualNodeWidth),s.Y2=e.Top+this.ActualNodeHeight/2,this.IsLinkFlowCall?null!=this.DocumentType.SelectedValue&&t.CostCenterID==parseInt(this.DocumentType.SelectedValue)&&(s.Stroke="Red"):(r.J0.LowerCase(t.DocNo)==r.J0.LowerCase(this.VoucherNo)||r.J0.LowerCase(e.DocNo)==r.J0.LowerCase(this.VoucherNo))&&(s.Stroke="Red"),this.DocsArrowData.push(s)}}}}class p extends N.g{constructor(){super(...arguments),this.CostCenterID=0,this.Level=0,this.Order=0,this.Parent=null,this.Children=[],this.Top=0,this.Left=0,this.LevelIndex=0,this.IsRead=!1,this.Margin="0px 0px 0px 0px",this.ForeColor="Black",this.Width=0,this.Height=0}}class S extends p{get DocDateLbl(){return r.J0.IsEmpty(this.DocDate)?"":"DocDate :"}get QtyLbl(){return r.J0.IsEmpty(this.Qty)?"":"Qty :"}get ValueLbl(){return r.J0.IsEmpty(this.Value)?"":"Value :"}get ToolTip(){return""!=this.QtyLbl?"Doc No: "+this.DocNo+"\r\nQty: "+this.Qty+"\r\nValue: "+this.Value:"Doc No: "+this.DocNo}}class w extends p{constructor(){super(),this.IsEnable=!1,this.IsEnable=!0,this.BtnBorderColor="Orange"}}class M{constructor(){this.X1=0,this.X2=0,this.Y1=0,this.Y2=0,this.Stroke="#000"}}}}]);