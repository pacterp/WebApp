"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[1884,2209,9503],{5264:(q,Y,D)=>{D.d(Y,{n:()=>J});var g=D(32040),C=D(43767),o=D(27730),H=D(17970),L=D(84151),w=D(82503),Q=D(23458),j=D(11592);class J{get ShowColumn(){return this.ShowColumnObj.IsChecked}set ShowColumn(E){this.ShowColumnObj.IsChecked=E}constructor(){this.ShowColumnObj=new j.c,this.CheckBoxVisibility=!0,this.ReOrder=null,this.LstFilter=null,this.ReportViewModel=null,this.ViewFilterVM=null,this.LockCheckedChanged=!1}PostDataField_1(E,N){"ReportViewModel"==N.ClassName?this.ReportViewModel=N:"ReOrderLevelNewViewModel"==N.ClassName?this.ReOrder=N:"FilterDialogViewModel"==N.ClassName?this.LstFilter=N:this.ViewFilterVM=null!=N.oViewModel&&"TreeViewModel"==N.oViewModel.TreeViewModel.name?N.oViewModel:N.objParent,this.ShowColumnObj.CheckedChangedCommand.Subscribe(N,"onColumnCheckedChanged",this),this.DataType=E.ColumnType,this.ColumnName=E.ID,this.Header=E.HeaderText,this.ShowColumn=!0,this.CheckBoxVisibility=!0,this.Condition=new o.y$(0),this.FromValue=new H.e3(0),this.ToValue=new L.Dw(0),this.FromDate=new w.Lc(0),this.ToDate=new w.Lc(0),this.FromDateTime=new w.Lc(0),this.ToDateTime=new w.Lc(0),this.FromDropDown=new o.v4,this.FromList=new Q.y$(0),this.ToList=new Q.y$(0),this.Condition.LblWidth="80",this.FromValue.LblWidth=this.FromValue.TextBox.LblWidth="80",this.ToValue.LblWidth="80",this.FromDate.LblWidth="80",this.ToDate.LblWidth="80",this.FromDropDown.LblWidth="80",this.FromList.LblWidth="80",this.ToList.LblWidth="80",this.Condition.Label=g.d.GetResource("Reports_Condition"),this.FromValue.Label=this.FromValue.TextBox.Label=g.d.GetResource("Reports_FromValue"),this.ToValue.Label=g.d.GetResource("Reports_ToValue"),this.FromDate.Label=g.d.GetResource("Reports_FromValue"),this.ToDate.Label=g.d.GetResource("Reports_ToValue"),this.FromDateTime.Label=g.d.GetResource("Reports_FromValue"),this.ToDateTime.Label=g.d.GetResource("Reports_ToValue"),this.LoadConditions(this.DataType),this.Condition.SelectionChangedCommand.Subscribe(this,"OnConditionChange"),this.FromDropDown.CheckedChangedCommand.Subscribe(this,"OnCheckedChanged"),this.FromValue.Visible=!1,this.ToValue.Visible=!1,this.FromDate.Visible=!1,this.ToDate.Visible=!1,this.FromDateTime.Visible=!1,this.ToDateTime.Visible=!1,this.FromDropDown.Visible=!1,this.FromList.Visible=!1,this.ToList.Visible=!1,"INT"!=this.DataType&&"DATE"!=this.DataType&&"TIME"!=this.DataType&&"FLOAT"!=this.DataType&&(this.FromDropDown.DataType="TEXT")}PostDataField_2(E){this.DataType=E.CDGDO.DataType,this.ColumnName=E.CDGDO.CategoryText,this.Header=E.Caption.Text,this.ShowColumn=!0,this.CheckBoxVisibility=!1,this.FromDropDown=new o.v4,this.FromDropDown.Visible=!1,this.Condition=E.Condition,this.FromValue=E.FromValue,this.ToValue=E.ToValue,this.FromDate=E.FromDatePicker,this.ToDate=E.ToDatePicker,this.FromDateTime=E.FromDateTimePicker,this.ToDateTime=E.ToDateTimePicker,this.FromList=E.FromList,this.ToList=E.ToList,E.OnConditionSelectionChanged(this.Condition.SelectedValue)}OnConditionChange(E){if(null==this.ReportViewModel?.DocsLanding)if(this.FromDropDown.Label=this.FromDate.Label=this.FromValue.Label=this.FromValue.TextBox.Label=g.d.GetResource("Service_Value"),this.FromValue.Visible=!1,this.ToValue.Visible=!1,this.FromDate.Visible=!1,this.ToDate.Visible=!1,this.FromDateTime.Visible=!1,this.ToDateTime.Visible=!1,this.FromDropDown.Visible=!1,"DATE"==this.DataType)"Between"==this.Condition.SelectedValue||"NotBetween"==this.Condition.SelectedValue?(this.FromDate.Visible=!0,this.ToDate.Visible=!0,this.FromDate.Label=g.d.GetResource("Reports_FromValue")):"None"!=this.Condition.SelectedValue&&(this.FromDate.Visible=!0);else if("TIME"==this.DataType)this.FromDateTime.ShowTimePicker=!0,this.ToDateTime.ShowTimePicker=!0,this.FromDateTime.CustomFormat="hh:mm:ss tt",this.ToDateTime.CustomFormat="hh:mm:ss tt","Between"==this.Condition.SelectedValue||"NotBetween"==this.Condition.SelectedValue?(this.FromDateTime.Visible=!0,this.ToDateTime.Visible=!0,this.FromDateTime.Label=g.d.GetResource("Reports_FromValue")):"None"!=this.Condition.SelectedValue&&(this.FromDateTime.Visible=!0);else if("Between"==this.Condition.SelectedValue||"NotBetween"==this.Condition.SelectedValue)this.FromValue.Visible=!0,this.ToValue.Visible=!0,this.FromValue.TextBox.Label=g.d.GetResource("Reports_FromValue");else if("Equal"==this.Condition.SelectedValue||"NotEqual"==this.Condition.SelectedValue)if("TEXT"==this.FromDropDown.DataType){if(this.FromDropDown.Visible=!0,0==this.FromDropDown.Items.length)if(this.FromDropDown.Items.push(o.oN.CheckedListBoxItem_2("ALL",!0)),this.FromDropDown.SelectedValue="ALL",null!=this.ReportViewModel&&null!=this.ReportViewModel.ReportData&&this.ReportViewModel.ReportData.length>0){if(this.ReportViewModel.ReportDataColumns.Contains(this.ColumnName)){let N;N=null!=this.ReportViewModel.PostFilterData?this.ReportViewModel.PostFilterData.ToTable(!0,[this.ColumnName]):this.ReportViewModel.ReportData.ToTable(!0,[this.ColumnName]),N.forEach(x=>{this.FromDropDown.Items.push(o.oN.CheckedListBoxItem_2(C.J0.String(x[this.ColumnName]),!0))})}}else if(null!=this.ReportViewModel){for(let N=0;N<this.ReportViewModel.ReportColumns.length;N++)if(this.ReportViewModel.ReportColumns[N].ID==this.ColumnName){let x=[];this.ReportViewModel.Data.forEach(W=>{null!=W.Cells[N].Text&&(x.Contains(W.Cells[N].Text)||(x.push(W.Cells[N].Text),this.FromDropDown.Items.push(o.oN.CheckedListBoxItem_2(W.Cells[N].Text,!0))))});break}}else if(null!=this.ReOrder&&null!=this.ReOrder.ReOrderGrid.Table)this.ReOrder.ReOrderGrid.Table.Columns.Contains(this.ColumnName)&&this.ReOrder.ReOrderGrid.Table.DefaultView.ToTable(!0,[this.ColumnName]).forEach(x=>{this.FromDropDown.Items.push(o.oN.CheckedListBoxItem_2(C.J0.String(x[this.ColumnName]),!0))});else if(null!=this.ViewFilterVM){let N=null;null!=this.ViewFilterVM.Data?this.ViewFilterVM.DataColumns.Contains(this.ColumnName)&&(N=this.ViewFilterVM.Data.ToTable(!0,[this.ColumnName])):this.ViewFilterVM.PstDocGrid.TableColumns.Contains(this.ColumnName)&&(N=this.ViewFilterVM.PstDocGrid.Table.ToTable(!0,[this.ColumnName])),N.forEach(x=>{this.FromDropDown.Items.push(o.oN.CheckedListBoxItem_2(C.J0.String(x[this.ColumnName]),!0))})}}else this.FromValue.Visible=!0;else"None"!=this.Condition.SelectedValue&&(this.FromValue.Visible=!0);else this.OnConditionChange_DocumentsList(E)}OnConditionChange_DocumentsList(E){this.FromDropDown.Label=this.FromList.Label=this.FromDate.Label=this.FromValue.Label=this.FromValue.TextBox.Label=g.d.GetResource("Service_Value"),this.FromValue.Visible=!1,this.ToValue.Visible=!1,this.FromDate.Visible=!1,this.ToDate.Visible=!1,this.FromDropDown.Visible=!1,this.FromList.Visible=!1,"DATE"==this.DataType?"Between"==this.Condition.SelectedValue||"NotBetween"==this.Condition.SelectedValue?(this.FromDate.Visible=!0,this.ToDate.Visible=!0,this.FromDate.Label=g.d.GetResource("Reports_FromValue")):"None"!=this.Condition.SelectedValue&&(this.FromDate.Visible=!0):"Between"==this.Condition.SelectedValue||"NotBetween"==this.Condition.SelectedValue?(this.FromValue.Visible=!0,this.ToValue.Visible=!0,this.FromValue.TextBox.Label=g.d.GetResource("Reports_FromValue")):"Equal"==this.Condition.SelectedValue||"NotEqual"==this.Condition.SelectedValue?"TEXT"==this.FromDropDown.DataType?this.FromList.Visible=!0:this.FromValue.Visible=!0:"None"!=this.Condition.SelectedValue&&(this.FromValue.Visible=!0)}LoadConditions(E){this.Condition.Items.Clear(),!C.J0.IsEmpty(E)&&"INT"==E.toUpperCase()||"FLOAT"==E.toUpperCase()||"DATE"==E.toUpperCase()||"TIME"==E.toUpperCase()?(this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_None"),"None","")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_Between"),"Between"," BETWEEN ")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_NotBetween"),"NotBetween"," NOT BETWEEN ")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_Equal"),"Equal","=")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_NotEqual"),"NotEqual","<>")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_Lessthan"),"Lessthan","<")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_LessthanOrEqual"),"LessthanOrEqual","<=")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_Greaterthan"),"Greaterthan",">")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_GreaterthanOrEqual"),"Greaterthan Or Equal",">=")),this.Condition.SelectedValue="None"):(this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_None"),"None","")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_Between"),"Between"," BETWEEN ")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_NotBetween"),"NotBetween"," NOT BETWEEN ")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Com_Contains"),"Contains"," LIKE ")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_NotContain"),"NotContain"," NOT LIKE ")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_Equal"),"Equal","=")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Reports_NotEqual"),"NotEqual","<>")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Com_BeginsWith"),"BeginsWith","BeginsWith")),this.Condition.Items.push(o._p.ComboBoxItems_3(g.d.GetResource("Com_EndsWith"),"EndsWith","EndsWith")),this.Condition.SelectedValue="None")}OnCheckedChanged(E){if(!this.LockCheckedChanged&&E.item instanceof o.oN){let N=E.item;if("ALL"==N.Value){if(this.LockCheckedChanged=!0,this.FromDropDown.Items.length>0)for(let x=1;x<this.FromDropDown.Items.length;x++)this.FromDropDown.Items[x].IsChecked=N.IsChecked;this.LockCheckedChanged=!1}else{if(this.LockCheckedChanged=!0,this.FromDropDown.Items.length>0)if(N.IsChecked){this.FromDropDown.Items[0].IsChecked=!0;for(let x=1;x<this.FromDropDown.Items.length;x++)if(!this.FromDropDown.Items[x].IsChecked){this.FromDropDown.Items[0].IsChecked=!1;break}}else this.FromDropDown.Items[0].IsChecked=!1;this.LockCheckedChanged=!1}this.LockCheckedChanged=!1}}Clear(){this.Condition.SelectedValue="None",this.FromValue.TextBox.Text="",this.ToValue.Text="",this.FromDropDown.Items.Clear()}}},31884:(q,Y,D)=>{D.d(Y,{Q:()=>o,u:()=>C});var g=D(58170);class C extends g.MI{constructor(L="",w=0,Q=""){super(),this._IsChecked=!1,this.CheckedChangedCommand=new g.Yk,this.DBColumnName=L,this.FeatureID=w,this.GroupName=Q}get IsChecked(){return this._IsChecked}set IsChecked(L){"General"==this.GroupName&&this._IsChecked&&L?this._IsChecked=!1:this._IsChecked!=L&&(null!=this.Group&&L&&this.UncheckItems(),this._IsChecked=L)}UncheckItems(){this.Group.Items.forEach(L=>{L.IsChecked&&L!=this&&(L.IsChecked=!1)})}}class o extends g.MI{constructor(L=""){super(),this.IsHorizontalOrientation=!1,this.Items=[],this.Label=L}get CheckedItem(){for(let L=0;L<this.Items.length;L++)if(this.Items[L]._IsChecked)return this._CheckedItem=this.Items[L],this.Items[L];return null}set CheckedItem(L){this._CheckedItem=L}SetSelectedItem(L){for(let w=0;w<this.Items.length;w++)this.Items[w]._IsChecked=this.Items[w].DBColumnName==L}}},44590:(q,Y,D)=>{D.r(Y),D.d(Y,{PrefetchReportCells:()=>le,ReOrderLevelNewViewModel:()=>re});var g=D(74523),C=D(32040),o=D(43767),H=D(26336),L=D(33784),w=D(27730),Q=D(58170),j=D(23458),J=D(62099),ee=D(69883),E=D(21774),N=D(5264),x=D(7321),W=D(84151),X=D(82503),k=D(89731),te=D(72247),ie=D(26903),z=D(31884),se=D(54047),oe=D(17970),Z=D(61301);class le{constructor(){this.ROColID=null,this.Type=null,this.indReport=0,this.value=null,this.IsDimension=!1,this.DimensionID=1}}var v=function(_){return _[_.None=0]="None",_[_.BOM=1]="BOM",_[_.RawMaterial=2]="RawMaterial",_[_.FinishedProduct=3]="FinishedProduct",_}(v||{});class re extends L.d{get GridVisibility(){return this._GridVisibility}set GridVisibility(s){this._GridVisibility=s,this.BOMGrid&&this.BOMGrid.Visible&&setTimeout(()=>{this.BOMGrid.refreshUI()},200)}get Table(){return this.ReOrderGrid.Table}constructor(s,e,t){super(),this.ButtonsVisibility=!0,this._GridVisibility=!1,this.ShowAutoPost=!1,this.FilterVisibility=!1,this.ShowPostFilter=!1,this.ColumnsSource=null,this.RecordCount="",this.AutoPostMessage="",this.DateFilter="",this.ProfileName="",this.ShowBOMProducts=v.None,this.ProductsByVoucher=!1,this.ProductsByVoucher_Temp=!1,this.ProductsByRowSelection=!1,this.IsKitProjection=!1,this.DocumentVisibility=!1,this.AllowToAdd=!1,this.IsNew=!0,this.DialogAction=null,this.Documents=new w.y$(0),this.TreeVisibility=!0,this.SalesFilterVisible=!1,this.AvgSaleByTrMn=!1,this.BOMGridWithReport=!1,this.Slot1=new W.Dw(0),this.Slot2=new W.Dw(0),this.Slot3=new W.Dw(0),this.SalesForeCastDays=new W.Dw(0),this.ToDateFilter=new X.Lc(0),this.FromDate=new X.Lc(0),this.ToDate=new X.Lc(0),this.colAvgSales=null,this.colReOrderQty=null,this.colOrderQty=null,this.colVendor=null,this.colUOM=null,this.DWPCProfile=null,this.xDocPref=new o.VB,this.ExpectedQTY1="",this.ExpectedQTY2="",this.ExpectedQTY3="",this.CommitedQTY1="",this.CommitedQTY2="",this.CommitedQTY3="",this.SalesDocs="",this.BatchPreExpiry="",this.lstBatchExpirySlabs=new Array,this.drReport=null,this.DimensionFilter=null,this.LocationCols=new H.bT,this.totalALL=new H.bT,this.totalSELECTED=new H.bT,this.SelectedLocations="",this.SelectedAvgLocations="",this.SelectedReOrderLocations="",this.SelectTag="",this.FromTag="",this.ReportID=112,this.worker=new Q.dp,this.dsReportDefn=null,this.dtPCProfile=null,this.strHiddenFields="",this.DefaultSortColumn="",this.SalesCostColumn="",this.SalesValueColumn="",this.DontIncludeExpiredProducts=!1,this.DontIncludePreExpiryProducts=!1,this.ExpiryPickFromProduct=!1,this.IsReportDB=!1,this.HidePrefetch=!1,this.ReorderDimension=0,this.PreExpiryProductDays=0,this.JOBDimension=0,this.DocumentMappingColumns=new Array,this.lstSaleSlots=new H.bT,this.lstPCProfiles=new H.bT,this.SalesSlotType="",this.PostedQtyFor="",this.ExeQty_DontShowUnApproved=!1,this.ApplyDefaultTreeViewFilter=!1,this.iLoop=0,this.sno=0,this.ProductsIDs=new Array,this.ObjArray=[],this.dsClass=null,this.strPrevGroup=null,this.indGrpColumn=1,this.GroupNo=0,this.dsProduct=null,this.dicFPQty=new H.G9,this.dicFPConvertionQty=new H.bT,this.dicKitProjection=new H.G9,this.lstKitProjection=new Array,this.IsAutoPost=!0,this.ReorderBasedOnProductGroup_Report=!1,this.indPostIndex=0,this.iVendorCount=0,this.ChunkSize=2,this.lstVendors=new Array,this.lstPostDocsGroup=new Array,this.dtVoucherDetails=null,this.strDimensionLinkQry="",this.DocumentNumber=null,this.DocDefaultCCFields=new H.G9,this.DocumentLinkDimensions=new Array,this.PostDocsGroupBy="",this.postworkerCancel=!1,this.postworkerIsBusy=!1,this.ClassName="ReOrderLevelNewViewModel",this.ReportID=e,this.dsReportDefn=t,this.Title=s,this.DisplayName=s,this.FilterVisibility=!0,this.GridVisibility=!1,this.InitFilterScreen(),this.HidePrefetch&&this.OnButtonClick("FilterOK")}worker_DoWork(s,e){this.DisplayName=C.d.GetResource("Loading"),this.ButtonsVisibility=!1;try{this.RefreshDateFilter(),this.LoadReOrderGrid(e)}catch(t){Logger.ErrorLog("ReOrderLevel:: LoadReOrderGrid",t)}this.ButtonsVisibility=!0,this.DisplayName=this.Title}worker_RunWorkerCompleted(s,e){this.RecordCount="",this.ReOrderGrid.UpdateTotals(),this.ReOrderGrid.refreshDataView()}InitFilterScreen(){let s;if(this.ToDateFilter.Label="As On",this.ToDateFilter.LblWidth="50",this.Slot1.Label=C.d.GetResource("Report_LblSlot1"),this.Slot2.Label=C.d.GetResource("Report_LblSlot2"),this.Slot3.Label=C.d.GetResource("Report_LblSlot3"),this.Slot1.Width="70",this.Slot2.Width="70",this.Slot3.Width="70",this.SalesForeCastDays.Text="90",this.SalesForeCastDays.Label="Fore Cast Days",this.SalesForeCastDays.LblWidth="100",this.SalesForeCastDays.Width="170",this.FromDate.Label=C.d.GetResource("Reports_LblFromDate"),this.ToDate.Label=C.d.GetResource("Reports_LblToDate"),this.FromDate.Date=C.d.SessionManager.ReportsFromDate,this.ProductStatus=new w.y$(0),this.ProductStatus.Label=C.d.GetResource("Reports_ProductStatus"),this.ProductStatus.Items.push(w._p.ComboBoxItems_2(C.d.GetResource("RevenUReport_Active"),"31")),this.ProductStatus.Items.push(w._p.ComboBoxItems_2(C.d.GetResource("RevenUReport_InActive"),"32")),this.ProductStatus.Items.push(w._p.ComboBoxItems_2(C.d.GetResource("DocumentDesigner_Displayboth"),"0")),this.ProductStatus.SelectedValue="0",this.tree=new Array,this.CostCenterFilters=new Array,this.Report=new Array,this.CostCenters=new w.y$(0),this.CostCenters.Label=C.d.GetResource("Reports_SelectCostCenter"),this.CostCenters.LblWidth="160",this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange"),null==this.dsReportDefn)s=C.d.report.DataSet("RPT046",this.ReportID.toString());else{s=C.d.report.DataSet("RPT047",this.ReportID.toString());let h=this.dsReportDefn.Tables[0].Copy();h.TableName="dtDefn",s.Tables.push(h)}this.JOBDimension=o.J0.Int(s.Tables[1][0].Value),o.J0.IsEmpty(this.Title)&&(this.Title=s.Tables[2][0].ReportName.toString(),this.DisplayName=this.Title);let e=new o.VB;e.LoadXml(s.Tables[2][0].ReportDefnXML.toString()),this.xDocPref.LoadXml(s.Tables[2][0].CustomPreferences.toString());let l=ie.CostCenterPicker.GetDSBuffer().Tables[4].filter(h=>h.FeatureID>5e4||[3,16,40,76,78].Contains(h.FeatureID)),a={FeatureID:-101,Name:"Product Vendors"};l.push(a),a={},a.FeatureID=-102,a.Name="Kit & Assembled Products",l.push(a),l.SortBy(["Name"]);let m=new H.G9,c=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"TreeDimensionsFilter");if(c?.childNodes.forEach(h=>{l.filter(M=>M.FeatureID==h.attributes.CCID.value).length>0&&!m.ContainsKey(parseInt(h.attributes.CCID.value))&&m.push(parseInt(h.attributes.CCID.value),null!=h.attributes.Mandatory)}),c=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"HidePrefetch"),null!=c&&"1"==c.innerHTML&&(this.HidePrefetch=!0),c=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"PrefetchReportList"),null!=c){let h=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ProductsByVoucher");null!=h&&"1"==h.innerHTML&&(this.ProductsByVoucher=!0),h=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ProductsByRowSelection"),null!=h&&"1"==h.innerHTML&&(this.ProductsByRowSelection=!0),c.childNodes.forEach(S=>{let M=this.CostCenters.Items.find(G=>"50"==G.Value&&G.Parent==S.attributes.ID.value);null!=M?S.attributes.ColID.value.length>0&&(M.Aliasname+="\x11"+S.attributes.ColID.value+"~"+S.attributes.ROColID.value):(M=w._p.ComboBoxItems_3(S.attributes.Name.value,"50",S.attributes.ID.value),S.attributes.ColID.value.length>0&&(M.Aliasname=S.attributes.ColID.value+"~"+S.attributes.ROColID.value),this.CostCenters.Items.push(M))})}C.d.SessionManager.Preferences.ContainsKey("ReportsFrom")&&(this.IsReportDB="1"==C.d.SessionManager.Preferences.ReportsFrom,c=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ReportsFrom"),null!=c&&("TrDB"==c.innerHTML?this.IsReportDB=!1:"RptDB"==c.innerHTML&&(this.IsReportDB=!0))),c?.childNodes.forEach(h=>{l.filter(M=>M.FeatureID==h.attributes.CCID.value).length>0&&!m.ContainsKey(parseInt(h.attributes.CCID.value))&&m.push(parseInt(h.attributes.CCID.value),null!=h.attributes.Mandatory)}),l.forEach(h=>{let S=parseInt(h.FeatureID);S>5e4?(0==m.length||m.ContainsKey(S))&&(this.CostCenters.Items.push(w._p.ComboBoxItems_2(h.Name.toString(),h.FeatureID.toString())),m.length>0&&m[S]&&(this.CostCenters.Items[this.CostCenters.Items.length-1].Aliasname="1")):this.CostCenters.Items.push(w._p.ComboBoxItems_2(h.Name.toString(),h.FeatureID.toString()))}),this.CostCenters.Visible=!0,c=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ApplyDefaultTreeViewFilter"),this.LoadTreeData(e.SelectSingleNode("PactRevenURpts/Filters/PreDataFetch")),this.Documents.Label="Document",this.Documents.LblWidth="80",this.Documents.Width="280";let B="";if(null!=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"DefaultSortColumn")&&(this.DefaultSortColumn=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"DefaultSortColumn").innerHTML),(o.J0.IsEmptySpace(this.DefaultSortColumn)||"ProductName"!=this.DefaultSortColumn)&&(this.DefaultSortColumn="ProductCode"),this.ChunkSize=parseInt(o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ChunkSize").innerHTML),B=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"DefaultDocument").innerHTML,this.ExpectedQTY1=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ExpectedQTY1").innerHTML,this.ExpectedQTY2=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ExpectedQTY2").innerHTML,this.ExpectedQTY3=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ExpectedQTY3").innerHTML,this.CommitedQTY1=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"CommitedQTY1").innerHTML,this.CommitedQTY2=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"CommitedQTY2").innerHTML,this.CommitedQTY3=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"CommitedQTY3").innerHTML,this.ProductsBasedOn=null!=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ProductsBasedOn")?o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ProductsBasedOn").innerHTML.split(","):[],this.DataBasedOn=null!=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"DataBasedOn")?o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"DataBasedOn").innerHTML.split(","):[],this.SalesDocs=null!=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"SalesDocs")?o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"SalesDocs").innerHTML:"",c=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"HideSalesFilter"),this.SalesFilterVisible=!(null!=c&&"1"==c.innerHTML),c=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"AvgSaleByTrMn"),this.AvgSaleByTrMn=null!=c&&"1"==c.innerHTML,c=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ShowBOMGrid"),this.BOMGridWithReport=null!=c&&"1"==c.innerHTML,c=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"PODisable"),this.Documents.Enable=!(null!=c&&"1"==c.innerHTML),c=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"POAuto"),this.IsAutoPost=null!=c&&"1"==c.innerHTML,c=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ReorderBasedOnProductGroup"),this.ReorderBasedOnProductGroup_Report=null!=c&&"1"==c.innerHTML,c=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ToDateFilter"),this.ToDateFilter.Visible=null!=c&&"1"==c.innerHTML,c=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"PostDocsGroupBy"),this.PostDocsGroupBy=null!=c?c.innerHTML:"",this.ApplyDefaultTreeViewFilter=null!=c&&"1"==c.innerHTML,this.ExeQty_DontShowUnApproved=null!=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ExeQty_DontShowUnApproved"),this.PostedQtyFor=null==o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"PostedQtyFor")?"":o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"PostedQtyFor").innerHTML,this.SalesSlotType=null==o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ShowSlot")?"":o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ShowSlot").innerHTML,"Yearly"==this.SalesSlotType){let h=new Date(Date.Today().getFullYear(),C.d.SessionManager.AccountingFromMonth-1,1);h>Date.Today()&&(h=h.AddYears(-1));let S=Date.Today();this.Slot1.Text=(Date.Today().Subtract(h).Days+1).toString(),this.Slot1.DependantOn=1==C.d.SessionManager.AccountingFromMonth?h.getFullYear().toString():h.getFullYear().toString()+"-"+((h.getFullYear()+1)%100).toString(),S=h,h=h.AddYears(-1),this.Slot2.Text=(Date.Today().Subtract(h).Days+1).toString(),this.Slot2.DependantOn=1==C.d.SessionManager.AccountingFromMonth?h.getFullYear().toString():h.getFullYear().toString()+"-"+((h.getFullYear()+1)%100).toString(),S=h,h=h.AddYears(-1),this.Slot3.Text=(Date.Today().Subtract(h).Days+1).toString(),this.Slot3.DependantOn=1==C.d.SessionManager.AccountingFromMonth?h.getFullYear().toString():h.getFullYear().toString()+"-"+((h.getFullYear()+1)%100).toString(),this.Slot1.Enable=!1,this.Slot2.Enable=!1,this.Slot3.Enable=!1}else if("Monthly"==this.SalesSlotType){let h=new Date(Date.Today().getFullYear(),Date.Today().getMonth(),1),S=Date.Today();this.Slot1.Text=(Date.Today().Subtract(h).Days+1).toString(),this.Slot1.DependantOn=h.ToString("MMM-yy"),S=h,h=h.AddMonths(-1),this.Slot2.Text=(Date.Today().Subtract(h).Days+1).toString(),this.Slot2.DependantOn=h.ToString("MMM-yy"),S=h,h=h.AddMonths(-1),this.Slot3.Text=(Date.Today().Subtract(h).Days+1).toString(),this.Slot3.DependantOn=h.ToString("MMM-yy"),this.Slot1.Enable=!1,this.Slot2.Enable=!1,this.Slot3.Enable=!1}else this.Slot1.Text=null==o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"Slot1")?"30":o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"Slot1").innerHTML,this.Slot2.Text=null==o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"Slot2")?"60":o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"Slot2").innerHTML,this.Slot3.Text=null==o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"Slot3")?"90":o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"Slot3").innerHTML;let y,I=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"DontIncludeExpiredProducts");if(this.DontIncludeExpiredProducts=null!=I&&"1"==I.innerHTML,I=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"DontIncludePreExpiryProducts"),this.DontIncludePreExpiryProducts=null!=I&&"1"==I.innerHTML,this.DontIncludePreExpiryProducts&&(I=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ExpiryPickFromProduct"),this.ExpiryPickFromProduct=null!=I&&"1"==I.innerHTML,this.ExpiryPickFromProduct||(this.PreExpiryProductDays=o.J0.Int(o.VB.SelectSingleNodeText(this.xDocPref.DocumentElement,"PreExpiryProductDays")))),null!=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ExpirySlab1")&&(y=o.J0.Int(o.VB.SelectSingleNodeText(this.xDocPref.DocumentElement,"ExpirySlab1")),y>0&&this.lstBatchExpirySlabs.push(y)),null!=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ExpirySlab2")&&(y=o.J0.Int(o.VB.SelectSingleNodeText(this.xDocPref.DocumentElement,"ExpirySlab2")),y>0&&(0==this.lstBatchExpirySlabs.length||this.lstBatchExpirySlabs[this.lstBatchExpirySlabs.length-1]<y)&&this.lstBatchExpirySlabs.push(y)),null!=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ExpirySlab3")&&(y=o.J0.Int(o.VB.SelectSingleNodeText(this.xDocPref.DocumentElement,"ExpirySlab3")),y>0&&(0==this.lstBatchExpirySlabs.length||this.lstBatchExpirySlabs[this.lstBatchExpirySlabs.length-1]<y)&&this.lstBatchExpirySlabs.push(y)),this.ChunkSize<=0&&(this.ChunkSize=25),s.Tables[0].forEach(h=>{this.Documents.Items.push(w._p.ComboBoxItems_2(h.DocumentName.toString(),h.CostCenterID.toString())),h.CostCenterID.toString()==B&&(this.Documents.SelectedValue=B,this.Documents.SelectedItem=this.Documents.Items[this.Documents.Items.length-1])}),this.drReport=s.Tables[2][0],this.InitReOrderGrid(e),null!=s.Tables[2][0].KPIXML&&s.Tables[2][0].KPIXML.toString().length>0&&this.ReOrderGrid.InitKPI(s.Tables[2][0].KPIXML.toString()),o.J0.IsEmpty(this.Documents.SelectedValue)&&(this.Documents.SelectedValue=this.Documents.Items[0].Value,this.Documents.SelectedItem=this.Documents.Items[0]),!o.J0.IsEmpty(s.Tables[2][0].RowColumnReportsMap)){let h=new o.VB;h.LoadXml(s.Tables[2][0].RowColumnReportsMap.toString()),this.ReOrderGrid.ContextMenu=new H.bT,o.VB.SelectNodes(h.DocumentElement,"RowReport").forEach(S=>{this.ReOrderGrid.ContextMenu.push(o.VB.SelectSingleNodeText(S,"Name"),S)}),0==this.ReOrderGrid.ContextMenu.length&&(this.ReOrderGrid.ContextMenu=null),this.ReOrderGrid.ContextMenuClick.subscribe(()=>{this.OnContextMenuClick(null)})}this.ProductsByBOM=new z.Q,this.ProductsByBOM.Label="Show Products By",this.ProductsByBOM.Items.push(new z.u),this.ProductsByBOM.Items[0].IsChecked=!0,this.ProductsByBOM.Items.push(new z.u),this.ProductsByBOM.Items.push(new z.u),this.ProductsByBOM.Items[0].Label="Bom",this.ProductsByBOM.Items[1].Label="Raw Material",this.ProductsByBOM.Items[2].Label="Finished Product"}InitReOrderGrid(s){let e,t=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ShowVendor");this.Vendor=new j.y$(0),this.Vendor.Label=C.d.GetResource("Inv_Vendor"),null!=t&&"HeaderWise"==t.innerHTML?(this.Vendor.CCID=2,this.Vendor.TypeID=2,this.Vendor.Visible=!0):this.Vendor.Visible=!1,this.BOMGrid=new x.vv,this.BOMGrid.Visible=!1,this.BOMGrid.Width="",this.BOMGrid.Height=130,this.BOMGrid.Table=[],this.BOMGrid.TableColumns.push("BOMID"),this.BOMGrid.TableColumns.push("BOM"),this.BOMGrid.TableColumns.push("Qty"),this.BOMGrid.TableColumns.push("UnitType"),this.BOMGrid.TableColumns.push("UOM"),this.BOMGrid.TableColumns.push("UOM_Key"),this.BOMGrid.Columns=new Array,e=new E.O7,e.Header="BOM",e.DisplayMember="BOM",e.Width=120,e.ReadOnly=!0,this.BOMGrid.Columns.push(e),e=new E.O7,e.Header="Qty",e.DisplayMember="Qty",e.DataType="FLOAT",e.Width=50,e.IsCalculated=1,e.DisableTab=!0,e.DecimalPoints=C.d.SessionManager.Preferences.DecimalsinQty,this.BOMGrid.Columns.push(e),e=new E.O7,e.Header="Type",e.ValueBinding="UnitType",e.Width=55,e.IsCalculated=1,e.DisableTab=!0,e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value";let i=new Array;i.push(w._p.ComboBoxItems_2("BOM","1")),i.push(w._p.ComboBoxItems_2("Qty","2")),e.ComboData=i,this.BOMGrid.Columns.push(e),e=new E.O7,e.Header=C.d.GetResource("UOM"),e.CostCenterID=11,e.TypeID=1,e.DataType="LISTBOX",e.DisplayMember="UOM",e.ValueMember="UOM_Key",e.Width=90,this.BOMGrid.Columns.push(e),this.BOMGrid.OnBeginEdit.Subscribe(this,"BOMGridBeginEdit"),this.KitGrid=new x.vv,this.KitGrid.Width="",this.KitGrid.Height=120,this.KitGrid.Visible=!1,this.MOGrid=new x.vv,this.MOGrid.Width="",this.MOGrid.Height=120,this.MOGrid.Visible=!1,this.ReOrderGrid=new x.vv,this.ReOrderGrid.Width="",this.ReOrderGrid.Height=0,this.ReOrderGrid.HeaderHeight=40,this.ReOrderGrid.CalcTotalsOnDataView=!0,this.ReOrderGrid.Table=[],this.ReOrderGrid.TableColumns.push("Sno"),this.ReOrderGrid.TableColumns.push("ProductCode"),this.ReOrderGrid.TableColumns.push("ProductName"),this.ReOrderGrid.TableColumns.push("ProductName_Key"),this.ReOrderGrid.TableColumns.push("QOH"),this.ReOrderGrid.TableColumns.push("Variance"),this.ReOrderGrid.TableColumns.push("Variance_RED"),this.ReOrderGrid.TableColumns.push("OrderQty"),this.ReOrderGrid.TableColumns.push("UOM"),this.ReOrderGrid.TableColumns.push("UOM_Key"),this.ReOrderGrid.TableColumns.push("Vendor"),this.ReOrderGrid.TableColumns.push("Vendor_Key");let a=new Array,m=s.SelectNodes("PactRevenURpts/PactRevenURptDef/Columns/ColumnDef"),c=new Array;s.SelectNodes("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns/Column").forEach(u=>{c.push(u.innerHTML)});let B=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"ReorderDimension");this.ReorderDimension=null!=B?parseInt(B.innerHTML):50002;let I=C.d.report.GetLocations(this.ReorderDimension),y=I,h=0;new Array,this.totalALL.Clear(),this.totalSELECTED.Clear(),this.LocationCols.Clear();let M=1,G=s.SelectSingleNode("PactRevenURpts/PactRevenURptDef/FrozeColumns");null!=G&&(M=parseInt(G.innerHTML)),e=new E.O7,e.Header=C.d.GetResource("AssetManagement_SNo"),e.DisplayMember="Sno",e.Width=40,e.ReadOnly=!0,e.IsFrozen=!0,a.push(e);let b=["SalesQty","SalesValue","SalesCost","SalesProfit","Class"],V="";for(let u=0;u<m.length;u++){let n=m[u];if(e=new E.O7,e.ReadOnly=!0,e.DisableTab=!0,e.IsCalculated=1,e.Header=this.GetNodeValue(n,"Identity/Caption"),e.DisplayMember=this.GetNodeValue(n,"Identity/ID"),e.ID=e.DisplayMember,e.DataType=this.GetNodeValue(n,"Identity/Type").toUpperCase(),"ProductGroup"==e.DisplayMember&&(e.DataType=""),c.Contains(e.DisplayMember)&&(e.ShowTotal=!0),("ProductCode"==e.ID||"ProductName"==e.ID)&&"3"==this.GetNodeValue(n,"Linking/Type")&&(e.DataType="LINK"),this.GetNodeValue(n,"HeaderAppearance/BackGrndColor").length>0&&(e.HeaderBackColor=this.GetNodeValue(n,"HeaderAppearance/BackGrndColor")),this.GetNodeValue(n,"HeaderAppearance/ForeGrndColor").length>0&&(e.HeaderForegroundColor=this.GetNodeValue(n,"HeaderAppearance/ForeGrndColor")),33==e.DisplayMember.length){e.Formula=this.GetNodeValue(n,"Identity/Expression"),(0==o.J0.stringCompare(e.Formula,"LATEST",!0)||0==o.J0.stringCompare(e.Formula,"OLDEST",!0))&&(e.Formula="");let f=this.GetNodeValue(n,"Identity/SysColumn");o.J0.IsEmpty(f)||(f.startsWith("dcCalcNum")?f=f.Replace("dcCalcNum","dcCalcdcNum"):f.startsWith("dcCCNID")&&this.ReOrderGrid.TableColumns.push(e.DisplayMember+"_ID"),e.SectionName=f,this.DocumentMappingColumns.push(e))}else"SalesCost"==e.DisplayMember?this.SalesCostColumn=this.GetNodeValue(n,"Identity/SysColumn"):"SalesValue"==e.DisplayMember&&(this.SalesValueColumn=this.GetNodeValue(n,"Identity/SysColumn"));if(e.Expression=this.GetNodeValue(n,"Format/ColumnFilterExpression"),a.length==M&&(e.IsFrozen=!0),"FLOAT"==e.DataType)if(o.J0.IsNum(this.GetNodeValue(n,"Format/Decimals"))){let f=o.J0.Int(this.GetNodeValue(n,"Format/Decimals"));e.DecimalPoints=-1==f?parseInt(C.d.SessionManager.Preferences.DecimalsinAmount).toString():f.toString()}else e.DecimalPoints=C.d.SessionManager.Preferences.DecimalsinQty;"AvgSale"==e.DisplayMember?this.colAvgSales=e:"ReOrderQty"==e.DisplayMember?this.colReOrderQty=e:"Vendor"==e.DisplayMember?(this.colVendor=e,e.ReadOnly=null!=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"DisableVendor"),this.Vendor.Visible?e.IsVisible=!1:(e.CostCenterID=2,e.TypeID=100,e.DataType="LISTBOX",e.DisplayMember="Vendor",e.ValueMember="Vendor_Key")):"UOM"==e.DisplayMember?(this.colUOM=e,e.ReadOnly=!1,e.CostCenterID=11,e.TypeID=1,e.DataType="LISTBOX",e.DisplayMember="UOM",e.ValueMember="UOM_Key"):"OrderQty"==e.DisplayMember?(this.colOrderQty=e,e.ReadOnly=!1,e.Formula=this.GetNodeValue(n,"Identity/Expression")):("Variance"==e.DisplayMember||"OrderValue"==e.DisplayMember)&&(e.Formula=this.GetNodeValue(n,"Identity/Expression")),this.ReOrderGrid.TableColumns.Contains(e.DisplayMember)||this.ReOrderGrid.TableColumns.push(e.DisplayMember),"0"==this.GetNodeValue(n,"HeaderAppearance/Visibility")&&(e.IsVisible=!1),e.Width=""!=this.GetNodeValue(n,"Width")?parseInt(this.GetNodeValue(n," Width")):90;let r=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"Locations/"+e.DisplayMember);if(null!=r&&""!=r.innerHTML&&"-1"!=r.innerHTML){if(!b.Contains(e.DisplayMember)){let f=r.innerHTML.split(",");for(let O=0;O<f.length;O++){let R=e.Clone();h=parseInt(f[O]),-1==h?(R.Header=R.Header+" ALL LOCATIONS",this.totalALL.push(e.DisplayMember,0),R.DisplayMember=e.DisplayMember+"_ALL"):-2==h?(R.Header=R.Header+" TOTAL",this.totalSELECTED.push(e.DisplayMember,0),R.DisplayMember=e.DisplayMember+"_SELECTED"):(y=I.filter(A=>A.NodeID==f[O]),R.Header=y.length>0?R.Header+" "+y[0].Name.toString():R.Header+" "+f[O],this.LocationCols.ContainsKey(f[O])||this.LocationCols.push(f[O],new Array),this.LocationCols[f[O]].push(e.DisplayMember),R.DisplayMember=e.DisplayMember+"_"+f[O]),this.ReOrderGrid.TableColumns.Contains(R.DisplayMember)||this.ReOrderGrid.TableColumns.push(R.DisplayMember),a.push(R)}e.IsVisible=!1,a.push(e);continue}0==V.length&&(V=r.innerHTML)}a.push(e)}let F=-1;for(let u=0;u<a.length;u++)b.Contains(a[u].DisplayMember)&&(-1==F&&(F=u),a[u].IsVisible||(a[u].Dependantinuse=!0),this.lstSaleSlots.push(a[u].DisplayMember,a[u]),a.RemoveAt(u),u--);if(this.lstSaleSlots.length>0)if(0==V.length)if("Yearly"==this.SalesSlotType||"Monthly"==this.SalesSlotType)for(let u=3;u>=1;u--)this.lstSaleSlots.keys.forEach(n=>{e={Key:n,Value:this.lstSaleSlots[n]}.Value.Clone(),e.BarcodeDef=e.Header,e.Header=e.Header+" "+u.toString(),e.DisplayMember=e.DisplayMember+u.toString(),a.Insert(F,e),this.ReOrderGrid.TableColumns.Contains(e.DisplayMember)||this.ReOrderGrid.TableColumns.push(e.DisplayMember),F++});else for(let u=1;u<=3;u++)this.lstSaleSlots.keys.forEach(n=>{e={Key:n,Value:this.lstSaleSlots[n]}.Value.Clone(),e.BarcodeDef=e.Header,e.Header=e.Header+" "+u.toString(),e.DisplayMember=e.DisplayMember+u.toString(),a.Insert(F,e),this.ReOrderGrid.TableColumns.Contains(e.DisplayMember)||this.ReOrderGrid.TableColumns.push(e.DisplayMember),F++});else{let u=V.split(",");for(let n=0;n<u.length;n++){let f,r=u[n];for(f="Yearly"==this.SalesSlotType||"Monthly"==this.SalesSlotType?3:1;;)if(h=parseInt(r),this.lstSaleSlots.keys.forEach(O=>{e={Key:O,Value:this.lstSaleSlots[O]}.Value.Clone(),e.BarcodeDef=e.Header,e.DisplayMember=e.DisplayMember+f.toString(),-1==h?(e.Header=e.Header+" ALL LOCATIONS",e.BarcodeProp=" ALL LOCATIONS",this.totalALL.push(e.DisplayMember,0),e.Header=e.Header+"  ALL LOCATIONS",e.DisplayMember=e.DisplayMember+"_ALL"):-2==h?(e.Header=e.Header+" TOTAL",e.BarcodeProp=" TOTAL",this.totalSELECTED.push(e.DisplayMember,0),e.DisplayMember=e.DisplayMember+"_SELECTED"):(y=I.filter(A=>A.NodeID==r),y.length>0?(e.Header=e.Header+" "+y[0].Name.toString(),e.BarcodeProp=" "+y[0].Name.toString()):(e.Header=e.Header+" "+r,e.BarcodeProp=" "+r),this.LocationCols.ContainsKey(r)||this.LocationCols.push(r,new Array),this.LocationCols[r].push(e.DisplayMember),e.DisplayMember=e.DisplayMember+"_"+r),a.Insert(F,e),this.ReOrderGrid.TableColumns.Contains(e.DisplayMember)||this.ReOrderGrid.TableColumns.push(e.DisplayMember),F++}),"Yearly"==this.SalesSlotType||"Monthly"==this.SalesSlotType){if(f--,0==f)break}else if(f++,f>3)break}}this.DWPCProfile=a.find(u=>"DWPCProfile"==u.DisplayMember&&u.IsVisible),null!=this.DWPCProfile&&(this.DWPCProfile.ShowTotal=!1,a.Remove(this.DWPCProfile));let T=a.find(u=>"BatchPreExpiry"==u.DisplayMember&&u.IsVisible);if(null!=T&&T.IsVisible&&this.lstBatchExpirySlabs.length>0){for(let n=0;n<this.lstBatchExpirySlabs.length;n++)this.BatchPreExpiry+=" S"+n+'="'+this.lstBatchExpirySlabs[n]+'"';this.BatchPreExpiry.length>0&&(this.BatchPreExpiry="<Exp"+this.BatchPreExpiry+"/>");let u=a.indexOf(T);a.Remove(T);for(let n=0;n<this.lstBatchExpirySlabs.length;n++)e=T.Clone(),e.Header=e.Header+" [",e.Header+=0==n?"1":(this.lstBatchExpirySlabs[n-1]+1).toString(),e.Header+="-"+this.lstBatchExpirySlabs[n].toString()+"]",e.DisplayMember="BEx"+n.toString(),a.Insert(u+n,e),this.ReOrderGrid.TableColumns.Contains(e.DisplayMember)||this.ReOrderGrid.TableColumns.push(e.DisplayMember)}this.SelectedAvgLocations="",this.SelectedReOrderLocations="",this.LocationCols.keys.forEach(u=>{let n={Key:u,Value:this.LocationCols[u]};n.Value.Contains("AvgRate")&&(this.SelectedAvgLocations.length>0&&(this.SelectedAvgLocations+=","),this.SelectedAvgLocations+=n.Key),(n.Value.Contains("ReOrderLevel")||n.Value.Contains("ReOrderQty")||n.Value.Contains("SellingPrice")||n.Value.Contains("MaxInventoryLevel"))&&(this.SelectedReOrderLocations.length>0&&(this.SelectedReOrderLocations+=","),this.SelectedReOrderLocations+=n.Key)}),["BalanceQty","ReOrderLevel","ExpQty1","ExpQty2","ExpQty3","ComQty1","ComQty2","ComQty3","CY1","CY2","CY3","CYAvgSale","FC1","FC2","FC3","FCPYAvgSale","OrderQty","MaxInventoryLevel"].forEach(u=>{this.totalSELECTED.ContainsKey(u)||(this.totalSELECTED.push(u,0),this.ReOrderGrid.TableColumns.push(u+"_SELECTED"))}),this.SelectedLocations="",this.LocationCols.keys.forEach(u=>{this.SelectedLocations.length>0&&(this.SelectedLocations+=","),this.SelectedLocations+=u}),null==this.colOrderQty&&(e=new E.O7,e.Header=C.d.GetResource("Inv_OrderQty"),e.DisplayMember="OrderQty",e.DataType="FLOAT",e.Width=80,e.IsCalculated=1,e.DisableTab=!0,e.DecimalPoints=C.d.SessionManager.Preferences.DecimalsinQty,a.push(e)),null==this.colUOM&&(e=new E.O7,e.Header=C.d.GetResource("UOM"),e.CostCenterID=11,e.TypeID=1,e.DataType="LISTBOX",e.DisplayMember="UOM",e.ValueMember="UOM_Key",e.Width=80,a.push(e)),!this.Vendor.Visible&&null==this.colVendor&&(e=new E.O7,e.Header=C.d.GetResource("Inv_Vendor"),e.CostCenterID=2,e.TypeID=100,e.DataType="LISTBOX",e.DisplayMember="Vendor",e.ValueMember="Vendor_Key",e.Width=120,a.push(e));let p=s.SelectSingleNode("PactRevenURpts/PactRevenURptDef/Query/Select");this.SelectTag=null!=p?o.J0.DecodeXML(p.innerHTML):"",p=s.SelectSingleNode("PactRevenURpts/PactRevenURptDef/Query/From"),this.FromTag=null!=p?p.innerHTML:"",a.forEach(u=>{if(!o.J0.IsEmptySpace(u.Formula)){let n=u.Formula,r=new k.PE;r.SetKeyWords("REPORT");let f=[];r.ParseFormula(n,f);let R,O="",A=null;for(let P=f.length-1;P>=0;P--){let K=f[P];R=K.getTokenValue().toString(),K.getTokenClass()!=k.C3.OPERAND||null==A||A.getTokenClass()!=k.C3.OPERAND?A=K:(A.tokenValue=K.tokenValue.toString()+A.tokenValue.toString(),f.RemoveAt(P))}f.forEach(P=>{let K=P;if(R=K.getTokenValue().toString(),K.getTokenClass()==k.C3.OPERAND)for(let U=0;U<a.length;U++){let $=a[U];if(0==o.J0.stringCompare($.Header.Replace(" ",""),R,!0)){R=$.DisplayMember;break}}"STRING"==K.getTokenName()?O+='"'+R+'"':(K.getTokenType()==k.Wz.KEYWORD&&(O+=" "),O+=R,K.getTokenType()==k.Wz.KEYWORD&&(O+=" "))}),u.Formula=O}}),this.ReOrderGrid.CanUserSortColumns=!0,this.ReOrderGrid.Columns=a,this.ReOrderGrid.ConstructFormulaFields(!1),this.ReOrderGrid.IgnoreFormulaKeywords=new Array,this.ReOrderGrid.IgnoreFormulaKeywords.push("FROMDATE"),this.ReOrderGrid.IgnoreFormulaKeywords.push("TODATE"),this.ReOrderGrid.IgnoreFormulaKeywords.push("SYSTEMDATE"),this.ReOrderGrid.IgnoreFormulaKeywords.push("CURRENT_YEARSTART"),this.ReOrderGrid.fldDict.ContainsKey("FROMDATE")||this.ReOrderGrid.fldDict.push("FROMDATE",new k.Nl("FROMDATE","")),this.ReOrderGrid.fldDict.ContainsKey("TODATE")||this.ReOrderGrid.fldDict.push("TODATE",new k.Nl("TODATE","")),this.ReOrderGrid.fldDict.ContainsKey("SYSTEMDATE")||this.ReOrderGrid.fldDict.push("SYSTEMDATE",new k.Nl("SYSTEMDATE","")),this.ReOrderGrid.fldDict.ContainsKey("CURRENT_YEARSTART")||this.ReOrderGrid.fldDict.push("CURRENT_YEARSTART",new k.Nl("CURRENT_YEARSTART","")),this.ReOrderGrid.fldDict.SYSTEMDATE.setFieldValue(Date.Today()),this.ReOrderGrid.fldDict.CURRENT_YEARSTART.setFieldValue(new Date(Date.Today().getFullYear(),0,1)),this.ReOrderGrid.OnLinkClick.Subscribe(this,"OnLinkClick"),this.ReOrderGrid.OnBeginEdit.Subscribe(this,"OnGridBeginEdit"),["BalanceQty","ReOrderLevel","ReOrderQty","SellingPrice","LastPrice","ExpQty1","ExpQty2","ExpQty3","ComQty1","ComQty2","ComQty3","CY1","CY2","CY3","CYAvgSale","FC1","FC2","FC3","FCPYAvgSale","AvgRate","SalesQty","SalesValue","SalesCost","SalesProfit","MaxInventoryLevel"].forEach(u=>{if(0==a.filter(n=>n.DisplayMember.startsWith(u)&&n.IsVisible).length&&0==a.filter(n=>!o.J0.IsEmpty(n.Formula)&&n.Formula.Contains(u)).length){for(let n=a.length-1;n>=0;n--)a[n].DisplayMember.startsWith(u)&&(this.ReOrderGrid.TableColumns.Contains(a[n].DisplayMember)&&this.ReOrderGrid.TableColumns.Remove(a[n].DisplayMember),a.RemoveAt(n));this.totalSELECTED.ContainsKey(u)&&this.totalSELECTED.Remove(u),this.totalALL.ContainsKey(u)&&this.totalALL.Remove(u),this.LocationCols.values.forEach(n=>{n.Contains(u)&&n.Remove(u)}),this.strHiddenFields+=u+","}}),this.strHiddenFields=this.strHiddenFields.TrimEnd(","),this.AvgSaleByTrMn&&(this.strHiddenFields+=",AvgSaleByTrMn"),this.ColumnsSource=this.ReOrderGrid.Columns,this.PostDataFetchFilterFields=new Array,this.ReOrderGrid.Columns.forEach(u=>{if(u.IsVisible&&u.ReadOnly){let n=new se.D_;n.ID=u.DisplayMember,n.ColumnType=u.DataType,n.HeaderText=u.Header;let r=new N.n;r.PostDataField_1(n,this),this.PostDataFetchFilterFields.push(r)}})}GetNodeValue(s,e){let t="";return s&&(t=o.VB.SelectSingleNodeText(s,e)),t}BOMGridBeginEdit(s){return"DataGridPactListBoxColumn"==s.args.column.className&&"1"==s.args.item.UnitType.toString()}LoadReOrderGrid(s){let e=!1;this.ReportData=this.ReOrderGrid.Table,this.RecordCount="",this.ProductsIDs.Clear();let t=0;this.VendorWHERE="";let i=this.GetDimensionFilter("CCMAP.CCNID",this.ProductsBasedOn,!0),l=this.GetFilterNodes(16);this.BomWHERE=this.GetFilterNodes(76),this.MOWHERE=this.GetFilterNodes(78),this.JobWHERE=this.JOBDimension>0?this.GetFilterNodes(this.JOBDimension):"",this.KitWHERE=this.GetFilterNodes(-102),this.BOMSelect="";let a="",m="",B="",I="";this.ProductsByVoucher_Temp=!1,this.ShowBOMProducts=v.None;let y=this.CostCenterFilters.find(r=>3==r.CostCenterID),h="";null!=y&&null!=y.SelectedNodes&&(h=y.GetSeqNosListWithRoots(this.ApplyDefaultTreeViewFilter)),o.J0.IsEmpty(h)||null!=y&&null!=y.SelectedNodes&&y.SelectedNodes.length>0&&(y.IsOneSelected||(y.IsGroupExists?(I=" AND P.ProductID=GTP.GTID",B=h.Contains(",")?",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID IN ("+h+") group by T.ProductID) AS GTP ":",(select T.ProductID GTID from INV_Product T with(nolock),INV_Product GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.ProductID="+h+" group by T.ProductID) AS GTP "):I=h.Contains(",")?" AND P.ProductID IN ("+h+")":" AND P.ProductID="+h)),this.dsProduct=null;let S=this.CostCenterFilters.find(r=>-101==r.CostCenterID);var M=this.CostCenterFilters.filter(r=>50==r.CostCenterID&&null!=r.SelectedNodes&&r.SelectedNodes.length>0);if(this.ReportSelectedNodes=new Array,M.forEach(r=>{this.ReportSelectedNodes.AddRange(r.SelectedNodes.filter(f=>0==f.IsGroup))}),null!=S&&S.SelectedNodes.length>0){for(let r=0;r<S.SelectedNodes.length;r++)r>0&&(this.VendorWHERE+=","),this.VendorWHERE+=S.SelectedNodes[r].Id;this.Vendor.Visible&&(this.Vendor.SelectedValue=S.SelectedNodes[0].Id)}let G=this.Report.length>0&&this.Report[0].Preferences.ContainsKey("UseBomInReorder");if(this.dicFPQty=new H.G9,G&&0==this.BomWHERE.length&&this.ReportSelectedNodes.length>0){this.BomWHERE="",this.ShowBOMProducts=this.ProductsByBOM.Items[1].IsChecked?v.RawMaterial:this.ProductsByBOM.Items[2].IsChecked?v.FinishedProduct:v.BOM;let r=-1,f=this.Report[0].Preferences.ContainsKey("ReorderQtyColumn")?this.Report[0].Preferences.ReorderQtyColumn:"";if(this.Report.length>0){let O=this.Report[0].ReportColumns.find(R=>R.ID==f);null!=O&&(r=this.Report[0].ReportColumns.indexOf(O))}if(this.ReportSelectedNodes.forEach(O=>{this.dicFPQty.ContainsKey(O.Id)?-1!=r&&(t=0,t=o.J0.Double(O.Tag.Cells[r].Value),t>0&&(this.dicFPQty[O.Id]+=t)):(this.BomWHERE.length>0&&(this.BomWHERE+=","),this.BomWHERE+=O.Id,t=0,-1!=r&&(t=o.J0.Double(O.Tag.Cells[r].Value)),t<=0&&(t=1),this.dicFPQty.push(O.Id,t))}),this.ShowBOMProducts==v.FinishedProduct)G=!1,this.ProductsByVoucher=!1,this.BomWHERE="";else{let O=C.d.report.GetDataTable("RPT048",this.BomWHERE);this.BomWHERE="",O.forEach(A=>{this.BomWHERE.length>0&&(this.BomWHERE+=","),this.BomWHERE+=A.BOMID.toString()});let R=[];O.forEach(A=>{let P={};P.BOMID=A.BOMID,P.BOM=A.BOMCode.toString(),P.Qty=this.dicFPQty[parseInt(A.ProductID)],P.UOM=A.UOMID.toString(),P.UOM_key=A.UOMID.toString(),P.UnitType="2",R.push(P)}),this.BOMGrid.Table=R}}if(!G&&this.ReportSelectedNodes.length>0){this.ProductsByVoucher&&(this.ProductsByVoucher_Temp=!0),this.dsProduct={Tables:[],Columns:[]};let r=[];this.dsProduct.Columns[0]=[],this.dsProduct.Columns[0].push("ProductID"),this.dsProduct.Columns[0].push("VoucherNo"),this.dsProduct.Columns[0].push("ReorderDetailsID"),this.ReportSelectedNodes.forEach(f=>{if(this.ProductsByVoucher||!this.ProductsIDs.Contains(f.Id)){let O={};r.push(O),O.ProductID=f.Id,f.Text.length>1&&(O.VoucherNo=f.Text[1],O.ReorderDetailsID=parseInt(f.Text[2])),this.ProductsIDs.push(f.Id)}}),this.dsProduct.Tables.push(r)}else if(I.length>0||i.length>0||this.VendorWHERE.length>0||this.BomWHERE.length>0||this.MOWHERE.length>0||l.length>0||this.KitWHERE.length>0||null!=y&&y.IsOneSelected)if(this.ReorderBasedOnProductGroup_Report&&0==this.BOMSelect.length&&0==a.length&&0==m.length&&0==this.VendorWHERE.length&&(e=!0),this.VendorWHERE.length>0)C.d.report.ReportDataTable("RPT049",this.IsReportDB,B,this.VendorWHERE,I).forEach(f=>{this.ProductsIDs.push(parseInt(f[0]))});else{let r="",f="";i.Contains("CCMAP.CCNID")&&(r+=" INNER JOIN COM_CCCCData CCMAP with(nolock) ON CostCenterID=3 AND CCMAP.NodeID=P.ProductID ",f+=i),this.BomWHERE.length>0?(this.ShowBOMProducts=this.ProductsByBOM.Items[1].IsChecked?v.RawMaterial:this.ProductsByBOM.Items[2].IsChecked?v.FinishedProduct:v.BOM,r+=" INNER JOIN PRD_BOMProducts BP with(nolock) ON BP.ProductID=P.ProductID AND BP.ProductUse=1",this.BomWHERE.Contains(",")?f+=" AND BP.BOMID IN ("+this.BomWHERE+")":f+=" AND BP.BOMID="+this.BomWHERE,r+=" LEFT JOIN COM_UOM PU with(nolock) ON PU.UOMID=P.UOMID LEFT JOIN COM_UOM U with(nolock) ON U.UOMID=BP.UOMID",this.BOMSelect=",BP.BOMID,BP.Quantity*isnull(U.Conversion,1)/isnull(PU.Conversion,1) ConvertedQty"):this.MOWHERE.length>0?(r+=" INNER JOIN PRD_BOMProducts BP with(nolock) ON BP.ProductID=P.ProductID AND BP.ProductUse=1",r+=" INNER JOIN PRD_MFGOrderBOMs MB with(nolock) ON MB.BOMID=BP.BOMID",this.MOWHERE.Contains(",")?f+=" AND MB.MFGOrderID IN ("+this.MOWHERE+")":f+=" AND MB.MFGOrderID="+this.MOWHERE,r+=" LEFT JOIN COM_UOM PU with(nolock) ON PU.UOMID=P.UOMID LEFT JOIN COM_UOM U with(nolock) ON U.UOMID=BP.UOMID",a=",MB.MFGOrderID MOID,MB.Quantity*BP.Quantity*isnull(U.Conversion,1)/isnull(PU.Conversion,1) ConvertedQty"):this.KitWHERE.length>0&&(this.IsKitProjection?(this.ShowBOMProducts=v.None,this.dicKitProjection.Clear(),this.KitWHERE.Contains(",")?f+=" AND P.ProductID IN ("+this.KitWHERE+")":f+=" AND P.ProductID="+this.KitWHERE):(this.ShowBOMProducts=v.BOM,r+=" INNER JOIN INV_ProductBundles KP with(nolock) ON KP.ProductID=P.ProductID",this.KitWHERE.Contains(",")?f+=" AND KP.ParentProductID IN ("+this.KitWHERE+")":f+=" AND KP.ParentProductID="+this.KitWHERE,m=",KP.ParentProductID,KP.Quantity KitQty")),l.length>0&&(r+=" INNER JOIN INV_Batches B with(nolock) ON B.ProductID=P.ProductID",l.Contains(",")?f+=" AND B.BatchID IN ("+l+")":f+=" AND B.BatchID="+l),I.length>0&&(r+=B),r+=" WHERE P.IsGroup=0",r+=f,I.length>0&&(r+=I),"0"!=this.ProductStatus.SelectedValue&&(r+=" AND P.StatusID="+this.ProductStatus.SelectedValue),r+=this.ShowBOMProducts==v.BOM?this.BomWHERE.length>0?" ORDER BY BP.BOMID,P.ProductCode":this.KitWHERE.length>0?this.IsKitProjection?" ORDER BY P."+this.DefaultSortColumn:" ORDER BY KP.ParentProductID,P."+this.DefaultSortColumn:" ORDER BY P."+this.DefaultSortColumn:e?" ORDER BY Ord":" ORDER BY P."+this.DefaultSortColumn,r=r.Insert(0,e?"SELECT G.ProductID,G."+this.DefaultSortColumn+" Ord"+this.BOMSelect+a+m+" FROM INV_Product P with(nolock) join INV_Product G with(nolock) on P.ParentID=G.ProductID":"SELECT P.ProductID"+this.BOMSelect+a+m+" FROM INV_Product P with(nolock)"),this.BomWHERE.length>0?(r+=" SELECT BOMID,UOMID,FPQty,BOMName FROM PRD_BillOfMaterial BOM with(nolock) ",this.BomWHERE.Contains(",")?r+=" WHERE BOM.BOMID IN ("+this.BomWHERE+")":r+=" WHERE BOM.BOMID="+this.BomWHERE,r+=" select UOMID,UnitName,Conversion from COM_UOM with(nolock) order by BaseID,Conversion desc"):this.MOWHERE.length>0||this.KitWHERE.length>0&&(this.IsKitProjection?(r+=" SELECT KP.ParentProductID,KP.ProductID,KP.Quantity KitQty FROM INV_ProductBundles KP with(nolock)",this.KitWHERE.Contains(",")?r+=" WHERE KP.ParentProductID IN ("+this.KitWHERE+")":r+=" WHERE KP.ParentProductID="+this.KitWHERE):(r+=" SELECT KP.ParentProductID,KP.ProductID,KP.Quantity,P.ProductName KitName FROM INV_ProductBundles KP with(nolock) \n                    inner join INV_Product P with(nolock) on KP.ParentProductID=P.ProductID",this.KitWHERE.Contains(",")?r+=" WHERE KP.ParentProductID IN ("+this.KitWHERE+")":r+=" WHERE KP.ParentProductID="+this.KitWHERE));let O=0;this.dsProduct=C.d.report.DataSet("RPT022",r.toString()),this.dsProduct.Tables[0].forEach(R=>{O=parseInt(R[this.dsProduct.Columns[0][0]]),(this.ShowBOMProducts==v.BOM||!this.ProductsIDs.Contains(O))&&this.ProductsIDs.push(O)})}if(0==this.ProductsIDs.length)return;if(this.dsClass=null,this.lstSaleSlots.length>0&&this.lstSaleSlots.ContainsKey("Class")&&(I.length>0||i.length>0)){let r="",f="";i.Contains("CCMAP.CCNID")&&(r+=" INNER JOIN COM_CCCCData CCMAP with(nolock) ON CostCenterID=3 AND CCMAP.NodeID=P.ProductID ",f+=i);let O=[];O.push(r),O.push(f),O.push(this.SalesDocs),O.push(parseInt(this.Slot1.Text)),O.push(parseInt(this.Slot2.Text)-parseInt(this.Slot1.Text)),O.push(parseInt(this.Slot3.Text)-parseInt(this.Slot2.Text)),O.push(C.d.SessionManager.UserID),O.push(C.d.SessionManager.LanguageID),this.dsClass=C.d.inventory.GetReOrderABC(O)}let V,b=this.GetDimensionFilter("DCC.dcCCNID",this.DataBasedOn,!0);V=this.SelectTag.Replace("@CCWHERE@",b.length>0?" INNER JOIN COM_DocCCData DCC with(nolock) ON A.InvDocDetailsID=DCC.InvDocDetailsID "+b:""),V.Contains("EF_FROMDATE")&&(V=V.Replace("EF_FROMDATE",this.FromDate.Date.ToString("dd MMM yyyy"))),V.Contains("EF_TODATE")&&(V=V.Replace("EF_TODATE",this.ToDate.Date.ToString("dd MMM yyyy"))),V.Contains("EF_ASONDATE")&&(V=V.Replace("EF_ASONDATE",this.ToDateFilter.Date.ToString("dd MMM yyyy")));let F=0;if(this.DataBasedOn.Contains("50002")){var T=this.CostCenterFilters.find(r=>50002==r.CostCenterID);T&&T.SelectedNodes.length>0&&(F=1==T.SelectedNodes.length?T.SelectedNodes[0].Id:0,this.LocationCols.keys.forEach(r=>{let f_Key=r;this.LocationCols[f_Key].forEach(O=>{var R=this.ReOrderGrid.Columns.find(A=>A.DisplayMember==O+"_"+f_Key);null!=R&&(R.IsVisible=0==F||f_Key==F.toString())})}))}let p="";this.DontIncludePreExpiryProducts?p=this.ExpiryPickFromProduct?" and (B.ExpiryDate is null or B.ExpiryDate>=TP.PreexpiryDays)":" and (B.ExpiryDate is null or B.ExpiryDate>=convert(float,convert(datetime,'"+Date.Today().AddDays(this.PreExpiryProductDays).ToString("dd MMM yyyy")+"')))":this.DontIncludeExpiredProducts&&(p=" and (B.ExpiryDate is null or B.ExpiryDate>=convert(float,convert(datetime,'"+Date.Today().ToString("dd MMM yyyy")+"')))"),this.ObjArray=[],this.ObjArray.push(""),this.ObjArray.push(this.ToDateFilter.Visible?this.ToDateFilter.Date:null),this.ObjArray.push(e),this.ObjArray.push(this.ExpectedQTY1),this.ObjArray.push(this.ExpectedQTY2),this.ObjArray.push(this.ExpectedQTY3),this.ObjArray.push(this.CommitedQTY1),this.ObjArray.push(this.CommitedQTY2),this.ObjArray.push(this.CommitedQTY3),this.ObjArray.push(this.SalesDocs),this.ObjArray.push(this.FromDate.Date),this.ObjArray.push(this.ToDate.Date),this.ObjArray.push(parseInt(this.Slot1.Text)),this.ObjArray.push(parseInt(this.Slot2.Text)-parseInt(this.Slot1.Text)),this.ObjArray.push(parseInt(this.Slot3.Text)-parseInt(this.Slot2.Text)),this.ObjArray.push(b),this.ObjArray.push(this.ReorderDimension>0&&50002!=this.ReorderDimension?this.ReorderDimension:null!=this.DimensionFilter?this.DimensionFilter.CostCenterID:50002),this.ObjArray.push(this.SelectedLocations),this.ObjArray.push(this.SelectedAvgLocations),this.ObjArray.push(this.SelectedReOrderLocations),this.ObjArray.push(this.strHiddenFields),this.ObjArray.push(F),this.ObjArray.push(this.SalesCostColumn),this.ObjArray.push(this.SalesValueColumn),this.ObjArray.push(V),this.ObjArray.push(this.FromTag),this.ObjArray.push(p),this.ObjArray.push(this.BatchPreExpiry),this.ObjArray.push(this.ExeQty_DontShowUnApproved),this.ObjArray.push(this.PostedQtyFor),this.ObjArray.push(C.d.SessionManager.UserID),this.ObjArray.push(C.d.SessionManager.LanguageID);for(let r=0;r<this.lstSaleSlots.keys.length;r++){let f={Key:this.lstSaleSlots.keys[r],Value:this.lstSaleSlots.values[r]},O=parseInt(this.Slot1.Text);var d=this.ColumnsSource.filter(P=>P.DisplayMember.startsWith(f.Value.DisplayMember+"1"));if(!(O>0)){d.forEach(P=>{P.IsVisible=!1});continue}d.forEach(P=>{P.Header=P.BarcodeDef,P.Header+=0==P.BarcodeProp.length?"\r\n":" ",P.Header+="Yearly"==this.SalesSlotType||"Monthly"==this.SalesSlotType?this.Slot1.DependantOn:"1 - "+O,P.IsVisible=!P.Dependantinuse,P.BarcodeProp.length>0&&(P.Header+="\r\n"+P.BarcodeProp)});let R=parseInt(this.Slot2.Text);if(d=this.ColumnsSource.filter(P=>P.DisplayMember.startsWith(f.Value.DisplayMember+"2")),!(R>0)){d.forEach(P=>{P.IsVisible=!1});continue}d.forEach(P=>{P.Header=P.BarcodeDef,P.Header+=0==P.BarcodeProp.length?"\r\n":" ",P.Header+="Yearly"==this.SalesSlotType||"Monthly"==this.SalesSlotType?this.Slot2.DependantOn:O+1+"-"+R,P.IsVisible=!P.Dependantinuse,P.BarcodeProp.length>0&&(P.Header+="\r\n"+P.BarcodeProp)});let A=parseInt(this.Slot3.Text);(d=this.ColumnsSource.filter(P=>P.DisplayMember.startsWith(f.Value.DisplayMember+"3"))).forEach(A>0?P=>{P.Header=P.BarcodeDef,P.Header+=0==P.BarcodeProp.length?"\r\n":" ",P.Header+="Yearly"==this.SalesSlotType||"Monthly"==this.SalesSlotType?this.Slot3.DependantOn:R+1+"-"+A,P.IsVisible=!P.Dependantinuse,P.BarcodeProp.length>0&&(P.Header+="\r\n"+P.BarcodeProp)}:P=>{P.IsVisible=!1})}this.lstSaleSlots.length>0&&(this.ReOrderGrid.RefreshColumns(),this.ColumnsSource=this.ReOrderGrid.Columns),this.strPrevGroup=null,this.RecordCount="[Displaying 0 of "+this.ProductsIDs.length+" Rows]",this.dicFPConvertionQty=new H.bT,this.BomWHERE.length>0&&this.BOMGrid.Table.forEach(r=>{if("1"!=r.UnitType.toString()){let f=this.dsProduct.Tables[1].filter(K=>K.BOMID==r.BOMID),O=parseFloat(r.Qty),R=1,A=1,P=1;if(""!=r.UOM_key.toString()){if(f[0].UOMID.toString().length>0){let U=this.dsProduct.Tables[2].filter($=>$.UOMID==f[0].UOMID);U.length>0&&(A=parseFloat(U[0].Conversion)),A<0&&(A=1)}let K=this.dsProduct.Tables[2].filter(U=>U.UOMID==r.UOM_key);K.length>0&&(R=parseFloat(K[0].Conversion)),0==R&&(R=1),P=parseFloat(f[0].FPQty),O=parseFloat(r.Qty)*R/(P*A),this.dicFPConvertionQty.push(f[0].BOMID.toString(),O)}}}),this.ShowBOMProducts==v.BOM||this.ProductsByVoucher_Temp?(this.ReOrderGrid.CanUserSortColumns=!1,this.ReOrderGrid.TableColumns.Contains("StyleIsBold")||this.ReOrderGrid.TableColumns.push("StyleIsBold"),this.ReOrderGrid.TableColumns.Contains("VoucherNo")||this.ReOrderGrid.TableColumns.push("VoucherNo"),this.ReOrderGrid.TableColumns.Contains("GroupNo")||this.ReOrderGrid.TableColumns.push("GroupNo"),this.ReOrderGrid.TableColumns.Contains("IsGroupRow")||this.ReOrderGrid.TableColumns.push("IsGroupRow"),this.ReOrderGrid.TableColumns.Contains("ReorderDetailsID")||this.ReOrderGrid.TableColumns.push("ReorderDetailsID")):this.ReOrderGrid.CanUserSortColumns=!0,this.ReOrderGrid.fldDict.FROMDATE.setFieldValue(this.FromDate.Date),this.ReOrderGrid.fldDict.TODATE.setFieldValue(this.ToDate.Date),this.indGrpColumn=1,this.GroupNo=0;var n=this.ReOrderGrid.Columns.find(r=>r.IsVisible&&"Sno"!=r.DisplayMember&&"FLOAT"!=r.DataType&&"DATE"!=r.DataType);null!=n&&(this.indGrpColumn=this.ReOrderGrid.TableColumns.indexOf(n.DisplayMember),this.indGrpColumn<0&&(this.indGrpColumn=1)),this.iLoop=0,this.sno=0,this.LoadReorderGrid_CallBack()}LoadReorderGrid_CallBack(){{if(this.iLoop>=this.ProductsIDs.length)return void this.LoadReorderGrid_Complete();if(this.worker.CancellationPending)return void(this.worker.Cancel=!0);let e,s="",t=0,i=0,l=new Array;for(let a=this.iLoop;a<this.ProductsIDs.length&&a-this.iLoop<this.ChunkSize;a++)l.Contains(this.ProductsIDs[a])||(s.length>0&&(s+=","),s+=this.ProductsIDs[a],l.push(this.ProductsIDs[a]));this.ObjArray[0]=s.toString(),C.d.inventory.GetReOrderLevelData(this.ObjArray).then(a=>{let c,B,I,y,S,M,b,m=a,G=this.ToDate.Date.Subtract(this.FromDate.Date).Days+1;if(G<1&&(G=1),b=o.J0.Int(this.SalesForeCastDays.Text),null!=this.dsClass&&(m.Columns[0].push("Class1"),m.Columns[0].push("Class2"),m.Columns[0].push("Class3"),m.Tables[0].forEach(T=>{let p=this.dsClass.Tables[0].filter(d=>d.ProductID==T.ProductID);p.length>0&&(T.Class1=p[0].Class),p=this.dsClass.Tables[1].filter(d=>d.ProductID==T.ProductID),p.length>0&&(T.Class2=p[0].Class),p=this.dsClass.Tables[2].filter(d=>d.ProductID==T.ProductID),p.length>0&&(T.Class3=p[0].Class)})),null!=this.dtPCProfile&&this.lstPCProfiles.length>0){let T;this.lstPCProfiles.keys.forEach(p=>{m.Columns[0].push(p)}),m.Tables[0].forEach(p=>{T=this.dtPCProfile.filter(d=>d.ProductID==p.ProductID),T.forEach(d=>{p["DWPCProfile_"+d.ProfileID.toString()+"_"+d.DimID.toString()]=d.Rate})})}for(let T=1;T<m.Columns[1].length;T++)m.Columns[0].push(m.Columns[1][T]);c=y=m.Tables[0],B=m.Tables[0],I=S=m.Tables[1],M=m.Columns[1];let V=this.dsProduct.Tables.length>1&&this.dsProduct.Tables[1].length>0?this.dsProduct.Tables[1]:null;for(let T=this.iLoop;T<this.ProductsIDs.length&&T-this.iLoop<this.ChunkSize;T++){if(c=y.filter(d=>d.ProductID==this.ProductsIDs[T]),0==c.length)continue;if(this.ShowBOMProducts==v.BOM&&this.BomWHERE.length>0&&this.strPrevGroup!=this.dsProduct.Tables[0][T].BOMID.toString()){o.J0.IsEmpty(this.strPrevGroup)||this.AddSubTotal(this.indGrpColumn,V[0].BOMName.toString(),this.GroupNo),this.sno=0,this.strPrevGroup=this.dsProduct.Tables[0][T].BOMID.toString();let d=this.ReOrderGrid.NewRow();V=this.dsProduct.Tables[1].filter(u=>u.BOMID==this.strPrevGroup),d[this.ReOrderGrid.TableColumns[this.indGrpColumn]]=V[0].BOMName.toString(),d.StyleIsBold=1,d.GroupNo=++this.GroupNo,d.IsGroupRow=!0,this.ReOrderGrid.addRow(d)}else if(this.ShowBOMProducts==v.BOM&&this.KitWHERE.length>0&&this.strPrevGroup!=this.dsProduct.Tables[0][T].ParentProductID.toString()){this.sno=0,this.strPrevGroup=this.dsProduct.Tables[0][T].ParentProductID.toString();let d=this.ReOrderGrid.NewRow();V=this.dsProduct.Tables[1].filter(u=>u.ParentProductID==this.strPrevGroup),d[this.ReOrderGrid.TableColumns[this.indGrpColumn]]=V[0].KitName.toString(),d.StyleIsBold=1,d.GroupNo=++this.GroupNo,d.IsGroupRow=!0,this.ReOrderGrid.addRow(d)}else if(this.ProductsByVoucher_Temp&&this.strPrevGroup!=this.dsProduct.Tables[0][T].VoucherNo.toString()){this.sno=0,this.strPrevGroup=this.dsProduct.Tables[0][T].VoucherNo.toString();let d=this.ReOrderGrid.NewRow();d[this.ReOrderGrid.TableColumns[this.indGrpColumn]]=this.strPrevGroup,d.StyleIsBold=1,d.GroupNo=++this.GroupNo,d.IsGroupRow=!0,this.ReOrderGrid.addRow(d)}for(let d=0;d<this.totalSELECTED.length;d++)this.totalSELECTED[this.totalSELECTED.keys[d]]=0;let p=this.ReOrderGrid.NewRow();if(m.Columns[0].forEach(d=>{this.ReOrderGrid.TableColumns.Contains(d)&&(p[d]=c[0][d])}),p.ProductName_Key=c[0].ProductID,null!=this.dsProduct&&(this.BOMSelect.length>0||this.ShowBOMProducts==v.FinishedProduct)){let d=0;if(this.ShowBOMProducts==v.BOM)if(this.dicFPConvertionQty.ContainsKey(this.strPrevGroup))d+=this.dicFPConvertionQty[this.strPrevGroup]*parseFloat(this.dsProduct.Tables[0][T].ConvertedQty);else{let u=this.BOMGrid.Table.filter(n=>n.BOMID==this.strPrevGroup);d+=parseFloat(u[0].Qty)*parseFloat(this.dsProduct.Tables[0][T].ConvertedQty)}else this.ShowBOMProducts==v.FinishedProduct?this.dicFPQty.ContainsKey(this.ProductsIDs[T])&&(d=this.dicFPQty[this.ProductsIDs[T]]):this.dsProduct.Tables[0].filter(n=>n.ProductID==c[0].ProductID).forEach(n=>{if(this.dicFPConvertionQty.ContainsKey(n.BOMID.toString()))d+=this.dicFPConvertionQty[n.BOMID.toString()]*parseFloat(n.ConvertedQty);else{let r=this.BOMGrid.Table.filter(f=>f.BOMID==n.BOMID);d+=parseFloat(r[0].Qty)*parseFloat(n.ConvertedQty)}});p.RequiredQty=d}else if(null!=this.dsProduct&&this.MOWHERE.length>0){let d=0;this.dsProduct.Tables[0].filter(n=>n.ProductID==c[0].ProductID).forEach(n=>{let r=this.MOGrid.Table.filter(f=>f.MOID==n.MOID);d+=parseFloat(r[0].Qty)*parseFloat(n.ConvertedQty)}),p.RequiredQty=d}else if(null!=this.dsProduct&&this.KitWHERE.length>0&&!this.IsKitProjection){let d=0;if(this.ShowBOMProducts==v.BOM){let u=this.KitGrid.Table.filter(n=>n.KitID==this.strPrevGroup);d+=parseFloat(u[0].Qty)*parseFloat(this.dsProduct.Tables[0][T].KitQty)}else this.dsProduct.Tables[0].filter(n=>n.ProductID==c[0].ProductID).forEach(n=>{let r=this.KitGrid.Table.filter(f=>f.KitID==n.ParentProductID);d+=parseFloat(r[0].Qty)*parseFloat(n.KitQty)});p.RequiredQty=d}if(c.forEach(d=>{e=d.TAGID.toString(),this.LocationCols.ContainsKey(e)?this.LocationCols[e].forEach(u=>{p[u+"_"+e]=d[u],this.totalSELECTED.ContainsKey(u)&&(i=o.J0.Double(d[u]),this.totalSELECTED[u]+=i)}):"-1"==e&&this.totalALL.keys.forEach(u=>{p[u+"_ALL"]=d[u]})}),this.totalSELECTED.keys.forEach(d=>{p[d+"_SELECTED"]=this.totalSELECTED[d]}),this.totalALL.keys.forEach(d=>{p[d]=this.totalALL[d]}),this.Vendor.Visible)if(0==this.VendorWHERE.length&&m.Tables[2].length>0&&parseInt(m.Tables[2][0].VendorID)>0)this.Vendor.SelectedValue=parseInt(m.Tables[2][0].VendorID),p.Vendor=m.Tables[2][0].VendorName,this.VendorWHERE="1=1";else{let d=m.Tables[2].filter(u=>u.VendorID==this.Vendor.SelectedValue);d>0&&(p.Vendor=d[0].VendorName)}else{let d=m.Tables[2].filter(u=>u.ProductID==this.ProductsIDs[T]);d.length>0?(p.Vendor=d[0].VendorName,p.Vendor_Key=d[0].VendorID):p.Vendor_Key=0}if(I=S.filter(d=>d.ProductID==this.ProductsIDs[T]),I.length>0)for(let d=1;d<M.length;d++)try{p[M[d]]=I[0][M[d]]}catch{}if(this.ReportSelectedNodes.length>0)if(this.ProductsByVoucher_Temp){p.VoucherNo=this.dsProduct.Tables[0][T].VoucherNo,p.ReorderDetailsID=this.dsProduct.Tables[0][T].ReorderDetailsID;let d=this.ReportSelectedNodes[T].Tree;if(null!=d)for(let u=0;u<d.length;u++){let n=d[u];if(null!=n.value){if(!this.ReOrderGrid.TableColumns.Contains(n.ROColID)){Logger.ErrorLog("Reorder Column not found: "+n.ROColID);continue}n.IsDimension?(p[n.ROColID]=n.value,this.ReOrderGrid.TableColumns.Contains(n.ROColID+"_ID")?p[n.ROColID+"_ID"]=n.DimensionID:this.ReOrderGrid.TableColumns.Contains("Vendor_Key")&&"Vendor"==n.ROColID&&(p.Vendor_Key=n.DimensionID)):"FLOAT"==n.Type||"INT"==n.Type?o.J0.IsNum(n.value)&&(p[n.ROColID]=o.J0.Double(n.value)):"DATE"==n.Type?o.J0.isValidDate(n.value)&&(p[n.ROColID]=o.J0.ParseDate(n.value)):p[n.ROColID]=n.value}}}else this.ReportSelectedNodes.filter(d=>d.Id==this.ProductsIDs[T]).forEach(d=>{let u=d.Tree;if(null!=u)for(let n=0;n<u.length;n++){let r=u[n];if(null!=r.value){if(!this.ReOrderGrid.TableColumns.Contains(r.ROColID)){Logger.ErrorLog("Reorder Column not found: "+r.ROColID);continue}r.IsDimension?(p[r.ROColID]=r.value,this.ReOrderGrid.TableColumns.Contains(r.ROColID+"_ID")&&(p[r.ROColID+"_ID"]=r.DimensionID)):"FLOAT"==r.Type||"INT"==r.Type?o.J0.IsNum(r.value)&&(i=o.J0.Double(r.value),p[r.ROColID]=null==p[r.ROColID]?i:parseFloat(p[r.ROColID])+i):"DATE"==r.Type?o.J0.isValidDate(r.value)&&(p[r.ROColID]=o.J0.ParseDate(r.value)):p[r.ROColID]=null==p[r.ROColID]?r.value:p[r.ROColID].toString()+","+r.value.toString()}}});p.Sno=++this.sno,this.ReOrderGrid.TableColumns.Contains("GroupNo")&&(p.GroupNo=this.GroupNo),this.ReOrderGrid.addRow(p),this.ReOrderGrid.EvaluateFormulas(p,!0)?this.ReOrderGrid.removeRow(p):(t=o.J0.Double(p.Variance),t<0&&(p.Variance_RED="1")),this.IsKitProjection&&this.KitWHERE.length>0&&(t=this.CalculateKitProjection(this.ObjArray,this.ProductsIDs[T],this.dsProduct),p.Variance=t,p.Variance_RED="0"),T==this.ProductsIDs.length-1&&this.ShowBOMProducts==v.BOM&&this.BomWHERE.length>0&&this.AddSubTotal(this.indGrpColumn,V[0].BOMName.toString(),this.GroupNo)}this.RecordCount="[Displaying "+(this.iLoop+this.ChunkSize)+" of "+this.ProductsIDs.length+" Rows]",this.iLoop+=this.ChunkSize,this.ReOrderGrid.refreshDataView(),this.LoadReorderGrid_CallBack()})}}LoadReorderGrid_Complete(){this.IsKitProjection&&this.KitWHERE.length>0&&this.CheckDuplicateKitProducts(),this.RecordCount="",this.worker_RunWorkerCompleted(null,null)}AddSubTotal(s,e,t){let i=this.ReOrderGrid.NewRow();i[this.ReOrderGrid.TableColumns[s]]=" Total :: "+e,i.StyleIsBold=1,i.GroupNo=t,i.IsGroupRow=!0;for(let l=1;l<this.ReOrderGrid.Columns.length;l++)this.ReOrderGrid.Columns[l].ShowTotal&&this.ReOrderGrid.TableColumns.Contains(this.ReOrderGrid.Columns[l].DisplayMember)&&(i[this.ReOrderGrid.Columns[l].DisplayMember]=this.ReOrderGrid.Table.filter(a=>a.GroupNo==t).Compute("sum",this.ReOrderGrid.Columns[l].DisplayMember));this.ReOrderGrid.addRow(i)}RefreshReOrderGridColumns(){let s=new Array;this.ReOrderGrid.Columns.forEach(e=>{s.push(e)}),this.ReOrderGrid.Columns=s}CalculateKitProjection(s,e,t){let i=0,l="",a=t.Tables[1].filter(m=>m.ParentProductID==e);if(a.forEach(m=>{l.length>0&&(l+=","),l+=m.ProductID}),l.length>0){let m,c=0,B=0;s[0]=l;let I=C.d.inventory.GetReOrderLevelData(s);I.Columns[0].push("RequiredQty");let y,M=I.Tables[0];for(let V=0;V<a.length;V++){let F=a[V];if(y=M.filter(d=>d.ProductID==F.ProductID),0==y.length)continue;for(let d=0;d<this.totalSELECTED.length;d++)this.totalSELECTED[this.totalSELECTED.keys[d]]=0;let T=this.ReOrderGrid.NewRow();I.Columns[0].forEach(d=>{this.ReOrderGrid.TableColumns.Contains(d)&&(T[d]=y[0][d])}),T.ProductName_Key=y[0].ProductID,y.forEach(d=>{m=d.TAGID.toString(),this.LocationCols.ContainsKey(m)?this.LocationCols[m].forEach(u=>{T[u+"_"+m]=d[u],this.totalSELECTED.ContainsKey(u)&&(B=o.J0.Double(d[u]),this.totalSELECTED[u]+=B)}):"-1"==m&&this.totalALL.keys.forEach(u=>{T[u+"_ALL"]=d[u]})}),this.totalSELECTED.keys.forEach(d=>{T[d+"_SELECTED"]=this.totalSELECTED[d]}),this.totalALL.keys.forEach(d=>{T[d]=this.totalALL[d]}),this.ReOrderGrid.EvaluateFormulas(T,!0),c=o.J0.Double(T.Variance);let p=parseFloat(F.KitQty);if(c<p){i=0;break}{let d=Math.floor(c/p);(0==i||i>d)&&(i=d)}}}return i>0&&a.forEach(m=>{let c=parseInt(m.ProductID);this.dicKitProjection.ContainsKey(c)||this.dicKitProjection.push(c,new Array),this.dicKitProjection[c].push(e)}),i}CheckDuplicateKitProducts(){let s=0;this.ReOrderGrid.Table.forEach(e=>{if(s=o.J0.Double(e.Variance),s>0)for(let t=0;t<this.dicKitProjection.keys.length;t++){let i=this.dicKitProjection[t];if(i.Contains(parseInt(e.ProductName_Key))&&i.length>1){e.Variance_RED="1";break}}})}LoadTreeData(s){this.tree=new Array;let e=o.VB.SelectSingleNode(s,"TreeFilter"),t=0;if("True"==C.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==C.d.SessionManager.Preferences["LW Reports"]?t=50002:C.d.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(t=o.J0.Int(C.d.SessionManager.Preferences["Maintain Dimensionwise stock"])),50001==t){var i=this.CostCenters.Items.find(S=>"50001"==S.Value);null!=i&&(i.Aliasname="");let h=!1;if(o.VB.SelectNodes(s,"TreeFilter/FilterDef").forEach(S=>{"50001"==o.VB.SelectSingleNode(S,"CCID").innerHTML&&(h=!0)}),!h){let S=0==o.VB.SelectNodes(e,"FilterDef").length?"1":"0";S="<CCID>50001</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+S+"</IsDefaultCC><DefaultValues>"+C.d.SessionManager.DivisionID+"</DefaultValues>",S="<FilterDef>"+S+"</FilterDef>",o.VB.AppendChild(e,S)}}if(50002==t){var l=this.CostCenters.Items.find(b=>"50002"==b.Value);null!=l&&(l.Aliasname="");let h=null,S=o.VB.SelectNodes(s,"TreeFilter/FilterDef");for(let b=0;b<S.length;b++){let V=S[b];if("50002"==o.VB.SelectSingleNodeText(V,"CCID")){h=V;break}}let M=o.VB.SelectSingleNode(this.xDocPref.DocumentElement,"SelectAllLocations"),G=null!=M&&"1"==M.innerHTML;if(null==h){let b=0==o.VB.SelectNodes(e,"FilterDef").length?"1":"0";b=G||0==C.d.SessionManager.LocationID?"<CCID>50002</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+b+"</IsDefaultCC><DefaultValues>"+C.d.SessionManager.LocationWhere+"</DefaultValues>":"<CCID>50002</CCID><GridViewID>0</GridViewID><IsDefaultCC>"+b+"</IsDefaultCC><DefaultValues>"+C.d.SessionManager.LocationID+"</DefaultValues>",b="<FilterDef>"+b+"</FilterDef>",o.VB.AppendChild(e,b)}else{let b=o.VB.SelectSingleNode(h,"DefaultValues");if(null!=b)if(G)b.innerHTML=C.d.SessionManager.LocationWhere;else if(0==b.innerHTML.length)b.innerHTML=0!=C.d.SessionManager.LocationID?C.d.SessionManager.LocationID.toString():C.d.SessionManager.LocationWhere;else{let V=b.innerHTML.split(","),F=C.d.SessionManager.LocationWhere.split(","),T="";V.forEach(p=>{F.Contains(p)&&(T.length>0&&(T+=","),T+=p)}),b.innerHTML=T}}}if("1"!=C.d.SessionManager.UserID&&"1"!=C.d.SessionManager.RoleID&&null!=this.CostCenters){let h=C.d.SessionManager.Preferences.ContainsKey("Dimension List")?C.d.SessionManager.Preferences["Dimension List"].split(","):[],S=this.CostCenters.Items.filter(F=>"1"==F.Aliasname),M=C.d.SessionManager.Preferences.ContainsKey("RoleDimension List")?C.d.SessionManager.Preferences["RoleDimension List"].split(","):[],G=null,b="",V="";for(let F=0;F<S.length;F++){let T=S[F];G=null,b=V="",(h.Contains(T.Value)||M.Contains(T.Value))&&(C.d.report.IsGroupNode(parseInt(T.Value),0),C.d.report.DataSet("RPT017",h.Contains(T.Value)+"~"+M.Contains(T.Value),T.Value,C.d.SessionManager.UserID+"~"+C.d.SessionManager.RoleID).Tables[0].forEach(r=>{b.length>0&&(b+=","),b+=r.NodeID.toString()}));let p=null,d=o.VB.SelectNodes(s,"TreeFilter/FilterDef");for(let u=0;u<d.length;u++){let n=d[u];if(o.VB.SelectSingleNodeText(n,"CCID")==T.Value){p=n;break}}if(null==p){let u;u=0==o.VB.SelectNodes(e,"FilterDef").length?"<CCID>"+T.Value+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>1</IsDefaultCC><DefaultValues>"+b+"</DefaultValues>":"<CCID>"+T.Value+"</CCID><GridViewID>0</GridViewID><IsDefaultCC>0</IsDefaultCC><DefaultValues>"+b+"</DefaultValues>",u="<FilterDef>"+u+"</FilterDef>",o.VB.AppendChild(e,u)}else{let u=p.SelectSingleNode("DefaultValues");null!=u&&0==u.innerHTML.length&&(u.innerHTML=b)}}}let c,a=0,m=0,B=!1,I=o.VB.SelectNodes(s,"TreeFilter/FilterDef/IsDefaultCC");if(I.length>0){for(let h=0;h<I.length;h++)if("1"==I[h].innerHTML){B=!0;break}B||(I[0].innerHTML="1")}let y=o.VB.SelectNodes(s,"TreeFilter/FilterDef");for(let h=0;h<y.length;h++){let S=y[h],M=o.VB.SelectSingleNode(S,"CCID").innerHTML,G=this.CostCenters.Items.find(V=>V.Value==M);if(null==G||(c="44"!=M&&"50"!=M||null==o.VB.SelectSingleNode(S,"LookupTypeID")?0:parseInt(o.VB.SelectSingleNode(S,"LookupTypeID").innerHTML),("44"==G.Value||"50"==G.Value)&&G.Parent!=c.toString()))continue;let b=new J.x(parseInt(M),c.toString(),G.Name,this);b.SetSelectedNodes(S),"1"==o.VB.SelectSingleNode(S,"IsDefaultCC").innerHTML&&(G.CurrID=1,m=parseInt(M),a=null!=o.VB.SelectSingleNode(S,"GridViewID")?parseInt(o.VB.SelectSingleNode(S,"GridViewID").innerHTML):0),"1"==o.VB.SelectSingleNode(S,"IsDefaultCC").innerHTML&&(this.CostCenters.SelectedValue=M,this.CostCenters.SelectedItem=G,this.OnCostCenterChange(null)),"1"==G.Aliasname&&(b.DeleteButtonVisibility=!1),this.CostCenterFilters.push(b)}}OnButtonClick(s){if(this.DisplayMessage="","Regenerate"==s)this.GridVisibility=!1,this.FilterVisibility=!0;else if("PostFilters"==s)this.ShowPostFilter=!0,this.BOMGrid.refreshUI(),this.BOMGrid.refreshDataView();else if("PostFilterOK"==s||"PostFilterClear"==s)null!=this.PostDataFetchFilterFields&&this.FilterorClear(s);else if("PostFilterCancel"==s)this.ShowPostFilter=!1;else if("NEXT"==s)this.LoadNextDocument("NEXT");else if("CLOSE"==s)this.DocumentVisibility=!1,this.GridVisibility=!0;else if("Post"==s)this.PostDocuments();else if("PostClose"==s)if(this.postworkerIsBusy){if(confirm("Do you want to cancel posting?"))return this.postworkerCancel=!0,void(this.AutoPostMessage="")}else this.ShowAutoPost=!1,this.AutoPostMessage="";else if("FilterOK"==s){let i=0,l=0,a=0;try{i=parseInt(this.Slot1.Text)}catch{return void(this.DisplayMessage="Enter Valid Number")}try{l=parseInt(this.Slot2.Text)}catch{return void(this.DisplayMessage="Enter Valid Number")}try{a=parseInt(this.Slot3.Text)}catch{return void(this.DisplayMessage="Enter Valid Number")}if(i>=l||l>=a)return void(this.DisplayMessage="Enter Valid Slot Numbers");if(this.DisplayMessage="",this.FilterVisibility=!1,this.GridVisibility=!0,null!=this.DWPCProfile){this.dtPCProfile=null,this.lstPCProfiles.Clear();let m=!1,c="",B=new Array;var e=this.CostCenterFilters.find(I=>40==I.CostCenterID&&null!=I.SelectedNodes&&I.SelectedNodes.length>0);e?.SelectedNodes.filter(I=>0==I.IsGroup).forEach(I=>{B.Contains(I.Id)||(B.push(I.Id),c.length>0&&(c+=","),c+=I.Id.toString())});for(let I=this.ColumnsSource.length-1;I>=0;I--){let y=this.ColumnsSource[I];null!=y.DisplayMember&&y.DisplayMember.startsWith("DWPCProfile")&&(m=!0,this.ReOrderGrid.TableColumns.Contains(y.DisplayMember)&&this.ReOrderGrid.TableColumns.Remove(y.DisplayMember),this.ColumnsSource.Remove(y))}if(c.length>0){m=!0;let I=[];I.push(c),I.push(C.d.SessionManager.UserID),I.push(C.d.SessionManager.LanguageID),this.dtPCProfile.SortBy(["ProfileName","Dimension"]);let y=null;this.dtPCProfile.ToTable(!0,["ProfileID","DimID","ProfileName","Dimension"]).forEach(h=>{var S=this.DWPCProfile.Clone();h.ProfileID.toString()!=y?(y=h.ProfileID.toString(),S.Header=h.ProfileName.toString()+"\r\n"+h.Dimension.toString()):S.Header=h.Dimension.toString(),S.DisplayMember="DWPCProfile_"+h.ProfileID.toString()+"_"+h.DimID.toString(),null==this.ColumnsSource.find(M=>M.DisplayMember==S.DisplayMember)&&(this.lstPCProfiles.push(S.DisplayMember,"ProfileID="+h.ProfileID.toString()+" and DimID="+h.DimID.toString()),this.ReOrderGrid.TableColumns.push(S.DisplayMember),this.ColumnsSource.push(S))})}m&&(this.ReOrderGrid.RefreshColumns(),this.ColumnsSource=this.ReOrderGrid.Columns)}this.ReOrderGrid.Table.Clear(),this.worker.IsBusy=!0,this.worker_DoWork(null,null)}else if("FilterCancel"==s)null!=this.ReOrderGrid.Table?(this.FilterVisibility=!1,this.GridVisibility=!0):C.d.page.removeTab(this);else if("Export"==s){let i;this.ReOrderGrid.ExportExcelNew(0,this.Title,this.DateFilter,i),i.length>0&&(this.DisplayMessage=i)}else if("Save"==s){let i;if(this.DialogAction="Save",i.IsOkClick){Logger.GetLogFilePath(),(new Date).ToString("_yyyyMMdd_HHmmss");let a={Tables:[]};a.Tables.push(this.ReOrderGrid.Table.Copy()),null!=this.BOMGrid.Table&&a.Tables.push(this.BOMGrid.Table.Copy());let m="";m+="<AttachmentsXML><Row ",o.J0.IsEmpty(i.List.SelectedValue)?(m+=' Action="NEW"',m+=' AttachmentID="0"'):(m+=' Action="MODIFY"',m+=' AttachmentID="'+i.List.SelectedValue+'"'),C.d.report.GetReportData(5,this.ReportID,m.toString()),this.ProfileName=i.Name.Text,this.RefreshDateFilter()}}else if("Open"==s)try{let i;if(this.DialogAction="Open",i.IsOkClick){let l,a=new o.VB;if(a.ReadXml(l),this.ReOrderGrid.Table=a.Tables[0],this.ReportData=this.ReOrderGrid.Table,this.ProfileName=i.Name.Text,this.RefreshDateFilter(),a.Tables.Contains("BOM")){if(this.BOMGrid.Table=a.Tables.BOM,this.BOMGrid.Table.length>0){this.BOMGrid.Visible=!0;var t=this.CostCenterFilters.find(m=>76==m.CostCenterID);null==t&&((t=new J.x(76,"","Bill Of Material",this)).SelectedNodes=new Array,this.CostCenterFilters.push(t)),this.BOMGrid.Table.forEach(m=>{if(null!=m.BOMID){let c=new ee.n;c.Id=parseInt(m.BOMID),t.SelectedNodes.push(c)}}),t.SelectedNodesTag="[FILTER]"}}else null!=this.BOMGrid.Table&&this.BOMGrid.Clear()}}catch(i){Logger.ErrorLog("Open File Error:",i)}}OnCostCenterChange(s){var e=this;return(0,g.A)(function*(){if(!o.J0.IsEmpty(e.CostCenters.SelectedValue))if(null!=e.CostCenters.SelectedItem&&50==parseInt(e.CostCenters.SelectedValue)){if(e.ReportWidth="480",e.ReportHeight="430",0==e.Report.length||e.Report[0].ReportID!=parseInt(e.CostCenters.SelectedItem.Parent)){e.ReportLoaded=!1;const{ReportViewModel:t}=yield Promise.all([D.e(9891),D.e(534),D.e(3884),D.e(7030),D.e(5984),D.e(8405),D.e(895),D.e(5819),D.e(2963),D.e(108),D.e(2290),D.e(8024),D.e(3364),D.e(9128),D.e(1938),D.e(2726),D.e(4065),D.e(2014),D.e(2771),D.e(6084),D.e(4882),D.e(4119),D.e(2076)]).then(D.bind(D,39026));let i=new t;i.ReportViewModel_Document(112,"<XML></XML>",parseInt(e.CostCenters.SelectedItem.Parent),!1,null,null),i.ShowHeaderButtons=!1,i.ShowRightPanel=!1,i.SearchVisibility=!1,i.PrefetchReportTreeFilter=e,i.PrefetchReportTreeFilter.PrefetchReportType=112,e.Report.Clear(),e.Report.push(i)}e.TreeVisibility=!1}else{if(0==e.tree.length||e.tree[0].CostCenterID!=parseInt(e.CostCenters.SelectedValue)){let t=0;null!=e.CostCenters.SelectedItem&&!o.J0.IsEmpty(e.CostCenters.SelectedItem.Parent)&&(t=o.J0.Int(e.CostCenters.SelectedItem.Parent)),e.LoadCostCenterTree(parseInt(e.CostCenters.SelectedValue),t,0,null)}e.TreeVisibility=!0}})()}OnDocCallBack(){if(null!=this.Document&&this.Document.DialogResult){if(null==this.AutoPostGrid){this.AutoPostGrid=new x.vv,this.AutoPostGrid.Width="",this.AutoPostGrid.Table=[],this.AutoPostGrid.TableColumns.push("Sno"),this.AutoPostGrid.TableColumns.push("DocNo"),this.AutoPostGrid.TableColumns.push("ErrorMessage");let s=new Array,e=new E.O7;e.Header="#",e.DisplayMember="Sno",e.Width=35,e.ReadOnly=!0,s.push(e),e=new E.O7,e.Header="Voucher No",e.DisplayMember="DocNo",e.DataType="LINK_VOUCHER",e.Width=130,e.ReadOnly=!0,s.push(e),e=new E.O7,e.Header="Error Message",e.DisplayMember="ErrorMessage",e.Width=350,e.ReadOnly=!0,s.push(e),this.AutoPostGrid.Columns=s}this.AutoPostGrid.Clear();for(let s=0;s<100;s++)this.AutoPostGrid.addEmptyRow();this.AutoPostMessage="Posting Documents... Please wait.",this.ShowAutoPost=!0,this.postworker_DoWork("",{})}}LoadCostCenterTree(s,e,t,i){this.tree.Clear();let a,l="";if(50002==s&&"1"!=C.d.SessionManager.RoleID&&"True"==C.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==C.d.SessionManager.Preferences["LW Reports"]&&(l=o.J0.IsEmpty(C.d.SessionManager.LocationWhere)?"A.NodeID IN (-1234)":"A.NodeID IN ("+C.d.SessionManager.LocationWhere+")"),null==i)for(let B=0;B<this.CostCenterFilters.length;B++){let I=this.CostCenterFilters[B];if(I.CostCenterID==s&&I.LookupTypeID==e){i=I.SelectedNodes;break}}44==s&&e>0&&(l="A.LookupType="+e);let m="";o.VB.SelectNodes(this.xDocPref.DocumentElement,"GridViewFilter").forEach(B=>{B.attributes.CCID.value==s&&(m+=B.attributes.GID.value+",")}),a=new te.T,null==i?a.TreeViewModel_5(s,this,t,l,m):a.TreeViewModel_6(s,this,t,l,i,m),a.LookupTypeID=e,a.HeaderVisiblity=!1,a.OnNodeSelected||(a.OnNodeSelected=new Q.Yk,a.OnNodeSelected.Subscribe(this,"OnNodeSelected"),this.NodeSelectedCallBack=new Q.Yk,this.NodeSelectedCallBack.Subscribe(this,"OnNodeSelectedCallBack")),this.tree.push(a)}OnNodeSelectedCallBack(){if(76==this.tree[0].CostCenterID)this.tree[0].SelectedNodes.length>0?(this.BOMGrid.Visible=!0,this.BOMGrid.Clear(),this.tree[0].SelectedNodes.forEach(e=>{let t={};t.BOMID=e.Id,t.BOM=e.Text.length>0?e.Text[0]:"BOM";let i=this.BOMGrid.Table.filter(l=>l.BOMID==e.Id);i.length>0?(t.Qty=i[0].Qty,t.UnitType=i[0].UnitType,t.UOM=i[0].UOM,t.UOM_Key=i[0].UOM_Key):(t.Qty=1,t.UnitType="1"),this.BOMGrid.addRow(t)}),null!=(s=this.CostCenterFilters.find(e=>76==e.CostCenterID))&&(s.IsVisible=!1)):(this.BOMGrid.Visible=!1,null!=(s=this.CostCenterFilters.find(t=>76==t.CostCenterID))&&(s.IsVisible=!1));else if(-102==this.tree[0].CostCenterID)if(this.tree[0].SelectedNodes.length>0){if(null==this.KitGrid.Table){this.KitGrid.Table=[],this.KitGrid.TableColumns.push("KitID"),this.KitGrid.TableColumns.push("Kit"),this.KitGrid.TableColumns.push("Qty");let t=new Array,i=new E.O7;i.Header="Kit",i.DisplayMember="Kit",i.Width=160,i.ReadOnly=!0,t.push(i),i=new E.O7,i.Header="Qty",i.DisplayMember="Qty",i.DataType="FLOAT",i.Width=70,i.IsCalculated=1,i.DisableTab=!0,i.DecimalPoints=C.d.SessionManager.Preferences.DecimalsinQty,t.push(i),this.KitGrid.Columns=t}this.KitGrid.Visible=!0,this.KitGrid.Clear(),this.tree[0].SelectedNodes.forEach(t=>{if(!t.IsGroup){let i={};i.KitID=t.Id,i.Kit=t.Text.length>0?t.Text[0]:"Kit";let l=this.KitGrid.Table.filter(a=>a.KitID==t.Id);i.Qty=l.length>0?l[0].Qty:1,this.KitGrid.addRow(i)}}),null!=(s=this.CostCenterFilters.find(t=>-102==t.CostCenterID))&&(s.IsVisible=!1)}else this.KitGrid.Visible=!1,null!=(s=this.CostCenterFilters.find(t=>-102==t.CostCenterID))&&(s.IsVisible=!1);else if(78==this.tree[0].CostCenterID)if(this.tree[0].SelectedNodes.length>0){if(null==this.MOGrid.Table){this.MOGrid.Table=[],this.MOGrid.TableColumns.push("MOID"),this.MOGrid.TableColumns.push("MO"),this.MOGrid.TableColumns.push("Qty");let t=new Array,i=new E.O7;i.Header="MO",i.DisplayMember="MO",i.Width=140,i.ReadOnly=!0,t.push(i),i=new E.O7,i.Header="Qty",i.DisplayMember="Qty",i.DataType="FLOAT",i.Width=90,i.IsCalculated=1,i.DisableTab=!0,i.DecimalPoints=C.d.SessionManager.Preferences.DecimalsinQty,t.push(i),this.MOGrid.Columns=t}this.MOGrid.Visible=!0,this.MOGrid.Clear(),this.tree[0].SelectedNodes.forEach(t=>{if(!t.IsGroup){let i={};i.MOID=t.Id,i.MO=t.Text.length>0?t.Text[0]:"MO";let l=this.MOGrid.Table.filter(a=>a.MOID==t.Id);i.Qty=l.length>0?l[0].Qty:1,this.MOGrid.addRow(i)}}),null!=(s=this.CostCenterFilters.find(t=>78==t.CostCenterID))&&(s.IsVisible=!1)}else{var s;this.MOGrid.Visible=!1,null!=(s=this.CostCenterFilters.find(t=>78==t.CostCenterID))&&(s.IsVisible=!1)}}postworker_DoWork(s,e){this.indPostIndex=0,this.ShowAutoPost=!0,this.postworkerCancel=!1,this.postworkerIsBusy=!0,this.LoadNextDocument("FIRST")}postworker_Completed(){this.postworkerIsBusy=!1;let s=this.AutoPostGrid.Table.filter(t=>!o.J0.IsEmpty(t.DocNo)),e=this.AutoPostGrid.Table.filter(t=>!o.J0.IsEmpty(t.Errormessage));0==s.length&&0==e.length?this.AutoPostMessage="No Data Found to Post":s.length>0&&e.length>0?this.AutoPostMessage="Partially Posted":0==s.length&&e.length>0?this.AutoPostMessage="Error in Posting":s.length>0&&0==e.length&&(this.AutoPostMessage="Posting Completed")}PostDocuments(){if(this.iVendorCount=0,this.lstVendors.Clear(),this.lstPostDocsGroup.Clear(),this.dtVoucherDetails=null,this.Document=null,this.Vendor.Visible)if(this.PostDocsGroupBy.length>0){let s=this.PostDocsGroupBy.split(",");this.ReOrderGrid.Table.ToTable(!0,s).forEach(e=>{let t;this.lstVendors.push(this.Vendor.SelectedValue.toString());for(let i=0;i<s.length;i++)t=t.filter(null==e[s[i]]?l=>null==l[s[i]]:l=>l[s[i]]==e[s[i]]);t=t(i=>i.OrderQty>0),this.lstPostDocsGroup.push(t)})}else this.lstVendors.push(this.Vendor.SelectedValue.toString());else{let s=["Vendor_Key"];this.PostDocsGroupBy.length>0&&s.AddRange(this.PostDocsGroupBy.split(",")),this.ReOrderGrid.Table.ToTable(!0,s).forEach(e=>{this.lstVendors.push(o.J0.StringValue(e.Vendor_Key));let t=this.ReOrderGrid.Table;for(let i=0;i<s.length;i++)t=t.filter(null==e[s[i]]?l=>null==l[s[i]]:l=>l[s[i]]==e[s[i]]);t=t.filter(i=>i.OrderQty>0),this.lstPostDocsGroup.push(t)})}this.lstVendors.length>0&&(this.dvItems=this.ReOrderGrid.Table,Z.RibbonExtViewModel.GetDocumentObject(parseInt(this.Documents.SelectedValue),this.Documents.SelectedItem.Name,!1).then(s=>{this.Document=s,this.Document.GenratePrefix=!0,this.Document.SaveCallBack=new Q.Yk,this.Document.SaveCallBack.Subscribe(this,"OnSaveCallBack"),this.Document.SaveCallBackMethod.Subscribe(this,"SaveCallBack_Complete"),this.Document.DialogResult?this.OnDocNumberDelegate():this.Document.DocNumberDelegate.Subscribe(this,"OnDocNumberDelegate")}))}OnDocNumberDelegate(){if(this.DocumentNumber=this.Document.DocumentNumber,this.IsAutoPost?(this.DocDefaultCCFields.Clear(),this.Document.ScreenObject._CCFields.filter(s=>s instanceof j.y$).forEach(s=>{let e=s;e.CCID>5e4&&!this.DocDefaultCCFields.ContainsKey(e.CCID)&&this.DocDefaultCCFields.push(e.CCID,e.SelectedValue)})):(this.GridVisibility=!1,this.DocumentVisibility=!0),this.DocumentLinkDimensions.Clear(),this.strDimensionLinkQry="",this.Document.ScreenObject.Preferences.ContainsKey("DimensionWise")&&""!=this.Document.ScreenObject.Preferences.DimensionWise){let s=0;this.Document.ScreenObject.Preferences.DimensionWise.split(",").forEach(t=>{if(s=o.J0.Int(t),s>0&&s>5e4){this.strDimensionLinkQry+=",DCC.dcCCNID"+(s-5e4);var i=this.Document.ScreenObject._CCFields.find(l=>l instanceof j.y$&&l.CCID==s);i&&this.DocumentLinkDimensions.push(i)}})}this.IsAutoPost?this.OnDocCallBack():this.LoadNextDocument("FIRST")}LoadNextDocument(s){if(this.iVendorCount>=this.lstVendors.length)return this.DocumentVisibility=!1,this.GridVisibility=!0,void(this.IsAutoPost&&this.postworker_Completed());if(this.DocumentLinkDimensions.length>0){let e=new Array;this.DocumentLinkDimensions.forEach(t=>{var i=this.Document.ScreenObject._CCFields.find(l=>l instanceof j.y$&&l.CCID==t.CCID);null!=i&&e.push(i)}),this.DocumentLinkDimensions=e}if("NEXT"==s&&this.Document.clear(1),this.iVendorCount<this.lstVendors.length){if(this.dvItems=this.lstPostDocsGroup.length>this.iVendorCount?this.lstPostDocsGroup[this.iVendorCount]:this.ReOrderGrid.Table.filter(e=>e.OrderQty>0),0==this.dvItems.length)return this.iVendorCount++,void this.LoadNextDocument(this.IsAutoPost?"SAVE":"NEXT");this.lstVendors[this.iVendorCount].length>0&&(this.Document.ScreenObject.IsPurchase?null!=this.Document.ScreenObject.CreditAccount&&(this.Document.ScreenObject.CreditAccount.SelectedValue=o.J0.Int(this.lstVendors[this.iVendorCount]),this.dvItems.Contains("Vendor")&&this.dvItems[0].Vendor_Key.toString()==this.lstVendors[this.iVendorCount]&&(this.Document.ScreenObject.CreditAccount.Name._SelectedValueText=this.dvItems[0].Vendor.toString()),this.Document.ScreenObject.OnGetReference(this.Document.ScreenObject.CreditAccount.Name)):null!=this.Document.ScreenObject.DebitAccount&&(this.Document.ScreenObject.DebitAccount.SelectedValue=o.J0.Int(this.lstVendors[this.iVendorCount]),this.dvItems.Contains("Vendor")&&this.dvItems[0].Vendor_Key.toString()==this.lstVendors[this.iVendorCount]&&(this.Document.ScreenObject.DebitAccount.Name._SelectedValueText=this.dvItems[0].Vendor.toString()),this.Document.ScreenObject.OnGetReference(this.Document.ScreenObject.DebitAccount.Name)));for(let e=this.Document.GRIDTABLE.length;e<this.dvItems.length+5;e++){let t=this.Document.ScreenObject.GridDataObj.NewRow();this.Document.ScreenObject.GridDataObj.addRow(t)}if(this.ProductsByVoucher_Temp){let t,e="";this.dvItems.ToTable(!0,["ReorderDetailsID"]).forEach(I=>{e.length>0&&(e+=","),e+="'"+I.ReorderDetailsID.toString()+"'"});let i="SELECT D.InvDocDetailsID,D.ProductID,D.CostCenterID,D.VoucherNo"+this.strDimensionLinkQry+" FROM INV_DocDetails D with(nolock)";this.strDimensionLinkQry.length>0&&(i+=" inner join com_docccdata DCC on DCC.InvDocDetailsID=D.InvDocDetailsID"),i+=" WHERE D.InvDocDetailsID IN ("+e+")";let l=C.d.report.ReportDataTable("RPT022",this.IsReportDB,i),a=0,c=new Array,B=new Array;for(let I=0;I<this.dvItems.length;I++)for(c.Clear(),B.Clear(),a=0,e=this.dvItems[I].VoucherNo.toString(),t=this.dvItems[I].ReorderDetailsID.toString();I<this.dvItems.length;I++){let y=l.filter(h=>h.VoucherNo==e&&h.InvDocDetailsID==this.dvItems[I].ReorderDetailsID);if(y.length>0){let h={};h.InvDocDetailsID=parseInt(y[0].InvDocDetailsID),a=parseInt(y[0].CostCenterID),c.push(h)}if(B.push(this.dvItems[I]),I==this.dvItems.length-1||this.dvItems[I+1].VoucherNo.toString()!=e){let h=null;a>0&&null!=this.Document.ScreenObject.Link&&(h=this.Document.ScreenObject.Link.LinkCombo.Items.find(S=>S.Parent==a.toString())),null!=h?(this.strDimensionLinkQry.length>0&&y.length>0&&this.DocumentLinkDimensions.forEach(S=>{o.J0.StringIsNullOrEmpty(y[0][S.DBColumnName])||(S.SelectedValue=parseInt(y[0][S.DBColumnName]))}),this.Document.FillLink(e,parseInt(h.Value),c,new Array),this.Document.RefreshGrid||(this.Document.RefreshGrid=!0),B.forEach(S=>{let M=this.Document.GRIDTABLE.filter(G=>G.LinkedInvDocDetailsID==S.ReorderDetailsID);M.length>0&&(M[0][M[0].LinkedFieldName.toString()]=S.OrderQty)})):B.forEach(S=>{this.AddProductToDocument(S)});break}}if(0==this.Document.GRIDTABLE.length||null==this.Document.GRIDTABLE[0].ProductID_Key)return this.iVendorCount++,void this.LoadNextDocument(this.IsAutoPost?"SAVE":"NEXT")}else this.dvItems.forEach(e=>{this.AddProductToDocument(e)});this.iVendorCount++,this.IsAutoPost&&this.AutoSaveDocument()}}AddProductToDocument(s){let e=!1,t=null;for(let i=0;i<this.Document.ScreenObject.GridData.length;i++){let l=this.Document.ScreenObject.GridData[i];if(""==o.J0.String(l.ProductID_Key)){t=l;break}}null==t&&(e=!0,t=this.Document.ScreenObject.GridDataObj.NewRow()),t.ProductCode=s.ProductCode.toString(),t.ProductName=s.ProductName.toString(),t.ProductID_Key=s.ProductName_Key.toString(),this.Document.AddProductData(t,!1,!1),t.Quantity=s.OrderQty,s.UOM_Key.toString()!=t.Unit_Key.toString()?(t.Unit=s.UOM.toString(),t.Unit_Key=s.UOM_Key.toString(),this.Document.OnProductUnitChange(t)):""!=t.Quantity.toString()&&""!=t.UOMConversion.toString()?t.UOMConvertedQty=parseFloat(t.UOMConversion.toString())*parseFloat(t.Quantity.toString()):""!=t.Quantity.toString()&&(t.UOMConvertedQty=t.Quantity.toString()),this.DocumentMappingColumns.length>0&&this.DocumentMappingColumns.forEach(i=>{if(i.SectionName.startsWith("dcCCNID"))if(this.Document.ScreenObject.GridDataColumns.Contains(i.SectionName))t[i.SectionName]=s[i.DisplayMember],t[i.SectionName+"_Key"]=s[i.DisplayMember+"_ID"];else{var l=this.Document.ScreenObject._CCFields.find(m=>m.DBColumnName==i.SectionName);l instanceof j.y$&&null!=s[i.DisplayMember+"_ID"]&&(l.SelectedValue=parseInt(s[i.DisplayMember+"_ID"]),l.IsAutoLoad&&(l.SelectedValueText=s[i.DisplayMember].toString()))}else if(this.Document.ScreenObject.GridDataColumns.Contains(i.SectionName))t[i.SectionName]=s[i.DisplayMember];else{var a=this.Document.ScreenObject._TextFields.find(m=>m.DBColumnName==i.SectionName);if(null!=a)if(a instanceof W.Dw)a.Text=s[i.DisplayMember].toString();else if(a instanceof W.hV)a.Text=s[i.DisplayMember].toString();else if(a instanceof oe.e3)a.TextBox.Text=s[i.DisplayMember].toString();else if(a instanceof X.Lc)try{a.Date=o.J0.ParseDate(s[i.DisplayMember])}catch{}}}),e&&this.Document.ScreenObject.GridDataObj.addRow(t),this.Document.CalculateTotals(t,!1)}SaveCallBack_Complete(){if(this.IsAutoPost){if(this.postworkerCancel)return void(this.ShowAutoPost=!1);this.Document.RetValue<0&&(this.AutoPostGrid.Table[this.indPostIndex].ErrorMessage=this.Document.DisplayMessage),this.AutoPostGrid.Table[this.indPostIndex].Sno=this.indPostIndex+1,this.AutoPostGrid.invalidate(),this.indPostIndex++,this.LoadNextDocument("NEXT")}else this.iVendorCount<this.lstVendors.length?Z.RibbonExtViewModel.GetDocumentObject(parseInt(this.Documents.SelectedValue),this.Documents.SelectedItem.Name,!1).then(s=>{this.Document=s,this.Document.GenratePrefix=!0,this.Document.SaveCallBack=new Q.Yk,this.Document.SaveCallBack.Subscribe(this,"OnSaveCallBack"),this.LoadNextDocument("SAVE")}):(this.DocumentVisibility=!1,this.GridVisibility=!0)}OnSaveCallBack(s,e){return this.IsAutoPost&&this.AutoPostGrid.Table.length>this.indPostIndex&&(this.AutoPostGrid.Table[this.indPostIndex].DocNo=this.Document.ScreenObject.VoucherNo),""}AutoSaveDocument(){this.AutoPostGrid.Table.length>this.indPostIndex?this.Document.SaveInventoryDocument("Save",!1):(this.indPostIndex++,this.LoadNextDocument("NEXT"))}OnLinkClick(s,e,t){("ProductCode"==e||"ProductName"==e)&&null!=s.ProductName_Key&&Z.RibbonExtViewModel.ShowAddProductScreenViewModel(parseInt(s.ProductName_Key),"EDIT",0,!1)}OnGridBeginEdit(s,e,t){return"1"==o.J0.String(s.StyleIsBold)}GetDimensionFilter(s,e,t){let i="";return this.CostCenterFilters.forEach(l=>{if((l.SelectedNodes.length>0||!l.DeleteButtonVisibility&&t)&&l.CostCenterID>5e4&&e.Contains(l.CostCenterID.toString()))if(i+=" AND ",1==l.SelectedNodes.length)i+=s+(l.CostCenterID-5e4)+"="+l.SelectedNodes[0].Id;else{i+=s+(l.CostCenterID-5e4)+" IN (";for(let a=0;a<l.SelectedNodes.length;a++)a>0&&(i+=","),i+=l.SelectedNodes[a].Id;0==l.SelectedNodes.length&&(i+="-123"),i+=")"}}),i.toString()}GetFilterNodes(s){let e="";var t=this.CostCenterFilters.find(i=>i.CostCenterID==s);if(t&&t.SelectedNodes.length>0)if(1==t.SelectedNodes.length)e+=t.SelectedNodes[0].Id;else for(let i=0;i<t.SelectedNodes.length;i++)t.SelectedNodes[i].IsGroup||(e.length>0&&(e+=","),e+=t.SelectedNodes[i].Id);return e.toString()}FilterorClear(s){this.MessageVisibility=!1;let e=!0,t="";if("PostFilterClear"!=s){for(let i=0;i<this.PostDataFetchFilterFields.length;i++){let l=this.PostDataFetchFilterFields[i];if("None"!=l.Condition.SelectedValue)if(e=!1,"DATE"==l.DataType)"Between"==l.Condition.SelectedValue||"NotBetween"==l.Condition.SelectedValue?("NotBetween"==l.Condition.SelectedValue&&(t+=" not ("),t+="["+l.ColumnName+"] >= '"+l.FromDate.Date+"' and  ["+l.ColumnName+"] <= '"+l.ToDate.Date+"' ","NotBetween"==l.Condition.SelectedValue&&(t+=" ) "),t+=" and "):t+="["+l.ColumnName+"]"+l.Condition.SelectedItem.Parent+" '"+l.FromDate.Date+"' and ";else if("TIME"==l.DataType)"Between"==l.Condition.SelectedValue||"NotBetween"==l.Condition.SelectedValue?("NotBetween"==l.Condition.SelectedValue&&(t+=" not ("),t+="["+l.ColumnName+"] >= '"+l.FromDate.Date+"' and  ["+l.ColumnName+"] <= '"+l.ToDate.Date+"' ","NotBetween"==l.Condition.SelectedValue&&(t+=" ) "),t+=" and "):t+="["+l.ColumnName+"]"+l.Condition.SelectedItem.Parent+" '"+l.FromDate.Date+"' and ";else if("Between"==l.Condition.SelectedValue||"NotBetween"==l.Condition.SelectedValue)"NotBetween"==l.Condition.SelectedValue&&(t+=" not ("),null!=l.FromValue.TextBox.Text&&""!=l.FromValue.TextBox.Text.Trim()&&(t+="["+l.ColumnName+"] >= '"+l.FromValue.TextBox.Text+"' "),null!=l.ToValue.Text&&""!=l.ToValue.Text.Trim()&&(null!=l.FromValue.TextBox.Text&&""!=l.FromValue.TextBox.Text.Trim()&&(t+=" and "),t+="["+l.ColumnName+"] <= '"+l.ToValue.Text+"' "),"NotBetween"==l.Condition.SelectedValue&&(t+=" ) "),t+=" and ";else if(l.FromDropDown.Visible)if(l.FromDropDown.Items[0].IsChecked)t+=" 1=1 and ";else{let a="";a+="(",l.FromDropDown.Items.forEach(m=>{m.IsChecked&&("Equal"==l.Condition.SelectedValue?(a.length>1&&(a+=" OR "),a+=""==m.Name?"(["+l.ColumnName+"] is null or ["+l.ColumnName+"]='')":"["+l.ColumnName+"]='"+m.Name+"'"):(a.length>1&&(a+=" and "),a+="[NULL]"==m.Name?"(["+l.ColumnName+"] is not null and ["+l.ColumnName+"]<>'')":"["+l.ColumnName+"]<>'"+m.Name+"'"))}),1==a.length&&(a+="1!=1"),a+=") and ",t+=a.toString()}else null!=l.FromValue.TextBox.Text&&""!=l.FromValue.TextBox.Text.Trim()&&(t+="Contains"==l.Condition.SelectedValue||"NotContain"==l.Condition.SelectedValue?"["+l.ColumnName+"]"+l.Condition.SelectedItem.Parent+" '%"+l.FromValue.TextBox.Text+"%'  and ":"["+l.ColumnName+"]"+l.Condition.SelectedItem.Parent+" '"+l.FromValue.TextBox.Text+"' and ")}e&&(this.MessageVisibility=!0,this.DisplayMessage="Please choose at least one condition to filter")}if(""!=t&&t.length>4||"PostFilterClear"==s){if(null==this.ReOrderGrid.Table)return;"PostFilterClear"==s?(this.PostDataFetchFilterFields.forEach(l=>{l.Condition.SelectedValue="None",l.FromValue.TextBox.Text="",l.ToValue.Text=""}),this.ReOrderGrid.Table=this.ReportData):(this.PostFilterData=this.ReportData.Copy(),this.PostFilterData=L.d.FilterData(this.PostFilterData,this.PostDataFetchFilterFields),this.ReOrderGrid.Table=this.PostFilterData),this.ReOrderGrid.UpdateTotals(),this.ReOrderGrid.refreshDataView()}}onColumnCheckedChanged(s){try{if(null!=s){var e=this.ColumnsSource.find(t=>t.DisplayMember==s.ColumnName);if(e){e.IsVisible=!!s.ShowColumn;let t=new Array;this.ColumnsSource.forEach(i=>{t.push(i)}),this.ReOrderGrid.Columns=t,this.ReOrderGrid.RefreshColumns()}}}catch(t){Logger.ErrorLog("ReOrderLevelNewViewModel::Error onColumnCheckedChanged",t)}}OnContextMenuClick(s){var e=this;return(0,g.A)(function*(){let t,l=s,a=e.ReOrderGrid.SelectedItem,m="";m+="<XML>","RowReport"==l.Name&&(e.ReportID=parseInt(l.attributes.ID.value),o.VB.SelectNodes(l,"Filters/ColumnFilter").forEach(y=>{t=y.attributes.PID.value+"_ID",o.J0.IsEmpty(a[t])&&("ProductCode"==y.attributes.PID.value||"ProductName"==y.attributes.PID.value)&&(t="ProductName_Key"),null!=a[t]&&(m+="<Row ColID='"+y.attributes.CID.value+"' Value='"+a[t].toString()+"'/>")})),m+="</XML>";const{ReportViewModel:c}=yield Promise.all([D.e(9891),D.e(534),D.e(3884),D.e(7030),D.e(5984),D.e(8405),D.e(895),D.e(5819),D.e(2963),D.e(108),D.e(2290),D.e(8024),D.e(3364),D.e(9128),D.e(1938),D.e(2726),D.e(4065),D.e(2014),D.e(2771),D.e(6084),D.e(4882),D.e(4119),D.e(2076)]).then(D.bind(D,39026)),{ReportViewComponent:B}=yield Promise.all([D.e(3884),D.e(5054)]).then(D.bind(D,31503));let I=new c;I.ReportViewModel_Document(50,m.toString(),e.ReportID,!1,e,l),C.d.page.addNewTab({component:B,params:{obj:I}})})()}RefreshDateFilter(){this.DateFilter=this.FromDate.Date.ToString(C.d.SessionManager.Preferences["Date Format"]),this.DateFilter+="  to  "+this.ToDate.Date.ToString(C.d.SessionManager.Preferences["Date Format"]),this.ProfileName.length>0&&(this.DateFilter+=" ["+this.ProfileName+"]")}}}}]);