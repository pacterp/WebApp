"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[2337],{84718:(g,d,r)=>{r.r(d),r.d(d,{DocOptionsViewModel:()=>b});var f=r(74523),P=r(76199),S=r(35789),o=r(9659),a=r(66148),m=r(81322),D=r(6532);class b extends P.g{get NumText(){return this._NumText}set NumText(t){a.J0.ValidateDouble(t)&&(this.tempdbl=a.J0.DoubleTryParse(t),this._NumText=this.tempdbl,this.CalculatePercentage(1))}get DiscountText(){return this._DiscountText}set DiscountText(t){this._DiscountText=t,a.J0.ValidateDouble(t)&&(this.tempdbl=a.J0.DoubleTryParse(t),this.keyText=this.tempdbl,this.keyText>0?(this.keyText=-1*this.keyText,this._DiscountText=this.keyText.ToString()):this._DiscountText=t,this.CalculatePercentage(0))}constructor(t,e){if(super(),this.ButtonClick=new S.Yk,this.linkinfoVisible=!1,this.TabVisible=!1,this.keyText=-0,this._DiscountText="-0",this.DiscButtons=[],this.SearchVisibility=!1,this.Sku=new D.Dw,this.MaxDisc=0,this.CallType=0,this.drlineDisc=[],this.DiscKeyPadVisible=!1,this.Parent=t,this.CallType=e,this.Sku.Visible=!1,this.ButtonClick.Subscribe(this,"OnButtonClick"),1==e)this.Title="Header Fields",this.TabVisible=!0,this.Width=window.innerWidth-290;else if(2==e)this.Title="Link Info",this.Width=350,this.linkinfoVisible=!0,this.Parent.ScreenObject.Link.LinkCombo.Label="",this.linkScan=new D.Dw,this.linkScan.Visible=!1,this.linkScan.isSKU=!0,this.linkScan.TextChangedCommand.Subscribe(this,"onScanKeyDown");else if(3==e||4==e){let n=null;3==e?(n=o.d.SessionManager.RoleActions.filter(i=>i.FeatureID==this.Parent.CostCenterID&&"Line Wise Discount"==i.Name),this.Title=o.d.GetResource("LineDisc")):(n=o.d.SessionManager.RoleActions.filter(i=>i.FeatureID==this.Parent.CostCenterID&&"Overall Discount"==i.Name),this.Title=o.d.GetResource("Disc")),null!=n&&n.length>0&&!a.J0.IsEmpty(n[0].Description)&&this.AddDiscbuttons(n[0].Description),this.Width=300,this.DiscVisible=!0,this.drlineDisc=this.Parent.ScreenObject.Data.Tables[0].filter(3==this.CallType?i=>null!=i.LocalReference&&79==i.LocalReference&&23094==i.LinkData:i=>null!=i.LocalReference&&79==i.LocalReference&&23095==i.LinkData),this.drlineDisc.length>0&&a.J0.StringValue(this.drlineDisc[0].Formula).Contains("%")&&(this.DiscKeyPadVisible=!0,this.Width=500)}else 5==e&&(this.Title="Search",this.SearchVisibility=!0,this.Width=300,this.Sku.Visible=!0,this.Sku.isSKU=!0,this.Sku.Label=null!=this.Parent.SKU?this.Parent.SKU.Label:"Scan",this.Sku.TextChangedCommand.Subscribe(this,"OnSkuSearch"),this.Sku.SetFocus=!0)}OnSkuSearch(t){null!=this.Sku&&this.onScan(this.Sku.Text,null)}onScan(t,e){this.Parent.DisplayMessage="",this.Parent.MessageVisibility=!1;var n=this.Parent.ScreenObject.ColumnSource.find(i=>null!=i.DisplayMember&&"ProductCode"==i.DisplayMember);if(null!=n&&n.UseBarcode){let i={PID:0};if(this.Parent.ReadBarcode(n.BarcodeDef,n.BarcodeProp,null,null,t,i)){let l=[];l=this.Parent.ScreenObject.GridDataColumns.Contains("IsFullBatchScanned")?this.Parent.ScreenObject.GridData.filter(c=>parseInt(c.ProductID_Key)==i.PID&&(null==c.IsFullBatchScanned||"1"!=c.IsFullBatchScanned)):this.Parent.barcodeValues.ContainsKey("Unit_Key")?this.Parent.ScreenObject.GridData.filter(c=>c.ProductID_Key==i.PID&&c.Unit_Key==this.Parent.barcodeValues.Unit_Key):this.Parent.ScreenObject.GridData.filter(c=>parseInt(c.ProductID_Key)==i.PID),l.length>0?this.Parent.SelectedRow=l[0]:(this.Parent.SelectedRow=null,this.Parent.DisplayMessage="")}}}onScanKeyDown(t,e){if(null!=this.linkScan&&"13"==e.keyCode)for(let n=0;n<this.Parent.ScreenObject.Link.DocumentList.Items.length;n++)if(a.J0.String(this.linkScan.Text).toLowerCase()==a.J0.String(this.Parent.ScreenObject.Link.DocumentList.Items[n].Name).toLowerCase()){this.Parent.ScreenObject.Link.DocumentList.Items[n].IsChecked=!0,this.Parent.ScreenObject.Link.DocumentList.SelectedItem=this.Parent.ScreenObject.Link.DocumentList.Items[n],this.Parent.OnLinkDocumentCheckedChanged({obj:this.Parent.ScreenObject.Link.DocumentList.Items[n],item:this.Parent.ScreenObject.Link.DocumentList.Items[n]});break}}AddDiscbuttons(t){this.DiscButtons.Clear();let e=0;var n=t.split("~");if(this.MaxDisc=n.length>0?a.J0.IntTryParse(n[0]):0,this.MaxDisc>0&&(n.length>1&&(e=a.J0.IntTryParse(n[1])),e>0)){let i=this.MaxDisc/e;for(let s=1;s<=i;s++){let l=new m.v;l.ComParam=l.Label=l.DBColumnName=(e*s).toString(),l.SectionID="50",l.Width="50",this.DiscButtons.push(l)}}}OnButtonClick(t){var e=this;return(0,f.A)(function*(){if(null!=t&&"Cancel"==t.toString()){o.d.page.HideDialog(e.PopUpGUID);var n=e.Parent.ScreenObject.HeaderFields.find(i=>i instanceof S.MI&&"docdate"==i.DBColumnName.toLowerCase());null!=n&&(n.Text=n.Date.ToString(o.d.SessionManager.Preferences["Date Format"]))}else if(null!=t&&"OK"==t.toString())if(e._NumText<=e.MaxDisc){let i=null;if(i=e.Parent.ScreenObject.Data.Tables[0].filter(3==e.CallType?s=>null!=s.LocalReference&&79==s.LocalReference&&23094==s.LinkData:s=>null!=s.LocalReference&&79==s.LocalReference&&23095==s.LinkData),i.length>0)if("4"==i[0].SectionID){let s=e.Parent.ScreenObject.FooterGridData.filter(l=>l.ColumnName==i[0].SysColumnName);s.length>0&&(s[0].Amount=e._NumText,e.Parent.FooterCellEditEnd("Amount",s[0]))}else null!=e.Parent.SelectedRow&&(e.Parent.SelectedRow[i[0].SysColumnName.toString()]=e._NumText,e.Parent.CalculateTotals(e.Parent.SelectedRow,!1));o.d.page.HideDialog(e.PopUpGUID)}else alert("Can not enter more than"+e.MaxDisc.toString());else if(null!=t&&"Login"==t.toString()){const{LoginViewModel:i}=yield Promise.resolve().then(r.bind(r,44258)),{LoginScreenComponent:s}=yield Promise.resolve().then(r.bind(r,72069));let l=new i(o.d.router);l.CheckUserLogin=!0,l.ShowRememberMe=!1,l.ShowDefaultCompany=!1,l.ShowValue=!1,l.LoginText=o.d.GetResource("Com_OK"),l.Title="Authentication",o.d.page.ShowDialog(l,s).subscribe(()=>{if(l.IsLoggedIn){let T=e.Parent.ScreenObject.GetMaxDiscRolewise(l.FeatureID,3==e.CallType);e.AddDiscbuttons(T),e.Parent.PosDiscUserName=l.UserName;let h=null;if(3==e.CallType?h=e.Parent.ScreenObject.Data.Tables[0].filter(u=>null!=u.LocalReference&&79==u.LocalReference&&7804==u.LinkData):null!=e.Parent.SelectedRow&&(h=e.Parent.ScreenObject.Data.Tables[0].filter(u=>null!=u.LocalReference&&79==u.LocalReference&&7609==u.LinkData)),null!=h&&h.Length>0)if(e.Parent.ScreenObject.GridData.Columns.Contains(h[0].SysColumnName.toString())&&null!=e.Parent.SelectedRow)e.Parent.SelectedRow[h[0].SysColumnName.toString()]=l.UserName;else{var c=e.Parent.ScreenObject._TextFields.find(u=>u.DBColumnID.toString()==a.J0.String(h[0].CostcenterColid));null!=c&&c instanceof D.Dw&&(c.Text=l.UserName)}}})}else null!=t&&"Add"==t.toString()?e._NumText<e.MaxDisc&&(e._NumText++,e.CalculatePercentage(1)):null!=t&&"Sub"==t.toString()?e._NumText>0&&(e._NumText--,e.CalculatePercentage(1)):null!=t&&"AddDisc"==t.toString()?(e.keyText--,e.DiscountText=e.keyText.toString()):null!=t&&"SubDisc"==t.toString()?e.keyText<=0&&(e.keyText++,e.DiscountText=e.keyText.toString()):null==t||"dot"!=t.toString()||e.DiscountText.Contains(".")?null!=t&&a.J0.ValidateDouble(t.toString())?(e.tempdbl=a.J0.DoubleTryParse(t.toString()),e._NumText=e.tempdbl,e.CalculatePercentage(1)):null!=t&&"Delete"==t.toString()&&5==e.CallType&&null!=e.Parent.SelectedRow&&e.Parent.CanDeleteRow(e.Parent.SelectedRow)&&e.Parent.OnBeforeRowDeleting(e.Parent.SelectedRow,!0):e._DiscountText=e._DiscountText+"."})()}CalculatePercentage(t){if(this.DiscKeyPadVisible&&null!=this.Parent&&this.drlineDisc.length>0){let e=a.J0.StringValue(this.drlineDisc[0].ResourceData).Replace(" ",""),n=null;if(4!=this.CallType||a.J0.IsEmpty(this.drlineDisc[0].Formula)?(n=this.Parent.fldDict,0==t&&a.J0.StringValue(this.drlineDisc[0].Formula).Contains("%")?this.Parent.fldDict[e].setFieldValue(1):this.Parent.fldDict[e].setFieldValue(this._NumText)):(n=this.Parent.FooterDics,0==t&&this.drlineDisc[0].Formula.toString().Contains("%")?this.Parent.FooterDics[e].setFieldValue(1):this.Parent.FooterDics[e].setFieldValue(this._NumText)),0==t&&a.J0.StringValue(this.drlineDisc[0].Formula).Contains("%")){let i,s;s=o.d.eval.EvaluateExpression(this.drlineDisc[0].Formula.toString(),n).toString(),i=a.J0.DoubleTryParse(this.DiscountText),0!=s&&(s=i/s),this._NumText=a.J0.Double(s.toString())}else{let i,s=o.d.eval.EvaluateExpression(this.drlineDisc[0].Formula.toString(),n);a.J0.IsEmpty(s)||"Infinity"==s.toString()||"-Infinity"==s.toString()||"NaN"==s.toString()?this._DiscountText="0":(i=a.J0.DoubleTryParse(s.toString()),this._DiscountText=i)}}}}}}]);