"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[696],{98315:(b,c,o)=>{o.r(c),o.d(c,{AddBatchGroupViewModel:()=>d});var i=o(9659),u=o(76199),n=o(92014),l=o(6532),r=o(5349);class d extends u.g{constructor(e,h,t){super(),this.objBatch={},this._ScreenData=[],this.ScreenObject=new n.ControlGenerator,this.BatchCode=new l.s3(27184),this.BatchNumber=new l.Dw(1558),this.Status=new r.y$(1552),this.NodeID=0,this.Group=new r.y$(1557),this._ParentID=0,Logger.InfoLog("AddBatchGroupViewModel::Entering AddBatchGroupViewModel With ID"+e+",_Parent"+h+",ScreenName"+t),this.BatchCode.Label="Batch Code",this.BatchNumber.Label="Batch Number",this.BatchNumber.Mandatory=!0,this.Status.Label="Status",this.Group.Label="Group",this.Group.Mandatory=!0,this.objBatch.BatchID=0,this._ParentID=h,this._ScreenData=this.BuildControls(),this.ScreenObject.LoadScreen_2(this,16),null!=this._ScreenData&&this.ScreenObject.Data.Tables[3].forEach(s=>{this.Status.Items.push(r._p.ComboBoxItems_2(s[Object.keys(s)[1]].toString(),s[Object.keys(s)[0]].toString()))}),this.ScreenObject.Data.Tables[3].length>0&&(this.Status.SelectedValue=this.ScreenObject.Data.Tables[3][0][Object.keys(this.ScreenObject.Data.Tables[3][0])[0]].toString()),this.ScreenObject.Data.Tables[4].forEach(s=>{this.Group.Items.push(r._p.ComboBoxItems_2(s[Object.keys(s)[1]].toString(),s[Object.keys(s)[0]].toString()))}),0!=h&&(this.Group.SelectedValue=h.toString()),this.objBatch.GUID="",this.objBatch.IsGroup=!0,null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>9&&this.ScreenObject.Data.Columns[9].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[9].length>0&&this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[9],this.objBatch.IsGroup),e>0&&(this.NodeID=e,this.objBatch.BatchID=this.NodeID,this.FillControls()),0==e&&this.AutoGenerateCode(),Logger.InfoLog("AddBatchGroupViewModel::Exiting AddBatchGroupViewModel")}BuildControls(){Logger.InfoLog("QuickAddBatchViewModel::Entering BuildControls");try{let e=new n.ControlGenerator;return this.PactScreenID="16",e.GetControls(this.PactScreenID,i.d.SessionManager.CompanyIndex)}catch(e){return Logger.ErrorLog("QuickAddBatchViewModel:: BuildControls"+e.stack),null}}FillControls(){if(this.NodeID>0){this.objBatch.BatchID=this.NodeID;let e=i.d.inventory.GetBatchDetails(this.NodeID);Object.assign(this.objBatch,e.obj),""!=this.objBatch.BatchCode&&(this.BatchCode.Text=this.objBatch.BatchCode),(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.BatchCode.Enable=!1),this.BatchNumber.Enable&&(this.BatchNumber.Text=this.objBatch.BatchNumber),this.Status.Enable&&(this.Status.SelectedValue=this.objBatch.BatchStatus.toString()),this.Group.Enable&&(this.Group.SelectedValue=this.objBatch.BatchGroup.toString())}else this.objBatch.GUID=""}OnSaveGroup(e){Logger.InfoLog("AddBatchGroupViewModel::Entering OnSaveGroup");try{if("Save"==e.toString()){let h=this.ScreenObject.ValidateData();if(h.length>0)return this.MessageVisibility=!0,void(this.DisplayMessage=h);let t=[];if(0==this.objBatch.BatchID){let a={StrCode:this.objBatch.BatchCode,CodePrefix:this.objBatch.CodePrefix,CodeNumber:this.objBatch.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.BatchCode,this.objBatch.BatchGroup,this.ScreenObject.Data.Tables[9],a),this.objBatch.BatchCode=a.StrCode,this.objBatch.CodePrefix=a.CodePrefix,this.objBatch.CodeNumber=a.CodeNumber,this.DisplayMessage.length>0)return}else this.objBatch.BatchCode=this.BatchCode.Text;t.push(this.BatchNumber.Text),t.push(null),t.push(null),t.push(""),t.push(null),t.push(parseInt(this.Status.SelectedValue)),t.push(0),t.push(null),t.push(0),t.push(0),t.push(null),t.push(0),t.push(0),t.push(null),t.push(0),t.push(null),t.push(0),t.push(0),t.push(0),t.push(parseInt(this.Group.SelectedValue)),t.push(null);let s=0;i.d.inventory.AddBatchQuickAndGroup(this.objBatch,"AddBatchQuickAndGroup",JSON.stringify(t)).subscribe(a=>{this.MessageVisibility=!0,this.DisplayMessage=a.Message,s=a.RetValue,s>0&&(this.ScreenObject.Clear(),this.Parent.Refresh(),this.objBatch.BatchID>0&&(this.BatchCode.Text="")),Logger.InfoLog("AddEditBatchViewModel::Exiting OnSaveBatch")},a=>{console.log("AddEditBatchViewModel Save : "+JSON.stringify(a))})}else"Cancel"==e.toString()&&i.d.page.HideDialog(this.PopUpGUID);Logger.InfoLog("AddBatchGroupViewModel::Exiting OnSaveGroup")}catch(h){Logger.ErrorLog("AddBatchGroupViewModel:: OnSaveGroup"+h.stack)}}onCanGroup(e){return!0}AutoGenerateCode(){0==this.objBatch.BatchID&&(this.objBatch.BatchGroup=""!=this.Group.SelectedValue?parseInt(this.Group.SelectedValue)>0?parseInt(this.Group.SelectedValue):0:1,this.ScreenObject.SetAutoCode(this.BatchCode,this.objBatch.IsGroup,this.objBatch.BatchGroup,this.ScreenObject.Data.Tables[9]))}}}}]);