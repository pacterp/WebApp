"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[3630],{83630:(E,m,l)=>{l.r(m),l.d(m,{QuickAddCostCenterViewModel:()=>G});var o=l(32040),S=l(54581),r=l(43767),T=l(98580),j=l(26336),f=l(85985),C=l(84151),u=l(23458),b=l(27730),I=l(58170),O=l(42938),g=l(92442),p=l(58941),y=l(88248),P=l(30417),N=l(13054),D=l(82503),L=l(41264),M=l(41820),A=l(43794);class G extends T.g{get SelectedGroup(){return this._SelectedGroup}set SelectedGroup(t){this._SelectedGroup=t,this.ParentId!=t&&(this.objCostCenter.SelectedNode=t)}constructor(){super(),this.PactScreenID="0",this.ht=new j.bT,this.ScreenObject=new f.ControlGenerator,this.Code=new C.s3(0),this.Name=new C.Dw(0),this.Alias=new C.Dw(0),this.CreditDays=new C.Dw(0),this.CreditLimit=new C.Dw(0),this.DebitDays=new C.Dw(0),this.DebitLimit=new C.Dw(0),this.Status=new b.y$(0),this.SalesAccount=new u.y$(0),this.PurchaseAccount=new u.y$(0),this.CurrencyID=new u.y$(0),this.Group=new u.y$(0),this.SaveCostCenter=new I.Yk,this.objCostCenter=new O.d,this.ScreenData=[],this.DefStatusID=1,this.ButtonSave=new p.v,this.DimLength=new C.Dw(0),this.DimWidth=new C.Dw(0),this.DimHeight=new C.Dw(0),this.DimVolume=new C.Dw(0),this.DimWeight=new C.Dw(0),this.lstKeyWords=[],this.lstEventCtrls=[],this.RetValue=0,this.CallBackDelegate=new A.B,this.QuickAssign=new g.d}QuickAddCostCenterViewModel(t,s,i,n,c){Logger.InfoLog("QuickAddCostCenterViewModel::Entering QuickAddCostCenterViewModel With ID ="+t+"CostCenterID"+s+"Parent"+this.Parent+"ScreenName"+n),this.objCostCenter.CostCenterID=s,this.CostCenterID=s,this.PactScreenID=s.toString(),this.ScreenData=this.BuildControls(),this.NodeID=t,this.ParentId=i,this.SelectedGroup=i,this.IsGroup=c,this.Title=0==this.NodeID?o.d.GetResource("Add")+" "+n:o.d.GetResource("Edit")+" "+n,this.IsGroup&&(this.Title=this.Title+" Group"),this.GetColumnDefDataset(s);let e=0;if(!r.J0.IsEmpty(o.d.SessionManager.Preferences["Report Template Dimension"])&&"0"!=o.d.SessionManager.Preferences["Report Template Dimension"].toString()&&(e=parseInt(o.d.SessionManager.Preferences["Report Template Dimension"].toString())),this.DetailsVisibility=e!=s&&!this.IsGroup,r.J0.String(o.d.SessionManager.Preferences.OnlineLevel1Dim)==s.toString()&&(this.DetailsVisibility=!0),50052==s){this.DisplayName=n;let a=n.lastIndexOf("-");a>=0&&(this.DisplayName=n.substr(0,a),this.ScreenObject.CGParentID=parseInt(n.substr(a+1))),this.DetailsVisibility=!1}else this.DisplayName=n;this.ScreenData=this.BuildControls(),this.DisplayMessage="",this.OnLoad(t,s),this.FillControls(),this.SaveCostCenter.Subscribe(this,"onSaveCostCenter"),null!=this.Code&&this.Code.TextChangedCommand.Subscribe(this,"OnTextChanged"),null!=this.Name&&this.lstEventCtrls.push(this.Name.DBColumnID),null!=this.Status&&this.lstEventCtrls.push(this.Status.DBColumnID),null!=this.Group&&this.lstEventCtrls.push(this.Group.DBColumnID),null!=this.Code&&this.lstEventCtrls.push(this.Code.DBColumnID),this.GetExternalFunctionData(),Logger.InfoLog("QuickAddCostCenterViewModel::BuildControls Success")}GetExternalFunctionData(t=!1){let s;for(let i=0;i<this.ScreenObject.StaticFields.length;i++)s=this.ScreenObject.StaticFields[i],t||!s||null==s.ToolTipFooterTitle||null==s.KeyTip||this.lstEventCtrls.Contains(s.DBColumnID)?this.NodeID>0&&s&&null!=s.ToolTipFooterTitle&&null!=s.KeyTip&&19==s.Mode&&this.OnGetExtFunctionData(s):this.SetControlEvent(s)}SetControlEvent(t){try{t instanceof C.Dw?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof b.y$?t.SelectionChangedCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof N.I||t instanceof C.L6?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof u.y$?t.OnPactListBoxValueChanged.Subscribe(this,"OnGetExtFunctionData"):(t instanceof D.Lc||t instanceof D.P6||t instanceof D.C_)&&t.SelectedDateChanged.Subscribe(this,"OnGetExtFunctionData"),this.NodeID>0&&19==t.Mode&&this.OnGetExtFunctionData(t)}catch{}}OnGetExtFunctionData(t){null!=t.ToolTipFooterTitle&&!r.J0.IsEmpty(t.KeyTip)&&"lostfocus"==t.KeyTip.toLowerCase()&&this.ScreenObject.ValidateExtData(t,null,!0)&&this.ScreenObject.GetExternalFuncData(t.Mode,this.NodeID,t.ToolTipFooterTitle,t.ToolTipFooterDescription,t.ToolTipDescription,null,null)}FillKeyWords(){this.lstKeyWords.push("Basic"),this.lstKeyWords.push("Gross"),this.lstKeyWords.push("ServiceDays"),this.lstKeyWords.push("WeeklyOffs"),this.lstKeyWords.push("LeavesTaken"),this.lstKeyWords.push("TotalDays"),this.lstKeyWords.push("DaysAttended"),this.lstKeyWords.push("UnpaidDays"),this.lstKeyWords.push("LOPDays"),this.lstKeyWords.push("Holidays"),this.lstKeyWords.push("AdjDays"),this.lstKeyWords.push("EmpType"),this.lstKeyWords.push("Gender"),this.lstKeyWords.push("MaritalStatus"),this.lstKeyWords.push("Nationality"),this.lstKeyWords.push("Religion"),this.lstKeyWords.push("ChildrenCount"),this.lstKeyWords.push("ChildrenDays"),this.lstKeyWords.push("VacDaysTaken"),this.lstKeyWords.push("VacDays"),this.lstKeyWords.push("VacAmount"),this.lstKeyWords.push("VacEncashDays"),this.lstKeyWords.push("VacEncashAmount"),this.lstKeyWords.push("VacExcessDays"),this.lstKeyWords.push("VacExcessAmount"),this.lstKeyWords.push("VacNetAmount"),this.lstKeyWords.push("PayrollMonthNo"),this.lstKeyWords.push("TotCheckInLateMins"),this.lstKeyWords.push("TotCheckOutEarlyMins"),this.lstKeyWords.push("TotBreak1MoreMins"),this.lstKeyWords.push("TotBreak2MoreMins"),this.lstKeyWords.push("TotBreak3MoreMins"),this.lstKeyWords.push("TotBreak4MoreMins"),this.lstKeyWords.push("TotBreak5MoreMins"),this.lstKeyWords.push("TotLateHrsToDeduct"),this.lstKeyWords.push("TotLateLeavesToDeduct")}OnLoad(t,s){this.ButtonSave=new p.v,0==t?o.d.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=o.d.SessionManager.IsActionAssigned(s,"Create"):this.ButtonSave.Enable=o.d.SessionManager.IsActionAssigned(s,"Create"):(this.ScreenObject.IsEdit=!0,o.d.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=o.d.SessionManager.IsActionAssigned(s,"Update"):this.ButtonSave.Enable=o.d.SessionManager.IsActionAssigned(s,"Update")),this.ScreenObject.LoadQuickScreen(this,s,this.IsGroup),this.QuickAssign=new g.d,this.QuickAssign.QuickAssignGrid_1(s,this.ScreenObject.Data,this.IsGroup);let i=[];if(this.ht.ContainsKey("Name")&&(this.Name=this.ScreenObject.GetQuickText(parseInt(this.ht.Name)),null!=this.Name&&this.Name.LostFocusCommand.Subscribe(this,"OnNameLostFocus")),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>7&&this.ScreenObject.Data.Columns[7].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[7].length>0){this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[7],this.IsGroup);var n=this.ScreenObject.StaticFields.find(e=>"GroupSeqNoLength"==e.DBColumnName);null!=n&&!this.IsGroup&&(n.Visible=!1),null!=this.Name&&(i=this.ScreenObject.Data.Tables[5].filter(e=>"CapsLock"==e.Name),i.length>0&&(0,S.yG0)(i[0].Value)&&(this.Name.IsAllCaps=!0),i=this.ScreenObject.Data.Tables[5].filter(e=>"CapsToFirstLetter"==e.Name),i.length>0&&(0,S.yG0)(i[0].Value)&&(this.Name.IsFirstLetterCaps=!0))}if(this.ht.ContainsKey("Code")&&(this.Code=this.ScreenObject.GetQuickCode(parseInt(this.ht.Code))),this.ht.ContainsKey("StatusID")&&(this.Status=this.ScreenObject.GetQuickCombo(parseInt(this.ht.StatusID)),null!=this.Status?(this.ScreenObject.Data.Tables[3].forEach(e=>{this.Status.Items.push(b._p.ComboBoxItems_3(r.J0.String(e.Status),r.J0.String(e.StatusID),r.J0.String(e.ActualStatus)))}),r.J0.IsEmpty(this.Status.DefaultValue)?this.ScreenObject.Data.Tables[3].length>0&&(this.Status.SelectedValue=this.ScreenObject.Data.Tables[3][0].StatusID.toString()):this.Status.SelectedValue=this.Status.DefaultValue,!r.J0.IsEmpty(this.Status.SelectedValue)&&this.ScreenObject.Data.Tables[3].length>0&&(this.DefStatusID=parseInt(this.ScreenObject.Data.Tables[3][0].StatusID))):this.ScreenObject.Data.Tables[3].length>0&&(this.DefStatusID=parseInt(this.ScreenObject.Data.Tables[3][0].StatusID))),this.ht.ContainsKey("IsGroup")&&(this.Group=this.ScreenObject.GetQuickField(parseInt(this.ht.IsGroup)),null!=this.Group&&(0!=this.ParentId&&0==this.NodeID&&(this.Group.SelectedValue=this.ParentId,this.Group.Enable=!1),this.Group.SelectionChangedCommand.Subscribe(this,"OnGroupSelectionChanged"))),this.ht.ContainsKey("AliasName")&&(this.Alias=this.ScreenObject.GetQuickText(parseInt(this.ht.AliasName))),this.ht.ContainsKey("SalesAccount")&&(this.SalesAccount=this.ScreenObject.GetQuickField(parseInt(this.ht.SalesAccount))),this.ht.ContainsKey("CurrencyID")&&(this.CurrencyID=this.ScreenObject.GetQuickField(parseInt(this.ht.CurrencyID))),this.ht.ContainsKey("PurchaseAccount")&&(this.PurchaseAccount=this.ScreenObject.GetQuickField(parseInt(this.ht.PurchaseAccount))),this.ht.ContainsKey("CreditDays")&&(this.CreditDays=this.ScreenObject.GetQuickField(parseInt(this.ht.CreditDays))),this.ht.ContainsKey("CreditLimit")&&(this.CreditLimit=this.ScreenObject.GetQuickField(parseInt(this.ht.CreditLimit))),this.ht.ContainsKey("DebitDays")&&(this.DebitDays=this.ScreenObject.GetQuickField(parseInt(this.ht.DebitDays))),this.ht.ContainsKey("DebitLimit")&&(this.DebitLimit=this.ScreenObject.GetQuickField(parseInt(this.ht.DebitLimit))),o.d.SessionManager.Preferences.ContainsKey("Report Template Dimension")&&""!=o.d.SessionManager.Preferences["Report Template Dimension"]&&s==parseInt(o.d.SessionManager.Preferences["Report Template Dimension"])&&"TRUE"==o.d.SessionManager.Preferences.WEFINReportTemplate.toUpperCase()&&(i=this.ScreenObject.Data.Tables[0].filter(e=>"ccAlpha44"==e.SysColumnName),i.length>0)){let e=this.ScreenObject.GetQuickField(parseInt(i[0].CostCenterColID));if(null!=e){var c=e.Items.find(a=>"Show Closing"==a.Value);null!=c&&e.Items.Remove(c)}}if(50002==s&&o.d.SessionManager.Preferences.ContainsKey("LWAccPeriod")&&"TRUE"==o.d.SessionManager.Preferences.LWAccPeriod.toUpperCase()){if(i=this.ScreenObject.Data.Tables[0].filter(e=>"ccAlpha41"==e.SysColumnName),i.length>0){let e=this.ScreenObject.GetQuickField(parseInt(i[0].CostCenterColID));if(null!=e){let h=new Date((new Date).getFullYear(),0,1);for(let d=1;d<=12;d++)e.Items.push(b._p.ComboBoxItems_2(h.ToString("MMMM"),d.toString())),h=h.AddMonths(1);e.SelectedValue="1"}}}else if(o.d.SessionManager.Preferences.ContainsKey("PackDimension")&&""!=o.d.SessionManager.Preferences.PackDimension&&s==parseInt(o.d.SessionManager.Preferences.PackDimension)){if(i=this.ScreenObject.Data.Tables[0].filter(e=>"ccalpha46"==e.SysColumnName.toLowerCase()),i.length>0&&(this.DimLength=this.ScreenObject.GetQuickText(parseInt(i[0].CostCenterColID)),null!=this.DimLength)){this.DimLength.TextChangedCommand.Subscribe(this,"onTextValueChanged");let e=0,a=this.ScreenObject.Data.Tables[5].filter(h=>"LengthDecimals"==h.Name);null!=a&&a.length>0&&(e=r.J0.IntTryParse(a[0].Value.toString())),e>0&&(this.DimLength.DecimalPoints=e.toString()),this.DimLength.LostFocusCommand.Subscribe(this,"onLostFocus")}if(i=this.ScreenObject.Data.Tables[0].filter(e=>"ccalpha47"==e.SysColumnName.toLowerCase()),i.length>0&&(this.DimWidth=this.ScreenObject.GetQuickText(parseInt(i[0].CostCenterColID)),null!=this.DimWidth)){this.DimWidth.TextChangedCommand.Subscribe(this,"onTextValueChanged");let e=0,a=this.ScreenObject.Data.Tables[5].filter(h=>"WidthDecimals"==h.Name);null!=a&&a.length>0&&(e=r.J0.IntTryParse(a[0].Value.toString())),e>0&&(this.DimWidth.DecimalPoints=e.toString()),this.DimWidth.LostFocusCommand.Subscribe(this,"onLostFocus")}if(i=this.ScreenObject.Data.Tables[0].filter(e=>"ccalpha48"==e.SysColumnName.toLowerCase()),i.length>0&&(this.DimHeight=this.ScreenObject.GetQuickText(parseInt(i[0].CostCenterColID)),null!=this.DimHeight)){this.DimHeight.TextChangedCommand.Subscribe(this,"onTextValueChanged");let e=0,a=this.ScreenObject.Data.Tables[5].filter(h=>"HeightDecimals"==h.Name);null!=a&&a.length>0&&(e=r.J0.IntTryParse(a[0].Value.toString())),e>0&&(this.DimHeight.DecimalPoints=e.toString()),this.DimHeight.LostFocusCommand.Subscribe(this,"onLostFocus")}if(i=this.ScreenObject.Data.Tables[0].filter(e=>"ccalpha49"==e.SysColumnName.toLowerCase()),i.length>0&&(this.DimVolume=this.ScreenObject.GetQuickText(parseInt(i[0].CostCenterColID)),null!=this.DimVolume)){let e=0,a=this.ScreenObject.Data.Tables[5].filter(h=>"VolumeDecimals"==h.Name);null!=a&&a.length>0&&(e=r.J0.IntTryParse(a[0].Value.toString())),e>0&&(this.DimVolume.DecimalPoints=e.toString()),this.DimVolume.LostFocusCommand.Subscribe(this,"onLostFocus")}if(i=this.ScreenObject.Data.Tables[0].filter(e=>"ccalpha50"==e.SysColumnName.toLowerCase()),i.length>0&&(this.DimWeight=this.ScreenObject.GetQuickText(parseInt(i[0].CostCenterColID)),null!=this.DimWeight)){let e=0,a=this.ScreenObject.Data.Tables[5].filter(h=>"WeightDecimals"==h.Name);null!=a&&a.length>0&&(e=r.J0.IntTryParse(a[0].Value.toString())),e>0&&(this.DimWeight.DecimalPoints=e.toString()),this.DimWeight.LostFocusCommand.Subscribe(this,"onLostFocus")}}if(i=this.ScreenObject.Data.Tables[5].filter(e=>"BinsDimension"==e.Name),i.length>0&&i[0].Value.toString()==s.toString()){if(i=this.ScreenObject.Data.Tables[0].filter(e=>"ccalpha47"==e.SysColumnName.toLowerCase()),i.length>0&&(this.DimLength=this.ScreenObject.GetQuickText(parseInt(i[0].CostCenterColID)),null!=this.DimLength)){this.DimLength.TextChangedCommand.Subscribe(this,"onTextValueChanged");let e=0,a=this.ScreenObject.Data.Tables[5].filter(h=>"LengthDecimals"==h.Name);null!=a&&a.length>0&&(e=r.J0.IntTryParse(a[0].Value.toString())),e>0&&(this.DimLength.DecimalPoints=e.toString()),this.DimLength.LostFocusCommand.Subscribe(this,"onLostFocus")}if(i=this.ScreenObject.Data.Tables[0].filter(e=>"ccalpha48"==e.SysColumnName.toLowerCase()),i.length>0&&(this.DimWidth=this.ScreenObject.GetQuickText(parseInt(i[0].CostCenterColID)),null!=this.DimWidth)){this.DimWidth.TextChangedCommand.Subscribe(this,"onTextValueChanged");let e=0,a=this.ScreenObject.Data.Tables[5].filter(h=>"WidthDecimals"==h.Name);null!=a&&a.length>0&&(e=r.J0.IntTryParse(a[0].Value.toString())),e>0&&(this.DimWidth.DecimalPoints=e.toString()),this.DimWidth.LostFocusCommand.Subscribe(this,"onLostFocus")}if(i=this.ScreenObject.Data.Tables[0].filter(e=>"ccalpha49"==e.SysColumnName.toLowerCase()),i.length>0&&(this.DimHeight=this.ScreenObject.GetQuickText(parseInt(i[0].CostCenterColID)),null!=this.DimHeight)){this.DimHeight.TextChangedCommand.Subscribe(this,"onTextValueChanged");let e=0,a=this.ScreenObject.Data.Tables[5].filter(h=>"HeightDecimals"==h.Name);null!=a&&a.length>0&&(e=r.J0.IntTryParse(a[0].Value.toString())),e>0&&(this.DimHeight.DecimalPoints=e.toString()),this.DimHeight.LostFocusCommand.Subscribe(this,"onLostFocus")}if(i=this.ScreenObject.Data.Tables[0].filter(e=>"ccalpha50"==e.SysColumnName.toLowerCase()),i.length>0&&(this.DimVolume=this.ScreenObject.GetQuickText(parseInt(i[0].CostCenterColID)),null!=this.DimVolume)){let e=0,a=this.ScreenObject.Data.Tables[5].filter(h=>"VolumeDecimals"==h.Name);null!=a&&a.length>0&&(e=r.J0.IntTryParse(a[0].Value.toString())),e>0&&(this.DimVolume.DecimalPoints=e.toString()),this.DimVolume.LostFocusCommand.Subscribe(this,"onLostFocus")}}i=this.ScreenObject.Data.Tables[5].filter(e=>"NameSameasCode"==e.Name),i.length>0&&r.J0.IntTryParse(i[0].Value)?(this.NameSameasCode=!0,this.Name.Enable=!1):(this.NameSameasCode=!1,this.Name.Enable=!0)}onTextValueChanged(t){let s=0,i=0,n=0;null!=this.DimLength&&(s=r.J0.DoubleTryParse(this.DimLength.Text)),null!=this.DimWidth&&(i=r.J0.DoubleTryParse(this.DimWidth.Text)),null!=this.DimHeight&&(n=r.J0.DoubleTryParse(this.DimHeight.Text)),null!=this.DimVolume&&(this.DimVolume.Text=(s*i*n).toString())}OnTextChanged(t){null!=this.Name&&(!this.NameSameasCode||this.Code.PrefixVisibility||this.Code.SuffixVisibility?this.NameSameasCode&&this.Code.PrefixVisibility&&this.Code.SuffixVisibility?this.Name.Text=this.Code.PrefixCode+this.Code.SuffixCode:this.NameSameasCode&&this.Code.PrefixVisibility&&!this.Code.SuffixVisibility?this.Name.Text=this.Code.PrefixCode+this.Code.Text:this.NameSameasCode&&!this.Code.PrefixVisibility&&this.Code.SuffixVisibility&&(this.Name.Text=this.Code.Text+this.Code.SuffixCode):this.Name.Text=this.Code.Text)}onLostFocus(t){r.J0.IsNum(t.Text)&&(r.J0.IsEmpty(t.DecimalPoints)||(t.Text=(0).ToString("N"+t.DecimalPoints))),this.ScreenObject.onTextBoxLostFocus(t)}OnGroupSelectionChanged(t){this.Group.SelectedValue>0&&(this.Group.DefaultValue=this.Group.SelectedValue.toString(),this.ParentId=this.Group.SelectedValue,this.AutoGenerateCode(),this.LoadParentData())}AutoGenerateCode(){if(0==this.NodeID&&null!=this.Code){if(this.ScreenObject.SetAutoCode(this.Code,this.IsGroup,this.ParentId,this.ScreenObject.Data.Tables[7]),this.OnTextChanged(""),this.ScreenObject.IsAutoName&&null!=this.Name){this.ScreenObject.IsNameAutoGenerate=!0,this.Name.Enable=!1;let s=this.ScreenObject.Data.Tables[7];s=s.filter(n=>1==n.IsName),this.ScreenObject.IsName=!0,s.length>0&&(this.Name.Text=this.ScreenObject.SetAutoCodeParams_1(this.Name,this.ParentId,s))}let t;t=this.ScreenObject.Data.Tables[5].filter(s=>"NameSameasCode"==s.Name),t.length>0&&r.J0.IntTryParse(t[0].Value)?(this.NameSameasCode=!0,this.Name.Enable=!1):this.ScreenObject.IsAutoName||(this.NameSameasCode=!1,this.Name.Enable=!0)}}FillControls(){if(0!=this.NodeID){this.objCostCenter.NodeID=this.NodeID;let t=o.d.common.GetCostCenterDetails(0,this.CostCenterID,this.objCostCenter.NodeID,0);Object.assign(this.objCostCenter,t.obj),this.NodeID=this.objCostCenter.NodeID,this.QuickAssign.LoadGrid(this.objCostCenter.NodeID,t.Tables[10]),null!=this.Code&&(this.Code.Text=this.objCostCenter.Code,(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.Code.Enable=parseInt(t.Tables[0][0].Depth)<=1&&!this.ScreenObject.IsRootAutoCode)),null!=this.Name&&this.ScreenObject.IsAutoName&&(this.Name.Enable=!1),this.ScreenObject.FillControls(t.Tables[0][0],t.Tables[0][0],t.Tables[7].length>0?t.Tables[7][0]:null,null,null,t.Tables[3]),this.ScreenObject.CanApprove(t.Tables[0][0],t.Tables[11][0],this.ButtonSave),t.Tables[7].length>0&&this.ScreenObject.LoadCustomFieldsCCData(t.Tables[7],t.Tables[14]),null!=this.ScreenObject.StatusAssignGrid&&this.ScreenObject.StatusAssignGrid.Load(t.Tables[15]),null!=this.Group&&(this.Group.SelectedValue=parseInt(t.Tables[0][0].ParentID.toString()),this.Group.Enable=!1),50170==this.CostCenterID&&null!=this.Status&&"Converted"==this.Status.GetParentText()&&(this.Status.Enable=!1),o.d.SessionManager.IsOffline&&this.NodeID>0&&(this.ButtonSave.Visible=!1)}else this.AutoGenerateCode(),this.LoadParentData(),this.objCostCenter.GUID=""}BuildControls(){Logger.InfoLog("QuickAddCostCenterViewModel::Entering BuildControls");try{return(new f.ControlGenerator).GetControls(this.PactScreenID,o.d.SessionManager.CompanyIndex)}catch(t){return Logger.ErrorLog("QuickAddCostCenterViewModel:: BuildControls"+t.stack),null}}GetColumnDefDataset(t){try{let s=this.objCostCenter.GetColumnDefination(this.PactScreenID,o.d.SessionManager.CompanyIndex);if(null!=s&&s.Tables[0].length>0)for(let i=0;i<s.Tables[0].length;i++)this.ht.ContainsKey(s.Tables[0][i].SYSCOLUMNNAME.toString())||this.ht.push(s.Tables[0][i].SYSCOLUMNNAME.toString(),s.Tables[0][i].COSTCENTERCOLID.toString())}catch(s){Logger.ErrorLog("AddCostCenterViewModel:: GetColumnDefination "+s.stack)}}onSaveCostCenter(t){if(Logger.InfoLog("QuickAddCostCenterViewModel::Entering onSaveCostCenter"),"Cancel"==t)null!=this.Parent?(this.Parent.AddEditCosCenterVisibility=!1,this.Parent.SetDetailsVisibility()):o.d.page.HideDialog(this.PopUpGUID);else if("Save"==t)this.SaveMethod();else if("Details"==t)o.d.page.ShowLoading=!0,setTimeout(()=>{o.d.page.HideDialog(this.PopUpGUID);let s=new y.AddCostCenterViewModel(this.CostCenterID);s.AddCostCenterViewModel_1(this.NodeID,this.CostCenterID,this.SelectedGroup,this.Title,this.IsGroup);let i={obj:s};s.Parent=this.Parent,null!=this.Name&&(s.Name.Text=this.Name.Text),null!=this.Code&&(s.Code.Text=this.Code.Text,s.Code.PrefixCode=this.Code.PrefixCode),s.OnGroupSelectionChanged("Group"),s.ScreenObject.CopyQuickToDetail(this.ScreenObject.StaticFields,[null!=this.Code?this.Code.DBColumnID:0,null!=this.Name?this.Name.DBColumnID:0]),o.d.page.addNewTab({title:this.Title,component:P.AddEditCostcenterComponent,params:i})},50);else if("ApproveMaster"==t.toString()){let s=new L.i(this.CostCenterID,this.objCostCenter.NodeID,this.ScreenObject,this);o.d.page.ShowDialog(s,M.R,{ShowCenter:!0,Title:o.d.GetResource("ApproveReject")})}}SaveMethod(){try{this.objCostCenter.NodeID=this.NodeID,this.objCostCenter.CostCenterID=this.CostCenterID;let i,s=0;if(0==this.NodeID){this.ScreenObject.IsName=!1;let n=[];if(n=this.ScreenObject.Data.Tables[7],n=n.filter(e=>0==e.IsName),this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.ParentId,n,{StrCode:this.objCostCenter.Code,CodePrefix:this.objCostCenter.CodePrefix,CodeNumber:this.objCostCenter.CodeNumber}),this.DisplayMessage.length>0)return}else if(this.NodeID>0&&!this.Code.Enable&&!this.ScreenObject.CodeSeqExist){this.ScreenObject.IsName=!1;let n=[];if(n=this.ScreenObject.Data.Tables[7],n=n.filter(e=>0==e.IsName),this.ScreenObject.SetAutoCodeParams_3(this.Code,this.ParentId,n,{StrCode:this.objCostCenter.Code,CodePrefix:this.objCostCenter.CodePrefix,CodeNumber:this.objCostCenter.CodeNumber}),this.DisplayMessage.length>0)return}else this.objCostCenter.Code=this.Code.Text,this.Code.Code=this.Code.Text;if(this.ScreenObject.IsAutoName&&null!=this.Name&&!this.Name.Enable){this.ScreenObject.IsNameAutoGenerate=!0,this.Name.Enable=!1;let n=this.ScreenObject.Data.Tables[7];n=n.filter(e=>1==e.IsName),this.ScreenObject.IsName=!0,n.length>0&&(this.Name.Text=this.ScreenObject.SetAutoCodeParams_1(this.Name,this.ParentId,n),this.objCostCenter.Name=this.Name.Text.Trim())}if(this.DisplayMessage=this.ScreenObject.ValidateData(),this.DisplayMessage.length>0)return;if(50052==this.CostCenterID){this.FillKeyWords();for(let n=0;n<=this.lstKeyWords.length-1;n++)if(this.Name.Text.toUpperCase().Trim()==this.lstKeyWords[n].toUpperCase().toString())return void(this.DisplayMessage="Cannot save the Reserve Word");(2==this.ParentId||3==this.ParentId||4==this.ParentId||5==this.ParentId)&&(this.Name.Text=this.Name.Text.Replace(" ",""))}if(0==this.objCostCenter.NodeID){if(null!=this.Code){let e=this.ScreenObject.Data.Tables[7];e=e.filter(d=>0==d.IsName);let h={StrCode:this.objCostCenter.Code,CodePrefix:this.objCostCenter.CodePrefix,CodeNumber:this.objCostCenter.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.ParentId,e,h),this.objCostCenter.Code=h.StrCode,this.objCostCenter.CodePrefix=r.J0.String(h.CodePrefix),this.objCostCenter.CodeNumber=h.CodeNumber,this.DisplayMessage.length>0)return}this.objCostCenter.Name=null!=this.Name?this.Name.Text.Trim():this.objCostCenter.Code,this.objCostCenter.AliasName=null!=this.Alias?this.Alias.Text:this.objCostCenter.Name,r.J0.IsEmpty(this.objCostCenter.Code)||(this.objCostCenter.Code=o.d.SessionManager.PactSanitize(this.objCostCenter.Code)),this.objCostCenter.Name=o.d.SessionManager.PactSanitize(this.objCostCenter.Name),this.objCostCenter.AliasName=o.d.SessionManager.PactSanitize(this.objCostCenter.AliasName),50052==this.CostCenterID&&null!=this.Alias&&(this.Alias.Text=""!=this.Alias.Text.Trim().toString()?this.Alias.Text:this.objCostCenter.Name,this.objCostCenter.AliasName=o.d.SessionManager.PactSanitize(this.Alias.Text)),this.objCostCenter.SelectedGroup=null!=this.Group?this.Group.SelectedValue:this.ParentId,this.objCostCenter.Status=null!=this.Status?r.J0.IsEmpty(this.Status.SelectedValue)?this.DefStatusID:parseInt(this.Status.SelectedValue):this.DefStatusID,this.objCostCenter.SalesAccount=null!=this.SalesAccount?this.SalesAccount.SelectedValue:2,this.objCostCenter.PurchaseAccount=null!=this.PurchaseAccount?this.PurchaseAccount.SelectedValue:3,this.objCostCenter.CreditDays=null!=this.CreditDays?parseInt(this.CreditDays.Text):0,this.objCostCenter.CreditLimit=50052==this.CostCenterID?parseFloat(this.ScreenObject.CGParentID.toString().replace("00","")):null!=this.CreditLimit?parseFloat(this.CreditLimit.Text):0,this.objCostCenter.DebitDays=null!=this.DebitDays?parseInt(this.DebitDays.Text):0,this.objCostCenter.DebitLimit=null!=this.DebitLimit?parseFloat(this.DebitLimit.Text):0,this.objCostCenter.IsGroup=this.IsGroup,this.objCostCenter.SelectedNode=this.ParentId,this.objCostCenter.CustomFieldsXML="",this.objCostCenter.ContactsXML="",this.objCostCenter.NotesXML="",this.objCostCenter.AttachmetsXML=this.ScreenObject.GetExtraAttachmentXML(),this.objCostCenter.CustomFieldsQuery="",null!=this.CurrencyID&&this.CurrencyID.SelectedValue>0&&(this.objCostCenter.CustomFieldsQuery="CurrencyID='"+this.CurrencyID.SelectedValue+"',"),this.objCostCenter.CustomFieldsQuery=this.objCostCenter.CustomFieldsQuery+this.ScreenObject.GetQuickExtraFieldsQuery(),this.objCostCenter.CustomCostCenterFieldsQuery="",this.objCostCenter.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery();var t=this.ScreenObject.StaticFields.find(e=>"GroupSeqNoLength"==e.DBColumnName);this.objCostCenter.GroupSeqNoLength=null!=t&&this.objCostCenter.IsGroup?parseInt(t.Text):0,this.objCostCenter.HistoryXML=this.ScreenObject.HistoryCCXML,this.objCostCenter.StatusXML=null!=this.ScreenObject.StatusAssignGrid?this.ScreenObject.StatusAssignGrid.GetXML():"";let n,c={};if(this.DisplayMessage=this.QuickAssign.GetXML(c),n=c.strXML,!r.J0.IsEmpty(this.DisplayMessage)||(this.objCostCenter.CCXML=n,!this.ScreenObject.ValidateDataonSave()))return;this.objCostCenter.WID=this.ScreenObject.CheckWorkFlow(),o.d.common.SaveCostCenter(this.objCostCenter,"SaveCostCenter").subscribe(e=>{i=e.Message,s=e.RetValue,this.MessageVisibility=!0,this.DisplayMessage=i,this.RetValue=s,s>0||s<-1e4?this.AfterSave():(this.MessageVisibility=!0,this.DisplayMessage=i)},e=>{alert(JSON.stringify(e)),console.log("Quick Add CostCenter Save : "+JSON.stringify(e))})}else{let n=this.ScreenObject.GetStaticFieldsQuery();50052==this.CostCenterID&&(this.objCostCenter.AliasName=null!=this.Alias?this.Alias.Text:this.objCostCenter.Name,null!=this.Alias&&(this.Alias.Text=""!=this.Alias.Text.Trim().toString()?this.Alias.Text:this.objCostCenter.Name,this.objCostCenter.AliasName=this.Alias.Text)),null!=this.Code&&(this.objCostCenter.Code=this.Code.Text.Trim()),this.objCostCenter.Name=null!=this.Name?this.Name.Text.Trim():this.objCostCenter.Code,this.objCostCenter.StaticFieldsQuery=n,this.objCostCenter.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.objCostCenter.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.objCostCenter.AttachmetsXML=this.ScreenObject.GetExtraAttachmentXML(),this.objCostCenter.HistoryXML=this.ScreenObject.HistoryCCXML,this.objCostCenter.StatusXML=null!=this.ScreenObject.StatusAssignGrid?this.ScreenObject.StatusAssignGrid.GetXML():"";let c,e={};if(this.DisplayMessage=this.QuickAssign.GetXML(e),c=e.strXML,!r.J0.IsEmpty(this.DisplayMessage)||(this.objCostCenter.CCXML=c,!this.ScreenObject.ValidateDataonSave()))return;this.objCostCenter.WID=this.ScreenObject.CheckWorkFlow(),o.d.common.SaveCostCenterQuick(this.objCostCenter,"SaveCostCenterQuick").subscribe(a=>{i=a.Message,s=a.RetValue,this.MessageVisibility=!0,this.DisplayMessage=i,this.RetValue=s,s>0||s<-1e4?this.AfterSave():(this.MessageVisibility=!0,this.DisplayMessage=i)},a=>{alert(JSON.stringify(a)),console.log("Quick Add CostCenter Save : "+JSON.stringify(a))})}Logger.InfoLog("QuickAddAccountScreenViewModel::Exiting OnSaveCostCenter")}catch(s){Logger.ErrorLog("QuickAddAccountScreenViewModel:: onSaveCostCenter"+s.stack)}}AfterSave(){this.NodeID=0,this.QuickAssign.Clear(),this.ScreenObject.Clear(),null!=this.Code&&(this.Code.Text=""),null!=this.Group&&(this.Group.SelectedValue=this.ParentId),this.objCostCenter.NodeID=0,this.Title=o.d.GetResource("Add")+" "+this.DisplayName,this.IsGroup&&(this.Title=this.Title+" Group"),this.AutoGenerateCode(),this.LoadParentData(),null!=this.Parent?(null!=this.Parent.SelectedNode&&(this.Parent.obj.SetFocusNodeID=this.Parent.SelectedNode.Id),this.Parent.Refresh(),this.Parent.SetVisibilityFalse(),this.Parent.AddEditCosCenterVisibility=!0):this.CallBackDelegate.subscribe?this.CallBackDelegate.next(this.RetValue):o.d.page.HideDialog(this.PopUpGUID)}OnNameLostFocus(t){r.J0.IsEmpty(this.Name.Text),this.ScreenObject.onTextBoxLostFocus(t)}LoadParentData(){if(this.ScreenObject.dsParentData=null,0!=this.NodeID||0==this.ParentId||this.objCostCenter.IsGroup)return;let t=this.ScreenObject.Data.Tables[5].filter(n=>"Copygroupdatatonode"==n.Name);0!=t.length&&""!=t[0].Value.toString()&&(0,S.yG0)(t[0].Value)&&(this.ScreenObject.dsParentData=o.d.common.GetCopyNodeDetails(this.objCostCenter.CostCenterID,this.ParentId),0!=this.ScreenObject.dsParentData.Tables[0].length?this.ScreenObject.FillControlsWithParent(this.ScreenObject.dsParentData.Tables[0][0],this.ScreenObject.dsParentData.Columns[0],this.ScreenObject.dsParentData.Tables[0][0],this.ScreenObject.dsParentData.Columns[0],this.ScreenObject.dsParentData.Tables[7].length>0?this.ScreenObject.dsParentData.Tables[7][0]:null,this.ScreenObject.dsParentData.Tables[7].length>0?this.ScreenObject.dsParentData.Columns[7]:null,null,null,["Code","Name","IsGroup"]):this.ScreenObject.dsParentData=null)}}}}]);