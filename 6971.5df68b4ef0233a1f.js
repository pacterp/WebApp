"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[6971,7538],{75157:(b,S,l)=>{l.r(S),l.d(S,{PostDepreciationViewModel:()=>A});var r=l(32040),d=l(43767),m=l(26336),D=l(54581),P=l(33784),u=l(7321),g=l(82503),C=l(21774),p=l(85221),f=l(72247),t=l(27730),c=l(20643),y=l(23603),I=l(58170),M=l(88514);class A extends P.d{constructor(i,s,a){super(),this.FilterVisibility=!1,this.DateFilter="",this.FromDate=new g.Lc(0),this.AsonDate=new g.Lc(0),this.DateRanges=new t.y$(0),this.PostButtonLabel=null,this.Enable=!0,this.IsDashBoard=!1,this.IsUnPostScreen=!1,this.SystemDate=Date.Today(),this.IsPostingOnScheduleDate=!1,this.AllowEditPostingDate=!1,this.strSelect="",this.strJoin="",this.DateColIDs=new Array,this.Ddate=Date.Today(),this.SelectUnCheck=0,this.sbSchdulesDeleted="",this.iLoop=0,this.iStart=1,this.JVCCID=0,this.iFailure=0,this.dicVouchers=new m.bT,this.dicVouchersCnt=new m.bT,this.ClassName="PostDepreciationViewModel",this.IsDashBoard=s,this.DisplayName=this.Title=i,this.IsUnPostScreen=a,this.FromDate.Date=Date.Today().AddDays(1-Date.Today().getDate()),this.AsonDate.Date=this.FromDate.Date.AddMonths(1).AddDays(-1),this.DateRanges=new t.y$,this.DateRanges.Items=c.w.items_DateRanges,this.DateRanges.SelectionChangedCommand.Subscribe(this,"OnDateRangesSelectionChanged"),s?(this.FromDate.Width="190",this.AsonDate.Width="190",this.FromDate.LblWidth="72",this.AsonDate.LblWidth="80",window.innerWidth<=1540&&(this.FromDate.Width="",this.AsonDate.Width="",this.FromDate.LblWidth="",this.AsonDate.LblWidth="")):(this.FromDate.Width="150",this.AsonDate.Width="150"),this.PostButtonLabel=a?"Un-Post":r.d.GetResource("Post"),this.FromDate.Label=r.d.GetResource("FromDate"),this.AsonDate.Label=r.d.GetResource("ToDate");try{this.DepreciationGrid=new u.vv,this.DepreciationGrid.Width="",this.DepreciationGrid.Height=0,s||(this.DepreciationGrid.SearchVisible=!0,this.DepreciationGrid.SelectAll.Visible=!0,this.DepreciationGrid.SortVisible=!0,this.FilterVisibility=!0),this.DepreciationGrid.SelectAll.DBColumnName="select",this.InitColumns(),this.FilterVisibility?this.InitFilterScreen():this.DeprDataFilling()}catch(e){Logger.ErrorLog("PostDepreciationViewModel","Constructor",e)}}InitColumns(){let i=new Array,s=new C.O7;s.Header=r.d.GetResource("select"),s.DisplayMember="select",s.DataType="CheckBox",s.Width=55,s.CheckedChanged.Subscribe(this,"OnCheckedChanged"),i.push(s),this.IsUnPostScreen||(this.AllowEditPostingDate=r.d.SessionManager.IsActionAssigned(72,"Allow editing of depreciation posting date"),this.AllowEditPostingDate&&(s=new C.O7,s.Header="Post Date",s.DisplayMember="PostDate",s.DataType="DATE",s.Width=110,s.ReadOnly=!1,s.CheckedChanged.Subscribe(this,"OnCheckedChanged"),i.push(s)));let e,a=r.d.report.GetReportData(12,this.IsUnPostScreen?201:197,null),n=1,h="";a.Tables[0].forEach(o=>{e=new C.O7,e.Header="Asset Code"==o.Caption.toString()?r.d.GetResource("PDAssetCode"):"Asset Name"==o.Caption.toString()?r.d.GetResource("PDAssetName"):"Start Date"==o.Caption.toString()?r.d.GetResource("PDStartDate"):"End Date"==o.Caption.toString()?r.d.GetResource("PDEndDate"):"Depr Amount"==o.Caption.toString()?r.d.GetResource("PDDeprAmount"):"Accu. Depr"==o.Caption.toString()?r.d.GetResource("PDAccuDepr"):"Net Value"==o.Caption.toString()?r.d.GetResource("PDNetValue"):"Put To Use"==o.Caption.toString()?r.d.GetResource("PDPuttouse"):o.Caption.toString(),e.ID=o.ID.toString(),e.DisplayMember=o.ID.toString(),e.DataType=o.DType.toString(),"DATE"==e.DataType?(this.DateColIDs.push(e.DisplayMember),e.DisplayMember=e.DisplayMember+"_Key"):"FLOAT"==e.DataType?e.DecimalPoints=d.J0.IsNum(o.Decimals)?d.J0.Int(o.Decimals).toString():r.d.SessionManager.Preferences.DecimalsinAmount:"VoucherNo"==e.ID&&(e.DataType="LINK_VOUCHER"),e.ReadOnly=!0,e.Width=parseInt(o.Width),null!=o.Visible&&0==parseInt(o.Visible)&&(e.IsVisible=!1),i.push(e),33==e.ID.length&&(h="T"+n,"ACC_Assets"==o.SFSysTableName.toString()?null!=o.SSFIsFK&&(0,D.yG0)(o.SSFIsFK)?(this.strSelect+="DATE"==e.DataType?",convert(datetime,"+h+"."+o.SSFSysColumnName.toString()+") "+e.ID:","+h+"."+o.SSFSysColumnName.toString()+" "+e.ID,this.strJoin+=" left join "+o.SSFParentCostCenterSysName.toString()+" "+h+" with(nolock) on "+h+"."+o.SSFParentCostCenterColSysName.toString()+"=acc."+o.SFSysColumnName.toString()):this.strSelect+="DATE"==e.DataType?",convert(datetime,Acc."+o.SFSysColumnName.toString()+") "+e.ID:",Acc."+o.SFSysColumnName.toString()+" "+e.ID:"COM_CCCCDATA"==o.SFSysTableName.toString()&&null!=o.SSFIsFK&&(0,D.yG0)(o.SSFIsFK)&&(this.strSelect+="DATE"==e.DataType?",convert(datetime,"+h+"."+o.SSFSysColumnName.toString()+") "+e.ID:","+h+"."+o.SSFSysColumnName.toString()+" "+e.ID,this.strJoin+=" left join "+o.SSFParentCostCenterSysName.toString()+" "+h+" with(nolock) on "+h+"."+o.SSFParentCostCenterColSysName.toString()+"=cc."+o.SFSysColumnName.toString())),n++}),this.DepreciationGrid.Columns=i}DeprDataFilling(){if(this.deprTable=null,null==this.FromDate.Date||null==this.AsonDate.Date)return null==this.AsonDate.Date?this.DisplayMessage="Select "+this.AsonDate.Label:null==this.FromDate.Date&&(this.DisplayMessage="Select "+this.FromDate.Label),void(this.MessageVisibility=!0);let s,a,i={strTreeJoin:"",strTreeWhere:""};if(this.IsDashBoard||(this.DateFilter="From : "+this.FromDate.Date.ToString(r.d.SessionManager.Preferences["Date Format"]),this.DateFilter+="    To : "+this.AsonDate.Date.ToString(r.d.SessionManager.Preferences["Date Format"]),this.GetFilters(i)),this.SystemDate=Date.Today(),this.deprTable=y.Document.GetDepreciationDocuments(this.IsUnPostScreen,this.FromDate.Date,this.AsonDate.Date,this.strSelect,i.strTreeJoin+this.strJoin,i.strTreeWhere),null!=this.deprTable&&this.deprTable.Tables.length>0&&this.deprTable.Tables[0].length>0){this.deprTable.Columns[0].push("select"),this.AllowEditPostingDate&&(this.deprTable.Columns[0].push("PostDate_Key"),this.deprTable.Columns[0].push("PostDate"));let e=this.deprTable.Tables[1].filter(n=>"AssetDeprPostDate"==n.Name);e.length>0&&"ScheduleDate"==d.J0.String(e[0].Value)?this.IsPostingOnScheduleDate=!0:this.SystemDate=d.J0.ParseDate(this.deprTable.Tables[2][0].SystemDate),this.DateColIDs.forEach(n=>{this.deprTable.Columns[0].push(n+"_Key")}),this.deprTable.Tables[0].forEach(n=>{n.select=!1,this.DateColIDs.forEach(h=>{s=h+"_Key",d.J0.IsEmpty(n[h])||(a=d.J0.ParseDate(n[h]),n[s]=a.ToString(r.d.SessionManager.Preferences["Date Format"])),this.AllowEditPostingDate&&(this.IsPostingOnScheduleDate?(n.PostDate_Key=n.ToDate,n.PostDate=d.J0.ParseDate(n.ToDate).ToString(r.d.SessionManager.Preferences["Date Format"])):(n.PostDate_Key=this.SystemDate,n.PostDate=this.SystemDate.ToString(r.d.SessionManager.Preferences["Date Format"])))})})}this.DepreciationGrid.SelectAll.IsChecked=!1,this.DepreciationGrid.Table=this.deprTable.Tables[0],this.DepreciationGrid.setRowid()}OnButtonClick(i){"PostDepreciation"==i?this.IsUnPostScreen?this.worker_DoWork():(new p.N).DepreciationScheduleViewModel_2(this.deprTable,this):"RefreshDepr"==i?this.DeprDataFilling():"Regenerate"==i?this.FilterVisibility=!0:"DeprExport"==i||("FilterOK"==i?(this.DeprDataFilling(),this.FilterVisibility=!1):"FilterCancel"==i&&(this.FilterVisibility=!1))}SelectUnselectAll(i){for(let s=0;s<this.DepreciationGrid.Table.length;s++)0==this.SelectUnCheck&&(this.DepreciationGrid.Table[s].Select=i);this.SelectUnCheck=0}OnCheckedChanged(i,s){s||1==this.DepreciationGrid.SelectAll.IsChecked&&(this.SelectUnCheck=1,this.DepreciationGrid.SelectAll.IsChecked=!1)}worker_RunWorkerCompleted(){if(this.Enable=!0,this.sbSchdulesDeleted.length>0){let i;this.sbSchdulesDeleted.toString().split(",").forEach(a=>{i=this.DepreciationGrid.Table.filter(e=>e.ScheduleID==a),i.length>0&&this.DepreciationGrid.removeRow(i[0])})}}worker_DoWork(){this.Enable=!1;let i=this.DepreciationGrid.Table;if(this.drrPost=[],i.length>0&&(this.drrPost=i.filter(e=>1==e.select),this.drrPost.SortBy([{name:"ToDate",desc:!0},"VoucherNo"])),0==this.drrPost.length)return void(this.DisplayMessage=r.d.GetResource("PleaseSelectDepreciation"));this.DisplayMessage="Posting 0 of "+this.drrPost.length,this.sbSchdulesDeleted="",this.JVCCID=0;let a,s=this.deprTable.Tables[1].filter(e=>"DepreciationJV"==e.Name);s.length>0&&parseInt(s[0].Value)>0&&(this.JVCCID=parseInt(s[0].Value)),this.iFailure=0,this.dicVouchers.Clear(),this.dicVouchersCnt.Clear();for(let e=0;e<this.drrPost.length;e++)a=this.drrPost[e].VoucherNo.toString(),this.dicVouchers.ContainsKey(a)?(this.dicVouchers[a]+=","+this.drrPost[e].ScheduleID.toString(),this.dicVouchersCnt[a]++):(this.dicVouchers.push(a,this.drrPost[e].ScheduleID.toString()),this.dicVouchersCnt.push(a,1));this.iStart=1,this.iLoop=0,this.PostDepr_CallBack()}PostDepr_CallBack(){if(this.iLoop>=this.dicVouchers.keys.length)return void this.worker_RunWorkerCompleted();let i=this.dicVouchers.keys[this.iLoop];this.DisplayMessage=1==this.dicVouchersCnt[i]?"Posting "+this.iStart+" of "+this.drrPost.length:"Posting ("+this.iStart+"-"+(this.iStart+this.dicVouchersCnt[i]-1)+") of "+this.drrPost.length,M.V.SetsPostDeprReverseJV(this.JVCCID,i,this.dicVouchers[i]).then(s=>{this.DisplayMessage=s.Message,d.J0.Int(s.RetValue)>0?(this.sbSchdulesDeleted.length>0&&(this.sbSchdulesDeleted+=","),this.sbSchdulesDeleted+=this.dicVouchers[i]):this.iFailure+=this.dicVouchersCnt[i],this.iStart+=this.dicVouchersCnt[i],this.iLoop++,this.PostDepr_CallBack()})}InitFilterScreen(){this.tree=new Array,this.CostCenterFilters=new Array,this.CostCenters=new t.y$(0),this.CostCenters.Label=r.d.GetResource("SelectCostCenter"),this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange"),r.d.common.GetDataTable("ASS002",r.d.SessionManager.LanguageID).forEach(s=>{let a=parseInt(s.FeatureID);this.CostCenters.Items.push(t._p.ComboBoxItems_2(s.Name.toString(),s.FeatureID.toString())),72==a&&(this.CostCenters.SelectedValue="72",this.CostCenters.SelectedItem=this.CostCenters.Items[this.CostCenters.Items.length-1])}),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),0,0,null)}OnCostCenterChange(i){if(!d.J0.IsEmpty(this.CostCenters.SelectedValue)&&(0==this.tree.length||this.tree[0].CostCenterID!=parseInt(this.CostCenters.SelectedValue))){let s=0;null!=this.CostCenters.SelectedItem&&!d.J0.IsEmpty(this.CostCenters.SelectedItem.Parent)&&(s=d.J0.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),s,0,null)}}LoadCostCenterTree(i,s,a,e){this.tree.Clear();let h,n="";if(50002==i&&"True"==r.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==r.d.SessionManager.Preferences["LW Reports"]&&(n=d.J0.IsEmpty(r.d.SessionManager.LocationWhere)?"NodeID IN (-1234)":"NodeID IN ("+r.d.SessionManager.LocationWhere+")"),null==e)for(let o=0;o<this.CostCenterFilters.length;o++){let T=this.CostCenterFilters[o];if(T.CostCenterID==i&&T.LookupTypeID==s){e=T.SelectedNodes;break}}44==i&&s>0&&(n="A.LookupType="+s),h=new f.T,null==e?h.TreeViewModel_5(i,this,a,n,null):h.TreeViewModel_6(i,this,a,n,e,null),h.LookupTypeID=s,h.HeaderVisiblity=!1,h.OnNodeSelected=new I.Yk,h.OnNodeSelected.Subscribe(this,"OnNodeSelected"),this.tree.push(h)}GetFilters(i){i.strTreeJoin="",i.strTreeWhere="";let s="",a="";this.CostCenterFilters.forEach(e=>{if(a="",72==e.CostCenterID){for(let n=0;n<e.SelectedNodes.length;n++)(null==e.SelectedNodes[n].Parent||!e.SelectedNodes[n].Parent.IsSelected)&&(a.length>0&&(a+=","),a+=e.SelectedNodes[n].Id);a.length>0&&(i.strTreeJoin+=" join Acc_Assets GTP with(nolock) on Acc.lft between GTP.lft AND GTP.rgt",s+=" and GTP.AssetID in ("+a.toString()+")")}else{for(let n=0;n<e.SelectedNodes.length;n++)e.SelectedNodes[n].IsGroup||(a.length>0&&(a+=","),a+=e.SelectedNodes[n].Id);a.length>0&&(s+=50002==e.CostCenterID?" and (Acc.LocationID in ("+a.ToString()+") OR CC.CCNID"+(e.CostCenterID-5e4)+" in ("+a.ToString()+"))":" and CC.CCNID"+(e.CostCenterID-5e4)+" in ("+a.toString()+")")}}),i.strTreeWhere=s.toString()}OnDateRangesSelectionChanged(i){null!=this.DateRanges.SelectedValue&&c.w.SetDateRanges(this.DateRanges.SelectedValue,this.FromDate,this.AsonDate)}}},84590:(b,S,l)=>{l.r(S),l.d(S,{DbPanel:()=>p,SalesDashboardViewModel:()=>C});var r=l(98580),d=l(43767),m=l(75157),D=l(32040),P=l(7321),u=l(21774);class g extends r.g{constructor(){super(),this.LocationID="",Logger.InfoLog("RejectedDocumentViewModel:: Entering RejectedDocumentViewModel");try{this.DocumentsGrid=new P.vv,this.DocumentsGrid.Width="",this.DocumentsGrid.Columns=[];let t=new u.O7;t.Header=D.d.GetResource("Service_Date"),t.DisplayMember="Date_Text",t.ReadOnly=!0,t.Width=100,this.DocumentsGrid.Columns.push(t),t=new u.O7,t.Header=D.d.GetResource("Doc_DocumentNumber"),t.DisplayMember="VoucherNo",t.DataType="LINK",t.ReadOnly=!0,t.Width=100,this.DocumentsGrid.Columns.push(t),t=new u.O7,t.Header="Type",t.DisplayMember="DocumentName",t.DataType="Date_Text",t.ReadOnly=!0,t.Width=100,this.DocumentsGrid.Columns.push(t),t=new u.O7,t.Header="Debit",t.DisplayMember="AccountID",t.DataType="TextBlock",t.ReadOnly=!0,t.Width=100,this.DocumentsGrid.Columns.push(t),t=new u.O7,t.Header="Credit",t.DisplayMember="BankAccountID",t.DataType="TextBlock",t.ReadOnly=!0,t.Width=100,this.DocumentsGrid.Columns.push(t),t=new u.O7,t.Header="Amount",t.DisplayMember="Amount",t.DataType="FLOAT",t.DecimalPoints=D.d.SessionManager.Preferences.DecimalsinAmount.toString(),t.ReadOnly=!0,t.Width=100,this.DocumentsGrid.Columns.push(t),t=new u.O7,t.Header="User Name",t.DisplayMember="ModifiedBy",t.DataType="TextBlock",t.ReadOnly=!0,t.Width=100,this.DocumentsGrid.Columns.push(t),this.DocumentsGrid.OnLinkClick.Subscribe(this,"OnLinkClickEvent"),this.LocationID=D.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==D.d.SessionManager.Preferences.EnableLocationWise.ToString()?D.d.SessionManager.LocationID>0?D.d.SessionManager.LocationID.toString():D.d.SessionManager.LocationWhere:"0",this.OnLoad()}catch(t){Logger.ErrorLog("RejectedDocumentViewModel","Constructor",t.Message)}Logger.InfoLog("RejectedDocumentViewModel:: Entering RejectedDocumentViewModel")}OnLoad(){let t=D.d.document.GetUnApprovedDocuments(this.LocationID,372);null!=t&&(t.Columns[0].push("Date_Text"),t.Tables[0].forEach(c=>{c.Date_Text=new Date(c.DocDate).ToString(D.d.SessionManager.Preferences["Date Format"])})),this.DocumentsGrid.Table=t}OnLinkClickEvent(t,c,y){}}class C extends r.g{get TabBackColor(){return"White"}get panels(){return this._panels}FillPanels(){for(let t=0;t<6;t++){let c=new p;c.DisplayName="Mukaram"+t.ToString(),c.View={Text:"C O N T E N T",FontSize:50},this._panels.push(c)}}#e;constructor(){super(),this._panels=[],this.timerdashboard=new d.M4,this.tdMaximize=new Array(4).fill(!1),Logger.InfoLog("DashboardViewModel::Entering DashboardViewModel"),this.timerdashboard.Enabled=!0,this.timerdashboard.Interval=6e4,this.timerdashboard.Elapsed(this,"timerdashboard_Elapsed"),this.DisplayName="Sales Dashboard",this.DepreciationPosting=new m.PostDepreciationViewModel("",!0,!1),this._panels=[],this.FillPanels(),this.RejectedDocuments=new g,Logger.InfoLog("DashboardViewModel::Exiting DashboardViewModel")}timerdashboard_Elapsed(t,c){D.d.page.isActiveTab(this)&&this.RejectedDocuments.OnLoad()}worker_DoWork(t,c){}OnButtonClick(t){"Rejected"==t&&this.RejectedDocuments.OnLoad()}}class p{}}}]);