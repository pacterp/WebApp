"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[9399],{21780:(x,_,R)=>{R.r(_),R.d(_,{ACC_CashFlow:()=>k});var w=R(32040),d=R(43767),m=R(26336),v=R(76260),N=R(61488),F=R(89731),W=R(27730);class H{}var T=function(M){return M[M.None=0]="None",M[M.MonthWise=1]="MonthWise",M[M.QtrWise=4]="QtrWise",M[M.HalfYearWise=5]="HalfYearWise",M[M.YearWise=3]="YearWise",M[M.TagWise=2]="TagWise",M}(T||{});class k extends v.A{constructor(t){super(t),this.Show=T.None,this.k=0,this.dtMonthBF=null,this.dtMonthTrans=null,this.dtMonthColsing=null,this.colSpanBF=-1,this.colTotalIndex=-1,this.colMonthIndex=-1,this.CntMonths=0,this.YTDIndex=0,this.YTD_LYIndex=0,this.BAL_LYIndex=0,this.ForeignCurrencyID=0,this.CurrencyType=0,this.ShowYearWise=!1,this.AllowFromDateFilter=!1,this.dsYTD=null,this.dsBAL_LY=null,this.dsYTD_LY=null,this.xCFDoc=new d.VB,this.dbl=0,this.dblValue=0,this.SectionHeaderAppearance=new N.bA,this.SectionHeadingAppearance=new N.bA,this.MonthColumns=new Array,this.lstTags=new Array,this.YearSlots=new m.bT,this.QtrSlot=new m.bT,this.AllMnQtrSlot=new m.bT,this.LYTDfldDict=new m.bT,this.iLoop=0,this.YearfldDict=new m.bT,this.RatioComplete1Promise=[],this.ShowTotal=!1,this.SectionRow=null,this.HeaderRow=null,this.SectionHeaderAppearance.IsBold=!0,this.SectionHeaderAppearance.FontSize=14,this.SectionHeaderAppearance.ForeColor="#FF00465A",this.SectionHeaderAppearance.BackColor="White",this.SectionHeaderAppearance.FontFamilyName="Arial",this.SectionHeadingAppearance.IsBold=!1,this.SectionHeadingAppearance.FontSize=12,this.SectionHeadingAppearance.ForeColor="#FF00465A",this.SectionHeadingAppearance.BackColor="White",this.SectionHeadingAppearance.FontFamilyName="Arial"}LoadReport(){this.GrdRow=-1,this.AggTotal=d.J0.NumArray(this.oColumns.length,2);for(let e=0;e<this.ViewModel.ColumnSource.length;e++)if("FLOAT"==this.ViewModel.ColumnSource[e].ColumnType){this.colSpanBF=e;break}for(let e=this.ViewModel.ColumnSource.length-1;e>=0;e--)if("Months"==this.ViewModel.ColumnSource[e].ID){this.colMonthIndex=e;break}let t=new Array;for(let e=0;e<this.ViewModel.ColumnSource.length;e++)t.push(this.ViewModel.ColumnSource[e]);if(this.CntMonths=0,-1!=this.colMonthIndex)if(this.ViewModel.TotalCols.Clear(),this.ViewModel.GrpReportTotal.TotalCols.Clear(),this.ViewModel.AddTotalColumnsToGroup(this.ViewModel.GrpReportTotal,this.ViewModel.ReportDoc.SelectSingleNode("PactRevenURpts/PactRevenURptDef/ReportTotal/Columns")),this.ViewModel.TotalCols.Contains("Months")&&this.ViewModel.TotalCols.Remove("Months"),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey("Months")&&this.ViewModel.GrpReportTotal.TotalCols.Remove("Months"),"1"!=this.ViewModel.Preferences.MonthWiseData)t.RemoveAt(this.colMonthIndex),this.colMonthIndex=-1;else{let e=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),this.ViewModel.FromDatePicker.Date.getMonth(),1),a=this.ViewModel.ToDatePicker.Date;for(;e<=a;){let o=this.ViewModel.ColumnSource[this.colMonthIndex].Clone();o.ID="Y"+e.getFullYear()+"M"+e.iMonth(),o.HeaderText=e.ToString("MMM yyyy"),t.Insert(this.colMonthIndex+this.CntMonths+1,o),e=e.AddMonths(1),this.ViewModel.TotalCols.push(o.ID),this.ViewModel.GrpReportTotal.TotalCols.push(o.ID,this.colMonthIndex+this.CntMonths),this.MonthColumns.push(o),this.CntMonths++}t.RemoveAt(this.colMonthIndex)}this.YTDIndex=this.YTD_LYIndex=this.BAL_LYIndex=-1;for(let e=t.length-1;e>=0;e--)"Balance"==t[e].ID?this.colTotalIndex=e:"YTD"==t[e].ID?(this.YTDIndex=e,this.LYTDfldDict.push(t[e].ID,null)):"LastYearBalance"==t[e].ID||"LastYearPeriodValue"==t[e].ID?(this.BAL_LYIndex=e,this.LYTDfldDict.push(t[e].ID,null)):"LastYearValue"==t[e].ID?this.LYTDfldDict.push(t[e].ID,null):"LastYearYTD"==t[e].ID&&(this.YTD_LYIndex=e,this.LYTDfldDict.push(t[e].ID,null));this.AggTotal=d.J0.NumArray(t.length,2),this.ViewModel.ReportColumns=t,this.oColumns=this.ViewModel.ReportColumns,this.ViewModel.IsTotalColsAdded=!0,this.ViewModel.totals=d.J0.NumArray(this.oColumns.length,4),this.dtYearStartMonth=new Date(Date.Today().getFullYear(),w.d.SessionManager.AccountingFromMonth-1,1),this.dtYearStartMonth>Date.Today()&&(this.dtYearStartMonth=this.dtYearStartMonth.AddYears(-1));try{if(this.PDCInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludePDCs")||"1"!=this.ViewModel.Preferences.IncludePDCs),this.IncludeTerminatedPDC=!(this.ViewModel.Preferences.ContainsKey("IncludeTerminatedPDC")&&"0"==this.ViewModel.Preferences.IncludeTerminatedPDC),this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.UnPostedDocsList=this.UnPostedDocsInclude&&this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsList")?this.ViewModel.Preferences.IncludeUnPostedDocsList:"",this.CurrencyType=0,this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){let e=new d.VB;e.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");let a=d.VB.SelectSingleNode(e.DocumentElement,"IsChecked");null!=a&&"1"==a.innerHTML&&(this.ForeignCurrencyID=parseInt(d.VB.SelectSingleNode(e.DocumentElement,"Value").innerHTML))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){let e=new d.VB;e.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=parseInt(d.VB.SelectSingleNode(e.DocumentElement,"Type").innerHTML),1==this.CurrencyType?(d.J0.IsEmpty(w.d.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(w.d.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=parseInt(d.VB.SelectSingleNode(e.DocumentElement,"Value").innerHTML))}if(98==this.ViewModel.StaticReportType){let e="0";if(this.AllowFromDateFilter=!(!this.ViewModel.Preferences.ContainsKey("AllowFromDateFilter")||"1"!=this.ViewModel.Preferences.AllowFromDateFilter),this.AllowFromDateFilter&&this.ViewModel.Preferences.ContainsKey("FinalReportsShow")&&(e=this.ViewModel.Preferences.FinalReportsShow),"1"==e?this.Show=T.MonthWise:"4"==e?this.Show=T.QtrWise:"3"==e&&(this.Show=T.YearWise,this.ViewModel.oReportDialog.FromDate.Date.getFullYear()==this.ViewModel.oReportDialog.ToDate.Date.getFullYear()&&(this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")||(this.Show=T.None))),this.dtMain=[],this.dtColumnsMain=[],this.dtColumnsMain.push("RatioName"),this.dtColumnsMain.push("Value"),this.dtColumnsMain.push("Perc"),this.xCFDoc.LoadXml("<RatioAnalysisXml>"+this.ViewModel.Preferences.RatioAnalysisXml+"</RatioAnalysisXml>"),this.Show!=T.None){let l=!(!this.ViewModel.Preferences.ContainsKey("Sort")||"ASC"!=this.ViewModel.Preferences.Sort),i=new Date(this.dtYearStartMonth.getFullYear(),this.dtYearStartMonth.getMonth(),1),s=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1),C=1,u=this.Show==T.HalfYearWise?6:3,D="",c=!0,r=t.find(A=>"Value"==A.ID),p=t.indexOf(r),P=0;for(;s<=this.ViewModel.oReportDialog.ToDate.Date;){let A=r.Clone();if(this.Show==T.MonthWise)A.HeaderText=s.ToString("MMM yy"),A.ID="Y"+s.getFullYear()+"M"+s.iMonth(),this.YearSlots.push(A.ID,s);else if(this.Show==T.QtrWise||this.Show==T.HalfYearWise){if(c){for(s=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),w.d.SessionManager.AccountingFromMonth-1,1),s>this.ViewModel.FromDatePicker.Date&&(s=s.AddYears(-1)),C=1;s.AddMonths(u)<=this.ViewModel.FromDatePicker.Date;)C++,s=s.AddMonths(u);D=1==w.d.SessionManager.AccountingFromMonth?s.getFullYear().toString():s.iMonth()>=w.d.SessionManager.AccountingFromMonth?s.getFullYear().toString()+"-"+((s.getFullYear()+1)%100).toString():(s.getFullYear()-1).toString()+"-"+(s.getFullYear()%100).toString()}else C++,(this.Show==T.QtrWise&&5==C||this.Show==T.HalfYearWise&&3==C)&&(C=1),D=1==w.d.SessionManager.AccountingFromMonth?s.getFullYear().toString():s.iMonth()>=w.d.SessionManager.AccountingFromMonth?s.getFullYear().toString()+"-"+((s.getFullYear()+1)%100).toString():(s.getFullYear()-1).toString()+"-"+(s.getFullYear()%100).toString();A.HeaderText=(this.Show==T.HalfYearWise?"H":"Q")+C+" "+D,A.ID="Y"+s.getFullYear()+"M"+s.iMonth(),this.YearSlots.push(A.ID,s),c=!1;let f=new H;f.dtStart=s,f.dtEnd=s.AddMonths(u).AddDays(-1),this.QtrSlot.push(A.ID,f);let E=s;for(let Y=0;Y<u;Y++)this.AllMnQtrSlot.push(E.ToString("yyyy-M"),A.ID),E=E.AddMonths(1)}else A.HeaderText=s.ToString("yyyy"),A.ID="Y"+s.getFullYear(),this.YearSlots.push(A.ID,i),i=i.AddYears(1);this.lstTags.push(A.ID),this.dtColumnsMain.push(A.ID),++P,t.Insert(l?p+P:p+1,A),s=this.Show==T.MonthWise?s.AddMonths(1):this.Show==T.QtrWise||this.Show==T.HalfYearWise?s.AddMonths(u):s.AddYears(1)}}else if(!this.AllowFromDateFilter&&this.ViewModel.Preferences.ContainsKey("ShowYearWise")){let l=new d.VB;l.LoadXml("<XML>"+this.ViewModel.Preferences.ShowYearWise+"</XML>");let i=d.VB.SelectSingleNode(l.DocumentElement,"IsChecked");if(null!=i&&"1"==i.innerHTML&&(this.ShowYearWise=!0,i=d.VB.SelectSingleNode(l.DocumentElement,"Text"),this.CntMonths=d.J0.Int(i.innerHTML),this.CntMonths<=0&&(this.ShowYearWise=!1),this.ShowYearWise)){let s=t.find(c=>"Value"==c.ID),C=t.indexOf(s);t.Remove(s);let u=new Date(Date.Today().getFullYear(),w.d.SessionManager.AccountingFromMonth-1,1);u>Date.Today()&&(u=u.AddYears(-1));let D=!(!this.ViewModel.Preferences.ContainsKey("Sort")||"ASC"!=this.ViewModel.Preferences.Sort);for(let c=0;c<this.CntMonths;c++){let r=s.Clone();r.HeaderText=u.ToString("yyyy"),r.ID=u.getFullYear().toString(),this.lstTags.push(r.ID),this.dtColumnsMain.push(r.ID),D?t.Insert(C,r):t.push(r),u=u.AddYears(-1)}this.ViewModel.ReportColumns=new Array,this.ViewModel.ReportColumns=t,this.oColumns=this.ViewModel.ReportColumns}}this.ViewModel.ReportColumns=t,this.oColumns=this.ViewModel.ReportColumns,this.eval=new F.CC,this.fldDict=new m.bT,this.YearfldDict.Clear(),this.iLoop=0;let n=d.VB.SelectSingleNode(this.xCFDoc.DocumentElement,"VariablesList");this.xVarListMain=n.childNodes,this.Show!=T.None?(this.lstTags.forEach(l=>{this.YearfldDict.push(l,new m.bT)}),this.YearfldDict.push("Value",new m.bT),this.RatioCallBack_NotNone()):this.ShowYearWise?(this.lstTags.forEach(l=>{this.YearfldDict.push(l,new m.bT)}),this.RatioCallBack_Year()):this.RatioCallBack_None()}else if(99==this.ViewModel.StaticReportType){this.xCFDoc.LoadXml("<CashFlowXml>"+this.ViewModel.Preferences.CashFlowXml+"</CashFlowXml>"),this.ChunkSize=this.ViewModel.Preferences.ContainsKey("ChunkSize")?parseInt(this.ViewModel.Preferences.ChunkSize):1;let e,a="",o="",h=new Array,n=new Array;this.xCFDoc.DocumentElement.childNodes.forEach(C=>{for(let u=0;u<C.childNodes.length;u++)e=C.childNodes[u],"Group"==e.attributes.Type.value?n.Contains(e.attributes.ACC.value)||(a.length>0&&(a+=","),a+=e.attributes.ACC.value,n.push(e.attributes.ACC.value)):"Account"==e.attributes.Type.value&&(h.Contains(e.attributes.ACC.value)||(o.length>0&&(o+=","),o+=e.attributes.ACC.value,h.push(e.attributes.ACC.value)))});let l=[];l.push(this.ViewModel.oReportDialog.FromDate.Date),l.push(this.ViewModel.oReportDialog.ToDate.Date),l.push(this.UnPostedDocsInclude),l.push(this.PDCInclude),l.push(this.IncludeTerminatedPDC),l.push(a.toString()),l.push(o.toString()),l.push(-1!=this.colMonthIndex),"1"==this.ViewModel.Preferences.ShowProjections&&this.ViewModel.Preferences.ContainsKey("Documents")?l.push(this.ViewModel.Preferences.Documents):l.push("");let i="";this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(i=d.J0.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+")"),l.push(i+this.GetDimensionFilter("DCC.dcCCNID")),l.push(w.d.SessionManager.LanguageID);let s=new m.bT;if(s.push("ds",w.d.report.GetCashFlow(l)),-1!=this.YTDIndex){let C=l.Copy();C[0]=this.dtYearStartMonth,C[6]=!1,s.push("dsYTD",w.d.report.GetCashFlow(C))}if(-1!=this.BAL_LYIndex){let C=l.Copy();C[0]=this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1),C[1]=this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1),C[6]=!1,s.push("dsBAL_LY",w.d.report.GetCashFlow(C))}if(-1!=this.YTD_LYIndex){let C=l.Copy();C[0]=this.dtYearStartMonth.AddYears(-1),C[1]=this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1),C[6]=!1,s.push("dsYTD_LY",w.d.report.GetCashFlow(C))}Promise.all(s.values).then(C=>{let u;this.ds=C[0],this.dvAcc=this.dvAccTable=this.ds.Tables[0],this.dvAccColumns=this.ds.Columns[0],this.dvGroup=this.dvGroupTable=this.ds.Tables[1],this.dvGroupColumns=this.ds.Columns[1],-1!=this.YTDIndex&&(u=s.keys.indexOf("dsYTD"),this.dsYTD=C[u],this.ds.Columns[0].push("YTD"),this.ds.Columns[1].push("YTD")),-1!=this.BAL_LYIndex&&(u=s.keys.indexOf("dsBAL_LY"),this.dsBAL_LY=C[u],this.ds.Columns[0].push("LastYearBalance"),this.ds.Columns[1].push("LastYearBalance")),-1!=this.YTD_LYIndex&&(u=s.keys.indexOf("dsYTD_LY"),this.dsYTD_LY=C[u],this.ds.Columns[0].push("LastYearYTD"),this.ds.Columns[1].push("LastYearYTD")),this.AddMonthColumns(this.ds.Tables[0],this.ds.Columns[0]),this.AddMonthColumns(this.ds.Tables[1],this.ds.Columns[1]),this.dvBills=this.dvPaymentTerms=null,this.ds.Tables.length>=4&&(this.dvBills=this.dvBillsTable=this.ds.Tables[2],this.dvPaymentTerms=this.dvPaymentTermsTable=this.ds.Tables[3]),this.xCFDoc.DocumentElement.childNodes.forEach(D=>{this.AddRows(D)}),this.AddSectionHeadingTotal(1,!0),this.ViewModel.Preferences.ContainsKey("DontShowCashFlowData")&&"1"==this.ViewModel.Preferences.DontShowCashFlowData?this.ViewModel.process_RunWorkerCompleted():this.GetCashFlowData(i).then(D=>{let c=D.Tables[0];this.dtMonthBF=this.dtMonthTrans=this.dtMonthColsing=null,-1!=this.colMonthIndex&&(this.dtMonthBF=c.ToTable(!0,["AccountID","Particulars"]),this.dtMonthTrans=this.dtMonthBF.Copy(),this.dtMonthColsing=this.dtMonthBF.Copy()),this.AddCFBalance(c,this.dtMonthTrans,"Trans","Change In Cash / Bank / BankCC"),this.AddCFBalance(c,this.dtMonthBF,"Opening","Opening"),this.AddCFBalance(c,this.dtMonthColsing,"Closing","Closing"),this.ViewModel.process_RunWorkerCompleted()})})}}catch(e){return void Logger.ErrorLog("ACC_CashFlow::Error LoadReport ",e)}}RatioCallBack_None(){if(this.iLoop>=this.xVarListMain.length)return void this.RatioCallBack_Complete1();let t=this.xVarListMain[this.iLoop],e=new F.Nl;e.setFieldDetails(t.attributes.Name.value,2,1,"",1,!1,!1),d.VB.SelectSingleNode(t,"Nodes"),this.GetVariableValue(t).then(o=>{e.setFieldValue(null!=o?parseFloat(o[0].Balance):0),this.fldDict.push(t.attributes.Name.value,e),this.iLoop++,this.RatioCallBack_None()})}RatioCallBack_NotNone(){if(this.iLoop>=this.xVarListMain.length)return void this.RatioCallBack_Complete1();let t=this.xVarListMain[this.iLoop];d.VB.SelectSingleNode(t,"Nodes").innerHTML.length>0&&this.GetVariableValue(t).then(a=>{this.dbl=0;let o=new F.Nl;o.setFieldDetails(t.attributes.Name.value,2,1,"",0,!1,!1),this.YearfldDict.Value.push(t.attributes.Name.value,o);let h=null!=d.VB.SelectSingleNode(t,"CurrentYear")?parseInt(d.VB.SelectSingleNode(t,"CurrentYear").innerHTML):0;if(a&&a.length>0){let n=a.Compute("sum(Balance)","");null!=n&&o.setFieldValue(parseFloat(n)),this.Show==T.QtrWise?(a.Columns.push("Tag"),a.forEach(l=>{this.AllMnQtrSlot.ContainsKey(l.YrMn.toString())?l.Tag=this.AllMnQtrSlot[l.YrMn.toString()]:0==h&&(this.dbl+=parseFloat(l.Balance))})):0==h&&a.forEach(l=>{this.lstTags.Contains(l.Tag.toString())||(this.dbl+=parseFloat(l.Balance))})}for(let n=0;n<this.lstTags.length;n++){1==h&&(this.dbl=0);let l=new F.Nl;if(l.setFieldDetails(t.attributes.Name.value,2,1,"",1,!1,!1),this.YearfldDict[this.lstTags[n]].push(t.attributes.Name.value,l),a){let i=a.filter(s=>s.Tag==this.lstTags[n]);i.length>0&&(this.Show==T.QtrWise?i.forEach(s=>{null!=s.Balance&&(this.dbl+=parseFloat(s.Balance))}):null!=i[0].Balance&&(this.dbl+=parseFloat(i[0].Balance)))}l.setFieldValue(this.dbl)}this.iLoop++,this.RatioCallBack_NotNone()})}RatioCallBack_Year(){if(this.iLoop>=this.xVarListMain.length)return void this.RatioCallBack_Complete1();let t=this.xVarListMain[this.iLoop];if(this.lstTags.length>0){let e=d.VB.SelectSingleNode(t,"Nodes"),a=new F.Nl;a.setFieldDetails(t.attributes.Name.value,2,1,"",1,!1,!1),this.YearfldDict[this.lstTags[0]].push(t.attributes.Name.value,a),e.innerHTML.length>0&&this.GetVariableValue(t).then(o=>{if(null!=o){let h=o.filter(n=>n.Tag==this.lstTags[0]);a.setFieldValue(h.length>0&&null!=h[0].Balance?parseFloat(h[0].Balance):0)}})}for(let e=1;e<this.lstTags.length;e++){let a=new F.Nl;a.setFieldDetails(t.attributes.Name.value,2,1,"",1,!1,!1),this.YearfldDict[this.lstTags[e]].push(t.attributes.Name.value,a),a.setFieldValue(0)}this.iLoop++,this.RatioCallBack_Year()}RatioCallBack_Complete1(){this.RatioComplete1Promise=[],this.LYTDfldDict.keys.forEach(t=>{this.dtColumnsMain.push(t),this.LYTDfldDict[t]=this.SetRationVariables(this.xVarListMain,t)}),Promise.all(this.RatioComplete1Promise).then(t=>{this.RatioCallBack_Complete2()})}RatioCallBack_Complete2(){let t=this.fldDict,e=this.ViewModel.oReportDialog.DefaultProperties.find(o=>o instanceof W.v4&&"RatioList"==o.DBColumnName);for(d.VB.SelectSingleNode(this.xCFDoc.DocumentElement,"RatiosList").childNodes.forEach(o=>{if(e.Items[0].IsChecked||e.Items.filter(h=>h.Name==o.attributes.Name.value&&h.IsChecked).length>0){let h={};if(h.RatioName=o.attributes.Name.value,null!=o.attributes.Perc&&(h.Perc="1"),o.attributes.Formula.value.length>0)try{this.Show!=T.None||this.ShowYearWise?this.YearfldDict.keys.forEach(n=>{let l={Key:n,Value:this.YearfldDict[n]};t=l.Value,h[l.Key]=this.eval.EvaluateExpression(o.attributes.Formula.value,t).toString()}):h.Value=this.eval.EvaluateExpression(o.attributes.Formula.value,t).toString(),this.LYTDfldDict.keys.forEach(n=>{t=this.LYTDfldDict[n],h[n]=this.eval.EvaluateExpression(o.attributes.Formula.value,t).toString()})}catch{}this.dtMain.push(h)}}),this.ViewModel.ReportData=this.dtMain,this.ViewModel.ReportDataColumns=this.dtColumnsMain,this.ViewModel.ConstructFormulaFields(!0),this.k=0;this.k<this.dtMain.length;this.k++){this.row=this.NewReportRow();for(let o=0;o<this.oColumns.length;o++)this.dtColumnsMain.Contains(this.oColumns[o].ID)&&(this.ViewModel.SetCellValue(this.dtMain[this.k][this.oColumns[o].ID],this.oColumns[o].DataFormat,this.oColumns[o].ColumnType,this.row.Cells[o]),o>0&&null!=this.dtMain[this.k].Perc&&!d.J0.IsEmptySpace(this.row.Cells[o].Text)&&(this.row.Cells[o].Text=this.row.Cells[o].Text+"%"));this.ViewModel.addRow(this.row)}this.ViewModel.process_RunWorkerCompleted()}LoadReportWithPostFilters(t){}GetCashFlowData(t){let l,i,e="",a="",o="",h="",n="",s="",C="",u="",D="";this.ForeignCurrencyID>0?(l="AmountFC",i=" AND ACC.CurrencyID="+this.ForeignCurrencyID):(l=1==this.CurrencyType?"AmountBC":"Amount",i="");let c=this.GetDimensionFilter("DCC.dcCCNID");if((t.length>0||c.length>0)&&(a=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID "+c+t,o=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID "+c+t),-1!=this.colMonthIndex&&(s=",'Y'+CONVERT(NVARCHAR,yy)+'M'+ CONVERT(NVARCHAR,mm) Mn",C=",0 yy, 0 mm",u=",yy,mm",D=",YEAR(ACC.DocDate) yy, MONTH(ACC.DocDate) mm"),n="DocDate<@From",this.PDCInclude){let r="(ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+")";this.UnPostedDocsInclude?(h=" AND ACC.DocumentType<>16 AND (\n"+r+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19))",n+=" AND ("+r+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19))"):(h=" AND ACC.DocumentType<>16 AND (\n"+r+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19 AND (ACC.StatusID=369 or ACC.StatusID=429)))",n+=" AND ("+r+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19 AND (ACC.StatusID=369 or ACC.StatusID=429)))")}else h=" AND ACC.DocumentType NOT IN (16,14,19)",n+=" AND ACC.DocumentType<>14 AND ACC.DocumentType<>19",this.UnPostedDocsInclude||(h+=" AND (ACC.StatusID=369 or ACC.StatusID=429)",n+=" AND (ACC.StatusID=369 or ACC.StatusID=429)");return e+="DECLARE @From FLOAT,@To FLOAT,@AccountID BIGINT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n\nSELECT A.AccountID,MAX(A.AccountName) Particulars,SUM(OP_Dr)-SUM(OP_Cr) Opening,SUM(TR_Dr)-SUM(TR_Cr) Trans"+s+"\nFROM (",e+="\n--Opening Dr\nSELECT DebitAccount AccountID"+C+",ACC."+l+" OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+a+"\nWHERE (ACC.DocumentType=16 OR ("+n+"))"+i+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID"+C+",0 OP_Dr,ACC."+l+" OP_Cr,0 TR_Dr, 0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+a+"\nWHERE (ACC.DocumentType=16 OR ("+n+"))"+i+"\nUNION ALL--Transaction Dr\nSELECT DebitAccount AccountID"+D+",0 OP_Dr,0 OP_Cr,"+l+" TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+a+"\nWHERE (DocDate BETWEEN @From AND @To) AND ACC.StatusID<>449"+h+i+"\nUNION ALL--Transaction Cr\nSELECT CreditAccount AccountID"+D+",0 OP_Dr,0 OP_Cr,0 TR_Dr,"+l+" TR_Cr\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+a+"\nWHERE (DocDate BETWEEN @From AND @To) AND ACC.StatusID<>449"+h+i,o.length>0&&(e+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT DebitAccount AccountID"+C+",ACC."+l+" OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+o+"\nWHERE (ACC.DocumentType=16 OR ("+n+"))"+i+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID"+C+",0 OP_Dr,ACC."+l+" OP_Cr,0 TR_Dr, 0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+o+"\nWHERE (ACC.DocumentType=16 OR ("+n+"))"+i+"\nUNION ALL--Transaction Dr\nSELECT DebitAccount AccountID"+D+",0 OP_Dr,0 OP_Cr, "+l+" TR_Dr,0 TR_Cr\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+o+"\nWHERE (DocDate BETWEEN @From AND @To)"+h+i+"\nUNION ALL--Transaction Cr\nSELECT CreditAccount AccountID"+D+",0 OP_Dr,0 OP_Cr,0 TR_Dr, "+l+" TR_Cr\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+o+"\nWHERE (DocDate BETWEEN @From AND @To)"+h+i),e+=") AS ACC INNER JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=ACC.AccountID\nGROUP BY A.AccountTypeID,A.AccountID,A.IsGroup,A.TB_INT"+u+"\nHAVING A.AccountID>1",e+=" AND A.AccountTypeID IN (1,2,3) AND A.IsGroup=0",e+=" Order By A.AccountTypeID,Particulars",w.d.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,e.toString())}AddMonthColumns(t,e){let a=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),this.ViewModel.FromDatePicker.Date.getMonth(),1),o=this.ViewModel.ToDatePicker.Date;for(;a<=o;)e.push("Y"+a.getFullYear()+"M"+a.iMonth()),a=a.AddMonths(1)}AddRows(t){if(0==t.childNodes.length)return;let e;this.row=this.NewReportRow_2(N.QS.Header,this.SectionHeaderAppearance),this.row.LevelNo=1,this.row.IsGroup=!0,this.row.IsExpanded=!0,this.row.Cells[0].Text=t.attributes.Caption.value,this.row.Cells[0].ColSpan=this.oColumns.length,this.SectionRow=this.row,this.ViewModel.addRow(this.row),this.ShowTotal=!1;let a,o,n,l,i,s,C,u,D,h=0;this.HeaderRow=null;for(let c=0;c<t.childNodes.length;c++)if(e=t.childNodes[c],"Heading"==e.attributes.Type.value)this.AddSectionHeadingTotal(3,this.ShowTotal),this.row=this.NewReportRow_2(N.QS.SubReportHeader,this.GrossTotalAppearance),this.row.IsGroup=!0,this.row.IsExpanded=!0,this.row.LevelNo=2,this.row.Parent=this.SectionRow,this.HeaderRow=this.row,this.row.Cells[0].Text="  "+e.attributes.Heading.value,this.row.Cells[0].ColSpan=this.oColumns.length,this.ViewModel.addRow(this.row),this.ShowTotal="1"==e.attributes.Total.value;else{if(this.row=this.NewReportRow(),this.row.LevelNo=3,this.row.Parent=null==this.HeaderRow?this.SectionRow:this.HeaderRow,n=e.attributes.ACC.value,this.row.NodeID=parseInt(n),"Group"==e.attributes.Type.value?(D=1,i=s=this.dvGroup,C=this.dvGroupColumns):(D=0,i=s=this.dvAcc,C=this.dvAccColumns),i=s.filter(r=>r.AccountID==n),i.length>0){if(h=0,null!=this.dvBills){this.dvBills=this.dvBillsTable.filter(r=>r.AccountID==n);for(let r=0;r<this.dvBills.length;r++)this.dvPaymentTerms=this.dvPaymentTermsTable.filter(p=>p.VoucherNo==this.dvBills[r].DocNo),this.dvPaymentTerms.length>0?(a=Math.abs(parseFloat(this.dvBills[r].Paid)),o=parseFloat(this.dvBills[r].Amount),this.dvPaymentTerms.forEach(p=>{this.dbl=parseFloat(p.Amount),u=d.J0.ParseDate(p.DueDate),this.dbl=this.dbl-a,this.dbl<0?a=-this.dbl:this.dbl>0?(a=0,o<0&&(this.dbl=-this.dbl),-1!=this.colMonthIndex?(l="Y"+u.getFullYear()+"M"+u.iMonth(),C.Contains(l)&&(this.dblValue=d.J0.Double(i[0][l]),i[0][l]=this.dblValue+this.dbl),h+=this.dbl):(this.dblValue=d.J0.Double(i[0].Balance),i[0].Balance=this.dblValue+this.dbl)):a=0})):(u=d.J0.ParseDate(this.dvBills[r].DocDate),this.dblValue=parseFloat(this.dvBills[r].Amount)+parseFloat(this.dvBills[r].Paid),-1!=this.colMonthIndex?(l="Y"+u.getFullYear()+"M"+u.iMonth(),C.Contains(l)&&(d.J0.Double(i[0][l]),i[0][l]=this.dbl+this.dblValue),h+=this.dblValue):(this.dbl=d.J0.Double(i[0].Balance),i[0].Balance=this.dbl+this.dblValue))}if(-1!=this.colMonthIndex){let r=0;for(l=d.J0.String(i[0].Mn),l.length>0&&(r=parseFloat(i[0].Balance),i[0][l]=i[0].Balance);i.length>1;)l=d.J0.String(i[1].Mn),l.length>0&&(r+=parseFloat(i[1].Balance),i[0][l]=i[1].Balance),s.Remove(i[1]),i.Remove(i[1]);i[0].Balance=r+h}if(-1!=this.YTDIndex){let r=this.dsYTD.Tables[D].filter(p=>p.AccountID==n);r.length>0&&(i[0].YTD=r[0].Balance)}if(-1!=this.BAL_LYIndex){let r=this.dsBAL_LY.Tables[D].filter(p=>p.AccountID==n);r.length>0&&(i[0].LastYearBalance=r[0].Balance)}if(-1!=this.YTD_LYIndex){let r=this.dsYTD_LY.Tables[D].filter(p=>p.AccountID==n);r.length>0&&(i[0].LastYearYTD=r[0].Balance)}for(let r=0;r<this.oColumns.length;r++)this.CellValue=null,C.Contains(this.oColumns[r].ID)&&(this.CellValue=i[this.k][this.oColumns[r].ID]),null!=this.CellValue&&(0==r&&(this.CellValue="    "+this.CellValue.toString()),this.ViewModel.SetCellValue(this.CellValue,this.oColumns[r].DataFormat,this.oColumns[r].ColumnType,this.row.Cells[r]),d.J0.IsNum(this.CellValue)&&(this.dbl=d.J0.Double(this.CellValue),this.ViewModel.totals[r][3]+=this.dbl))}this.ViewModel.ApplyKPI(this.row),this.ViewModel.addRow(this.row)}this.AddSectionHeadingTotal(3,this.ShowTotal),this.AddSectionHeadingTotal(2,!0)}AddSectionHeadingTotal(t,e){if(e){let a="";for(let o=0;o<t-1;o++)a+="  ";3==t?(this.row=this.NewReportRow_2(N.QS.ReportTotal,this.BalanceBFAppearance_Data),this.row.Parent=null==this.HeaderRow?this.SectionRow:this.HeaderRow,this.row.Cells[0].Text=a+"Total"):2==t?(this.row=this.NewReportRow_2(N.QS.ReportTotal,this.GrossTotalAppearance_Data),this.row.Parent=this.SectionRow,this.row.Cells[0].Text=a+"TOTAL"):(this.row=this.NewReportRow_2(N.QS.SubTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.row.Cells[0].Text=a+this.ViewModel.GrpReportTotal.SubTotalPrefix[0]),this.row.LevelNo=t-1,this.row.Cells[0].CellAppearance.Alignment="Left";for(let o=0;o<this.oColumns.length;o++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[o].ID)&&this.ViewModel.SetCellValue(this.ViewModel.totals[o][t],this.oColumns[o].DataFormat,"FLOAT",this.row.Cells[o]),this.ViewModel.totals[o][t-1]+=this.ViewModel.totals[o][t],this.ViewModel.totals[o][t]=0;this.ViewModel.addRow(this.row)}else for(let a=0;a<this.oColumns.length;a++)this.ViewModel.totals[a][t-1]+=this.ViewModel.totals[a][t],this.ViewModel.totals[a][t]=0}AddCFBalance(t,e,a,o){this.row=this.NewReportRow_2(N.QS.SubReportHeader,this.GrossTotalAppearance),this.row.IsGroup=!0,this.row.IsExpanded=!0,this.row.LevelNo=1,this.HeaderRow=this.row,this.row.Cells[0].Text=o,this.row.Cells[0].ColSpan=this.oColumns.length,this.ViewModel.addRow(this.row);let h=-1,n=-1;for(let l=0;l<this.oColumns.length;l++)"Particulars"==this.oColumns[l].ID?h=l:"Balance"==this.oColumns[l].ID&&(n=l);if(-1==this.colMonthIndex)for(this.k=0;this.k<t.length;this.k++)this.row=this.NewReportRow(),this.row.LevelNo=3,this.row.Parent=this.HeaderRow,-1!=h&&this.ViewModel.SetCellValue(t[this.k].Particulars,this.oColumns[h].DataFormat,this.oColumns[h].ColumnType,this.row.Cells[h]),-1!=n&&this.ViewModel.SetCellValue("Closing"==a?parseFloat(t[this.k].Opening)+parseFloat(t[this.k].Trans):t[this.k][a],this.oColumns[n].DataFormat,this.oColumns[n].ColumnType,this.row.Cells[n]),this.ViewModel.addRow(this.row);else{let l;if("Trans"==a)for(this.k=0;this.k<e.length;this.k++){let i=t.filter(s=>s.AccountID==e[this.k].AccountID);this.dbl=0,i.forEach(s=>{l=s.Mn.toString(),"Y0M0"!=l&&(e[this.k][s.Mn.toString()]=s.Trans,this.dbl+=parseFloat(s.Trans))}),e[this.k].Balance=this.dbl,this.row=this.NewReportRow(),this.row.LevelNo=3,this.row.Parent=this.HeaderRow,this.row.NodeID=parseInt(e[this.k].AccountID);for(let s=0;s<this.oColumns.length;s++)this.CellValue=null,d.J0.IsEmpty(e[this.k][this.oColumns[s].ID])||(this.CellValue=e[this.k][this.oColumns[s].ID]),null!=this.CellValue&&this.ViewModel.SetCellValue(this.CellValue,this.oColumns[s].DataFormat,this.oColumns[s].ColumnType,this.row.Cells[s]);this.ViewModel.addRow(this.row)}else if("Opening"==a)for(this.k=0;this.k<e.length;this.k++){let i=t.filter(s=>s.AccountID==e[this.k].AccountID&&"Y0M0"==s.Mn);this.dbl=0,i.length>0&&(this.dbl=parseFloat(i[0].Opening)),e[this.k][this.oColumns[this.colMonthIndex].ID]=this.dbl;for(let s=0;s<this.CntMonths-1;s++)this.dblValue=d.J0.Double(this.dtMonthTrans[this.k][this.oColumns[this.colMonthIndex+s].ID]),this.dbl+=this.dblValue,e[this.k][this.oColumns[this.colMonthIndex+s+1].ID]=this.dbl;e[this.k].Balance=this.dbl,this.row=this.NewReportRow(),this.row.LevelNo=3,this.row.Parent=this.HeaderRow,this.row.NodeID=parseInt(e[this.k].AccountID);for(let s=0;s<this.oColumns.length;s++)this.CellValue=null,d.J0.IsEmpty(e[this.k][this.oColumns[s].ID])||(this.CellValue=e[this.k][this.oColumns[s].ID]),null!=this.CellValue&&this.ViewModel.SetCellValue(this.CellValue,this.oColumns[s].DataFormat,this.oColumns[s].ColumnType,this.row.Cells[s]);this.ViewModel.addRow(this.row)}else if("Closing"==a)for(this.k=0;this.k<e.length;this.k++){this.dbl=0;for(let i=0;i<this.CntMonths;i++)this.dbl=d.J0.Double(this.dtMonthBF[this.k][this.oColumns[this.colMonthIndex+i].ID]),this.dblValue=d.J0.Double(this.dtMonthTrans[this.k][this.oColumns[this.colMonthIndex+i].ID]),this.dbl=this.dbl+this.dblValue,e[this.k][this.oColumns[this.colMonthIndex+i].ID]=this.dbl;e[this.k].Balance=this.dbl,this.row=this.NewReportRow(),this.row.LevelNo=3,this.row.Parent=this.HeaderRow,this.row.NodeID=parseInt(e[this.k].AccountID);for(let i=0;i<this.oColumns.length;i++)this.CellValue=null,d.J0.IsEmpty(e[this.k][this.oColumns[i].ID])||(this.CellValue=e[this.k][this.oColumns[i].ID]),null!=this.CellValue&&this.ViewModel.SetCellValue(this.CellValue,this.oColumns[i].DataFormat,this.oColumns[i].ColumnType,this.row.Cells[i]);this.ViewModel.addRow(this.row)}}}SetRationVariables(t,e){let a=new m.bT;return t.forEach(o=>{if(d.VB.SelectSingleNode(o,"Nodes").innerHTML.length>0){let n=this.GetVariableValue(o,e).then(l=>{let i=0,s=new F.Nl;s.setFieldDetails(o.attributes.Name.value,2,1,"",1,!1,!1),a.push(o.attributes.Name.value,s),null!=l&&l.length>0&&(i=parseFloat(l[0].Balance)),s.setFieldValue(i)});this.RatioComplete1Promise.push(n)}else{let n=new F.Nl;n.setFieldDetails(o.attributes.Name.value,2,1,"",1,!1,!1),a.push(o.attributes.Name.value,n),n.setFieldValue(0)}}),a}GetVariableValue(t,e=""){let a="",o=t.attributes.Name.value.toLowerCase(),h="";if(this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(h=d.J0.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1 ":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+") "),h+=this.GetDimensionFilter("DCC.dcCCNID"),"openingstock"==o||"closingstock"==o){if("OpeningStock"==t.attributes.Name.value)return w.d.report.GetStockBalance(1,h,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,0,0,this.ViewModel.IsReportDB).then(S=>{let B=S,y=[];return y.push({}),y[0].Balance=B,y});if("ClosingStock"==t.attributes.Name.value)return w.d.report.GetStockBalance(0,h,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,0,0,this.ViewModel.IsReportDB).then(S=>{let B=S,y=[];return y.push({}),y[0].Balance=B,y})}else"grossprofit"==o?a="4,5,8,9":"netprofit"==o&&(a="4,5,8,9,11,12");let n="",l=d.VB.SelectSingleNode(t,"Nodes");if(0==l.innerHTML.length&&0==a.length)return null;let r,p,i=l.innerHTML,s=null!=d.VB.SelectSingleNode(t,"GroupNodesExists"),C=null!=d.VB.SelectSingleNode(t,"CurrentYear")?parseInt(d.VB.SelectSingleNode(t,"CurrentYear").innerHTML):0,u="",D="",c="";this.ForeignCurrencyID>0?(r="AmountFC",p=" AND ACC.CurrencyID="+this.ForeignCurrencyID):(r=1==this.CurrencyType?"AmountBC":"Amount",p=""),this.GetDimensionFilter("DCC.dcCCNID"),h.length>0&&(u=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID",D=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID");let A="";0==this.UnPostedDocsList.length?A=" AND (ACC.StatusID=369 or ACC.StatusID=429)":A+=" AND ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")",c=this.PDCInclude?" AND ((ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+") OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+A+"))":" AND ACC.DocumentType NOT IN (14,19)"+A;let f="";f=C>0||this.ShowYearWise||e.length>0||a.length>0?"(DocDate BETWEEN @From AND @To)":"(DocDate<=@To)",f+=h;let E="",Y="",O="";a.length>0?(E="-",Y=" join ACC_Accounts AT on AT.AccountID=T1.AccountID",O="AT.AccountTypeID IN ("+a+")"):s?(O="T1.AccountID=GTP.GTID",Y=i.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+i+") group by T.AccountID) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+i+" group by T.AccountID) AS GTP "):O=i.Contains(",")?"T1.AccountID IN ("+i+")":"T1.AccountID="+i;let L="",V="",I=new Date(this.ViewModel.oReportDialog.ToDate.Date.getFullYear(),w.d.SessionManager.AccountingFromMonth-1,1);I>this.ViewModel.oReportDialog.ToDate.Date&&(I=I.AddYears(-1));let g=this.AllowFromDateFilter?this.ViewModel.oReportDialog.FromDate.Date:I,b=this.ViewModel.oReportDialog.ToDate.Date;if("YTD"==e)g=I,b=this.ViewModel.oReportDialog.ToDate.Date;else if("LastYearYTD"==e)g=I.AddYears(-1),b=this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1);else if("LastYearPeriodValue"==e)g=this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1),b=this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1);else if("LastYearValue"==e)g=I.AddYears(-1),b=g.AddYears(1).AddDays(-1);else if(this.Show==T.MonthWise)g=this.ViewModel.oReportDialog.FromDate.Date,L=",'Y'+CONVERT(NVARCHAR,YEAR(convert(datetime,ACC.DocDate)))+'M'+ CONVERT(NVARCHAR,Month(convert(datetime,ACC.DocDate))) Tag",V=",Tag";else if(this.Show==T.QtrWise||this.Show==T.HalfYearWise)g=this.ViewModel.oReportDialog.FromDate.Date,L=",CONVERT(NVARCHAR,YEAR(convert(datetime,ACC.DocDate)))+'-'+ CONVERT(NVARCHAR,Month(convert(datetime,ACC.DocDate))) YrMn",V=",YrMn";else if(this.Show==T.YearWise)g=this.ViewModel.oReportDialog.FromDate.Date,L=",'Y'+CONVERT(NVARCHAR,Year(convert(datetime,ACC.DocDate))) Tag",V=",Tag";else if(this.ShowYearWise){let S=1;for(;S<this.CntMonths;)I=I.AddYears(-1),S++;g=I,L=",Year(convert(datetime,ACC.DocDate)) Tag",V=",Tag"}return n+="DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+g.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+b.ToString("dd MMM yyyy")+"'))\n\nSELECT "+E+"SUM(Balance) Balance"+V+" FROM (\nSELECT T1.AccountID,ISNULL(SUM(DR),0)-IsNULL(SUM(CR),0) Balance"+V+" FROM (",n+="\n--Opening Dr\nSELECT DebitAccount AccountID,ACC."+r+" DR,0 CR"+L+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+u+"\nWHERE "+f+c+p+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,0 DR,ACC."+r+" CR"+L+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+u+"\nWHERE "+f+c+p,D.length>0&&(n+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT DebitAccount AccountID,ACC."+r+" DR,0 CR"+L+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+D+"\nWHERE "+f+c+p+"\nUNION ALL--Opening Cr\nSELECT CreditAccount AccountID,0 DR,ACC."+r+" CR"+L+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+D+"\nWHERE "+f+c+p),n+=") AS T1"+Y,n+=" WHERE "+O,n+=" GROUP BY T1.AccountID"+V,n+=") AS T2",V.length>0&&(n+=" GROUP BY "+V.TrimStart(",")),w.d.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,n).then(S=>(this.ds=S,null!=this.ds&&this.ds.Tables[0].length>0&&null!=this.ds.Tables[0][0].Balance?this.ds.Tables[0]:null))}}}}]);