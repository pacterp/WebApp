"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[7488],{35107:(_,y,l)=>{l.r(y),l.d(y,{PaymentTermViewModel:()=>T});var m=l(32040),a=l(43767),P=l(54581),p=l(98580),b=l(84151),t=l(27730),D=l(7321),r=l(21774),u=l(23603);class T extends p.g{constructor(){super(),this.ds=null,this.obj=new u.Document,this.Name=new b.Dw(0),this.Profile=new t.y$(0),this.Dimensions=new t.y$(0),this.Name.Enable=!1,this.DisplayName=m.d.GetResource("Payment_Terms"),this.ProfileFill(),this.AddGridColumns(),this.FillingRows(),this.PaymentGrid.SearchVisible=!1,this.Name.Label="Name",this.Profile.Label="Profile",this.Dimensions.Label="Dimension",this.Profile.SelectionChangedCommand.Subscribe(this,"OnProfileSelection")}OnBeginEdit(e){"DataGridPactListBoxColumn"==e.args.column.className&&!a.J0.IsEmpty(this.Dimensions.SelectedValue)&&"0"!=this.Dimensions.SelectedValue&&(e.args.Column.CostCenterID=parseInt(this.Dimensions.SelectedValue))}OnCellEditEnding(e){let s=e.item;"PactTextBoxEditor"==e.column.className&&"Percent"==e.column.field&&(""!=a.J0.String(s.Percent).Trim()?(""==a.J0.String(s.Period)&&(s.Period="1"),""==a.J0.String(s.TypeID)&&(s.TypeID="0"),""==a.J0.String(s.BasedOn)&&(s.BasedOn="1"),""==a.J0.String(s.PostonDate)&&(s.PostonDate="0")):(""!=a.J0.String(s.Period)&&(s.Period=null),""!=a.J0.String(s.TypeID)&&(s.TypeID=null),""!=a.J0.String(s.BasedOn)&&(s.BasedOn=null),""!=a.J0.String(s.PostonDate)&&(s.PostonDate=null)),this.PaymentGrid.updateRow(s),this.PaymentGrid.UpdateTotals())}ProfileFill(){this.Profile.Items.Clear(),this.ds=this.obj.GetAndDeleteTerms(0,1),null!=this.ds&&this.ds.Tables.length>0&&this.ds.Tables[0].length>0?(this.Profile.Items.push(t._p.ComboBoxItems_2("New","-1")),this.ds.Tables[0].forEach(e=>{0==this.Profile.Items.filter(s=>s.Value==e.ProfileID.toString()).length&&this.Profile.Items.push(t._p.ComboBoxItems_2(e.ProfileName.toString(),e.ProfileID.toString()))})):(this.Profile.Items.push(t._p.ComboBoxItems_2("New","-1")),this.Dimensions.Visible=!1),null!=this.ds&&this.ds.Tables.length>1&&!a.J0.IsEmpty(m.d.SessionManager.Preferences.EnableDimPayterm)&&(0,P.yG0)(m.d.SessionManager.Preferences.EnableDimPayterm)?(this.Dimensions.Label="Dimensions",this.Dimensions.Items.push(t._p.ComboBoxItems_2("","0")),this.ds.Tables[1].forEach(e=>{this.Dimensions.Items.push(t._p.ComboBoxItems_2(e.Name.toString(),e.FeatureID.toString()))}),m.d.SessionManager.Preferences.ContainsKey("PaytermLinkDim")&&""!=m.d.SessionManager.Preferences.PaytermLinkDim&&(this.Dimensions.SelectedValue=m.d.SessionManager.Preferences.PaytermLinkDim,this.Dimensions.Enable=!1),this.Dimensions.Visible=!0):this.Dimensions.Visible=!1}FillingRows(){if(0==this.PaymentGrid.Table.length)for(let e=this.PaymentGrid.Table.length;e<10;e++){let s=this.PaymentGrid.NewRow();s.Sno=e+1,this.PaymentGrid.addRow(s)}}AddGridColumns(){this.PaymentGrid=new D.vv,this.PaymentGrid.Columns=[],this.PaymentGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.PaymentGrid.BeginEdit.Subscribe(this,"OnBeginEdit"),this.PaymentGrid.Table=[],this.PaymentGrid.CanUserAddRows=!0,this.PaymentGrid.CanUserDeleteRows=!0,this.PaymentGrid.Height=window.innerHeight-100,this.PaymentGrid.Width=(window.innerWidth-90).toString(),this.PaymentGrid.TableColumns.push("Sno"),this.PaymentGrid.TableColumns.push("Percent"),this.PaymentGrid.TableColumns.push("Days"),this.PaymentGrid.TableColumns.push("Period"),this.PaymentGrid.TableColumns.push("TypeID"),this.PaymentGrid.TableColumns.push("BasedOn"),this.PaymentGrid.TableColumns.push("Occurences"),this.PaymentGrid.TableColumns.push("PostonDate"),this.PaymentGrid.TableColumns.push("Remarks"),this.PaymentGrid.TableColumns.push("Remarks1");let e=new r.O7;e.Header=m.d.GetResource("Sno"),e.DisplayMember="Sno",e.ReadOnly=!0,e.Width=50,e.DataType="FLOAT",this.PaymentGrid.Columns.push(e),e=new r.O7,e.Header=m.d.GetResource("Percentage"),e.DisplayMember="Percent",e.ReadOnly=!1,e.Width=135,e.ShowTotal=!0,e.IsCalculated=1,e.DecimalPoints="",e.DataType="FLOAT",this.PaymentGrid.Columns.push(e),e=new r.O7,e.Header="Number",e.DisplayMember="Days",e.ReadOnly=!1,e.Width=100,e.DataType="INT",this.PaymentGrid.Columns.push(e),e=new r.O7,e.Header="Period",e.ValueBinding="Period",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100;let s=new Array;s.push(t._p.ComboBoxItems_2("Month(s)","2")),s.push(t._p.ComboBoxItems_2("Day(s)","1")),e.ComboData=s,this.PaymentGrid.Columns.push(e),e=new r.O7,e.Header="Type",e.ValueBinding="TypeID",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100,s=new Array,s.push(t._p.ComboBoxItems_2("None","0")),s.push(t._p.ComboBoxItems_2("Repeat","1")),s.push(t._p.ComboBoxItems_2("Divide","2")),e.ComboData=s,this.PaymentGrid.Columns.push(e),e=new r.O7,e.Header="Based On",e.ValueBinding="BasedOn",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100,s=new Array,s.push(t._p.ComboBoxItems_2("Voucher Date","1")),s.push(t._p.ComboBoxItems_2("Preference Date","2")),e.ComboData=s,this.PaymentGrid.Columns.push(e),e=new r.O7,e.Header="Occurences",e.DisplayMember="Occurences",e.Width=100,e.DataType="INT",this.PaymentGrid.Columns.push(e),e=new r.O7,e.Header="Remarks",e.DisplayMember="Remarks",e.Width=100,this.PaymentGrid.Columns.push(e),e=new r.O7,e.Header="Remarks1",e.DisplayMember="Remarks1",e.Width=100,this.PaymentGrid.Columns.push(e),e=new r.O7,e.Header="Post on Date",e.ValueBinding="PostonDate",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100,s=new Array,s.push(t._p.ComboBoxItems_2("Same","0")),s.push(t._p.ComboBoxItems_2("1","1")),s.push(t._p.ComboBoxItems_2("2","2")),s.push(t._p.ComboBoxItems_2("3","3")),s.push(t._p.ComboBoxItems_2("4","4")),s.push(t._p.ComboBoxItems_2("5","5")),s.push(t._p.ComboBoxItems_2("6","6")),s.push(t._p.ComboBoxItems_2("7","7")),s.push(t._p.ComboBoxItems_2("8","8")),s.push(t._p.ComboBoxItems_2("9","9")),s.push(t._p.ComboBoxItems_2("10","10")),s.push(t._p.ComboBoxItems_2("11","11")),s.push(t._p.ComboBoxItems_2("12","12")),s.push(t._p.ComboBoxItems_2("13","13")),s.push(t._p.ComboBoxItems_2("14","14")),s.push(t._p.ComboBoxItems_2("15","15")),s.push(t._p.ComboBoxItems_2("16","16")),s.push(t._p.ComboBoxItems_2("17","17")),s.push(t._p.ComboBoxItems_2("18","18")),s.push(t._p.ComboBoxItems_2("19","19")),s.push(t._p.ComboBoxItems_2("20","20")),s.push(t._p.ComboBoxItems_2("21","21")),s.push(t._p.ComboBoxItems_2("22","22")),s.push(t._p.ComboBoxItems_2("23","23")),s.push(t._p.ComboBoxItems_2("24","24")),s.push(t._p.ComboBoxItems_2("25","25")),s.push(t._p.ComboBoxItems_2("26","26")),s.push(t._p.ComboBoxItems_2("27","27")),s.push(t._p.ComboBoxItems_2("28","28")),s.push(t._p.ComboBoxItems_2("29","29")),s.push(t._p.ComboBoxItems_2("30","30")),s.push(t._p.ComboBoxItems_2("LastDayofMonth","31")),e.ComboData=s,this.PaymentGrid.Columns.push(e),this.Dimensions.Visible&&(e=new r.O7,e.Header="Dimension",e.DisplayMember="Dim",e.DataType="LISTBOX",e.Width=150,e.TypeID=1,this.PaymentGrid.Columns.push(e),this.PaymentGrid.TableColumns.push("Dim_Key"),this.PaymentGrid.TableColumns.push("Dim"))}OnButtonClick(e){if("Save"==e){if(null==this.Name.Text||""==this.Name.Text)return this.DisplayMessage="Enter Profile Name",void(this.MessageVisibility=!0);if(m.d.SessionManager.Preferences.ContainsKey("Validate100PerPayTerm")&&!a.J0.IsEmpty(m.d.SessionManager.Preferences.Validate100PerPayTerm)&&(0,P.yG0)(m.d.SessionManager.Preferences.Validate100PerPayTerm)){var n=this.PaymentGrid.Columns.find(i=>null!=i.DisplayMember&&"Percent"==i.DisplayMember);if(null!=n){let i=0;if(a.J0.IsEmpty(n.footer.toString())||(i=parseFloat(n.footer.toString())),i<100)return this.DisplayMessage="Percentage should be equal to 100%",void(this.MessageVisibility=!0)}}this.PaymentGrid.angularGrid?.slickGrid&&this.PaymentGrid.angularGrid?.slickGrid.getActiveCellNode()&&this.PaymentGrid.angularGrid.slickGrid.getEditorLock().commitCurrentEdit();let o="",h=0;for(let i=0;i<this.PaymentGrid.Table.length;i++)!a.J0.IsEmpty(this.PaymentGrid.Table[i].Percent)&&!a.J0.IsEmpty(this.PaymentGrid.Table[i].Days)&&(o+="<Row ",a.J0.IsEmpty(this.PaymentGrid.Table[i].TypeID)||"1"!=this.PaymentGrid.Table[i].TypeID.toString()||a.J0.IsEmpty(this.PaymentGrid.Table[i].Occurences)?h+=parseFloat(this.PaymentGrid.Table[i].Percent.toString()):h+=parseFloat(this.PaymentGrid.Table[i].Percent.toString())*parseFloat(this.PaymentGrid.Table[i].Occurences.toString()),o+='percentage="'+this.PaymentGrid.Table[i].Percent.toString()+'" ',a.J0.IsEmpty(this.PaymentGrid.Table[i].Days)||(o+='Days="'+this.PaymentGrid.Table[i].Days.toString()+'" '),a.J0.IsEmpty(this.PaymentGrid.Table[i].Period)||(o+='Period="'+this.PaymentGrid.Table[i].Period.toString()+'" '),a.J0.IsEmpty(this.PaymentGrid.Table[i].TypeID)||(o+='TypeID="'+this.PaymentGrid.Table[i].TypeID.toString()+'" '),a.J0.IsEmpty(this.PaymentGrid.Table[i].BasedOn)||(o+='BasedOn="'+this.PaymentGrid.Table[i].BasedOn.toString()+'" '),a.J0.IsEmpty(this.PaymentGrid.Table[i].Occurences)||(o+='Occurences="'+this.PaymentGrid.Table[i].Occurences.toString()+'" '),a.J0.IsEmpty(this.PaymentGrid.Table[i].PostonDate)||(o+='DateNo="'+this.PaymentGrid.Table[i].PostonDate.toString()+'" '),a.J0.IsEmpty(this.PaymentGrid.Table[i].Remarks)||(o+='Remarks="'+this.PaymentGrid.Table[i].Remarks.toString()+'" '),a.J0.IsEmpty(this.PaymentGrid.Table[i].Remarks1)||(o+='Remarks1="'+this.PaymentGrid.Table[i].Remarks1.toString()+'" '),this.Dimensions.Visible&&!a.J0.IsEmpty(this.PaymentGrid.Table[i].Dim_Key)&&(o+='Dim="'+this.PaymentGrid.Table[i].Dim_Key.toString()+'" '),o+='Discount="" ',o+="/>");if(h>100)return this.DisplayMessage="Percentage can not be greater than 100.",void(this.MessageVisibility=!0);let d=0;u.Document.SetPaymentDiscountTerm(this.Name.Text,this.Profile.SelectedValue,this.Dimensions.SelectedValue,o.toString()).subscribe(i=>{this.DisplayMessage=i.Message,d=i.RetValue,d>0?(this.Name.Text="",this.PaymentGrid.Clear(),this.FillingRows(),this.ProfileFill()):this.MessageVisibility=!0},i=>{console.log(i),this.DisplayMessage="Error in save"})}else"-1"==this.Profile.SelectedValue?this.DisplayMessage="Cannot Delete New":(this.ds=this.obj.GetAndDeleteTerms(parseInt(this.Profile.SelectedValue),3),null!=this.ds&&this.ds.Tables.length>0&&this.ds.Tables[0].length>0&&(this.DisplayMessage=this.ds.Tables[0][0].ErrorMessage.toString(),"Deleted Successfully"==this.DisplayMessage&&(this.Name.Text="",this.PaymentGrid.Clear(),this.FillingRows(),this.ProfileFill()))),this.MessageVisibility=!0}OnProfileSelection(e){if("-1"==this.Profile.SelectedValue)this.Name.Enable=!0,this.Name.Text="",this.PaymentGrid.Clear(),this.FillingRows();else if(null!=this.Profile.SelectedValue){this.Name.Enable=!1,this.ds=this.obj.GetAndDeleteTerms(parseInt(this.Profile.SelectedValue),0),this.Name.Text=this.Profile.GetText(),this.PaymentGrid.Clear();let s="";if(null!=this.ds&&this.ds.Tables.length>0){for(let n=0;n<this.ds.Tables[0].length;n++){let o=this.PaymentGrid.NewRow();o.Sno=n+1,o.Percent=this.ds.Tables[0][n].percentage,o.Days=this.ds.Tables[0][n].Days,a.J0.IsEmpty(this.ds.Tables[0][n].Period)||(o.Period=this.ds.Tables[0][n].Period),a.J0.IsEmpty(this.ds.Tables[0][n].TypeID)||(o.TypeID=this.ds.Tables[0][n].TypeID),a.J0.IsEmpty(this.ds.Tables[0][n].BasedOn)||(o.BasedOn=this.ds.Tables[0][n].BasedOn),a.J0.IsEmpty(this.ds.Tables[0][n].Occurences)||(o.Occurences=this.ds.Tables[0][n].Occurences),a.J0.IsEmpty(this.ds.Tables[0][n].DateNo)||(o.PostonDate=this.ds.Tables[0][n].DateNo),this.ds.Columns[0].Contains("Remarks")&&!a.J0.IsEmpty(this.ds.Tables[0][n].Remarks)&&(o.Remarks=this.ds.Tables[0][n].Remarks),this.ds.Columns[0].Contains("Remarks1")&&!a.J0.IsEmpty(this.ds.Tables[0][n].Remarks1)&&(o.Remarks1=this.ds.Tables[0][n].Remarks1),this.PaymentGrid.TableColumns.Contains("Dim_Key")&&!a.J0.IsEmpty(this.ds.Tables[0][n].DimNodeID)&&(o.Dim_Key=this.ds.Tables[0][n].DimNodeID,""!=s&&(s+=","),s+=this.ds.Tables[0][n].DimNodeID.toString()),this.PaymentGrid.addRow(o)}if(this.ds.Tables[0].length>0&&this.Dimensions.Visible&&!a.J0.IsEmpty(this.ds.Tables[0][0].DimCCID)&&"0"!=this.ds.Tables[0][0].dimccid.toString()){this.Dimensions.SelectedValue=this.ds.Tables[0][0].DimCCID.toString();let n=this.obj.GetdimensionNames(this.Dimensions.SelectedValue,s);n.Tables.length>0&&!n.Columns[0].Contains("ErrorMessage")&&this.PaymentGrid.Table.forEach(o=>{if(!a.J0.IsEmpty(o.Dim_Key.toString())){let h=n.Tables[0].filter(d=>d.NodeID==o.Dim_Key.toString());h.length>0&&(o.Dim=h[0][Object.keys(h[0])[1]].toString())}})}for(let n=this.ds.Tables[0].length;n<this.ds.Tables[0].length+10;n++){let o=this.PaymentGrid.NewRow();o.Sno=n+1,this.PaymentGrid.addRow(o)}}this.PaymentGrid.UpdateTotals()}}}}}]);