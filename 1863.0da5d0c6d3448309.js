"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[1863],{94244:(we,Y,f)=>{f.r(Y),f.d(Y,{DBPanel:()=>Z,DBReportFilterViewModel:()=>_,DBViewViewModel:()=>Re});var W=f(74523),D=f(9659),c=f(66148),V=f(76199),q=f(11403),ee=f(94628),te=f(96705),ie=f(43024),se=f(17464),v=f(35789),F=f(5349),M=f(16645),E=f(76962),N=f(76428),G=f(3055),le=f(88852),x=f(3955),P=f(12112),re=f(43715),Q=f(53879),ae=f(19763),oe=f(45678),k=f(98060);class ne{constructor(){this.IsGroupsExists=!1}}class O extends V.g{get WidgetVisibility(){return this._WidgetVisibility}set WidgetVisibility(i){this._WidgetVisibility!=i&&(this.CalendarVisibility=!1,this._WidgetVisibility=i)}get CalendarVisibility(){return this._CalendarVisibility}set CalendarVisibility(i){this._CalendarVisibility!=i&&(this.WidgetVisibility=!1,this._CalendarVisibility=i)}constructor(){super(),this.Chart=null,this.LoadingVisibility=!0,this._WidgetVisibility=!0,this._CalendarVisibility=!1,this.ForeColor="#FFFFFF",this.SubFieldsBgColor="#008000",this.SubFieldsBgColorArr=["#017EFF","#FF9700","#3498FB","#0093A4","#9972B5","#FF4040","#2BADCE","#E69500"],this.WidgetID=0,this.TypeID=0,this.Decimals=2,this.strAccounts="",this.Groups="",this.PrevData=0,this.IncludeOpening=!1,this.IncludeRevised=!1,this.IsGroupsExists=!1,this.IncludePDC=!1,this.ShowPositive=!1,this.IsAccDoc=!1,this.IsExecutedDocs=!1,this.IsGeneralDocs=!1,this.IsBWDocs=!1,this.IsDurationDifference=!1,this.IsDifferenceView=!1,this.IsFieldsDifference=!1,this.CurrencyType=0,this.ForeignCurrencyID=0,this.Slabs=new Array,this.dicExecutedQuery=new x.bT,this.dicUserWiseDims=new x.bT,this.dicFilters=new x.G9,this.dicLookupFilters=new x.G9,this.HeaderValuePostfix="",this.IsLink=!1,this.CallStatusID="",this.eval=new P.CC,this.fldDict=new x.bT,this.ClassName="WidgetViewModel"}WidgetViewModel_1(i,t,e){if(this.WidgetID=t,this.Header=new w,this.SubFields=[],this.SubFieldsText=[],this.SubFieldsBgColor=this.SubFieldsBgColorArr[Math.abs(t)%8],0==e.length)return;let s=new c.VB;s.LoadXml(e),this.DBWidgetFilter=c.VB.SelectSingleNode(s.DocumentElement,"TreeFilters"),this.InitWidget(),this.ForeColor=i.HeaderForeColor,this.BackgroundColor=i.BodyBackColor,e.split("!")[0].split(","),this.IsDurationDifference=null!=s.DocumentElement.attributes.IsDurationDifference&&"1"==s.DocumentElement.attributes.IsDurationDifference.value,this.IsFieldsDifference=null!=s.DocumentElement.attributes.IsFieldsDifference&&"1"==s.DocumentElement.attributes.IsFieldsDifference.value,this.IsFieldsDifference&&(this.IsDurationDifference=!0),this.IsDurationDifference&&(this.Header.ShowArrow=!0),(this.IsDurationDifference||this.IsFieldsDifference||104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID)&&(this.IsDifferenceView=!0),this.Header.LabelType=s.DocumentElement.attributes.HF.value;let d=c.VB.SelectSingleNode(s.DocumentElement,"HFForm");if(null!=d&&(this.Header.Formula=d.innerHTML),this.Header.Label=i.Header,this.Header.ForeColor=this.ForeColor,d=c.VB.SelectSingleNode(s.DocumentElement,"HFImage"),null!=d&&!c.J0.IsEmpty(d.innerHTML)&&(this.Header.ImagePath=c.J0.GetPath(d.innerHTML)),this.Header.txtLbl=new B,this.IsDurationDifference&&!this.IsFieldsDifference){this.DurationLinks=[],this.Header.LabelType="";let o=c.VB.SelectNodes(s.DocumentElement,"DF");for(let r=0;r<o.length;r++){let u=new B;u.Row=o[r].attributes.Duration.value,u.Text=o[r].attributes.Caption.value,this.DurationLinks.push(u)}let h=["CurMon","PrevMn"];this.DurationLinks.length>0&&(h=this.SetDurationFilter(this.DurationLinks[0],!1));for(let r=0;r<h.length;r++){let u=new w;u.LabelType=h[r],u.Label=0==r?"Current":"Previous",u.Row=r.ToString(),u.ForeColor=this.ForeColor,u.SetSubFields(),this.SubFields.push(u),this.SubFieldsText.push(u.txtLbl),this.SubFieldsText.push(u.txtValue),this.SubFieldsText.push(u.txtSep),this.SubFieldsText.push(u.txtPercent)}}else 11==this.TypeID||12==this.TypeID||13==this.TypeID||14==this.TypeID||15==this.TypeID||18==this.TypeID||19==this.TypeID||20==this.TypeID||102==this.TypeID?(c.J0.IsEmpty(this.Header.LabelType)&&(this.Header.LabelType="YrToDate"),(11==this.TypeID||12==this.TypeID||13==this.TypeID||18==this.TypeID||19==this.TypeID||20==this.TypeID)&&(this.Header.Visible=!1)):(26==this.TypeID||27==this.TypeID)&&(this.CalendarVisibility=!0,this.WidgetCalendar=new he(this));if(11!=this.TypeID){let o=c.VB.SelectNodes(s.DocumentElement,"SF");for(let h=0;h<o.length;h++){let r=new w;r.LabelType=o[h].attributes.Field.value,r.Label=o[h].attributes.Caption.value,null!=o[h].attributes.Perc&&"1"==o[h].attributes.Perc.value&&(r.ShowPercentage=!0),d=c.VB.SelectSingleNode(o[h],"Form"),null!=d&&(r.Formula=d.innerHTML),r.Row=h.toString(),r.ForeColor=this.ForeColor,r.SetSubFields(),16==this.TypeID?r.StatusID=s.DocumentElement.attributes.StatusFilter.value:17==this.TypeID&&(r.StatusID=r.LabelType,r.LabelType=s.DocumentElement.attributes.StatusFilter.value),103==this.TypeID&&(r.txtPercent.Visible=!1),this.SubFields.push(r),this.SubFieldsText.push(r.txtLbl),this.SubFieldsText.push(r.txtSep),this.SubFieldsText.push(r.txtValue),this.SubFieldsText.push(r.txtPercent)}17==this.TypeID?(this.Header.StatusID=this.Header.LabelType,this.Header.LabelType=s.DocumentElement.attributes.StatusFilter.value):16==this.TypeID&&(this.Header.StatusID=s.DocumentElement.attributes.StatusFilter.value)}(16==this.TypeID||17==this.TypeID)&&(this.IsGeneralDocs=!0,("21"==this.Header.StatusID||"22"==this.Header.StatusID||"23"==this.Header.StatusID||this.SubFields.find(o=>"21"==o.StatusID||"22"==o.StatusID||"23"==o.StatusID))&&(this.SubFields.find(o=>"21"!=o.StatusID&&"22"!=o.StatusID&&"23"!=o.StatusID&&"0"!=o.StatusID)||(this.IsGeneralDocs=!1),this.IsExecutedDocs=!0),("31"==this.Header.StatusID||"32"==this.Header.StatusID||"33"==this.Header.StatusID||null!=this.SubFields.find(o=>"31"==o.StatusID||"32"==o.StatusID||"33"==o.StatusID))&&(null==this.SubFields.find(o=>"21"!=o.StatusID&&"22"!=o.StatusID&&"23"!=o.StatusID&&"0"!=o.StatusID)&&(this.IsGeneralDocs=!1),this.IsBWDocs=!0)),this.fldDict.push("value",new P.Nl("value",0)),this.fldDict.push("Value",new P.Nl("Value",0)),this.fldDict.push("VALUE",new P.Nl("VALUE",0)),this.eval.ThrowException=!1,this.eval.SetKeyWords("REPORT")}WidgetViewModel_2(i,t,e){this.Chart=i,this.WidgetID=t,this.DBWidgetFilter=e,this.Header=new w,this.InitWidget(),17==this.TypeID&&(this.Header.StatusID=this.Header.LabelType),this.Header.LabelType="CHART",this.Header.Label="",(14==this.TypeID||15==this.TypeID||19==this.TypeID||20==this.TypeID||102==this.TypeID)&&(i.ToDate.Date=new Date)}InitWidget(){let t,l,e=new c.VB,s=D.d.report.Widgets(1,this.WidgetID,"",0,1,!1,null,null);if(this.TypeID=parseInt(s.Tables[0][0].WType),this.TypeID>=21&&this.TypeID<=100&&(this.Decimals=0),(16==this.TypeID||17==this.TypeID)&&(this.IsLink=!0),null!=this.DBWidgetFilter?this.LoadTreeFilters(this.DBWidgetFilter):(l=c.J0.String(s.Tables[0][0].AccountsXML),l.length>0&&(e.LoadXml(l),this.LoadTreeFilters(e.DocumentElement))),l=c.J0.String(s.Tables[0][0].OptionsXML),l.length>0){if(e.LoadXml(l),t=c.VB.SelectSingleNode(e.DocumentElement,"Opening"),null!=t&&"1"==t.innerHTML&&(this.IncludeOpening=!0),t=c.VB.SelectSingleNode(e.DocumentElement,"Revised"),null!=t&&"1"==t.innerHTML&&(this.IncludeRevised=!0),t=c.VB.SelectSingleNode(e.DocumentElement,"PDC"),null!=t&&"1"==t.innerHTML&&(this.IncludePDC=!0),t=c.VB.SelectSingleNode(e.DocumentElement,"ShowPositive"),null!=t&&"1"==t.innerHTML&&(this.ShowPositive=!0),t=c.VB.SelectSingleNode(e.DocumentElement,"IsAccDoc"),null!=t&&"1"==t.innerHTML&&(this.IsAccDoc=!0),t=c.VB.SelectSingleNode(e.DocumentElement,"UserWiseDims"),null!=t&&t.innerHTML.length>0){let a=t.innerHTML.split(",");for(let d=0;d<a.length;d++){let h,r=D.d.report.IsGroupNode(parseInt(a[d]),0),u=D.d.report.GetDataTable("RPT041",r.TableName,D.d.SessionManager.UserID,a[d]);h="",u.forEach(T=>{h.length>0&&(h+=","),h+=c.J0.String(T.NodeID)}),0==h.length&&(h="-12345"),this.dicUserWiseDims.push(a[d],h)}}t=c.VB.SelectSingleNode(e.DocumentElement,"CurrencyType"),null!=t&&(this.CurrencyType=parseInt(t.innerHTML),1==this.CurrencyType?(c.J0.IsEmpty(D.d.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(D.d.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(t=c.VB.SelectSingleNode(e.DocumentElement,"FCCurrency"),this.ForeignCurrencyID=parseInt(t.innerHTML)))}return(14==this.TypeID||15==this.TypeID||102==this.TypeID)&&(l=s.Tables[1][0].DefaultPreferences.toString(),e.LoadXml(l),t=c.VB.SelectSingleNode(e.DocumentElement,"Slabs"),t.childNodes.forEach(a=>{parseInt(a.innerHTML)>0&&this.Slabs.push(parseInt(a.innerHTML))})),s}LoadTreeFilters(i){let t,s,e=!1,l=O.DefaultTreeCCID(this.TypeID.toString());for(let a=0;a<i.children.length;a++){let d=i.children[a];if(t="",e=!1,s=c.VB.SelectSingleNode(d,"Groups"),null!=s&&(e=!0,t=s.innerHTML),s=c.VB.SelectSingleNode(d,"Nodes"),null!=s&&(t.length>0&&(t+=","),t+=s.innerHTML),d.attributes.CC.value==l.toString())this.strAccounts=t,this.IsGroupsExists=e;else{let o=new ne;o.Nodes=t,o.IsGroupsExists=e,"44"==d.attributes.CC.value?this.dicLookupFilters.push(parseInt(d.attributes.LookupTypeID.value),o):this.dicFilters.push(parseInt(d.attributes.CC.value),o)}}}SetDurationFilter(i,t=!0){this.DurationLinks.map(s=>s.IsLink=!1),i.IsLink=!0;let e=["CurMon","PrevMn"];return"Year"==i.Row?(e[0]="YrToDate",e[1]="LastYr"):"Quarter"==i.Row?(e[0]="QtrToDate",e[1]="PrevQtr"):"Week"==i.Row?(e[0]="WeekToDate",e[1]="PrevWeek"):"Day"==i.Row&&(e[0]="Today",e[1]="Yesterday"),t?(this.SubFields[0].LabelType=e[0],this.SubFields[1].LabelType=e[1],this.Refresh(),e):e}SetValue(i,t=0){if(c.J0.IsEmpty(i.LabelType))return null;let e=null;if(19==this.TypeID||20==this.TypeID)e=this.SetQueryBatchExpiryAgeing(i);else if(this.TypeID>=21&&this.TypeID<=100)e=this.SetQueryHRM(i);else{let s=null;if(s=14==this.TypeID||15==this.TypeID||102==this.TypeID||104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID?this.SetQueryAgeing(i):16==this.TypeID||17==this.TypeID?this.SetQueryDocumentStatus(i):103==this.TypeID?this.SetQueryDocumentLastInfo(i):this.SetQuery(i),null==s)return null;e=D.d.report.DataSetAsyn("RPT022",s)}return e?e.then(s=>{let l=this.SetValueCallBack(i,s);null!=this.Chart&&this.Chart.WidgetCallBack(t,l),this.LoadingVisibility=!1},s=>{this.LoadingVisibility=!1,Logger.ErrorLog("widget error",s),null!=this.Chart&&this.Chart.WidgetCallBack(t,null)}):void 0}SetValueCallBack(i,t){if(104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID){let e=0;if(t.Tables[0].forEach(s=>{e+=parseFloat(s.Balance)}),t.Tables[0].push({ID:3,Balance:e}),i.Value="",0==t.Tables[0].length)return null;if(!c.J0.StringIsNullOrEmpty(i.LabelType)){let s=t.Tables[0].filter(l=>l.ID==parseInt(i.LabelType));s.length>0&&(i.dbl=parseFloat(s[0].Balance),i.Value=this.GetNumberFormatted(i.dbl,2,i))}this.SubFields.forEach(s=>{if(c.J0.StringIsNullOrEmpty(s.LabelType))return;let l=t.Tables[0].filter(a=>a.ID==parseInt(s.LabelType));s.dbl=l.length>0?parseFloat(l[0].Balance):0,s.txtValue.Text=this.GetNumberFormatted(s.dbl,2,s)})}if(null!=this.Chart){if(5==this.TypeID||6==this.TypeID){let e,l,s=[];if(t.Tables[0].length>0)for(let o=t.Tables[0].length-1;o>=0;o--)if(l=s.filter(h=>h.AccountID==t.Tables[0][o].AccountID),e=parseFloat(t.Tables[0][o].Balance),l.length>0)l[0].Balance=parseFloat(l[0].Balance)+e;else{let h={};h.AccountID=t.Tables[0][o].AccountID,h.Balance=e,s.push(h)}else s=[];if(this.IncludeOpening){if(6==this.TypeID)for(let r=t.Tables[1].length-1;r>=0;r--)t.Tables[1][r].OpBalance=-parseFloat(t.Tables[1][r].OpBalance);for(let r=t.Tables[1].length-1;r>=0;r--)if(l=s.filter(u=>u.AccountID==t.Tables[1][r].AccountID),e=parseFloat(t.Tables[1][r].OpBalance),l.length>0)l[0].Balance=parseFloat(l[0].Balance)+e;else{let u={};u.AccountID=t.Tables[1][r].AccountID,u.Balance=e,s.push(u)}for(let r=t.Tables[1].length-1;r>=0;r--)parseFloat(s.filter(u=>u.AccountID==t.Tables[1][r].AccountID.toString())[0].Balance)<0&&t.Tables[1].RemoveAt(r);let o=t.Tables[1].Compute("sum","OpBalance");null==o&&(o=0),t.Tables[1].Clear();let h={};h.OpBalance=parseFloat(o),t.Tables[1].push(h)}for(let o=t.Tables[0].length-1;o>=0;o--)parseFloat(s.filter(h=>h.AccountID==t.Tables[0][o].AccountID)[0].Balance)<0&&t.Tables[0].RemoveAt(o);e=0;let a=null,d=null;if("YrWise"==this.Groups)for(let o=0;o<t.Tables[0].length;o++)a!=t.Tables[0][o].Yr.toString()?(e=parseFloat(t.Tables[0][o].Balance),a=t.Tables[0][o].Yr.toString()):(e+=parseFloat(t.Tables[0][o].Balance),t.Tables[0].RemoveAt(o),o--,t.Tables[0][o].Balance=e);else for(let o=0;o<t.Tables[0].length;o++)a!=t.Tables[0][o].Yr.toString()||d!=t.Tables[0][o].Mn.toString()?(e=parseFloat(t.Tables[0][o].Balance),a=t.Tables[0][o].Yr.toString(),d=t.Tables[0][o].Mn.toString()):(e+=parseFloat(t.Tables[0][o].Balance),t.Tables[0].RemoveAt(o),o--,t.Tables[0][o].Balance=e)}i.dbl=0,this.IncludeOpening&&(i.dbl=parseFloat(t.Tables[1][0].OpBalance)),this.ShowPositive&&(i.dbl=-i.dbl,t.Tables[0].forEach(e=>{e.Balance=-parseFloat(e.Balance)}))}else if(16==this.TypeID||17==this.TypeID)this.SetDocStatusCount(i,t),i.Value=this.GetNumberFormatted(i.dbl,0,i);else if(66==this.TypeID){let e=new Date((new Date).getFullYear(),D.d.SessionManager.AccountingFromMonth,1),s=new Date(D.d.SessionManager.AccountingFromMonth>1?(new Date).getFullYear()+1:(new Date).getFullYear(),D.d.SessionManager.AccountingToMonth,1);s=s.AddMonths(1).AddDays(-1),i.Value=e.ToString("MMM yyyy")+" - "+s.ToString("MMM yyyy")}else 67==this.TypeID?(i.breakSpaces=!0,i.Value="Assigned     Used        Balance\r\n",i.Value+=t.Tables[0].length>0?t.Tables[0][0].Assigned.toString()+"                 "+t.Tables[0][0].Deducted.toString()+"                 "+t.Tables[0][0].Balance.toString():"0                   0                 0"):103==this.TypeID||104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID||(t.Columns[0].Contains("Balance")&&c.J0.StringValue(t.ColumnsTypes[0][t.Columns[0].indexOf("Balance")]).toLowerCase().Contains("string")?t.Tables[0].length>0&&(c.J0.IsEmpty(t.Tables[0][0].Balance)||(i.Value=t.Tables[0][0].Balance.toString())):(i.dbl=t.Tables[0].length>0?parseFloat(t.Tables[0][0].Balance):0,this.ShowPositive&&(i.dbl=-i.dbl),i.Value=this.GetNumberFormatted(i.dbl,this.Decimals,i)));if(null==this.Chart){if(17==this.TypeID)this.Header.IsLink=this.IsLink,this.SubFields.forEach(e=>{this.SetDocStatusCount(e,t),e.txtValue.IsLink=this.IsLink,e.txtValue.Text=this.GetNumberFormatted(e.dbl,0,e),e.ShowPercentage&&(e.txtPercent.Text=0!=e.dbl?"  ["+(100*this.Header.dbl/e.dbl).Commas("N0")+"%]":"  ["+(0).Commas("N0")+"%]")});else if(103==this.TypeID){if(i.Value="",0==t.Tables[0].length)return null;if(!c.J0.StringIsNullOrEmpty(i.LabelType)&&t.Columns[0].Contains(i.LabelType))if("Amount"==i.LabelType){let e=c.J0.Double(t.Tables[0][0][i.LabelType]);i.Value=this.GetNumberFormatted(e,2,i)}else i.Value="DocDate"==i.LabelType?c.J0.ParseDate(c.J0.String(t.Tables[0][0][i.LabelType])).ToString(D.d.SessionManager.Preferences["Date Format"]):c.J0.String(t.Tables[0][0][i.LabelType]);this.SubFields.forEach(e=>{if(!c.J0.StringIsNullOrEmpty(e.LabelType)&&t.Columns[0].Contains(e.LabelType))if("Amount"==e.LabelType){let s=c.J0.Double(t.Tables[0][0][e.LabelType]);e.txtValue.Text=this.GetNumberFormatted(s,2,e)}else e.txtValue.Text="DocDate"==e.LabelType?c.J0.isValidDate(t.Tables[0][0][e.LabelType])?c.J0.ParseDate(t.Tables[0][0][e.LabelType]).ToString(D.d.SessionManager.Preferences["Date Format"]):"":c.J0.String(t.Tables[0][0][e.LabelType])})}else if(11==this.TypeID||12==this.TypeID||13==this.TypeID||14==this.TypeID||15==this.TypeID||18==this.TypeID||19==this.TypeID||20==this.TypeID||102==this.TypeID){if(this.SubFields.Clear(),this.SubFieldsText.Clear(),i.Value="0.00",0==t.Tables[0].length)return null;(14==this.TypeID||15==this.TypeID||102==this.TypeID)&&(i.dbl=t.Tables[0].length>0?parseFloat(t.Tables[0].Compute("sum","Balance")):0,this.ShowPositive&&(i.dbl=-i.dbl),i.Value=this.GetNumberFormatted(i.dbl,2,i));for(let e=0;e<t.Tables[0].length;e++){let s=new w;s.Row=e.toString(),s.ForeColor=this.ForeColor,s.SetSubFields(),s.txtLbl.Text=t.Tables[0][e][t.Columns[0][0]].toString();let l=parseFloat(t.Tables[0][e].Balance);this.ShowPositive&&(l=-l),s.dbl=l,s.txtValue.Text=this.GetNumberFormatted(l,2,s),(11==this.TypeID||12==this.TypeID||13==this.TypeID||18==this.TypeID)&&(s.txtPercent.Visible=!1),this.SubFields.push(s),this.SubFieldsText.push(s.txtLbl),this.SubFieldsText.push(s.txtValue),this.SubFieldsText.push(s.txtSep)}}17==this.TypeID||14==this.TypeID||15==this.TypeID||102==this.TypeID?this.SubFields.forEach(e=>{this.Header.Value&&this.Header.Value.length>0?(0!=e.dbl?(e.txtPercent.Percentage=0==this.Header.dbl||e.dbl>this.Header.dbl?100:100*e.dbl/this.Header.dbl,e.txtPercent.Percentage<0&&(e.txtPercent.Percentage=0)):e.txtPercent.Percentage=0,e.txtPercent.Text=0!=e.txtPercent.Percentage&&Math.abs(e.txtPercent.Percentage)<1?"  ["+e.txtPercent.Percentage.Commas("N1")+"%]":"  ["+e.txtPercent.Percentage.Commas("N0")+"%]"):e.txtPercent.Visible=!1}):this.SubFields.find(e=>e==i)&&(this.Header.Value&&this.Header.Value.length>0?(0!=i.dbl?(i.txtPercent.Percentage=0==this.Header.dbl||i.dbl>this.Header.dbl?100:100*i.dbl/this.Header.dbl,i.txtPercent.Percentage<0&&(i.txtPercent.Percentage=0)):i.txtPercent.Percentage=0,i.txtPercent.Text=0!=i.txtPercent.Percentage&&Math.abs(i.txtPercent.Percentage)<1?"  ["+i.txtPercent.Percentage.Commas("N1")+"%]":"  ["+i.txtPercent.Percentage.Commas("N0")+"%]"):i.txtPercent.Visible=!1)}return i.IsDataReady=!0,this.IsDurationDifference&&2==this.SubFields.length&&!this.SubFields.find(e=>!e.IsDataReady)&&(this.Header.dbl=this.SubFields[0].dbl-this.SubFields[1].dbl,this.Header.Value=this.GetNumberFormatted(this.Header.dbl,this.Decimals,this.Header)),t.Tables[0]}SetQuery(i){let l,t=!1,e="",s="",a="",d="",o="",h="",r="";null!=this.Chart&&11!=this.TypeID&&12!=this.TypeID&&13!=this.TypeID&&18!=this.TypeID&&(t=!0),e=this.IncludeOpening&&null==this.Chart?" and D.DocDate<=@To":" and D.DocDate between @Fr and @To";let u=this.GetDateVariable(i);h="D.DocDate<@Fr";let T=" AND (D.StatusID=369 or D.StatusID=429)",m="(D.StatusID=370 OR D.StatusID=439 OR D.StatusID=452)";this.IncludePDC?(o=this.IncludeOpening&&!t?" AND ("+m+" OR (D.DocumentType<>14 AND D.DocumentType<>19"+T+"))":" AND D.DocumentType<>16 AND ("+m+" OR (D.DocumentType<>14 AND D.DocumentType<>19"+T+"))",h+=" AND ("+m+" OR (D.DocumentType<>14 AND D.DocumentType<>19"+T+"))"):(o=this.IncludeOpening&&!t?" AND D.DocumentType NOT IN (14,19)"+T:" AND D.DocumentType NOT IN (16,14,19)"+T,h+=" AND D.DocumentType<>14 AND D.DocumentType<>19"+T);let p=this.GetDimensionWhere("DCC.dcCCNID");(p.length>0||this.Groups.startsWith("DIM_"))&&(a=" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID",d=" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),this.ForeignCurrencyID>0?(l="AmountFC",s=" AND D.CurrencyID="+this.ForeignCurrencyID):(l=1==this.CurrencyType?"AmountBC":"Amount",s="");let n="",C="",I="",y="",b="";if(5==this.TypeID||6==this.TypeID||11==this.TypeID||12==this.TypeID||18==this.TypeID?(C="A.AccountID,",I+="A.AccountID,"):13==this.TypeID&&(C="INV.ProductID,",I+="INV.ProductID,"),"YrWise"==this.Groups?(C+="year(convert(datetime,D.DocDate)) Yr,",I+="year(convert(datetime,D.DocDate)),",y+="Yr,"):"MnWise"==this.Groups||"QtrWise"==this.Groups?(C+="year(convert(datetime,D.DocDate)) Yr,month(convert(datetime,D.DocDate)) Mn,",I+="year(convert(datetime,D.DocDate)),month(convert(datetime,D.DocDate)),",y+="Yr,Mn,"):this.Groups.startsWith("DIM_")&&(C+="DIM.Name,",I+="DIM.Name,",y+="Name,",a+=" join "+Q.A.GetTagTableName(parseInt(this.Groups.substr(4)))+" DIM with(nolock) on DIM.NodeID=DCC.dcCCNID"+(parseInt(this.Groups.substr(4))-5e4),d+=" join "+Q.A.GetTagTableName(parseInt(this.Groups.substr(4)))+" DIM with(nolock) on DIM.NodeID=DCC.dcCCNID"+(parseInt(this.Groups.substr(4))-5e4)),I.length>0&&(I=" GROUP BY "+I.Trim(",")),11==this.TypeID||12==this.TypeID||13==this.TypeID)this.strAccounts.length>0?(this.IsGroupsExists?(b=" join ACC_Accounts GT on A2.lft BETWEEN GT.lft AND GT.rgt",n=this.strAccounts.Contains(",")?"GT.AccountID IN ("+this.strAccounts+")":"GT.AccountID="+this.strAccounts):n=this.strAccounts.Contains(",")?"A2.AccountID IN ("+this.strAccounts+")":"A2.AccountID="+this.strAccounts,11==this.TypeID||13==this.TypeID?n+=" and A.AccountTypeID=7":12==this.TypeID&&(n+=" and A.AccountTypeID=6")):11==this.TypeID||13==this.TypeID?n="A.AccountTypeID=7 and (A2.AccountTypeID=4 or A2.AccountTypeID=11)":12==this.TypeID&&(n="A.AccountTypeID=6 and (A2.AccountTypeID=5 or A2.AccountTypeID=14)"),a+=" join ACC_Accounts A2 with(nolock) on D.XXA2XX=A2.AccountID",d+=" join ACC_Accounts A2 with(nolock) on D.XXA2XX=A2.AccountID",13==this.TypeID&&(a+=" join INV_DocDetails INV with(nolock) on D.InvDocDetailsID=INV.InvDocDetailsID",d+=" join INV_DocDetails INV with(nolock) on D.InvDocDetailsID=INV.InvDocDetailsID");else if(this.strAccounts.length>0)this.IsGroupsExists?(b=" join ACC_Accounts GT on A.lft BETWEEN GT.lft AND GT.rgt",n=this.strAccounts.Contains(",")?"GT.AccountID IN ("+this.strAccounts+")":"GT.AccountID="+this.strAccounts):n=this.strAccounts.Contains(",")?"A.AccountID IN ("+this.strAccounts+")":"A.AccountID="+this.strAccounts;else if(101==this.TypeID)n="A.AccountTypeID=4";else if(2==this.TypeID)n="A.AccountTypeID=5";else if(3==this.TypeID||18==this.TypeID)n="(A.AccountTypeID=9 or A.AccountTypeID=12)";else if(4==this.TypeID)n="(A.AccountTypeID=8 or A.AccountTypeID=11)";else if(5==this.TypeID||6==this.TypeID)n="(A.AccountTypeID=6 or A.AccountTypeID=7)";else if(7==this.TypeID)n="(A.AccountTypeID=1 or A.AccountTypeID=10)";else if(8==this.TypeID)n="(A.AccountTypeID=2 or A.AccountTypeID=3)";else if(9==this.TypeID||10==this.TypeID)return null;return r+=u+"\r\n",5==this.TypeID||6==this.TypeID?(r+=y.length>0?"select "+y+"AccountID,isnull(sum(Balance),0) Balance from(":"select "+y+"isnull(sum(Balance),0) Balance from(",r+=5==this.TypeID?"select "+y+"AccountID,sum(Dr)-sum(Cr) Balance from(":"select "+y+"AccountID,sum(Cr)-sum(Dr) Balance from("):r+=11==this.TypeID||18==this.TypeID?"select top 5 A.AccountName,isnull(sum(Dr)-sum(Cr),0) Balance from(":12==this.TypeID?"select top 5 A.AccountName,isnull(sum(Cr)-sum(Dr),0) Balance from(":13==this.TypeID?"select top 5 P.ProductName,isnull(sum(Dr)-sum(Cr),0) Balance from(":"select "+y+"sum(Dr)-sum(Cr) Balance from(",""==n&&(n="1=1"),r+="\nselect "+C+"sum("+l+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+a.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+b+"\nwhere "+n+e+p+o+s,r+=I,r+="\nunion all\nselect "+C+"0 Dr,sum("+l+") Cr from Acc_DocDetails D with(nolock)"+a.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+b+"\nwhere "+n+e+p+o+s,r+=I,p.length>0&&(r+="\nunion all\nselect "+C+"sum("+l+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+d.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+b+"\nwhere "+n+e+p+s+" AND D.StatusID=369",r+=I,r+="\nunion all\nselect "+C+"0 Dr,sum("+l+") Cr from Acc_DocDetails D with(nolock)"+d.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+b+"\nwhere "+n+e+p+s+" AND D.StatusID=369",r+=I),(5==this.TypeID||6==this.TypeID)&&(r+=")AS T group by AccountID",y.length>0?(r+=","+y.Trim(","),y+="AccountID,"):r+=5==this.TypeID?" having sum(Dr)-sum(Cr)>0":" having sum(Dr)-sum(Cr)<0"),r+=")AS T",11==this.TypeID||12==this.TypeID||18==this.TypeID?(r+=" join ACC_Accounts A with(nolock) on T.AccountID=A.AccountID",r+=" GROUP BY A.AccountName",r+=" ORDER BY Balance DESC"):13==this.TypeID?(r+=" join INV_Product P with(nolock) on T.ProductID=P.ProductID",r+=" GROUP BY P.ProductName",r+=" ORDER BY Balance DESC"):y.length>0&&(r+=" GROUP BY "+y.Trim(","),r+=" ORDER BY "+y.Trim(",")),this.IncludeOpening&&t&&(5==this.TypeID||6==this.TypeID?(C="A.AccountID,",I=" GROUP BY A.AccountID",y="AccountID,"):C=I=y="",r+="\n--OPENING\nselect "+y+"sum(Dr)-sum(Cr) OpBalance from(",r+="\nselect "+C+"sum("+l+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+a.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+b+"\nwhere "+n+p+s+" and ((D.DocumentType=16"+T+") OR ("+h+"))"+I,r+="\nunion all\nselect "+C+"0 Dr,sum("+l+") Cr from Acc_DocDetails D with(nolock)"+a.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+b+"\nwhere "+n+p+s+" and ((D.DocumentType=16"+T+") OR ("+h+"))"+I,p.length>0&&(r+="\nunion all\nselect "+C+"sum("+l+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+d.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+b+"\nwhere "+n+p+s+" and D.DocDate<@Fr AND D.StatusID=369"+I,r+="\nunion all\nselect "+C+"0 Dr,sum("+l+") Cr from Acc_DocDetails D with(nolock)"+d.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+b+"\nwhere "+n+p+s+" and D.DocDate<@Fr AND D.StatusID=369"+I),r+=")AS T",y.length>0&&(r+=" group by "+y.TrimEnd(","),r+=" order by "+y.TrimEnd(","))),r.toString()}SetQueryAgeing(i){let s,t="",e="",l="",a="",d=new Date;!c.J0.IsEmpty(this.dtFilterAsnDate)&&1!=this.dtFilterAsnDate.getFullYear()&&(d=this.dtFilterAsnDate),t="declare @Fr float,@To float",null!=this.Chart?(t+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))"):t+=" set @Fr=0 set @To=convert(float,convert(datetime,'"+d.ToString("dd MMM yyyy")+"'))";let o=" AND (B.StatusID=369 or B.StatusID=429)";l=this.IncludePDC?" AND ((B.StatusID=370 OR B.StatusID=439 OR B.StatusID=452) OR (B.DocType<>14 AND B.DocType<>19"+o+"))":" AND B.DocType NOT IN (14,19)"+o;let r=this.GetDimensionWhere("B.dcCCNID");this.ForeignCurrencyID>0?(s="AmountFC",e=" AND B.AdjCurrID="+this.ForeignCurrencyID):(s=1==this.CurrencyType?"AmountBC":"AdjAmount",e="");let u="",T="";if(this.strAccounts.length>0?this.IsGroupsExists?(T=" JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID join ACC_Accounts GT on A.lft BETWEEN GT.lft AND GT.rgt",u=this.strAccounts.Contains(",")?" and GT.AccountID IN ("+this.strAccounts+")":" and GT.AccountID="+this.strAccounts):u=this.strAccounts.Contains(",")?" and B.AccountID IN ("+this.strAccounts+")":" and B.AccountID="+this.strAccounts:(T=" JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID",u=" and (A.AccountTypeID=6 or A.AccountTypeID=7)"),a+=t+"\r\n",a+="declare @TblAccs as Table(AccID bigint) ",104!=this.TypeID&&105!=this.TypeID&&106!=this.TypeID&&107!=this.TypeID){a+=" declare @Tbl As Table(ID INT,Slab nvarchar(15),FromDate FLOAT,ToDate FLOAT)";for(let p=0;p<=this.Slabs.length;p++)a+=p==this.Slabs.length?" INSERT INTO @Tbl VALUES("+p+",'>"+this.Slabs[this.Slabs.length-1]+"',1,@To-"+this.Slabs[this.Slabs.length-1]+")":0==p?" INSERT INTO @Tbl VALUES("+p+",'0-"+(this.Slabs[p]-1)+"',@To-"+(this.Slabs[p]-1)+",@To)":" INSERT INTO @Tbl VALUES("+p+",'"+this.Slabs[p-1]+"-"+(this.Slabs[p]-1)+"',@To-"+(this.Slabs[p]-1)+",@To-"+this.Slabs[p-1]+")"}let m="";return m=15==this.TypeID||105==this.TypeID||106==this.TypeID?"<0":14==this.TypeID||104==this.TypeID||107==this.TypeID?">0":"!=0",104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID?(a+="\nselect DueStatus ID,"+(105==this.TypeID||106==this.TypeID?"-":"")+"isnull(sum(Balance),0) Balance from\n(\nSELECT case when isnull(DocDueDate,DocDate)<@To then 2 else 1 end DueStatus\n,"+s+"+ISNULL((SELECT SUM(CB."+s+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To"+l.Replace("B.","CB.")+"),0) Balance\nFROM COM_Billwise B with(nolock)\nJOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID\nWHERE B.IsNewReference=1 AND B.DocDate<=@To",104==this.TypeID||106==this.TypeID?a+=" and A.AccountTypeID=7":(105==this.TypeID||107==this.TypeID)&&(a+=" and A.AccountTypeID=6"),a+=l,a+=r,a+=e,a+="\n) AS T\nwhere Balance"+m+"\ngroup by DueStatus"):(a+="\n            insert into @TblAccs\n            select AccountID from (\n            SELECT B.AccountID\n            ,"+s+"+ISNULL((SELECT SUM(CB."+s+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To"+l.Replace("B.","CB.")+"),0) Balance\n            FROM COM_Billwise B with(nolock)"+T+"\n            WHERE B.IsNewReference=1 AND B.DocDate<=@To",a+=l+u,a+=r,a+=e,a+="\n            ) as T\n            group by AccountID\n            having sum(Balance)"+m+" and abs(sum(Balance))>0.01",a+="\n    select S.Slab,"+(15==this.TypeID?"-":"")+"isnull(sum(Balance),0) Balance from\n    (\n    SELECT T.ID\n    ,"+s+"+ISNULL((SELECT SUM(CB."+s+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To"+l.Replace("B.","CB.")+"),0) Balance\n    FROM COM_Billwise B with(nolock)\n    join @TblAccs TA on TA.AccID=B.AccountID\n    join @Tbl T on B.DocDate BETWEEN T.FromDate AND T.ToDate\n    WHERE B.IsNewReference=1 AND B.DocDate<=@To",a+=l,a+=r,a+=e,a+="\n    ) AS T\n    right join @Tbl S on S.ID=T.ID\n    where Balance"+m+"\n    group by S.ID,S.Slab\n    order by S.ID"),a.toString()}SetQueryDocumentStatus(i){let e,t="",s="",l="";t="AsOnDate"==i.LabelType?" and D.DocDate<=@To":" and D.DocDate between @Fr and @To";let a=this.GetDateVariable(i),o=this.GetDimensionWhere("DCC.dcCCNID");o.length>0&&(s=this.IsAccDoc?" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),(2==D.d.SessionManager.RoleType||3==D.d.SessionManager.RoleType)&&(o+=" and (D.DebitAccount="+D.d.SessionManager.ESSID+" or D.CreditAccount="+D.d.SessionManager.ESSID+")"),e=this.IsAccDoc?"ACC_DocDetails":"INV_DocDetails";let h="",r="",u="",T="";if("YrWise"==this.Groups?(r+="year(convert(datetime,D.DocDate)) Yr,",u+="year(convert(datetime,D.DocDate)),",T+="Yr,"):("MnWise"==this.Groups||"QtrWise"==this.Groups)&&(r+="year(convert(datetime,D.DocDate)) Yr,month(convert(datetime,D.DocDate)) Mn,",u+="year(convert(datetime,D.DocDate)),month(convert(datetime,D.DocDate)),",T+="Yr,Mn,"),u.length>0&&(u=" GROUP BY "+u.Trim(",")),h=this.strAccounts.length>0?this.strAccounts.Contains(",")?"D.CostCenterID in ("+this.strAccounts+")":"D.CostCenterID="+this.strAccounts:"1=1",16==this.TypeID&&"0"!=i.StatusID&&"21"!=i.StatusID&&"22"!=i.StatusID&&"23"!=i.StatusID&&"31"!=i.StatusID&&"32"!=i.StatusID&&"33"!=i.StatusID&&(h+=" and D.StatusID="+i.StatusID),l+=a+"\r\n",this.IsGeneralDocs?("376"!=this.Header.StatusID&&!this.SubFields.find(p=>"376"==p.StatusID)&&(o+=" and D.StatusID!=376"),l+="select T.StatusID,count(*) Balance,sum(VersionNo) Revised\nfrom\n(\nselect DocID,VoucherNo,case when count(*)>1 then -1 else max(StatusID) end StatusID,VersionNo\nfrom\n(\nselect "+r+"DocID,VoucherNo,StatusID,VersionNo\nfrom "+e+" D with(nolock)"+s+"\nwhere "+h+t+o+"\ngroup by DocID,VoucherNo,StatusID,VersionNo\n) AS T\ngroup by DocID,VoucherNo,VersionNo\n) AS T\ngroup by T.StatusID"):l+=" select 0 NOQUERY where 1!=1",!this.IsAccDoc&&this.IsExecutedDocs&&this.strAccounts.length>0){let p=this.strAccounts.split(",");l+="\nselect StatusID,count(*) Balance from(\nselect DocID,case when sum(Quantity)<=sum(ExeQty) then 22 when sum(ExeQty)>0 and sum(Quantity)>sum(ExeQty) then 23 else 21 end StatusID\nfrom(\r\n";for(let n=0;n<p.length;n++){let C=!0;if(!this.dicExecutedQuery.ContainsKey(p[n])){let I=D.d.report.GetExecutedQtyQuery(0,p[n],null,null,C,!1);I=0==I.length?"0":I.Replace("INV.","D.").Replace("inv.","D."),this.dicExecutedQuery.push(p[n],I)}n>0&&(l+="\r\nunion all\r\n"),this.dicExecutedQuery[p[n]].Contains("NUM")&&!s.Contains("COM_DocNumData")&&(s+=this.IsAccDoc?" join COM_DocNumData NUM with(nolock) on NUM.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocNumData NUM with(nolock) on NUM.InvDocdetailsID=D.InvDocdetailsID"),l+="SELECT D.DocID,D.Quantity,"+this.dicExecutedQuery[p[n]]+" ExeQty\nFROM INV_DocDetails D with(nolock)"+s+"\nWHERE D.CostCenterID="+p[n]+" and D.StatusID!=376"+t+o}l+=") AS T\ngroup by DocID\n) as T\ngroup by StatusID"}else l+=" select 0 NOQUERY where 1!=1";return this.IsBWDocs&&(l+="\n            select StatusID, count(*) Balance from(\n                select case when PaidAmt = 0 then 31 when BillAmt > PaidAmt then 32  else 33 end StatusID from(\n                    select VoucherNo\n                    , (SELECT ISNULL(SUM(abs(AdjAmount)), 0) FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.DocNo = D.VoucherNo) BillAmt\n                , (SELECT ISNULL(SUM(abs(AdjAmount)), 0) FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference = 0 AND(CB.RefDocNo = D.VoucherNo OR CB.DocNo = D.VoucherNo)) PaidAmt\n            from "+e+" D with (nolock) "+s+"\n            where "+h+t+o+" and StatusID = 369\n            group by VoucherNo) AS T\n) AS T\n            group by StatusID"),l.toString()}SetQueryDocumentStatusDetails(i,t){let s,e="",l="",a="";e="AsOnDate"==i.LabelType?" and D.DocDate<=@To":" and D.DocDate between @Fr and @To";let d=this.GetDateVariable(i),h=this.GetDimensionWhere("DCC.dcCCNID");h.length>0&&(l=this.IsAccDoc?" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),s=this.IsAccDoc?"ACC_DocDetails":"INV_DocDetails";let r="",u="",T="",m="";if("YrWise"==this.Groups?(u+="year(convert(datetime,D.DocDate)) Yr,",T+="year(convert(datetime,D.DocDate)),",m+="Yr,"):("MnWise"==this.Groups||"QtrWise"==this.Groups)&&(u+="year(convert(datetime,D.DocDate)) Yr,month(convert(datetime,D.DocDate)) Mn,",T+="year(convert(datetime,D.DocDate)),month(convert(datetime,D.DocDate)),",m+="Yr,Mn,"),T.length>0&&(T=" GROUP BY "+T.Trim(",")),r=this.strAccounts.length>0?this.strAccounts.Contains(",")?"D.CostCenterID in ("+this.strAccounts+")":"D.CostCenterID="+this.strAccounts:"1=1","0"!=t&&"21"!=t&&"22"!=t&&"23"!=t&&"31"!=t&&"32"!=t&&"33"!=t&&(r+=" and D.StatusID="+t),a+=d+"\r\n","21"!=t&&"22"!=t&&"23"!=t)"376"!=this.Header.StatusID&&!this.SubFields.find(n=>"376"==n.StatusID)&&(h+=" and D.StatusID!=376"),a+="\nselect convert(datetime,D.DocDate) DocDate,D.VoucherNo"+(this.IsAccDoc?"":",sum(D.Quantity) Quantity")+"\nfrom "+s+" D with(nolock)"+l+"\nwhere "+r+e+h+"\ngroup by DocDate,VoucherNo\n";else if(!this.IsAccDoc&&this.IsExecutedDocs&&this.strAccounts.length>0){let n=this.strAccounts.split(",");a+="\nselect Convert(DateTime,DocDate) DocDate,VoucherNo,sum(Quantity) Quantity,sum(ExeQty) ExeQty,case when sum(Quantity)<=sum(ExeQty) then 22 when sum(ExeQty)>0 and sum(Quantity)>sum(ExeQty) then 23 else 21 end StatusID\nfrom(\r\n";for(let C=0;C<n.length;C++){let I=!0;if(!this.dicExecutedQuery.ContainsKey(n[C])){let y=D.d.report.GetExecutedQtyQuery(0,n[C],null,null,I,!1);y=0==y.length?"0":y.Replace("INV.","D.").Replace("inv.","D."),this.dicExecutedQuery.push(n[C],y)}C>0&&(a+="\r\nunion all\r\n"),this.dicExecutedQuery[n[C]].Contains("NUM")&&!l.Contains("COM_DocNumData")&&(l+=this.IsAccDoc?" join COM_DocNumData NUM with(nolock) on NUM.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocNumData NUM with(nolock) on NUM.InvDocdetailsID=D.InvDocdetailsID"),a+="SELECT D.DocDate,D.VoucherNo,D.Quantity,"+this.dicExecutedQuery[n[C]]+" ExeQty\nFROM INV_DocDetails D with(nolock)"+l+"\nWHERE D.CostCenterID="+n[C]+" and D.StatusID!=376"+e+h}a+="\n) AS T\ngroup by DocDate,VoucherNo","21"==t?a+=" having sum(ExeQty)=0":"22"==t?a+=" having sum(Quantity)<=sum(ExeQty)":"23"==t&&(a+=" having sum(ExeQty)>0 and sum(Quantity)>sum(ExeQty)")}return a.toString()}SetQueryDocumentLastInfo(i){let e,s="",l="",a=this.GetDimensionWhere("DCC.dcCCNID");a.length>0&&(s=this.IsAccDoc?" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),(2==D.d.SessionManager.RoleType||3==D.d.SessionManager.RoleType)&&(a+=" and (D.DebitAccount="+D.d.SessionManager.ESSID+" or D.CreditAccount="+D.d.SessionManager.ESSID+")"),e=this.IsAccDoc?"ACC_DocDetails":"INV_DocDetails";let h,d="";return d=this.strAccounts.length>0?this.strAccounts.Contains(",")?"D.CostCenterID in ("+this.strAccounts+")":"D.CostCenterID="+this.strAccounts:"1=1",h=this.IsAccDoc?",sum(D.Amount)/2 Amount":",sum(D.StockValue) Amount",l="\n        declare @Vno nvarchar(max)\n        select top 1 @Vno=VoucherNo\n        from "+e+" D with (nolock) "+s+"\n        where "+d+a+"\n        order by D.Docdate desc, D.CreatedDate desc\n\n        select max(VoucherNo) VoucherNo, Convert(datetime, max(DocDate)) DocDate"+h+"\n        from "+e+" D with (nolock) "+s+"\n        where VoucherNo =@Vno",l.toString()}SetQueryBatchExpiryAgeing(i){let e=new Date;null!=this.Chart&&(e=this.Chart.ToDate.Date);let s=this.GetDimensionWhere("DCC.dcCCNID"),l=[];return l.push(e),l.push(19==this.TypeID?1:0),l.push(s),l.push(D.d.SessionManager.LanguageID),D.d.report.BatchAgeing(l)}SetQueryHRM(i){let t=this.GetDateVariable(i),e="",s="";22==this.TypeID||23==this.TypeID||24==this.TypeID||28==this.TypeID||29==this.TypeID||30==this.TypeID||31==this.TypeID||33==this.TypeID||36==this.TypeID||37==this.TypeID||38==this.TypeID||59==this.TypeID||63==this.TypeID||64==this.TypeID?(s="DCC.CCNID",e=this.GetDimensionWhere("DCC.CCNID")):(s="DCC.dcCCNID",e=this.GetDimensionWhere("DCC.dcCCNID")),this.dicLookupFilters.ContainsKey(108)&&(this.dicLookupFilters[108].Nodes.Contains(",")?e+=" and E.Nationality in ("+this.dicLookupFilters[108].Nodes+")":e+=" and E.Nationality="+this.dicLookupFilters[108].Nodes),this.dicLookupFilters.ContainsKey(123)&&(this.dicLookupFilters[123].Nodes.Contains(",")?e+=" and E.Gender in ("+this.dicLookupFilters[123].Nodes+")":e+=" and E.Gender="+this.dicLookupFilters[123].Nodes),"True"==D.d.SessionManager.Preferences.EnableDivisionWise.toString()&&(D.d.SessionManager.DivisionID>0?e+=" and "+s+"1="+D.d.SessionManager.DivisionID:"1"!=D.d.SessionManager.RoleID&&D.d.SessionManager.DivisionWhere.length>0&&(e+=" and "+s+"1 in ("+D.d.SessionManager.DivisionWhere+")"));let l=[];return l.push(this.TypeID),l.push(this.Groups),l.push(t),l.push(e),l.push(D.d.SessionManager.LanguageID),D.d.report.GetWidgetHRM(l)}GetDateVariable(i){let t="";t="declare @Fr float,@To float,@EMPID bigint",this.HeaderValuePostfix="";let e=new Date;c.J0.IsEmpty(this.dtFilterAsnDate)||1!=this.dtFilterAsnDate.getFullYear()&&(e=this.dtFilterAsnDate);let s=new Date((new Date).getFullYear(),D.d.SessionManager.AccountingFromMonth-1,1);if(s>new Date&&(s=s.AddYears(-1)),null!=this.Chart)101==this.Chart.Parent.EmpWidgetTypeID?(t+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))"):this.PrevData>0?(t+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.AddYears(-this.PrevData).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))"):(t+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))");else if("Today"==i.LabelType)this.HeaderValuePostfix="Today",t+=" set @Fr=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"')) set @To=@Fr";else if("Yesterday"==i.LabelType)this.HeaderValuePostfix="YSTD",t+=" set @Fr=convert(float,convert(datetime,'"+e.AddDays(-1).ToString("dd MMM yyyy")+"')) set @To=@Fr";else if("AsOnDate"==i.LabelType)this.HeaderValuePostfix="AOD",t+=" set @Fr=0 set @To=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))";else if("MnToDate"==i.LabelType)this.HeaderValuePostfix="MTD",t+=" set @Fr=convert(float,convert(datetime,'"+new Date(e.getFullYear(),e.getMonth(),1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))";else if("QtrToDate"==i.LabelType){this.HeaderValuePostfix="QTD";let l=(e.iMonth()-1)/3+1;t+=" set @Fr=convert(float,convert(datetime,'"+new Date(e.getFullYear(),3*(l-1)+1,1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))"}else if("YrToDate"==i.LabelType)this.HeaderValuePostfix="YTD",t+=" set @Fr=convert(float,convert(datetime,'"+s.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))";else if("CurMon"==i.LabelType)this.HeaderValuePostfix="CM",e=new Date(e.getFullYear(),e.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("CurMonToDate"==i.LabelType)this.HeaderValuePostfix="CMTD",t+=" set @Fr=convert(float,convert(datetime,'"+new Date(e.getFullYear(),e.getMonth(),1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))";else if("PrevMn"==i.LabelType)this.HeaderValuePostfix="PM",e=new Date(e.getFullYear(),e.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+e.AddMonths(-1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("PrevMnToDate"==i.LabelType)this.HeaderValuePostfix="PMTD",t+=" set @To=convert(float,convert(datetime,'"+e.AddMonths(-1).ToString("dd MMM yyyy")+"'))",e=new Date(e.getFullYear(),e.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+e.AddMonths(-1).ToString("dd MMM yyyy")+"'))";else if("PrevQtr"==i.LabelType){this.HeaderValuePostfix="PQ";let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear(),3*(l-1),1),t+=" set @Fr=convert(float,convert(datetime,'"+e.AddMonths(-3).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddDays(-1).ToString("dd MMM yyyy")+"'))"}else if("PrevQtrToDate"==i.LabelType){this.HeaderValuePostfix="PQTD";let l=(e.iMonth()-1)/3+1;t+=" set @To=convert(float,convert(datetime,'"+new Date(e.getFullYear(),3*(l-1)+1,1).AddMonths(-3).ToString("dd MMM yyyy")+"'))",t+=" set @Fr=convert(float,convert(datetime,'"+e.AddMonths(-3).ToString("dd MMM yyyy")+"'))"}else if("LastYr"==i.LabelType)this.HeaderValuePostfix="LY",t+=" set @Fr=convert(float,convert(datetime,'"+s.AddYears(-1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+s.AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrToDate"==i.LabelType)this.HeaderValuePostfix="LYTD",new Date(e.getFullYear()-1,1,1),t+=" set @Fr=convert(float,convert(datetime,'"+s.AddYears(-1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddYears(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrMn"==i.LabelType)this.HeaderValuePostfix="LYM",e=new Date(e.getFullYear()-1,e.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrMnToDate"==i.LabelType)this.HeaderValuePostfix="LYMTD",t+=" set @Fr=convert(float,convert(datetime,'"+new Date(e.getFullYear()-1,e.getMonth(),1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddYears(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrQtr"==i.LabelType){this.HeaderValuePostfix="LYQ";let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear()-1,3*(l-1),1),t+=" set @Fr=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddMonths(3).AddDays(-1).ToString("dd MMM yyyy")+"'))"}else if("LastYrQtrToDate"==i.LabelType){this.HeaderValuePostfix="LYQTD";let l=(e.iMonth()-1)/3+1;t+=" set @Fr=convert(float,convert(datetime,'"+new Date(e.getFullYear()-1,3*(l-1)+1,1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddYears(-1).ToString("dd MMM yyyy")+"'))"}else if("WeekToDate"==i.LabelType){this.HeaderValuePostfix="WTD";let a=(new Date).getDay()-1;t+=" set @Fr=convert(float,convert(datetime,'"+e.AddDays(-a).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))"}else if("PrevWeek"==i.LabelType){this.HeaderValuePostfix="LWTD";let a=(new Date).getDay()-1;t+=" set @Fr=convert(float,convert(datetime,'"+e.AddDays(-(a+7)).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddDays(-(a+1)).ToString("dd MMM yyyy")+"'))"}return t+=" set @EMPID="+D.d.SessionManager.iEmployee,t}GetDimensionWhere(i){let t="";return"True"==D.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==D.d.SessionManager.Preferences["LW Reports"]&&(D.d.SessionManager.LocationID>0?t=" and "+i+"2="+D.d.SessionManager.LocationID:"1"!=D.d.SessionManager.RoleID&&D.d.SessionManager.LocationWhere.length>0&&(t=" and "+i+"2 in ("+D.d.SessionManager.LocationWhere+")")),this.dicUserWiseDims.keys.forEach(e=>{let s={Key:e,Value:this.dicUserWiseDims[e]};s.Value.Contains(",")?t+=" and "+i+(parseInt(s.Key)-5e4)+" in ("+s.Value+")":t+=" and "+i+(parseInt(s.Key)-5e4)+"="+s.Value}),this.dicFilters.keys.forEach(e=>{let s={Key:e,Value:this.dicFilters[e]};s.Key>5e4&&(s.Value.Nodes.Contains(",")?t+=" and "+i+(s.Key-5e4)+" in ("+s.Value.Nodes+")":t+=" and "+i+(s.Key-5e4)+"="+s.Value.Nodes)}),t}SetDocStatusCount(i,t){let s=t.Tables[0];if("21"==i.StatusID||"22"==i.StatusID||"23"==i.StatusID?s=t.Tables[1]:"31"==i.StatusID||"32"==i.StatusID||"33"==i.StatusID?s=t.Tables[2]:"0"==i.StatusID&&t.Columns[0].Contains("NOQUERY")&&(s=t.Tables[1]),"0"==i.StatusID){let l=s.filter(a=>376!=a.StatusID).Compute("sum","Balance");if(i.dbl=null!=l?parseFloat(l):0,this.IncludeRevised&&t.Columns.Contains("Revised")){let a=s.filter(d=>376!=d.StatusID).Compute("sum","Revised");i.dbl=i.dbl+(null!=a?parseFloat(a):0)}}else if(this.IncludeRevised&&"24"==i.StatusID&&t.Columns.Contains("Revised")){let l=s.filter(a=>376!=a.StatusID).Compute("sum","Revised");i.dbl=null!=l?parseFloat(l):0}else{let l=s.filter(a=>a.StatusID==i.StatusID);i.dbl=l.length>0?parseFloat(l[0].Balance):0}}Refresh(){this.LoadingVisibility=!0;try{if(26==this.TypeID||27==this.TypeID)return void this.WidgetCalendar.Refresh();let i=this.SetValue(this.Header);this.Header.Visible&&null!=this.Header.txtLbl&&this.HeaderValuePostfix.length>0&&(this.Header.txtLbl.Text=" ["+this.HeaderValuePostfix+"]"),11!=this.TypeID&&12!=this.TypeID&&13!=this.TypeID&&14!=this.TypeID&&15!=this.TypeID&&17!=this.TypeID&&18!=this.TypeID&&19!=this.TypeID&&20!=this.TypeID&&102!=this.TypeID&&103!=this.TypeID&&104!=this.TypeID&&105!=this.TypeID&&106!=this.TypeID&&107!=this.TypeID&&(null==i&&(i=new Promise((t,e)=>{t("hi")})),i.then(()=>{this.SubFields.map(t=>0==t.IsDataReady),this.SubFields.forEach(t=>{this.SetValue(t)})},t=>{this.LoadingVisibility=!1}))}catch(i){this.LoadingVisibility=!1,Logger.ErrorLog("Widget Refresh: ",i)}}OnValueClick(i){let t=null!=i?i.WzLbl.StatusID:this.Header.StatusID,e=this.SetQueryDocumentStatusDetails(this.Header,t);if(null==e)return;let s=D.d.report.DataSet("RPT022",e);this.CallStatusID=t;let l=new ae.AccountDrillDownViewModel(null,this);l.Title=null!=i?i.WzLbl.txtLbl.Text:this.Header.Label,l.LoadWidgetData(s),D.d.page.ShowDialog(l,oe._,{ShowCenter:!0})}static DefaultTreeCCID(i){let t=0;return t="16"==i||"17"==i||"103"==i?300:"21"==i||"22"==i||"23"==i||"24"==i||"25"==i||"26"==i||"27"==i?50002:2,t}GetNumberFormatted(i,t,e){let s="";if(c.J0.IsEmptySpace(e.Formula)){let l="";l=t>0?"N"+t.toString():"N0",s=i.Commas(l)}else{let l=this.fldDict;this.fldDict.value.setFieldValue(i),this.fldDict.Value.setFieldValue(i),this.fldDict.VALUE.setFieldValue(i);try{s=this.eval.EvaluateExpression(e.Formula,l).toString()}catch{let d="";d=t>0?"N"+t.toString():"N0",s="#"+i.Commas(d)}}return s}OnNumberClick(i){if(17==this.TypeID||16==this.TypeID){let t="",e=this.GetDateFilterXML(i);if(e.length>0&&(t="<XML>"+e+"</XML>"),0==this.strAccounts.length)return void alert("No Documents Selected For Widget");let s=c.J0.Int(i.StatusID),l=this.strAccounts.split(",");21==s||22==s||23==s?(21==s?s=-1:22==s?s=-2:23==s&&(s=-3),k.uI.LoadDocumentLandingPage(l[0],l[0],s,"",{DocsList:this.strAccounts,ReportFilterXML:t},!0)):k.uI.LoadDocumentLandingPage(l[0],l[0],s>0?" and INV.StatusID="+s:"","",{DocsList:this.strAccounts,ReportFilterXML:t},!0)}}GetDateFilterXML(i){let t="",e=new Date,s=new Date((new Date).getFullYear(),D.d.SessionManager.AccountingFromMonth-1,1);if(s>new Date&&(s=s.AddYears(-1)),null!=this.Chart)t=this.PrevData>0?"<Row ColID='FROMDATE' Value='"+this.Chart.FromDate.Date.AddYears(-this.PrevData).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'/>":"<Row ColID='FROMDATE' Value='"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'/>";else if("Today"==i.LabelType)t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.ToString("dd MMM yyyy")+"'/>";else if("Yesterday"==i.LabelType)t="<Row ColID='FROMDATE' Value='"+e.AddDays(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("AsOnDate"==i.LabelType)t="<Row ColID='ASONDATE' Value='"+e.ToString("dd MMM yyyy")+"'/>";else if("MnToDate"==i.LabelType)t="<Row ColID='FROMDATE' Value='"+new Date(e.getFullYear(),e.getMonth(),1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.ToString("dd MMM yyyy")+"'/>";else if("QtrToDate"==i.LabelType){let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear(),3*(l-1),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).ToString("dd MMM yyyy")+"'/>"}else if("YrToDate"==i.LabelType)t="<Row ColID='FROMDATE' Value='"+s.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.ToString("dd MMM yyyy")+"'/>";else if("CurMon"==i.LabelType)e.iMonth(),e=new Date(e.getFullYear(),e.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("CurMonToDate"==i.LabelType)e=new Date(e.getFullYear(),e.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+Date.Today().ToString("dd MMM yyyy")+"'/>";else if("PrevMn"==i.LabelType)e=new Date(e.getFullYear(),e.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+e.AddMonths(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("PrevMnToDate"==i.LabelType)t="<Row ColID='TODATE' Value='"+e.AddMonths(-1).ToString("dd MMM yyyy")+"'/>",e=new Date(e.getFullYear(),e.getMonth(),1),t+="<Row ColID='FROMDATE' Value='"+e.AddMonths(-1).ToString("dd MMM yyyy")+"'/>";else if("PrevQtr"==i.LabelType){let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear(),3*(l-1),1),t="<Row ColID='FROMDATE' Value='"+e.AddMonths(-3).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddDays(-1).ToString("dd MMM yyyy")+"'/>"}else if("PrevQtrToDate"==i.LabelType){let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear(),3*(l-1),1),t="<Row ColID='FROMDATE' Value='"+e.AddMonths(-3).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddMonths(-3).ToString("dd MMM yyyy")+"'/>"}else if("LastYr"==i.LabelType)t="<Row ColID='FROMDATE' Value='"+s.AddYears(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+s.AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrToDate"==i.LabelType)e=new Date(e.getFullYear()-1,0,1),t="<Row ColID='FROMDATE' Value='"+s.AddYears(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrMn"==i.LabelType)e=new Date(e.getFullYear()-1,e.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrMnToDate"==i.LabelType)e=new Date(e.getFullYear()-1,e.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrQtr"==i.LabelType){let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear()-1,3*(l-1),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddMonths(3).AddDays(-1).ToString("dd MMM yyyy")+"'/>"}else if("LastYrQtrToDate"==i.LabelType){let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear()-1,3*(l-1),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'/>"}else if("WeekToDate"==i.LabelType){this.HeaderValuePostfix="WTD";let l=e.getDate()-e.getDay();e.setDate(l+1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+Date.Today().ToString("dd MMM yyyy")+"'/>"}else if("PrevWeek"==i.LabelType){this.HeaderValuePostfix="LWTD";let l=e.getDate()-e.getDay();e.setDate(l+1),t="<Row ColID='FROMDATE' Value='"+e.AddDays(-7).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddDays(-1).ToString("dd MMM yyyy")+"'/>"}return t}}class w{constructor(){this.dbl=0,this.IsDataReady=!1,this.breakSpaces=!1,this.Visible=!0,this.FontSize=12,this.FontFamily="Calibri",this.IsLink=!1,this._ImagePath="",this.ShowPercentage=!1,this.ShowImage=!1,this.ShowArrow=!1,this.txtSep=new B,this.txtValue=new B,this.txtPercent=new B}get ImagePath(){return this._ImagePath}set ImagePath(i){i!=this._ImagePath&&this._ImagePath!=i&&(this._ImagePath=i,this.ShowImage=!c.J0.IsEmpty(this._ImagePath))}SetSubFields(){this.txtLbl=new B,this.txtLbl.Text=this.Label,this.txtLbl.Row=this.Row,this.txtLbl.Column="0",this.txtLbl.ForeColor=this.ForeColor,this.txtLbl.Align="Left",this.txtSep.Text=" : ",this.txtSep.Row=this.Row,this.txtSep.Column="1",this.txtSep.ForeColor=this.ForeColor,this.txtValue.Text="",this.txtValue.Row=this.Row,this.txtValue.Column="2",this.txtValue.ForeColor=this.ForeColor,this.txtValue.Align="Right",this.txtValue.WzLbl=this,this.txtPercent.Text="",this.txtPercent.Row=this.Row,this.txtPercent.Column="3",this.txtPercent.ForeColor=this.ForeColor}}class B{constructor(){this.Percentage=0,this.FontSize=12,this.IsLink=!1,this.FontFamily="Calibri",this.Visible=!0,this.WzLbl=null}}class he extends V.g{constructor(i){super(),this.Chart=null,this.RefreshCalender=null,this.DisplayStartDate=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),this.EmployeeList=new re.G(0),this.dsData=null,this.SelectedEmpID=0,this.widget=i,this.HeaderLabels=[],this.EmployeeList.Code.TypeID=4,this.EmployeeList.Name.TypeID=1,this.EmployeeList.Code.Visible=this.EmployeeList.Name.Visible=!1,this.EmployeeList.Code.Column=0,this.EmployeeList.Name.Column=1,this.EmployeeList.Code.Visible=!0,this.EmployeeList.Name.Visible=!0,this.EmployeeList.Code.CCID=this.EmployeeList.Name.CCID=50051,this.EmployeeList.SelectionCallBack.Subscribe(this,"OnEmployeeChanged"),this.EmployeeList.t.Interval=200;let t=D.d.report.GetDataTable("RPT042",D.d.SessionManager.UserName);if(null!=t&&t.length>0&&(this.EmployeeList.SelectedValue=parseInt(t[0].NodeID)),26==i.TypeID){this.bgPresent="rgb(34, 177, 76)",this.bgSinglePunch="rgb(70, 230, 198)",this.bgAbsent="rgb(242, 97, 85)",this.bgHoliday="rgb(231, 204, 97)",this.bgWeeklyOff="rgb(180, 146, 99)";let e=new w;e.LabelType="Present",e.Label="Present",e.Value="0",e.ForeColor="#22B14C",this.HeaderLabels.push(e),e=new w,e.LabelType="SinglePunch",e.Label="Single Punch",e.Value="0",e.ForeColor="#46E6C6",this.HeaderLabels.push(e),e=new w,e.LabelType="Absent",e.Label="Absent",e.Value="0",e.ForeColor="#F26155",this.HeaderLabels.push(e),e=new w,e.LabelType="Holidays",e.Label="Holidays",e.Value="0",e.ForeColor="#E7CC61",this.HeaderLabels.push(e),e=new w,e.LabelType="WeeklyOff",e.Label="Weekly Off",e.Value="0",e.ForeColor="#B49263",this.HeaderLabels.push(e)}else if(27==i.TypeID){let e=new w;e.LabelType="TotalHours",e.Label="Total Hours",e.Value="0",e.ForeColor="Orange",this.HeaderLabels.push(e),e=new w,e.LabelType="UtilizedHours",e.Label="Utilized Hours",e.Value="0",e.ForeColor="Green",this.HeaderLabels.push(e),e=new w,e.LabelType="Un-Utilized Hours",e.Label="Un-Utilized Hours",e.Value="0",e.ForeColor="Red",this.HeaderLabels.push(e)}this.DisplayStartDate=new Date((new Date).getFullYear(),(new Date).getMonth(),1)}OnButtonClick(i){"PreviousMonth"==i.toString()?(this.DisplayStartDate=this.DisplayStartDate.AddMonths(-1),this.Refresh()):"NextMonth"==i.toString()&&(this.DisplayStartDate=this.DisplayStartDate.AddMonths(1),this.Refresh())}OnEmployeeChanged(i){this.Refresh()}Refresh(){var i=this;return(0,W.A)(function*(){i.SelectedEmpID=i.EmployeeList.Code.SelectedValue,i.dsData=yield i.SetQueryHRM(),null!=i.RefreshCalender&&i.RefreshCalender.Call(),i.widget.LoadingVisibility=!1})()}SetQueryHRM(){let i="";i="declare @Fr float,@To float,@EMPID bigint",i+=" set @Fr=convert(float,convert(datetime,'"+this.DisplayStartDate.ToString("dd MMM yyyy")+"'))",i+=" set @To=convert(float,convert(datetime,'"+this.DisplayStartDate.AddMonths(1).AddDays(1).ToString("dd MMM yyyy")+"'))",i+=" set @EMPID="+this.EmployeeList.SelectedValue;let t=this.widget.GetDimensionWhere("TDCC.dcCCNID"),e="";if(D.d.SessionManager.Preferences.ContainsKey("HolidaysBasedOn")&&""!=D.d.SessionManager.Preferences.HolidaysBasedOn){let l=D.d.SessionManager.Preferences.HolidaysBasedOn.split(",");for(let a=0;a<l.length;a++)""!=l[a]&&(parseInt(l[a]),e+=" AND EDCC.CCNID"+(parseInt(l[a])-5e4)+"=TDCC.dcCCNID"+(parseInt(l[a])-5e4))}let s=[];return s.push(this.widget.TypeID),s.push(e),s.push(i),s.push(t),s.push(D.d.SessionManager.LanguageID),D.d.report.GetWidgetHRM(s)}}var g=f(39107),j=f(4884),ue=f(62188),De=f(89211);class ce{constructor(){this.Decimals=0,this.Divider=1}}let J=(()=>{class A extends V.g{get TabularColumns(){return this.TabularDataObj.ReportColumns}constructor(){super(),this.PrintExportCallBack=new v.Yk,this.LoadingVisibility=!0,this.TabularDataObj=new ue.j,this.ShowGrid=!1,this.ShowGridOn=!1,this.ShowDropDown=!1,this.ShowPoint=0,this.IsWidgetChart=!1,this.ShowWidgetFilter=!1,this.HideGridTotal=!1,this.FromDate=new j.Lc(0),this.ToDate=new j.Lc(0),this.GrossTotalAppearance=new g.bA,this.GrossTotalAppearance_Data=new g.bA,this.RefreshAMChart=new v.Yk,this.IsStackChart=!1,this.objFormat=new g.yL,this.HeaderAppearance=new g.bA,this.NumberDataAppearance=new g.bA,this.dtStack=null,this.lstDrillFilter=new Array,this.WidgetCallsComplated=0,this.CurrentLevel=0,this.DrillBackVisible=!1,this.Is3D=new De.c,this.ChartDataColumns=[],this._ChartData=A.EmptyChartData,this.ClassName="RevenUChartViewModel",this.Chart=[],this.ChartTypes=new F.y$,this.ChartDimColumns=new F.y$}RevenUChartViewModel_1(t,e,s){if(this.Parent=t,this.Report=e,this.drChartDefn=s,this.Chart=[],this.ChartTypes=new F.y$(0),this.ChartTypes.Label="Chart Type",this.ChartTypes.LblWidth="80",this.ChartTypes.SelectionChangedCommand.Subscribe(this,"OnChartTypeChanged"),this.ChartTypes.Items.push(F._p.ComboBoxItems_2(D.d.GetResource("ChartType_Area"),"6")),this.ChartTypes.Items.push(F._p.ComboBoxItems_2(D.d.GetResource("ChartType_Bar"),"2")),this.ChartTypes.Items.push(F._p.ComboBoxItems_2(D.d.GetResource("ChartType_Column"),"3")),this.ChartTypes.Items.push(F._p.ComboBoxItems_2(D.d.GetResource("ChartType_Curve"),"10")),this.ChartTypes.Items.push(F._p.ComboBoxItems_2(D.d.GetResource("ChartType_CurveArea"),"11")),this.ChartTypes.Items.push(F._p.ComboBoxItems_2(D.d.GetResource("ChartType_Doughnut"),"5")),this.ChartTypes.Items.push(F._p.ComboBoxItems_2(D.d.GetResource("ChartType_Funnel"),"12")),this.ChartTypes.Items.push(F._p.ComboBoxItems_2(D.d.GetResource("ChartType_Line"),"4")),this.ChartTypes.Items.push(F._p.ComboBoxItems_2(D.d.GetResource("ChartType_Pie"),"1")),this.ChartTypes.Items.push(F._p.ComboBoxItems_2(D.d.GetResource("ChartType_Polar"),"15")),this.ChartTypes.Items.push(F._p.ComboBoxItems_2(D.d.GetResource("ChartType_Pyramid"),"16")),this.ChartTypes.Items.push(F._p.ComboBoxItems_2(D.d.GetResource("ChartType_Radar"),"17")),this.ChartTypes.SelectedValue=s.GraphType.toString(),this.Is3D.Label="3D",this.Is3D.CheckedChangedCommand.Subscribe(this,"OnChartTypeChanged"),null!=t.xOptions&&null!=c.VB.SelectSingleNode(t.xOptions.DocumentElement,"IsStackChart")&&(this.IsStackChart=!0),null==e){null==t.Parent.dsWidgetNames&&(t.Parent.dsWidgetNames=D.d.report.Widgets(3,0,"",0,1,!1,null,null)),this.FromDate.Label=D.d.GetResource("Reports_LblFromDate"),this.ToDate.Label=D.d.GetResource("Reports_LblToDate");let a=new Date(Date.Today().getFullYear(),D.d.SessionManager.AccountingFromMonth-1,1);a>Date.Today()&&(a=a.AddYears(-1)),this.FromDate.Date=a,this.ToDate.Date=a.AddYears(1).AddDays(-1)}this.ShowGrid=(0,E.yG0)(s.ShowGrid),this.NumSeriesColor=c.J0.StringIsNullOrEmpty(s.NumSeriesColor)?null:s.NumSeriesColor.toString().split(","),this.HideGridTotal=!(!c.J0.hasprop(s,"HideGridTot")||c.J0.IsEmpty(s.HideGridTot)||!(0,E.yG0)(s.HideGridTot))&&(0,E.yG0)(s.HideGridTot),null!=s.ShowPoint&&(this.ShowPoint=parseInt(s.ShowPoint)),this.TextFields=s.TextField.toString().split(","),this.NumericFields=s.NumericField.toString().split(","),this.NumFormula=new Array(this.NumericFields.length),this.ChartWidgetFilters=new Array(this.NumericFields.length),this.arrNumFormat=new Array(this.NumericFields.length);let l=null;null!=t.xOptions&&(l=c.VB.SelectNodes(t.xOptions.DocumentElement,"Chart/Num"));for(let a=0;a<this.NumFormula.length;a++)if(this.NumFormula[a]="",null!=l&&a<l.length){this.ChartWidgetFilters[a]=c.VB.SelectSingleNode(l[a],"WidgetFilter/TreeFilters");let d=c.VB.SelectSingleNode(l[a],"Formula");if(null!=d&&(this.NumFormula[a]=d.innerHTML,d.innerHTML.length>0)){let o=[],h=new P.PE;if(h.SetKeyWords("REPORT"),h.ParseFormula(this.NumFormula[a],o),10==o.length){let r=new ce;r.FormatText=o[8].tokenValue.toString().split("~")[0],r.FormatKey=o[6].tokenValue.toString().split("~")[0],r.Decimals=parseInt(o[4].tokenValue),"K"==r.FormatKey?r.Divider=1e3:"L"==r.FormatKey?r.Divider=1e5:"M"==r.FormatKey?r.Divider=1e6:"C"==r.FormatKey?r.Divider=1e7:"B"==r.FormatKey&&(r.Divider=1e9),this.arrNumFormat[a]=r}}}if(this.ChartDimColumns=new F.y$(0),this.ChartDimColumns.LblWidth="0",this.TextFieldsColumnSource=new Array(this.TextFields.length),this.NumericFieldsColumnSource=new Array(this.NumericFields.length),null!=e){this.IsWidgetChart=!1,this.ChartName=!t.ShowHeader||c.J0.StringIsNullOrEmpty(t.Header)?e.DisplayName:"",this.FilterName=e.FilterText.toString();for(let o=0;o<this.TextFields.length;o++)this.TextFieldsColumnSource[o]=e.ColumnSource.find(h=>h.ID==this.TextFields[o]);for(let o=0;o<this.NumericFields.length;o++)this.NumericFieldsColumnSource[o]=e.ColumnSource.find(h=>h.ID==this.NumericFields[o]),o<this.NumFormula.length&&(this.NumericFieldsColumnSource[o].DataFormat.NumberFormat=this.NumFormula[o]);let a=!1,d=e.ReportColumns.length;for(let o=0;o<d;o++){let h=e.ReportColumns[o];if(h.HeaderAppearance.IsVisible&&"FLOAT"!=h.ColumnType&&"INT"!=h.ColumnType&&(this.ChartDimColumns.Items.push(F._p.ComboBoxItems_2(h.HeaderText,h.ID)),!a&&"DATE"==h.ColumnType&&c.J0.IsEmpty(h.Formula))){a=!0;let r=h.Clone();r.ID=h.ID+"_Yr",r.HeaderText="Year-Wise",r.ColumnType="",r.Formula='DATENAME("yyyy",'+h.ID+")",this.ChartDimColumns.Items.push(F._p.ComboBoxItems_2(r.HeaderText,r.ID)),e.ReportColumns.push(r),e.ColumnSourceALL.push(r),r=h.Clone(),r.ID=h.ID+"_Mn",r.HeaderText="Month-Wise",r.ColumnType="",r.Formula='DATENAME("MMM-yy",'+h.ID+")",this.ChartDimColumns.Items.push(F._p.ComboBoxItems_2(r.HeaderText,r.ID)),e.ReportColumns.push(r),e.ColumnSourceALL.push(r),r=h.Clone(),r.ID=h.ID+"_Qtr",r.HeaderText="Quarter-Wise",r.ColumnType="",r.Formula='DATENAME("QUARTERLY",'+h.ID+")",this.ChartDimColumns.Items.push(F._p.ComboBoxItems_2(r.HeaderText,r.ID)),e.ReportColumns.push(r),e.ColumnSourceALL.push(r),o+=3}}e.Chart=this}else{this.IsWidgetChart=!0;let a=new N.D_;"YrWise"==this.TextFields[0]?(a.HeaderText="Year",this.FromDate.Date=this.FromDate.Date.AddYears(-t.PrevDataFilter)):"MnWise"==this.TextFields[0]?(a.HeaderText="Month",this.FromDate.Date=this.FromDate.Date.AddMonths(-t.PrevDataFilter)):"QtrWise"==this.TextFields[0]?(a.HeaderText="Quarter",this.FromDate.Date=this.FromDate.Date.AddMonths(3*-t.PrevDataFilter)):this.TextFields[0].startsWith("DIM_")&&(a.HeaderText="Name");let d=this.NumericFields.length>0?parseInt(this.NumericFields[0]):0;if(t.PrevData>0&&this.NumericFields.length>0){this.NumericFields=new Array(t.PrevData+1);for(let o=0;o<=t.PrevData;o++)this.NumericFields[o]=1==D.d.SessionManager.AccountingFromMonth?this.FromDate.Date.AddYears(-o).getFullYear().toString():this.FromDate.Date.AddYears(-o).getFullYear().toString()+"-"+((this.FromDate.Date.AddYears(-o).getFullYear()+1)%100).toString();this.Widgets=new Array(1)}else this.Widgets=new Array(this.NumericFields.length);a.ID=this.TextFields[0],this.TextFieldsColumnSource=[],this.TextFieldsColumnSource.push(a),this.NumericFieldsColumnSource=new Array(this.NumericFields.length);for(let o=0;o<this.NumericFields.length;o++){let h=new N.D_;if(t.PrevData>0)h.ID=this.NumericFields[o],h.HeaderText=this.NumericFields[o];else{h.ID="NUM_"+o;let u=t.Parent.dsWidgetNames.Tables[0].filter(T=>T.ID==this.NumericFields[o]);h.HeaderText=u.length>0?11==d||12==d||13==d||14==d||15==d||20==d?"Value":19==d?"Quantity":u[0].Name.toString():"WID-"+this.NumericFields[o]}if(h.ColumnType="FLOAT",h.DataFormat=new g.yL,h.width=110,h.DataFormat.DecimalsPoints=2,h.DataFormat.Commas="Millions"==D.d.SessionManager.Preferences.Commas?1:2,this.NumericFieldsColumnSource[o]=h,o<this.NumFormula.length&&(this.NumericFieldsColumnSource[o].DataFormat.NumberFormat=this.NumFormula[o]),t.PrevData>0&&o>0){this.NumericFieldsColumnSource[o].DataFormat.NumberFormat=this.NumericFieldsColumnSource[o-1].DataFormat.NumberFormat;continue}let r=new O;r.WidgetViewModel_2(this,t.PrevData>0?d:parseInt(this.NumericFields[o]),this.ChartWidgetFilters[o]),11==r.TypeID||12==r.TypeID||18==r.TypeID?(a.width=160,this.TextFields[0]=a.ID="AccountName",a.HeaderText="Account Name"):13==r.TypeID?(a.width=160,this.TextFields[0]=a.ID="ProductName",a.HeaderText="Product Name"):(14==r.TypeID||15==r.TypeID||19==r.TypeID||20==r.TypeID)&&(this.TextFields[0]=a.ID="Slab",a.HeaderText="Slab"),r.PrevData=t.PrevData,r.Groups=a.ID,this.Widgets[o]=r}}this.ChartDimColumns.Items.length>0&&(this.ChartDimColumns.SelectedValue=this.TextFields[0],this.ChartDimColumns.SelectionChangedCommand.Subscribe(this,"OnChartDimColumnsChange")),(this.ChartDimColumns.Items.length<=1||this.IsStackChart)&&(this.ChartDimColumns.Visible=!1),this.ShowGrid&&this.InitGrid()}InitGrid(){let t=new g.bA;this.HeaderAppearance.Alignment="Center",this.HeaderAppearance.FontFamilyName="Arial",this.HeaderAppearance.FontSize=12,this.HeaderAppearance.IsBold=!0,this.HeaderAppearance.BackColor="White",this.HeaderAppearance.ForeColor="Black",t.Alignment="Left",t.FontFamilyName="Arial",t.FontSize=12,t.BackColor="White",t.ForeColor="Black",this.NumberDataAppearance.Alignment="Right",this.NumberDataAppearance.FontFamilyName="Arial",this.NumberDataAppearance.FontSize=12,this.NumberDataAppearance.BackColor="White",this.NumberDataAppearance.ForeColor="Black",this.GrossTotalAppearance.IsBold=!0,this.GrossTotalAppearance.ForeColor="#FF000000",this.GrossTotalAppearance.BackColor="White",this.GrossTotalAppearance.FontFamilyName="Arial",this.GrossTotalAppearance_Data.IsBold=!0,this.GrossTotalAppearance_Data.ForeColor="#FF000000",this.GrossTotalAppearance_Data.BackColor="White",this.GrossTotalAppearance_Data.FontFamilyName="Arial",this.GrossTotalAppearance_Data.Alignment="Right",this.objFormat.DecimalsPoints=parseInt(D.d.SessionManager.Preferences.DecimalsinAmount),"Millions"==D.d.SessionManager.Preferences.Commas?this.objFormat.Commas=1:"Lakhs"==D.d.SessionManager.Preferences.Commas&&(this.objFormat.Commas=2),this.objFormat.DateType=D.d.SessionManager.Preferences["Date Format"];let e=new N.D_;e.gridLines=3,e.ID=this.TextFieldsColumnSource[0].ID,e.FieldName=this.TextFieldsColumnSource[0].ID,e.HeaderText=this.TextFieldsColumnSource[0].HeaderText,e.HeaderAppearance=this.HeaderAppearance,e.DataAppearance=t,e.HeaderHeight=22,e.width=.8*this.TextFieldsColumnSource[0].width,e.DataFormat=this.objFormat,e.ColumnType="STRING",this.TabularColumns.push(e),this.IsStackChart||this.NumericFieldsColumnSource.forEach(s=>{e=new N.D_,e.gridLines=3,e.ID=s.ID,e.FieldName=s.ID,e.HeaderText=s.HeaderText,e.HeaderAppearance=this.HeaderAppearance,e.DataAppearance=this.NumberDataAppearance,e.HeaderHeight=22,e.width=.8*s.width,e.DataFormat=this.objFormat,e.ColumnType="FLOAT",this.TabularColumns.push(e)})}OnButtonClick(t){if("DrillBack"==t){if(0==this.CurrentLevel)return;this.CurrentLevel--,this.lstDrillFilter.RemoveAt(this.lstDrillFilter.length-1),0==this.CurrentLevel&&(this.DrillBackVisible=!1),this.RefreshChart()}else if("WidgetFilterOK"==t){if(this.Parent.PrevData>0&&this.FromDate.Date.getFullYear()!=this.ToDate.Date.getFullYear())return void(this.DisplayMessage="Select From Date and To Date of same year");this.ShowWidgetFilter=!1,this.RefreshChart()}else"WidgetFilterCancel"==t?(this.ShowWidgetFilter=!1,this.RefreshChart()):"ShowGridOn"==t&&(this.ShowGridOn=!this.ShowGridOn)}LoadChartData(){this.ShowGrid&&this.TabularDataObj.Clear();let t,e,s,l=null,a=new x.D3;this.dtStack=null,this.IsStackChart||this.lstDrillFilter.forEach(n=>{n.split("=")}),0!=this.Report.lstGroup.filter(n=>"Summary"==n.DisplayMode).length&&null!=this.Report.ReportSummaryData?(t=e=this.Report.ReportSummaryData,this.lstDrillFilter.length>0&&(t=e=this.Report.ReportSummaryData,this.lstDrillFilter.forEach(n=>{let C=n.split("=");t=t.filter(I=>I[C[0]]==C[1])})),s=t.ToTable(!0,[this.TextFields[this.CurrentLevel]])):(t=e=this.Report.ReportData,this.lstDrillFilter.length>0&&this.lstDrillFilter.forEach(n=>{let C=n.split("=");t=t.filter(I=>I[C[0]]==C[1])}),s=t.ToTable(!0,[this.TextFields[this.CurrentLevel]])),null!=this.TabularColumns&&this.TabularColumns.length>0&&this.TabularColumns[0].HeaderText!=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText&&(this.TabularColumns[0].HeaderText=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText,this.TabularDataObj.RefreshColumns());let o=[],h=[];if(h.push(this.TextFieldsColumnSource[this.CurrentLevel].HeaderText),this.IsStackChart){this.dtStack_C0=this.TextFields[1],this.dtStack=t.ToTable(!0,[this.dtStack_C0]);for(let n=this.TabularColumns.length-1;n>0;n--)this.TabularColumns.RemoveAt(n);for(let n=0;n<this.dtStack.length;n++)if(h.push(c.J0.String(this.dtStack[n][this.dtStack_C0])),null!=this.TabularColumns){let C=new N.D_;C.gridLines=3,C.ID=C.FieldName=C.HeaderText=c.J0.String(this.dtStack[n][this.dtStack_C0]),C.HeaderAppearance=this.HeaderAppearance,C.DataAppearance=this.NumberDataAppearance,C.HeaderHeight=22,C.width=.8*this.NumericFieldsColumnSource[0].width,C.DataFormat=this.objFormat,C.ColumnType="FLOAT",this.TabularColumns.push(C)}null!=this.TabularColumns&&this.TabularDataObj.RefreshColumns()}else for(let n=0;n<this.NumericFields.length;n++)h.push(this.NumericFieldsColumnSource[n].HeaderText);let r=0,m=this.IsStackChart?new Array(this.dtStack.length).fill(0):new Array(this.NumericFieldsColumnSource.length).fill(0);this.IsStackChart&&(this.CurrentLevel=0);for(let n=0;n<s.length;n++){let C=s[n];t=e.filter(this.IsStackChart?S=>S[this.TextFields[0]]==C[this.TextFields[0]]:S=>S[this.TextFields[this.CurrentLevel]]==C[this.TextFields[this.CurrentLevel]]);let I=new g.DK,y=new g.DK;M.ReportViewModel.SetCellValue(C[this.TextFields[this.CurrentLevel]],this.TextFieldsColumnSource[this.CurrentLevel].DataFormat,this.TextFieldsColumnSource[this.CurrentLevel].ColumnType,-1,I,this.TextFieldsColumnSource[this.CurrentLevel].ID);let b={};if(b[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]=I.Text,this.ShowGrid&&!this.HideGridTotal&&(l=new g.Ji(this.TabularColumns.length),l.Height=22,l.Cells[0]=I),this.IsStackChart){let S=t.filter(R=>!0);for(let R=0;R<this.dtStack.length;R++){t=S.filter(H=>H[this.TextFields[1]]==this.dtStack[R][this.dtStack_C0].toString());let L=0;t.forEach(H=>{!c.J0.IsEmpty(H[this.NumericFields[0]])&&H[this.NumericFields[0]].toString().length>0&&(L+=parseFloat(H[this.NumericFields[0]]))}),m[R]+=L,h.Contains(this.dtStack[R][this.dtStack_C0].toString())&&(b[this.dtStack[R][this.dtStack_C0].toString()]=L),0==R&&M.ReportViewModel.SetCellValue(L,this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,-1,y,this.NumericFieldsColumnSource[0].ID),this.ShowGrid&&M.ReportViewModel.SetCellValue(L,this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,-1,l.Cells[R+1],this.NumericFieldsColumnSource[0].ID)}}else for(let S=0;S<this.NumericFields.length;S++){let R=0;t.forEach(L=>{!c.J0.IsEmpty(L[this.NumericFields[S]])&&L[this.NumericFields[S]].toString().length>0&&(R+=parseFloat(L[this.NumericFields[S]]))}),m[S]+=R,b[this.NumericFieldsColumnSource[S].HeaderText]=R,0==S&&M.ReportViewModel.SetCellValue(R,this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,-1,y,this.NumericFieldsColumnSource[0].ID),this.ShowGrid&&M.ReportViewModel.SetCellValue(R,this.NumericFieldsColumnSource[S].DataFormat,this.NumericFieldsColumnSource[S].ColumnType,-1,l.Cells[S+1],this.NumericFieldsColumnSource[S].ID)}if(o.push(b),r++,this.ShowGrid&&(this.Report.IsDefaultSortColumnExists||this.TabularDataObj.addRow(l),a.push(b,l)),!this.Report.IsDefaultSortColumnExists&&this.Report.TopRecords>=0&&r==this.Report.TopRecords)break}if(this.Report.IsDefaultSortColumnExists){var p=this.NumericFieldsColumnSource.find(n=>n.ID==this.Report.Preferences.DefaultSortColumn);if(p?o.sort("DESC"==this.Report.Preferences.DefaultSortOrder?(n,C)=>n[p.HeaderText]<C[p.HeaderText]?1:-1:(n,C)=>n[p.HeaderText]>C[p.HeaderText]?1:-1):Logger.DebugLog('Default Sort Column "'+this.Report.Preferences.DefaultSortColumn+'" can not be applied to chart'),this.ShowGrid&&this.TabularDataObj.Clear(),m[0]=0,this.Report.TopRecords>0)for(r=o.length-1;r>=this.Report.TopRecords;r--)o.Remove(o[r]);if(this.ShowGrid){let n;o.forEach(C=>{null!=C[this.NumericFieldsColumnSource[0].HeaderText]&&(n=c.J0.Double(C[this.NumericFieldsColumnSource[0].HeaderText]),m[0]+=n),this.TabularDataObj.addRow(a.GetValue(C))})}}if(this.ChartData=o,this.ChartDataColumns=h,this.RefreshAMChart.Call(),0==this.ChartData.length&&this.ChartData.push({}),this.ShowGrid){if(l=new g.Ji(this.TabularColumns.length),l.Height=24,l.Cells[0].IsNormal=!1,l.Cells[0].CellAppearance=this.GrossTotalAppearance,l.Cells[0].Text="Total",this.IsStackChart)for(let n=1;n<this.TabularColumns.length;n++)l.Cells[n].IsNormal=!1,l.Cells[n].CellAppearance=this.GrossTotalAppearance_Data,this.Report.SetCellValue(m[n-1],this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,l.Cells[n],this.NumericFieldsColumnSource[0].ID);else for(let n=0;n<this.NumericFields.length;n++)l.Cells[n+1].IsNormal=!1,l.Cells[n+1].CellAppearance=this.GrossTotalAppearance_Data,this.Report.SetCellValue(m[n],this.NumericFieldsColumnSource[n].DataFormat,this.NumericFieldsColumnSource[n].ColumnType,l.Cells[n+1],this.NumericFieldsColumnSource[n].ID);this.TabularDataObj.addRow(l)}}LoadChartDataByRows(){this.ShowGrid&&this.TabularDataObj.Clear();var t=this.Report.Data.filter(T=>T.Visible&&(T.Type==g.QS.Detail||T.Type==g.QS.BalanceBF||T.Type==g.QS.GrossTotal)),e=parseInt(t.Compute("max","LevelNo")),s=t.filter(T=>T.LevelNo==e);let l=new Array(this.TextFields.length).fill(0);for(let T=0;T<this.TextFields.length;T++){if(null==(a=this.Report.ReportColumns.find(m=>m.ID==this.TextFields[T])))return void Logger.ErrorLog("TextFields["+T+"] not found");l[T]=this.Report.ReportColumns.indexOf(a)}let d=new Array(this.NumericFields.length).fill(0);for(let T=0;T<this.NumericFields.length;T++){var a;if(null==(a=this.Report.ReportColumns.find(p=>p.ID==this.NumericFields[T])))return void Logger.ErrorLog("NumericFields["+T+"] not found");d[T]=this.Report.ReportColumns.indexOf(a)}let o=[],h=[];h.push(this.TextFieldsColumnSource[0].HeaderText);for(let T=0;T<this.NumericFields.length;T++)h.push(this.NumericFieldsColumnSource[T].HeaderText);let r=0,u=0;for(let T=0;T<s.length;T++){let m=s[T],p=0;null!=m.Cells[d[0]].Value&&(p=parseFloat(m.Cells[d[0]].Value)),u+=p;let n=new g.DK,C=new g.DK;M.ReportViewModel.SetCellValue(m.Cells[l[0]].Value,this.TextFieldsColumnSource[0].DataFormat,this.TextFieldsColumnSource[0].ColumnType,-1,n,this.TextFieldsColumnSource[0].ID),M.ReportViewModel.SetCellValue(p,this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,-1,C,this.NumericFieldsColumnSource[0].ID);let I={};I[this.TextFieldsColumnSource[0].HeaderText]=n.Text;for(let y=0;y<this.NumericFields.length;y++)try{null!=m.Cells[d[y]].Value&&(I[this.NumericFieldsColumnSource[y].HeaderText]=m.Cells[d[y]].Value)}catch{}if(o.push(I),r++,this.ShowGrid){let y=new g.Ji(this.TabularColumns.length);y.Height=22,y.Cells[0]=n,y.Cells[1]=C,this.Report.IsDefaultSortColumnExists||this.TabularDataObj.addRow(y)}if(!this.Report.IsDefaultSortColumnExists&&this.Report.TopRecords>=0&&r==this.Report.TopRecords)break}if(this.ChartData=o,this.ChartDataColumns=h,this.RefreshAMChart.Call(),this.ShowGrid&&!this.HideGridTotal){let T=new g.Ji(this.TabularColumns.length);T.Height=24,T.Cells[0].IsNormal=!1,T.Cells[0].CellAppearance=this.GrossTotalAppearance,T.Cells[0].Text="Total",T.Cells[1].IsNormal=!1,T.Cells[1].CellAppearance=this.GrossTotalAppearance_Data,this.Report.SetCellValue(u,this.TabularColumns[1].DataFormat,this.TabularColumns[1].ColumnType,T.Cells[1],this.TabularColumns[1].ID),this.TabularDataObj.addRow(T)}}LoadChartDataForWidget(){if(this.ShowGrid&&this.TabularDataObj.Clear(),this.ChartData=null,this.Parent.PrevData>0){let t=new Date(this.FromDate.Date.getFullYear(),D.d.SessionManager.AccountingFromMonth-1,1);if(t>this.FromDate.Date&&(t=t.AddYears(-1)),this.ToDate.Date>t.AddYears(1).AddDays(-1)||"YrWise"==this.TextFields[0]||0==this.NumericFields.length)return;for(let e=0;e<=this.Parent.PrevData;e++)this.NumericFields[e]=1==D.d.SessionManager.AccountingFromMonth?this.FromDate.Date.AddYears(-e).getFullYear().toString():this.FromDate.Date.AddYears(-e).getFullYear().toString()+"-"+((this.FromDate.Date.AddYears(-e).getFullYear()+1)%100).toString(),this.NumericFieldsColumnSource[e].ID=this.NumericFields[e],this.NumericFieldsColumnSource[e].HeaderText=this.NumericFields[e],this.TabularColumns[e+1].HeaderText=this.NumericFields[e];this.TabularColumns[0].HeaderText=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText,this.TabularDataObj.RefreshColumns()}this.WidgetCallsComplated=0,this.widgetds=new Array(this.Widgets.length);for(let t=0;t<this.Widgets.length;t++)this.widgetds[t]=this.Widgets[t].SetValue(this.Widgets[t].Header,t)}WidgetCallBack(t,e){this.widgetds[t]=e,this.WidgetCallsComplated++,this.WidgetCallsComplated==this.Widgets.length&&this.LoadChartDataForWidgetCallBack(this.widgetds)}LoadChartDataForWidgetCallBack(t){this.LoadingVisibility=!1;let s,l,o,e=null,a=[],d=[];d.push(this.TextFieldsColumnSource[this.CurrentLevel].HeaderText);for(let u=0;u<this.NumericFields.length;u++)d.push(this.NumericFieldsColumnSource[u].HeaderText);if("MnWise"==this.TextFields[0])for(d.push("Mn"),d.push("Yr"),o=new Date(this.FromDate.Date.getFullYear(),this.FromDate.Date.getMonth(),1);o<=this.ToDate.Date;)s={},s.Mn=o.getMonth(),s.Yr=o.getFullYear(),s[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]=this.FromDate.Date.getFullYear()==this.ToDate.Date.getFullYear()||this.Parent.PrevData>0?o.ToString("MMM"):o.ToString("MMM-yy"),a.push(s),o=o.AddMonths(1);else if("QtrWise"==this.TextFields[0]){d.push("Mn"),d.push("Yr");let u=new Date(this.FromDate.Date.getFullYear(),D.d.SessionManager.AccountingFromMonth-1,1);u>this.FromDate.Date&&(u=u.AddYears(-1));let T="",m=1,p=u.getFullYear();for(;u.AddMonths(3)<=this.FromDate.Date;)m++,p=u.getFullYear(),u=u.AddMonths(3);for(0==this.Parent.PrevData&&(T=1==D.d.SessionManager.AccountingFromMonth?u.getFullYear().toString():u.iMonth()>=D.d.SessionManager.AccountingFromMonth?u.getFullYear().toString()+"-"+((u.getFullYear()+1)%100).toString():(u.getFullYear()-1).toString()+"-"+(u.getFullYear()%100).toString(),T=" "+T),s={},s.Mn=u.getMonth(),s.Yr=u.getFullYear(),s[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]="Q"+m+T,a.push(s);u.AddMonths(3)<=this.ToDate.Date;)m++,5==m&&(m=1),u=u.AddMonths(3),0==this.Parent.PrevData&&(T=1==D.d.SessionManager.AccountingFromMonth?u.getFullYear().toString():u.iMonth()>=D.d.SessionManager.AccountingFromMonth?u.getFullYear().toString()+"-"+((u.getFullYear()+1)%100).toString():(u.getFullYear()-1).toString()+"-"+(u.getFullYear()%100).toString(),T=" "+T),s={},s.Mn=u.getMonth(),s.Yr=u.getFullYear(),s[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]="Q"+m+T,a.push(s)}else if("YrWise"==this.TextFields[0])for(d.push("Yr"),o=new Date(this.FromDate.Date.getFullYear(),this.FromDate.Date.getMonth(),1);o<=this.ToDate.Date;)s={},s.Yr=o.getFullYear(),s[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]=o.getFullYear(),a.push(s),o=o.AddYears(1);else this.TextFields[0].startsWith("DIM_");if(11==this.Widgets[0].TypeID||12==this.Widgets[0].TypeID||13==this.Widgets[0].TypeID||14==this.Widgets[0].TypeID||15==this.Widgets[0].TypeID||18==this.Widgets[0].TypeID||19==this.Widgets[0].TypeID||20==this.Widgets[0].TypeID){let u;t[0].length>0&&(u=Object.keys(t[0][0])[0]),t[0].forEach(T=>{s={},s[d[0]]=T[u].toString(),s[d[1]]=parseFloat(T.Balance),a.push(s)})}else{let T=0;if(this.Parent.PrevData>0){let m;if(T=this.Widgets[0].Header.dbl,t[0].Rows.forEach(p=>{"MnWise"==this.TextFields[0]?l=a.filter(n=>n.Mn==p.Mn):"QtrWise"==this.TextFields[0]&&(l=a.filter(n=>n.Mn<=p.Mn&&n.Mn+3>=p.Mn)),m=1!=D.d.SessionManager.AccountingFromMonth?parseInt(p.Mn)>=D.d.SessionManager.AccountingFromMonth?p.Yr.toString()+"-"+((parseInt(p.Yr)+1)%100).toString():(parseInt(p.Yr)-1).toString()+"-"+(parseInt(p.Yr)%100).toString():p.Yr.toString(),this.Widgets[0].IncludeOpening?T+=parseFloat(p.Balance):l.length>0&&(T=null!=l[0][m]?parseFloat(p.Balance)+parseFloat(l[0][m]):parseFloat(p.Balance)),l.length>0&&(l[0][m]=T)}),this.Widgets[0].IncludeOpening)for(let p=0;p<a.length;p++){s=a[p];for(let n=this.NumericFields.length-1;n>=0;n--)null==s[this.NumericFields[n]]&&(s[this.NumericFields[n]]=0==p?n==this.NumericFields.length-1?T:a[a.length-1][this.NumericFields[n+1]]:a[p-1][this.NumericFields[n]])}}else for(let m=0;m<this.Widgets.length;m++)if(T=this.Widgets[m].Header.dbl,t[m].forEach(p=>{"MnWise"==this.TextFields[0]?l=a.filter(n=>n.Yr==p.Yr&&n.Mn==p.Mn):"QtrWise"==this.TextFields[0]?l=a.filter(n=>n.Yr==p.Yr&&n.Mn<=p.Mn&&n.Mn+3>=p.Mn):"YrWise"==this.TextFields[0]?l=a.filter(n=>n.Yr==p.Yr):this.TextFields[0].startsWith("DIM_")&&(l=a.filter(n=>n.Name==p.Name.toString())),0==l.length&&this.TextFields[0].startsWith("DIM_")&&(s={},s.Name=p.Name.toString(),a.push(s),l=[],l.push(s)),this.Widgets[m].IncludeOpening?T+=parseFloat(p.Balance):l.length>0&&(T=null!=l[0][this.NumericFieldsColumnSource[m].HeaderText]?parseFloat(p.Balance)+parseFloat(l[0][this.NumericFieldsColumnSource[m].HeaderText]):parseFloat(p.Balance)),l.length>0&&(l[0][this.NumericFieldsColumnSource[m].HeaderText]=T)}),this.Widgets[m].IncludeOpening)for(let p=0;p<a.length;p++)s=a[p],null==s[this.NumericFieldsColumnSource[m].HeaderText]&&(s[this.NumericFieldsColumnSource[m].HeaderText]=0==p?T:a[p-1][this.NumericFieldsColumnSource[m].HeaderText])}a.forEach(u=>{for(let T=0;T<this.NumericFields.length;T++)u[d[T+1]]||(u[d[T+1]]=0)}),d.Contains("Mn")&&d.Remove("Mn"),d.Contains("Yr")&&d.Remove("Yr"),null!=this.TabularColumns&&this.TabularColumns.length>0&&this.TabularColumns[0].HeaderText!=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText&&(this.TabularColumns[0].HeaderText=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText,this.TabularDataObj.RefreshColumns());let r=new Array(this.NumericFieldsColumnSource.length).fill(0);if(this.ShowGrid&&(a.forEach(u=>{let T=new g.DK;new g.DK,M.ReportViewModel.SetCellValue(u[d[0]],this.TextFieldsColumnSource[this.CurrentLevel].DataFormat,this.TextFieldsColumnSource[this.CurrentLevel].ColumnType,-1,T,this.TextFieldsColumnSource[this.CurrentLevel].ID),e=new g.Ji(this.TabularColumns.length),e.Height=22,e.Cells[0]=T;for(let p=0;p<this.NumericFields.length;p++)this.Parent.PrevData>0?this.Widgets[0].IncludeOpening?r[p]=parseFloat(u[d[p+1]]):r[p]+=parseFloat(u[d[p+1]]):this.Widgets[p].IncludeOpening?r[p]=parseFloat(u[d[p+1]]):r[p]+=parseFloat(u[d[p+1]]),M.ReportViewModel.SetCellValue(u[d[p+1]],this.NumericFieldsColumnSource[p].DataFormat,this.NumericFieldsColumnSource[p].ColumnType,-1,e.Cells[p+1],this.NumericFieldsColumnSource[p].ID);this.TabularDataObj.addRow(e)}),!this.HideGridTotal)){e=new g.Ji(this.TabularColumns.length),e.Height=24,e.Cells[0].IsNormal=!1,e.Cells[0].CellAppearance=this.GrossTotalAppearance,e.Cells[0].Text="Total";for(let u=0;u<this.NumericFields.length;u++)e.Cells[u+1].IsNormal=!1,e.Cells[u+1].CellAppearance=this.GrossTotalAppearance_Data,M.ReportViewModel.SetCellValue(r[u],this.NumericFieldsColumnSource[u].DataFormat,this.NumericFieldsColumnSource[u].ColumnType,-1,e.Cells[u+1],this.NumericFieldsColumnSource[u].ID);this.TabularDataObj.addRow(e);for(let u=0;u<this.NumericFields.length;u++)e.Cells[u+1].IsNormal=!1,e.Cells[u+1].CellAppearance=this.GrossTotalAppearance_Data,M.ReportViewModel.SetCellValue(r[u],this.NumericFieldsColumnSource[u].DataFormat,this.NumericFieldsColumnSource[u].ColumnType,-1,e.Cells[u+1],this.NumericFieldsColumnSource[u].ID);this.TabularDataObj.addRow(e)}this.ChartData=a,this.ChartDataColumns=d,this.RefreshAMChart.Call(),0==this.ChartData.length&&this.ChartData.push({})}OnChartTypeChanged(t){!c.J0.IsEmpty(this.ChartTypes.SelectedValue)&&-1!=c.J0.Int(this.ChartTypes.SelectedValue)&&this.RefreshAMChart.Call()}OnChartDimColumnsChange(t){this.TextFields[0]=this.ChartDimColumns.SelectedValue,this.TextFieldsColumnSource[0]=this.Report.ColumnSource.find(e=>e.ID==this.TextFields[0]),this.RefreshChart()}RefreshChart(){this.IsWidgetChart?(this.LoadingVisibility=!0,this.LoadChartDataForWidget()):(null!=this.Report.ReportData&&0!=this.Report.ReportData.length?(this.LoadChartData(),this.Report.ReportViewType=N.Zv.DashBoard):this.Report.StaticReportType>0&&(this.LoadChartDataByRows(),this.Report.ReportViewType=N.Zv.DashBoard),this.Report.FilterText.forEach(t=>{null!=t.Text&&(this.ChartName=this.ChartName+" - "+t.Label+" : "+t.Text)})),this.TabularDataObj.Width=0,this.ShowGrid&&this.TabularDataObj.ReportColumns.forEach(t=>{t.HeaderAppearance.IsVisible&&(this.TabularDataObj.Width+=t.width)})}static{this.EmptyChartData=[]}static RevenUChartViewModel(){A.EmptyChartData.push({Name:"",Value:0})}get ChartData(){return this._ChartData}set ChartData(t){null!=t&&null!=this.arrNumFormat.find(e=>null!=e)&&t.forEach(e=>{if(this.IsStackChart)for(let s=0;s<this.dtStack.length;s++)null!=this.arrNumFormat[0]&&this.arrNumFormat[0].Divider>1&&(e[this.dtStack[s][this.dtStack_C0].toString()]=parseFloat(e[this.dtStack[s][this.dtStack_C0].toString()])/this.arrNumFormat[0].Divider);else for(let s=0;s<this.NumericFieldsColumnSource.length;s++)null!=this.arrNumFormat[s]&&this.arrNumFormat[s].Divider>1&&(e[this.NumericFieldsColumnSource[s].HeaderText]=parseFloat(e[this.NumericFieldsColumnSource[s].HeaderText])/this.arrNumFormat[s].Divider)}),t!=this._ChartData&&(this._ChartData=t)}DrillDownChartFX(t){if(this.IsStackChart||this.CurrentLevel+1>=this.TextFields.length)return;this.CurrentLevel++,this.DrillBackVisible=!0;let e=this.ChartData[t][this.TextFieldsColumnSource[this.CurrentLevel-1].HeaderText].toString(),s=!1;0!=this.Report.lstGroup.filter(l=>"Summary"==l.DisplayMode).length&&null!=this.Report.ReportSummaryData?this.Report.ReportSummaryDataColumns.Contains(this.TextFields[this.CurrentLevel-1])&&"date"==this.Report.ColumnSourceALL.find(l=>l.ID==this.TextFields[this.CurrentLevel-1]).ColumnType.toLowerCase()&&(s=!0):this.Report.ReportDataColumns.Contains(this.TextFields[this.CurrentLevel-1])&&"date"==this.Report.ColumnSourceALL.find(l=>l.ID==this.TextFields[this.CurrentLevel-1]).ColumnType.toLowerCase()&&(s=!0),this.lstDrillFilter.push(s?this.TextFields[this.CurrentLevel-1]+"= convert('"+this.ChartData[t][this.TextFields[this.CurrentLevel-1]+"_DATE"]+"',System.DateTime)":this.TextFields[this.CurrentLevel-1]+"="+e),this.RefreshChart()}}return A})();var U=f(76570),de=f(53884),K=f(83682),pe=f(54119);class Te extends V.g{constructor(i){super(),this.StaticFields=new Array,this.DocsArrowData=new Array,this.FavouriteID=0,this.BgColor="#f9f9f9",this.ClassName="DashFavoritesViewModel",this.DisplayName=D.d.GetResource("Favorite"),this.Column1="0.25*",this.Column2="0.25*",this.Column3="0.25*",this.Column4="0.25*",this.Title=this.DisplayName,this.FavouriteID=i,D.d.admin.GetFavorite("VIEW",i,!0).subscribe(t=>{this.ds=t,this.onLoad()},t=>{}),Logger.InfoLog("DashFavoritesViewModel::Leaving DashFavoritesViewModel")}onClick(i){let t=new G.aF;if(i instanceof U.B){let e=i;if("1"==e.isReport.toString())if("0"==e.Featureactiontypeid)D.d.page.ShowLoading=!1,alert("Report Not Assigned.");else{let s=new M.ReportViewModel;s.ReportViewModel_1(parseInt(e.DBColumnName)),0==s.ReturnType&&D.d.page.addNewTab({component:de.ReportViewComponent,params:{obj:s}})}else{t.FeatureActionID=parseInt(e.DBColumnName),t.ScreenName=e.ScreenName,t.FeatureID=e.FeatureID,(50==t.FeatureID||"31"==e.Featureactiontypeid||"30"==e.Featureactiontypeid||"215"==e.Featureactiontypeid&&(2==e.FeatureID||3==e.FeatureID))&&(t.FeatureActionTypeID=parseInt(e.Featureactiontypeid)),e.FeatureID>5e4?(t.ScreenType=7,t.FeatureActionTypeID="31"!=e.Featureactiontypeid&&"30"!=e.Featureactiontypeid?2:parseInt(e.Featureactiontypeid)):e.FeatureID>4e4&&(t.ISDoctype=e.DBColumnID);let s={};K.RibbonExtViewModel.OncmdLoadPage(t,s).then(l=>{if(!s.component)return;let a;"FeatureActionID"==s.basedon?a=D.d.page.tabs.find(d=>d.instance instanceof s.component&&d.instance.FeatureActionID==t.FeatureActionID):"CostCenterID"==s.basedon?a=D.d.page.tabs.find(d=>d.instance instanceof s.component&&d.instance.CostCenterID==t.FeatureID):"Unique"==s.basedon&&(a=D.d.page.tabs.find(d=>d.instance instanceof s.component)),a?(D.d.page.tabs.map(d=>d.active=!1),a.active=!0):(s.title=t.ScreenName,D.d.page.addNewTab(s))})}}else for(let e=0;e<this.StaticFields.length;e++)if(this.oText=this.StaticFields[e],this.oText.DBColumnName==i.toString()){if("1"==this.oText.isReport.toString()){(new M.ReportViewModel).ReportViewModel_1(parseInt(this.oText.DBColumnName))}else t.FeatureActionID=parseInt(this.oText.DBColumnName),t.ScreenName=this.oText.ScreenName,t.FeatureID=this.oText.FeatureID,("31"==this.oText.Featureactiontypeid||"30"==this.oText.Featureactiontypeid)&&(t.FeatureActionTypeID=parseInt(this.oText.Featureactiontypeid)),this.oText.FeatureID>5e4&&(t.ScreenType=7,t.FeatureActionTypeID="31"!=this.oText.Featureactiontypeid&&"30"!=this.oText.Featureactiontypeid?2:parseInt(this.oText.Featureactiontypeid)),K.RibbonExtViewModel.OncmdLoadPage(t,void 0);break}}onLoad(){Logger.InfoLog("DashFavoritesViewModel::Entering onLoad");let t,e=-1;try{if(null!=this.ds&&this.ds.Tables[0].length>0&&(this.ds.Tables[0]=D.d.IsMobile?[...new Map(this.ds.Tables[0].map(s=>[s.FeatureactionID,s])).values()].filter(s=>1==s.ShowInMobile):[...new Map(this.ds.Tables[0].map(s=>[s.FeatureactionID,s])).values()].filter(s=>1==s.ShowInWeb),this.ds.Tables.length>1&&this.ds.Tables[1].length>0&&(e=parseInt(this.ds.Tables[1][0].MaxRows))),null!=this.ds&&this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&c.J0.String(this.ds.Tables[2][0].OptionsXML).length>0){let s=new c.VB;s.LoadXml(this.ds.Tables[2][0].OptionsXML.toString()),this.BgColor=c.J0.rgbColor(c.VB.SelectSingleNodeText(s.DocumentElement,"BgColor")),"#FFFFFF"==this.BgColor&&(this.BgColor="#f9f9f9")}for(let s=0;s<=e;s++)for(let l=0;l<4;l++)t=this.ds.Tables[0].filter(a=>a.RowNo==s&&a.ColumnNo==l),t.length>0&&(this.oText=new U.B,this.oText.Label=c.J0.String(t[0].DisplayName),this.oText.DBColumnName=t[0].FeatureactionID.toString(),this.oText.SmallImage="/assets/images/menu/"+c.J0.String(t[0].ImagePath).replace("/","''"),this.oText.Row=s+1,this.oText.Column=l,this.oText.ClickCommand.Subscribe(this,"onClick"),this.oText.ScreenName=c.J0.String(t[0].ScreenName),this.oText.ShortcutKey=c.J0.String(t[0].ShortCutKey),c.J0.IsEmpty(t[0].FeatureID)||(this.oText.FeatureID=parseInt(t[0].FeatureID)),this.oText.KeyTip=c.J0.String(t[0].ButtonKeyTip),this.oText.isReport=c.J0.String(t[0].isReport),this.oText.Featureactiontypeid=c.J0.String(t[0].FeatureActionTypeID),this.oText.Data=c.J0.String(t[0].Link),this.oText.WebIcon=pe.FavoritesViewModel.GetIcon(this.oText),c.J0.IsEmpty(t[0].DocumentType)||(this.oText.DBColumnID=parseInt(t[0].DocumentType)),this.StaticFields.push(this.oText));if(this.StaticFields.length>0){let s=this.StaticFields.Compute("max","Column"),l=0;l=c.J0.Int(s),l>=0&&l<4&&(this.Column1=(100/(l+1)).ToString("N2")+"%",this.Column2=l<1?"0.0*":this.Column1,this.Column3=l<2?"0.0*":this.Column1,this.Column4=l<3?"0.0*":this.Column1),this.StaticFields.filter(a=>!c.J0.IsEmpty(a.Data)).forEach(a=>{a.Data.split(",").forEach(d=>{var o=this.StaticFields.find(h=>h.FeatureID==parseInt(d));if(o){let h=new Ce;h.Source=a,h.Destination=o,this.DocsArrowData.push(h)}})})}}catch(s){Logger.ErrorLog("DashFavoritesViewModel::onLoad",s)}Logger.InfoLog("DashFavoritesViewModel::Leaving onLoad")}}class Ce{constructor(){this.X1=0,this.X2=0,this.Y1=0,this.Y2=0,this.Stroke="Gray"}}var me=f(78241),fe=f(86084),X=f(63239),ye=f(97538),Ie=f(39290);class ge extends V.g{constructor(i){super(),this.TypeID=0,this.UnApprovedDocumentsVisible=!1,this.DocumentDraftsVisible=!1,this.PDCDocumentsVisible=!1,this.NotifEventsVisible=!1,this.DepreciationPostingVisible=!1,this.RejectedDocumentsVisible=!1,this.DocsToApproveGridVisible=!1,this.CalendarVisible=!1,this.ClassName="DashAddOnsViewModel",this.TypeID=i,1==i?(this.UnApprovedDocumentsVisible=!0,this.UnApprovedDocuments=new me.UnAppDocumentsViewModel,this.UnApprovedDocuments.DocumentsGrid.Height=void 0):2==i?(this.DocumentDraftsVisible=!0,this.DocumentDrafts=new fe.DocumentDraftsViewModel(this,1),setTimeout(()=>{this.DocumentDrafts.FillGrid()},500),this.DocumentDrafts.Grid.Height=void 0):3==i?(this.PDCDocumentsVisible=!0,this.PDCDocuments=new X.DashBoardNotifViewModel(4),this.PDCDocuments.Grid.Height=void 0):4==i?(this.NotifEventsVisible=!0,this.NotifEvents=new X.DashBoardNotifViewModel(2),this.NotifEvents.Grid.Height=void 0):5==i?(this.DepreciationPostingVisible=!0,this.DepreciationPosting=new ye.PostDepreciationViewModel("",!0,!1)):7==i?(this.DocsToApproveGridVisible=!0,this.DocsToApprove=new Ie.i):8==i&&this.LoadCalendar()}LoadCalendar(){var i=this;return(0,W.A)(function*(){const{RCalenderViewModel:t}=yield Promise.resolve().then(f.bind(f,97003));i.Calendar=new t,i.Calendar._RCalenderViewModel(!1),i.CalendarVisible=!0})()}Refresh(){1==this.TypeID?this.UnApprovedDocuments.OnLoad():2==this.TypeID?this.DocumentDrafts.FillGrid():3==this.TypeID?this.PDCDocuments.InitColumns():4==this.TypeID?this.NotifEvents.RefreshData():5==this.TypeID?this.DepreciationPosting.OnButtonClick("RefreshDepr"):7==this.TypeID&&this.DocsToApprove.LoadDocsToApproveGrid(-1)}refreshUI(){1==this.TypeID?this.UnApprovedDocuments.DocumentsGrid.refreshUI():2==this.TypeID?this.DocumentDrafts.Grid.refreshUI():3==this.TypeID?this.PDCDocuments.Grid.refreshUI():4==this.TypeID?this.NotifEvents.Grid.refreshUI():5==this.TypeID&&this.DepreciationPosting.OnButtonClick("RefreshDepr")}}var Se=f(21413);class Fe extends V.g{constructor(i,t){super(),this.Rows=0,this.Columns=0,this.LoadingVisibility=!1,this.RefreshV=new Se.B,this.ClassName="KPIViewViewModel",this.Report=i,i.Chart=this,this.KPILabels=[];let e=i.Reportds.Tables[0][0].DashKPIXML.toString(),s=new c.VB;s.LoadXml(e),this.Rows=parseInt(s.DocumentElement.attributes.Rows.value),this.Columns=parseInt(s.DocumentElement.attributes.Cols.value);for(let a=0;a<s.DocumentElement.children.length;a++){let d=s.DocumentElement.children[a];for(let o=0;o<d.childNodes.length;o++){let h=d.childNodes[o];if(c.J0.IsEmpty(h.attributes)||null!=h.attributes.Empty)continue;let r=new Ae;r.Row=a,r.Column=o,r.RowSpan=null!=h.attributes.rs?h.attributes.rs.value:"1",r.ColumnSpan=null!=h.attributes.cs?h.attributes.cs.value:"1",r.ShowCaption=null==h.attributes.caption,r.ShowCaption||(r.Row1Height="0");let u=c.VB.SelectSingleNode(h,"ID");if(null!=u){var l=i.ReportColumns.find(T=>T.ID==u.innerHTML);l&&(r.DBColumnName=l.ID,r.Field=l,r.FieldIndex=i.ReportColumns.indexOf(l),r.ShowCaption&&(r.Header.Label=l.HeaderText,r.Header.FontSize=D.d.SessionManager.GetColor(l.HeaderAppearance.FontSize),r.Header.ForeColor=D.d.SessionManager.GetColor(l.HeaderAppearance.ForeColor),r.Header.BackColor=D.d.SessionManager.GetColor(l.HeaderAppearance.BackColor),r.Header.FontFamily=l.HeaderAppearance.FontFamilyName,r.Header.Align=l.HeaderAppearance.Alignment.toString(),r.Header.VAlign="Center"),r.Data.FontSize=l.DataAppearance.FontSize,r.Data.ForeColor=D.d.SessionManager.GetColor(l.DataAppearance.ForeColor),r.Data.BackColor=D.d.SessionManager.GetColor(l.DataAppearance.BackColor),r.Data.FontFamily=l.DataAppearance.FontFamilyName,r.Data.Align=l.DataAppearance.Alignment.toString(),r.Data.VAlign="Center")}this.KPILabels.push(r)}}}LoadChartData(){let i;i=this.Report.lstGroup.find(s=>"Summary"==s.DisplayMode)&&null!=this.Report.ReportSummaryData?this.Report.ReportSummaryData:this.Report.ReportData;let e=this.Report.AddSubtotals_RT(this.Report.GrpReportTotal,0);for(let s=0;s<this.Report.ReportColumns.length;s++)e.Cells[s].CellAppearance=this.Report.ReportColumns[s].DataAppearance.Clone();this.Report.ApplyKPI(e);for(let s=0;s<this.KPILabels.length;s++){let l=this.KPILabels[s];null!=l.Field&&(l.ImagePath=null,-1!=l.FieldIndex&&l.FieldIndex<e.Cells.length&&(l.Data.Label=e.Cells[l.FieldIndex].Text,l.Data.ForeColor=D.d.SessionManager.GetColor(e.Cells[l.FieldIndex].CellAppearance.ForeColor),l.ImagePath="pack://application:,,,/"+e.Cells[l.FieldIndex].CellAppearance.ImagePath))}this.RefreshV.next("")}RefreshChart(){null!=this.Report.ReportData&&(this.LoadChartData(),this.Report.ReportViewType=N.Zv.DashBoard)}}class Ae extends v.MI{constructor(){super(),this.FieldIndex=-1,this.Field=null,this.ShowCaption=!1,this.ShowImage=!1,this.Header=new z,this.Data=new z,this.Row1Height="0.4*",this.Row2Height="0.6*"}}class z extends v.MI{constructor(){super(...arguments),this.FontFamily="Calibri",this.Field=null}}var $=f(95746),be=f(84480),Me=f(76465);class Re extends V.g{get ShowReportFilter(){return this._ShowReportFilter}set ShowReportFilter(i){this._ShowReportFilter=i,i&&this.ReportFilter.RefreshCostCenterItems()}constructor(){super(),this.InitUI=!1,this.IsDashClick=!1,this.IsAllDashBoardsLoaded=!1,this.AllDashBoards=[],this.DashResize=null,this.ShowList=!1,this._ShowReportFilter=!1,this.BackColor="White",this.Rows=0,this.Columns=0,this.IsRowHeightExists=!1,this.ds=null,this.dsWidgetNames=null,this.disname="",this.DashBoardID=0,this.dicPromises=new x.G9}DBViewViewModel_1(i){this.DashBoardID=i,this.DisplayName=D.d.GetResource("Loading"),this.DBList=new Array,this.InitDashboard(i)}InitDashboard(i){this.DashBoardID=i,D.d.report.GetDashBoard(1,i,!0).then(t=>{this.ds=t,this.disname=this.ds.Tables[0][0].DashBoardName.toString();let e=this.ds.Tables[0][0].DashBoardType.toString().split("*");this.Rows=parseInt(e[0]),this.Columns=parseInt(e[1]),this.RowHeight=new Array(this.Rows).fill(0),this.RowHeightXML="",this.DBListTemp=new Array(this.Rows),this.DBListTemp.Clear(),this.DBList.forEach(s=>{s.timer&&(s.timer.Enabled=!1)}),this.DBList.Clear(),this.dicPromises.Clear();for(let s=0;s<this.ds.Tables[0].length;s++){let l=new Z;l.DBPanel_1(this,this.ds.Tables[0][s]),this.DBList.push(l),this.DBListTemp[parseInt(l.Row)]||(this.DBListTemp[parseInt(l.Row)]=[]),this.DBListTemp[parseInt(l.Row)].push(l),(1==l.TypeID||2==l.TypeID||5==l.TypeID)&&this.dicPromises.push(s,D.d.report.GetReport(0,l.ReportID,!0))}if(!c.J0.StringIsNullOrEmpty(this.RowHeightXML)){if(this.RowHeightXML.Contains(",")){let s=this.RowHeightXML.split(",");for(let l=0;l<this.Rows;l++)this.RowHeight[l]=l<s.length?parseInt(s[l]):0}else if(parseInt(this.RowHeightXML)>0)for(let s=0;s<this.Rows;s++)this.RowHeight[s]=parseInt(this.RowHeightXML);this.RowHeight.forEach(s=>{s>0&&(this.IsRowHeightExists=!0)})}return Promise.all(this.dicPromises.values).then(s=>{for(let l=0;l<this.dicPromises.keys.length;l++)this.ds.Tables[0][this.dicPromises.keys[l]].ReportDefn=s[l];this.IsDashClick&&null!=this.DashResize&&(this.DashResize.Call(!0),this.DashResize.Call(!1)),setTimeout(()=>{let l=1;this.DBList.forEach(a=>{a.Visible&&(setTimeout(()=>{a.DBPanel_1_Async()},50*l),l++)}),this.worker_RunWorkerCompleted(null,null)},20)})})}worker_RunWorkerCompleted(i,t){this.DisplayName=this.disname}getStyles(){let i={},t=!1;return 0!=this.DBList.length&&(t=3==this.DBList[0].dr.Mode),D.d.IsMobile&&!t?i=D.d.IsAndroid?{gridTemplateColumns:"minmax(100px,100%)",gridTemplateRows:`repeat(${this.DBList.filter(e=>e.Visible).length},1fr)`}:{gridTemplateColumns:"minmax(100px,100%)"}:(i={gridTemplateColumns:`repeat(auto-fit,${100/this.Columns}%)`,gridTemplateRows:`repeat(auto-fit,${100/this.Rows}%)`,gridGap:"6px"},this.IsRowHeightExists&&(i.gridTemplateRows=`${this.RowHeight.map(e=>e>0?e+"px":"1fr").join(" ")}`)),i}getBackground(i){return D.d.IsMobile?{background:i.BodyBackColor}:{}}getDBpanelStyles(i){if(D.d.IsMobile&&3!=i.dr.Mode){let t={};return this.RowHeight[i.Row]>0&&i.Visible?t.height=i.RowSpan*this.RowHeight[i.Row]+"px":i.Visible?2==i.TypeID?t.height="calc(71%)":6!=i.TypeID&&(t.height=`${i.RowSpan*this.RowHeight[i.Row]==0?(window.innerHeight-150)/this.Rows:this.RowHeight[i.Row]}px`):(t.margin="0",t.height="0",t.display="none"),(1237==i.dr.NodeID||1234==i.dr.NodeID||1238==i.dr.NodeID)&&(t.height="auto"),t}return{gridColumnStart:`${parseInt(i.Column)+1}`,gridColumnEnd:`span ${i.ColumnSpan}`,gridRowStart:`${parseInt(i.Row)+1}`,gridRowEnd:`span ${i.RowSpan}`}}LoadDashList(){this.IsAllDashBoardsLoaded=!0,this.ShowList=!0;let i=D.d.report.GetDashBoard(2,0),t=null;i.Tables[0].forEach(e=>{if(t!=e.GroupName.toString()){t=e.GroupName.toString();let l=new le.D;l.Label=t,l.SectionID="1",this.AllDashBoards.push(l)}let s=new G.aF;s.FeatureActionTypeID=parseInt(e.DashBoardID),s.AppPath=s.FeatureActionTypeID==this.DashBoardID?"#FFE8A6":"#F9F9F9",s.Label=e.DashBoardName.toString(),this.AllDashBoards.push(s)})}OnDashBoardClick(i){this.IsDashClick=!0;var t=this.AllDashBoards.find(e=>e instanceof G.aF&&"#FFE8A6"==e.AppPath);t&&(t.AppPath="#F9F9F9"),i.AppPath="#FFE8A6",this.InitDashboard(i.FeatureActionTypeID)}OnButtonClick(i){"ShowList"==i?(this.ShowList=!this.ShowList,c.J0.SetPersonalize("ShowDBList",this.ShowList?"1":"0"),this.IsAllDashBoardsLoaded||this.LoadDashList()):"DashboardFilter"==i&&(null==this.ReportFilter&&(this.ReportFilter=new _(this)),this.ShowReportFilter=!0)}ApplyDBFilters(){setTimeout(()=>{this.filterworker_DoWork(null,null)},50)}filterworker_DoWork(i,t){this.DBList.forEach(e=>{2==e.TypeID&&null!=e.Chart?e.Chart.IsWidgetChart?e.Chart.OnButtonClick("WidgetFilterOK"):e.Chart.Report.OnButtonClick("OK_CLICK"):5==e.TypeID&&null!=e.KPI?e.KPI.Report.OnButtonClick("OK_CLICK"):6==e.TypeID&&null!=e.Widget&&e.Widget.Refresh()})}}class Z{get IsReportWidget(){return!!(D.d.IsMobile&&!c.J0.IsEmpty(this.Report)&&309==this.Report.ReportID||1==this.TypeID&&!c.J0.IsEmpty(this.Report)&&(273==this.Report.ReportID||276==this.Report.ReportID||304==this.Report.ReportID||305==this.Report.ReportID||310==this.Report.ReportID||307==this.Report.ReportID||306==this.Report.ReportID||308==this.Report.ReportID)||6==this.TypeID&&(72==this.EmpWidgetTypeID||26==this.EmpWidgetTypeID||60==this.EmpWidgetTypeID)||2==this.TypeID&&101==this.EmpWidgetTypeID)}get ReportFilterText(){return null!=this.Report?this.Report:null!=this.Chart?this.Chart.Report:null!=this.KPI?this.KPI.Report:null}constructor(){this.TypeID=0,this.AddOnID=0,this.Parent=null,this.Visible=!1,this.AutoRefresh=!1,this.Filter=!1,this.RefreshRate=0,this.TopRecords=0,this.timer=null,this.Row="0",this.Column="0",this.ColumnSpan="1",this.RowSpan="1",this.ShowBorder=!1,this.ShowUILoad=!0,this.ExportVisible=!1,this.PrintVisible=!0,this.RefreshVisibility=!0,this.RegenerateVisibility=!0,this.FilterVisibility=!1,this.GetAllDataVisibility=!0,this.ButtonColor="#111111",this.ButtonOpacity=1,this.HeaderForeColor="#00A9DA",this.HeaderBackColor="#FFFF00",this.BodyBackColor="#FFFFFF",this.PointsColor="#777777",this.ShowHeader=!0,this.ShowActions=!0,this.ScreenTemp=[],this.PrevData=0,this.PrevDataFilter=0,this.IsMaximize=!1,this.IsWidgetChart=!1,this.xOptions=null,this.EmpWidgetTypeID=0,this.ShowLoading=!0}DBPanel_1(i,t){this.dr=t,this.Parent=i,this.AutoRefresh=(0,E.yG0)(t.AutoRefresh),this.AutoRefresh&&(this.RefreshRate=c.J0.Double(t.RefreshRate),this.RefreshRate<=0&&(this.AutoRefresh=!1)),null!=t.Filter&&(this.Filter=(0,E.yG0)(t.Filter)),this.Header=t.ReportName.toString(),this.TopRecords=parseInt(t.TopRecords),this.TypeID=null!=t.TypeID?parseInt(t.TypeID):1,this.Row=t.RowNo.toString(),this.Column=t.ColNo.toString(),this.RowSpan=t.RowSpan.toString(),this.ColumnSpan=t.ColSpan.toString(),this.ShowBorder=!0;let e=c.J0.String(t.Options);if(e.length>0&&e.startsWith("<Options>")){let s;this.xOptions=new c.VB,this.xOptions.LoadXml(e),this.HeaderBackColor=c.J0.rgbColor(c.VB.SelectSingleNodeText(this.xOptions.DocumentElement,"HeaderBackClr")),this.HeaderForeColor=c.J0.rgbColor(c.VB.SelectSingleNodeText(this.xOptions.DocumentElement,"HeaderForeClr")),this.ButtonColor="#FFFFFF00"==this.HeaderBackColor||"#FFFFFF"==this.HeaderBackColor||"White"==this.HeaderBackColor?"#111111":this.HeaderForeColor,s=c.J0.rgbColor(c.VB.SelectSingleNode(this.xOptions.DocumentElement,"BodyBackClr")),null!=s&&"#FFFFFF00"!=s.innerHTML&&(this.BodyBackColor=c.J0.rgbColor(s.innerHTML)),s=c.VB.SelectSingleNode(this.xOptions.DocumentElement,"HideHeader"),this.ShowHeader=!(null!=s&&"1"==s.innerHTML),s=c.VB.SelectSingleNode(this.xOptions.DocumentElement,"HideActions"),this.ShowActions=!(null!=s&&"1"==s.innerHTML),s=c.VB.SelectSingleNode(this.xOptions.DocumentElement,"WIDGETCHART"),null!=s&&(this.IsWidgetChart=!0,s=c.VB.SelectSingleNode(this.xOptions.DocumentElement,"WidgetChartPrevious"),null!=s&&(this.PrevData=parseInt(s.innerHTML)),s=c.VB.SelectSingleNode(this.xOptions.DocumentElement,"WidgetChartPreviousFilter"),null!=s&&(this.PrevDataFilter=parseInt(s.innerHTML))),s=c.VB.SelectSingleNode(this.xOptions.DocumentElement,"BackColor"),null!=s&&""!=s.innerHTML&&(i.BackColor=c.J0.rgbColor(s.innerHTML),"#FFFFFF"!=i.BackColor&&"#FFFFFF00"!=i.BackColor&&(this.ShowBorder=!1)),s=c.VB.SelectSingleNode(this.xOptions.DocumentElement,"RowHeight"),null!=s&&(i.RowHeightXML=s.innerHTML),s=c.J0.rgbColor(c.VB.SelectSingleNode(this.xOptions.DocumentElement,"PointsColor")),this.PointsColor=null!=s?s.innerHTML:"#777777"}else{let s=e.split("~");s.length>1&&(this.HeaderBackColor=c.J0.rgbColor(s[0]),this.HeaderForeColor=c.J0.rgbColor(s[1]),this.ButtonColor="#FFFFFF00"==this.HeaderBackColor||"#FFFFFF"==this.HeaderBackColor||"White"==this.HeaderBackColor?"#111111":s[1],s.length>2&&"#00FFFFFF"!=s[2]&&(this.BodyBackColor=c.J0.rgbColor(s[2])),this.ShowHeader=!(s.length>3&&"1"==s[3]),s.length>4&&"WIDGETCHART"==s[4]&&(this.IsWidgetChart=!0,s.length>5&&""!=s[5]&&(this.PrevData=parseInt(s[5]))),s.length>6&&""!=s[6]&&(i.BackColor=c.J0.rgbColor(s[6]),"#FFFFFF"!=i.BackColor&&"#FFFFFF00"!=i.BackColor&&(this.ShowBorder=!1)),s.length>7&&""!=s[7]&&(this.PointsColor=c.J0.rgbColor(s[7])),s.length>8&&""!=s[8]&&(this.ShowActions=!(s.length>8&&"1"==s[8])))}this.PrevRow=this.Row,this.PrevColumn=this.Column,this.PrevRowSpan=this.RowSpan,this.PrevColumnSpan=this.ColumnSpan,this.Screen=[],this.ReportID=parseInt(t.ReportID),0==this.TypeID?this.Visible=!1:2==this.TypeID&&this.IsWidgetChart?this.Visible=!0:this.ReportID>0?(this.Visible=!0,this.PrintVisible=!1,this.ExportVisible=!1):this.Visible=!1}DBPanel_1_Async(){var i=this;return(0,W.A)(function*(){if(2==i.TypeID&&i.IsWidgetChart)i.Visible=!0,i.PrintVisible=!0,i.ExportVisible=!0,i.Chart=new J,i.Chart.RevenUChartViewModel_1(i,null,i.dr),i.ScreenTemp.push(i.Chart),"My Salary"==i.Chart.drChartDefn.ReportName&&(i.EmpWidgetTypeID=101);else if(i.ReportID>0)if(i.Visible=!0,i.PrintVisible=!1,i.ExportVisible=!1,1==i.TypeID)i.Report=new M.ReportViewModel,207==i.ReportID||307==i.ReportID||306==i.ReportID||308==i.ReportID||276==i.ReportID||310==i.ReportID?(i.EmpWidgetTypeID=i.ReportID,i.Report.ReportViewModel_2(i.ReportID,N.Zv.DashBoard,i.dr.ReportDefn,i,null,!1,!1,D.d.SessionManager.iEmployee)):i.Report.ReportViewModel_2(i.ReportID,N.Zv.DashBoard,i.dr.ReportDefn,i,null),i.Report.SearchVisibility=i.Filter,i.ScreenTemp.push(i.Report),i.FilterVisibility=!0,i.PrintVisible=!0,i.ExportVisible=!0,i.PrintVisible=D.d.SessionManager.HideUnathorizedAccess?i.Report.ButtonPrint.Visible:i.Report.ButtonPrint.Enable,i.ExportVisible=D.d.SessionManager.HideUnathorizedAccess?i.Report.ButtonExport.Visible:i.Report.ButtonExport.Enable;else if(2==i.TypeID){let t=new M.ReportViewModel;t.ReportViewModel_2(i.ReportID,N.Zv.LoadDataOnly,i.dr.ReportDefn,i,null),i.Chart=new J,i.Chart.RevenUChartViewModel_1(i,t,i.dr),i.ScreenTemp.push(i.Chart),i.PrintVisible=!0,i.ExportVisible=!0}else if(5==i.TypeID){let t=new M.ReportViewModel;t.ReportViewModel_2(i.ReportID,N.Zv.LoadDataOnly,i.dr.ReportDefn,i,null),i.KPI=new Fe(t,i.dr),i.ScreenTemp.push(i.KPI)}else if(6==i.TypeID)if(72==i.ReportID){i.EmpWidgetTypeID=i.ReportID,i.QuickViewDetails=new Me.H;let t=i.QuickViewDetails.QuickViewScreenViewModel_2(50051,D.d.SessionManager.iEmployee,-1);t&&t.then(()=>{i.ScreenTemp.push(i.QuickViewDetails)})}else i.EmpWidgetTypeID=i.ReportID,i.Widget=new O,i.Widget.WidgetViewModel_1(i,i.ReportID,i.dr.WidgetXML.toString()),i.ScreenTemp.push(i.Widget);else if(3==i.TypeID)i.RefreshVisibility=!1,i.RegenerateVisibility=!1,i.GetAllDataVisibility=!1,i.AddOnID=i.ReportID,i.AddOnID>0&&(i.RefreshVisibility=!0,i.AddOn=new ge(i.AddOnID),i.ScreenTemp.push(i.AddOn));else if(4==i.TypeID){i.RefreshVisibility=!1,i.RegenerateVisibility=!1,i.GetAllDataVisibility=!1;let t=new Te(i.ReportID);i.BodyBackColor=D.d.SessionManager.GetColor(t.BgColor),i.ScreenTemp.push(t)}else 7==i.TypeID&&(i.RefreshVisibility=!1,i.RegenerateVisibility=!1,i.GetAllDataVisibility=!1,i.ReportID>0&&i.ScreenTemp.push(new $.BulkEditViewModel(i.ReportID,i)));2==i.TypeID&&null!=i.Chart?i.Chart.IsWidgetChart?i.Chart.RefreshChart():i.Chart.Report.Refresh():5==i.TypeID&&null!=i.KPI?i.KPI.Report.Refresh():6==i.TypeID&&null!=i.Widget&&(c.J0.IsEmpty(i.Parent.ReportFilter)||(i.Widget.dtFilterAsnDate=i.Parent.ReportFilter.DateField.ToDatePicker.Date),i.Widget.Refresh()),i.ShowLoading=!1,i.AutoRefresh&&i.Visible&&(i.timer=new c.M4,i.timer.Interval=i.RefreshRate<1?1e4*i.RefreshRate:60*i.RefreshRate*1e3,i.timer.Elapsed(i,"timer_Elapsed"),i.timer.Enabled=!0)})()}OnButtonClick(i){"Regenerate"==i?1==this.TypeID?this.Report.OnButtonClick("Regenerate"):2==this.TypeID?this.Chart.IsWidgetChart?this.Chart.ShowWidgetFilter=!0:this.Chart.Report.OnButtonClick("Regenerate"):3==this.TypeID||5==this.TypeID&&this.KPI.Report.OnButtonClick("Regenerate"):"Refresh"==i?1==this.TypeID?this.Report.Refresh():2==this.TypeID?this.Chart.IsWidgetChart?this.Chart.RefreshChart():this.Chart.Report.Refresh():3==this.TypeID?this.AddOn.Refresh():5==this.TypeID&&this.KPI.Report.Refresh():"GetAllData"==i?1==this.TypeID?(this.Report.TopRecords=0,this.Report.Refresh()):2==this.TypeID?this.Chart.IsWidgetChart?this.Chart.RefreshChart():(this.Chart.Report.TopRecords=0,this.Chart.Report.Refresh()):3==this.TypeID||5==this.TypeID&&(this.KPI.Report.TopRecords=0,this.KPI.Report.Refresh()):"Filter"==i?1==this.TypeID&&(this.Report.ShowExport=!1,this.Report.ShowReportFilter?(this.Report.ShowReportFilter=!1,this.Report.ShowRightPanel=!1):(this.Report.ShowReportFilter=!0,this.Report.ShowRightPanel=!0)):"Maximize"==i&&(this.IsMaximize=!this.IsMaximize,setTimeout(()=>{null!=this.Chart?this.Chart.TabularDataObj.refreshUI():null!=this.AddOn?this.AddOn.refreshUI():7==this.TypeID?this.ScreenTemp.length>0&&this.ScreenTemp[0]instanceof $.BulkEditViewModel&&this.ScreenTemp[0].EditGrid.refreshUI():1==this.TypeID&&"ReportViewModel"==this.ScreenTemp[0].ClassName&&this.ScreenTemp[0].angularGrid.resizerService.resizeGrid()},50))}timer_Elapsed(i,t){this.timer.Enabled=!1,D.d.page.isActiveTab(this.Parent)&&(1==this.TypeID?!this.Report.LoadingVisibility&&!this.Report.process.IsBusy&&this.Report.Refresh(!1):2==this.TypeID?this.Chart.Report.Refresh():3==this.TypeID?this.AddOn.Refresh():5==this.TypeID?this.KPI.Report.Refresh():6==this.TypeID&&this.Widget.Refresh()),this.timer.Enabled=!0}}class _ extends q.d{constructor(i){super(),this.Parent=i,this.tree=[],this.CostCenterFilters=[],this.CostCenters=new F.y$(0),this.CostCenters.Label=D.d.GetResource("Reports_SelectCostCenter"),this.CostCenters.LblWidth="140",this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange");let t=new te.s;t.IsReportViewScreen=!0,this.DateField=new ie.w(t),this.DateField.ID="DateField";let e=new se.ir;this.DateField.Caption.Text="Date",this.DateField.CDGDO=e,this.DateField.CDGDO.DataType="DATE",this.DateField.Condition.SelectedValue="Between",this.DateField.Condition.SetSelectedItem(this.DateField.Condition.SelectedValue),this.DateField.OnConditionSelectionChanged(this.DateField.Condition.SelectedValue),this.DateField.Member.Visible=!1,this.DateField.DeleteVisible=!1}RefreshCostCenterItems(){this.CostCenters.CrFilter!=this.Parent.DashBoardID&&(this.CostCenters.Items.Clear(),this.CostCenters.SelectedIndex=-1,this.CostCenterFilters.Clear(),null!=this.tree&&this.tree.Clear()),this.CostCenters.CrFilter=this.Parent.DashBoardID,this.Parent.DBList.forEach(i=>{1==i.TypeID&&null!=i.Report?null!=i.Report.oReportDialog?this.FillCostCenterItems(i.Report.oReportDialog.CostCenters):null!=i.Report.Filter&&this.FillCostCenterItems(i.Report.Filter.CostCenters):2==i.TypeID&&null!=i.Chart&&(i.Chart.IsWidgetChart||(null!=i.Chart.Report.oReportDialog?this.FillCostCenterItems(i.Chart.Report.oReportDialog.CostCenters):null!=i.Chart.Report.Filter&&this.FillCostCenterItems(i.Chart.Report.Filter.CostCenters)))})}FillCostCenterItems(i){i.Items.forEach(t=>{this.CostCenters.Items.find(e=>e.Value==t.Value&&e.Parent==t.Parent)||this.CostCenters.Items.push(t)})}OnButtonClick(i){"FilterCancel"==i?this.Parent.ShowReportFilter=!1:"FilterOK"==i&&(this.Parent.DBList.forEach(t=>{1==t.TypeID&&null!=t.Report?(t.Report.FromDatePicker.Date=this.DateField.FromDatePicker.Date,t.Report.ToDatePicker.Date=this.DateField.ToDatePicker.Date,this.SetCCFilters(t.Report.oReportDialog?t.Report.oReportDialog:t.Report.Filter),t.Report.OnButtonClick("OK_CLICK")):2==t.TypeID&&null!=t.Chart?t.Chart.IsWidgetChart?(t.Chart.FromDate.Date=this.DateField.FromDatePicker.Date,t.Chart.ToDate.Date=this.DateField.ToDatePicker.Date):(t.Chart.Report.FromDatePicker.Date=this.DateField.FromDatePicker.Date,t.Chart.Report.ToDatePicker.Date=this.DateField.ToDatePicker.Date,this.SetCCFilters(t.Chart.Report.oReportDialog?t.Chart.Report.oReportDialog:t.Chart.Report.Filter)):5==t.TypeID&&null!=t.KPI&&(t.KPI.Report.FromDatePicker.Date=this.DateField.FromDatePicker.Date,t.KPI.Report.ToDatePicker.Date=this.DateField.ToDatePicker.Date,this.SetCCFilters(t.KPI.Report.oReportDialog?t.KPI.Report.oReportDialog:t.KPI.Report.Filter))}),this.Parent.ShowReportFilter=!1,this.Parent.ApplyDBFilters())}SetCCFilters(i){this.CostCenterFilters.forEach(t=>{if(t.SelectedNodes.length>0&&i.CostCenters.Items.find(e=>parseInt(e.Value)==t.CostCenterID)){let e=i.CostCenterFilters.find(s=>s.CostCenterID==t.CostCenterID);null!=e?(e.SelectedNodes=t.SelectedNodes,e.SelectedNodesTag=t.SelectedNodesTag):(e=new be.x(t.CostCenterID,t.LookupTypeID>0?t.LookupTypeID.toString():"",t.CostCenter,i),e.SelectedNodes=t.SelectedNodes,e.SelectedNodesTag=t.SelectedNodesTag,i.CostCenterFilters.push(e)),"StaticReportFilterViewModel"==i.ClassName&&i.TreeCCID==t.CostCenterID&&(i.DefaultTreeSelectedNodes=e.SelectedNodes)}})}OnCostCenterChange(i){if(!c.J0.IsEmpty(this.CostCenters.SelectedValue)&&(0==this.tree.length||this.tree[0].CostCenterID!=parseInt(this.CostCenters.SelectedValue))){let t=0;null!=this.CostCenters.SelectedItem&&!c.J0.IsEmpty(this.CostCenters.SelectedItem.Parent)&&(t=c.J0.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),t,0,null)}}LoadCostCenterTree(i,t,e,s){this.tree.Clear();let a,l="";if(50002==i&&"True"==D.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==D.d.SessionManager.Preferences["LW Reports"]&&(l=c.J0.IsEmpty(D.d.SessionManager.LocationWhere)?"NodeID IN (-1234)":"NodeID IN ("+D.d.SessionManager.LocationWhere+")"),null==s)for(let h=0;h<this.CostCenterFilters.length;h++){let r=this.CostCenterFilters[h];if(r.CostCenterID==i&&r.LookupTypeID==t){s=r.SelectedNodes;break}}44==i&&t>0&&(l="A.LookupType="+t),a=new ee.T,null==s?a.TreeViewModel_5(i,this,e,l,""):a.TreeViewModel_6(i,this,e,l,s,""),a.LookupTypeID=t,a.HeaderVisiblity=!1,a.OnNodeSelected||(a.OnNodeSelected=new v.Yk,a.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(a)}}}}]);