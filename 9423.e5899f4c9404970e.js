"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[9423],{31804:(M,b,o)=>{o.r(b),o.d(b,{QuickAddTenantViewModel:()=>I});var l=o(9659),a=o(66148),f=o(76199),m=o(92014),d=o(6532),C=o(5349),c=o(1077),g=o(81322),p=o(25960),S=o(25699),D=o(35789),u=o(4884),O=o(90673),E=o(70061),_=o(20557),j=o(35235),x=o(19439);class I extends f.g{constructor(e,i,h,t,r){super(),this.Obj={},this.ScreenObject=new m.ControlGenerator,this.objCostCenter=new _.d,this.AssignMapVisible=!1,this.RetValue=0,this._Height=700,this.Height=0,this.QuickVisible=!0,this.txtCode=new d.Dw(25694),this.txtCodetxt=new d.s3(25694),this.Type=new c.y$(25695),this.Position=new c.y$(25696),this.FstName=new d.Dw(25697),this.Group=new c.y$(25789),this.DetailButtonVisibility=!0,this.parentid=0,this.group=!0,this.NodeID=0,this.TenantID=0,this.CodePrefix="",this.CodeNumber=0,this.GroupSeqNoLength=0,this.ClassName="QuickAddTenantViewModel",Logger.InfoLog("QuickAddTenantViewModel::Entering QuickAddTenantViewModel With Parameters Selectednodeid="+e+" Costcenterid="+i+" Parentid="+h+"Isgroup="+t+" Oparent="+r);try{if(this.DisplayMessage="",this.MessageVisibility=!1,this.Title=l.d.GetResource("TNT_Title"),this.objCostCenter.CostCenterID=i,this.ScreenObject.LoadQuickScreen(this,94,t),this.QuickAssign=new E.d,this.QuickAssign.QuickAssignGrid_1(i,this.ScreenObject.Data,t),null!=this.ScreenObject.QuickAddFields&&(this.ScreenObject.QuickAddFields=this.ScreenObject.QuickAddFields.filter(n=>n instanceof D.MI&&n.Visible).sort((n,T)=>n.Row-T.Row)),t&&(this.QuickVisible=!1,this.DetailButtonVisibility=!1,this.Title=l.d.GetResource("TNT_AddGroup")),this.QuickVisible=!0,this.txtCode=this.ScreenObject.GetQuickText(25694),null==this.txtCode&&(this.txtCode=new d.Dw(25694),this.txtCode.Visible=!1),this.Type=this.ScreenObject.GetQuickField(25695),null==this.Type&&(this.Type=new c.y$(25695),this.Type.Visible=!1),this.Position=this.ScreenObject.GetQuickField(25696),null==this.Position&&(this.Position=new c.y$(25696),this.Position.Visible=!1),this.FstName=this.ScreenObject.GetQuickText(25697),null==this.FstName&&(this.FstName=new d.Dw(25697),this.FstName.Visible=!1),this.Group=this.ScreenObject.GetQuickField(25789),null==this.Group&&(this.Group=new c.y$(25789),this.Group.Visible=!1),this.ButtonSave=new g.v,this.Parent=r,this.parentid=h,this.group=t,this.Obj.IsGroup=t,this.Obj.TenantID=e,this.TenantID=this.Obj.TenantID,this.NodeID=this.Obj.TenantID,this.Group.SelectedValue=this.parentid,null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>5&&this.ScreenObject.Data.Columns[5].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[5].length>0&&this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[5],this.Obj.IsGroup),this.AutoGenerateCode(),e>0){this.LoadEditData(),this.objCostCenter.NodeID=e;let n=l.d.common.GetCostCenterDetails(0,this.objCostCenter.CostCenterID,this.NodeID,e);this.QuickAssign.LoadGrid(this.objCostCenter.NodeID,n.Tables[10]),this.Group.Enable=!1,this.Title=l.d.GetResource(t?"TNT_EditGroup":"TNT_Edit")}let s;for(let n=0;n<this.ScreenObject.StaticFields.length;n++)s=this.ScreenObject.StaticFields[n],s&&null!=s.ToolTipFooterTitle&&null!=s.KeyTip?this.SetControlEvent(s):this.TenantID>0&&s&&null!=s.ToolTipFooterTitle&&this.OnGetExtFunctionData(s);if(null!=this.ScreenObject.HeaderFields)for(let n=0;n<this.ScreenObject.HeaderFields.length;n++)s=this.ScreenObject.HeaderFields[n],s&&null!=s.ToolTipFooterTitle&&null!=s.KeyTip?this.SetControlEvent(s):this.TenantID>0&&s&&null!=s.ToolTipFooterTitle&&null!=s.KeyTip&&19==s.Mode&&this.OnGetExtFunctionData(s)}catch(s){Logger.ErrorLog("QuickAddTenantViewModel:: QuickAddTenantViewModel"+s.stack)}Logger.InfoLog("QuickAddTenantViewModel::Exiting QuickAddTenantViewModel")}SetControlEvent(e){try{e instanceof d.Dw?e.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):e instanceof C.y$?e.SelectionChangedCommand.Subscribe(this,"OnGetExtFunctionData"):e instanceof O.I||e instanceof d.L6?e.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):e instanceof c.y$?e.OnPactListBoxValueChanged.Subscribe(this,"OnGetExtFunctionData"):(e instanceof u.Lc||e instanceof u.P6||e instanceof u.C_)&&e.SelectedDateChanged.Subscribe(this,"OnGetExtFunctionData"),this.TenantID>0&&19==e.Mode&&this.OnGetExtFunctionData(e)}catch{}}OnGetExtFunctionData(e){null!=e.ToolTipFooterTitle&&!a.J0.IsEmpty(e.KeyTip)&&"lostfocus"==e.KeyTip.toLowerCase()&&this.ScreenObject.ValidateExtData(e,null,!0)&&this.ScreenObject.GetExternalFuncData(e.Mode,this.TenantID,e.ToolTipFooterTitle,e.ToolTipFooterDescription,e.ToolTipDescription,null,null)}AutoGenerateCode(){0==this.TenantID&&null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>5&&(this.ScreenObject.SetAutoCode(this.txtCodetxt,this.Obj.IsGroup,this.Group.SelectedValue,this.ScreenObject.Data.Tables[5]),a.J0.IsEmpty(this.txtCodetxt.Text)||(this.txtCode.Text=this.txtCodetxt.PrefixCode+this.txtCodetxt.Text+this.txtCodetxt.SuffixCode),this.txtCodetxt.Enable||(this.txtCode.IsReadOnly=!0))}LoadEditData(){Logger.InfoLog("QuickAddTenantViewModel::Entering LoadEditData");try{let e=l.d.rental.GetTenantDetails(this.Obj.TenantID);Object.assign(this.Obj,e.obj),this.txtCode.Text=this.Obj.Code,this.ScreenObject.IsAutoCode&&(this.txtCode.Enable=parseInt(e.Tables[0][0].Depth)<=1&&!this.ScreenObject.IsRootAutoCode),this.FstName.Text=this.Obj.FirstName,a.J0.IsEmpty(e.Tables[0][0].TypeID)||(this.Type.SelectedValue=parseInt(e.Tables[0][0].TypeID)),a.J0.IsEmpty(e.Tables[0][0].PositionID)||(this.Position.SelectedValue=parseInt(e.Tables[0][0].PositionID)),a.J0.StringIsNullOrEmpty(e.Tables[0][0].CodePrefix)||(this.CodePrefix=e.Tables[0][0].CodePrefix.toString()),a.J0.StringIsNullOrEmpty(e.Tables[0][0].CodeNumber)||(this.CodeNumber=parseInt(e.Tables[0][0].CodeNumber)),a.J0.StringIsNullOrEmpty(e.Tables[0][0].GroupSeqNoLength)||(this.GroupSeqNoLength=parseInt(e.Tables[0][0].GroupSeqNoLength.toString())),this.ScreenObject.FillControls(e.Tables[0][0],e.Tables[1][0],e.Tables[2].length>0?e.Tables[2][0]:null,null),e.Tables[5].length>0&&this.ScreenObject.CanApprove(e.Tables[0][0],e.Tables[5][0],this.ButtonSave)}catch(e){Logger.InfoLog("QuickAddTenantViewModel:: LoadEditData"+e.stack)}Logger.InfoLog("QuickAddTenantViewModel::Exiting LoadEditData")}OnSave(e){Logger.InfoLog("QuickAddTenantViewModel::Entering OnSave");try{if("Cancel"==e.toString())l.d.page.HideDialog(this.PopUpGUID);else if("Details"==e.toString()){l.d.page.HideDialog(this.PopUpGUID);let i=new p.AddEditTenantViewModel(this.NodeID,this.parentid,this.group);i.FstName.Text=this.FstName.Text,i.txtCode.Text=this.ScreenObject.GetTextComboValue_string(25694,""),i.Type.SelectedValue=this.Type.SelectedValue,i.Position.SelectedValue=this.Position.SelectedValue,i.Group.SelectedValue=this.Group.SelectedValue,l.d.page.addNewTab({title:i.Title,component:S.AddEditTenantComponent,params:{obj:i}})}else if("ApproveMaster"==e.toString()){let i=new j.i(94,this.Obj.TenantID,this.ScreenObject,this);l.d.page.ShowDialog(i,x.R,{ShowCenter:!0,Title:l.d.GetResource("ApproveReject")})}else if("Save"==e.toString()){let i=this.ScreenObject.ValidateData();if(!a.J0.IsEmpty(i))return this.DisplayMessage=i,void(this.MessageVisibility=!0);if(0==this.TenantID){let r=this.ScreenObject.Data.Tables[5];r=r.filter(T=>0==T.IsName);let n={StrCode:this.Obj.Code,CodePrefix:this.Obj.CodePrefix,CodeNumber:this.Obj.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.txtCodetxt,this.Group.SelectedValue,r,n),this.Obj.Code=n.StrCode,this.Obj.CodePrefix=n.CodePrefix,this.Obj.CodeNumber=n.CodeNumber,this.DisplayMessage.length>0)return;a.J0.IsEmpty(this.Obj.Code)||(this.txtCode.Text=this.Obj.Code)}else this.Obj.Code=this.txtCode.Text,this.Obj.CodePrefix=this.CodePrefix,this.Obj.CodeNumber=this.CodeNumber,this.Obj.GroupSeqNoLength=this.GroupSeqNoLength;a.J0.IsEmpty(this.Obj.Code)&&(this.txtCode.Text=this.ScreenObject.GetTextComboValue_string(25694,""),this.Obj.Code=this.txtCode.Text),this.FstName.Text=this.ScreenObject.GetTextComboValue_string(25697,""),this.Obj.FirstName=this.FstName.Text,this.Obj.SelectedNodeId=this.Group.SelectedValue,this.Obj.IsGroup=this.group,this.Obj.AttachmetsXML="",this.Obj.TabsData=this.getFields().Trim(","),this.Obj.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.Obj.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.Obj.WID=this.ScreenObject.CheckWorkFlow(),this.Obj.ContactsXML="",this.Obj.PrimaryContactQuery="";let h={};if(this.DisplayMessage=this.QuickAssign.GetXML(h),!a.J0.StringIsNullOrEmpty(this.DisplayMessage))return;this.Obj.CCMapXML=h.strXML,l.d.rental.SaveTenant(this.Obj,"SaveTenant").subscribe(r=>{this.DisplayMessage=r.Message,this.MessageVisibility=!0,this.RetValue=r.RetValue,this.RetValue>0&&(this.txtCode.Text="",this.FstName.Text="",this.CodePrefix="",this.CodeNumber=0,this.GroupSeqNoLength=0,null==this.Parent?l.d.page.HideDialog(this.PopUpGUID):this.Parent.Refresh(),this.AutoGenerateCode(),l.d.page.HideDialog(this.PopUpGUID))},r=>{console.log(" Unit Save : "+JSON.stringify(r))})}}catch(i){Logger.ErrorLog("QuickAddTenantViewModel:: OnSave"+i.stack)}Logger.InfoLog("QuickAddTenantViewModel::Exiting OnSave")}getFields(){Logger.InfoLog("AddEditTenantViewModel::Entering getFields");let e="",i="";for(let h=0;h<this.ScreenObject.StaticFields.length;h++){const t=this.ScreenObject.StaticFields[h];if(t instanceof D.MI&&!a.J0.IsEmpty(t.DBColumnName)&&!t.DBColumnName.toLowerCase().Contains("alpha")&&!t.DBColumnName.toLowerCase().Contains("ccnid")){if("TenantCode"==t.DBColumnName||"FirstName"==t.DBColumnName||"IsGroup"==t.DBColumnName)continue;t instanceof d.Dw?(e=t.Text,a.J0.IsEmpty(e)&&(e=""),i+=t.DBColumnName+"=N'"+e.Replace("'","''")+"',"):t instanceof C.y$?(e=t.SelectedValue,a.J0.IsEmpty(e)&&(e=""),i+=t.DBColumnName+"=N'"+e+"',"):t instanceof u.P6?t.Date&&(e=t.Date.ToString("dd/MMM/yyyy"),a.J0.IsEmpty(e)&&(e=""),i+=t.DBColumnName+"='"+e+"',"):t instanceof u.Lc?(e=t.Date.ToString("dd/MMM/yyyy"),a.J0.IsEmpty(e)&&(e=""),i+=t.DBColumnName+"=Convert(float,Convert(DateTime,'"+e+"')),"):t instanceof O.I?(e=t.Text,a.J0.IsEmpty(e)&&(e=""),i+=t.DBColumnName+"='"+e+"',"):t instanceof c.y$&&(e=t.SelectedValue.toString(),a.J0.IsEmpty(e)||(i+=t.DBColumnName+"='"+e+"',"))}}return i.toString()}}}}]);