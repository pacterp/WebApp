"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[4244,7538,8241],{622:(ee,j,d)=>{d.r(j),d.d(j,{UnAppDocumentsViewModel:()=>K});var M=d(74523),h=d(7321),s=d(32040),G=d(3338),J=d(43767);class K{constructor(){this.LocationID="",Logger.InfoLog("UnAppDocumentsViewModel:: Entering UnAppDocumentsViewModel");try{this.DocumentsGrid=new h.vv,this.DocumentsGrid.Width="",this.DocumentsGrid.OnLinkClick.Subscribe(this,"OnLinkClickEvent"),this.DocumentsGrid.Columns=G.GeneralDashboardViewModel.InitColumns("Un Approved Documents_DashBoardCustomize"),this.LocationID=s.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==s.d.SessionManager.Preferences.EnableLocationWise.toString()?s.d.SessionManager.LocationID>0?s.d.SessionManager.LocationID.toString():s.d.SessionManager.LocationWhere:"0",this.OnLoad()}catch(O){Logger.ErrorLog("UnAppDocumentsViewModel","Constructor",O)}Logger.InfoLog("UnAppDocumentsViewModel:: Entering UnAppDocumentsViewModel")}OnLoad(){s.d.document.GetUnApprovedDocuments(this.LocationID,371).subscribe(O=>{let k=O.Tables[0];k?.forEach(P=>{P.id=s.d.slick.rowid,P.Date_Text=J.J0.ParseDate(P.DocDate).ToString(s.d.SessionManager.Preferences["Date Format"]),""!=P.ModifiedDate.toString()&&(P.MDate_Text=J.J0.ParseDate(P.ModifiedDate).ToString("hh:mm"))}),this.DocumentsGrid.Table=k})}OnLinkClickEvent(O,k,P){var N=this;return(0,M.A)(function*(){try{if("95"!=O.CostCenterID.toString()){const{DocumentViewerViewModel:E}=yield Promise.all([d.e(9891),d.e(534),d.e(7996),d.e(1755),d.e(3884),d.e(7030),d.e(4628),d.e(5984),d.e(5152),d.e(8405),d.e(895),d.e(5819),d.e(6015),d.e(2963),d.e(108),d.e(2290),d.e(8024),d.e(3364),d.e(9284),d.e(9128),d.e(1938),d.e(2726),d.e(4065),d.e(2014),d.e(2209),d.e(2771),d.e(6084),d.e(4882),d.e(4119),d.e(2076)]).then(d.bind(d,42847)),{DocumentViewerComponent:Y}=yield d.e(2076).then(d.bind(d,40695));let v=new E;v.DocumentViewerViewModel_Document(N.DocumentsGrid,O,k),v.IsDocumentFound&&s.d.page.addNewTab({component:Y,params:{obj:v}})}}catch(E){Logger.ErrorLog("UnAppDocumentsViewModel","OnLinkClickEvent",E)}})()}}},23297:(ee,j,d)=>{d.d(j,{_:()=>_});var M=d(11798),h=d(32040),s=d(96598),G=d(43357),J=d(67700),K=d(65039),X=d(96336);const O=()=>({standalone:!0});function k(T,g){if(1&T&&(s.j41(0,"label"),s.EFF(1),s.k0s()),2&T){const I=s.XpG();s.R7$(),s.SpI("\n      ",I.obj.AccountName,"\n    ")}}function P(T,g){if(1&T){const I=s.RV6();s.j41(0,"button",6),s.bIt("click",function(){s.eBV(I);const y=s.XpG();return s.Njj(y.obj.OnButtonClick("BACK"))}),s.nrm(1,"i",17),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&T&&(s.R7$(2),s.JRh(s.bMT(3,1,"Back")))}function N(T,g){if(1&T&&(s.j41(0,"div",18),s.EFF(1,"\n        "),s.j41(2,"label"),s.EFF(3),s.k0s(),s.EFF(4,"\n        "),s.j41(5,"label",19),s.EFF(6),s.k0s(),s.EFF(7,"\n      "),s.k0s()),2&T){const I=s.XpG();s.R7$(3),s.SpI("",I.obj.OpeningBalance.Label," :"),s.R7$(3),s.JRh(I.obj.OpeningBalance.Text)}}function E(T,g){if(1&T){const I=s.RV6();s.j41(0,"div",34),s.EFF(1,"\n                "),s.j41(2,"input",35),s.mxI("ngModelChange",function(y){s.eBV(I);const w=s.XpG(3);return s.DH7(w.obj.SaveXLS.IsColumnUserDefined,y)||(w.obj.SaveXLS.IsColumnUserDefined=y),s.Njj(y)}),s.k0s(),s.EFF(3,"\n                "),s.j41(4,"label",36),s.EFF(5),s.nI1(6,"translate"),s.k0s(),s.EFF(7,"\n              "),s.k0s()}if(2&T){const I=s.XpG(3);s.R7$(2),s.R50("ngModel",I.obj.SaveXLS.IsColumnUserDefined),s.Y8G("ngModelOptions",s.lJ4(6,O))("value",I.obj.SaveXLS.IsColumnUserDefined),s.R7$(3),s.JRh(s.bMT(6,4,"Dont Print Header & Footer"))}}function Y(T,g){if(1&T){const I=s.RV6();s.j41(0,"div",34),s.EFF(1,"\n                "),s.j41(2,"input",35),s.mxI("ngModelChange",function(y){s.eBV(I);const w=s.XpG(3);return s.DH7(w.obj.chkSaveXLS_EGS.IsChecked,y)||(w.obj.chkSaveXLS_EGS.IsChecked=y),s.Njj(y)}),s.k0s(),s.EFF(3,"\n                "),s.j41(4,"label",36),s.EFF(5),s.nI1(6,"translate"),s.k0s(),s.EFF(7,"\n              "),s.k0s()}if(2&T){const I=s.XpG(3);s.R7$(2),s.R50("ngModel",I.obj.chkSaveXLS_EGS.IsChecked),s.Y8G("ngModelOptions",s.lJ4(6,O))("value",I.obj.chkSaveXLS_EGS.IsChecked),s.R7$(3),s.JRh(s.bMT(6,4,"Each Group on Seperate"))}}function v(T,g){if(1&T){const I=s.RV6();s.qex(0,24),s.EFF(1,"\n          "),s.j41(2,"div",25),s.EFF(3,"\n            "),s.j41(4,"span",26),s.EFF(5),s.nI1(6,"translate"),s.k0s(),s.EFF(7,"\n            "),s.j41(8,"span",27),s.bIt("click",function(){s.eBV(I);const y=s.XpG(2);return s.Njj(y.isqukpnlopen=!y.isqukpnlopen)}),s.k0s(),s.EFF(9,"\n          "),s.k0s(),s.EFF(10,"\n          "),s.j41(11,"div",28),s.EFF(12,"\n            "),s.eu8(13,29),s.EFF(14,"\n            "),s.eu8(15,29),s.EFF(16,"\n            "),s.qex(17),s.EFF(18,"\n              "),s.DNE(19,E,8,7,"div",30),s.EFF(20,"\n            "),s.bVm(),s.EFF(21,"\n            "),s.j41(22,"div",11),s.EFF(23,"\n              "),s.DNE(24,Y,8,7,"div",30),s.EFF(25,"\n              "),s.eu8(26,29),s.EFF(27,"\n            "),s.k0s(),s.EFF(28,"\n\n            "),s.eu8(29,29),s.EFF(30,"\n            "),s.EFF(31,"\n            "),s.EFF(32,"\n          "),s.k0s(),s.EFF(33,"\n          "),s.j41(34,"div",31),s.EFF(35,"\n            "),s.j41(36,"button",32),s.bIt("click",function(){s.eBV(I);const y=s.XpG(2);return s.Njj(y.obj.OnButtonClick("Export"))}),s.EFF(37),s.nI1(38,"translate"),s.k0s(),s.EFF(39,"\n            "),s.j41(40,"button",33),s.bIt("click",function(){s.eBV(I);const y=s.XpG(2);return s.Njj(y.obj.OnButtonClick("CancelExport"))}),s.EFF(41),s.nI1(42,"translate"),s.k0s(),s.EFF(43,"\n          "),s.k0s(),s.EFF(44,"\n        "),s.bVm()}if(2&T){const I=s.XpG(2);s.R7$(5),s.JRh(s.bMT(6,9,"Report_ExportThisReportAs")),s.R7$(8),s.Y8G("obj",I.obj.SavePDF),s.R7$(2),s.Y8G("obj",I.obj.SaveXLS),s.R7$(4),s.Y8G("ngIf",I.obj.SaveXLS.IsChecked),s.R7$(5),s.Y8G("ngIf",I.obj.SaveXLS.IsChecked),s.R7$(2),s.Y8G("obj",I.obj.cmbSaveXLS_EGS),s.R7$(3),s.Y8G("obj",I.obj.SaveXLSX),s.R7$(8),s.JRh(s.bMT(38,11,"lbl_Export")),s.R7$(4),s.JRh(s.bMT(42,13,"Reports_Cancel"))}}function $(T,g){if(1&T){const I=s.RV6();s.j41(0,"div",37),s.bIt("click",function(){s.eBV(I);const y=s.XpG(2);return s.Njj(y.isqukpnlopen=!y.isqukpnlopen)}),s.EFF(1,"\n        "),s.qex(2),s.EFF(3,"\n          "),s.nrm(4,"span",38),s.EFF(5,"\n          "),s.j41(6,"span"),s.EFF(7),s.nI1(8,"translate"),s.k0s(),s.EFF(9,"\n        "),s.bVm(),s.EFF(10,"\n      "),s.k0s()}2&T&&(s.R7$(7),s.JRh(s.bMT(8,1,"Report_ExportThisReportAs")))}function Z(T,g){if(1&T&&(s.j41(0,"div",20),s.EFF(1,"\n      "),s.j41(2,"div",21),s.EFF(3,"\n        "),s.DNE(4,v,45,15,"ng-container",22),s.EFF(5,"\n      "),s.k0s(),s.EFF(6,"\n      "),s.DNE(7,$,11,3,"div",23),s.EFF(8,"\n      "),s.EFF(9,"\n    "),s.k0s()),2&T){const I=s.XpG();s.xc7("width",I.isqukpnlopen?"308px":"53px"),s.AVh("rptpref_div",I.isqukpnlopen)("rightpanel_collapse",!I.isqukpnlopen),s.R7$(2),s.xc7("display",I.isqukpnlopen?"contents":"none"),s.R7$(2),s.Y8G("ngIf",I.obj.ShowExport),s.R7$(3),s.Y8G("ngIf",!I.isqukpnlopen)}}let _=(()=>{class T{constructor(){this.form=new M.gE({}),this._isqukpnlopen=!0}ngOnInit(){}get IsMobile(){return h.d.IsMobile}get isqukpnlopen(){return this._isqukpnlopen}set isqukpnlopen(I){this._isqukpnlopen!=I&&(this._isqukpnlopen=I,this.obj.angularGrid&&this.obj.angularGrid.resizerService.resizeGrid())}static{this.\u0275fac=function(f){return new(f||T)}}static{this.\u0275cmp=s.VBU({type:T,selectors:[["app-account-drill-down"]],inputs:{obj:"obj"},standalone:!1,decls:46,vars:15,consts:[[1,"shadowborder",2,"padding","12px","flex","1","background-color","var(--body-bg-color)"],[1,"page-subheader",2,"margin-bottom","15px"],[1,"page-subtitle"],[4,"ngIf"],[1,"btnMetroDiv","secondary-btn-group",2,"padding-right","0px"],["class","secondary-btn","style","position: relative;",3,"click",4,"ngIf"],[1,"secondary-btn",2,"position","relative",3,"click"],[1,"fa-light","fa-file-export"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-print"],[1,"fa-light","fa-times"],[2,"display","flex"],[2,"flex","1","background-color","white","padding","5px"],["style","margin-bottom: 4px;",4,"ngIf"],[1,"PactMasterTree","Pactpagetree",2,"height","280px","width","660px"],[3,"obj"],["class","rightpanel","style","height: 100%;margin-left: 20px;",3,"width","rptpref_div","rightpanel_collapse",4,"ngIf"],[1,"fa-light","fa-undo"],[2,"margin-bottom","4px"],[2,"font-weight","normal","font-size","12px !important"],[1,"rightpanel",2,"height","100%","margin-left","20px"],[2,"height","100%"],["style","display: contents;",4,"ngIf"],["class","rptclpheading",3,"click",4,"ngIf"],[2,"display","contents"],[2,"height","50px","padding","15px","border-bottom","1px solid #A4ABBD"],[1,"dlgtitle"],[1,"fa-light","fa-circle-xmark",2,"color","#404756","font-size","20px","float","right",3,"click"],[1,"exportradio",2,"height","calc(100% - 110px)"],["FieldDirective","",3,"obj"],["style","float: left;padding-bottom: 10px;",4,"ngIf"],[1,"rptfooterdiv"],[1,"primary-btn-wicon",2,"float","right",3,"click"],[1,"secondary-btn-wicon",2,"float","left",3,"click"],[2,"float","left","padding-bottom","10px"],["type","checkbox","style.text-align","left","id","radio",1,"login_checkbox",3,"ngModelChange","ngModel","ngModelOptions","value"],["for","checkbox",1,"login_checkbox_label"],[1,"rptclpheading",3,"click"],[1,"fa-light","fa-filter"]],template:function(f,y){1&f&&(s.j41(0,"div",0),s.EFF(1,"\n  "),s.j41(2,"div",1),s.EFF(3,"\n    "),s.j41(4,"label",2),s.EFF(5),s.k0s(),s.EFF(6,"\n    "),s.DNE(7,k,2,1,"label",3),s.EFF(8,"\n    "),s.j41(9,"div",4),s.EFF(10,"\n      "),s.DNE(11,P,4,3,"button",5),s.EFF(12,"\n      "),s.EFF(13,"\n      "),s.j41(14,"button",6),s.bIt("click",function(){return y.obj.OnButtonClick("ShowExportScreen")}),s.nrm(15,"i",7),s.EFF(16),s.nI1(17,"translate"),s.k0s(),s.EFF(18,"\n\n      "),s.j41(19,"button",8),s.bIt("click",function(){return y.obj.OnButtonClick("Export")}),s.nrm(20,"i",9),s.EFF(21),s.nI1(22,"translate"),s.k0s(),s.EFF(23,"\n      "),s.j41(24,"button",8),s.bIt("click",function(){return y.obj.OnButtonClick("Close")}),s.nrm(25,"i",10),s.EFF(26),s.nI1(27,"translate"),s.k0s(),s.EFF(28,"\n    "),s.k0s(),s.EFF(29,"\n  "),s.k0s(),s.EFF(30,"\n  "),s.j41(31,"div",11),s.EFF(32,"\n    "),s.j41(33,"div",12),s.EFF(34,"\n      "),s.DNE(35,N,8,2,"div",13),s.EFF(36,"\n      "),s.j41(37,"div",14),s.EFF(38,"\n        "),s.nrm(39,"app-report-grid",15),s.EFF(40,"\n      "),s.k0s(),s.EFF(41,"\n    "),s.k0s(),s.EFF(42,"\n    "),s.DNE(43,Z,10,10,"div",16),s.EFF(44,"\n  "),s.k0s(),s.EFF(45,"\n"),s.k0s()),2&f&&(s.R7$(5),s.SpI("\n      ",y.obj.Title,"\n    "),s.R7$(2),s.Y8G("ngIf",!y.obj.Accounts.Visible),s.R7$(4),s.Y8G("ngIf",y.obj.BackButtonVisible),s.R7$(5),s.JRh(s.bMT(17,9,"Export Data")),s.R7$(5),s.JRh(s.bMT(22,11,"Print")),s.R7$(5),s.JRh(s.bMT(27,13,"Close")),s.R7$(9),s.Y8G("ngIf",!y.obj.WidgetVisible&&y.obj.OpeningBalance.Visible),s.R7$(4),s.Y8G("obj",y.obj.ReportGridObj),s.R7$(4),s.Y8G("ngIf",y.obj.ShowExport&&y.obj.ShowRightPanel))},dependencies:[G.bT,J._,M.Zm,M.BC,K.e,M.vS,X.D9],encapsulation:2})}}return T})()},71863:(ee,j,d)=>{d.r(j),d.d(j,{DBPanel:()=>ne,DBReportFilterViewModel:()=>he,DBViewViewModel:()=>we});var M=d(74523),h=d(32040),s=d(43767),G=d(98580),J=d(33784),K=d(72247),X=d(19086),O=d(20643),k=d(95083),P=d(58170),N=d(27730),E=d(39026),Y=d(54581),v=d(54047),$=d(25436),Z=d(66471),_=d(26336),T=d(89731),g=d(66096),I=d(76260),f=d(42144),y=d(23297),w=d(75679);class A{constructor(){this.IsGroupsExists=!1}}class Q extends G.g{get WidgetVisibility(){return this._WidgetVisibility}set WidgetVisibility(i){this._WidgetVisibility!=i&&(this.CalendarVisibility=!1,this._WidgetVisibility=i)}get CalendarVisibility(){return this._CalendarVisibility}set CalendarVisibility(i){this._CalendarVisibility!=i&&(this.WidgetVisibility=!1,this._CalendarVisibility=i)}constructor(){super(),this.Chart=null,this.LoadingVisibility=!0,this._WidgetVisibility=!0,this._CalendarVisibility=!1,this.ForeColor="#FFFFFF",this.SubFieldsBgColor="#008000",this.SubFieldsBgColorArr=["#017EFF","#FF9700","#3498FB","#0093A4","#9972B5","#FF4040","#2BADCE","#E69500"],this.WidgetID=0,this.TypeID=0,this.Decimals=2,this.strAccounts="",this.Groups="",this.PrevData=0,this.IncludeOpening=!1,this.IncludeRevised=!1,this.IsGroupsExists=!1,this.IncludePDC=!1,this.ShowPositive=!1,this.IsAccDoc=!1,this.IsExecutedDocs=!1,this.IsGeneralDocs=!1,this.IsBWDocs=!1,this.IsDurationDifference=!1,this.IsDifferenceView=!1,this.IsFieldsDifference=!1,this.CurrencyType=0,this.ForeignCurrencyID=0,this.Slabs=new Array,this.dicExecutedQuery=new _.bT,this.dicUserWiseDims=new _.bT,this.dicFilters=new _.G9,this.dicLookupFilters=new _.G9,this.HeaderValuePostfix="",this.IsLink=!1,this.CallStatusID="",this.eval=new T.CC,this.fldDict=new _.bT,this.ClassName="WidgetViewModel"}WidgetViewModel_1(i,t,e){if(this.WidgetID=t,this.Header=new W,this.SubFields=[],this.SubFieldsText=[],this.SubFieldsBgColor=this.SubFieldsBgColorArr[Math.abs(t)%8],0==e.length)return;let o=new s.VB;o.LoadXml(e),this.DBWidgetFilter=s.VB.SelectSingleNode(o.DocumentElement,"TreeFilters"),this.InitWidget(),this.ForeColor=i.HeaderForeColor,this.BackgroundColor=i.BodyBackColor,e.split("!")[0].split(","),this.IsDurationDifference=null!=o.DocumentElement.attributes.IsDurationDifference&&"1"==o.DocumentElement.attributes.IsDurationDifference.value,this.IsFieldsDifference=null!=o.DocumentElement.attributes.IsFieldsDifference&&"1"==o.DocumentElement.attributes.IsFieldsDifference.value,this.IsFieldsDifference&&(this.IsDurationDifference=!0),this.IsDurationDifference&&(this.Header.ShowArrow=!0),(this.IsDurationDifference||this.IsFieldsDifference||104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID)&&(this.IsDifferenceView=!0),this.Header.LabelType=o.DocumentElement.attributes.HF.value;let p=s.VB.SelectSingleNode(o.DocumentElement,"HFForm");if(null!=p&&(this.Header.Formula=p.innerHTML),this.Header.Label=i.Header,this.Header.ForeColor=this.ForeColor,p=s.VB.SelectSingleNode(o.DocumentElement,"HFImage"),null!=p&&!s.J0.IsEmpty(p.innerHTML)&&(this.Header.ImagePath=s.J0.GetPath(p.innerHTML)),this.Header.txtLbl=new z,this.IsDurationDifference&&!this.IsFieldsDifference){this.DurationLinks=[],this.Header.LabelType="";let n=s.VB.SelectNodes(o.DocumentElement,"DF");for(let a=0;a<n.length;a++){let c=new z;c.Row=n[a].attributes.Duration.value,c.Text=n[a].attributes.Caption.value,this.DurationLinks.push(c)}let u=["CurMon","PrevMn"];this.DurationLinks.length>0&&(u=this.SetDurationFilter(this.DurationLinks[0],!1));for(let a=0;a<u.length;a++){let c=new W;c.LabelType=u[a],c.Label=0==a?"Current":"Previous",c.Row=a.ToString(),c.ForeColor=this.ForeColor,c.SetSubFields(),this.SubFields.push(c),this.SubFieldsText.push(c.txtLbl),this.SubFieldsText.push(c.txtValue),this.SubFieldsText.push(c.txtSep),this.SubFieldsText.push(c.txtPercent)}}else 11==this.TypeID||12==this.TypeID||13==this.TypeID||14==this.TypeID||15==this.TypeID||18==this.TypeID||19==this.TypeID||20==this.TypeID||102==this.TypeID?(s.J0.IsEmpty(this.Header.LabelType)&&(this.Header.LabelType="YrToDate"),(11==this.TypeID||12==this.TypeID||13==this.TypeID||18==this.TypeID||19==this.TypeID||20==this.TypeID)&&(this.Header.Visible=!1)):(26==this.TypeID||27==this.TypeID)&&(this.CalendarVisibility=!0,this.WidgetCalendar=new De(this));if(11!=this.TypeID){let n=s.VB.SelectNodes(o.DocumentElement,"SF");for(let u=0;u<n.length;u++){let a=new W;a.LabelType=n[u].attributes.Field.value,a.Label=n[u].attributes.Caption.value,null!=n[u].attributes.Perc&&"1"==n[u].attributes.Perc.value&&(a.ShowPercentage=!0),p=s.VB.SelectSingleNode(n[u],"Form"),null!=p&&(a.Formula=p.innerHTML),a.Row=u.toString(),a.ForeColor=this.ForeColor,a.SetSubFields(),16==this.TypeID?a.StatusID=o.DocumentElement.attributes.StatusFilter.value:17==this.TypeID&&(a.StatusID=a.LabelType,a.LabelType=o.DocumentElement.attributes.StatusFilter.value),103==this.TypeID&&(a.txtPercent.Visible=!1),this.SubFields.push(a),this.SubFieldsText.push(a.txtLbl),this.SubFieldsText.push(a.txtSep),this.SubFieldsText.push(a.txtValue),this.SubFieldsText.push(a.txtPercent)}17==this.TypeID?(this.Header.StatusID=this.Header.LabelType,this.Header.LabelType=o.DocumentElement.attributes.StatusFilter.value):16==this.TypeID&&(this.Header.StatusID=o.DocumentElement.attributes.StatusFilter.value)}(16==this.TypeID||17==this.TypeID)&&(this.IsGeneralDocs=!0,("21"==this.Header.StatusID||"22"==this.Header.StatusID||"23"==this.Header.StatusID||this.SubFields.find(n=>"21"==n.StatusID||"22"==n.StatusID||"23"==n.StatusID))&&(this.SubFields.find(n=>"21"!=n.StatusID&&"22"!=n.StatusID&&"23"!=n.StatusID&&"0"!=n.StatusID)||(this.IsGeneralDocs=!1),this.IsExecutedDocs=!0),("31"==this.Header.StatusID||"32"==this.Header.StatusID||"33"==this.Header.StatusID||null!=this.SubFields.find(n=>"31"==n.StatusID||"32"==n.StatusID||"33"==n.StatusID))&&(null==this.SubFields.find(n=>"21"!=n.StatusID&&"22"!=n.StatusID&&"23"!=n.StatusID&&"0"!=n.StatusID)&&(this.IsGeneralDocs=!1),this.IsBWDocs=!0)),this.fldDict.push("value",new T.Nl("value",0)),this.fldDict.push("Value",new T.Nl("Value",0)),this.fldDict.push("VALUE",new T.Nl("VALUE",0)),this.eval.ThrowException=!1,this.eval.SetKeyWords("REPORT")}WidgetViewModel_2(i,t,e){this.Chart=i,this.WidgetID=t,this.DBWidgetFilter=e,this.Header=new W,this.InitWidget(),17==this.TypeID&&(this.Header.StatusID=this.Header.LabelType),this.Header.LabelType="CHART",this.Header.Label="",(14==this.TypeID||15==this.TypeID||19==this.TypeID||20==this.TypeID||102==this.TypeID)&&(i.ToDate.Date=new Date)}InitWidget(){let t,l,e=new s.VB,o=h.d.report.Widgets(1,this.WidgetID,"",0,1,!1,null,null);if(this.TypeID=parseInt(o.Tables[0][0].WType),this.TypeID>=21&&this.TypeID<=100&&(this.Decimals=0),(16==this.TypeID||17==this.TypeID)&&(this.IsLink=!0),null!=this.DBWidgetFilter?this.LoadTreeFilters(this.DBWidgetFilter):(l=s.J0.String(o.Tables[0][0].AccountsXML),l.length>0&&(e.LoadXml(l),this.LoadTreeFilters(e.DocumentElement))),l=s.J0.String(o.Tables[0][0].OptionsXML),l.length>0){if(e.LoadXml(l),t=s.VB.SelectSingleNode(e.DocumentElement,"Opening"),null!=t&&"1"==t.innerHTML&&(this.IncludeOpening=!0),t=s.VB.SelectSingleNode(e.DocumentElement,"Revised"),null!=t&&"1"==t.innerHTML&&(this.IncludeRevised=!0),t=s.VB.SelectSingleNode(e.DocumentElement,"PDC"),null!=t&&"1"==t.innerHTML&&(this.IncludePDC=!0),t=s.VB.SelectSingleNode(e.DocumentElement,"ShowPositive"),null!=t&&"1"==t.innerHTML&&(this.ShowPositive=!0),t=s.VB.SelectSingleNode(e.DocumentElement,"IsAccDoc"),null!=t&&"1"==t.innerHTML&&(this.IsAccDoc=!0),t=s.VB.SelectSingleNode(e.DocumentElement,"UserWiseDims"),null!=t&&t.innerHTML.length>0){let r=t.innerHTML.split(",");for(let p=0;p<r.length;p++){let u,a=h.d.report.IsGroupNode(parseInt(r[p]),0),c=h.d.report.GetDataTable("RPT041",a.TableName,h.d.SessionManager.UserID,r[p]);u="",c.forEach(m=>{u.length>0&&(u+=","),u+=s.J0.String(m.NodeID)}),0==u.length&&(u="-12345"),this.dicUserWiseDims.push(r[p],u)}}t=s.VB.SelectSingleNode(e.DocumentElement,"CurrencyType"),null!=t&&(this.CurrencyType=parseInt(t.innerHTML),1==this.CurrencyType?(s.J0.IsEmpty(h.d.SessionManager.Preferences.DimensionwiseCurrency)||0==parseInt(h.d.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(t=s.VB.SelectSingleNode(e.DocumentElement,"FCCurrency"),this.ForeignCurrencyID=parseInt(t.innerHTML)))}return(14==this.TypeID||15==this.TypeID||102==this.TypeID)&&(l=o.Tables[1][0].DefaultPreferences.toString(),e.LoadXml(l),t=s.VB.SelectSingleNode(e.DocumentElement,"Slabs"),t.childNodes.forEach(r=>{parseInt(r.innerHTML)>0&&this.Slabs.push(parseInt(r.innerHTML))})),o}LoadTreeFilters(i){let t,o,e=!1,l=Q.DefaultTreeCCID(this.TypeID.toString());for(let r=0;r<i.children.length;r++){let p=i.children[r];if(t="",e=!1,o=s.VB.SelectSingleNode(p,"Groups"),null!=o&&(e=!0,t=o.innerHTML),o=s.VB.SelectSingleNode(p,"Nodes"),null!=o&&(t.length>0&&(t+=","),t+=o.innerHTML),p.attributes.CC.value==l.toString())this.strAccounts=t,this.IsGroupsExists=e;else{let n=new A;n.Nodes=t,n.IsGroupsExists=e,"44"==p.attributes.CC.value?this.dicLookupFilters.push(parseInt(p.attributes.LookupTypeID.value),n):this.dicFilters.push(parseInt(p.attributes.CC.value),n)}}}SetDurationFilter(i,t=!0){this.DurationLinks.map(o=>o.IsLink=!1),i.IsLink=!0;let e=["CurMon","PrevMn"];return"Year"==i.Row?(e[0]="YrToDate",e[1]="LastYr"):"Quarter"==i.Row?(e[0]="QtrToDate",e[1]="PrevQtr"):"Week"==i.Row?(e[0]="WeekToDate",e[1]="PrevWeek"):"Day"==i.Row&&(e[0]="Today",e[1]="Yesterday"),t?(this.SubFields[0].LabelType=e[0],this.SubFields[1].LabelType=e[1],this.Refresh(),e):e}SetValue(i,t=0){if(s.J0.IsEmpty(i.LabelType))return null;let e=null;if(19==this.TypeID||20==this.TypeID)e=this.SetQueryBatchExpiryAgeing(i);else if(this.TypeID>=21&&this.TypeID<=100)e=this.SetQueryHRM(i);else{let o=null;if(o=14==this.TypeID||15==this.TypeID||102==this.TypeID||104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID?this.SetQueryAgeing(i):16==this.TypeID||17==this.TypeID?this.SetQueryDocumentStatus(i):103==this.TypeID?this.SetQueryDocumentLastInfo(i):this.SetQuery(i),null==o)return null;e=h.d.report.DataSetAsyn("RPT022",o)}return e?e.then(o=>{let l=this.SetValueCallBack(i,o);null!=this.Chart&&this.Chart.WidgetCallBack(t,l),this.LoadingVisibility=!1},o=>{this.LoadingVisibility=!1,Logger.ErrorLog("widget error",o),null!=this.Chart&&this.Chart.WidgetCallBack(t,null)}):void 0}SetValueCallBack(i,t){if(104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID){let e=0;if(t.Tables[0].forEach(o=>{e+=parseFloat(o.Balance)}),t.Tables[0].push({ID:3,Balance:e}),i.Value="",0==t.Tables[0].length)return null;if(!s.J0.StringIsNullOrEmpty(i.LabelType)){let o=t.Tables[0].filter(l=>l.ID==parseInt(i.LabelType));o.length>0&&(i.dbl=parseFloat(o[0].Balance),i.Value=this.GetNumberFormatted(i.dbl,2,i))}this.SubFields.forEach(o=>{if(s.J0.StringIsNullOrEmpty(o.LabelType))return;let l=t.Tables[0].filter(r=>r.ID==parseInt(o.LabelType));o.dbl=l.length>0?parseFloat(l[0].Balance):0,o.txtValue.Text=this.GetNumberFormatted(o.dbl,2,o)})}if(null!=this.Chart){if(5==this.TypeID||6==this.TypeID){let e,l,o=[];if(t.Tables[0].length>0)for(let n=t.Tables[0].length-1;n>=0;n--)if(l=o.filter(u=>u.AccountID==t.Tables[0][n].AccountID),e=parseFloat(t.Tables[0][n].Balance),l.length>0)l[0].Balance=parseFloat(l[0].Balance)+e;else{let u={};u.AccountID=t.Tables[0][n].AccountID,u.Balance=e,o.push(u)}else o=[];if(this.IncludeOpening){if(6==this.TypeID)for(let a=t.Tables[1].length-1;a>=0;a--)t.Tables[1][a].OpBalance=-parseFloat(t.Tables[1][a].OpBalance);for(let a=t.Tables[1].length-1;a>=0;a--)if(l=o.filter(c=>c.AccountID==t.Tables[1][a].AccountID),e=parseFloat(t.Tables[1][a].OpBalance),l.length>0)l[0].Balance=parseFloat(l[0].Balance)+e;else{let c={};c.AccountID=t.Tables[1][a].AccountID,c.Balance=e,o.push(c)}for(let a=t.Tables[1].length-1;a>=0;a--)parseFloat(o.filter(c=>c.AccountID==t.Tables[1][a].AccountID.toString())[0].Balance)<0&&t.Tables[1].RemoveAt(a);let n=t.Tables[1].Compute("sum","OpBalance");null==n&&(n=0),t.Tables[1].Clear();let u={};u.OpBalance=parseFloat(n),t.Tables[1].push(u)}for(let n=t.Tables[0].length-1;n>=0;n--)parseFloat(o.filter(u=>u.AccountID==t.Tables[0][n].AccountID)[0].Balance)<0&&t.Tables[0].RemoveAt(n);e=0;let r=null,p=null;if("YrWise"==this.Groups)for(let n=0;n<t.Tables[0].length;n++)r!=t.Tables[0][n].Yr.toString()?(e=parseFloat(t.Tables[0][n].Balance),r=t.Tables[0][n].Yr.toString()):(e+=parseFloat(t.Tables[0][n].Balance),t.Tables[0].RemoveAt(n),n--,t.Tables[0][n].Balance=e);else for(let n=0;n<t.Tables[0].length;n++)r!=t.Tables[0][n].Yr.toString()||p!=t.Tables[0][n].Mn.toString()?(e=parseFloat(t.Tables[0][n].Balance),r=t.Tables[0][n].Yr.toString(),p=t.Tables[0][n].Mn.toString()):(e+=parseFloat(t.Tables[0][n].Balance),t.Tables[0].RemoveAt(n),n--,t.Tables[0][n].Balance=e)}i.dbl=0,this.IncludeOpening&&(i.dbl=parseFloat(t.Tables[1][0].OpBalance)),this.ShowPositive&&(i.dbl=-i.dbl,t.Tables[0].forEach(e=>{e.Balance=-parseFloat(e.Balance)}))}else if(16==this.TypeID||17==this.TypeID)this.SetDocStatusCount(i,t),i.Value=this.GetNumberFormatted(i.dbl,0,i);else if(66==this.TypeID){let e=new Date((new Date).getFullYear(),h.d.SessionManager.AccountingFromMonth,1),o=new Date(h.d.SessionManager.AccountingFromMonth>1?(new Date).getFullYear()+1:(new Date).getFullYear(),h.d.SessionManager.AccountingToMonth,1);o=o.AddMonths(1).AddDays(-1),i.Value=e.ToString("MMM yyyy")+" - "+o.ToString("MMM yyyy")}else 67==this.TypeID?(i.breakSpaces=!0,i.Value="Assigned     Used        Balance\r\n",i.Value+=t.Tables[0].length>0?t.Tables[0][0].Assigned.toString()+"                 "+t.Tables[0][0].Deducted.toString()+"                 "+t.Tables[0][0].Balance.toString():"0                   0                 0"):103==this.TypeID||104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID||(t.Columns[0].Contains("Balance")&&s.J0.StringValue(t.ColumnsTypes[0][t.Columns[0].indexOf("Balance")]).toLowerCase().Contains("string")?t.Tables[0].length>0&&(s.J0.IsEmpty(t.Tables[0][0].Balance)||(i.Value=t.Tables[0][0].Balance.toString())):(i.dbl=t.Tables[0].length>0?parseFloat(t.Tables[0][0].Balance):0,this.ShowPositive&&(i.dbl=-i.dbl),i.Value=this.GetNumberFormatted(i.dbl,this.Decimals,i)));if(null==this.Chart){if(17==this.TypeID)this.Header.IsLink=this.IsLink,this.SubFields.forEach(e=>{this.SetDocStatusCount(e,t),e.txtValue.IsLink=this.IsLink,e.txtValue.Text=this.GetNumberFormatted(e.dbl,0,e),e.ShowPercentage&&(e.txtPercent.Text=0!=e.dbl?"  ["+(100*this.Header.dbl/e.dbl).Commas("N0")+"%]":"  ["+(0).Commas("N0")+"%]")});else if(103==this.TypeID){if(i.Value="",0==t.Tables[0].length)return null;if(!s.J0.StringIsNullOrEmpty(i.LabelType)&&t.Columns[0].Contains(i.LabelType))if("Amount"==i.LabelType){let e=s.J0.Double(t.Tables[0][0][i.LabelType]);i.Value=this.GetNumberFormatted(e,2,i)}else i.Value="DocDate"==i.LabelType?s.J0.ParseDate(s.J0.String(t.Tables[0][0][i.LabelType])).ToString(h.d.SessionManager.Preferences["Date Format"]):s.J0.String(t.Tables[0][0][i.LabelType]);this.SubFields.forEach(e=>{if(!s.J0.StringIsNullOrEmpty(e.LabelType)&&t.Columns[0].Contains(e.LabelType))if("Amount"==e.LabelType){let o=s.J0.Double(t.Tables[0][0][e.LabelType]);e.txtValue.Text=this.GetNumberFormatted(o,2,e)}else e.txtValue.Text="DocDate"==e.LabelType?s.J0.isValidDate(t.Tables[0][0][e.LabelType])?s.J0.ParseDate(t.Tables[0][0][e.LabelType]).ToString(h.d.SessionManager.Preferences["Date Format"]):"":s.J0.String(t.Tables[0][0][e.LabelType])})}else if(11==this.TypeID||12==this.TypeID||13==this.TypeID||14==this.TypeID||15==this.TypeID||18==this.TypeID||19==this.TypeID||20==this.TypeID||102==this.TypeID){if(this.SubFields.Clear(),this.SubFieldsText.Clear(),i.Value="0.00",0==t.Tables[0].length)return null;(14==this.TypeID||15==this.TypeID||102==this.TypeID)&&(i.dbl=t.Tables[0].length>0?parseFloat(t.Tables[0].Compute("sum","Balance")):0,this.ShowPositive&&(i.dbl=-i.dbl),i.Value=this.GetNumberFormatted(i.dbl,2,i));for(let e=0;e<t.Tables[0].length;e++){let o=new W;o.Row=e.toString(),o.ForeColor=this.ForeColor,o.SetSubFields(),o.txtLbl.Text=t.Tables[0][e][t.Columns[0][0]].toString();let l=parseFloat(t.Tables[0][e].Balance);this.ShowPositive&&(l=-l),o.dbl=l,o.txtValue.Text=this.GetNumberFormatted(l,2,o),(11==this.TypeID||12==this.TypeID||13==this.TypeID||18==this.TypeID)&&(o.txtPercent.Visible=!1),this.SubFields.push(o),this.SubFieldsText.push(o.txtLbl),this.SubFieldsText.push(o.txtValue),this.SubFieldsText.push(o.txtSep)}}17==this.TypeID||14==this.TypeID||15==this.TypeID||102==this.TypeID?this.SubFields.forEach(e=>{this.Header.Value&&this.Header.Value.length>0?(0!=e.dbl?(e.txtPercent.Percentage=0==this.Header.dbl||e.dbl>this.Header.dbl?100:100*e.dbl/this.Header.dbl,e.txtPercent.Percentage<0&&(e.txtPercent.Percentage=0)):e.txtPercent.Percentage=0,e.txtPercent.Text=0!=e.txtPercent.Percentage&&Math.abs(e.txtPercent.Percentage)<1?"  ["+e.txtPercent.Percentage.Commas("N1")+"%]":"  ["+e.txtPercent.Percentage.Commas("N0")+"%]"):e.txtPercent.Visible=!1}):this.SubFields.find(e=>e==i)&&(this.Header.Value&&this.Header.Value.length>0?(0!=i.dbl?(i.txtPercent.Percentage=0==this.Header.dbl||i.dbl>this.Header.dbl?100:100*i.dbl/this.Header.dbl,i.txtPercent.Percentage<0&&(i.txtPercent.Percentage=0)):i.txtPercent.Percentage=0,i.txtPercent.Text=0!=i.txtPercent.Percentage&&Math.abs(i.txtPercent.Percentage)<1?"  ["+i.txtPercent.Percentage.Commas("N1")+"%]":"  ["+i.txtPercent.Percentage.Commas("N0")+"%]"):i.txtPercent.Visible=!1)}return i.IsDataReady=!0,this.IsDurationDifference&&2==this.SubFields.length&&!this.SubFields.find(e=>!e.IsDataReady)&&(this.Header.dbl=this.SubFields[0].dbl-this.SubFields[1].dbl,this.Header.Value=this.GetNumberFormatted(this.Header.dbl,this.Decimals,this.Header)),t.Tables[0]}SetQuery(i){let l,t=!1,e="",o="",r="",p="",n="",u="",a="";null!=this.Chart&&11!=this.TypeID&&12!=this.TypeID&&13!=this.TypeID&&18!=this.TypeID&&(t=!0),e=this.IncludeOpening&&null==this.Chart?" and D.DocDate<=@To":" and D.DocDate between @Fr and @To";let c=this.GetDateVariable(i);u="D.DocDate<@Fr";let m=" AND (D.StatusID=369 or D.StatusID=429)",F="(D.StatusID=370 OR D.StatusID=439 OR D.StatusID=452)";this.IncludePDC?(n=this.IncludeOpening&&!t?" AND ("+F+" OR (D.DocumentType<>14 AND D.DocumentType<>19"+m+"))":" AND D.DocumentType<>16 AND ("+F+" OR (D.DocumentType<>14 AND D.DocumentType<>19"+m+"))",u+=" AND ("+F+" OR (D.DocumentType<>14 AND D.DocumentType<>19"+m+"))"):(n=this.IncludeOpening&&!t?" AND D.DocumentType NOT IN (14,19)"+m:" AND D.DocumentType NOT IN (16,14,19)"+m,u+=" AND D.DocumentType<>14 AND D.DocumentType<>19"+m);let C=this.GetDimensionWhere("DCC.dcCCNID");(C.length>0||this.Groups.startsWith("DIM_"))&&(r=" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID",p=" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),this.ForeignCurrencyID>0?(l="AmountFC",o=" AND D.CurrencyID="+this.ForeignCurrencyID):(l=1==this.CurrencyType?"AmountBC":"Amount",o="");let D="",S="",R="",b="",B="";if(5==this.TypeID||6==this.TypeID||11==this.TypeID||12==this.TypeID||18==this.TypeID?(S="A.AccountID,",R+="A.AccountID,"):13==this.TypeID&&(S="INV.ProductID,",R+="INV.ProductID,"),"YrWise"==this.Groups?(S+="year(convert(datetime,D.DocDate)) Yr,",R+="year(convert(datetime,D.DocDate)),",b+="Yr,"):"MnWise"==this.Groups||"QtrWise"==this.Groups?(S+="year(convert(datetime,D.DocDate)) Yr,month(convert(datetime,D.DocDate)) Mn,",R+="year(convert(datetime,D.DocDate)),month(convert(datetime,D.DocDate)),",b+="Yr,Mn,"):this.Groups.startsWith("DIM_")&&(S+="DIM.Name,",R+="DIM.Name,",b+="Name,",r+=" join "+I.A.GetTagTableName(parseInt(this.Groups.substr(4)))+" DIM with(nolock) on DIM.NodeID=DCC.dcCCNID"+(parseInt(this.Groups.substr(4))-5e4),p+=" join "+I.A.GetTagTableName(parseInt(this.Groups.substr(4)))+" DIM with(nolock) on DIM.NodeID=DCC.dcCCNID"+(parseInt(this.Groups.substr(4))-5e4)),R.length>0&&(R=" GROUP BY "+R.Trim(",")),11==this.TypeID||12==this.TypeID||13==this.TypeID)this.strAccounts.length>0?(this.IsGroupsExists?(B=" join ACC_Accounts GT on A2.lft BETWEEN GT.lft AND GT.rgt",D=this.strAccounts.Contains(",")?"GT.AccountID IN ("+this.strAccounts+")":"GT.AccountID="+this.strAccounts):D=this.strAccounts.Contains(",")?"A2.AccountID IN ("+this.strAccounts+")":"A2.AccountID="+this.strAccounts,11==this.TypeID||13==this.TypeID?D+=" and A.AccountTypeID=7":12==this.TypeID&&(D+=" and A.AccountTypeID=6")):11==this.TypeID||13==this.TypeID?D="A.AccountTypeID=7 and (A2.AccountTypeID=4 or A2.AccountTypeID=11)":12==this.TypeID&&(D="A.AccountTypeID=6 and (A2.AccountTypeID=5 or A2.AccountTypeID=14)"),r+=" join ACC_Accounts A2 with(nolock) on D.XXA2XX=A2.AccountID",p+=" join ACC_Accounts A2 with(nolock) on D.XXA2XX=A2.AccountID",13==this.TypeID&&(r+=" join INV_DocDetails INV with(nolock) on D.InvDocDetailsID=INV.InvDocDetailsID",p+=" join INV_DocDetails INV with(nolock) on D.InvDocDetailsID=INV.InvDocDetailsID");else if(this.strAccounts.length>0)this.IsGroupsExists?(B=" join ACC_Accounts GT on A.lft BETWEEN GT.lft AND GT.rgt",D=this.strAccounts.Contains(",")?"GT.AccountID IN ("+this.strAccounts+")":"GT.AccountID="+this.strAccounts):D=this.strAccounts.Contains(",")?"A.AccountID IN ("+this.strAccounts+")":"A.AccountID="+this.strAccounts;else if(101==this.TypeID)D="A.AccountTypeID=4";else if(2==this.TypeID)D="A.AccountTypeID=5";else if(3==this.TypeID||18==this.TypeID)D="(A.AccountTypeID=9 or A.AccountTypeID=12)";else if(4==this.TypeID)D="(A.AccountTypeID=8 or A.AccountTypeID=11)";else if(5==this.TypeID||6==this.TypeID)D="(A.AccountTypeID=6 or A.AccountTypeID=7)";else if(7==this.TypeID)D="(A.AccountTypeID=1 or A.AccountTypeID=10)";else if(8==this.TypeID)D="(A.AccountTypeID=2 or A.AccountTypeID=3)";else if(9==this.TypeID||10==this.TypeID)return null;return a+=c+"\r\n",5==this.TypeID||6==this.TypeID?(a+=b.length>0?"select "+b+"AccountID,isnull(sum(Balance),0) Balance from(":"select "+b+"isnull(sum(Balance),0) Balance from(",a+=5==this.TypeID?"select "+b+"AccountID,sum(Dr)-sum(Cr) Balance from(":"select "+b+"AccountID,sum(Cr)-sum(Dr) Balance from("):a+=11==this.TypeID||18==this.TypeID?"select top 5 A.AccountName,isnull(sum(Dr)-sum(Cr),0) Balance from(":12==this.TypeID?"select top 5 A.AccountName,isnull(sum(Cr)-sum(Dr),0) Balance from(":13==this.TypeID?"select top 5 P.ProductName,isnull(sum(Dr)-sum(Cr),0) Balance from(":"select "+b+"sum(Dr)-sum(Cr) Balance from(",""==D&&(D="1=1"),a+="\nselect "+S+"sum("+l+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+r.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+B+"\nwhere "+D+e+C+n+o,a+=R,a+="\nunion all\nselect "+S+"0 Dr,sum("+l+") Cr from Acc_DocDetails D with(nolock)"+r.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+B+"\nwhere "+D+e+C+n+o,a+=R,C.length>0&&(a+="\nunion all\nselect "+S+"sum("+l+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+p.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+B+"\nwhere "+D+e+C+o+" AND D.StatusID=369",a+=R,a+="\nunion all\nselect "+S+"0 Dr,sum("+l+") Cr from Acc_DocDetails D with(nolock)"+p.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+B+"\nwhere "+D+e+C+o+" AND D.StatusID=369",a+=R),(5==this.TypeID||6==this.TypeID)&&(a+=")AS T group by AccountID",b.length>0?(a+=","+b.Trim(","),b+="AccountID,"):a+=5==this.TypeID?" having sum(Dr)-sum(Cr)>0":" having sum(Dr)-sum(Cr)<0"),a+=")AS T",11==this.TypeID||12==this.TypeID||18==this.TypeID?(a+=" join ACC_Accounts A with(nolock) on T.AccountID=A.AccountID",a+=" GROUP BY A.AccountName",a+=" ORDER BY Balance DESC"):13==this.TypeID?(a+=" join INV_Product P with(nolock) on T.ProductID=P.ProductID",a+=" GROUP BY P.ProductName",a+=" ORDER BY Balance DESC"):b.length>0&&(a+=" GROUP BY "+b.Trim(","),a+=" ORDER BY "+b.Trim(",")),this.IncludeOpening&&t&&(5==this.TypeID||6==this.TypeID?(S="A.AccountID,",R=" GROUP BY A.AccountID",b="AccountID,"):S=R=b="",a+="\n--OPENING\nselect "+b+"sum(Dr)-sum(Cr) OpBalance from(",a+="\nselect "+S+"sum("+l+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+r.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+B+"\nwhere "+D+C+o+" and ((D.DocumentType=16"+m+") OR ("+u+"))"+R,a+="\nunion all\nselect "+S+"0 Dr,sum("+l+") Cr from Acc_DocDetails D with(nolock)"+r.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+B+"\nwhere "+D+C+o+" and ((D.DocumentType=16"+m+") OR ("+u+"))"+R,C.length>0&&(a+="\nunion all\nselect "+S+"sum("+l+") Dr,0 Cr from Acc_DocDetails D with(nolock)"+p.Replace("XXA2XX","CreditAccount")+"\njoin ACC_Accounts A with(nolock) on D.DebitAccount=A.AccountID"+B+"\nwhere "+D+C+o+" and D.DocDate<@Fr AND D.StatusID=369"+R,a+="\nunion all\nselect "+S+"0 Dr,sum("+l+") Cr from Acc_DocDetails D with(nolock)"+p.Replace("XXA2XX","DebitAccount")+"\njoin ACC_Accounts A with(nolock) on D.CreditAccount=A.AccountID"+B+"\nwhere "+D+C+o+" and D.DocDate<@Fr AND D.StatusID=369"+R),a+=")AS T",b.length>0&&(a+=" group by "+b.TrimEnd(","),a+=" order by "+b.TrimEnd(","))),a.toString()}SetQueryAgeing(i){let o,t="",e="",l="",r="",p=new Date;!s.J0.IsEmpty(this.dtFilterAsnDate)&&1!=this.dtFilterAsnDate.getFullYear()&&(p=this.dtFilterAsnDate),t="declare @Fr float,@To float",null!=this.Chart?(t+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))"):t+=" set @Fr=0 set @To=convert(float,convert(datetime,'"+p.ToString("dd MMM yyyy")+"'))";let n=" AND (B.StatusID=369 or B.StatusID=429)";l=this.IncludePDC?" AND ((B.StatusID=370 OR B.StatusID=439 OR B.StatusID=452) OR (B.DocType<>14 AND B.DocType<>19"+n+"))":" AND B.DocType NOT IN (14,19)"+n;let a=this.GetDimensionWhere("B.dcCCNID");this.ForeignCurrencyID>0?(o="AmountFC",e=" AND B.AdjCurrID="+this.ForeignCurrencyID):(o=1==this.CurrencyType?"AmountBC":"AdjAmount",e="");let c="",m="";if(this.strAccounts.length>0?this.IsGroupsExists?(m=" JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID join ACC_Accounts GT on A.lft BETWEEN GT.lft AND GT.rgt",c=this.strAccounts.Contains(",")?" and GT.AccountID IN ("+this.strAccounts+")":" and GT.AccountID="+this.strAccounts):c=this.strAccounts.Contains(",")?" and B.AccountID IN ("+this.strAccounts+")":" and B.AccountID="+this.strAccounts:(m=" JOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID",c=" and (A.AccountTypeID=6 or A.AccountTypeID=7)"),r+=t+"\r\n",r+="declare @TblAccs as Table(AccID bigint) ",104!=this.TypeID&&105!=this.TypeID&&106!=this.TypeID&&107!=this.TypeID){r+=" declare @Tbl As Table(ID INT,Slab nvarchar(15),FromDate FLOAT,ToDate FLOAT)";for(let C=0;C<=this.Slabs.length;C++)r+=C==this.Slabs.length?" INSERT INTO @Tbl VALUES("+C+",'>"+this.Slabs[this.Slabs.length-1]+"',1,@To-"+this.Slabs[this.Slabs.length-1]+")":0==C?" INSERT INTO @Tbl VALUES("+C+",'0-"+(this.Slabs[C]-1)+"',@To-"+(this.Slabs[C]-1)+",@To)":" INSERT INTO @Tbl VALUES("+C+",'"+this.Slabs[C-1]+"-"+(this.Slabs[C]-1)+"',@To-"+(this.Slabs[C]-1)+",@To-"+this.Slabs[C-1]+")"}let F="";return F=15==this.TypeID||105==this.TypeID||106==this.TypeID?"<0":14==this.TypeID||104==this.TypeID||107==this.TypeID?">0":"!=0",104==this.TypeID||105==this.TypeID||106==this.TypeID||107==this.TypeID?(r+="\nselect DueStatus ID,"+(105==this.TypeID||106==this.TypeID?"-":"")+"isnull(sum(Balance),0) Balance from\n(\nSELECT case when isnull(DocDueDate,DocDate)<@To then 2 else 1 end DueStatus\n,"+o+"+ISNULL((SELECT SUM(CB."+o+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To"+l.Replace("B.","CB.")+"),0) Balance\nFROM COM_Billwise B with(nolock)\nJOIN ACC_Accounts A WITH(NOLOCK) ON B.AccountID=A.AccountID\nWHERE B.IsNewReference=1 AND B.DocDate<=@To",104==this.TypeID||106==this.TypeID?r+=" and A.AccountTypeID=7":(105==this.TypeID||107==this.TypeID)&&(r+=" and A.AccountTypeID=6"),r+=l,r+=a,r+=e,r+="\n) AS T\nwhere Balance"+F+"\ngroup by DueStatus"):(r+="\n            insert into @TblAccs\n            select AccountID from (\n            SELECT B.AccountID\n            ,"+o+"+ISNULL((SELECT SUM(CB."+o+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To"+l.Replace("B.","CB.")+"),0) Balance\n            FROM COM_Billwise B with(nolock)"+m+"\n            WHERE B.IsNewReference=1 AND B.DocDate<=@To",r+=l+c,r+=a,r+=e,r+="\n            ) as T\n            group by AccountID\n            having sum(Balance)"+F+" and abs(sum(Balance))>0.01",r+="\n    select S.Slab,"+(15==this.TypeID?"-":"")+"isnull(sum(Balance),0) Balance from\n    (\n    SELECT T.ID\n    ,"+o+"+ISNULL((SELECT SUM(CB."+o+") FROM COM_Billwise CB with(nolock) WHERE CB.RefDocNo=B.DocNo AND CB.AccountID=B.AccountID AND CB.RefDocSeqNo=B.DocSeqNo AND IsNewReference=0 AND CB.DocDate<=@To"+l.Replace("B.","CB.")+"),0) Balance\n    FROM COM_Billwise B with(nolock)\n    join @TblAccs TA on TA.AccID=B.AccountID\n    join @Tbl T on B.DocDate BETWEEN T.FromDate AND T.ToDate\n    WHERE B.IsNewReference=1 AND B.DocDate<=@To",r+=l,r+=a,r+=e,r+="\n    ) AS T\n    right join @Tbl S on S.ID=T.ID\n    where Balance"+F+"\n    group by S.ID,S.Slab\n    order by S.ID"),r.toString()}SetQueryDocumentStatus(i){let e,t="",o="",l="";t="AsOnDate"==i.LabelType?" and D.DocDate<=@To":" and D.DocDate between @Fr and @To";let r=this.GetDateVariable(i),n=this.GetDimensionWhere("DCC.dcCCNID");n.length>0&&(o=this.IsAccDoc?" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),(2==h.d.SessionManager.RoleType||3==h.d.SessionManager.RoleType)&&(n+=" and (D.DebitAccount="+h.d.SessionManager.ESSID+" or D.CreditAccount="+h.d.SessionManager.ESSID+")"),e=this.IsAccDoc?"ACC_DocDetails":"INV_DocDetails";let u="",a="",c="",m="";if("YrWise"==this.Groups?(a+="year(convert(datetime,D.DocDate)) Yr,",c+="year(convert(datetime,D.DocDate)),",m+="Yr,"):("MnWise"==this.Groups||"QtrWise"==this.Groups)&&(a+="year(convert(datetime,D.DocDate)) Yr,month(convert(datetime,D.DocDate)) Mn,",c+="year(convert(datetime,D.DocDate)),month(convert(datetime,D.DocDate)),",m+="Yr,Mn,"),c.length>0&&(c=" GROUP BY "+c.Trim(",")),u=this.strAccounts.length>0?this.strAccounts.Contains(",")?"D.CostCenterID in ("+this.strAccounts+")":"D.CostCenterID="+this.strAccounts:"1=1",16==this.TypeID&&"0"!=i.StatusID&&"21"!=i.StatusID&&"22"!=i.StatusID&&"23"!=i.StatusID&&"31"!=i.StatusID&&"32"!=i.StatusID&&"33"!=i.StatusID&&(u+=" and D.StatusID="+i.StatusID),l+=r+"\r\n",this.IsGeneralDocs?("376"!=this.Header.StatusID&&!this.SubFields.find(C=>"376"==C.StatusID)&&(n+=" and D.StatusID!=376"),l+="select T.StatusID,count(*) Balance,sum(VersionNo) Revised\nfrom\n(\nselect DocID,VoucherNo,case when count(*)>1 then -1 else max(StatusID) end StatusID,VersionNo\nfrom\n(\nselect "+a+"DocID,VoucherNo,StatusID,VersionNo\nfrom "+e+" D with(nolock)"+o+"\nwhere "+u+t+n+"\ngroup by DocID,VoucherNo,StatusID,VersionNo\n) AS T\ngroup by DocID,VoucherNo,VersionNo\n) AS T\ngroup by T.StatusID"):l+=" select 0 NOQUERY where 1!=1",!this.IsAccDoc&&this.IsExecutedDocs&&this.strAccounts.length>0){let C=this.strAccounts.split(",");l+="\nselect StatusID,count(*) Balance from(\nselect DocID,case when sum(Quantity)<=sum(ExeQty) then 22 when sum(ExeQty)>0 and sum(Quantity)>sum(ExeQty) then 23 else 21 end StatusID\nfrom(\r\n";for(let D=0;D<C.length;D++){let S=!0;if(!this.dicExecutedQuery.ContainsKey(C[D])){let R=h.d.report.GetExecutedQtyQuery(0,C[D],null,null,S,!1);R=0==R.length?"0":R.Replace("INV.","D.").Replace("inv.","D."),this.dicExecutedQuery.push(C[D],R)}D>0&&(l+="\r\nunion all\r\n"),this.dicExecutedQuery[C[D]].Contains("NUM")&&!o.Contains("COM_DocNumData")&&(o+=this.IsAccDoc?" join COM_DocNumData NUM with(nolock) on NUM.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocNumData NUM with(nolock) on NUM.InvDocdetailsID=D.InvDocdetailsID"),l+="SELECT D.DocID,D.Quantity,"+this.dicExecutedQuery[C[D]]+" ExeQty\nFROM INV_DocDetails D with(nolock)"+o+"\nWHERE D.CostCenterID="+C[D]+" and D.StatusID!=376"+t+n}l+=") AS T\ngroup by DocID\n) as T\ngroup by StatusID"}else l+=" select 0 NOQUERY where 1!=1";return this.IsBWDocs&&(l+="\n            select StatusID, count(*) Balance from(\n                select case when PaidAmt = 0 then 31 when BillAmt > PaidAmt then 32  else 33 end StatusID from(\n                    select VoucherNo\n                    , (SELECT ISNULL(SUM(abs(AdjAmount)), 0) FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.DocNo = D.VoucherNo) BillAmt\n                , (SELECT ISNULL(SUM(abs(AdjAmount)), 0) FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference = 0 AND(CB.RefDocNo = D.VoucherNo OR CB.DocNo = D.VoucherNo)) PaidAmt\n            from "+e+" D with (nolock) "+o+"\n            where "+u+t+n+" and StatusID = 369\n            group by VoucherNo) AS T\n) AS T\n            group by StatusID"),l.toString()}SetQueryDocumentStatusDetails(i,t){let o,e="",l="",r="";e="AsOnDate"==i.LabelType?" and D.DocDate<=@To":" and D.DocDate between @Fr and @To";let p=this.GetDateVariable(i),u=this.GetDimensionWhere("DCC.dcCCNID");u.length>0&&(l=this.IsAccDoc?" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),o=this.IsAccDoc?"ACC_DocDetails":"INV_DocDetails";let a="",c="",m="",F="";if("YrWise"==this.Groups?(c+="year(convert(datetime,D.DocDate)) Yr,",m+="year(convert(datetime,D.DocDate)),",F+="Yr,"):("MnWise"==this.Groups||"QtrWise"==this.Groups)&&(c+="year(convert(datetime,D.DocDate)) Yr,month(convert(datetime,D.DocDate)) Mn,",m+="year(convert(datetime,D.DocDate)),month(convert(datetime,D.DocDate)),",F+="Yr,Mn,"),m.length>0&&(m=" GROUP BY "+m.Trim(",")),a=this.strAccounts.length>0?this.strAccounts.Contains(",")?"D.CostCenterID in ("+this.strAccounts+")":"D.CostCenterID="+this.strAccounts:"1=1","0"!=t&&"21"!=t&&"22"!=t&&"23"!=t&&"31"!=t&&"32"!=t&&"33"!=t&&(a+=" and D.StatusID="+t),r+=p+"\r\n","21"!=t&&"22"!=t&&"23"!=t)"376"!=this.Header.StatusID&&!this.SubFields.find(D=>"376"==D.StatusID)&&(u+=" and D.StatusID!=376"),r+="\nselect convert(datetime,D.DocDate) DocDate,D.VoucherNo"+(this.IsAccDoc?"":",sum(D.Quantity) Quantity")+"\nfrom "+o+" D with(nolock)"+l+"\nwhere "+a+e+u+"\ngroup by DocDate,VoucherNo\n";else if(!this.IsAccDoc&&this.IsExecutedDocs&&this.strAccounts.length>0){let D=this.strAccounts.split(",");r+="\nselect Convert(DateTime,DocDate) DocDate,VoucherNo,sum(Quantity) Quantity,sum(ExeQty) ExeQty,case when sum(Quantity)<=sum(ExeQty) then 22 when sum(ExeQty)>0 and sum(Quantity)>sum(ExeQty) then 23 else 21 end StatusID\nfrom(\r\n";for(let S=0;S<D.length;S++){let R=!0;if(!this.dicExecutedQuery.ContainsKey(D[S])){let b=h.d.report.GetExecutedQtyQuery(0,D[S],null,null,R,!1);b=0==b.length?"0":b.Replace("INV.","D.").Replace("inv.","D."),this.dicExecutedQuery.push(D[S],b)}S>0&&(r+="\r\nunion all\r\n"),this.dicExecutedQuery[D[S]].Contains("NUM")&&!l.Contains("COM_DocNumData")&&(l+=this.IsAccDoc?" join COM_DocNumData NUM with(nolock) on NUM.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocNumData NUM with(nolock) on NUM.InvDocdetailsID=D.InvDocdetailsID"),r+="SELECT D.DocDate,D.VoucherNo,D.Quantity,"+this.dicExecutedQuery[D[S]]+" ExeQty\nFROM INV_DocDetails D with(nolock)"+l+"\nWHERE D.CostCenterID="+D[S]+" and D.StatusID!=376"+e+u}r+="\n) AS T\ngroup by DocDate,VoucherNo","21"==t?r+=" having sum(ExeQty)=0":"22"==t?r+=" having sum(Quantity)<=sum(ExeQty)":"23"==t&&(r+=" having sum(ExeQty)>0 and sum(Quantity)>sum(ExeQty)")}return r.toString()}SetQueryDocumentLastInfo(i){let e,o="",l="",r=this.GetDimensionWhere("DCC.dcCCNID");r.length>0&&(o=this.IsAccDoc?" join COM_DocCCDATA DCC with(nolock) on DCC.AccDocDetailsID=D.AccDocDetailsID":" join COM_DocCCDATA DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID"),(2==h.d.SessionManager.RoleType||3==h.d.SessionManager.RoleType)&&(r+=" and (D.DebitAccount="+h.d.SessionManager.ESSID+" or D.CreditAccount="+h.d.SessionManager.ESSID+")"),e=this.IsAccDoc?"ACC_DocDetails":"INV_DocDetails";let u,p="";return p=this.strAccounts.length>0?this.strAccounts.Contains(",")?"D.CostCenterID in ("+this.strAccounts+")":"D.CostCenterID="+this.strAccounts:"1=1",u=this.IsAccDoc?",sum(D.Amount)/2 Amount":",sum(D.StockValue) Amount",l="\n        declare @Vno nvarchar(max)\n        select top 1 @Vno=VoucherNo\n        from "+e+" D with (nolock) "+o+"\n        where "+p+r+"\n        order by D.Docdate desc, D.CreatedDate desc\n\n        select max(VoucherNo) VoucherNo, Convert(datetime, max(DocDate)) DocDate"+u+"\n        from "+e+" D with (nolock) "+o+"\n        where VoucherNo =@Vno",l.toString()}SetQueryBatchExpiryAgeing(i){let e=new Date;null!=this.Chart&&(e=this.Chart.ToDate.Date);let o=this.GetDimensionWhere("DCC.dcCCNID"),l=[];return l.push(e),l.push(19==this.TypeID?1:0),l.push(o),l.push(h.d.SessionManager.LanguageID),h.d.report.BatchAgeing(l)}SetQueryHRM(i){let t=this.GetDateVariable(i),e="",o="";22==this.TypeID||23==this.TypeID||24==this.TypeID||28==this.TypeID||29==this.TypeID||30==this.TypeID||31==this.TypeID||33==this.TypeID||36==this.TypeID||37==this.TypeID||38==this.TypeID||59==this.TypeID||63==this.TypeID||64==this.TypeID?(o="DCC.CCNID",e=this.GetDimensionWhere("DCC.CCNID")):(o="DCC.dcCCNID",e=this.GetDimensionWhere("DCC.dcCCNID")),this.dicLookupFilters.ContainsKey(108)&&(this.dicLookupFilters[108].Nodes.Contains(",")?e+=" and E.Nationality in ("+this.dicLookupFilters[108].Nodes+")":e+=" and E.Nationality="+this.dicLookupFilters[108].Nodes),this.dicLookupFilters.ContainsKey(123)&&(this.dicLookupFilters[123].Nodes.Contains(",")?e+=" and E.Gender in ("+this.dicLookupFilters[123].Nodes+")":e+=" and E.Gender="+this.dicLookupFilters[123].Nodes),"True"==h.d.SessionManager.Preferences.EnableDivisionWise.toString()&&(h.d.SessionManager.DivisionID>0?e+=" and "+o+"1="+h.d.SessionManager.DivisionID:"1"!=h.d.SessionManager.RoleID&&h.d.SessionManager.DivisionWhere.length>0&&(e+=" and "+o+"1 in ("+h.d.SessionManager.DivisionWhere+")"));let l=[];return l.push(this.TypeID),l.push(this.Groups),l.push(t),l.push(e),l.push(h.d.SessionManager.LanguageID),h.d.report.GetWidgetHRM(l)}GetDateVariable(i){let t="";t="declare @Fr float,@To float,@EMPID bigint",this.HeaderValuePostfix="";let e=new Date;s.J0.IsEmpty(this.dtFilterAsnDate)||1!=this.dtFilterAsnDate.getFullYear()&&(e=this.dtFilterAsnDate);let o=new Date((new Date).getFullYear(),h.d.SessionManager.AccountingFromMonth-1,1);if(o>new Date&&(o=o.AddYears(-1)),null!=this.Chart)101==this.Chart.Parent.EmpWidgetTypeID?(t+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))"):this.PrevData>0?(t+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.AddYears(-this.PrevData).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))"):(t+=" set @Fr=convert(float,convert(datetime,'"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'))");else if("Today"==i.LabelType)this.HeaderValuePostfix="Today",t+=" set @Fr=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"')) set @To=@Fr";else if("Yesterday"==i.LabelType)this.HeaderValuePostfix="YSTD",t+=" set @Fr=convert(float,convert(datetime,'"+e.AddDays(-1).ToString("dd MMM yyyy")+"')) set @To=@Fr";else if("AsOnDate"==i.LabelType)this.HeaderValuePostfix="AOD",t+=" set @Fr=0 set @To=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))";else if("MnToDate"==i.LabelType)this.HeaderValuePostfix="MTD",t+=" set @Fr=convert(float,convert(datetime,'"+new Date(e.getFullYear(),e.getMonth(),1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))";else if("QtrToDate"==i.LabelType){this.HeaderValuePostfix="QTD";let l=(e.iMonth()-1)/3+1;t+=" set @Fr=convert(float,convert(datetime,'"+new Date(e.getFullYear(),3*(l-1)+1,1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))"}else if("YrToDate"==i.LabelType)this.HeaderValuePostfix="YTD",t+=" set @Fr=convert(float,convert(datetime,'"+o.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))";else if("CurMon"==i.LabelType)this.HeaderValuePostfix="CM",e=new Date(e.getFullYear(),e.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("CurMonToDate"==i.LabelType)this.HeaderValuePostfix="CMTD",t+=" set @Fr=convert(float,convert(datetime,'"+new Date(e.getFullYear(),e.getMonth(),1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))";else if("PrevMn"==i.LabelType)this.HeaderValuePostfix="PM",e=new Date(e.getFullYear(),e.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+e.AddMonths(-1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("PrevMnToDate"==i.LabelType)this.HeaderValuePostfix="PMTD",t+=" set @To=convert(float,convert(datetime,'"+e.AddMonths(-1).ToString("dd MMM yyyy")+"'))",e=new Date(e.getFullYear(),e.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+e.AddMonths(-1).ToString("dd MMM yyyy")+"'))";else if("PrevQtr"==i.LabelType){this.HeaderValuePostfix="PQ";let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear(),3*(l-1),1),t+=" set @Fr=convert(float,convert(datetime,'"+e.AddMonths(-3).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddDays(-1).ToString("dd MMM yyyy")+"'))"}else if("PrevQtrToDate"==i.LabelType){this.HeaderValuePostfix="PQTD";let l=(e.iMonth()-1)/3+1;t+=" set @To=convert(float,convert(datetime,'"+new Date(e.getFullYear(),3*(l-1)+1,1).AddMonths(-3).ToString("dd MMM yyyy")+"'))",t+=" set @Fr=convert(float,convert(datetime,'"+e.AddMonths(-3).ToString("dd MMM yyyy")+"'))"}else if("LastYr"==i.LabelType)this.HeaderValuePostfix="LY",t+=" set @Fr=convert(float,convert(datetime,'"+o.AddYears(-1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+o.AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrToDate"==i.LabelType)this.HeaderValuePostfix="LYTD",new Date(e.getFullYear()-1,1,1),t+=" set @Fr=convert(float,convert(datetime,'"+o.AddYears(-1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddYears(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrMn"==i.LabelType)this.HeaderValuePostfix="LYM",e=new Date(e.getFullYear()-1,e.getMonth(),1),t+=" set @Fr=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrMnToDate"==i.LabelType)this.HeaderValuePostfix="LYMTD",t+=" set @Fr=convert(float,convert(datetime,'"+new Date(e.getFullYear()-1,e.getMonth(),1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddYears(-1).ToString("dd MMM yyyy")+"'))";else if("LastYrQtr"==i.LabelType){this.HeaderValuePostfix="LYQ";let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear()-1,3*(l-1),1),t+=" set @Fr=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddMonths(3).AddDays(-1).ToString("dd MMM yyyy")+"'))"}else if("LastYrQtrToDate"==i.LabelType){this.HeaderValuePostfix="LYQTD";let l=(e.iMonth()-1)/3+1;t+=" set @Fr=convert(float,convert(datetime,'"+new Date(e.getFullYear()-1,3*(l-1)+1,1).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddYears(-1).ToString("dd MMM yyyy")+"'))"}else if("WeekToDate"==i.LabelType){this.HeaderValuePostfix="WTD";let r=(new Date).getDay()-1;t+=" set @Fr=convert(float,convert(datetime,'"+e.AddDays(-r).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.ToString("dd MMM yyyy")+"'))"}else if("PrevWeek"==i.LabelType){this.HeaderValuePostfix="LWTD";let r=(new Date).getDay()-1;t+=" set @Fr=convert(float,convert(datetime,'"+e.AddDays(-(r+7)).ToString("dd MMM yyyy")+"'))",t+=" set @To=convert(float,convert(datetime,'"+e.AddDays(-(r+1)).ToString("dd MMM yyyy")+"'))"}return t+=" set @EMPID="+h.d.SessionManager.iEmployee,t}GetDimensionWhere(i){let t="";return"True"==h.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==h.d.SessionManager.Preferences["LW Reports"]&&(h.d.SessionManager.LocationID>0?t=" and "+i+"2="+h.d.SessionManager.LocationID:"1"!=h.d.SessionManager.RoleID&&h.d.SessionManager.LocationWhere.length>0&&(t=" and "+i+"2 in ("+h.d.SessionManager.LocationWhere+")")),this.dicUserWiseDims.keys.forEach(e=>{let o={Key:e,Value:this.dicUserWiseDims[e]};o.Value.Contains(",")?t+=" and "+i+(parseInt(o.Key)-5e4)+" in ("+o.Value+")":t+=" and "+i+(parseInt(o.Key)-5e4)+"="+o.Value}),this.dicFilters.keys.forEach(e=>{let o={Key:e,Value:this.dicFilters[e]};o.Key>5e4&&(o.Value.Nodes.Contains(",")?t+=" and "+i+(o.Key-5e4)+" in ("+o.Value.Nodes+")":t+=" and "+i+(o.Key-5e4)+"="+o.Value.Nodes)}),t}SetDocStatusCount(i,t){let o=t.Tables[0];if("21"==i.StatusID||"22"==i.StatusID||"23"==i.StatusID?o=t.Tables[1]:"31"==i.StatusID||"32"==i.StatusID||"33"==i.StatusID?o=t.Tables[2]:"0"==i.StatusID&&t.Columns[0].Contains("NOQUERY")&&(o=t.Tables[1]),"0"==i.StatusID){let l=o.filter(r=>376!=r.StatusID).Compute("sum","Balance");if(i.dbl=null!=l?parseFloat(l):0,this.IncludeRevised&&t.Columns.Contains("Revised")){let r=o.filter(p=>376!=p.StatusID).Compute("sum","Revised");i.dbl=i.dbl+(null!=r?parseFloat(r):0)}}else if(this.IncludeRevised&&"24"==i.StatusID&&t.Columns.Contains("Revised")){let l=o.filter(r=>376!=r.StatusID).Compute("sum","Revised");i.dbl=null!=l?parseFloat(l):0}else{let l=o.filter(r=>r.StatusID==i.StatusID);i.dbl=l.length>0?parseFloat(l[0].Balance):0}}Refresh(){this.LoadingVisibility=!0;try{if(26==this.TypeID||27==this.TypeID)return void this.WidgetCalendar.Refresh();let i=this.SetValue(this.Header);this.Header.Visible&&null!=this.Header.txtLbl&&this.HeaderValuePostfix.length>0&&(this.Header.txtLbl.Text=" ["+this.HeaderValuePostfix+"]"),11!=this.TypeID&&12!=this.TypeID&&13!=this.TypeID&&14!=this.TypeID&&15!=this.TypeID&&17!=this.TypeID&&18!=this.TypeID&&19!=this.TypeID&&20!=this.TypeID&&102!=this.TypeID&&103!=this.TypeID&&104!=this.TypeID&&105!=this.TypeID&&106!=this.TypeID&&107!=this.TypeID&&(null==i&&(i=new Promise((t,e)=>{t("hi")})),i.then(()=>{this.SubFields.map(t=>0==t.IsDataReady),this.SubFields.forEach(t=>{this.SetValue(t)})},t=>{this.LoadingVisibility=!1}))}catch(i){this.LoadingVisibility=!1,Logger.ErrorLog("Widget Refresh: ",i)}}OnValueClick(i){let t=null!=i?i.WzLbl.StatusID:this.Header.StatusID,e=this.SetQueryDocumentStatusDetails(this.Header,t);if(null==e)return;let o=h.d.report.DataSet("RPT022",e);this.CallStatusID=t;let l=new f.AccountDrillDownViewModel(null,this);l.Title=null!=i?i.WzLbl.txtLbl.Text:this.Header.Label,l.LoadWidgetData(o),h.d.page.ShowDialog(l,y._,{ShowCenter:!0})}static DefaultTreeCCID(i){let t=0;return t="16"==i||"17"==i||"103"==i?300:"21"==i||"22"==i||"23"==i||"24"==i||"25"==i||"26"==i||"27"==i?50002:2,t}GetNumberFormatted(i,t,e){let o="";if(s.J0.IsEmptySpace(e.Formula)){let l="";l=t>0?"N"+t.toString():"N0",o=i.Commas(l)}else{let l=this.fldDict;this.fldDict.value.setFieldValue(i),this.fldDict.Value.setFieldValue(i),this.fldDict.VALUE.setFieldValue(i);try{o=this.eval.EvaluateExpression(e.Formula,l).toString()}catch{let p="";p=t>0?"N"+t.toString():"N0",o="#"+i.Commas(p)}}return o}OnNumberClick(i){if(17==this.TypeID||16==this.TypeID){let t="",e=this.GetDateFilterXML(i);if(e.length>0&&(t="<XML>"+e+"</XML>"),0==this.strAccounts.length)return void alert("No Documents Selected For Widget");let o=s.J0.Int(i.StatusID),l=this.strAccounts.split(",");21==o||22==o||23==o?(21==o?o=-1:22==o?o=-2:23==o&&(o=-3),w.uI.LoadDocumentLandingPage(l[0],l[0],o,"",{DocsList:this.strAccounts,ReportFilterXML:t},!0)):w.uI.LoadDocumentLandingPage(l[0],l[0],o>0?" and INV.StatusID="+o:"","",{DocsList:this.strAccounts,ReportFilterXML:t},!0)}}GetDateFilterXML(i){let t="",e=new Date,o=new Date((new Date).getFullYear(),h.d.SessionManager.AccountingFromMonth-1,1);if(o>new Date&&(o=o.AddYears(-1)),null!=this.Chart)t=this.PrevData>0?"<Row ColID='FROMDATE' Value='"+this.Chart.FromDate.Date.AddYears(-this.PrevData).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'/>":"<Row ColID='FROMDATE' Value='"+this.Chart.FromDate.Date.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+this.Chart.ToDate.Date.ToString("dd MMM yyyy")+"'/>";else if("Today"==i.LabelType)t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.ToString("dd MMM yyyy")+"'/>";else if("Yesterday"==i.LabelType)t="<Row ColID='FROMDATE' Value='"+e.AddDays(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("AsOnDate"==i.LabelType)t="<Row ColID='ASONDATE' Value='"+e.ToString("dd MMM yyyy")+"'/>";else if("MnToDate"==i.LabelType)t="<Row ColID='FROMDATE' Value='"+new Date(e.getFullYear(),e.getMonth(),1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.ToString("dd MMM yyyy")+"'/>";else if("QtrToDate"==i.LabelType){let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear(),3*(l-1),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).ToString("dd MMM yyyy")+"'/>"}else if("YrToDate"==i.LabelType)t="<Row ColID='FROMDATE' Value='"+o.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.ToString("dd MMM yyyy")+"'/>";else if("CurMon"==i.LabelType)e.iMonth(),e=new Date(e.getFullYear(),e.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("CurMonToDate"==i.LabelType)e=new Date(e.getFullYear(),e.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+Date.Today().ToString("dd MMM yyyy")+"'/>";else if("PrevMn"==i.LabelType)e=new Date(e.getFullYear(),e.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+e.AddMonths(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("PrevMnToDate"==i.LabelType)t="<Row ColID='TODATE' Value='"+e.AddMonths(-1).ToString("dd MMM yyyy")+"'/>",e=new Date(e.getFullYear(),e.getMonth(),1),t+="<Row ColID='FROMDATE' Value='"+e.AddMonths(-1).ToString("dd MMM yyyy")+"'/>";else if("PrevQtr"==i.LabelType){let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear(),3*(l-1),1),t="<Row ColID='FROMDATE' Value='"+e.AddMonths(-3).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddDays(-1).ToString("dd MMM yyyy")+"'/>"}else if("PrevQtrToDate"==i.LabelType){let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear(),3*(l-1),1),t="<Row ColID='FROMDATE' Value='"+e.AddMonths(-3).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddMonths(-3).ToString("dd MMM yyyy")+"'/>"}else if("LastYr"==i.LabelType)t="<Row ColID='FROMDATE' Value='"+o.AddYears(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+o.AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrToDate"==i.LabelType)e=new Date(e.getFullYear()-1,0,1),t="<Row ColID='FROMDATE' Value='"+o.AddYears(-1).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrMn"==i.LabelType)e=new Date(e.getFullYear()-1,e.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrMnToDate"==i.LabelType)e=new Date(e.getFullYear()-1,e.getMonth(),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'/>";else if("LastYrQtr"==i.LabelType){let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear()-1,3*(l-1),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddMonths(3).AddDays(-1).ToString("dd MMM yyyy")+"'/>"}else if("LastYrQtrToDate"==i.LabelType){let l=(e.iMonth()-1)/3+1;e=new Date(e.getFullYear()-1,3*(l-1),1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+(new Date).AddYears(-1).ToString("dd MMM yyyy")+"'/>"}else if("WeekToDate"==i.LabelType){this.HeaderValuePostfix="WTD";let l=e.getDate()-e.getDay();e.setDate(l+1),t="<Row ColID='FROMDATE' Value='"+e.ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+Date.Today().ToString("dd MMM yyyy")+"'/>"}else if("PrevWeek"==i.LabelType){this.HeaderValuePostfix="LWTD";let l=e.getDate()-e.getDay();e.setDate(l+1),t="<Row ColID='FROMDATE' Value='"+e.AddDays(-7).ToString("dd MMM yyyy")+"'/><Row ColID='TODATE' Value='"+e.AddDays(-1).ToString("dd MMM yyyy")+"'/>"}return t}}class W{constructor(){this.dbl=0,this.IsDataReady=!1,this.breakSpaces=!1,this.Visible=!0,this.FontSize=12,this.FontFamily="Calibri",this.IsLink=!1,this._ImagePath="",this.ShowPercentage=!1,this.ShowImage=!1,this.ShowArrow=!1,this.txtSep=new z,this.txtValue=new z,this.txtPercent=new z}get ImagePath(){return this._ImagePath}set ImagePath(i){i!=this._ImagePath&&this._ImagePath!=i&&(this._ImagePath=i,this.ShowImage=!s.J0.IsEmpty(this._ImagePath))}SetSubFields(){this.txtLbl=new z,this.txtLbl.Text=this.Label,this.txtLbl.Row=this.Row,this.txtLbl.Column="0",this.txtLbl.ForeColor=this.ForeColor,this.txtLbl.Align="Left",this.txtSep.Text=" : ",this.txtSep.Row=this.Row,this.txtSep.Column="1",this.txtSep.ForeColor=this.ForeColor,this.txtValue.Text="",this.txtValue.Row=this.Row,this.txtValue.Column="2",this.txtValue.ForeColor=this.ForeColor,this.txtValue.Align="Right",this.txtValue.WzLbl=this,this.txtPercent.Text="",this.txtPercent.Row=this.Row,this.txtPercent.Column="3",this.txtPercent.ForeColor=this.ForeColor}}class z{constructor(){this.Percentage=0,this.FontSize=12,this.IsLink=!1,this.FontFamily="Calibri",this.Visible=!0,this.WzLbl=null}}class De extends G.g{constructor(i){super(),this.Chart=null,this.RefreshCalender=null,this.DisplayStartDate=new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),this.EmployeeList=new g.G(0),this.dsData=null,this.SelectedEmpID=0,this.widget=i,this.HeaderLabels=[],this.EmployeeList.Code.TypeID=4,this.EmployeeList.Name.TypeID=1,this.EmployeeList.Code.Visible=this.EmployeeList.Name.Visible=!1,this.EmployeeList.Code.Column=0,this.EmployeeList.Name.Column=1,this.EmployeeList.Code.Visible=!0,this.EmployeeList.Name.Visible=!0,this.EmployeeList.Code.CCID=this.EmployeeList.Name.CCID=50051,this.EmployeeList.SelectionCallBack.Subscribe(this,"OnEmployeeChanged"),this.EmployeeList.t.Interval=200;let t=h.d.report.GetDataTable("RPT042",h.d.SessionManager.UserName);if(null!=t&&t.length>0&&(this.EmployeeList.SelectedValue=parseInt(t[0].NodeID)),26==i.TypeID){this.bgPresent="rgb(34, 177, 76)",this.bgSinglePunch="rgb(70, 230, 198)",this.bgAbsent="rgb(242, 97, 85)",this.bgHoliday="rgb(231, 204, 97)",this.bgWeeklyOff="rgb(180, 146, 99)";let e=new W;e.LabelType="Present",e.Label="Present",e.Value="0",e.ForeColor="#22B14C",this.HeaderLabels.push(e),e=new W,e.LabelType="SinglePunch",e.Label="Single Punch",e.Value="0",e.ForeColor="#46E6C6",this.HeaderLabels.push(e),e=new W,e.LabelType="Absent",e.Label="Absent",e.Value="0",e.ForeColor="#F26155",this.HeaderLabels.push(e),e=new W,e.LabelType="Holidays",e.Label="Holidays",e.Value="0",e.ForeColor="#E7CC61",this.HeaderLabels.push(e),e=new W,e.LabelType="WeeklyOff",e.Label="Weekly Off",e.Value="0",e.ForeColor="#B49263",this.HeaderLabels.push(e)}else if(27==i.TypeID){let e=new W;e.LabelType="TotalHours",e.Label="Total Hours",e.Value="0",e.ForeColor="Orange",this.HeaderLabels.push(e),e=new W,e.LabelType="UtilizedHours",e.Label="Utilized Hours",e.Value="0",e.ForeColor="Green",this.HeaderLabels.push(e),e=new W,e.LabelType="Un-Utilized Hours",e.Label="Un-Utilized Hours",e.Value="0",e.ForeColor="Red",this.HeaderLabels.push(e)}this.DisplayStartDate=new Date((new Date).getFullYear(),(new Date).getMonth(),1)}OnButtonClick(i){"PreviousMonth"==i.toString()?(this.DisplayStartDate=this.DisplayStartDate.AddMonths(-1),this.Refresh()):"NextMonth"==i.toString()&&(this.DisplayStartDate=this.DisplayStartDate.AddMonths(1),this.Refresh())}OnEmployeeChanged(i){this.Refresh()}Refresh(){var i=this;return(0,M.A)(function*(){i.SelectedEmpID=i.EmployeeList.Code.SelectedValue,i.dsData=yield i.SetQueryHRM(),null!=i.RefreshCalender&&i.RefreshCalender.Call(),i.widget.LoadingVisibility=!1})()}SetQueryHRM(){let i="";i="declare @Fr float,@To float,@EMPID bigint",i+=" set @Fr=convert(float,convert(datetime,'"+this.DisplayStartDate.ToString("dd MMM yyyy")+"'))",i+=" set @To=convert(float,convert(datetime,'"+this.DisplayStartDate.AddMonths(1).AddDays(1).ToString("dd MMM yyyy")+"'))",i+=" set @EMPID="+this.EmployeeList.SelectedValue;let t=this.widget.GetDimensionWhere("TDCC.dcCCNID"),e="";if(h.d.SessionManager.Preferences.ContainsKey("HolidaysBasedOn")&&""!=h.d.SessionManager.Preferences.HolidaysBasedOn){let l=h.d.SessionManager.Preferences.HolidaysBasedOn.split(",");for(let r=0;r<l.length;r++)""!=l[r]&&(parseInt(l[r]),e+=" AND EDCC.CCNID"+(parseInt(l[r])-5e4)+"=TDCC.dcCCNID"+(parseInt(l[r])-5e4))}let o=[];return o.push(this.widget.TypeID),o.push(e),o.push(i),o.push(t),o.push(h.d.SessionManager.LanguageID),h.d.report.GetWidgetHRM(o)}}var L=d(61488),te=d(82503),ue=d(39807),ce=d(11592);class de{constructor(){this.Decimals=0,this.Divider=1}}let ie=(()=>{class x extends G.g{get TabularColumns(){return this.TabularDataObj.ReportColumns}constructor(){super(),this.PrintExportCallBack=new P.Yk,this.LoadingVisibility=!0,this.TabularDataObj=new ue.j,this.ShowGrid=!1,this.ShowGridOn=!1,this.ShowDropDown=!1,this.ShowPoint=0,this.IsWidgetChart=!1,this.ShowWidgetFilter=!1,this.HideGridTotal=!1,this.FromDate=new te.Lc(0),this.ToDate=new te.Lc(0),this.GrossTotalAppearance=new L.bA,this.GrossTotalAppearance_Data=new L.bA,this.RefreshAMChart=new P.Yk,this.IsStackChart=!1,this.objFormat=new L.yL,this.HeaderAppearance=new L.bA,this.NumberDataAppearance=new L.bA,this.dtStack=null,this.lstDrillFilter=new Array,this.WidgetCallsComplated=0,this.CurrentLevel=0,this.DrillBackVisible=!1,this.Is3D=new ce.c,this.ChartDataColumns=[],this._ChartData=x.EmptyChartData,this.ClassName="RevenUChartViewModel",this.Chart=[],this.ChartTypes=new N.y$,this.ChartDimColumns=new N.y$}RevenUChartViewModel_1(t,e,o){if(this.Parent=t,this.Report=e,this.drChartDefn=o,this.Chart=[],this.ChartTypes=new N.y$(0),this.ChartTypes.Label="Chart Type",this.ChartTypes.LblWidth="80",this.ChartTypes.SelectionChangedCommand.Subscribe(this,"OnChartTypeChanged"),this.ChartTypes.Items.push(N._p.ComboBoxItems_2(h.d.GetResource("ChartType_Area"),"6")),this.ChartTypes.Items.push(N._p.ComboBoxItems_2(h.d.GetResource("ChartType_Bar"),"2")),this.ChartTypes.Items.push(N._p.ComboBoxItems_2(h.d.GetResource("ChartType_Column"),"3")),this.ChartTypes.Items.push(N._p.ComboBoxItems_2(h.d.GetResource("ChartType_Curve"),"10")),this.ChartTypes.Items.push(N._p.ComboBoxItems_2(h.d.GetResource("ChartType_CurveArea"),"11")),this.ChartTypes.Items.push(N._p.ComboBoxItems_2(h.d.GetResource("ChartType_Doughnut"),"5")),this.ChartTypes.Items.push(N._p.ComboBoxItems_2(h.d.GetResource("ChartType_Funnel"),"12")),this.ChartTypes.Items.push(N._p.ComboBoxItems_2(h.d.GetResource("ChartType_Line"),"4")),this.ChartTypes.Items.push(N._p.ComboBoxItems_2(h.d.GetResource("ChartType_Pie"),"1")),this.ChartTypes.Items.push(N._p.ComboBoxItems_2(h.d.GetResource("ChartType_Polar"),"15")),this.ChartTypes.Items.push(N._p.ComboBoxItems_2(h.d.GetResource("ChartType_Pyramid"),"16")),this.ChartTypes.Items.push(N._p.ComboBoxItems_2(h.d.GetResource("ChartType_Radar"),"17")),this.ChartTypes.SelectedValue=o.GraphType.toString(),this.Is3D.Label="3D",this.Is3D.CheckedChangedCommand.Subscribe(this,"OnChartTypeChanged"),null!=t.xOptions&&null!=s.VB.SelectSingleNode(t.xOptions.DocumentElement,"IsStackChart")&&(this.IsStackChart=!0),null==e){null==t.Parent.dsWidgetNames&&(t.Parent.dsWidgetNames=h.d.report.Widgets(3,0,"",0,1,!1,null,null)),this.FromDate.Label=h.d.GetResource("Reports_LblFromDate"),this.ToDate.Label=h.d.GetResource("Reports_LblToDate");let r=new Date(Date.Today().getFullYear(),h.d.SessionManager.AccountingFromMonth-1,1);r>Date.Today()&&(r=r.AddYears(-1)),this.FromDate.Date=r,this.ToDate.Date=r.AddYears(1).AddDays(-1)}this.ShowGrid=(0,Y.yG0)(o.ShowGrid),this.NumSeriesColor=s.J0.StringIsNullOrEmpty(o.NumSeriesColor)?null:o.NumSeriesColor.toString().split(","),this.HideGridTotal=!(!s.J0.hasprop(o,"HideGridTot")||s.J0.IsEmpty(o.HideGridTot)||!(0,Y.yG0)(o.HideGridTot))&&(0,Y.yG0)(o.HideGridTot),null!=o.ShowPoint&&(this.ShowPoint=parseInt(o.ShowPoint)),this.TextFields=o.TextField.toString().split(","),this.NumericFields=o.NumericField.toString().split(","),this.NumFormula=new Array(this.NumericFields.length),this.ChartWidgetFilters=new Array(this.NumericFields.length),this.arrNumFormat=new Array(this.NumericFields.length);let l=null;null!=t.xOptions&&(l=s.VB.SelectNodes(t.xOptions.DocumentElement,"Chart/Num"));for(let r=0;r<this.NumFormula.length;r++)if(this.NumFormula[r]="",null!=l&&r<l.length){this.ChartWidgetFilters[r]=s.VB.SelectSingleNode(l[r],"WidgetFilter/TreeFilters");let p=s.VB.SelectSingleNode(l[r],"Formula");if(null!=p&&(this.NumFormula[r]=p.innerHTML,p.innerHTML.length>0)){let n=[],u=new T.PE;if(u.SetKeyWords("REPORT"),u.ParseFormula(this.NumFormula[r],n),10==n.length){let a=new de;a.FormatText=n[8].tokenValue.toString().split("~")[0],a.FormatKey=n[6].tokenValue.toString().split("~")[0],a.Decimals=parseInt(n[4].tokenValue),"K"==a.FormatKey?a.Divider=1e3:"L"==a.FormatKey?a.Divider=1e5:"M"==a.FormatKey?a.Divider=1e6:"C"==a.FormatKey?a.Divider=1e7:"B"==a.FormatKey&&(a.Divider=1e9),this.arrNumFormat[r]=a}}}if(this.ChartDimColumns=new N.y$(0),this.ChartDimColumns.LblWidth="0",this.TextFieldsColumnSource=new Array(this.TextFields.length),this.NumericFieldsColumnSource=new Array(this.NumericFields.length),null!=e){this.IsWidgetChart=!1,this.ChartName=!t.ShowHeader||s.J0.StringIsNullOrEmpty(t.Header)?e.DisplayName:"",this.FilterName=e.FilterText.toString();for(let n=0;n<this.TextFields.length;n++)this.TextFieldsColumnSource[n]=e.ColumnSource.find(u=>u.ID==this.TextFields[n]);for(let n=0;n<this.NumericFields.length;n++)this.NumericFieldsColumnSource[n]=e.ColumnSource.find(u=>u.ID==this.NumericFields[n]),n<this.NumFormula.length&&(this.NumericFieldsColumnSource[n].DataFormat.NumberFormat=this.NumFormula[n]);let r=!1,p=e.ReportColumns.length;for(let n=0;n<p;n++){let u=e.ReportColumns[n];if(u.HeaderAppearance.IsVisible&&"FLOAT"!=u.ColumnType&&"INT"!=u.ColumnType&&(this.ChartDimColumns.Items.push(N._p.ComboBoxItems_2(u.HeaderText,u.ID)),!r&&"DATE"==u.ColumnType&&s.J0.IsEmpty(u.Formula))){r=!0;let a=u.Clone();a.ID=u.ID+"_Yr",a.HeaderText="Year-Wise",a.ColumnType="",a.Formula='DATENAME("yyyy",'+u.ID+")",this.ChartDimColumns.Items.push(N._p.ComboBoxItems_2(a.HeaderText,a.ID)),e.ReportColumns.push(a),e.ColumnSourceALL.push(a),a=u.Clone(),a.ID=u.ID+"_Mn",a.HeaderText="Month-Wise",a.ColumnType="",a.Formula='DATENAME("MMM-yy",'+u.ID+")",this.ChartDimColumns.Items.push(N._p.ComboBoxItems_2(a.HeaderText,a.ID)),e.ReportColumns.push(a),e.ColumnSourceALL.push(a),a=u.Clone(),a.ID=u.ID+"_Qtr",a.HeaderText="Quarter-Wise",a.ColumnType="",a.Formula='DATENAME("QUARTERLY",'+u.ID+")",this.ChartDimColumns.Items.push(N._p.ComboBoxItems_2(a.HeaderText,a.ID)),e.ReportColumns.push(a),e.ColumnSourceALL.push(a),n+=3}}e.Chart=this}else{this.IsWidgetChart=!0;let r=new v.D_;"YrWise"==this.TextFields[0]?(r.HeaderText="Year",this.FromDate.Date=this.FromDate.Date.AddYears(-t.PrevDataFilter)):"MnWise"==this.TextFields[0]?(r.HeaderText="Month",this.FromDate.Date=this.FromDate.Date.AddMonths(-t.PrevDataFilter)):"QtrWise"==this.TextFields[0]?(r.HeaderText="Quarter",this.FromDate.Date=this.FromDate.Date.AddMonths(3*-t.PrevDataFilter)):this.TextFields[0].startsWith("DIM_")&&(r.HeaderText="Name");let p=this.NumericFields.length>0?parseInt(this.NumericFields[0]):0;if(t.PrevData>0&&this.NumericFields.length>0){this.NumericFields=new Array(t.PrevData+1);for(let n=0;n<=t.PrevData;n++)this.NumericFields[n]=1==h.d.SessionManager.AccountingFromMonth?this.FromDate.Date.AddYears(-n).getFullYear().toString():this.FromDate.Date.AddYears(-n).getFullYear().toString()+"-"+((this.FromDate.Date.AddYears(-n).getFullYear()+1)%100).toString();this.Widgets=new Array(1)}else this.Widgets=new Array(this.NumericFields.length);r.ID=this.TextFields[0],this.TextFieldsColumnSource=[],this.TextFieldsColumnSource.push(r),this.NumericFieldsColumnSource=new Array(this.NumericFields.length);for(let n=0;n<this.NumericFields.length;n++){let u=new v.D_;if(t.PrevData>0)u.ID=this.NumericFields[n],u.HeaderText=this.NumericFields[n];else{u.ID="NUM_"+n;let c=t.Parent.dsWidgetNames.Tables[0].filter(m=>m.ID==this.NumericFields[n]);u.HeaderText=c.length>0?11==p||12==p||13==p||14==p||15==p||20==p?"Value":19==p?"Quantity":c[0].Name.toString():"WID-"+this.NumericFields[n]}if(u.ColumnType="FLOAT",u.DataFormat=new L.yL,u.width=110,u.DataFormat.DecimalsPoints=2,u.DataFormat.Commas="Millions"==h.d.SessionManager.Preferences.Commas?1:2,this.NumericFieldsColumnSource[n]=u,n<this.NumFormula.length&&(this.NumericFieldsColumnSource[n].DataFormat.NumberFormat=this.NumFormula[n]),t.PrevData>0&&n>0){this.NumericFieldsColumnSource[n].DataFormat.NumberFormat=this.NumericFieldsColumnSource[n-1].DataFormat.NumberFormat;continue}let a=new Q;a.WidgetViewModel_2(this,t.PrevData>0?p:parseInt(this.NumericFields[n]),this.ChartWidgetFilters[n]),11==a.TypeID||12==a.TypeID||18==a.TypeID?(r.width=160,this.TextFields[0]=r.ID="AccountName",r.HeaderText="Account Name"):13==a.TypeID?(r.width=160,this.TextFields[0]=r.ID="ProductName",r.HeaderText="Product Name"):(14==a.TypeID||15==a.TypeID||19==a.TypeID||20==a.TypeID)&&(this.TextFields[0]=r.ID="Slab",r.HeaderText="Slab"),a.PrevData=t.PrevData,a.Groups=r.ID,this.Widgets[n]=a}}this.ChartDimColumns.Items.length>0&&(this.ChartDimColumns.SelectedValue=this.TextFields[0],this.ChartDimColumns.SelectionChangedCommand.Subscribe(this,"OnChartDimColumnsChange")),(this.ChartDimColumns.Items.length<=1||this.IsStackChart)&&(this.ChartDimColumns.Visible=!1),this.ShowGrid&&this.InitGrid()}InitGrid(){let t=new L.bA;this.HeaderAppearance.Alignment="Center",this.HeaderAppearance.FontFamilyName="Arial",this.HeaderAppearance.FontSize=12,this.HeaderAppearance.IsBold=!0,this.HeaderAppearance.BackColor="White",this.HeaderAppearance.ForeColor="Black",t.Alignment="Left",t.FontFamilyName="Arial",t.FontSize=12,t.BackColor="White",t.ForeColor="Black",this.NumberDataAppearance.Alignment="Right",this.NumberDataAppearance.FontFamilyName="Arial",this.NumberDataAppearance.FontSize=12,this.NumberDataAppearance.BackColor="White",this.NumberDataAppearance.ForeColor="Black",this.GrossTotalAppearance.IsBold=!0,this.GrossTotalAppearance.ForeColor="#FF000000",this.GrossTotalAppearance.BackColor="White",this.GrossTotalAppearance.FontFamilyName="Arial",this.GrossTotalAppearance_Data.IsBold=!0,this.GrossTotalAppearance_Data.ForeColor="#FF000000",this.GrossTotalAppearance_Data.BackColor="White",this.GrossTotalAppearance_Data.FontFamilyName="Arial",this.GrossTotalAppearance_Data.Alignment="Right",this.objFormat.DecimalsPoints=parseInt(h.d.SessionManager.Preferences.DecimalsinAmount),"Millions"==h.d.SessionManager.Preferences.Commas?this.objFormat.Commas=1:"Lakhs"==h.d.SessionManager.Preferences.Commas&&(this.objFormat.Commas=2),this.objFormat.DateType=h.d.SessionManager.Preferences["Date Format"];let e=new v.D_;e.gridLines=3,e.ID=this.TextFieldsColumnSource[0].ID,e.FieldName=this.TextFieldsColumnSource[0].ID,e.HeaderText=this.TextFieldsColumnSource[0].HeaderText,e.HeaderAppearance=this.HeaderAppearance,e.DataAppearance=t,e.HeaderHeight=22,e.width=.8*this.TextFieldsColumnSource[0].width,e.DataFormat=this.objFormat,e.ColumnType="STRING",this.TabularColumns.push(e),this.IsStackChart||this.NumericFieldsColumnSource.forEach(o=>{e=new v.D_,e.gridLines=3,e.ID=o.ID,e.FieldName=o.ID,e.HeaderText=o.HeaderText,e.HeaderAppearance=this.HeaderAppearance,e.DataAppearance=this.NumberDataAppearance,e.HeaderHeight=22,e.width=.8*o.width,e.DataFormat=this.objFormat,e.ColumnType="FLOAT",this.TabularColumns.push(e)})}OnButtonClick(t){if("DrillBack"==t){if(0==this.CurrentLevel)return;this.CurrentLevel--,this.lstDrillFilter.RemoveAt(this.lstDrillFilter.length-1),0==this.CurrentLevel&&(this.DrillBackVisible=!1),this.RefreshChart()}else if("WidgetFilterOK"==t){if(this.Parent.PrevData>0&&this.FromDate.Date.getFullYear()!=this.ToDate.Date.getFullYear())return void(this.DisplayMessage="Select From Date and To Date of same year");this.ShowWidgetFilter=!1,this.RefreshChart()}else"WidgetFilterCancel"==t?(this.ShowWidgetFilter=!1,this.RefreshChart()):"ShowGridOn"==t&&(this.ShowGridOn=!this.ShowGridOn)}LoadChartData(){this.ShowGrid&&this.TabularDataObj.Clear();let t,e,o,l=null,r=new _.D3;this.dtStack=null,this.IsStackChart||this.lstDrillFilter.forEach(D=>{D.split("=")}),0!=this.Report.lstGroup.filter(D=>"Summary"==D.DisplayMode).length&&null!=this.Report.ReportSummaryData?(t=e=this.Report.ReportSummaryData,this.lstDrillFilter.length>0&&(t=e=this.Report.ReportSummaryData,this.lstDrillFilter.forEach(D=>{let S=D.split("=");t=t.filter(R=>R[S[0]]==S[1])})),o=t.ToTable(!0,[this.TextFields[this.CurrentLevel]])):(t=e=this.Report.ReportData,this.lstDrillFilter.length>0&&this.lstDrillFilter.forEach(D=>{let S=D.split("=");t=t.filter(R=>R[S[0]]==S[1])}),o=t.ToTable(!0,[this.TextFields[this.CurrentLevel]])),null!=this.TabularColumns&&this.TabularColumns.length>0&&this.TabularColumns[0].HeaderText!=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText&&(this.TabularColumns[0].HeaderText=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText,this.TabularDataObj.RefreshColumns());let n=[],u=[];if(u.push(this.TextFieldsColumnSource[this.CurrentLevel].HeaderText),this.IsStackChart){this.dtStack_C0=this.TextFields[1],this.dtStack=t.ToTable(!0,[this.dtStack_C0]);for(let D=this.TabularColumns.length-1;D>0;D--)this.TabularColumns.RemoveAt(D);for(let D=0;D<this.dtStack.length;D++)if(u.push(s.J0.String(this.dtStack[D][this.dtStack_C0])),null!=this.TabularColumns){let S=new v.D_;S.gridLines=3,S.ID=S.FieldName=S.HeaderText=s.J0.String(this.dtStack[D][this.dtStack_C0]),S.HeaderAppearance=this.HeaderAppearance,S.DataAppearance=this.NumberDataAppearance,S.HeaderHeight=22,S.width=.8*this.NumericFieldsColumnSource[0].width,S.DataFormat=this.objFormat,S.ColumnType="FLOAT",this.TabularColumns.push(S)}null!=this.TabularColumns&&this.TabularDataObj.RefreshColumns()}else for(let D=0;D<this.NumericFields.length;D++)u.push(this.NumericFieldsColumnSource[D].HeaderText);let a=0,F=this.IsStackChart?new Array(this.dtStack.length).fill(0):new Array(this.NumericFieldsColumnSource.length).fill(0);this.IsStackChart&&(this.CurrentLevel=0);for(let D=0;D<o.length;D++){let S=o[D];t=e.filter(this.IsStackChart?V=>V[this.TextFields[0]]==S[this.TextFields[0]]:V=>V[this.TextFields[this.CurrentLevel]]==S[this.TextFields[this.CurrentLevel]]);let R=new L.DK,b=new L.DK;E.ReportViewModel.SetCellValue(S[this.TextFields[this.CurrentLevel]],this.TextFieldsColumnSource[this.CurrentLevel].DataFormat,this.TextFieldsColumnSource[this.CurrentLevel].ColumnType,-1,R,this.TextFieldsColumnSource[this.CurrentLevel].ID);let B={};if(B[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]=R.Text,this.ShowGrid&&!this.HideGridTotal&&(l=new L.Ji(this.TabularColumns.length),l.Height=22,l.Cells[0]=R),this.IsStackChart){let V=t.filter(H=>!0);for(let H=0;H<this.dtStack.length;H++){t=V.filter(q=>q[this.TextFields[1]]==this.dtStack[H][this.dtStack_C0].toString());let U=0;t.forEach(q=>{!s.J0.IsEmpty(q[this.NumericFields[0]])&&q[this.NumericFields[0]].toString().length>0&&(U+=parseFloat(q[this.NumericFields[0]]))}),F[H]+=U,u.Contains(this.dtStack[H][this.dtStack_C0].toString())&&(B[this.dtStack[H][this.dtStack_C0].toString()]=U),0==H&&E.ReportViewModel.SetCellValue(U,this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,-1,b,this.NumericFieldsColumnSource[0].ID),this.ShowGrid&&E.ReportViewModel.SetCellValue(U,this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,-1,l.Cells[H+1],this.NumericFieldsColumnSource[0].ID)}}else for(let V=0;V<this.NumericFields.length;V++){let H=0;t.forEach(U=>{!s.J0.IsEmpty(U[this.NumericFields[V]])&&U[this.NumericFields[V]].toString().length>0&&(H+=parseFloat(U[this.NumericFields[V]]))}),F[V]+=H,B[this.NumericFieldsColumnSource[V].HeaderText]=H,0==V&&E.ReportViewModel.SetCellValue(H,this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,-1,b,this.NumericFieldsColumnSource[0].ID),this.ShowGrid&&E.ReportViewModel.SetCellValue(H,this.NumericFieldsColumnSource[V].DataFormat,this.NumericFieldsColumnSource[V].ColumnType,-1,l.Cells[V+1],this.NumericFieldsColumnSource[V].ID)}if(n.push(B),a++,this.ShowGrid&&(this.Report.IsDefaultSortColumnExists||this.TabularDataObj.addRow(l),r.push(B,l)),!this.Report.IsDefaultSortColumnExists&&this.Report.TopRecords>=0&&a==this.Report.TopRecords)break}if(this.Report.IsDefaultSortColumnExists){var C=this.NumericFieldsColumnSource.find(D=>D.ID==this.Report.Preferences.DefaultSortColumn);if(C?n.sort("DESC"==this.Report.Preferences.DefaultSortOrder?(D,S)=>D[C.HeaderText]<S[C.HeaderText]?1:-1:(D,S)=>D[C.HeaderText]>S[C.HeaderText]?1:-1):Logger.DebugLog('Default Sort Column "'+this.Report.Preferences.DefaultSortColumn+'" can not be applied to chart'),this.ShowGrid&&this.TabularDataObj.Clear(),F[0]=0,this.Report.TopRecords>0)for(a=n.length-1;a>=this.Report.TopRecords;a--)n.Remove(n[a]);if(this.ShowGrid){let D;n.forEach(S=>{null!=S[this.NumericFieldsColumnSource[0].HeaderText]&&(D=s.J0.Double(S[this.NumericFieldsColumnSource[0].HeaderText]),F[0]+=D),this.TabularDataObj.addRow(r.GetValue(S))})}}if(this.ChartData=n,this.ChartDataColumns=u,this.RefreshAMChart.Call(),0==this.ChartData.length&&this.ChartData.push({}),this.ShowGrid){if(l=new L.Ji(this.TabularColumns.length),l.Height=24,l.Cells[0].IsNormal=!1,l.Cells[0].CellAppearance=this.GrossTotalAppearance,l.Cells[0].Text="Total",this.IsStackChart)for(let D=1;D<this.TabularColumns.length;D++)l.Cells[D].IsNormal=!1,l.Cells[D].CellAppearance=this.GrossTotalAppearance_Data,this.Report.SetCellValue(F[D-1],this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,l.Cells[D],this.NumericFieldsColumnSource[0].ID);else for(let D=0;D<this.NumericFields.length;D++)l.Cells[D+1].IsNormal=!1,l.Cells[D+1].CellAppearance=this.GrossTotalAppearance_Data,this.Report.SetCellValue(F[D],this.NumericFieldsColumnSource[D].DataFormat,this.NumericFieldsColumnSource[D].ColumnType,l.Cells[D+1],this.NumericFieldsColumnSource[D].ID);this.TabularDataObj.addRow(l)}}LoadChartDataByRows(){this.ShowGrid&&this.TabularDataObj.Clear();var t=this.Report.Data.filter(m=>m.Visible&&(m.Type==L.QS.Detail||m.Type==L.QS.BalanceBF||m.Type==L.QS.GrossTotal)),e=parseInt(t.Compute("max","LevelNo")),o=t.filter(m=>m.LevelNo==e);let l=new Array(this.TextFields.length).fill(0);for(let m=0;m<this.TextFields.length;m++){if(null==(r=this.Report.ReportColumns.find(F=>F.ID==this.TextFields[m])))return void Logger.ErrorLog("TextFields["+m+"] not found");l[m]=this.Report.ReportColumns.indexOf(r)}let p=new Array(this.NumericFields.length).fill(0);for(let m=0;m<this.NumericFields.length;m++){var r;if(null==(r=this.Report.ReportColumns.find(C=>C.ID==this.NumericFields[m])))return void Logger.ErrorLog("NumericFields["+m+"] not found");p[m]=this.Report.ReportColumns.indexOf(r)}let n=[],u=[];u.push(this.TextFieldsColumnSource[0].HeaderText);for(let m=0;m<this.NumericFields.length;m++)u.push(this.NumericFieldsColumnSource[m].HeaderText);let a=0,c=0;for(let m=0;m<o.length;m++){let F=o[m],C=0;null!=F.Cells[p[0]].Value&&(C=parseFloat(F.Cells[p[0]].Value)),c+=C;let D=new L.DK,S=new L.DK;E.ReportViewModel.SetCellValue(F.Cells[l[0]].Value,this.TextFieldsColumnSource[0].DataFormat,this.TextFieldsColumnSource[0].ColumnType,-1,D,this.TextFieldsColumnSource[0].ID),E.ReportViewModel.SetCellValue(C,this.NumericFieldsColumnSource[0].DataFormat,this.NumericFieldsColumnSource[0].ColumnType,-1,S,this.NumericFieldsColumnSource[0].ID);let R={};R[this.TextFieldsColumnSource[0].HeaderText]=D.Text;for(let b=0;b<this.NumericFields.length;b++)try{null!=F.Cells[p[b]].Value&&(R[this.NumericFieldsColumnSource[b].HeaderText]=F.Cells[p[b]].Value)}catch{}if(n.push(R),a++,this.ShowGrid){let b=new L.Ji(this.TabularColumns.length);b.Height=22,b.Cells[0]=D,b.Cells[1]=S,this.Report.IsDefaultSortColumnExists||this.TabularDataObj.addRow(b)}if(!this.Report.IsDefaultSortColumnExists&&this.Report.TopRecords>=0&&a==this.Report.TopRecords)break}if(this.ChartData=n,this.ChartDataColumns=u,this.RefreshAMChart.Call(),this.ShowGrid&&!this.HideGridTotal){let m=new L.Ji(this.TabularColumns.length);m.Height=24,m.Cells[0].IsNormal=!1,m.Cells[0].CellAppearance=this.GrossTotalAppearance,m.Cells[0].Text="Total",m.Cells[1].IsNormal=!1,m.Cells[1].CellAppearance=this.GrossTotalAppearance_Data,this.Report.SetCellValue(c,this.TabularColumns[1].DataFormat,this.TabularColumns[1].ColumnType,m.Cells[1],this.TabularColumns[1].ID),this.TabularDataObj.addRow(m)}}LoadChartDataForWidget(){if(this.ShowGrid&&this.TabularDataObj.Clear(),this.ChartData=null,this.Parent.PrevData>0){let t=new Date(this.FromDate.Date.getFullYear(),h.d.SessionManager.AccountingFromMonth-1,1);if(t>this.FromDate.Date&&(t=t.AddYears(-1)),this.ToDate.Date>t.AddYears(1).AddDays(-1)||"YrWise"==this.TextFields[0]||0==this.NumericFields.length)return;for(let e=0;e<=this.Parent.PrevData;e++)this.NumericFields[e]=1==h.d.SessionManager.AccountingFromMonth?this.FromDate.Date.AddYears(-e).getFullYear().toString():this.FromDate.Date.AddYears(-e).getFullYear().toString()+"-"+((this.FromDate.Date.AddYears(-e).getFullYear()+1)%100).toString(),this.NumericFieldsColumnSource[e].ID=this.NumericFields[e],this.NumericFieldsColumnSource[e].HeaderText=this.NumericFields[e],this.TabularColumns[e+1].HeaderText=this.NumericFields[e];this.TabularColumns[0].HeaderText=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText,this.TabularDataObj.RefreshColumns()}this.WidgetCallsComplated=0,this.widgetds=new Array(this.Widgets.length);for(let t=0;t<this.Widgets.length;t++)this.widgetds[t]=this.Widgets[t].SetValue(this.Widgets[t].Header,t)}WidgetCallBack(t,e){this.widgetds[t]=e,this.WidgetCallsComplated++,this.WidgetCallsComplated==this.Widgets.length&&this.LoadChartDataForWidgetCallBack(this.widgetds)}LoadChartDataForWidgetCallBack(t){this.LoadingVisibility=!1;let o,l,n,e=null,r=[],p=[];p.push(this.TextFieldsColumnSource[this.CurrentLevel].HeaderText);for(let c=0;c<this.NumericFields.length;c++)p.push(this.NumericFieldsColumnSource[c].HeaderText);if("MnWise"==this.TextFields[0])for(p.push("Mn"),p.push("Yr"),n=new Date(this.FromDate.Date.getFullYear(),this.FromDate.Date.getMonth(),1);n<=this.ToDate.Date;)o={},o.Mn=n.getMonth(),o.Yr=n.getFullYear(),o[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]=this.FromDate.Date.getFullYear()==this.ToDate.Date.getFullYear()||this.Parent.PrevData>0?n.ToString("MMM"):n.ToString("MMM-yy"),r.push(o),n=n.AddMonths(1);else if("QtrWise"==this.TextFields[0]){p.push("Mn"),p.push("Yr");let c=new Date(this.FromDate.Date.getFullYear(),h.d.SessionManager.AccountingFromMonth-1,1);c>this.FromDate.Date&&(c=c.AddYears(-1));let m="",F=1,C=c.getFullYear();for(;c.AddMonths(3)<=this.FromDate.Date;)F++,C=c.getFullYear(),c=c.AddMonths(3);for(0==this.Parent.PrevData&&(m=1==h.d.SessionManager.AccountingFromMonth?c.getFullYear().toString():c.iMonth()>=h.d.SessionManager.AccountingFromMonth?c.getFullYear().toString()+"-"+((c.getFullYear()+1)%100).toString():(c.getFullYear()-1).toString()+"-"+(c.getFullYear()%100).toString(),m=" "+m),o={},o.Mn=c.getMonth(),o.Yr=c.getFullYear(),o[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]="Q"+F+m,r.push(o);c.AddMonths(3)<=this.ToDate.Date;)F++,5==F&&(F=1),c=c.AddMonths(3),0==this.Parent.PrevData&&(m=1==h.d.SessionManager.AccountingFromMonth?c.getFullYear().toString():c.iMonth()>=h.d.SessionManager.AccountingFromMonth?c.getFullYear().toString()+"-"+((c.getFullYear()+1)%100).toString():(c.getFullYear()-1).toString()+"-"+(c.getFullYear()%100).toString(),m=" "+m),o={},o.Mn=c.getMonth(),o.Yr=c.getFullYear(),o[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]="Q"+F+m,r.push(o)}else if("YrWise"==this.TextFields[0])for(p.push("Yr"),n=new Date(this.FromDate.Date.getFullYear(),this.FromDate.Date.getMonth(),1);n<=this.ToDate.Date;)o={},o.Yr=n.getFullYear(),o[this.TextFieldsColumnSource[this.CurrentLevel].HeaderText]=n.getFullYear(),r.push(o),n=n.AddYears(1);else this.TextFields[0].startsWith("DIM_");if(11==this.Widgets[0].TypeID||12==this.Widgets[0].TypeID||13==this.Widgets[0].TypeID||14==this.Widgets[0].TypeID||15==this.Widgets[0].TypeID||18==this.Widgets[0].TypeID||19==this.Widgets[0].TypeID||20==this.Widgets[0].TypeID){let c;t[0].length>0&&(c=Object.keys(t[0][0])[0]),t[0].forEach(m=>{o={},o[p[0]]=m[c].toString(),o[p[1]]=parseFloat(m.Balance),r.push(o)})}else{let m=0;if(this.Parent.PrevData>0){let F;if(m=this.Widgets[0].Header.dbl,t[0].Rows.forEach(C=>{"MnWise"==this.TextFields[0]?l=r.filter(D=>D.Mn==C.Mn):"QtrWise"==this.TextFields[0]&&(l=r.filter(D=>D.Mn<=C.Mn&&D.Mn+3>=C.Mn)),F=1!=h.d.SessionManager.AccountingFromMonth?parseInt(C.Mn)>=h.d.SessionManager.AccountingFromMonth?C.Yr.toString()+"-"+((parseInt(C.Yr)+1)%100).toString():(parseInt(C.Yr)-1).toString()+"-"+(parseInt(C.Yr)%100).toString():C.Yr.toString(),this.Widgets[0].IncludeOpening?m+=parseFloat(C.Balance):l.length>0&&(m=null!=l[0][F]?parseFloat(C.Balance)+parseFloat(l[0][F]):parseFloat(C.Balance)),l.length>0&&(l[0][F]=m)}),this.Widgets[0].IncludeOpening)for(let C=0;C<r.length;C++){o=r[C];for(let D=this.NumericFields.length-1;D>=0;D--)null==o[this.NumericFields[D]]&&(o[this.NumericFields[D]]=0==C?D==this.NumericFields.length-1?m:r[r.length-1][this.NumericFields[D+1]]:r[C-1][this.NumericFields[D]])}}else for(let F=0;F<this.Widgets.length;F++)if(m=this.Widgets[F].Header.dbl,t[F].forEach(C=>{"MnWise"==this.TextFields[0]?l=r.filter(D=>D.Yr==C.Yr&&D.Mn==C.Mn):"QtrWise"==this.TextFields[0]?l=r.filter(D=>D.Yr==C.Yr&&D.Mn<=C.Mn&&D.Mn+3>=C.Mn):"YrWise"==this.TextFields[0]?l=r.filter(D=>D.Yr==C.Yr):this.TextFields[0].startsWith("DIM_")&&(l=r.filter(D=>D.Name==C.Name.toString())),0==l.length&&this.TextFields[0].startsWith("DIM_")&&(o={},o.Name=C.Name.toString(),r.push(o),l=[],l.push(o)),this.Widgets[F].IncludeOpening?m+=parseFloat(C.Balance):l.length>0&&(m=null!=l[0][this.NumericFieldsColumnSource[F].HeaderText]?parseFloat(C.Balance)+parseFloat(l[0][this.NumericFieldsColumnSource[F].HeaderText]):parseFloat(C.Balance)),l.length>0&&(l[0][this.NumericFieldsColumnSource[F].HeaderText]=m)}),this.Widgets[F].IncludeOpening)for(let C=0;C<r.length;C++)o=r[C],null==o[this.NumericFieldsColumnSource[F].HeaderText]&&(o[this.NumericFieldsColumnSource[F].HeaderText]=0==C?m:r[C-1][this.NumericFieldsColumnSource[F].HeaderText])}r.forEach(c=>{for(let m=0;m<this.NumericFields.length;m++)c[p[m+1]]||(c[p[m+1]]=0)}),p.Contains("Mn")&&p.Remove("Mn"),p.Contains("Yr")&&p.Remove("Yr"),null!=this.TabularColumns&&this.TabularColumns.length>0&&this.TabularColumns[0].HeaderText!=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText&&(this.TabularColumns[0].HeaderText=this.TextFieldsColumnSource[this.CurrentLevel].HeaderText,this.TabularDataObj.RefreshColumns());let a=new Array(this.NumericFieldsColumnSource.length).fill(0);if(this.ShowGrid&&(r.forEach(c=>{let m=new L.DK;new L.DK,E.ReportViewModel.SetCellValue(c[p[0]],this.TextFieldsColumnSource[this.CurrentLevel].DataFormat,this.TextFieldsColumnSource[this.CurrentLevel].ColumnType,-1,m,this.TextFieldsColumnSource[this.CurrentLevel].ID),e=new L.Ji(this.TabularColumns.length),e.Height=22,e.Cells[0]=m;for(let C=0;C<this.NumericFields.length;C++)this.Parent.PrevData>0?this.Widgets[0].IncludeOpening?a[C]=parseFloat(c[p[C+1]]):a[C]+=parseFloat(c[p[C+1]]):this.Widgets[C].IncludeOpening?a[C]=parseFloat(c[p[C+1]]):a[C]+=parseFloat(c[p[C+1]]),E.ReportViewModel.SetCellValue(c[p[C+1]],this.NumericFieldsColumnSource[C].DataFormat,this.NumericFieldsColumnSource[C].ColumnType,-1,e.Cells[C+1],this.NumericFieldsColumnSource[C].ID);this.TabularDataObj.addRow(e)}),!this.HideGridTotal)){e=new L.Ji(this.TabularColumns.length),e.Height=24,e.Cells[0].IsNormal=!1,e.Cells[0].CellAppearance=this.GrossTotalAppearance,e.Cells[0].Text="Total";for(let c=0;c<this.NumericFields.length;c++)e.Cells[c+1].IsNormal=!1,e.Cells[c+1].CellAppearance=this.GrossTotalAppearance_Data,E.ReportViewModel.SetCellValue(a[c],this.NumericFieldsColumnSource[c].DataFormat,this.NumericFieldsColumnSource[c].ColumnType,-1,e.Cells[c+1],this.NumericFieldsColumnSource[c].ID);this.TabularDataObj.addRow(e);for(let c=0;c<this.NumericFields.length;c++)e.Cells[c+1].IsNormal=!1,e.Cells[c+1].CellAppearance=this.GrossTotalAppearance_Data,E.ReportViewModel.SetCellValue(a[c],this.NumericFieldsColumnSource[c].DataFormat,this.NumericFieldsColumnSource[c].ColumnType,-1,e.Cells[c+1],this.NumericFieldsColumnSource[c].ID);this.TabularDataObj.addRow(e)}this.ChartData=r,this.ChartDataColumns=p,this.RefreshAMChart.Call(),0==this.ChartData.length&&this.ChartData.push({})}OnChartTypeChanged(t){!s.J0.IsEmpty(this.ChartTypes.SelectedValue)&&-1!=s.J0.Int(this.ChartTypes.SelectedValue)&&this.RefreshAMChart.Call()}OnChartDimColumnsChange(t){this.TextFields[0]=this.ChartDimColumns.SelectedValue,this.TextFieldsColumnSource[0]=this.Report.ColumnSource.find(e=>e.ID==this.TextFields[0]),this.RefreshChart()}RefreshChart(){this.IsWidgetChart?(this.LoadingVisibility=!0,this.LoadChartDataForWidget()):(null!=this.Report.ReportData&&0!=this.Report.ReportData.length?(this.LoadChartData(),this.Report.ReportViewType=v.Zv.DashBoard):this.Report.StaticReportType>0&&(this.LoadChartDataByRows(),this.Report.ReportViewType=v.Zv.DashBoard),this.Report.FilterText.forEach(t=>{null!=t.Text&&(this.ChartName=this.ChartName+" - "+t.Label+" : "+t.Text)})),this.TabularDataObj.Width=0,this.ShowGrid&&this.TabularDataObj.ReportColumns.forEach(t=>{t.HeaderAppearance.IsVisible&&(this.TabularDataObj.Width+=t.width)})}static{this.EmptyChartData=[]}static RevenUChartViewModel(){x.EmptyChartData.push({Name:"",Value:0})}get ChartData(){return this._ChartData}set ChartData(t){null!=t&&null!=this.arrNumFormat.find(e=>null!=e)&&t.forEach(e=>{if(this.IsStackChart)for(let o=0;o<this.dtStack.length;o++)null!=this.arrNumFormat[0]&&this.arrNumFormat[0].Divider>1&&(e[this.dtStack[o][this.dtStack_C0].toString()]=parseFloat(e[this.dtStack[o][this.dtStack_C0].toString()])/this.arrNumFormat[0].Divider);else for(let o=0;o<this.NumericFieldsColumnSource.length;o++)null!=this.arrNumFormat[o]&&this.arrNumFormat[o].Divider>1&&(e[this.NumericFieldsColumnSource[o].HeaderText]=parseFloat(e[this.NumericFieldsColumnSource[o].HeaderText])/this.arrNumFormat[o].Divider)}),t!=this._ChartData&&(this._ChartData=t)}DrillDownChartFX(t){if(this.IsStackChart||this.CurrentLevel+1>=this.TextFields.length)return;this.CurrentLevel++,this.DrillBackVisible=!0;let e=this.ChartData[t][this.TextFieldsColumnSource[this.CurrentLevel-1].HeaderText].toString(),o=!1;0!=this.Report.lstGroup.filter(l=>"Summary"==l.DisplayMode).length&&null!=this.Report.ReportSummaryData?this.Report.ReportSummaryDataColumns.Contains(this.TextFields[this.CurrentLevel-1])&&"date"==this.Report.ColumnSourceALL.find(l=>l.ID==this.TextFields[this.CurrentLevel-1]).ColumnType.toLowerCase()&&(o=!0):this.Report.ReportDataColumns.Contains(this.TextFields[this.CurrentLevel-1])&&"date"==this.Report.ColumnSourceALL.find(l=>l.ID==this.TextFields[this.CurrentLevel-1]).ColumnType.toLowerCase()&&(o=!0),this.lstDrillFilter.push(o?this.TextFields[this.CurrentLevel-1]+"= convert('"+this.ChartData[t][this.TextFields[this.CurrentLevel-1]+"_DATE"]+"',System.DateTime)":this.TextFields[this.CurrentLevel-1]+"="+e),this.RefreshChart()}}return x})();var se=d(54189),pe=d(31503),oe=d(61301),Ce=d(76500);class me extends G.g{constructor(i){super(),this.StaticFields=new Array,this.DocsArrowData=new Array,this.FavouriteID=0,this.BgColor="#f9f9f9",this.ClassName="DashFavoritesViewModel",this.DisplayName=h.d.GetResource("Favorite"),this.Column1="0.25*",this.Column2="0.25*",this.Column3="0.25*",this.Column4="0.25*",this.Title=this.DisplayName,this.FavouriteID=i,h.d.admin.GetFavorite("VIEW",i,!0).subscribe(t=>{this.ds=t,this.onLoad()},t=>{}),Logger.InfoLog("DashFavoritesViewModel::Leaving DashFavoritesViewModel")}onClick(i){let t=new $.aF;if(i instanceof se.B){let e=i;if("1"==e.isReport.toString())if("0"==e.Featureactiontypeid)h.d.page.ShowLoading=!1,alert("Report Not Assigned.");else{let o=new E.ReportViewModel;o.ReportViewModel_1(parseInt(e.DBColumnName)),0==o.ReturnType&&h.d.page.addNewTab({component:pe.ReportViewComponent,params:{obj:o}})}else{t.FeatureActionID=parseInt(e.DBColumnName),t.ScreenName=e.ScreenName,t.FeatureID=e.FeatureID,(50==t.FeatureID||"31"==e.Featureactiontypeid||"30"==e.Featureactiontypeid||"215"==e.Featureactiontypeid&&(2==e.FeatureID||3==e.FeatureID))&&(t.FeatureActionTypeID=parseInt(e.Featureactiontypeid)),e.FeatureID>5e4?(t.ScreenType=7,t.FeatureActionTypeID="31"!=e.Featureactiontypeid&&"30"!=e.Featureactiontypeid?2:parseInt(e.Featureactiontypeid)):e.FeatureID>4e4&&(t.ISDoctype=e.DBColumnID);let o={};oe.RibbonExtViewModel.OncmdLoadPage(t,o).then(l=>{if(!o.component)return;let r;"FeatureActionID"==o.basedon?r=h.d.page.tabs.find(p=>p.instance instanceof o.component&&p.instance.FeatureActionID==t.FeatureActionID):"CostCenterID"==o.basedon?r=h.d.page.tabs.find(p=>p.instance instanceof o.component&&p.instance.CostCenterID==t.FeatureID):"Unique"==o.basedon&&(r=h.d.page.tabs.find(p=>p.instance instanceof o.component)),r?(h.d.page.tabs.map(p=>p.active=!1),r.active=!0):(o.title=t.ScreenName,h.d.page.addNewTab(o))})}}else for(let e=0;e<this.StaticFields.length;e++)if(this.oText=this.StaticFields[e],this.oText.DBColumnName==i.toString()){if("1"==this.oText.isReport.toString()){(new E.ReportViewModel).ReportViewModel_1(parseInt(this.oText.DBColumnName))}else t.FeatureActionID=parseInt(this.oText.DBColumnName),t.ScreenName=this.oText.ScreenName,t.FeatureID=this.oText.FeatureID,("31"==this.oText.Featureactiontypeid||"30"==this.oText.Featureactiontypeid)&&(t.FeatureActionTypeID=parseInt(this.oText.Featureactiontypeid)),this.oText.FeatureID>5e4&&(t.ScreenType=7,t.FeatureActionTypeID="31"!=this.oText.Featureactiontypeid&&"30"!=this.oText.Featureactiontypeid?2:parseInt(this.oText.Featureactiontypeid)),oe.RibbonExtViewModel.OncmdLoadPage(t,void 0);break}}onLoad(){Logger.InfoLog("DashFavoritesViewModel::Entering onLoad");let t,e=-1;try{if(null!=this.ds&&this.ds.Tables[0].length>0&&(this.ds.Tables[0]=h.d.IsMobile?[...new Map(this.ds.Tables[0].map(o=>[o.FeatureactionID,o])).values()].filter(o=>1==o.ShowInMobile):[...new Map(this.ds.Tables[0].map(o=>[o.FeatureactionID,o])).values()].filter(o=>1==o.ShowInWeb),this.ds.Tables.length>1&&this.ds.Tables[1].length>0&&(e=parseInt(this.ds.Tables[1][0].MaxRows))),null!=this.ds&&this.ds.Tables.length>2&&this.ds.Tables[2].length>0&&s.J0.String(this.ds.Tables[2][0].OptionsXML).length>0){let o=new s.VB;o.LoadXml(this.ds.Tables[2][0].OptionsXML.toString()),this.BgColor=s.J0.rgbColor(s.VB.SelectSingleNodeText(o.DocumentElement,"BgColor")),"#FFFFFF"==this.BgColor&&(this.BgColor="#f9f9f9")}for(let o=0;o<=e;o++)for(let l=0;l<4;l++)t=this.ds.Tables[0].filter(r=>r.RowNo==o&&r.ColumnNo==l),t.length>0&&(this.oText=new se.B,this.oText.Label=s.J0.String(t[0].DisplayName),this.oText.DBColumnName=t[0].FeatureactionID.toString(),this.oText.SmallImage="/assets/images/menu/"+s.J0.String(t[0].ImagePath).replace("/","''"),this.oText.Row=o+1,this.oText.Column=l,this.oText.ClickCommand.Subscribe(this,"onClick"),this.oText.ScreenName=s.J0.String(t[0].ScreenName),this.oText.ShortcutKey=s.J0.String(t[0].ShortCutKey),s.J0.IsEmpty(t[0].FeatureID)||(this.oText.FeatureID=parseInt(t[0].FeatureID)),this.oText.KeyTip=s.J0.String(t[0].ButtonKeyTip),this.oText.isReport=s.J0.String(t[0].isReport),this.oText.Featureactiontypeid=s.J0.String(t[0].FeatureActionTypeID),this.oText.Data=s.J0.String(t[0].Link),this.oText.WebIcon=Ce.FavoritesViewModel.GetIcon(this.oText),s.J0.IsEmpty(t[0].DocumentType)||(this.oText.DBColumnID=parseInt(t[0].DocumentType)),this.StaticFields.push(this.oText));if(this.StaticFields.length>0){let o=this.StaticFields.Compute("max","Column"),l=0;l=s.J0.Int(o),l>=0&&l<4&&(this.Column1=(100/(l+1)).ToString("N2")+"%",this.Column2=l<1?"0.0*":this.Column1,this.Column3=l<2?"0.0*":this.Column1,this.Column4=l<3?"0.0*":this.Column1),this.StaticFields.filter(r=>!s.J0.IsEmpty(r.Data)).forEach(r=>{r.Data.split(",").forEach(p=>{var n=this.StaticFields.find(u=>u.FeatureID==parseInt(p));if(n){let u=new Te;u.Source=r,u.Destination=n,this.DocsArrowData.push(u)}})})}}catch(o){Logger.ErrorLog("DashFavoritesViewModel::onLoad",o)}Logger.InfoLog("DashFavoritesViewModel::Leaving onLoad")}}class Te{constructor(){this.X1=0,this.X2=0,this.Y1=0,this.Y2=0,this.Stroke="Gray"}}var fe=d(622),Ie=d(63703),le=d(85620),ye=d(75157),ge=d(16909);class Se extends G.g{constructor(i){super(),this.TypeID=0,this.UnApprovedDocumentsVisible=!1,this.DocumentDraftsVisible=!1,this.PDCDocumentsVisible=!1,this.NotifEventsVisible=!1,this.DepreciationPostingVisible=!1,this.RejectedDocumentsVisible=!1,this.DocsToApproveGridVisible=!1,this.CalendarVisible=!1,this.ClassName="DashAddOnsViewModel",this.TypeID=i,1==i?(this.UnApprovedDocumentsVisible=!0,this.UnApprovedDocuments=new fe.UnAppDocumentsViewModel,this.UnApprovedDocuments.DocumentsGrid.Height=void 0):2==i?(this.DocumentDraftsVisible=!0,this.DocumentDrafts=new Ie.DocumentDraftsViewModel(this,1),setTimeout(()=>{this.DocumentDrafts.FillGrid()},500),this.DocumentDrafts.Grid.Height=void 0):3==i?(this.PDCDocumentsVisible=!0,this.PDCDocuments=new le.DashBoardNotifViewModel(4),this.PDCDocuments.Grid.Height=void 0):4==i?(this.NotifEventsVisible=!0,this.NotifEvents=new le.DashBoardNotifViewModel(2),this.NotifEvents.Grid.Height=void 0):5==i?(this.DepreciationPostingVisible=!0,this.DepreciationPosting=new ye.PostDepreciationViewModel("",!0,!1)):7==i?(this.DocsToApproveGridVisible=!0,this.DocsToApprove=new ge.i):8==i&&this.LoadCalendar()}LoadCalendar(){var i=this;return(0,M.A)(function*(){const{RCalenderViewModel:t}=yield Promise.resolve().then(d.bind(d,19384));i.Calendar=new t,i.Calendar._RCalenderViewModel(!1),i.CalendarVisible=!0})()}Refresh(){1==this.TypeID?this.UnApprovedDocuments.OnLoad():2==this.TypeID?this.DocumentDrafts.FillGrid():3==this.TypeID?this.PDCDocuments.InitColumns():4==this.TypeID?this.NotifEvents.RefreshData():5==this.TypeID?this.DepreciationPosting.OnButtonClick("RefreshDepr"):7==this.TypeID&&this.DocsToApprove.LoadDocsToApproveGrid(-1)}refreshUI(){1==this.TypeID?this.UnApprovedDocuments.DocumentsGrid.refreshUI():2==this.TypeID?this.DocumentDrafts.Grid.refreshUI():3==this.TypeID?this.PDCDocuments.Grid.refreshUI():4==this.TypeID?this.NotifEvents.Grid.refreshUI():5==this.TypeID&&this.DepreciationPosting.OnButtonClick("RefreshDepr")}}var Fe=d(43794);class be extends G.g{constructor(i,t){super(),this.Rows=0,this.Columns=0,this.LoadingVisibility=!1,this.RefreshV=new Fe.B,this.ClassName="KPIViewViewModel",this.Report=i,i.Chart=this,this.KPILabels=[];let e=i.Reportds.Tables[0][0].DashKPIXML.toString(),o=new s.VB;o.LoadXml(e),this.Rows=parseInt(o.DocumentElement.attributes.Rows.value),this.Columns=parseInt(o.DocumentElement.attributes.Cols.value);for(let r=0;r<o.DocumentElement.children.length;r++){let p=o.DocumentElement.children[r];for(let n=0;n<p.childNodes.length;n++){let u=p.childNodes[n];if(s.J0.IsEmpty(u.attributes)||null!=u.attributes.Empty)continue;let a=new Ae;a.Row=r,a.Column=n,a.RowSpan=null!=u.attributes.rs?u.attributes.rs.value:"1",a.ColumnSpan=null!=u.attributes.cs?u.attributes.cs.value:"1",a.ShowCaption=null==u.attributes.caption,a.ShowCaption||(a.Row1Height="0");let c=s.VB.SelectSingleNode(u,"ID");if(null!=c){var l=i.ReportColumns.find(m=>m.ID==c.innerHTML);l&&(a.DBColumnName=l.ID,a.Field=l,a.FieldIndex=i.ReportColumns.indexOf(l),a.ShowCaption&&(a.Header.Label=l.HeaderText,a.Header.FontSize=h.d.SessionManager.GetColor(l.HeaderAppearance.FontSize),a.Header.ForeColor=h.d.SessionManager.GetColor(l.HeaderAppearance.ForeColor),a.Header.BackColor=h.d.SessionManager.GetColor(l.HeaderAppearance.BackColor),a.Header.FontFamily=l.HeaderAppearance.FontFamilyName,a.Header.Align=l.HeaderAppearance.Alignment.toString(),a.Header.VAlign="Center"),a.Data.FontSize=l.DataAppearance.FontSize,a.Data.ForeColor=h.d.SessionManager.GetColor(l.DataAppearance.ForeColor),a.Data.BackColor=h.d.SessionManager.GetColor(l.DataAppearance.BackColor),a.Data.FontFamily=l.DataAppearance.FontFamilyName,a.Data.Align=l.DataAppearance.Alignment.toString(),a.Data.VAlign="Center")}this.KPILabels.push(a)}}}LoadChartData(){let i;i=this.Report.lstGroup.find(o=>"Summary"==o.DisplayMode)&&null!=this.Report.ReportSummaryData?this.Report.ReportSummaryData:this.Report.ReportData;let e=this.Report.AddSubtotals_RT(this.Report.GrpReportTotal,0);for(let o=0;o<this.Report.ReportColumns.length;o++)e.Cells[o].CellAppearance=this.Report.ReportColumns[o].DataAppearance.Clone();this.Report.ApplyKPI(e);for(let o=0;o<this.KPILabels.length;o++){let l=this.KPILabels[o];null!=l.Field&&(l.ImagePath=null,-1!=l.FieldIndex&&l.FieldIndex<e.Cells.length&&(l.Data.Label=e.Cells[l.FieldIndex].Text,l.Data.ForeColor=h.d.SessionManager.GetColor(e.Cells[l.FieldIndex].CellAppearance.ForeColor),l.ImagePath="pack://application:,,,/"+e.Cells[l.FieldIndex].CellAppearance.ImagePath))}this.RefreshV.next("")}RefreshChart(){null!=this.Report.ReportData&&(this.LoadChartData(),this.Report.ReportViewType=v.Zv.DashBoard)}}class Ae extends P.MI{constructor(){super(),this.FieldIndex=-1,this.Field=null,this.ShowCaption=!1,this.ShowImage=!1,this.Header=new ae,this.Data=new ae,this.Row1Height="0.4*",this.Row2Height="0.6*"}}class ae extends P.MI{constructor(){super(...arguments),this.FontFamily="Calibri",this.Field=null}}var re=d(89717),Me=d(62099),Re=d(98846);class we extends G.g{get ShowReportFilter(){return this._ShowReportFilter}set ShowReportFilter(i){this._ShowReportFilter=i,i&&this.ReportFilter.RefreshCostCenterItems()}constructor(){super(),this.InitUI=!1,this.IsDashClick=!1,this.IsAllDashBoardsLoaded=!1,this.AllDashBoards=[],this.DashResize=null,this.ShowList=!1,this._ShowReportFilter=!1,this.BackColor="White",this.Rows=0,this.Columns=0,this.IsRowHeightExists=!1,this.ds=null,this.dsWidgetNames=null,this.disname="",this.DashBoardID=0,this.dicPromises=new _.G9}DBViewViewModel_1(i){this.DashBoardID=i,this.DisplayName=h.d.GetResource("Loading"),this.DBList=new Array,this.InitDashboard(i)}InitDashboard(i){this.DashBoardID=i,h.d.report.GetDashBoard(1,i,!0).then(t=>{this.ds=t,this.disname=this.ds.Tables[0][0].DashBoardName.toString();let e=this.ds.Tables[0][0].DashBoardType.toString().split("*");this.Rows=parseInt(e[0]),this.Columns=parseInt(e[1]),this.RowHeight=new Array(this.Rows).fill(0),this.RowHeightXML="",this.DBListTemp=new Array(this.Rows),this.DBListTemp.Clear(),this.DBList.forEach(o=>{o.timer&&(o.timer.Enabled=!1)}),this.DBList.Clear(),this.dicPromises.Clear();for(let o=0;o<this.ds.Tables[0].length;o++){let l=new ne;l.DBPanel_1(this,this.ds.Tables[0][o]),this.DBList.push(l),this.DBListTemp[parseInt(l.Row)]||(this.DBListTemp[parseInt(l.Row)]=[]),this.DBListTemp[parseInt(l.Row)].push(l),(1==l.TypeID||2==l.TypeID||5==l.TypeID)&&this.dicPromises.push(o,h.d.report.GetReport(0,l.ReportID,!0))}if(!s.J0.StringIsNullOrEmpty(this.RowHeightXML)){if(this.RowHeightXML.Contains(",")){let o=this.RowHeightXML.split(",");for(let l=0;l<this.Rows;l++)this.RowHeight[l]=l<o.length?parseInt(o[l]):0}else if(parseInt(this.RowHeightXML)>0)for(let o=0;o<this.Rows;o++)this.RowHeight[o]=parseInt(this.RowHeightXML);this.RowHeight.forEach(o=>{o>0&&(this.IsRowHeightExists=!0)})}return Promise.all(this.dicPromises.values).then(o=>{for(let l=0;l<this.dicPromises.keys.length;l++)this.ds.Tables[0][this.dicPromises.keys[l]].ReportDefn=o[l];this.IsDashClick&&null!=this.DashResize&&(this.DashResize.Call(!0),this.DashResize.Call(!1)),setTimeout(()=>{let l=1;this.DBList.forEach(r=>{r.Visible&&(setTimeout(()=>{r.DBPanel_1_Async()},50*l),l++)}),this.worker_RunWorkerCompleted(null,null)},20)})})}worker_RunWorkerCompleted(i,t){this.DisplayName=this.disname}getStyles(){let i={},t=!1;return 0!=this.DBList.length&&(t=3==this.DBList[0].dr.Mode),h.d.IsMobile&&!t?i=h.d.IsAndroid?{gridTemplateColumns:"minmax(100px,100%)",gridTemplateRows:`repeat(${this.DBList.filter(e=>e.Visible).length},1fr)`}:{gridTemplateColumns:"minmax(100px,100%)"}:(i={gridTemplateColumns:`repeat(auto-fit,${100/this.Columns}%)`,gridTemplateRows:`repeat(auto-fit,${100/this.Rows}%)`,gridGap:"6px"},this.IsRowHeightExists&&(i.gridTemplateRows=`${this.RowHeight.map(e=>e>0?e+"px":"1fr").join(" ")}`)),i}getBackground(i){return h.d.IsMobile?{background:i.BodyBackColor}:{}}getDBpanelStyles(i){if(h.d.IsMobile&&3!=i.dr.Mode){let t={};return this.RowHeight[i.Row]>0&&i.Visible?t.height=i.RowSpan*this.RowHeight[i.Row]+"px":i.Visible?2==i.TypeID?t.height="calc(71%)":6!=i.TypeID&&(t.height=`${i.RowSpan*this.RowHeight[i.Row]==0?(window.innerHeight-150)/this.Rows:this.RowHeight[i.Row]}px`):(t.margin="0",t.height="0",t.display="none"),(1237==i.dr.NodeID||1234==i.dr.NodeID||1238==i.dr.NodeID)&&(t.height="auto"),t}return{gridColumnStart:`${parseInt(i.Column)+1}`,gridColumnEnd:`span ${i.ColumnSpan}`,gridRowStart:`${parseInt(i.Row)+1}`,gridRowEnd:`span ${i.RowSpan}`}}LoadDashList(){this.IsAllDashBoardsLoaded=!0,this.ShowList=!0;let i=h.d.report.GetDashBoard(2,0),t=null;i.Tables[0].forEach(e=>{if(t!=e.GroupName.toString()){t=e.GroupName.toString();let l=new Z.D;l.Label=t,l.SectionID="1",this.AllDashBoards.push(l)}let o=new $.aF;o.FeatureActionTypeID=parseInt(e.DashBoardID),o.AppPath=o.FeatureActionTypeID==this.DashBoardID?"#FFE8A6":"#F9F9F9",o.Label=e.DashBoardName.toString(),this.AllDashBoards.push(o)})}OnDashBoardClick(i){this.IsDashClick=!0;var t=this.AllDashBoards.find(e=>e instanceof $.aF&&"#FFE8A6"==e.AppPath);t&&(t.AppPath="#F9F9F9"),i.AppPath="#FFE8A6",this.InitDashboard(i.FeatureActionTypeID)}OnButtonClick(i){"ShowList"==i?(this.ShowList=!this.ShowList,s.J0.SetPersonalize("ShowDBList",this.ShowList?"1":"0"),this.IsAllDashBoardsLoaded||this.LoadDashList()):"DashboardFilter"==i&&(null==this.ReportFilter&&(this.ReportFilter=new he(this)),this.ShowReportFilter=!0)}ApplyDBFilters(){setTimeout(()=>{this.filterworker_DoWork(null,null)},50)}filterworker_DoWork(i,t){this.DBList.forEach(e=>{2==e.TypeID&&null!=e.Chart?e.Chart.IsWidgetChart?e.Chart.OnButtonClick("WidgetFilterOK"):e.Chart.Report.OnButtonClick("OK_CLICK"):5==e.TypeID&&null!=e.KPI?e.KPI.Report.OnButtonClick("OK_CLICK"):6==e.TypeID&&null!=e.Widget&&e.Widget.Refresh()})}}class ne{get IsReportWidget(){return!!(h.d.IsMobile&&!s.J0.IsEmpty(this.Report)&&309==this.Report.ReportID||1==this.TypeID&&!s.J0.IsEmpty(this.Report)&&(273==this.Report.ReportID||276==this.Report.ReportID||304==this.Report.ReportID||305==this.Report.ReportID||310==this.Report.ReportID||307==this.Report.ReportID||306==this.Report.ReportID||308==this.Report.ReportID)||6==this.TypeID&&(72==this.EmpWidgetTypeID||26==this.EmpWidgetTypeID||60==this.EmpWidgetTypeID)||2==this.TypeID&&101==this.EmpWidgetTypeID)}get ReportFilterText(){return null!=this.Report?this.Report:null!=this.Chart?this.Chart.Report:null!=this.KPI?this.KPI.Report:null}constructor(){this.TypeID=0,this.AddOnID=0,this.Parent=null,this.Visible=!1,this.AutoRefresh=!1,this.Filter=!1,this.RefreshRate=0,this.TopRecords=0,this.timer=null,this.Row="0",this.Column="0",this.ColumnSpan="1",this.RowSpan="1",this.ShowBorder=!1,this.ShowUILoad=!0,this.ExportVisible=!1,this.PrintVisible=!0,this.RefreshVisibility=!0,this.RegenerateVisibility=!0,this.FilterVisibility=!1,this.GetAllDataVisibility=!0,this.ButtonColor="#111111",this.ButtonOpacity=1,this.HeaderForeColor="#00A9DA",this.HeaderBackColor="#FFFF00",this.BodyBackColor="#FFFFFF",this.PointsColor="#777777",this.ShowHeader=!0,this.ShowActions=!0,this.ScreenTemp=[],this.PrevData=0,this.PrevDataFilter=0,this.IsMaximize=!1,this.IsWidgetChart=!1,this.xOptions=null,this.EmpWidgetTypeID=0,this.ShowLoading=!0}DBPanel_1(i,t){this.dr=t,this.Parent=i,this.AutoRefresh=(0,Y.yG0)(t.AutoRefresh),this.AutoRefresh&&(this.RefreshRate=s.J0.Double(t.RefreshRate),this.RefreshRate<=0&&(this.AutoRefresh=!1)),null!=t.Filter&&(this.Filter=(0,Y.yG0)(t.Filter)),this.Header=t.ReportName.toString(),this.TopRecords=parseInt(t.TopRecords),this.TypeID=null!=t.TypeID?parseInt(t.TypeID):1,this.Row=t.RowNo.toString(),this.Column=t.ColNo.toString(),this.RowSpan=t.RowSpan.toString(),this.ColumnSpan=t.ColSpan.toString(),this.ShowBorder=!0;let e=s.J0.String(t.Options);if(e.length>0&&e.startsWith("<Options>")){let o;this.xOptions=new s.VB,this.xOptions.LoadXml(e),this.HeaderBackColor=s.J0.rgbColor(s.VB.SelectSingleNodeText(this.xOptions.DocumentElement,"HeaderBackClr")),this.HeaderForeColor=s.J0.rgbColor(s.VB.SelectSingleNodeText(this.xOptions.DocumentElement,"HeaderForeClr")),this.ButtonColor="#FFFFFF00"==this.HeaderBackColor||"#FFFFFF"==this.HeaderBackColor||"White"==this.HeaderBackColor?"#111111":this.HeaderForeColor,o=s.J0.rgbColor(s.VB.SelectSingleNode(this.xOptions.DocumentElement,"BodyBackClr")),null!=o&&"#FFFFFF00"!=o.innerHTML&&(this.BodyBackColor=s.J0.rgbColor(o.innerHTML)),o=s.VB.SelectSingleNode(this.xOptions.DocumentElement,"HideHeader"),this.ShowHeader=!(null!=o&&"1"==o.innerHTML),o=s.VB.SelectSingleNode(this.xOptions.DocumentElement,"HideActions"),this.ShowActions=!(null!=o&&"1"==o.innerHTML),o=s.VB.SelectSingleNode(this.xOptions.DocumentElement,"WIDGETCHART"),null!=o&&(this.IsWidgetChart=!0,o=s.VB.SelectSingleNode(this.xOptions.DocumentElement,"WidgetChartPrevious"),null!=o&&(this.PrevData=parseInt(o.innerHTML)),o=s.VB.SelectSingleNode(this.xOptions.DocumentElement,"WidgetChartPreviousFilter"),null!=o&&(this.PrevDataFilter=parseInt(o.innerHTML))),o=s.VB.SelectSingleNode(this.xOptions.DocumentElement,"BackColor"),null!=o&&""!=o.innerHTML&&(i.BackColor=s.J0.rgbColor(o.innerHTML),"#FFFFFF"!=i.BackColor&&"#FFFFFF00"!=i.BackColor&&(this.ShowBorder=!1)),o=s.VB.SelectSingleNode(this.xOptions.DocumentElement,"RowHeight"),null!=o&&(i.RowHeightXML=o.innerHTML),o=s.J0.rgbColor(s.VB.SelectSingleNode(this.xOptions.DocumentElement,"PointsColor")),this.PointsColor=null!=o?o.innerHTML:"#777777"}else{let o=e.split("~");o.length>1&&(this.HeaderBackColor=s.J0.rgbColor(o[0]),this.HeaderForeColor=s.J0.rgbColor(o[1]),this.ButtonColor="#FFFFFF00"==this.HeaderBackColor||"#FFFFFF"==this.HeaderBackColor||"White"==this.HeaderBackColor?"#111111":o[1],o.length>2&&"#00FFFFFF"!=o[2]&&(this.BodyBackColor=s.J0.rgbColor(o[2])),this.ShowHeader=!(o.length>3&&"1"==o[3]),o.length>4&&"WIDGETCHART"==o[4]&&(this.IsWidgetChart=!0,o.length>5&&""!=o[5]&&(this.PrevData=parseInt(o[5]))),o.length>6&&""!=o[6]&&(i.BackColor=s.J0.rgbColor(o[6]),"#FFFFFF"!=i.BackColor&&"#FFFFFF00"!=i.BackColor&&(this.ShowBorder=!1)),o.length>7&&""!=o[7]&&(this.PointsColor=s.J0.rgbColor(o[7])),o.length>8&&""!=o[8]&&(this.ShowActions=!(o.length>8&&"1"==o[8])))}this.PrevRow=this.Row,this.PrevColumn=this.Column,this.PrevRowSpan=this.RowSpan,this.PrevColumnSpan=this.ColumnSpan,this.Screen=[],this.ReportID=parseInt(t.ReportID),0==this.TypeID?this.Visible=!1:2==this.TypeID&&this.IsWidgetChart?this.Visible=!0:this.ReportID>0?(this.Visible=!0,this.PrintVisible=!1,this.ExportVisible=!1):this.Visible=!1}DBPanel_1_Async(){var i=this;return(0,M.A)(function*(){if(2==i.TypeID&&i.IsWidgetChart)i.Visible=!0,i.PrintVisible=!0,i.ExportVisible=!0,i.Chart=new ie,i.Chart.RevenUChartViewModel_1(i,null,i.dr),i.ScreenTemp.push(i.Chart),"My Salary"==i.Chart.drChartDefn.ReportName&&(i.EmpWidgetTypeID=101);else if(i.ReportID>0)if(i.Visible=!0,i.PrintVisible=!1,i.ExportVisible=!1,1==i.TypeID)i.Report=new E.ReportViewModel,207==i.ReportID||307==i.ReportID||306==i.ReportID||308==i.ReportID||276==i.ReportID||310==i.ReportID?(i.EmpWidgetTypeID=i.ReportID,i.Report.ReportViewModel_2(i.ReportID,v.Zv.DashBoard,i.dr.ReportDefn,i,null,!1,!1,h.d.SessionManager.iEmployee)):i.Report.ReportViewModel_2(i.ReportID,v.Zv.DashBoard,i.dr.ReportDefn,i,null),i.Report.SearchVisibility=i.Filter,i.ScreenTemp.push(i.Report),i.FilterVisibility=!0,i.PrintVisible=!0,i.ExportVisible=!0,i.PrintVisible=h.d.SessionManager.HideUnathorizedAccess?i.Report.ButtonPrint.Visible:i.Report.ButtonPrint.Enable,i.ExportVisible=h.d.SessionManager.HideUnathorizedAccess?i.Report.ButtonExport.Visible:i.Report.ButtonExport.Enable;else if(2==i.TypeID){let t=new E.ReportViewModel;t.ReportViewModel_2(i.ReportID,v.Zv.LoadDataOnly,i.dr.ReportDefn,i,null),i.Chart=new ie,i.Chart.RevenUChartViewModel_1(i,t,i.dr),i.ScreenTemp.push(i.Chart),i.PrintVisible=!0,i.ExportVisible=!0}else if(5==i.TypeID){let t=new E.ReportViewModel;t.ReportViewModel_2(i.ReportID,v.Zv.LoadDataOnly,i.dr.ReportDefn,i,null),i.KPI=new be(t,i.dr),i.ScreenTemp.push(i.KPI)}else if(6==i.TypeID)if(72==i.ReportID){i.EmpWidgetTypeID=i.ReportID,i.QuickViewDetails=new Re.H;let t=i.QuickViewDetails.QuickViewScreenViewModel_2(50051,h.d.SessionManager.iEmployee,-1);t&&t.then(()=>{i.ScreenTemp.push(i.QuickViewDetails)})}else i.EmpWidgetTypeID=i.ReportID,i.Widget=new Q,i.Widget.WidgetViewModel_1(i,i.ReportID,i.dr.WidgetXML.toString()),i.ScreenTemp.push(i.Widget);else if(3==i.TypeID)i.RefreshVisibility=!1,i.RegenerateVisibility=!1,i.GetAllDataVisibility=!1,i.AddOnID=i.ReportID,i.AddOnID>0&&(i.RefreshVisibility=!0,i.AddOn=new Se(i.AddOnID),i.ScreenTemp.push(i.AddOn));else if(4==i.TypeID){i.RefreshVisibility=!1,i.RegenerateVisibility=!1,i.GetAllDataVisibility=!1;let t=new me(i.ReportID);i.BodyBackColor=h.d.SessionManager.GetColor(t.BgColor),i.ScreenTemp.push(t)}else 7==i.TypeID&&(i.RefreshVisibility=!1,i.RegenerateVisibility=!1,i.GetAllDataVisibility=!1,i.ReportID>0&&i.ScreenTemp.push(new re.BulkEditViewModel(i.ReportID,i)));2==i.TypeID&&null!=i.Chart?i.Chart.IsWidgetChart?i.Chart.RefreshChart():i.Chart.Report.Refresh():5==i.TypeID&&null!=i.KPI?i.KPI.Report.Refresh():6==i.TypeID&&null!=i.Widget&&(s.J0.IsEmpty(i.Parent.ReportFilter)||(i.Widget.dtFilterAsnDate=i.Parent.ReportFilter.DateField.ToDatePicker.Date),i.Widget.Refresh()),i.ShowLoading=!1,i.AutoRefresh&&i.Visible&&(i.timer=new s.M4,i.timer.Interval=i.RefreshRate<1?1e4*i.RefreshRate:60*i.RefreshRate*1e3,i.timer.Elapsed(i,"timer_Elapsed"),i.timer.Enabled=!0)})()}OnButtonClick(i){"Regenerate"==i?1==this.TypeID?this.Report.OnButtonClick("Regenerate"):2==this.TypeID?this.Chart.IsWidgetChart?this.Chart.ShowWidgetFilter=!0:this.Chart.Report.OnButtonClick("Regenerate"):3==this.TypeID||5==this.TypeID&&this.KPI.Report.OnButtonClick("Regenerate"):"Refresh"==i?1==this.TypeID?this.Report.Refresh():2==this.TypeID?this.Chart.IsWidgetChart?this.Chart.RefreshChart():this.Chart.Report.Refresh():3==this.TypeID?this.AddOn.Refresh():5==this.TypeID&&this.KPI.Report.Refresh():"GetAllData"==i?1==this.TypeID?(this.Report.TopRecords=0,this.Report.Refresh()):2==this.TypeID?this.Chart.IsWidgetChart?this.Chart.RefreshChart():(this.Chart.Report.TopRecords=0,this.Chart.Report.Refresh()):3==this.TypeID||5==this.TypeID&&(this.KPI.Report.TopRecords=0,this.KPI.Report.Refresh()):"Filter"==i?1==this.TypeID&&(this.Report.ShowExport=!1,this.Report.ShowReportFilter?(this.Report.ShowReportFilter=!1,this.Report.ShowRightPanel=!1):(this.Report.ShowReportFilter=!0,this.Report.ShowRightPanel=!0)):"Maximize"==i&&(this.IsMaximize=!this.IsMaximize,setTimeout(()=>{null!=this.Chart?this.Chart.TabularDataObj.refreshUI():null!=this.AddOn?this.AddOn.refreshUI():7==this.TypeID?this.ScreenTemp.length>0&&this.ScreenTemp[0]instanceof re.BulkEditViewModel&&this.ScreenTemp[0].EditGrid.refreshUI():1==this.TypeID&&"ReportViewModel"==this.ScreenTemp[0].ClassName&&this.ScreenTemp[0].angularGrid.resizerService.resizeGrid()},50))}timer_Elapsed(i,t){this.timer.Enabled=!1,h.d.page.isActiveTab(this.Parent)&&(1==this.TypeID?!this.Report.LoadingVisibility&&!this.Report.process.IsBusy&&this.Report.Refresh(!1):2==this.TypeID?this.Chart.Report.Refresh():3==this.TypeID?this.AddOn.Refresh():5==this.TypeID?this.KPI.Report.Refresh():6==this.TypeID&&this.Widget.Refresh()),this.timer.Enabled=!0}}class he extends J.d{constructor(i){super(),this.Parent=i,this.tree=[],this.CostCenterFilters=[],this.CostCenters=new N.y$(0),this.CostCenters.Label=h.d.GetResource("Reports_SelectCostCenter"),this.CostCenters.LblWidth="140",this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange");let t=new X.s;t.IsReportViewScreen=!0,this.DateField=new O.w(t),this.DateField.ID="DateField";let e=new k.ir;this.DateField.Caption.Text="Date",this.DateField.CDGDO=e,this.DateField.CDGDO.DataType="DATE",this.DateField.Condition.SelectedValue="Between",this.DateField.Condition.SetSelectedItem(this.DateField.Condition.SelectedValue),this.DateField.OnConditionSelectionChanged(this.DateField.Condition.SelectedValue),this.DateField.Member.Visible=!1,this.DateField.DeleteVisible=!1}RefreshCostCenterItems(){this.CostCenters.CrFilter!=this.Parent.DashBoardID&&(this.CostCenters.Items.Clear(),this.CostCenters.SelectedIndex=-1,this.CostCenterFilters.Clear(),null!=this.tree&&this.tree.Clear()),this.CostCenters.CrFilter=this.Parent.DashBoardID,this.Parent.DBList.forEach(i=>{1==i.TypeID&&null!=i.Report?null!=i.Report.oReportDialog?this.FillCostCenterItems(i.Report.oReportDialog.CostCenters):null!=i.Report.Filter&&this.FillCostCenterItems(i.Report.Filter.CostCenters):2==i.TypeID&&null!=i.Chart&&(i.Chart.IsWidgetChart||(null!=i.Chart.Report.oReportDialog?this.FillCostCenterItems(i.Chart.Report.oReportDialog.CostCenters):null!=i.Chart.Report.Filter&&this.FillCostCenterItems(i.Chart.Report.Filter.CostCenters)))})}FillCostCenterItems(i){i.Items.forEach(t=>{this.CostCenters.Items.find(e=>e.Value==t.Value&&e.Parent==t.Parent)||this.CostCenters.Items.push(t)})}OnButtonClick(i){"FilterCancel"==i?this.Parent.ShowReportFilter=!1:"FilterOK"==i&&(this.Parent.DBList.forEach(t=>{1==t.TypeID&&null!=t.Report?(t.Report.FromDatePicker.Date=this.DateField.FromDatePicker.Date,t.Report.ToDatePicker.Date=this.DateField.ToDatePicker.Date,this.SetCCFilters(t.Report.oReportDialog?t.Report.oReportDialog:t.Report.Filter),t.Report.OnButtonClick("OK_CLICK")):2==t.TypeID&&null!=t.Chart?t.Chart.IsWidgetChart?(t.Chart.FromDate.Date=this.DateField.FromDatePicker.Date,t.Chart.ToDate.Date=this.DateField.ToDatePicker.Date):(t.Chart.Report.FromDatePicker.Date=this.DateField.FromDatePicker.Date,t.Chart.Report.ToDatePicker.Date=this.DateField.ToDatePicker.Date,this.SetCCFilters(t.Chart.Report.oReportDialog?t.Chart.Report.oReportDialog:t.Chart.Report.Filter)):5==t.TypeID&&null!=t.KPI&&(t.KPI.Report.FromDatePicker.Date=this.DateField.FromDatePicker.Date,t.KPI.Report.ToDatePicker.Date=this.DateField.ToDatePicker.Date,this.SetCCFilters(t.KPI.Report.oReportDialog?t.KPI.Report.oReportDialog:t.KPI.Report.Filter))}),this.Parent.ShowReportFilter=!1,this.Parent.ApplyDBFilters())}SetCCFilters(i){this.CostCenterFilters.forEach(t=>{if(t.SelectedNodes.length>0&&i.CostCenters.Items.find(e=>parseInt(e.Value)==t.CostCenterID)){let e=i.CostCenterFilters.find(o=>o.CostCenterID==t.CostCenterID);null!=e?(e.SelectedNodes=t.SelectedNodes,e.SelectedNodesTag=t.SelectedNodesTag):(e=new Me.x(t.CostCenterID,t.LookupTypeID>0?t.LookupTypeID.toString():"",t.CostCenter,i),e.SelectedNodes=t.SelectedNodes,e.SelectedNodesTag=t.SelectedNodesTag,i.CostCenterFilters.push(e)),"StaticReportFilterViewModel"==i.ClassName&&i.TreeCCID==t.CostCenterID&&(i.DefaultTreeSelectedNodes=e.SelectedNodes)}})}OnCostCenterChange(i){if(!s.J0.IsEmpty(this.CostCenters.SelectedValue)&&(0==this.tree.length||this.tree[0].CostCenterID!=parseInt(this.CostCenters.SelectedValue))){let t=0;null!=this.CostCenters.SelectedItem&&!s.J0.IsEmpty(this.CostCenters.SelectedItem.Parent)&&(t=s.J0.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),t,0,null)}}LoadCostCenterTree(i,t,e,o){this.tree.Clear();let r,l="";if(50002==i&&"True"==h.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==h.d.SessionManager.Preferences["LW Reports"]&&(l=s.J0.IsEmpty(h.d.SessionManager.LocationWhere)?"NodeID IN (-1234)":"NodeID IN ("+h.d.SessionManager.LocationWhere+")"),null==o)for(let u=0;u<this.CostCenterFilters.length;u++){let a=this.CostCenterFilters[u];if(a.CostCenterID==i&&a.LookupTypeID==t){o=a.SelectedNodes;break}}44==i&&t>0&&(l="A.LookupType="+t),r=new K.T,null==o?r.TreeViewModel_5(i,this,e,l,""):r.TreeViewModel_6(i,this,e,l,o,""),r.LookupTypeID=t,r.HeaderVisiblity=!1,r.OnNodeSelected||(r.OnNodeSelected=new P.Yk,r.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(r)}}},75157:(ee,j,d)=>{d.r(j),d.d(j,{PostDepreciationViewModel:()=>Z});var M=d(32040),h=d(43767),s=d(26336),G=d(54581),J=d(33784),K=d(7321),X=d(82503),O=d(21774),k=d(85221),P=d(72247),N=d(27730),E=d(20643),Y=d(23603),v=d(58170),$=d(88514);class Z extends J.d{constructor(T,g,I){super(),this.FilterVisibility=!1,this.DateFilter="",this.FromDate=new X.Lc(0),this.AsonDate=new X.Lc(0),this.DateRanges=new N.y$(0),this.PostButtonLabel=null,this.Enable=!0,this.IsDashBoard=!1,this.IsUnPostScreen=!1,this.SystemDate=Date.Today(),this.IsPostingOnScheduleDate=!1,this.AllowEditPostingDate=!1,this.strSelect="",this.strJoin="",this.DateColIDs=new Array,this.Ddate=Date.Today(),this.SelectUnCheck=0,this.sbSchdulesDeleted="",this.iLoop=0,this.iStart=1,this.JVCCID=0,this.iFailure=0,this.dicVouchers=new s.bT,this.dicVouchersCnt=new s.bT,this.ClassName="PostDepreciationViewModel",this.IsDashBoard=g,this.DisplayName=this.Title=T,this.IsUnPostScreen=I,this.FromDate.Date=Date.Today().AddDays(1-Date.Today().getDate()),this.AsonDate.Date=this.FromDate.Date.AddMonths(1).AddDays(-1),this.DateRanges=new N.y$,this.DateRanges.Items=E.w.items_DateRanges,this.DateRanges.SelectionChangedCommand.Subscribe(this,"OnDateRangesSelectionChanged"),g?(this.FromDate.Width="190",this.AsonDate.Width="190",this.FromDate.LblWidth="72",this.AsonDate.LblWidth="80",window.innerWidth<=1540&&(this.FromDate.Width="",this.AsonDate.Width="",this.FromDate.LblWidth="",this.AsonDate.LblWidth="")):(this.FromDate.Width="150",this.AsonDate.Width="150"),this.PostButtonLabel=I?"Un-Post":M.d.GetResource("Post"),this.FromDate.Label=M.d.GetResource("FromDate"),this.AsonDate.Label=M.d.GetResource("ToDate");try{this.DepreciationGrid=new K.vv,this.DepreciationGrid.Width="",this.DepreciationGrid.Height=0,g||(this.DepreciationGrid.SearchVisible=!0,this.DepreciationGrid.SelectAll.Visible=!0,this.DepreciationGrid.SortVisible=!0,this.FilterVisibility=!0),this.DepreciationGrid.SelectAll.DBColumnName="select",this.InitColumns(),this.FilterVisibility?this.InitFilterScreen():this.DeprDataFilling()}catch(f){Logger.ErrorLog("PostDepreciationViewModel","Constructor",f)}}InitColumns(){let T=new Array,g=new O.O7;g.Header=M.d.GetResource("select"),g.DisplayMember="select",g.DataType="CheckBox",g.Width=55,g.CheckedChanged.Subscribe(this,"OnCheckedChanged"),T.push(g),this.IsUnPostScreen||(this.AllowEditPostingDate=M.d.SessionManager.IsActionAssigned(72,"Allow editing of depreciation posting date"),this.AllowEditPostingDate&&(g=new O.O7,g.Header="Post Date",g.DisplayMember="PostDate",g.DataType="DATE",g.Width=110,g.ReadOnly=!1,g.CheckedChanged.Subscribe(this,"OnCheckedChanged"),T.push(g)));let f,I=M.d.report.GetReportData(12,this.IsUnPostScreen?201:197,null),y=1,w="";I.Tables[0].forEach(A=>{f=new O.O7,f.Header="Asset Code"==A.Caption.toString()?M.d.GetResource("PDAssetCode"):"Asset Name"==A.Caption.toString()?M.d.GetResource("PDAssetName"):"Start Date"==A.Caption.toString()?M.d.GetResource("PDStartDate"):"End Date"==A.Caption.toString()?M.d.GetResource("PDEndDate"):"Depr Amount"==A.Caption.toString()?M.d.GetResource("PDDeprAmount"):"Accu. Depr"==A.Caption.toString()?M.d.GetResource("PDAccuDepr"):"Net Value"==A.Caption.toString()?M.d.GetResource("PDNetValue"):"Put To Use"==A.Caption.toString()?M.d.GetResource("PDPuttouse"):A.Caption.toString(),f.ID=A.ID.toString(),f.DisplayMember=A.ID.toString(),f.DataType=A.DType.toString(),"DATE"==f.DataType?(this.DateColIDs.push(f.DisplayMember),f.DisplayMember=f.DisplayMember+"_Key"):"FLOAT"==f.DataType?f.DecimalPoints=h.J0.IsNum(A.Decimals)?h.J0.Int(A.Decimals).toString():M.d.SessionManager.Preferences.DecimalsinAmount:"VoucherNo"==f.ID&&(f.DataType="LINK_VOUCHER"),f.ReadOnly=!0,f.Width=parseInt(A.Width),null!=A.Visible&&0==parseInt(A.Visible)&&(f.IsVisible=!1),T.push(f),33==f.ID.length&&(w="T"+y,"ACC_Assets"==A.SFSysTableName.toString()?null!=A.SSFIsFK&&(0,G.yG0)(A.SSFIsFK)?(this.strSelect+="DATE"==f.DataType?",convert(datetime,"+w+"."+A.SSFSysColumnName.toString()+") "+f.ID:","+w+"."+A.SSFSysColumnName.toString()+" "+f.ID,this.strJoin+=" left join "+A.SSFParentCostCenterSysName.toString()+" "+w+" with(nolock) on "+w+"."+A.SSFParentCostCenterColSysName.toString()+"=acc."+A.SFSysColumnName.toString()):this.strSelect+="DATE"==f.DataType?",convert(datetime,Acc."+A.SFSysColumnName.toString()+") "+f.ID:",Acc."+A.SFSysColumnName.toString()+" "+f.ID:"COM_CCCCDATA"==A.SFSysTableName.toString()&&null!=A.SSFIsFK&&(0,G.yG0)(A.SSFIsFK)&&(this.strSelect+="DATE"==f.DataType?",convert(datetime,"+w+"."+A.SSFSysColumnName.toString()+") "+f.ID:","+w+"."+A.SSFSysColumnName.toString()+" "+f.ID,this.strJoin+=" left join "+A.SSFParentCostCenterSysName.toString()+" "+w+" with(nolock) on "+w+"."+A.SSFParentCostCenterColSysName.toString()+"=cc."+A.SFSysColumnName.toString())),y++}),this.DepreciationGrid.Columns=T}DeprDataFilling(){if(this.deprTable=null,null==this.FromDate.Date||null==this.AsonDate.Date)return null==this.AsonDate.Date?this.DisplayMessage="Select "+this.AsonDate.Label:null==this.FromDate.Date&&(this.DisplayMessage="Select "+this.FromDate.Label),void(this.MessageVisibility=!0);let g,I,T={strTreeJoin:"",strTreeWhere:""};if(this.IsDashBoard||(this.DateFilter="From : "+this.FromDate.Date.ToString(M.d.SessionManager.Preferences["Date Format"]),this.DateFilter+="    To : "+this.AsonDate.Date.ToString(M.d.SessionManager.Preferences["Date Format"]),this.GetFilters(T)),this.SystemDate=Date.Today(),this.deprTable=Y.Document.GetDepreciationDocuments(this.IsUnPostScreen,this.FromDate.Date,this.AsonDate.Date,this.strSelect,T.strTreeJoin+this.strJoin,T.strTreeWhere),null!=this.deprTable&&this.deprTable.Tables.length>0&&this.deprTable.Tables[0].length>0){this.deprTable.Columns[0].push("select"),this.AllowEditPostingDate&&(this.deprTable.Columns[0].push("PostDate_Key"),this.deprTable.Columns[0].push("PostDate"));let f=this.deprTable.Tables[1].filter(y=>"AssetDeprPostDate"==y.Name);f.length>0&&"ScheduleDate"==h.J0.String(f[0].Value)?this.IsPostingOnScheduleDate=!0:this.SystemDate=h.J0.ParseDate(this.deprTable.Tables[2][0].SystemDate),this.DateColIDs.forEach(y=>{this.deprTable.Columns[0].push(y+"_Key")}),this.deprTable.Tables[0].forEach(y=>{y.select=!1,this.DateColIDs.forEach(w=>{g=w+"_Key",h.J0.IsEmpty(y[w])||(I=h.J0.ParseDate(y[w]),y[g]=I.ToString(M.d.SessionManager.Preferences["Date Format"])),this.AllowEditPostingDate&&(this.IsPostingOnScheduleDate?(y.PostDate_Key=y.ToDate,y.PostDate=h.J0.ParseDate(y.ToDate).ToString(M.d.SessionManager.Preferences["Date Format"])):(y.PostDate_Key=this.SystemDate,y.PostDate=this.SystemDate.ToString(M.d.SessionManager.Preferences["Date Format"])))})})}this.DepreciationGrid.SelectAll.IsChecked=!1,this.DepreciationGrid.Table=this.deprTable.Tables[0],this.DepreciationGrid.setRowid()}OnButtonClick(T){"PostDepreciation"==T?this.IsUnPostScreen?this.worker_DoWork():(new k.N).DepreciationScheduleViewModel_2(this.deprTable,this):"RefreshDepr"==T?this.DeprDataFilling():"Regenerate"==T?this.FilterVisibility=!0:"DeprExport"==T||("FilterOK"==T?(this.DeprDataFilling(),this.FilterVisibility=!1):"FilterCancel"==T&&(this.FilterVisibility=!1))}SelectUnselectAll(T){for(let g=0;g<this.DepreciationGrid.Table.length;g++)0==this.SelectUnCheck&&(this.DepreciationGrid.Table[g].Select=T);this.SelectUnCheck=0}OnCheckedChanged(T,g){g||1==this.DepreciationGrid.SelectAll.IsChecked&&(this.SelectUnCheck=1,this.DepreciationGrid.SelectAll.IsChecked=!1)}worker_RunWorkerCompleted(){if(this.Enable=!0,this.sbSchdulesDeleted.length>0){let T;this.sbSchdulesDeleted.toString().split(",").forEach(I=>{T=this.DepreciationGrid.Table.filter(f=>f.ScheduleID==I),T.length>0&&this.DepreciationGrid.removeRow(T[0])})}}worker_DoWork(){this.Enable=!1;let T=this.DepreciationGrid.Table;if(this.drrPost=[],T.length>0&&(this.drrPost=T.filter(f=>1==f.select),this.drrPost.SortBy([{name:"ToDate",desc:!0},"VoucherNo"])),0==this.drrPost.length)return void(this.DisplayMessage=M.d.GetResource("PleaseSelectDepreciation"));this.DisplayMessage="Posting 0 of "+this.drrPost.length,this.sbSchdulesDeleted="",this.JVCCID=0;let I,g=this.deprTable.Tables[1].filter(f=>"DepreciationJV"==f.Name);g.length>0&&parseInt(g[0].Value)>0&&(this.JVCCID=parseInt(g[0].Value)),this.iFailure=0,this.dicVouchers.Clear(),this.dicVouchersCnt.Clear();for(let f=0;f<this.drrPost.length;f++)I=this.drrPost[f].VoucherNo.toString(),this.dicVouchers.ContainsKey(I)?(this.dicVouchers[I]+=","+this.drrPost[f].ScheduleID.toString(),this.dicVouchersCnt[I]++):(this.dicVouchers.push(I,this.drrPost[f].ScheduleID.toString()),this.dicVouchersCnt.push(I,1));this.iStart=1,this.iLoop=0,this.PostDepr_CallBack()}PostDepr_CallBack(){if(this.iLoop>=this.dicVouchers.keys.length)return void this.worker_RunWorkerCompleted();let T=this.dicVouchers.keys[this.iLoop];this.DisplayMessage=1==this.dicVouchersCnt[T]?"Posting "+this.iStart+" of "+this.drrPost.length:"Posting ("+this.iStart+"-"+(this.iStart+this.dicVouchersCnt[T]-1)+") of "+this.drrPost.length,$.V.SetsPostDeprReverseJV(this.JVCCID,T,this.dicVouchers[T]).then(g=>{this.DisplayMessage=g.Message,h.J0.Int(g.RetValue)>0?(this.sbSchdulesDeleted.length>0&&(this.sbSchdulesDeleted+=","),this.sbSchdulesDeleted+=this.dicVouchers[T]):this.iFailure+=this.dicVouchersCnt[T],this.iStart+=this.dicVouchersCnt[T],this.iLoop++,this.PostDepr_CallBack()})}InitFilterScreen(){this.tree=new Array,this.CostCenterFilters=new Array,this.CostCenters=new N.y$(0),this.CostCenters.Label=M.d.GetResource("SelectCostCenter"),this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange"),M.d.common.GetDataTable("ASS002",M.d.SessionManager.LanguageID).forEach(g=>{let I=parseInt(g.FeatureID);this.CostCenters.Items.push(N._p.ComboBoxItems_2(g.Name.toString(),g.FeatureID.toString())),72==I&&(this.CostCenters.SelectedValue="72",this.CostCenters.SelectedItem=this.CostCenters.Items[this.CostCenters.Items.length-1])}),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),0,0,null)}OnCostCenterChange(T){if(!h.J0.IsEmpty(this.CostCenters.SelectedValue)&&(0==this.tree.length||this.tree[0].CostCenterID!=parseInt(this.CostCenters.SelectedValue))){let g=0;null!=this.CostCenters.SelectedItem&&!h.J0.IsEmpty(this.CostCenters.SelectedItem.Parent)&&(g=h.J0.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),g,0,null)}}LoadCostCenterTree(T,g,I,f){this.tree.Clear();let w,y="";if(50002==T&&"True"==M.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==M.d.SessionManager.Preferences["LW Reports"]&&(y=h.J0.IsEmpty(M.d.SessionManager.LocationWhere)?"NodeID IN (-1234)":"NodeID IN ("+M.d.SessionManager.LocationWhere+")"),null==f)for(let A=0;A<this.CostCenterFilters.length;A++){let Q=this.CostCenterFilters[A];if(Q.CostCenterID==T&&Q.LookupTypeID==g){f=Q.SelectedNodes;break}}44==T&&g>0&&(y="A.LookupType="+g),w=new P.T,null==f?w.TreeViewModel_5(T,this,I,y,null):w.TreeViewModel_6(T,this,I,y,f,null),w.LookupTypeID=g,w.HeaderVisiblity=!1,w.OnNodeSelected=new v.Yk,w.OnNodeSelected.Subscribe(this,"OnNodeSelected"),this.tree.push(w)}GetFilters(T){T.strTreeJoin="",T.strTreeWhere="";let g="",I="";this.CostCenterFilters.forEach(f=>{if(I="",72==f.CostCenterID){for(let y=0;y<f.SelectedNodes.length;y++)(null==f.SelectedNodes[y].Parent||!f.SelectedNodes[y].Parent.IsSelected)&&(I.length>0&&(I+=","),I+=f.SelectedNodes[y].Id);I.length>0&&(T.strTreeJoin+=" join Acc_Assets GTP with(nolock) on Acc.lft between GTP.lft AND GTP.rgt",g+=" and GTP.AssetID in ("+I.toString()+")")}else{for(let y=0;y<f.SelectedNodes.length;y++)f.SelectedNodes[y].IsGroup||(I.length>0&&(I+=","),I+=f.SelectedNodes[y].Id);I.length>0&&(g+=50002==f.CostCenterID?" and (Acc.LocationID in ("+I.ToString()+") OR CC.CCNID"+(f.CostCenterID-5e4)+" in ("+I.ToString()+"))":" and CC.CCNID"+(f.CostCenterID-5e4)+" in ("+I.toString()+")")}}),T.strTreeWhere=g.toString()}OnDateRangesSelectionChanged(T){null!=this.DateRanges.SelectedValue&&E.w.SetDateRanges(this.DateRanges.SelectedValue,this.FromDate,this.AsonDate)}}}}]);