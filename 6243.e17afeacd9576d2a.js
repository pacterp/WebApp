"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[6243],{36243:(I,D,r)=>{r.r(D),r.d(D,{RegularizationOfAttendanceViewModel:()=>m});var d=r(76199),g=r(35789),o=r(4884),p=r(6532),n=r(66148),a=r(9659),C=r(18649);class m extends d.g{constructor(){super(),this.ButtonClick=new g.Yk,this.SelectedEmpID=0,this.dtDay=new Date,this.dtpCheckInDate=new o.P6(0),this.dtpCheckInTime=new o.C_,this.dtpCheckOutDate=new o.P6(0),this.dtpCheckOutTime=new o.C_,this.txtRemarks=new p.Dw(0),this.DocID=0}RegularizationOfAttendanceViewModel(h){Logger.InfoLog("RegularizationOfAttendanceViewModel::Entering RegularizationOfAttendanceViewModel()"),this.DisplayMessage="",this.SelectedEmpID=parseInt(h[1]),this.dtDay=n.J0.ParseDate(h[2]),this.ButtonClick.Subscribe(this,"Button_Click"),this.dtpCheckInDate.CustomFormat=a.d.SessionManager.Preferences["Date Format"],this.dtpCheckOutDate.CustomFormat=a.d.SessionManager.Preferences["Date Format"],this.lblTotalTime="00.00",this.dtpCheckInTime.CustomFormat="HH:mm",this.dtpCheckInTime.ShowTimePicker=!0,this.dtpCheckOutTime.CustomFormat="HH:mm",this.dtpCheckOutTime.ShowTimePicker=!0,this.dtpCheckInDate.SelectedDateChanged.Subscribe(this,"onDateChanged"),this.dtpCheckInTime.SelectedDateChanged.Subscribe(this,"onDateChanged"),this.dtpCheckOutDate.SelectedDateChanged.Subscribe(this,"onDateChanged"),this.dtpCheckOutTime.SelectedDateChanged.Subscribe(this,"onDateChanged");let e=a.d.common.GetDataTable("RegAtt003",this.SelectedEmpID.toString()+"~"+this.dtDay.ToString("dd MMM yyyy"));null!=e&&e.length>0&&(this.DocID=parseInt(e[0].DocID),this.lblDocNo=e[0].VoucherNo.toString(),this.lblDocDate=n.J0.ParseDate(e[0].VoucherDate).ToString(a.d.SessionManager.Preferences["Date Format"]),this.lblEmpCode=e[0].EmpCode.toString(),this.lblEmpName=e[0].EmpName.toString(),this.dtpCheckInDate.Date=n.J0.IsEmpty(e[0].CheckInDate)?null:n.J0.ParseDate(e[0].CheckInDate),this.dtpCheckInTime.Date=n.J0.IsEmpty(e[0].CheckInTime)?null:n.J0.ParseDate(e[0].CheckInTime),this.dtpCheckOutDate.Date=n.J0.IsEmpty(e[0].CheckOutDate)?null:n.J0.ParseDate(e[0].CheckOutDate),this.dtpCheckOutTime.Date=n.J0.IsEmpty(e[0].CheckOutTime)?null:n.J0.ParseDate(e[0].CheckOutTime),this.dtpCheckInDate.Enable=!1,this.dtpCheckOutDate.Enable=!1,null==this.dtpCheckInDate.Date&&null==this.dtpCheckOutDate.Date?(this.dtpCheckInDate.Date=this.dtDay,this.dtpCheckOutDate.Date=this.dtDay):null!=this.dtpCheckInDate.Date&&null==this.dtpCheckOutDate.Date?this.dtpCheckOutDate.Date=this.dtpCheckInDate.Date:null==this.dtpCheckInDate.Date&&null!=this.dtpCheckOutDate.Date&&(this.dtpCheckInDate.Date=this.dtpCheckOutDate.Date),null!=this.dtpCheckInTime.Date&&null==this.dtpCheckOutTime.Date?this.dtpCheckInTime.Enable=!1:null==this.dtpCheckInTime.Date&&null!=this.dtpCheckOutTime.Date&&(this.dtpCheckOutTime.Enable=!1)),Logger.InfoLog("RegularizationOfAttendanceViewModel::Exiting RegularizationOfAttendanceViewModel()")}onDateChanged(h){if(null!=h){let e=null,i=null,l=null,t=null,s=new Date;e=n.J0.ParseDate(this.dtpCheckInDate.Date),s=n.J0.ParseDate(this.dtpCheckInTime.Date),i=new Date(e.getFullYear(),e.getMonth(),e.getDay(),s.getHours(),s.getMinutes(),s.getSeconds()),this.dtpCheckInTime.Date=i,l=n.J0.ParseDate(this.dtpCheckOutDate.Date),s=n.J0.ParseDate(this.dtpCheckOutTime.Date),t=new Date(l.getFullYear(),l.getMonth(),l.getDay(),s.getHours(),s.getMinutes(),s.getSeconds()),this.dtpCheckOutTime.Date=t,this.lblTotalTime=null!=e&&null!=i&&null!=l&&null!=t?this.CalculateTotalTime(e,i,l,t):"00.00"}}Button_Click(h){if(Logger.InfoLog("RegularizationOfAttendanceViewModel::Entering Button_Click"),"OK"==h.toString()){if(!this.ValidateScreen()||!confirm("Are you sure want to proceed.?"))return;let e=a.d.common.ExecuteQuery_ReturnString("RegAtt002",this.dtpCheckInDate.Date.ToString("dd/MMM/yyyy")+"~"+this.dtpCheckInTime.Date.ToString("dd/MMM/yyyy HH:mm")+"~"+this.dtpCheckOutDate.Date.ToString("dd/MMM/yyyy")+"~"+this.dtpCheckOutTime.Date.ToString("dd/MMM/yyyy HH:mm")+"~"+this.lblTotalTime+"~"+this.DocID+"~"+this.lblDocNo+"~"+this.txtRemarks.Text);if(e.Trim().length>0)return this.DisplayMessage="Error : "+e,void(this.MessageVisibility=!0);{let i=a.d.common.GetDataSet("RegAtt004",this.DocID.toString());if(null!=i&&i.Tables.length>1&&i.Tables[1].length>0){let l=parseInt(i.Tables[0][0].WorkflowID),t=0;if(i.Tables.length>1&&i.Tables[1].length>0&&(t=parseInt(i.Tables[1][0].WorkFlowID)),l>0?a.d.common.ExecuteQuery_ReturnString("RegAtt005",this.DocID.toString()):t>0&&a.d.common.ExecuteQuery_ReturnString("RegAtt007",this.DocID.toString()+"~"+t),l>0||t>0){let s=[];s.push(371),s.push(40089),s.push(this.DocID.toString()),s.push("GUID"),s.push(a.d.SessionManager.UserName),s.push(a.d.SessionManager.UserID),s.push(a.d.SessionManager.LanguageID);try{a.d.empService.SetNotifEvent(s)}catch{}}}}this.DialogResult=!0}else"Cancel"==h.toString()&&(this.DialogResult=!1);a.d.page.HideDialog(this.PopUpGUID),Logger.InfoLog("RegularizationOfAttendanceViewModel::Exiting Button_Click")}CalculateTotalTime(h,e,i,l){if(e=new Date(h.getFullYear(),h.getMonth(),h.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()),(l=new Date(i.getFullYear(),i.getMonth(),i.getDate(),l.getHours(),l.getMinutes(),l.getSeconds()))<e)return"00.00";let t=l.Subtract(e);return t.Hours<0&&(t=t.add(C.Q.FromDays(1))),(24*t.Days+t.Hours).PrefixZero(2)+"."+t.Minutes.PrefixZero(2)}SaveStatus(h,e,i,l=!0){let t=null,s="";t=this.SetDocStatus(h,e,i,(new Date).Date(),this.txtRemarks.Text,!0,""),null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&t.Columns[0].Contains("status")&&(s+="Document Status - ["+t.Tables[0][0].status.toString()+"] \r\n"),null!=t&&t.Tables.length>0&&t.Tables[t.Tables.length-1].length>0&&t.Columns[t.Columns.length-1].Contains("ErrorMessage")&&(s+=t.Tables[t.Tables.length-1][0].ErrorMessage.toString()),this.DisplayMessage=s,this.MessageVisibility=!0}SetDocStatus(h,e,i,l,t,s,c){Logger.InfoLog("VoucherGenerator:: Inside SetDocStatus");let u=[];u.push(h),u.push(t??""),u.push(l.ToString("dd/MMM/yyyy")),u.push(!0),u.push(this.DocID),u.push(40089),u.push(e),u.push(i),u.push(s),u.push(a.d.SessionManager.GetSysInfo()),u.push(a.d.SessionManager.GetAccessPoint()),u.push(c),u.push(a.d.SessionManager.CompanyGUID),u.push(a.d.SessionManager.UserName),u.push(a.d.SessionManager.UserID),u.push(a.d.SessionManager.RoleID),u.push(a.d.SessionManager.LanguageID);let k=a.d.document.SetDocStatus(u);return Logger.InfoLog("VoucherGenerator:: Exiting SetDocStatus"),k}ValidateScreen(){if(null==this.dtpCheckInDate.Date||n.J0.IsEmpty(this.dtpCheckInDate.Date))return this.DisplayMessage="Select Check-in Date",this.dtpCheckInDate.SetFocus=!0,this.MessageVisibility=!0,!1;if(null==this.dtpCheckInTime.Date||n.J0.IsEmpty(this.dtpCheckInTime.Date))return this.DisplayMessage="Select Check-in Time",this.dtpCheckInTime.SetFocus=!0,this.MessageVisibility=!0,!1;if(null==this.dtpCheckOutDate.Date||n.J0.IsEmpty(this.dtpCheckOutDate.Date))return this.DisplayMessage="Select Check-out Date",this.dtpCheckOutDate.SetFocus=!0,this.MessageVisibility=!0,!1;if(null==this.dtpCheckOutTime.Date||n.J0.IsEmpty(this.dtpCheckOutTime.Date))return this.DisplayMessage="Select Check-out Time",this.dtpCheckOutTime.SetFocus=!0,this.MessageVisibility=!0,!1;if(parseFloat(this.lblTotalTime)>24)return this.DisplayMessage="Total time can not exceed 24 Hours",this.dtpCheckOutTime.SetFocus=!0,this.MessageVisibility=!0,!1;let h=a.d.common.GetDataTable("RegAtt006","");if(null!=h&&h.length>0&&"True"==n.J0.String(h[0].PrefValue)&&this.txtRemarks.Text.length<=0)return this.DisplayMessage="Remarks Mandatory",this.txtRemarks.SetFocus=!0,this.MessageVisibility=!0,!1;let e=a.d.common.GetDataTable("RegAtt001",this.SelectedEmpID.toString()+"~"+this.dtpCheckInDate.Date.ToString("dd/MMM/yyyy")+"~"+this.DocID);return!(null!=e&&e.length>0&&(this.DisplayMessage="Data already existed on the Selected Date for the Employee @ Voucher No. : "+e[0].VoucherNo,this.dtpCheckInDate.SetFocus=!0,this.MessageVisibility=!0,1))}}}}]);