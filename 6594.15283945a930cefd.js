"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[6594],{96594:(U,F,C)=>{C.r(F),C.d(F,{UpdatePayTermsViewModel:()=>O});var u=C(32040),e=C(43767),G=C(54581),V=C(98580),E=C(23458),f=C(27730),I=C(82503),M=C(84151),A=C(7321),J=C(41361),g=C(21774),N=C(67557),_=C(61301),v=C(58170);class O extends V.g{get MxHeight(){return(window.innerHeight-150).toString()}get SelectAll(){return this._SelectAll}set SelectAll(i){i!=this._SelectAll&&(this._SelectAll=i,this.SelectAllRows())}get angularGrid(){return this.PstDocGrid.angularGrid}get PstDocGridTable(){return this.PstDocGrid.Table}get PstDocGridTableColumns(){return this.PstDocGrid.TableColumns}get angularGrid1(){return this.PartGrid.angularGrid}get PartGridTable(){return this.PartGrid.Table}get PartGridTableableColumns(){return this.PartGrid.TableColumns}UpdatePayTermsViewModel_1(i,t,h,n=0){this.DisplayName=2==n?"Contract History":1==n?"Copy":3==n?"Renew Sub Contracts":4==n?"Terminate Sub Contracts":5==n?"Refund Sub Contracts":6==n?"Close Sub Contracts":7==n?"Unit wise rate":50==n?"Penalty":null!=t?"Distribute":"Generate Contract",this.Calltype=n,this.oparent=i,this.selectedrow=t,this.Rows=h,this.CopyRows.Visible=!1,50==n?(this.Filter.Visible=!1,this.PstDocGrid=new A.vv,this.PartGrid=new A.vv,this.EndDate=new I.C_(0),this.Tower=new E.y$(0),this.CompletionDate=new I.C_(0),this.EndDate.Visible=!1,this.PartGrid.Visible=!1,this.PstDocGrid.Visible=!0,this.Tower.Visible=!1,this.CompletionDate.Visible=!1,this.CopyRows.Label="Copy",this.CopyRows.Visible=!1,this.CopyRows.DataType="INT",this.CopyRows.Visible=!1,this.IsGenerateVisible=!1):2==n||3==n||4==n||5==n||6==n?(this.Filter.Visible=!1,this.PstDocGrid=new A.vv,this.PartGrid=new A.vv,this.EndDate=new I.C_(0),this.Tower=new E.y$(0),this.CompletionDate=new I.C_(0),this.EndDate.Visible=!1,this.PartGrid.Visible=!1,this.PstDocGrid.Visible=!0,this.Tower.Visible=!1,this.CompletionDate.Visible=!1,this.CopyRows.Label="Copy",this.CopyRows.Visible=!1,this.CopyRows.DataType="INT",this.IsGenerateVisible=!1,2==n&&(this.IsSaveVisible=!1)):1==n?(this.Filter.Visible=!1,this.PstDocGrid=new A.vv,this.PartGrid=new A.vv,this.EndDate=new I.C_(0),this.Tower=new E.y$(0),this.CompletionDate=new I.C_(0),this.EndDate.Visible=!1,this.PstDocGrid.Visible=!1,this.PartGrid.Visible=!1,this.Tower.Visible=!1,this.CompletionDate.Visible=!1,this.CopyRows.Label="Copy",this.CopyRows.Visible=!0,this.CopyRows.DataType="INT"):null==this.selectedrow?(this.Filter.Visible=!0,this.Filter.Label="Contract for Year",this.Filter.Items.push(f._p.ComboBoxItems_2("ALL","ALL")),this.Rows.forEach(a=>{this.Filter.Items.push(a)}),this.Filter.Width="320",this.Filter.Items.length>0&&(this.Filter.SelectedValue=this.Filter.Items[0].Value,this.Filter.SelectedItem=this.Filter.Items[0])):this.oparent.multiVisi&&7!=this.Calltype?(this.Filter.Visible=!0,this.Filter.Width="120",this.Filter.Label="Show",this.Filter.Items.push(f._p.ComboBoxItems_2("Both","0")),this.Filter.Items.push(f._p.ComboBoxItems_2("Show only unit","1")),this.Filter.Items.push(f._p.ComboBoxItems_2("Show only Dates","2")),this.Filter.SelectionChangedCommand.Subscribe(this,"ButtonSave"),this.Filter.SelectedValue="0"):this.Filter.Visible=!1,1!=n&&2!=n&&3!=n&&4!=n&&5!=n&&6!=n&&50!=n&&this.AddDateColumns(),this.IsCancelVisible=!0,this.PstDocGridTable.length>0&&(this.PstDocGrid.Height=252,this.PstDocGrid.Width="800"),this.PartGridTable.length>0&&(this.PartGrid.Height=252),this.PstDocGrid.OnPreviewKeyDown.Subscribe(this,"OnKeyDown")}UpdatePayTermsViewModel_2(i){this.Filter.Visible=!1,this.PstDocGrid=new A.vv,this.PartGrid=new A.vv,this.EndDate=new I.C_(0),this.Tower=new E.y$(0),this.CompletionDate=new I.C_(0),this.EndDate.Visible=!1,this.PartGrid.Visible=!1,this.PstDocGrid.Visible=!0,this.Tower.Visible=!1,this.CompletionDate.Visible=!1,this.CopyRows.Visible=!1,this.CopyRows.DataType="INT",this.IsGenerateVisible=!1,this.IsCancelVisible=!0,this.PstDocGrid.SearchVisible=!0,this.PstDocGrid.AddSearchCols(),this.Calltype=2,this.PstDocGrid.OnPreviewKeyDown.Subscribe(this,"OnKeyDown")}constructor(i){if(super(),this.SavePostedDocument=new v.Yk,this.DailogResult=!0,this._SelectAll=!1,this.Filter=new f.y$,this.CopyRows=new M.Dw,this.IsCancelVisible=!1,this.IsSaveVisible=!0,this.Rows=[],this.Calltype=0,this.DocCCID=0,this.CCID=0,this.CompletionDateColName="",this.Columns="",this.Joins="","AddEditRenContractViewModel"==i)return this.IsCancelVisible=!1,void(this.Filter.Visible=!1);this.IsCancelVisible=!1,this.Filter.Visible=!1,this.DisplayName=i,this.PstDocGrid=new A.vv,this.PartGrid=new A.vv,this.onLoad(),this.FillSearchDetails()}OnKeyDown(i,t){!t.ctrlKey&&116==t.which&&(t.preventDefault(),this.onCopy(this.PstDocGrid.getArgsObj(i)))}onCopy(i){let t=i.column.className;"DataGridPactListBoxColumn"!=t&&i.grid.getEditorLock().commitCurrentEdit();let h="";h=i.column.field;let n=confirm(u.d.GetResource("overrideallNotocopyblank"));if(!n)return;let a=this.PstDocGrid.Table,s=i.item;for(let l=0;l<a.length;l++){"DataGridPactListBoxColumn"==t&&i.grid.getEditorLock().commitCurrentEdit();let r=!1;for(let c=0;c<this.PstDocGrid.Columns.length;c++)if(this.PstDocGrid.Columns[c].IsVisible&&"sno"!=this.PstDocGrid.Columns[c].DisplayMember.toLowerCase()&&(("INT"==this.PstDocGrid.Columns[c].DataType||"FLOAT"==this.PstDocGrid.Columns[c].DataType)&&""!=e.J0.String(a[l][this.PstDocGrid.Columns[c].DisplayMember])&&0!=parseFloat(a[l][this.PstDocGrid.Columns[c].DisplayMember].toString())||"LISTBOX"==this.PstDocGrid.Columns[c].DataType&&""!=e.J0.String(a[l][this.PstDocGrid.Columns[c].ValueMember])&&parseInt(a[l][this.PstDocGrid.Columns[c].ValueMember].toString())>0||("SELECTIONBOX"==this.PstDocGrid.Columns[c].DataType||"String"==this.PstDocGrid.Columns[c].DataType||"TextBlock"==this.PstDocGrid.Columns[c].DataType||"TEXT"==this.PstDocGrid.Columns[c].DataType)&&""!=e.J0.String(a[l][this.PstDocGrid.Columns[c].DisplayMember])||("DATE"==this.PstDocGrid.Columns[c].DataType||"DATESORT"==this.PstDocGrid.Columns[c].DataType||"DATETIME"==this.PstDocGrid.Columns[c].DataType)&&""!=e.J0.String(a[l][this.PstDocGrid.Columns[c].DisplayMember+"_Key"]))){r=!0;break}if(r){if(!(n||""==e.J0.String(a[l][h])||this.PstDocGrid.TableColumns[h].DataType&&""!=e.J0.String(a[l][h])&&0==parseFloat(a[l][h].toString())))continue;if(a[l][h]=s[h].toString(),"DataGridDateTimeColumn"!=t&&"DataGridDateColumn"!=t||!this.PstDocGrid.TableColumns.Contains(h+"_Key")||""==e.J0.String(s[h+"_Key"])){if("DataGridPactListBoxColumn"==t){var o=this.PstDocGrid.Columns.find(c=>c.DisplayMember==h);null!=o&&""!=e.J0.String(s[o.ValueMember])&&(a[l][o.ValueMember]=s[o.ValueMember].toString())}}else a[l][h+"_Key"]=s[h+"_Key"].toString();if("quantity"==h.toLowerCase()){let c=1;""!=e.J0.String(a[l].UOMConversion)&&a[l].UOMConversion.toString()&&(c=parseFloat(a[l].UOMConversion.toString())),""!=e.J0.String(a[l].Quantity)&&(a[l].UOMConvertedQty=c*parseFloat(a[l].Quantity.toString()))}this.PstDocGrid.updateRow(a[l])}}}onLoad(){this.InitColumns(),this.SavePostedDocument.Subscribe(this,"ButtonSave")}AddDateColumns(){if(this.Tower=new E.y$(0),this.CompletionDate=new I.C_(0),this.CompletionDate.Label="Start date",this.CompletionDate.Enable=!1,this.oparent.StartDate.Date&&(this.CompletionDate.Date=this.oparent.StartDate.Date),this.EndDate=new I.C_(0),this.oparent.EndDate.Date&&(this.EndDate.Date=this.oparent.EndDate.Date),this.EndDate.Label="End Date",this.EndDate.Enable=!1,this.Tower.Visible=!1,7==this.Calltype&&(this.CompletionDate.Visible=this.EndDate.Visible=!1),this.PartGrid=new A.vv,this.PartGrid.Visible=!0,this.PstDocGrid=new A.vv,this.PstDocGrid.CanUserSortColumns=!1,this.PstDocGrid.CanUserDeleteRows=!0,this.PstDocGrid.RowHeight=25,this.PstDocGrid.Columns=[],this.PstDocGrid.Width="",this.PstDocGrid.CanUserAddRows=!0,this.PstDocGrid.BeginEdit.Subscribe(this,"OnBeginEdit"),this.PstDocGrid.CellEditEnding.Subscribe(this,"OnGridCellEditEnding"),this.PstDocGrid.OnRowSelection.Subscribe(this,"OnRowSelection"),this.PstDocGrid.BeginEdit.Subscribe(this,"BeginningEditEvent"),this.PstDocGridTableColumns.push("Sno"),this.PstDocGridTableColumns.push("FromDate"),this.PstDocGridTableColumns.push("FromDate_Key"),this.PstDocGrid.DataTypes.Date.push("FromDate_Key"),this.PstDocGridTableColumns.push("ToDate"),this.PstDocGridTableColumns.push("ToDate_Key"),this.PstDocGrid.DataTypes.Date.push("ToDate_Key"),this.PstDocGridTableColumns.push("Amount"),this.PstDocGrid.DataTypes.Double.push("Amount"),this.PstDocGridTableColumns.push("Unit"),this.PstDocGridTableColumns.push("Unit_key"),this.PstDocGrid.DataTypes.Int.push("Unit_key"),this.PstDocGridTableColumns.push("Period"),this.PstDocGridTableColumns.push("Rate"),this.PstDocGrid.DataTypes.Double.push("Rate"),this.PstDocGridTableColumns.push("Discount"),this.PstDocGrid.DataTypes.Double.push("Discount"),this.PstDocGridTableColumns.push("ActAmount"),this.PstDocGrid.DataTypes.Double.push("ActAmount"),this.PstDocGridTableColumns.push("Narration"),this.PstDocGridTableColumns.push("Percent"),this.PstDocGrid.DataTypes.Double.push("Percent"),7==this.Calltype)104==this.oparent.CostCenterID?(this.PstDocGridTableColumns.push("VatType"),this.PstDocGrid.DataTypes.Int.push("VatType"),this.PstDocGridTableColumns.push("VatPer"),this.PstDocGrid.DataTypes.Double.push("VatPer"),this.PstDocGridTableColumns.push("VatAmount"),this.PstDocGrid.DataTypes.Double.push("VatAmount"),this.PstDocGridTableColumns.push("Net"),this.PstDocGrid.DataTypes.Double.push("Net")):(this.PstDocGridTableColumns.push("PrevRent"),this.PstDocGrid.DataTypes.Double.push("PrevRent"),this.PstDocGridTableColumns.push("BaseRent"),this.PstDocGrid.DataTypes.Double.push("BaseRent"));else{this.oparent.DistribtueInvoice&&null!=this.selectedrow&&this.oparent.DataTable.length>0&&this.selectedrow==this.oparent.DataTable[0]&&(this.PstDocGridTableColumns.push("Distribute"),this.PstDocGrid.DataTypes.Int.push("Distribute")),this.oparent.ShowMonthAmountInDistribute&&null!=this.selectedrow&&this.oparent.DataTable.length>0&&this.selectedrow==this.oparent.DataTable[0]&&(this.PstDocGridTableColumns.push("MonthAmount"),this.PstDocGrid.DataTypes.Double.push("MonthAmount"));var i=this.oparent.ScreenObject.Data.Tables[5].filter(s=>"DistProposedrent"==s.Name);i.length>0&&(0,G.yG0)(i[0].Value)&&(this.oparent.multiVisi&&(this.PstDocGridTableColumns.push("PrevRent"),this.PstDocGrid.DataTypes.Double.push("PrevRent"),this.PstDocGridTableColumns.push("BaseRent"),this.PstDocGrid.DataTypes.Double.push("BaseRent")),this.PstDocGridTableColumns.push("ProposedRent"),this.PstDocGrid.DataTypes.Double.push("ProposedRent"),this.PstDocGridTableColumns.push("ProposedDisc"),this.PstDocGrid.DataTypes.Double.push("ProposedDisc"),this.PstDocGridTableColumns.push("ProposedAmount"),this.PstDocGrid.DataTypes.Double.push("ProposedAmount"))}let t,n;if(null!=this.selectedrow?(t=new g.O7,t.Header=u.d.GetResource("DocumentDesigner_Sno"),t.DisplayMember="Sno",t.ReadOnly=!0,t.Width=50,this.PstDocGrid.Columns.push(t)):(this.CompletionDate.Visible=!1,this.EndDate.Visible=!1,this.PstDocGrid.Visible=!1,this.PstDocGrid.Visible=!1,this.IsGenerateVisible=!0),7!=this.Calltype&&(t=new g.O7,t.Header="From Date",t.DisplayMember="FromDate",t.Width=140,t.DataType="DATE",this.PstDocGrid.Columns.push(t),t=new g.O7,t.Header="To Date",t.DisplayMember="ToDate",t.Width=140,t.DataType="DATE",this.PstDocGrid.Columns.push(t)),null!=this.selectedrow){t=new g.O7,t.Header="Unit",t.DisplayMember="Unit",t.ValueMember="Unit_key",t.Width=120,t.DataType="LISTBOX",7==this.Calltype&&104==this.oparent.CostCenterID?(t.CostCenterID=93,t.TypeID=2):(t.CostCenterID=this.oparent.Unit.CCID,t.TypeID=this.oparent.Unit.TypeID),this.oparent.multiVisi||7==this.Calltype?(t.IsVisible=!0,t.FilterCondition=7==this.Calltype&&104==this.oparent.CostCenterID?" a.PropertyID in("+this.oparent.Property.SelectedValue+")":" a.unitid in("+this.oparent.SelectedUnits+")"):t.IsVisible=!1,this.PstDocGrid.Columns.push(t);let s=this.oparent.ContractParticular.find(o=>"Discount"==o.DisplayMember);if(7==this.Calltype&&104==this.oparent.CostCenterID){t=new g.O7,t.Header="Vat",t.ValueBinding="VatType",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100;let o=[];o.push(f._p.ComboBoxItems_2("Yes","1")),o.push(f._p.ComboBoxItems_2("No","0")),t.ComboData=o,this.PstDocGrid.Columns.push(t)}else{if(this.PstDocGridTableColumns.Contains("MonthAmount")&&(t=new g.O7,t.Header="Month Wise",t.DisplayMember="MonthAmount",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t)),this.PstDocGridTableColumns.Contains("BaseRent")){let o=this.oparent.ScreenObject.Data.Tables[0].filter(l=>null!=l.LocalReference&&79==l.LocalReference&&-11==l.LinkData);o.length>0&&(t=new g.O7,t.Header=o[0].ResourceData.toString(),t.DisplayMember="PrevRent",t.Width=100,t.DataType="FLOAT",e.J0.IsEmpty(o[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(o[0].IsEditable)),t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t)),o=this.oparent.ScreenObject.Data.Tables[0].filter(l=>null!=l.LocalReference&&93==l.LocalReference&&25641==l.LinkData),o.length>0&&(t=new g.O7,t.Header=o[0].ResourceData.toString(),t.DisplayMember="BaseRent",t.Width=100,t.DataType="FLOAT",e.J0.IsEmpty(o[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(o[0].IsEditable)),t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t))}this.PstDocGridTableColumns.Contains("ProposedRent")&&(t=new g.O7,t.Header="Proposed Rent",(h=this.oparent.ScreenObject.Data.Tables[0].filter(o=>"ProposedRent"==o.SysColumnName)).length>0&&(e.J0.IsEmpty(h[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(h[0].IsEditable)),t.Header=h[0].ResourceData.toString()),t.DisplayMember="ProposedRent",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),t=new g.O7,t.Header="Discount",(h=this.oparent.ScreenObject.Data.Tables[0].filter(o=>"ProposedDisc"==o.SysColumnName)).length>0&&(e.J0.IsEmpty(h[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(h[0].IsEditable)),t.Header=h[0].ResourceData.toString()),t.DisplayMember="ProposedDisc",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),t=new g.O7,t.Header="After discount",(h=this.oparent.ScreenObject.Data.Tables[0].filter(o=>"ProposedAfterDisc"==o.SysColumnName)).length>0&&(e.J0.IsEmpty(h[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(h[0].IsEditable)),t.Header=h[0].ResourceData.toString()),t.DisplayMember="ProposedAmount",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t)),null!=s&&s.IsVisible&&(t=new g.O7,7==this.Calltype?(t.Header="Proposed Rent",(h=this.oparent.ScreenObject.Data.Tables[0].filter(l=>"ProposedRent"==l.SysColumnName)).length>0&&(e.J0.IsEmpty(h[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(h[0].IsEditable)),t.Header=h[0].ResourceData.toString())):t.Header="Amount",t.DisplayMember="ActAmount",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),t=new g.O7,7==this.Calltype?(t.Header="Discount",(h=this.oparent.ScreenObject.Data.Tables[0].filter(l=>"ProposedDisc"==l.SysColumnName)).length>0&&(e.J0.IsEmpty(h[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(h[0].IsEditable)),t.Header=h[0].ResourceData.toString())):t.Header="Discount",t.DisplayMember="Discount",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t))}var h;if(t=new g.O7,7==this.Calltype?(t.Header="After discount",(h=this.oparent.ScreenObject.Data.Tables[0].filter(l=>"ProposedAfterDisc"==l.SysColumnName)).length>0&&(e.J0.IsEmpty(h[0].IsEditable)||(t.ReadOnly=!(0,G.yG0)(h[0].IsEditable)),t.Header=h[0].ResourceData.toString())):t.Header=null!=s&&s.IsVisible?"After discount":"Amount",t.DisplayMember="Amount",t.Width=120,t.ShowTotal=!0,t.DataType="FLOAT",t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),this.PstDocGrid.ShowTotals=!0,7!=this.Calltype){t=new g.O7,t.Header="%",t.DisplayMember="Percent",t.Width=100,t.DataType="FLOAT",t.DecimalPoints="0",this.PstDocGrid.Columns.push(t),this.PstDocGridTableColumns.Contains("Distribute")&&(t=new g.O7,t.Header="Distribute",t.DisplayMember="Distribute",t.Width=100,t.DataType="FLOAT",t.DecimalPoints="0",this.PstDocGrid.Columns.push(t)),t=new g.O7,t.Header="Rate",t.DisplayMember="Rate",t.Width=80,t.DataType="FLOAT",t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount.toString();let o=this.oparent.ScreenObject.Data.Tables[5].filter(l=>"ShowRateInDistribute"==l.Name);t.IsVisible=!!(o.length>0&&(0,G.yG0)(o[0].Value)),this.PstDocGrid.Columns.push(t)}}if(7==this.Calltype&&104==this.oparent.CostCenterID)t=new g.O7,t.Header="Vat Percent",t.DisplayMember="VatPer",t.Width=100,t.DataType="FLOAT",t.DecimalPoints="0",this.PstDocGrid.Columns.push(t),t=new g.O7,t.Header="Vat Amount",t.DisplayMember="VatAmount",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t),t=new g.O7,t.Header="Net",t.DisplayMember="Net",t.Width=100,t.DataType="FLOAT",t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PstDocGrid.Columns.push(t);else if(7!=this.Calltype){t=new g.O7,t.Header="Period",t.ValueBinding="Period",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=100;let s=N.a.GetLookupData(31);if(null!=s){let o=[];for(let l=0;l<s.length;l++)o.push(f._p.ComboBoxItems_2(s[l].Name.toString(),s[l].NodeID.toString()));t.ComboData=o}this.PstDocGrid.Columns.push(t)}if(this.oparent.multiVisi){let s=this.oparent.ScreenObject.Data.Tables[0].filter(o=>null!=o.LocalReference&&93==o.LocalReference&&25641!=o.LinkData);if(s.length>0){s.SortBy(["SectionID","SectionSeqNumber"]);for(let o=1;o<=s.length&&!(o>10);o++)t=new g.O7,t.Header=s[o-1].ResourceData.toString(),t.DisplayMember="Fld"+o.toString(),t.ID=s[o-1].LinkData.toString(),t.Width=100,e.J0.IsEmpty(s[o-1].IsEditable)||(t.ReadOnly=!(0,G.yG0)(s[o-1].IsEditable)),this.PstDocGrid.Columns.push(t),this.PstDocGridTableColumns.push(t.DisplayMember)}}if(t=new g.O7,t.Header="Narration",t.DisplayMember="Narration",t.DataType="TextBlock",t.Width=150,this.PstDocGrid.Columns.push(t),null==this.selectedrow)this.Rows.forEach(s=>{let o=this.PstDocGrid.NewRow();!e.J0.IsEmpty(s.Value)&&e.J0.isValidDate(s.Value)&&(n=e.J0.isValidDate(s.Value),o.FromDate=e.J0.ParseDate(s.Value).ToString(u.d.SessionManager.Preferences["Date Format"]),o.FromDate_Key=e.J0.ParseDate(s.Value)),!e.J0.IsEmpty(s.Parent)&&e.J0.isValidDate(s.Parent)&&(n=e.J0.isValidDate(s.Parent),o.ToDate=e.J0.ParseDate(s.Parent).ToString(u.d.SessionManager.Preferences["Date Format"]),o.ToDate_Key=e.J0.ParseDate(s.Parent)),s.CurrID>0&&(o.Period=s.CurrID),this.PstDocGrid.addRow(o)});else if(7!=this.Calltype&&""!=e.J0.String(this.selectedrow.Xml)||7==this.Calltype&&""!=e.J0.String(this.selectedrow.UnitXml)){let s=new e.VB;if(s.LoadXml(7==this.Calltype?this.selectedrow.UnitXml.toString():this.selectedrow.Xml.toString()),null!=s){s.DocumentElement.children.length>0&&null!=s.DocumentElement.attributes&&null!=s.DocumentElement.attributes.Filter&&!e.J0.IsEmpty(s.DocumentElement.attributes.Filter.value)&&(this.Filter.SelectedValue=s.DocumentElement.attributes.Filter.value,this.ButtonSave("Selectionchanged")),this.PstDocGrid.Clear();let o=s.SelectNodes("XML/Row");"0"==this.Filter.SelectedValue&&(o=s.SelectNodes("XML/UnitsRow/Row")),7==this.Calltype&&(o=s.SelectNodes("UnitsXML/Row"));for(let l=0;l<o.length;l++){let r=o[l],c=this.PstDocGrid.NewRow();if(null!=r.attributes.FromDate&&!e.J0.IsEmpty(r.attributes.FromDate.value)&&e.J0.isValidDate(r.attributes.FromDate.value)&&(n=e.J0.isValidDate(r.attributes.FromDate.value),c.FromDate=e.J0.ParseDate(r.attributes.FromDate.value).ToString(u.d.SessionManager.Preferences["Date Format"]),c.FromDate_Key=e.J0.ParseDate(r.attributes.FromDate.value)),null!=r.attributes.ToDate&&!e.J0.IsEmpty(r.attributes.ToDate.value)&&e.J0.isValidDate(r.attributes.ToDate.value)&&(n=e.J0.isValidDate(r.attributes.ToDate.value),c.ToDate=e.J0.ParseDate(r.attributes.ToDate.value).ToString(u.d.SessionManager.Preferences["Date Format"]),c.ToDate_Key=e.J0.ParseDate(r.attributes.ToDate.value)),null!=r.attributes.Unit&&!e.J0.IsEmpty(r.attributes.Unit.value)&&(c.Unit_key=parseInt(r.attributes.Unit.value)),null!=r.attributes.Period&&!e.J0.IsEmpty(r.attributes.Period.value)&&(c.Period=parseInt(r.attributes.Period.value)),null!=r.attributes.Amount&&!e.J0.IsEmpty(r.attributes.Amount.value)&&(c.Amount=parseFloat(r.attributes.Amount.value)),null!=r.attributes.MonthAmount&&!e.J0.IsEmpty(r.attributes.MonthAmount.value)&&(c.MonthAmount=parseFloat(r.attributes.MonthAmount.value)),null!=r.attributes.Rate&&!e.J0.IsEmpty(r.attributes.Rate.value)&&(c.Rate=parseFloat(r.attributes.Rate.value)),this.PstDocGridTableColumns.Contains("Distribute")&&null!=r.attributes.Distribute&&!e.J0.IsEmpty(r.attributes.Distribute.value)&&(c.Distribute=parseFloat(r.attributes.Distribute.value)),this.PstDocGridTableColumns.Contains("ActAmount")&&null!=r.attributes.ActAmount&&!e.J0.IsEmpty(r.attributes.ActAmount.value)&&(c.ActAmount=parseFloat(r.attributes.ActAmount.value)),this.PstDocGridTableColumns.Contains("Percent")&&null!=r.attributes.Percent&&!e.J0.IsEmpty(r.attributes.Percent.value)&&(c.Percent=parseFloat(r.attributes.Percent.value)),this.PstDocGridTableColumns.Contains("Discount")&&null!=r.attributes.Discount&&!e.J0.IsEmpty(r.attributes.Discount.value)&&(c.Discount=parseFloat(r.attributes.Discount.value)),null!=r.attributes.Narration&&!e.J0.IsEmpty(r.attributes.Narration.value)&&(c.Narration=r.attributes.Narration.value),this.PstDocGridTableColumns.Contains("VatType")&&null!=r.attributes.VatType&&!e.J0.IsEmpty(r.attributes.VatType.value)&&(c.VatType=r.attributes.VatType.value),this.PstDocGridTableColumns.Contains("VatPer")&&null!=r.attributes.VatPer&&!e.J0.IsEmpty(r.attributes.VatPer.value)&&(c.VatPer=parseFloat(r.attributes.VatPer.value)),this.PstDocGridTableColumns.Contains("VatAmount")&&null!=r.attributes.VatAmount&&!e.J0.IsEmpty(r.attributes.VatAmount.value)&&(c.VatAmount=parseFloat(r.attributes.VatAmount.value)),this.PstDocGridTableColumns.Contains("Net")&&null!=r.attributes.Net&&!e.J0.IsEmpty(r.attributes.Net.value)&&(c.Net=parseFloat(r.attributes.Net.value)),this.PstDocGridTableColumns.Contains("ProposedRent")&&null!=r.attributes.ProposedRent&&!e.J0.IsEmpty(r.attributes.ProposedRent.value)&&(c.ProposedRent=parseFloat(r.attributes.ProposedRent.value)),this.PstDocGridTableColumns.Contains("ProposedDisc")&&null!=r.attributes.ProposedDisc&&!e.J0.IsEmpty(r.attributes.ProposedDisc.value)&&(c.ProposedDisc=parseFloat(r.attributes.ProposedDisc.value)),this.PstDocGridTableColumns.Contains("ProposedAmount")&&null!=r.attributes.ProposedAmount&&!e.J0.IsEmpty(r.attributes.ProposedAmount.value)&&(c.ProposedAmount=parseFloat(r.attributes.ProposedAmount.value)),7==this.Calltype&&95==this.oparent.CostCenterID&&!e.J0.IsEmpty(c.Unit_key)){let d=null;this.oparent.StartDate.Date&&null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>7&&(d=this.oparent.dsPart.Tables[7].filter(D=>D.UNITID==c.Unit_key.toString()&&D.WEF<=this.oparent.StartDate.Date)),null!=d&&d.length>0?(d.SortBy(["WEF"]),e.J0.IsEmpty(d[0].RENT)||(c.BaseRent=d[0].RENT.toString())):null!=r.attributes.BaseRent&&!e.J0.IsEmpty(r.attributes.BaseRent.value)&&(c.BaseRent=parseFloat(r.attributes.BaseRent.value))}this.PstDocGridTableColumns.Contains("PrevRent")&&null!=r.attributes.PrevRent&&!e.J0.IsEmpty(r.attributes.PrevRent.value)&&(c.PrevRent=parseFloat(r.attributes.PrevRent.value));for(let d=0;d<this.PstDocGrid.Columns.length;d++)this.PstDocGrid.Columns[d].DisplayMember.Contains("Fld")&&null!=r.attributes[this.PstDocGrid.Columns[d].DisplayMember]&&!e.J0.IsEmpty(r.attributes[this.PstDocGrid.Columns[d].DisplayMember].value)&&(c[this.PstDocGrid.Columns[d].DisplayMember]=r.attributes[this.PstDocGrid.Columns[d].DisplayMember].value);c.Sno=this.PstDocGridTable.length+1,this.PstDocGrid.addRow(c)}}(7==this.Calltype||!(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0)&&this.PstDocGrid.Columns[3].IsVisible)&&(this.PstDocGrid.RefreshGrid=!0)}else if(104==this.oparent.CostCenterID&&7==this.Calltype){let s=u.d.rental.GetUnitsByProp(this.oparent.Property.SelectedValue);if(null!=s&&s.Tables.length>0&&s.Columns[0].Contains("UnitID")&&s.Tables[0].length>0)for(let o=0;o<s.Tables[0].length;o++){let l=this.PstDocGrid.NewRow();if(l.FromDate=this.oparent.StartDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),l.FromDate_Key=this.oparent.StartDate.Date,l.ToDate=this.oparent.StartDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),l.ToDate_Key=this.oparent.StartDate.Date,l.Unit=s.Tables[0][o].Name.toString(),l.Unit_key=s.Tables[0][o].UnitID.toString(),l.VatType=e.J0.IsEmpty(s.Tables[0][o].CCNID70)||"3"!=s.Tables[0][o].CCNID70.toString()?"0":"1",!e.J0.IsEmpty(s.Tables[0][o].Rent)){let r=parseFloat(s.Tables[0][o].Rent.toString());if(l.Amount=r.ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),"1"==l.VatType.toString()){l.VatPer=this.oparent.VatonRent.ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString());let c=r*this.oparent.VatonRent/100;l.VatAmount=c.ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),l.Net=(r+c).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())}else l.Net=r.ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())}l.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(l)}}else if(7==this.Calltype){if(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0){let s=null;e.J0.IsEmpty(this.oparent.Unit.LocalRefXML)||(s=u.d.rental.GetUnitsData(this.oparent.SelectedUnits,this.oparent.Unit.LocalRefXML));for(let o=0;o<this.oparent.dsPart.Tables[5].length;o++){let l=this.PstDocGrid.NewRow();l.Unit_key=this.oparent.dsPart.Tables[5][o].UnitID.toString();let r=null;this.oparent.StartDate.Date&&this.oparent.dsPart.Tables.length>7&&(r=this.oparent.dsPart.Tables[7].filter(c=>c.UNITID==this.oparent.dsPart.Tables[5][o].UnitID.toString()&&c.WEF<=this.oparent.StartDate.Date)),null!=r&&r.length>0?(r.SortBy(["WEF"]),e.J0.IsEmpty(r[0].RENT)||(l.BaseRent=l.Amount=r[0].RENT.toString()),e.J0.IsEmpty(r[0].DICOUNT)||(l.Discount=r[0].DICOUNT.toString()),e.J0.IsEmpty(r[0].RENTAMT)||(l.ActAmount=r[0].RENTAMT.toString())):(e.J0.IsEmpty(this.oparent.dsPart.Tables[5][o].RENT)||(l.BaseRent=l.Amount=this.oparent.dsPart.Tables[5][o].RENT.toString()),e.J0.IsEmpty(this.oparent.dsPart.Tables[5][o].Dicount)||(l.Discount=this.oparent.dsPart.Tables[5][o].Dicount.toString()),e.J0.IsEmpty(this.oparent.dsPart.Tables[5][o].RENTAMT)||(l.ActAmount=this.oparent.dsPart.Tables[5][o].RENTAMT.toString())),e.J0.IsEmpty(this.oparent.dsPart.Tables[5][o].PrevVal)||(l.PrevRent=parseFloat(this.oparent.dsPart.Tables[5][o].PrevVal.toString())),this.FillREfDet(s,l),l.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(l)}this.PstDocGrid.RefreshGrid=!0}}else if(this.oparent.EndDate.Date&&this.oparent.StartDate.Date&&!e.J0.IsEmpty(this.selectedrow.Amount))if(""!=this.oparent.SelectedUnits){let s=null;if(e.J0.IsEmpty(this.oparent.Unit.LocalRefXML)||(s=u.d.rental.GetUnitsData(this.oparent.SelectedUnits,this.oparent.Unit.LocalRefXML)),!e.J0.IsEmpty(this.oparent.dsPart)&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0){let o=this.oparent.dsPart.Tables[5].Compute("sum","RENT"),l=this.oparent.SelectedUnits.split(",");if(this.oparent.EndDate.Date>this.oparent.StartDate.Date.AddYears(1)){let r;r=e.J0.DoubleTryParse(this.oparent.TotalYears.Text);for(let c=0;c<l.length;c++){let d=null;if(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(d=this.oparent.dsPart.Tables[5].filter(D=>D.UnitID==l[c])),null!=d&&d.length>0){let D=parseFloat(this.selectedrow.Amount.toString())*parseFloat(d[0].RENT);null!=o&&parseFloat(o)>0&&(D/=parseFloat(o));let y=D/r;for(let P=0;P<r;P++){let b=this.PstDocGrid.NewRow();b.FromDate=this.oparent.StartDate.Date.AddYears(P).ToString(u.d.SessionManager.Preferences["Date Format"]),b.FromDate_Key=this.oparent.StartDate.Date.AddYears(P),P==r-1?(b.ToDate=this.oparent.EndDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),b.ToDate_Key=this.oparent.EndDate.Date):(b.ToDate=this.oparent.StartDate.Date.AddYears(P+1).AddDays(-1).ToString(u.d.SessionManager.Preferences["Date Format"]),b.ToDate_Key=this.oparent.StartDate.Date.AddYears(P+1).AddDays(-1)),b.Unit_key=d[0].UnitID.toString(),e.J0.IsEmpty(d[0].RENT)||(b.Amount=y.ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),b.Rate=(parseFloat(b.Amount)/parseFloat(d[0].RentableArea.toString())).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),b.Discount=0,b.ActAmount=b.Amount.toString(),this.PstDocGrid.TableColumns.Contains("BaseRent")&&this.oparent.dsPart.Columns[5].Contains("RENT")&&!e.J0.IsEmpty(d[0].RENT)&&(b.BaseRent=parseFloat(d[0].RENT.toString())),this.PstDocGrid.TableColumns.Contains("PrevRent")&&this.oparent.dsPart.Columns[5].Contains("PrevVal")&&!e.J0.IsEmpty(d[0].PrevVal)&&(b.PrevRent=parseFloat(d[0].PrevVal.toString())),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&(e.J0.IsEmpty(d[0].RENT)||(b.ProposedAmount=parseFloat(d[0].RENT.toString())),e.J0.IsEmpty(d[0].Dicount)||(b.ProposedDisc=parseFloat(d[0].Dicount.toString())),e.J0.IsEmpty(d[0].RENTAMT)||(b.ProposedRent=parseFloat(d[0].RENTAMT.toString())),this.CalcAmount(b,"")),this.FillREfDet(s,b),b.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(b)}}}}else{this.Filter.SelectedValue="1",this.ButtonSave("Selectionchanged"),this.PstDocGrid.Clear();let r=parseFloat(this.selectedrow.Amount.toString());if(r.ToString("N2")==parseFloat(o).ToString("N2"))for(let c=0;c<l.length;c++){let d=this.PstDocGrid.NewRow();d.FromDate=this.oparent.StartDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),d.FromDate_Key=this.oparent.StartDate.Date,this.PstDocGrid.TableColumns.Contains("ProposedAmount")?(d.ToDate=this.oparent.EndDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),d.ToDate_Key=this.oparent.EndDate.Date):(d.ToDate=this.oparent.StartDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),d.ToDate_Key=this.oparent.StartDate.Date);let D=null;null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(D=this.oparent.dsPart.Tables[5].filter(y=>y.UnitID==l[c])),null!=D&&D.length>0&&(d.Unit_key=D[0].UnitID.toString(),e.J0.IsEmpty(D[0].RENT)||(d.Amount=parseFloat(D[0].RENT).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),d.Rate=(parseFloat(d.Amount)/parseFloat(D[0].RentableArea.toString())).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),d.Discount=0,d.ActAmount=d.Amount.toString(),this.PstDocGrid.TableColumns.Contains("BaseRent")&&this.oparent.dsPart.Columns[5].Contains("RENT")&&!e.J0.IsEmpty(D[0].RENT)&&(d.BaseRent=e.J0.Double(D[0].RENT.toString())),this.PstDocGrid.TableColumns.Contains("PrevRent")&&this.oparent.dsPart.Columns[5].Contains("PrevVal")&&!e.J0.IsEmpty(D[0].PrevVal)&&(d.PrevRent=e.J0.Double(D[0].PrevVal.toString())),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&(e.J0.IsEmpty(D[0].RENT)||(d.ProposedAmount=e.J0.Double(D[0].RENT.toString())),e.J0.IsEmpty(D[0].Dicount)||(d.ProposedDisc=e.J0.Double(D[0].Dicount.toString())),e.J0.IsEmpty(D[0].RENTAMT)||(d.ProposedRent=e.J0.Double(D[0].RENTAMT.toString())),this.CalcAmount(d,""))),this.FillREfDet(s,d),d.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(d)}else for(let c=0;c<l.length;c++){let d=this.PstDocGrid.NewRow();d.FromDate=this.oparent.StartDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),d.FromDate_Key=this.oparent.StartDate.Date,this.PstDocGrid.TableColumns.Contains("ProposedAmount")?(d.ToDate=this.oparent.EndDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),d.ToDate_Key=this.oparent.EndDate.Date):(d.ToDate=this.oparent.StartDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),d.ToDate_Key=this.oparent.StartDate.Date);let D=null;null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(D=this.oparent.dsPart.Tables[5].filter(y=>y.UnitID==l[c])),null!=D&&D.length>0&&(d.Unit_key=D[0].UnitID.toString(),e.J0.IsEmpty(D[0].RENT)||(d.Amount=null!=o?(r*parseFloat(D[0].RENT)/parseFloat(o)).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()):(r*parseFloat(D[0].RENT)).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),d.Rate=(parseFloat(d.Amount)/parseFloat(D[0].RentableArea.toString())).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),d.Discount=0,d.ActAmount=d.Amount.toString(),this.PstDocGrid.TableColumns.Contains("BaseRent")&&this.oparent.dsPart.Columns[5].Contains("RENT")&&!e.J0.IsEmpty(D[0].RENT)&&(d.BaseRent=e.J0.Double(D[0].RENT.toString())),this.PstDocGrid.TableColumns.Contains("PrevRent")&&this.oparent.dsPart.Columns[5].Contains("PrevVal")&&!e.J0.IsEmpty(D[0].PrevVal)&&(d.PrevRent=e.J0.Double(D[0].PrevVal.toString())),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&(e.J0.IsEmpty(D[0].RENT)||(d.ProposedAmount=e.J0.Double(D[0].RENT.toString())),e.J0.IsEmpty(D[0].Dicount)||(d.ProposedDisc=e.J0.Double(D[0].Dicount.toString())),e.J0.IsEmpty(D[0].RENTAMT)||(d.ProposedRent=e.J0.Double(D[0].RENTAMT.toString())),this.CalcAmount(d,""))),this.FillREfDet(s,d),d.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(d)}}this.PstDocGrid.Columns[3].IsVisible&&!this.PstDocGrid.RefreshGrid&&(this.PstDocGrid.RefreshGrid=!0)}}else if(this.oparent.EndDate.Date>this.oparent.StartDate.Date.AddYears(1)){let s;s=e.J0.DoubleTryParse(this.oparent.TotalYears.Text);let l,o=parseFloat(this.selectedrow.Amount.toString())/s;e.J0.DoubleTryParse(this.selectedrow.Discount.toString())?(l=e.J0.DoubleTryParse(this.selectedrow.Discount.toString()),l/=s):l=0;let r=0,c=0;for(let d=0;d<s;d++){let D=this.PstDocGrid.NewRow();D.FromDate=this.oparent.StartDate.Date.AddYears(d).ToString(u.d.SessionManager.Preferences["Date Format"]),D.FromDate_Key=this.oparent.StartDate.Date.AddYears(d),d==s-1?(D.ToDate=this.oparent.EndDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),D.ToDate_Key=this.oparent.EndDate.Date,D.Amount=(parseFloat(this.selectedrow.Amount.toString())-r).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),l>0?(D.Discount=(parseFloat(this.selectedrow.Discount.toString())-c).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),D.ActAmount=(parseFloat(D.Amount.toString())+parseFloat(D.Discount.toString())).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())):(D.Discount=0,D.ActAmount=D.Amount.toString()),null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>0&&this.oparent.dsPart.Tables[5].length>0&&(D.Rate=(parseFloat(D.Amount)/parseFloat(this.oparent.dsPart.Tables[5][0].RentableArea.toString())).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()))):(D.ToDate=this.oparent.StartDate.Date.AddYears(d+1).AddDays(-1).ToString(u.d.SessionManager.Preferences["Date Format"]),D.ToDate_Key=this.oparent.StartDate.Date.AddYears(d+1).AddDays(-1),D.Amount=o.ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),l>0?(D.Discount=l.ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),D.ActAmount=(o+l).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),c+=parseFloat(D.Discount)):(D.Discount=0,D.ActAmount=D.Amount.toString()),null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>0&&this.oparent.dsPart.Tables[5].length>0&&(D.Rate=(parseFloat(D.Amount)/parseFloat(this.oparent.dsPart.Tables[5][0].RentableArea.toString())).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()))),r+=parseFloat(D.Amount.toString()),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(e.J0.IsEmpty(this.oparent.dsPart.Tables[5][0].RENT)||(D.ProposedAmount=parseFloat(this.oparent.dsPart.Tables[5][0].RENT.toString())),e.J0.IsEmpty(this.oparent.dsPart.Tables[5][0].Dicount)||(D.ProposedDisc=parseFloat(this.oparent.dsPart.Tables[5][0].Dicount.toString())),e.J0.IsEmpty(this.oparent.dsPart.Tables[5][0].RENTAMT)||(D.ProposedRent=parseFloat(this.oparent.dsPart.Tables[5][0].RENTAMT.toString())),this.CalcAmount(D,"")),D.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(D)}}null!=this.selectedrow&&this.OnGridCellEditEnding(null,"Amount",0);for(let s=0;s<5;s++){let o=this.PstDocGrid.NewRow();this.PstDocGridTableColumns.Contains("select")?o.select=!1:o.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(o)}if(7==this.Calltype)this.PartGrid.Visible=!1;else if(null!=this.selectedrow){this.PartGrid.CanUserSortColumns=!1,this.PartGrid.CanUserDeleteRows=!0,this.PartGrid.RowHeight=25,this.PartGrid.Columns=[],this.PartGrid.Width="",this.PartGrid.CanUserAddRows=!1,this.PartGridTableableColumns.push("Sno"),this.PartGridTableableColumns.push("Part"),this.PartGridTableableColumns.push("Part_Key"),this.PstDocGrid.DataTypes.Int.push("Part_Key"),this.PartGridTableableColumns.push("Amount"),this.PstDocGrid.DataTypes.Double.push("Amount"),t=new g.O7,t.Header="Particulars",t.DisplayMember="Part",t.Width=100,t.ReadOnly=!0,this.PartGrid.Columns.push(t),t=new g.O7,t.Header="Amount",t.DisplayMember="Amount",t.Width=100,t.DataType="FLOAT",t.ReadOnly=!0,t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount.toString(),this.PartGrid.Columns.push(t);for(let s=0;s<this.oparent.DataTable.length;s++)if(!e.J0.IsEmpty(this.oparent.DataTable[s].NodeID)){let o=this.PartGrid.NewRow();if(o.Part_Key=this.oparent.DataTable[s].NodeID.toString(),e.J0.IsEmpty(this.oparent.DataTable[s].Particulars)){var a=this.oparent.ContractParticular.find(l=>!e.J0.StringIsNullOrEmpty(l.ValueBinding)&&"NodeID"==l.ValueBinding);if(null!=a&&null!=a){let l=this.oparent.ContractParticular[1].ComboData.filter(r=>r.NodeID==this.oparent.DataTable[s].NodeID.toString());l.length>0&&(o.Part=l[0].Particulars.toString())}}else o.Part=this.oparent.DataTable[s].Particulars.toString();this.PartGrid.addRow(o)}}}OnRowSelection(i){return null!=i&&7!=this.Calltype&&this.PopulateParticulars(i),!0}getdays(i,t){return i.iMonth()<=2&&i.IsLeapYear()||2==t.iMonth()&&29==t.getDate()||i<new Date(t.getFullYear(),2,28)&&t.iMonth()>2&&t.IsLeapYear()?366:365}FillREfDet(i,t){if(null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("UnitID")){var h=i.Tables[0].filter(n=>n.UnitID==t.Unit_key.toString());if(h.length>0)for(let n=0;n<this.PstDocGrid.Columns.length;n++)this.PstDocGrid.Columns[n].DisplayMember.Contains("Fld")&&i.Columns[0].Contains(this.PstDocGrid.Columns[n].ID)&&(t[this.PstDocGrid.Columns[n].DisplayMember]=e.J0.String(h[0][this.PstDocGrid.Columns[n].ID]))}}PopulateParticulars(i){let t,h,n=null,a=null;e.J0.IsEmpty(i.ToDate_Key)||(a=e.J0.ParseDate(i.ToDate_Key.toString())),e.J0.IsEmpty(i.FromDate_Key)||(n=e.J0.ParseDate(i.FromDate_Key.toString()));for(let s=0;s<this.oparent.DataTable.length;s++)if(!e.J0.IsEmpty(this.oparent.DataTable[s].NodeID)){let o=this.PartGrid.Table.filter(l=>l.Part_Key==this.oparent.DataTable[s].NodeID.toString());if(o.length>0){let l=0;if(this.oparent.DataTable[s]==this.selectedrow)for(let r=0;r<this.PstDocGrid.Table.length;r++)!e.J0.IsEmpty(this.PstDocGrid.Table[r].Amount)&&!e.J0.IsEmpty(this.PstDocGrid.Table[r].FromDate_Key)&&(e.J0.ParseDate(this.PstDocGrid.Table[r].FromDate_Key.toString()),l+=parseFloat(this.PstDocGrid.Table[r].Amount.toString()));else if(e.J0.IsEmpty(this.oparent.DataTable[s].Xml))!e.J0.IsEmpty(n)&&n.Date==this.oparent.StartDate.Date&&!e.J0.IsEmpty(this.oparent.DataTable[s].Amount)&&(l+=parseFloat(this.oparent.DataTable[s].Amount.toString()));else{let r=new e.VB;r.LoadXml(this.oparent.DataTable[s].Xml.toString());let c=-1;if(r.DocumentElement.children.length>0&&null!=r.DocumentElement.attributes&&null!=r.DocumentElement.attributes.Filter&&!e.J0.IsEmpty(r.DocumentElement.attributes.Filter.value)&&(c=parseInt(r.DocumentElement.attributes.Filter.value)),2==c||-1==c)r.DocumentElement.children[0].childNodes.forEach(d=>{t=e.J0.isValidDate(d.FromDate.value),h=e.J0.isValidDate(d.ToDate.value),!e.J0.IsEmpty(n)&&null!=t&&n.Date==t.Date&&!e.J0.IsEmpty(d.Amount.value)&&!e.J0.IsEmpty(a)&&null!=h&&a.Date==h.Date&&(l+=parseFloat(d.Amount.value))});else if(0==c){let d=r.SelectNodes("XML/UnitsRow/Row");for(let D=0;D<d.length;D++){let y=d[D];t=e.J0.isValidDate(y.attributes.FromDate.value),h=e.J0.isValidDate(y.attributes.ToDate.value),!e.J0.IsEmpty(n)&&null!=t&&n.Date==t.Date&&!e.J0.IsEmpty(y.attributes.Amount.value)&&!e.J0.IsEmpty(a)&&null!=h&&a.Date==h.Date&&(l+=parseFloat(y.attributes.Amount.value))}}}o[0].Amount=l,this.PartGrid.updateRow(o[0])}}}CalcAmount(i,t){let h,n,a;if(h=e.J0.DoubleTryParse(i.ProposedRent),n=e.J0.DoubleTryParse(i.ProposedDisc),a=e.J0.DoubleTryParse(i.ProposedAmount),"ProposedAmount"==t&&(i.ProposedRent=(a+n).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),("ProposedRent"==t||"ProposedDisc"==t)&&(0==h&&a>0?i.ProposedRent=(a+n).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()):i.ProposedAmount=(h-n).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),!e.J0.IsEmpty(i.ToDate_Key)&&!e.J0.IsEmpty(i.FromDate_Key)){let s=e.J0.GetDateDifference(e.J0.ParseDate(i.ToDate_Key),e.J0.ParseDate(i.FromDate_Key));s++,365==s||366==s?i.ActAmount=i.ProposedAmount:(a=e.J0.DoubleTryParse(i.ProposedAmount),i.ActAmount=(a/this.getdays(new Date(i.FromDate_Key.toString()),new Date(i.ToDate_Key.toString()))*s).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),h=e.J0.DoubleTryParse(i.ActAmount),n=e.J0.DoubleTryParse(i.Discount),i.Amount=(h-n).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())}}OnBeginEdit(i){let h=this.PstDocGrid.Table.indexOf(i.args.item);if(h=-1==h||this.PstDocGrid.Table.length-h<3?3:0,this.PstDocGrid.CanUserAddRows)for(let n=0;n<h;n++){let a=this.PstDocGrid.NewRow();a.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(a)}}BeginningEditEvent(i){try{if(null!=this.oparent.SelectedRow&&Object.keys(this.oparent.SelectedRow).Contains("NodeID")&&this.oparent.SelectedRow.NodeID.toString()==this.oparent.id2.ToString()){let t;t=this.oparent.ScreenObject.Data.Tables[this.oparent.ScreenObject.Data.Tables.length-2].filter(0==this.oparent.ContractID?h=>-5==h.CostCenterColID&&(1==h.Mode||3==h.Mode):h=>-5==h.CostCenterColID&&(2==h.Mode||3==h.Mode)),t.length>0&&!e.J0.IsEmpty(t[0].IsEditable)&&((0,G.yG0)(t[0].IsEditable.toString())||(i.Cancel=!0))}}catch(t){Logger.ErrorLog("UpdatePaytermViewModelContract::BeginningEditEvent Error message"+t)}}OnGridCellEditEnding(i,t,h){if(e.J0.IsEmpty(i)||(t=i.column.field,i=i.item),"Percent"==t&&!e.J0.IsEmpty(i.Percent)&&parseFloat(i.Percent.toString())>0&&this.PstDocGrid.SelectedIndex>0&&!e.J0.IsEmpty(this.PstDocGrid.Table[this.PstDocGrid.SelectedIndex-1].Amount)){let n=parseFloat(this.PstDocGrid.Table[this.PstDocGrid.SelectedIndex-1].Amount.toString());i.Amount=(n+parseFloat(i.Percent)*n/100).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),t="Amount"}if("MonthAmount"==t&&null!=i&&!e.J0.IsEmpty(i.MonthAmount)&&!e.J0.IsEmpty(i.ToDate_Key)&&!e.J0.IsEmpty(i.FromDate_Key)&&(i.Amount=parseFloat(i.MonthAmount.toString())*this.oparent.CalculateMonthsbetweenDates(e.J0.ParseDate(i.FromDate_Key.toString()),e.J0.ParseDate(i.ToDate_Key.toString())),t="Amount"),"VatType"==t&&(t="Amount"),null!=i&&("ProposedRent"==t||"ProposedDisc"==t||"ProposedAmount"==t)&&(this.CalcAmount(i,t),this.CalculateTotals(i),this.PstDocGrid.updateRow(i),this.PstDocGrid.UpdateTotals(),this.PopulateParticulars(i)),("Amount"==t||"ActAmount"==t||"Discount"==t||"Rate"==t)&&this.PstDocGrid.Columns.length>4){if("Rate"==t&&null!=i)if(null==this.oparent.dsPart&&this.oparent.FillDs(),e.J0.IsEmpty(i.Unit_key))this.oparent.dsPart.Tables[5].length>0&&(i.Amount=(parseFloat(i.Rate)*parseFloat(this.oparent.dsPart.Tables[5].Compute("sum","RentableArea").toString())).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()));else{let n=this.oparent.dsPart.Tables[5].filter(a=>a.UnitID==i.Unit_key.toString());n.length>0&&(i.Amount=(parseFloat(i.Rate)*parseFloat(n[0].RentableArea.toString())).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()))}if(null!=i){let n,a,s;n=e.J0.DoubleTryParse(i.ActAmount),a=e.J0.DoubleTryParse(i.Discount),s=e.J0.DoubleTryParse(i.Amount),("Amount"==t||"Rate"==t)&&(i.ActAmount=(s+a).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),("ActAmount"==t||"Discount"==t)&&(0==n&&s>0?i.ActAmount=(s+a).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()):i.Amount=(n-a).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),7==this.Calltype&&104==this.oparent.CostCenterID&&("1"==i.VatType.toString()?(i.VatPer=this.oparent.VatonRent.ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),a=s*this.oparent.VatonRent/100,i.VatAmount=a.ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),i.Net=(s+a).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())):(i.VatPer=(0).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),i.VatAmount=(0).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),i.Net=s.ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())))}if(this.CalculateTotals(i),null!=i&&7!=this.Calltype){if("Rate"!=t&&(null==this.oparent.dsPart&&this.oparent.FillDs(),!e.J0.IsEmpty(i.Amount)))if(e.J0.IsEmpty(i.Unit_key))this.oparent.dsPart.Tables[5].length>0&&(i.Rate=(parseFloat(i.Amount)/parseFloat(this.oparent.dsPart.Tables[5].Compute("sum","RentableArea").toString())).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()));else{let n=this.oparent.dsPart.Tables[5].filter(a=>a.UnitID==i.Unit_key.toString());n.length>0&&(i.Rate=(parseFloat(i.Amount)/parseFloat(n[0].RentableArea.toString())).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()))}this.PstDocGrid.updateRow(i),this.PstDocGrid.UpdateTotals(),this.PopulateParticulars(i)}}}CalculateTotals(i){let t=this.PstDocGrid.Table.Compute("sum","Amount");(null==t||null==t)&&(t=0);var h=this.PstDocGrid.Columns.find(n=>"Amount"==n.DisplayMember);null!=h&&(h.footer=parseFloat(t).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),t=this.PstDocGrid.Table.Compute("sum","ActAmount"),(null==t||null==t)&&(t=0),null!=(h=this.PstDocGrid.Columns.find(n=>"ActAmount"==n.DisplayMember))&&(h.footer=parseFloat(t).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),t=this.PstDocGrid.Table.Compute("sum","Discount"),(null==t||null==t)&&(t=0),null!=(h=this.PstDocGrid.Columns.find(n=>"Discount"==n.DisplayMember))&&(h.footer=parseFloat(t).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&(t=this.PstDocGrid.Table.Compute("sum","ProposedAmount"),(null==t||null==t)&&(t=0),null!=(h=this.PstDocGrid.Columns.find(n=>"ProposedAmount"==n.DisplayMember))&&(h.footer=parseFloat(t).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),t=this.PstDocGrid.Table.Compute("sum","ProposedRent"),(null==t||null==t)&&(t=0),null!=(h=this.PstDocGrid.Columns.find(n=>"ProposedRent"==n.DisplayMember))&&(h.footer=parseFloat(t).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),t=this.PstDocGrid.Table.Compute("sum","ProposedDisc)"),(null==t||null==t)&&(t=0),null!=(h=this.PstDocGrid.Columns.find(n=>"ProposedDisc"==n.DisplayMember))&&(h.footer=parseFloat(t).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()))),this.PstDocGrid.TableColumns.Contains("BaseRent")&&(t=this.PstDocGrid.Table.Compute("sum","BaseRent"),(null==t||null==t)&&(t=0),null!=(h=this.PstDocGrid.Columns.find(n=>"BaseRent"==n.DisplayMember))&&(h.footer=parseFloat(t).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()))),7==this.Calltype&&104==this.oparent.CostCenterID&&(t=this.PstDocGrid.Table.Compute("sum","Net"),(null==t||null==t)&&(t=0),null!=(h=this.PstDocGrid.Columns.find(n=>"Net"==n.DisplayMember))&&(h.footer=parseFloat(t).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),t=this.PstDocGrid.Table.Compute("sum","VatAmount"),(null==t||null==t)&&(t=0),null!=(h=this.PstDocGrid.Columns.find(n=>"VatAmount"==n.DisplayMember))&&(h.footer=parseFloat(t).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()))),null!=i&&this.PstDocGrid.UpdateFooter()}InitColumns(){let i;this.Tower=new E.y$(0),this.CompletionDate=new I.C_(0),this.CompletionDate.Label="New CompletionDate",this.EndDate=new I.C_(0),this.EndDate.Visible=!1,this.PartGrid=new A.vv,this.PartGrid.Visible=!1,this.PartGrid=new A.vv,this.PartGrid.CanUserSortColumns=!0,this.PartGrid.Columns=[],this.PartGrid.Width="",this.PstDocGridTableColumns.push("Sno"),this.PstDocGridTableColumns.push("select"),this.PstDocGrid.DataTypes.Bool.push("select"),this.PstDocGridTableColumns.push("DocNumber"),this.PstDocGridTableColumns.push("DocPrefix"),this.PstDocGridTableColumns.push("DocID"),this.PstDocGridTableColumns.push("CostCenterID"),this.PstDocGridTableColumns.push("VNO"),i=new g.O7,i.Header=u.d.GetResource("DocumentDesigner_Sno"),i.DisplayMember="Sno",i.ReadOnly=!0,i.Width=50,this.PstDocGrid.Columns.push(i),i=new g.O7,i.Header="Select",i.DisplayMember="select",i.Width=60,i.DataType="CheckBox",this.PstDocGrid.Columns.push(i);let t=u.d.rental.GetPaymentScreenDef(),h=null;for(let n=0;n<t.Tables[0].length;n++)"PaymentTermDocumentName"==t.Tables[0][n].DBText.toString()?e.J0.IsEmpty(t.Tables[0][n].Value)||(this.DocCCID=parseInt(t.Tables[0][n].Value.toString())):"PaymentTermCompletionDate"==t.Tables[0][n].DBText.toString()?this.CompletionDateColName=t.Tables[0][n].Value.toString():"LinkDocument"==t.Tables[0][n].DBText.toString()?e.J0.IsEmpty(t.Tables[0][n].Value)||(this.CCID=parseInt(t.Tables[0][n].Value.toString())):"PaymentTermFields"==t.Tables[0][n].DBText.toString()&&(h=t.Tables[0][n].Value.toString().split(";"));this.Tower.CCID=this.CCID,this.Tower.TypeID=1,this.Tower.Label="Tower",h.forEach(n=>{let a=[]=t.Tables[1].filter(s=>s.SysColumnName==n);if(a.length>0)if(i=new g.O7,i.Header=a[0].ResourceData.toString(),i.DisplayMember=a[0].SysColumnName.toString(),"VoucherNo"==i.DisplayMember&&(i.DataType="LINK",i.Click.Subscribe(this,"onClick")),i.ReadOnly=!0,i.Width=100,this.PstDocGrid.Columns.push(i),i.SectionName=a[0].UserColumnType.toString(),this.PstDocGridTableColumns.push(a[0].SysColumnName.toString()),a[0].SysColumnName.toString().toLowerCase().Contains("dcccnid")){let s=parseInt(a[0].SysColumnName.toString().toLowerCase().Replace("dcccnid",""));s+=5e4,this.Joins+=" left Join "+this.GetTableName(s)+" c"+s.toString()+"  WITH(NOLOCK) on c."+a[0].SysColumnName.toString()+"= c"+s.toString()+".NODEID  ",this.Columns+=",c"+s.toString()+".name "+i.DisplayMember}else"debitaccount"==a[0].SysColumnName.toString().toLowerCase()||"creditaccount"==a[0].SysColumnName.toString().toLowerCase()?(this.Joins+=" left Join "+this.GetTableName(2)+" c"+a[0].SysColumnName.toString()+"  WITH(NOLOCK) on a."+a[0].SysColumnName.toString()+"= c"+a[0].SysColumnName.toString()+".AccountID  ",this.Columns+=",c"+a[0].SysColumnName.toString()+".Accountname "+i.DisplayMember):"duedate"==a[0].SysColumnName.toString().toLowerCase()||"docdate"==a[0].SysColumnName.toString().toLowerCase()||"billdate"==a[0].SysColumnName.toString().toLowerCase()?this.Columns+=",Convert(datetime,"+i.DisplayMember+") "+i.DisplayMember:this.Columns+=","+i.DisplayMember;else"PaymentTerm"==n&&(i=new g.O7,i.Header="PaymentTerm",i.DisplayMember="PaymentTerm",i.ReadOnly=!0,i.Width=100,i.SectionName="PaymentTerm",this.PstDocGrid.Columns.push(i),this.PstDocGridTableColumns.push("PaymentTerm"),this.Columns+=",(select top 1 pd.ProfileName from COM_DocPayTerms p ",this.Columns+=" join Acc_PaymentDiscountProfile pd on p.ProfileID=pd.ProfileID  ",this.Columns+=" where p.VoucherNo=a.VoucherNo)  "+i.DisplayMember)})}GetTableName(i){return 2==i?"ACC_Accounts":3==i?"INV_Product":50001==i?"COM_Division":50002==i?"COM_Location":50003==i?"COM_Branch":50004==i?"COM_Department":50005==i?"COM_Salesman":50006==i?"COM_Category":50007==i?"COM_Area":50008==i?"COM_Teritory":"COM_CC"+i}onClick(){null!=this.PstDocGrid.SelectedItem&&!e.J0.IsEmpty(this.PstDocGrid.SelectedItem.CostCenterID)&&_.RibbonExtViewModel.LoadDocument(this.PstDocGrid.SelectedItem)}SelectAllRows(){for(let i=0;i<this.PstDocGrid.Table.length;i++)this.PstDocGridTable[i].select=this.SelectAll}FillSearchDetails(){this.Options=new f.y$(0),this.SearchCols=new f.y$(0),this.Options.Items.push(f._p.ComboBoxItems_2(u.d.GetResource("Com_Equals"),"1")),this.Options.Items.push(f._p.ComboBoxItems_2(u.d.GetResource("Com_NotEquals"),"2")),this.Options.Items.push(f._p.ComboBoxItems_2(u.d.GetResource("Com_BeginsWith"),"3")),this.Options.Items.push(f._p.ComboBoxItems_2(u.d.GetResource("Com_EndsWith"),"4")),this.Options.Items.push(f._p.ComboBoxItems_2(u.d.GetResource("Com_Contains"),"5")),this.Options.Items.push(f._p.ComboBoxItems_2(u.d.GetResource("Com_NotContains"),"6")),this.Options.SelectedValue="5",this.PstDocGrid.Columns.forEach(i=>{i.IsVisible&&"Sno"!=i.DisplayMember&&"select"!=i.DisplayMember&&this.SearchCols.Items.push(f._p.ComboBoxItems_2(i.Header,i.DisplayMember))}),this.SearchCols.Items.length>0&&(this.SearchCols.SelectedValue=this.SearchCols.Items[0].Value)}LoadData(){if(null!=this.Tower&&this.Tower.CCID>0&&this.Tower.SelectedValue>0){let i,t;this.PstDocGrid.Clear();let h=" where c.dcCCNID"+(this.Tower.CCID-5e4).toString()+"="+this.Tower.SelectedValue,n=u.d.rental.GetPayTermsofProperty(h,this.Columns,this.Joins);if(null!=n&&n.Tables.length>0&&n.Columns[0].Contains("DocPrefix")){for(let a=0;a<n.Tables[0].length;a++){t=this.PstDocGrid.NewRow(),t.Sno=(a+1).toString(),t.select=!1,t.DocNumber=n.Tables[0][a].DocNumber.toString(),t.DocPrefix=n.Tables[0][a].DocPrefix.toString(),t.DocID=n.Tables[0][a].DocID.toString(),t.CostCenterID=n.Tables[0][a].CostCenterID.toString(),t.VNO=n.Tables[0][a].VNO.toString();for(let s=2;s<this.PstDocGrid.Columns.length;s++)n.Columns[0].Contains(this.PstDocGrid.Columns[s].DisplayMember)?"date"==this.PstDocGrid.Columns[s].SectionName.toLowerCase()&&!e.J0.IsEmpty(n.Tables[0][a][this.PstDocGrid.Columns[s].DisplayMember])&&e.J0.isValidDate(n.Tables[0][a][this.PstDocGrid.Columns[s].DisplayMember].toString())&&(i=e.J0.isValidDate(n.Tables[0][a][this.PstDocGrid.Columns[s].DisplayMember].toString()),t[this.PstDocGrid.Columns[s].DisplayMember]=e.J0.ParseDate(n.Tables[0][a][this.PstDocGrid.Columns[s].DisplayMember].toString()).ToString(u.d.SessionManager.Preferences["Date Format"])):"datetime"==this.PstDocGrid.Columns[s].SectionName.toLowerCase()&&!e.J0.IsEmpty(n.Tables[0][a][this.PstDocGrid.Columns[s].DisplayMember])&&e.J0.isValidDate(n.Tables[0][a][this.PstDocGrid.Columns[s].DisplayMember].toString())?(i=e.J0.isValidDate(n.Tables[0][a][this.PstDocGrid.Columns[s].DisplayMember].toString()),t[this.PstDocGrid.Columns[s].DisplayMember]=e.J0.ParseDate(n.Tables[0][a][this.PstDocGrid.Columns[s].DisplayMember].toString()).ToString(u.d.SessionManager.Preferences["Date Format"]+" hh:mm:ss")):t[this.PstDocGrid.Columns[s].DisplayMember]=n.Tables[0][a][this.PstDocGrid.Columns[s].DisplayMember].toString()}this.PstDocGrid.addRow(t)}}}ButtonSave(i){if(this.DisplayMessage="",this.PstDocGrid&&this.PstDocGrid.angularGrid?.slickGrid&&this.PstDocGrid.angularGrid?.slickGrid.getActiveCellNode()&&(this.PstDocGrid.angularGrid.slickGrid.getActiveCell(),this.PstDocGrid.angularGrid.slickGrid.getEditorLock().commitCurrentEdit()),"Save"==i){if(2==this.Calltype||50==this.Calltype)return void u.d.page.HideDialog(this.PopUpGUID);if(7==this.Calltype){let o,l,r,a="",s="",c=0,d=0,D=0,y=0;if(this.Filter.Visible&&this.Filter.Items.length>1)for(let P=0;P<this.Filter.Items.length;P++){const b=this.Filter.Items[P];if(b!=this.Filter.SelectedItem&&e.J0.IsEmpty(b.Aliasname))return this.DisplayMessage="Define rates for "+b.Name,void(this.MessageVisibility=!0);b!=this.Filter.SelectedItem&&(a+=b.Aliasname,d+=b.ExchgRate,null!=b.obj?D+=parseFloat(b.obj):b.obj=0,o=this.oparent.StartDate.Date,c=parseInt(b.Value),l=o.AddYears(c-1),o=o.AddYears(c),r=o<this.oparent.EndDate.Date?o.AddDays(-1):this.oparent.EndDate.Date,s+='<Row FromDate="'+l.ToString("dd/MMM/yyyy")+'" ',s+='ToDate="'+r.ToString("dd/MMM/yyyy")+'" ',s+='Distribute="'+b.Seq+'" ',s+='Amount="'+b.ExchgRate+parseFloat(b.obj)+'" ',s+='Discount="0" ',s+='ActAmount="'+b.ExchgRate+parseFloat(b.obj)+'" ',s+='NonTaxAmount="'+parseFloat(b.obj)+'" ',s+='TaxableAmt="'+b.ExchgRate+'" />')}null!=this.Filter.SelectedItem&&(c=e.J0.Int(this.CopyRows.Text),this.Filter.SelectedItem.Seq=!e.J0.IsEmpty(this.CopyRows.Text)&&c>0?c:1),this.Filter.Visible?(o=this.oparent.StartDate.Date,c=parseInt(this.Filter.SelectedValue),l=o.AddYears(c-1),a+='FromDate="'+o.ToString("dd/MMM/yyyy")+'" ',o=o.AddYears(c),r=o<this.oparent.EndDate.Date?o.AddDays(-1):this.oparent.EndDate.Date,a+='ToDate="'+o.ToString("dd/MMM/yyyy")+'" '):(l=this.oparent.StartDate.Date,r=this.oparent.EndDate.Date),this.Filter.Visible&&this.Filter.Items.length>1&&(this.Filter.SelectedItem.obj=this.Filter.SelectedItem.ExchgRate=0),a+="<UnitsXML>";for(let P=0;P<this.PstDocGrid.Table.length;P++)if(!e.J0.IsEmpty(this.PstDocGrid.Table[P].Amount)){a+="<Row ",this.Filter.Visible&&this.Filter.Items.length>1&&(a+='Year="'+this.Filter.SelectedValue+'" Distribute="'+this.Filter.SelectedItem.Seq+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[P].Unit_key)||(a+='Unit="'+this.PstDocGrid.Table[P].Unit_key.toString()+'" '),a+='Amount="'+this.PstDocGrid.Table[P].Amount.toString()+'" ',104==this.oparent.CostCenterID?("1"==e.J0.String(this.PstDocGrid.Table[P].VatType)?d+=parseFloat(this.PstDocGrid.Table[P].Amount.toString()):D+=parseFloat(this.PstDocGrid.Table[P].Amount.toString()),a+='FromDate="'+l.ToString("dd/MMM/yyyy")+'" ',a+='ToDate="'+r.ToString("dd/MMM/yyyy")+'" ',this.Filter.Visible&&this.Filter.Items.length>1&&("1"==this.PstDocGrid.Table[P].VatType.toString()?this.Filter.SelectedItem.ExchgRate+=parseFloat(this.PstDocGrid.Table[P].Amount.toString()):this.Filter.SelectedItem.obj=parseFloat(this.Filter.SelectedItem.obj)+parseFloat(this.PstDocGrid.Table[P].Amount.toString()))):(this.PstDocGridTableColumns.Contains("Discount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[P].Discount)&&(d+=parseFloat(this.PstDocGrid.Table[P].Discount.toString())),this.PstDocGridTableColumns.Contains("ActAmount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[P].ActAmount)&&(D+=parseFloat(this.PstDocGrid.Table[P].ActAmount.toString())),this.PstDocGridTableColumns.Contains("BaseRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[P].BaseRent)&&(y+=parseFloat(this.PstDocGrid.Table[P].BaseRent.toString()))),this.PstDocGridTableColumns.Contains("BaseRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[P].BaseRent)&&(a+='BaseRent="'+this.PstDocGrid.Table[P].BaseRent.toString()+'" '),this.PstDocGridTableColumns.Contains("PrevRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[P].PrevRent)&&(a+='PrevRent="'+this.PstDocGrid.Table[P].PrevRent.toString()+'" '),this.PstDocGridTableColumns.Contains("Discount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[P].Discount)&&(a+='Discount="'+this.PstDocGrid.Table[P].Discount.toString()+'" '),this.PstDocGridTableColumns.Contains("ActAmount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[P].ActAmount)&&(a+='ActAmount="'+this.PstDocGrid.Table[P].ActAmount.toString()+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[P].VatType)||(a+='VatType="'+this.PstDocGrid.Table[P].VatType.toString()+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[P].VatPer)||(a+='VatPer="'+this.PstDocGrid.Table[P].VatPer.toString()+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[P].VatAmount)||(a+='VatAmount="'+this.PstDocGrid.Table[P].VatAmount.toString()+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[P].Net)||(a+='Net="'+this.PstDocGrid.Table[P].Net.toString()+'" ');for(let b=0;b<this.PstDocGrid.Columns.length;b++)this.PstDocGrid.Columns[b].DisplayMember.Contains("Fld")&&(a+=this.PstDocGrid.Columns[b].DisplayMember+'="'+e.J0.String(this.PstDocGrid.Table[P][this.PstDocGrid.Columns[b].DisplayMember])+'" ');a+='Narration="'+e.J0.String(this.PstDocGrid.Table[P].Narration)+'"/>'}return a+="</UnitsXML>",this.selectedrow.UnitXml=a.toString(),104==this.oparent.CostCenterID?(this.selectedrow.NonTaxAmount=D,this.selectedrow.Amount=d+D,this.selectedrow.ActAmount=e.J0.IsEmpty(this.selectedrow.Discount)?this.selectedrow.Amount:d+D+parseFloat(this.selectedrow.Discount.toString()),this.oparent.CalculateNRec(),this.oparent.CalculateFooter(),this.Filter.Visible&&this.Filter.Items.length>1&&(s+='<Row FromDate="'+l.ToString("dd/MMM/yyyy")+'" ',s+='ToDate="'+r.ToString("dd/MMM/yyyy")+'" ',s+='Distribute="'+this.Filter.SelectedItem.Seq+'" ',s+='Amount="'+this.Filter.SelectedItem.ExchgRate+parseFloat(this.Filter.SelectedItem.obj)+'" ',s+='Discount="0" ',s+='ActAmount="'+this.Filter.SelectedItem.ExchgRate+parseFloat(this.Filter.SelectedItem.obj)+'" ',s+='NonTaxAmount="'+parseFloat(this.Filter.SelectedItem.obj)+'" ',s+='TaxableAmt="'+this.Filter.SelectedItem.ExchgRate+'" />',s.Insert(0,"<XML>"),s+="</XML>",this.selectedrow.Xml=s.toString())):(this.oparent.ProposedRent.Text=D.toString(),this.oparent.ProposedDisc.Text=d.toString(),(t=this.oparent.ScreenObject.Data.Tables[0].filter(P=>null!=P.LocalReference&&93==P.LocalReference&&25641==P.LinkData)).length>0&&null!=(h=this.oparent.ScreenObject.GetCustomField(t[0].SysColumnName.toString()))&&h instanceof M.Dw&&(h.Text=y.toString()),this.oparent.CalculateTextFields(this.oparent.ProposedDisc),this.oparent.CalculateRentBaedOnDays(0,!1)),void u.d.page.HideDialog(this.PopUpGUID)}if(1==this.Calltype){let a=0;if(a=e.J0.IntTryParse(this.CopyRows.Text),!(a>0))return this.DisplayMessage="Enter valid count.",void(this.MessageVisibility=!0);{let s=["DocID","DocNumber","DocPrefix","DocumentName","CostCenterID","DocumentNo","Status","Xml"],o=this.oparent.DataTable.indexOf(this.selectedrow);for(let l=0;l<a;l++){let r=this.oparent.DataTableObj.NewRow();for(let c=0;c<this.oparent.DataTableObj.Columns.length;c++)this.oparent.DataTableColumns.Contains(s[c])||(r[c]=this.selectedrow[c]);this.oparent.DataTableObj.insertRowAt(r,o)}for(let l=0;l<this.oparent.DataTableObj.Table.length;l++)this.oparent.DataTable[l].SNO=l+1}return}if(3==this.Calltype||4==this.Calltype||5==this.Calltype||6==this.Calltype){for(let a=0;a<this.PstDocGrid.Table.length;a++)if(""!=this.PstDocGrid.Table[a].Select.toString()&&(0,G.yG0)(this.PstDocGrid.Table[a].Select.toString())){let s=new J.AddEditRenContractViewModel;s.AddEditRenContractViewModel_1(95,parseInt(this.PstDocGrid.Table[a].ContractID.toString()),!1,0,0,""),s.IsFromSubContract=!1,s.ContractDate.Text=s.ContractDate.Date.ToString("dd/MMM/yyyy"),s.StartDate.Text=s.StartDate.Date.ToString("dd/MMM/yyyy"),s.EndDate.Text=s.EndDate.Date.ToString("dd/MMM/yyyy"),s.Tenant.Text=s.Property.Text=s.Unit.Text="",3==this.Calltype?(s.IsFromSubContract=!0,s.OnCustomizeExtraFields("AutoRenew"),s.OnSave("AutoSave")):4==this.Calltype?(s.TerminateContracts=this.oparent.TerminateContracts,s.TerminateContract(s.ContractID,this.oparent.cntrct.Reason,this.oparent.cntrct.TerminationDate,1,!0)):5==this.Calltype?(s.TerminateContracts=this.oparent.TerminateContracts,s.TerminateContract(s.ContractID,this.oparent.cntrct.Reason,this.oparent.cntrct.TerminationDate,3,!0)):6==this.Calltype&&(s.TerminateContracts=this.oparent.TerminateContracts,s.TerminateContract(s.ContractID,this.oparent.cntrct.Reason,this.oparent.cntrct.TerminationDate,2,!0))}return void u.d.page.HideDialog(this.PopUpGUID)}if(null!=this.oparent&&null!=this.selectedrow){if(this.oparent.IsRecurPosted)return this.DisplayMessage="Can not change as documents posted.",void(this.MessageVisibility=!0);let a=0,s=null,o=null,l=0,r=0,c=0,d=new Array;if(this.Filter.Visible&&"2"!=this.Filter.SelectedValue){if(this.Filter.Visible&&"1"==this.Filter.SelectedValue){for(let m=0;m<this.PstDocGrid.Table.length;m++)if(!e.J0.IsEmpty(this.PstDocGrid.Table[m].Unit_key)){if(d.Contains(parseInt(this.PstDocGrid.Table[m].Unit_key.toString())))return this.DisplayMessage="Unit "+this.PstDocGrid.Table[m].Unit.toString()+" is defined more than once.",void(this.MessageVisibility=!0);d.push(parseInt(this.PstDocGrid.Table[m].Unit_key.toString())),e.J0.IsEmpty(this.PstDocGrid.Table[m].Amount)||(l+=parseFloat(this.PstDocGrid.Table[m].Amount.toString()),a++),e.J0.IsEmpty(this.PstDocGrid.Table[m].ActAmount)||(c+=parseFloat(this.PstDocGrid.Table[m].ActAmount.toString())),e.J0.IsEmpty(this.PstDocGrid.Table[m].Discount)||(r+=parseFloat(this.PstDocGrid.Table[m].Discount.toString()))}if(a>0&&d.length!=this.oparent.SelectedUnits.split(",").length)return this.DisplayMessage="Distribution not defined for some units.",void(this.MessageVisibility=!0)}else if(this.Filter.Visible&&"0"==this.Filter.SelectedValue&&(this.oparent.SelectedUnits.split(",").forEach(m=>{var S=this.PstDocGrid.Table.filter(p=>p.Unit_key==m,"FromDate_Key");if(s=null,o=null,S.length>0){d.push(parseInt(m));for(let p=0;p<S.length;p++){if(null==s&&!e.J0.IsEmpty(S[p].FromDate_Key)&&(s=e.J0.ParseDate(S[p].FromDate_Key.toString())),null!=o&&!e.J0.IsEmpty(S[p].FromDate_Key)&&1!=e.J0.GetDateDifference(e.J0.ParseDate(S[p].FromDate_Key),e.J0.ParseDate(o)))return this.DisplayMessage="Enter correct from date at row no:"+(this.PstDocGrid.Table.indexOf(S[p])+1),void(this.MessageVisibility=!0);if(e.J0.IsEmpty(S[p].Amount)||(l+=parseFloat(S[p].Amount.toString()),a++),e.J0.IsEmpty(S[p].ActAmount)||(c+=parseFloat(S[p].ActAmount.toString())),e.J0.IsEmpty(S[p].Discount)||(r+=parseFloat(S[p].Discount.toString())),e.J0.IsEmpty(S[p].ToDate_Key)||(o=e.J0.ParseDate(S[p].ToDate_Key.toString())),this.PstDocGrid.TableColumns.Contains("Distribute")&&!e.J0.IsEmpty(S[p].FromDate_Key)&&!e.J0.IsEmpty(S[p].ToDate_Key)&&(""==e.J0.String(S[p].Distribute)||parseInt(S[p].Distribute.toString())<1))return this.DisplayMessage="Enter Distribute at row no:"+(this.PstDocGrid.Table.indexOf(S[p])+1),void(this.MessageVisibility=!0)}if(null==s||s.toDateString()!=this.CompletionDate.Date.toDateString())return this.DisplayMessage="Contract start date and first date does not match for ."+S[0].Unit.toString(),void(this.MessageVisibility=!0);if(null==o||o.toDateString()!=this.EndDate.Date.toDateString())return this.DisplayMessage="Contract end date and last date does not match for ."+S[0].Unit.toString(),void(this.MessageVisibility=!0)}}),a>0&&d.length!=this.oparent.SelectedUnits.split(",").length))return this.DisplayMessage="Distribution not defined for some units.",void(this.MessageVisibility=!0)}else{for(let m=0;m<this.PstDocGrid.Table.length;m++){if(null==s&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].FromDate_Key)&&(s=e.J0.ParseDate(this.PstDocGrid.Table[m].FromDate_Key.toString())),null!=o&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].FromDate_Key)&&1!=e.J0.GetDateDifference(e.J0.ParseDate(this.PstDocGrid.Table[m].FromDate_Key),e.J0.ParseDate(o)))return this.DisplayMessage="Enter correct from date at row no:"+(m+1),void(this.MessageVisibility=!0);if(e.J0.IsEmpty(this.PstDocGrid.Table[m].Amount)||(l+=parseFloat(this.PstDocGrid.Table[m].Amount.toString()),a++),e.J0.IsEmpty(this.PstDocGrid.Table[m].ActAmount)||(c+=parseFloat(this.PstDocGrid.Table[m].ActAmount.toString())),e.J0.IsEmpty(this.PstDocGrid.Table[m].Discount)||(r+=parseFloat(this.PstDocGrid.Table[m].Discount.toString())),e.J0.IsEmpty(this.PstDocGrid.Table[m].ToDate_Key)||(o=e.J0.ParseDate(this.PstDocGrid.Table[m].ToDate_Key.toString())),this.PstDocGrid.TableColumns.Contains("Distribute")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].FromDate_Key)&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].ToDate_Key)&&(""==e.J0.String(this.PstDocGrid.Table[m].Distribute)||parseInt(this.PstDocGrid.Table[m].Distribute.toString())<1))return this.DisplayMessage="Enter Distribute at row no:"+(m+1),void(this.MessageVisibility=!0)}if(a>0&&(null==s||s.toDateString()!=this.CompletionDate.Date.toDateString()))return this.DisplayMessage="Contract start date and first date does not match.",void(this.MessageVisibility=!0);if(a>0&&(null==o||o.toDateString()!=this.EndDate.Date.toDateString()))return this.DisplayMessage="Contract end date and last date does not match.",void(this.MessageVisibility=!0)}if((a>0&&(""==e.J0.String(this.selectedrow.Amount)||0==parseFloat(this.selectedrow.Amount.toString()))||this.PstDocGrid.TableColumns.Contains("ProposedAmount"))&&(this.selectedrow.Amount=l.ToString("N"+this.oparent.Mdeci),this.selectedrow.Discount=r.ToString("N"+this.oparent.Mdeci),this.selectedrow.ActAmount=c.ToString("N"+this.oparent.Mdeci),this.oparent.Reevaluate(!0),this.oparent.CalculateNRec()),a>0&&!e.J0.IsEmpty(this.selectedrow.Amount)&&parseFloat(this.selectedrow.Amount.toString()).ToString("N"+this.oparent.Mdeci)!=l.ToString("N"+this.oparent.Mdeci))return this.DisplayMessage="Amount mismatch",void(this.MessageVisibility=!0);let D="",y=0,P=0,b=0;if(a>0){if(D+="<XML",this.Filter.Visible&&(D+=' Filter="'+this.Filter.SelectedValue+'" '),D+=">",this.Filter.Visible&&"0"==this.Filter.SelectedValue)this.oparent.SelectedUnits.split(",").forEach(S=>{let p=this.PstDocGrid.Table.filter(T=>T.Unit_key==S,"FromDate_Key");D+='<UnitsRow Unit="'+S+'" Amount="##amt##" >';let w=0;for(let T=0;T<p.length;T++)if(!e.J0.IsEmpty(p[T].Amount)){D+="<Row ",D+='FromDate="'+e.J0.ParseDate(p[T].FromDate_Key).ToString("dd/MMM/yyyy")+'" ',D+='ToDate="'+e.J0.ParseDate(p[T].ToDate_Key).ToString("dd/MMM/yyyy")+'" ',D+='Unit="'+p[T].Unit_key.toString()+'" ',e.J0.IsEmpty(p[T].Period)||(D+='Period="'+p[T].Period.toString()+'" '),e.J0.IsEmpty(p[T].Rate)||(D+='Rate="'+p[T].Rate.toString()+'" '),this.PstDocGrid.TableColumns.Contains("MonthAmount")&&!e.J0.IsEmpty(p[T].MonthAmount)&&(D+='MonthAmount="'+p[T].MonthAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Distribute")&&!e.J0.IsEmpty(p[T].Distribute)&&(D+='Distribute="'+p[T].Distribute.toString()+'" '),e.J0.IsEmpty(p[T].Discount)||(D+='Discount="'+p[T].Discount.toString()+'" '),e.J0.IsEmpty(p[T].ActAmount)||(D+='ActAmount="'+p[T].ActAmount.toString()+'" '),e.J0.IsEmpty(p[T].Percent)||(D+='Percent="'+p[T].Percent.toString()+'" '),D+='Amount="'+p[T].Amount.toString()+'" ',this.PstDocGrid.TableColumns.Contains("BaseRent")&&!e.J0.IsEmpty(p[T].BaseRent)&&(D+='BaseRent="'+p[T].BaseRent.toString()+'" '),this.PstDocGrid.TableColumns.Contains("PrevRent")&&!e.J0.IsEmpty(p[T].PrevRent)&&(D+='PrevRent="'+p[T].PrevRent.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&!e.J0.IsEmpty(p[T].ProposedAmount)&&(D+='ProposedAmount="'+p[T].ProposedAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedDisc")&&!e.J0.IsEmpty(p[T].ProposedDisc)&&(D+='ProposedDisc="'+p[T].ProposedDisc.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedRent")&&!e.J0.IsEmpty(p[T].ProposedRent)&&(D+='ProposedRent="'+p[T].ProposedRent.toString()+'" ');for(let R=0;R<this.PstDocGrid.Columns.length;R++)this.PstDocGrid.Columns[R].DisplayMember.Contains("Fld")&&(D+=this.PstDocGrid.Columns[R].DisplayMember+'="'+e.J0.String(this.PstDocGrid.Table[T][this.PstDocGrid.Columns[R].DisplayMember])+'" ');this.PstDocGrid.TableColumns.Contains("ProposedDisc")&&!e.J0.IsEmpty(p[T].ProposedDisc)&&(P+=parseFloat(p[T].ProposedDisc.toString())),this.PstDocGrid.TableColumns.Contains("ProposedRent")&&!e.J0.IsEmpty(p[T].ProposedRent)&&(y+=parseFloat(p[T].ProposedRent.toString())),this.PstDocGrid.TableColumns.Contains("BaseRent")&&!e.J0.IsEmpty(p[T].BaseRent)&&(b+=parseFloat(p[T].BaseRent.toString())),D+='Narration="'+e.J0.String(p[T].Narration)+'"/>',w+=parseFloat(p[T].Amount.toString())}D=D.Replace("##amt##",w.toString()),D+="</UnitsRow>"});else for(let m=0;m<this.PstDocGrid.Table.length;m++)if(!e.J0.IsEmpty(this.PstDocGrid.Table[m].Amount)){D+="<Row ",(!this.Filter.Visible||this.PstDocGrid.Columns[1].IsVisible)&&(D+='FromDate="'+e.J0.ParseDate(this.PstDocGrid.Table[m].FromDate_Key).ToString("dd/MMM/yyyy")+'" ',D+='ToDate="'+e.J0.ParseDate(this.PstDocGrid.Table[m].ToDate_Key).ToString("dd/MMM/yyyy")+'" '),this.Filter.Visible&&this.PstDocGrid.Columns[3].IsVisible&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].Unit_key)&&(D+='Unit="'+this.PstDocGrid.Table[m].Unit_key.toString()+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[m].Period)||(D+='Period="'+this.PstDocGrid.Table[m].Period.toString()+'" '),e.J0.IsEmpty(this.PstDocGrid.Table[m].Rate)||(D+='Rate="'+this.PstDocGrid.Table[m].Rate.toString()+'" '),this.PstDocGrid.TableColumns.Contains("MonthAmount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].MonthAmount)&&(D+='MonthAmount="'+this.PstDocGrid.Table[m].MonthAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Distribute")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].Distribute)&&(D+='Distribute="'+this.PstDocGrid.Table[m].Distribute.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Discount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].Discount)&&(D+='Discount="'+this.PstDocGrid.Table[m].Discount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ActAmount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].ActAmount)&&(D+='ActAmount="'+this.PstDocGrid.Table[m].ActAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("Percent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].Percent)&&(D+='Percent="'+this.PstDocGrid.Table[m].Percent.toString()+'" '),this.PstDocGrid.TableColumns.Contains("BaseRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].BaseRent)&&(D+='BaseRent="'+this.PstDocGrid.Table[m].BaseRent.toString()+'" '),this.PstDocGrid.TableColumns.Contains("PrevRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].PrevRent)&&(D+='PrevRent="'+this.PstDocGrid.Table[m].PrevRent.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedAmount")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].ProposedAmount)&&(D+='ProposedAmount="'+this.PstDocGrid.Table[m].ProposedAmount.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedDisc")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].ProposedDisc)&&(D+='ProposedDisc="'+this.PstDocGrid.Table[m].ProposedDisc.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].ProposedRent)&&(D+='ProposedRent="'+this.PstDocGrid.Table[m].ProposedRent.toString()+'" '),this.PstDocGrid.TableColumns.Contains("ProposedDisc")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].ProposedDisc)&&(P+=parseFloat(this.PstDocGrid.Table[m].ProposedDisc.toString())),this.PstDocGrid.TableColumns.Contains("ProposedRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].ProposedRent)&&(y+=parseFloat(this.PstDocGrid.Table[m].ProposedRent.toString())),this.PstDocGrid.TableColumns.Contains("BaseRent")&&!e.J0.IsEmpty(this.PstDocGrid.Table[m].BaseRent)&&(b+=parseFloat(this.PstDocGrid.Table[m].BaseRent.toString()));for(let S=0;S<this.PstDocGrid.Columns.length;S++)this.PstDocGrid.Columns[S].DisplayMember.Contains("Fld")&&(D+=this.PstDocGrid.Columns[S].DisplayMember+'="'+e.J0.String(this.PstDocGrid.Table[m][this.PstDocGrid.Columns[S].DisplayMember])+'" ');D+='Amount="'+this.PstDocGrid.Table[m].Amount.toString()+'" ',D+='Narration="'+e.J0.String(this.PstDocGrid.Table[m].Narration)+'"/>'}D+="</XML>"}var t,h;if(this.selectedrow.Xml=D.toString(),this.PstDocGrid.TableColumns.Contains("ProposedAmount"))this.oparent.ProposedRent.Text=y.toString(),this.oparent.ProposedDisc.Text=P.toString(),(t=this.oparent.ScreenObject.Data.Tables[0].filter(S=>null!=S.LocalReference&&93==S.LocalReference&&25641==S.LinkData)).length>0&&null!=(h=this.oparent.ScreenObject.GetCustomField(t[0].SysColumnName.toString()))&&h instanceof M.Dw&&(h.Text=b.toString()),this.oparent.CalculateTextFields(this.oparent.ProposedDisc);return this.oparent.DataTableObj.updateRow(this.selectedrow),void u.d.page.HideDialog(this.PopUpGUID)}if(!(null!=this.CompletionDate.Date&&this.CompletionDate.Date&&this.PstDocGrid.Table.length>0))return this.PstDocGrid.Table.length>0?(this.DisplayMessage="can not save blank data ",void(this.MessageVisibility=!0)):(this.DisplayMessage="Select Completion Date",void(this.MessageVisibility=!0));{let a="";for(let s=0;s<this.PstDocGrid.Table.length;s++)!e.J0.IsEmpty(this.PstDocGrid.Table[s].select)&&(0,G.yG0)(this.PstDocGrid.Table[s].select.toString())&&(a+='<Row ID="'+this.PstDocGrid.Table[s].DocID.toString()+'" ',a+=' CostCenterID="'+this.PstDocGrid.Table[s].CostCenterID.toString()+'" ',a+=' VNO="'+this.PstDocGrid.Table[s].VNO.toString()+'" />');if(!(a.length>0))return this.DisplayMessage="Select data to save",void(this.MessageVisibility=!0);{a="<XML>"+a+"</XML>";let s=0,o=u.d.rental.SaveCompletionDate(a.toString(),this.CompletionDate.Date.Date(),this.Tower.SelectedValue);this.DisplayMessage=o.Message,s=o.RetValue,this.MessageVisibility=!0,s>0&&this.PstDocGrid.Clear()}}}else if("GenFirst"==i){if(null!=this.oparent&&null==this.selectedrow&&null!=this.Rows){if(e.J0.IsEmpty(this.Filter.SelectedValue))return this.DisplayMessage="Select Year",void(this.MessageVisibility=!0);if("ALL"==this.Filter.SelectedValue)this.oparent.GenerateContract();else{let a=null,s=null,o=0;a=e.J0.ParseDate(this.Filter.SelectedValue),e.J0.IsEmpty(this.Filter.SelectedItem.Parent)||(s=e.J0.ParseDate(this.Filter.SelectedItem.Parent)),this.Filter.SelectedItem.CurrID>0&&(o=parseInt(this.Filter.SelectedItem.CurrID.toString())),this.oparent.GenerateContract(a,s,o)}return void u.d.page.HideDialog(this.PopUpGUID)}}else"Search"==i?this.SearchGrid():"OK"==i?this.LoadData():"Close"==i?(this.DailogResult=!1,u.d.page.HideDialog(this.PopUpGUID)):"Selectionchanged"==i&&("0"==this.Filter.SelectedValue?(this.PstDocGrid.Columns[1].IsVisible=!0,this.PstDocGrid.Columns[2].IsVisible=!0,this.PstDocGrid.Columns[3].IsVisible=!0):"1"==this.Filter.SelectedValue?(this.PstDocGrid.Columns[1].IsVisible=!1,this.PstDocGrid.Columns[2].IsVisible=!1,this.PstDocGrid.Columns[3].IsVisible=!0):"2"==this.Filter.SelectedValue&&(this.PstDocGrid.Columns[1].IsVisible=!0,this.PstDocGrid.Columns[2].IsVisible=!0,this.PstDocGrid.Columns[3].IsVisible=!1),this.PstDocGrid.RefreshColumns(),this.LoadDefaultValues(),this.PstDocGrid.gridObj&&this.PstDocGrid.gridObj.onRendered.subscribe(a=>{this.CalculateTotals(null),this.PstDocGrid.UpdateFooter()}))}LoadDefaultValues(){if(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables.length>5&&this.oparent.dsPart.Tables[5].length>0){this.PstDocGrid.Clear();var i=this.oparent.dsPart.Tables[5].Compute("sum","RENT"),t=this.oparent.SelectedUnits.split(",");let h;if(h=e.J0.DoubleTryParse(this.oparent.TotalYears.Text),"0"==this.Filter.SelectedValue&&this.oparent.EndDate.Date>this.oparent.StartDate.Date.AddYears(1))for(let n=0;n<t.length;n++){let a=null;if(null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(a=this.oparent.dsPart.Tables[5].filter(s=>s.UnitID==t[n])),null!=a&&a.length>0){let s=parseFloat(this.selectedrow.Amount.toString())*parseFloat(a[0].RENT);null!=i&&parseFloat(i)>0&&(s/=parseFloat(i));let o=s/h;for(let l=0;l<h;l++){let r=this.PstDocGrid.NewRow();r.FromDate=this.oparent.StartDate.Date.AddYears(l).ToString(u.d.SessionManager.Preferences["Date Format"]),r.FromDate_Key=this.oparent.StartDate.Date.AddYears(l),l==h-1?(r.ToDate=this.oparent.EndDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),r.ToDate_Key=this.oparent.EndDate.Date):(r.ToDate=this.oparent.StartDate.Date.AddYears(l+1).AddDays(-1).ToString(u.d.SessionManager.Preferences["Date Format"]),r.ToDate_Key=this.oparent.StartDate.Date.AddYears(l+1).AddDays(-1)),r.Unit_key=a[0].UnitID.toString(),e.J0.IsEmpty(a[0].RENT)||(r.Amount=o.ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),r.Rate=(parseFloat(r.Amount)/parseFloat(a[0].RentableArea.toString())).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),r.Discount=0,r.ActAmount=r.Amount.toString(),r.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(r)}}}else if("1"==this.Filter.SelectedValue){let n=parseFloat(this.selectedrow.Amount.toString());if(n.ToString("N2")==parseFloat(i).ToString("N2"))for(let a=0;a<t.length;a++){let s=this.PstDocGrid.NewRow();s.FromDate=this.oparent.StartDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),s.FromDate_Key=this.oparent.StartDate.Date,s.ToDate=this.oparent.StartDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),s.ToDate_Key=this.oparent.StartDate.Date;let o=null;null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(o=this.oparent.dsPart.Tables[5].filter(l=>l.UnitID==t[a])),null!=o&&o.length>0&&(s.Unit_key=o[0].UnitID.toString(),e.J0.IsEmpty(o[0].RENT)||(s.Amount=parseFloat(o[0].RENT).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),s.Rate=(parseFloat(s.Amount)/parseFloat(o[0].RentableArea.toString())).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),s.Discount=0,s.ActAmount=s.Amount.toString()),s.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(s)}else for(let a=0;a<t.length;a++){let s=this.PstDocGrid.NewRow();s.FromDate=this.oparent.StartDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),s.FromDate_Key=this.oparent.StartDate.Date,s.ToDate=this.oparent.StartDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),s.ToDate_Key=this.oparent.StartDate.Date;let o=null;null!=this.oparent.dsPart&&this.oparent.dsPart.Tables[5].length>0&&(o=this.oparent.dsPart.Tables[5].filter(l=>l.UnitID==t[a])),null!=o&&o.length>0&&(s.Unit_key=o[0].UnitID.toString(),e.J0.IsEmpty(o[0].RENT)||(s.Amount=null!=i?(n*parseFloat(o[0].RENT)/parseFloat(i)).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()):(n*parseFloat(o[0].RENT)).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString()),s.Rate=(parseFloat(s.Amount)/parseFloat(o[0].RentableArea.toString())).ToString("N"+u.d.SessionManager.Preferences.DecimalsinAmount.toString())),s.Discount=0,s.ActAmount=s.Amount.toString()),s.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(s)}}else if("2"==this.Filter.SelectedValue)for(let n=0;n<h;n++){let a=this.PstDocGrid.NewRow();a.FromDate=this.oparent.StartDate.Date.AddYears(n).ToString(u.d.SessionManager.Preferences["Date Format"]),a.FromDate_Key=this.oparent.StartDate.Date.AddYears(n),n==h-1?(a.ToDate=this.oparent.EndDate.Date.ToString(u.d.SessionManager.Preferences["Date Format"]),a.ToDate_Key=this.oparent.EndDate.Date):(a.ToDate=this.oparent.StartDate.Date.AddYears(n+1).AddDays(-1).ToString(u.d.SessionManager.Preferences["Date Format"]),a.ToDate_Key=this.oparent.StartDate.Date.AddYears(n+1).AddDays(-1)),a.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(a)}this.PstDocGrid.Columns[3].IsVisible&&(this.PstDocGrid.RefreshGrid=!0);for(let n=0;n<5;n++){let a=this.PstDocGrid.NewRow();a.Sno=this.PstDocGrid.Table.length+1,this.PstDocGrid.addRow(a)}}}SearchGrid(){if(e.J0.IsEmpty(this.SearchText))return;let i="";if(""!=this.SearchCols.SelectedValue)i=this.SearchCols.SelectedValue;else{if(!(this.SearchCols.Items.length>0))return;i=this.SearchCols.Items[0].Value}if(!this.PstDocGridTableColumns.Contains(i))return;let t=this.PstDocGrid.SelectedIndex;-1==t&&(t=0);for(let h=0;h<this.PstDocGrid.Table.length;h++)if(t<this.PstDocGrid.Table.length-1?t++:t=0,!e.J0.IsEmpty(this.PstDocGrid.Table[t][i]))switch(this.Options.SelectedValue){case"1":if(this.PstDocGrid.Table[t][i].toString().toLowerCase()==this.SearchText.toLowerCase())return void this.Setselectedrow(t);break;case"2":if(this.PstDocGrid.Table[t][i].toString().toLowerCase()!=this.SearchText.toLowerCase())return void this.Setselectedrow(t);break;case"3":if(this.PstDocGrid.Table[t][i].toString().toLowerCase().startsWith(this.SearchText.toLowerCase()))return void this.Setselectedrow(t);break;case"4":if(this.PstDocGrid.Table[t][i].toString().toLowerCase().endsWith(this.SearchText.toLowerCase()))return void this.Setselectedrow(t);break;case"5":if(this.PstDocGrid.Table[t][i].toString().toLowerCase().Contains(this.SearchText.toLowerCase()))return void this.Setselectedrow(t);break;case"6":if(!this.PstDocGrid.Table[t][i].toString().toLowerCase().Contains(this.SearchText.toLowerCase()))return void this.Setselectedrow(t)}}Setselectedrow(i){this.PstDocGrid.SelectedItem=this.PstDocGrid.Table[i]}}}}]);