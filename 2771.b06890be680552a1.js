"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[2771],{67599:(W,x,y)=>{y.d(x,{c:()=>I});var o=y(96598);function d(_,B){if(1&_&&(o.j41(0,"div",6),o.EFF(1,"\n        "),o.nrm(2,"app-PactGridView",7),o.EFF(3,"  \n      "),o.k0s()),2&_){const F=o.XpG();o.R7$(2),o.Y8G("obj",F.obj.GridDataObj)("group",F.form)}}let I=(()=>{class _{constructor(){}ngOnInit(){}static{this.\u0275fac=function(K){return new(K||_)}}static{this.\u0275cmp=o.VBU({type:_,selectors:[["app-subsitute-products"]],inputs:{obj:"obj"},standalone:!1,decls:22,vars:9,consts:[[1,"master-screen",2,"padding-bottom","4px"],[1,"PACTHeaderFields","dialogSubBody"],["class","documentgrid row form-row","style","width: 100%;",4,"ngIf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"documentgrid","row","form-row",2,"width","100%"],[2,"width","100%",3,"obj","group"]],template:function(K,A){1&K&&(o.j41(0,"div",0),o.EFF(1,"\n    "),o.j41(2,"div",1),o.EFF(3,"\n      "),o.DNE(4,d,4,2,"div",2),o.EFF(5,"\n    "),o.k0s(),o.EFF(6,"\n    "),o.j41(7,"div",3),o.EFF(8,"\n      "),o.j41(9,"div"),o.EFF(10,"\n        "),o.j41(11,"button",4),o.bIt("click",function(){return A.obj.OnButtonClick("OK")}),o.EFF(12),o.nI1(13,"translate"),o.k0s(),o.EFF(14,"\n        "),o.j41(15,"button",5),o.bIt("click",function(){return A.obj.OnButtonClick("Cancel")}),o.EFF(16),o.nI1(17,"translate"),o.k0s(),o.EFF(18,"\n      "),o.k0s(),o.EFF(19,"\n  "),o.k0s(),o.EFF(20,"\n"),o.k0s(),o.EFF(21,"\n")),2&K&&(o.xc7("width",A.obj.IsMobile?"unset":"900px"),o.R7$(4),o.Y8G("ngIf",A.obj.AllProducstsVisibility),o.R7$(8),o.JRh(o.bMT(13,5,"Ok")),o.R7$(4),o.JRh(o.bMT(17,7,"Close")))},encapsulation:2})}}return _})()},75152:(W,x,y)=>{y.r(x),y.d(x,{PactListSearchViewModel:()=>P,ProductSearchCatalogViewModel:()=>N,ProductSearchField:()=>S});var o=y(74523),d=y(32040),I=y(43767),_=y(54581),B=y(98580),F=y(27730),K=y(82503),A=y(21774),Q=y(72247),a=y(23458),c=y(7321),h=y(84151),r=y(91767),l=y(67599),f=y(58170);class S extends f.MI{constructor(s,e,D,C,u,i,n,g,m,j="",t="",G=null){if(super(),this.IsColumnInuse=!1,this.OtherDimensions=null,this.OtherDimensionsTbl=null,this.IsEvaluated=!1,this.IsParentFilter=!1,this.OtherDimensionDisplayMember=null,this.IsColumnInuse=i,this.DataType=s,this.ColumnName=e,this.Header=D,this.Condition=new F.y$(0),this.FromValue=new h.Dw(0),this.CC=new a.y$(0),g.Contains("~")){let T=g.split("~");this.OtherDimensions=[],this.OtherDimensionsTbl=[];for(let b=0;b<T.length;b++)this.OtherDimensions.push(),this.OtherDimensionsTbl.push(),this.OtherDimensions[b]=parseInt(T[b])}else"PARENT"==g&&(this.IsParentFilter=!0);let L=I.J0.Int(C);if(L>0){if(this.CC.CCID=L,L=1,L=I.J0.Int(u),this.CC.TypeID=L,this.CC.Visible=!0,this.CC.Label=this.Header,n>0&&(this.CC.SelectedValue=n),3==this.CC.CCID&&0==this.CC.SelectedValue&&(this.CC.SelectedValue=-1),113==this.CC.CCID&&(this.CC.CustomWhere="CostCenterID="+m),this.Condition.Visible=!1,this.FromValue.Visible=!1,this.CC.DBColumnName=e,!I.J0.IsEmpty(j)&&"0"!=j.toString()){let T;parseInt(j)>5e4?(T=G.Tables[0].filter(b=>b.ColumnCostCenterID==j),null!=T&&T.length>0&&(this.CC.DependantOn=T[0].SysColumnName.toString())):2==parseInt(j)?this.CC.DependantOn="AccountID":3==parseInt(j)?this.CC.DependantOn="ProductID":83==parseInt(j)?this.CC.DependantOn="CustomerID":(T=G.Tables[0].filter(b=>b.ColumnCostCenterID==j),null!=T&&T.length>0&&(this.CC.DependantOn=T[0].SysColumnName.toString())),!I.J0.IsEmpty(t)&&"0"!=t.toString()&&(this.CC.Dependancy=parseInt(t.toString()))}}else this.CC.Visible=!1,this.Condition.Visible=!0,this.FromValue.Visible=!0,this.Condition.LblWidth="1",this.FromValue.LblWidth="1";this.LoadConditions(this.DataType)}LoadConditions(s){this.Condition.Items.Clear(),this.Condition.Items.push(F._p.ComboBoxItems_2(d.d.GetResource("Com_Equals"),"1")),this.Condition.Items.push(F._p.ComboBoxItems_2(d.d.GetResource("Com_NotEquals"),"2")),this.Condition.Items.push(F._p.ComboBoxItems_2(d.d.GetResource("Com_BeginsWith"),"3")),this.Condition.Items.push(F._p.ComboBoxItems_2(d.d.GetResource("Com_EndsWith"),"4")),this.Condition.Items.push(F._p.ComboBoxItems_2(d.d.GetResource("Com_Contains"),"5")),this.Condition.Items.push(F._p.ComboBoxItems_2(d.d.GetResource("Com_NotContains"),"6")),this.Condition.SelectedValue="5"}}class P{constructor(s){this.ToSearch=s}onClick(s){"AddNew"==s||("Cancel"==s||"click"==s)&&d.d.page.HideDialog(this.PopUpGUID)}}class N extends B.g{set setGridFocus(s){}set setFullTextSearch(s){}get FullTextSearch(){return this.FullTextSearchCtrl.Text}set FullTextSearch(s){this.FullTextSearchCtrl.Text=s}get GridData(){return this.GridDataObj.Table}get GridDataColumns(){return this.GridDataObj.TableColumns}get ColumnSource(){return this.GridDataObj.Columns}get SelectedRow(){return this.GridDataObj.SelectedItem}get SelectedIndex(){return this.GridDataObj.SelectedIndex}get SelectedGrid(){return this.SelectedGridObj.Table}get SelectedGridColumns(){return this.SelectedGridObj.TableColumns}get SelectedColumnSource(){return this.SelectedGridObj.Columns}get ProductsGridData(){return this.ProductsGridDataObj.Table}get ProductsGridDataColumns(){return this.ProductsGridDataObj.TableColumns}get ProductsColumnSource(){return this.ProductsGridDataObj.Columns}set ProductsColumnSource(s){this.ProductsGridDataObj.Columns=s}constructor(s,e,D,C,u){if(super(),this.ProductID=null,this.ProductName=null,this.Width=0,this.ProductCode=null,this.FullTextSearchCtrl=new h.Dw,this.GridDataObj=new c.vv,this.SelectedGridObj=new c.vv,this.ProductsGridDataObj=new c.vv,this.AllProducstsVisibility=!0,this.GridDataVisibility=!0,this.GrHeight=0,this.GrWidth=0,this.ReportVisibility=!1,this.IsDocument=!1,this.ReportsDialogVisibility=!1,this.SelectedItemsVisiblility=!0,this.Report=null,this.Options=new F.y$(0),this.Reports=new F.y$(0),this.ReportFromDate=new K.Lc(0),this.ReportToDate=new K.Lc(0),this.NextPrevious=!1,this.qtycc=[],this.Parent=null,this.GridViewID=0,this.CostCenterID=0,this.DisplayCOl=null,this.lstctrl=null,this.GridFilter="",this.sBarcodeWhere="",this.sFulltextSearchWhere="",this.ExtraSelect="",this.EnableBalanceQuantity=!1,this.lst=[],this.CostCenterID=D,this.GridViewID=e,this.DisplayCOl=C,this.lstctrl=u,this.Options.Label=d.d.GetResource("SearchType"),this.FullTextSearchCtrl.Label=d.d.GetResource("Tree_Fulltext"),this.Options.LblWidth="120",this.FullTextSearchCtrl.LblWidth="120",this.DisplayName=this.Title=d.d.GetResource("Search"),null!=s||null!=this.lstctrl?(this.Parent=s,this.IsDocument=!0,this.GrHeight=210):(this.IsDocument=!1,this.GrHeight=500),this.Options.Items.push(F._p.ComboBoxItems_2("All","3")),this.Options.Items.push(F._p.ComboBoxItems_2("Basic","0")),this.Options.Items.push(F._p.ComboBoxItems_2("Subtitutes","1")),this.Options.Items.push(F._p.ComboBoxItems_2("Linked","2")),this.Options.SelectedValue="3",3!=this.CostCenterID)this.NextPrevious=!0,this.Options.Visible=!1,this.SelectedItemsVisiblility=!1,null!=u&&(this.CostCenterID=u.CCID,this.GridViewID=u.GridViewID);else{null==s||"AddEditDocumentViewModel"!=s.ClassName||I.J0.IsEmpty(s.HoldProdSearch)?s instanceof Q.T&&(this.SelectedItemsVisiblility=!1):this.FullTextSearch=s.HoldProdSearch,this.setFullTextSearch=!1;let j=!1;d.d.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&I.J0.Int(d.d.SessionManager.Preferences["Maintain Dimensionwise stock"])>0&&this.qtycc.push(I.J0.Int(d.d.SessionManager.Preferences["Maintain Dimensionwise stock"])),d.d.SessionManager.Preferences.ContainsKey("Location Stock")&&(0,_.yG0)(d.d.SessionManager.Preferences["Location Stock"])&&this.qtycc.push(50002),j=!1,d.d.SessionManager.Preferences.ContainsKey("Division Stock")&&(0,_.yG0)(d.d.SessionManager.Preferences["Division Stock"])&&this.qtycc.push(50001)}this.ProductFields=[];let n,i=d.d.inventory.GetProductSearchFields(this.GridViewID);if(null!=i&&i.Tables.length>0&&!i.Columns[0].Contains("ErrorMessage")){for(let m=0;m<i.Tables[0].length;m++)if(i.Tables[0][m].SysColumnName=I.J0.String(i.Tables[0][m].SysColumnName),!i.Columns[0].Contains("columntype")||I.J0.IsEmpty(i.Tables[0][m].columntype)||"2"!=i.Tables[0][m].columntype.toString())if("Dropdown"!=i.Tables[0][m].description.toString()||""==i.Tables[0][m].costcentercolid.toString()||261!=parseInt(i.Tables[0][m].costcentercolid.toString())&&262!=parseInt(i.Tables[0][m].costcentercolid.toString())){let j=0;if("AddEditDocumentViewModel"==s.ClassName&&null!=s.SelectedRow&&i.Tables[0][m].SysColumnName.toString().startsWith("CCNID")&&s.SelectedRowColumns.Contains("dc"+i.Tables[0][m].SysColumnName.toString()+"_Key")&&!I.J0.IsEmpty(s.SelectedRow["dc"+i.Tables[0][m].SysColumnName.toString()+"_Key"])&&(j=parseInt(s.SelectedRow["dc"+i.Tables[0][m].SysColumnName.toString()+"_Key"])),""!=I.J0.String(i.Tables[0][m].costcentercolid)&&26428==I.J0.Double(i.Tables[0][m].costcentercolid)){this.EnableBalanceQuantity=!0;let t="";t=I.J0.String(i.Tables[0][m].Description),""==t||"Description"==I.J0.String(i.Tables[0][m].Description)?t=this.GetQuery("BalQty"):(t=t.Replace("QOH",this.GetQuery("QOH")),t=t.Replace("HOLDQTY",this.GetQuery("HOLDQTY")),t=t.Replace("RESERVEQTY",this.GetQuery("RESERVEQTY")),t=t.Replace("CommittedQty",this.GetQuery("CommittedQty")),t=t.Replace("BalQty",this.GetQuery("BalQty"))),this.ExtraSelect+=", "+t+" as BalQty"}else this.ProductFields.push(new S(I.J0.String(i.Tables[0][m].ColumnDataType),I.J0.String(i.Tables[0][m].SysColumnName),I.J0.String(i.Tables[0][m].ResourceData),I.J0.String(i.Tables[0][m].ColumnCostCenterID),I.J0.String(i.Tables[0][m].ColumnCCListViewTypeID),(0,_.yG0)(i.Tables[0][m].iscolumninuse),j,i.Tables[0][m].description.toString(),this.CostCenterID,i.Tables[0][m].dependanton,i.Tables[0][m].dependancy,i))}else 261==parseInt(i.Tables[0][m].costcentercolid.toString())?this.ProductFields.push(new S("ListBox",i.Tables[0][m].SysColumnName.toString(),i.Tables[0][m].Resourcedata.toString(),"3","100",(0,_.yG0)(i.Tables[0][m].iscolumninuse.toString()),0,i.Tables[0][m].description.toString(),this.CostCenterID,i.Tables[0][m].dependanton,i.Tables[0][m].dependancy,i)):262==parseInt(i.Tables[0][m].costcentercolid.toString())&&this.ProductFields.push(new S("ListBox",i.Tables[0][m].SysColumnName.toString(),i.Tables[0][m].Resourcedata.toString(),"3","10",(0,_.yG0)(i.Tables[0][m].iscolumninuse.toString()),0,i.Tables[0][m].description.toString(),this.CostCenterID,i.Tables[0][m].dependanton,i.Tables[0][m].dependancy,i));for(let m=0;m<this.ProductFields.length;m++)this.ProductFields[m].CC.CCID>0&&this.ProductFields[m].CC.OnPactListBoxValueChanged.Subscribe(this,"FilterDependencies")}if(n=new A.O7,n.Header="#",n.DisplayMember="Sno",n.DataType="TextBlock",n.Width=24,n.IsVisible=!0,n.ReadOnly=!0,n.IsFrozen=!0,this.ColumnSource.push(n),3==this.CostCenterID&&(n=new A.O7,n.Header="#",n.DisplayMember="Sno",n.DataType="TextBlock",n.Width=24,n.ReadOnly=!0,this.SelectedColumnSource.push(n)),null==i||i.Tables.length>0&&i.Columns[0].Contains("ErrorMessage"))return i.Tables[0].length>0&&(this.DisplayMessage=i.Tables[0][0].ErrorMessage.toString()),void(this.MessageVisibility=!0);this.Width=null!=this.Parent&&null!=i&&i.Tables.length>1&&!i.Columns[1].Contains("ErrorMessage")&&i.Tables[1].length>0&&!I.J0.IsEmpty(i.Tables[1][0].ColumnWidth)?parseInt(i.Tables[1][0].ColumnWidth):1e3,null!=i&&i.Tables.length>1&&i.Columns[1].Contains("Filter")&&i.Tables[1].length>0&&(this.GridFilter=i.Tables[1][0].Filter.toString(),this.GridFilter=this.GridFilter.replace("CC.","C.").replace("a.","P."));let g=i.Tables[0].filter(m=>2==m.columntype);if(g.Sort="columnorder",g.forEach(m=>{n=new A.O7,n.Header=m.ResourceData.toString(),n.DisplayMember=m.SysColumnName.toString(),n.DataType="TextBlock",n.ReadOnly=!0,n.Width=I.J0.IsEmpty(m.ColumnWidth)?120:parseInt(m.ColumnWidth),this.ColumnSource.push(n),this.GridDataColumns.Contains(m.SysColumnName.toString())||(this.GridDataColumns.push(m.SysColumnName.toString()),3==this.CostCenterID&&(this.SelectedGridColumns.push(m.SysColumnName.toString()),this.SelectedColumnSource.push(n)))}),3==this.CostCenterID){n=new A.O7,n.Header="Total QOH",n.DisplayMember="QTYonHand",n.DataType="LINK",n.Width=80,n.Click.Subscribe(this,"onQtyClick"),d.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=d.d.SessionManager.Preferences.DecimalsinQty&&(n.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinQty),this.ColumnSource.push(n),this.EnableBalanceQuantity&&(n=new A.O7,n.Header="Bal Qty",n.DisplayMember="BalQty",n.DataType="TextBlock",n.Width=80,n.IsVisible=!0,n.ReadOnly=!0,this.ColumnSource.push(n),this.GridDataColumns.push("BalQty"));for(let m=0;m<this.ProductFields.length;m++)null!=this.ProductFields[m].OtherDimensions&&(n=new A.O7,n.Header=this.ProductFields[m].Header,this.ProductFields[m].OtherDimensionDisplayMember="DIMNAME_"+this.ProductFields[m].OtherDimensions[this.ProductFields[m].OtherDimensions.length-1].toString().replace("-","N"),n.DisplayMember=this.ProductFields[m].OtherDimensionDisplayMember,n.DataType="TextBlock",n.ReadOnly=!0,n.Width=90,this.ColumnSource.push(n),this.GridDataColumns.Contains(n.DisplayMember)||(this.GridDataColumns.push(n.DisplayMember),this.SelectedGridColumns.push(n.DisplayMember),this.SelectedColumnSource.push(n)))}if(n=new A.O7,n.Header=this.Parent instanceof Q.T?"Select":"Add",n.DisplayMember="Add",n.DataType="LINK",n.Width=60,n.IsVisible=!0,n.ReadOnly=!0,n.Click.Subscribe(this,"onClick"),this.ColumnSource.push(n),3==this.CostCenterID){let m=d.d.report.GetQueryDefnScreenDetails(5,98,0);null!=m&&m.Tables.length>0&&(this.ReportFromDate.Date=d.d.SessionManager.ReportsFromDate,this.ReportToDate.Date=Date.Today(),m.Tables[0].forEach(j=>{this.Reports.Items.push(F._p.ComboBoxItems_2(j.ReportName.toString(),j.ReportID.toString()))}),this.Reports.Items.length>0&&(this.Reports.SelectedItem=this.Reports.Items[0],this.Reports.SelectedValue=this.Reports.Items[0].Value,n=new A.O7,n.Header="Analysis",n.DisplayMember="Analysis",n.DataType="LINK",n.Width=60,n.IsVisible=!1,n.ReadOnly=!0,n.Click.Subscribe(this,"onViewClick"),this.ColumnSource.push(n))),null!=s&&"AddEditDocumentViewModel"==s.ClassName&&s.ScreenObject.Preferences.ContainsKey("EnableSubtitutes")&&""!=s.ScreenObject.Preferences.EnableSubtitutes.toString()&&(0,_.yG0)(s.ScreenObject.Preferences.EnableSubtitutes)&&(n=new A.O7,n.Header="Subtitutes",n.DisplayMember="Subtitutes",n.DataType="LINK",n.Width=80,n.IsVisible=!0,n.ReadOnly=!0,n.Click.Subscribe(this,"onSubtitutesClick"),this.ColumnSource.push(n)),n=new A.O7,n.Header="Quantity",n.DisplayMember="QTY",n.DataType="FLOAT",n.Width=75,d.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=d.d.SessionManager.Preferences.DecimalsinQty&&(n.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinQty),this.SelectedColumnSource.push(n),this.SelectedGridColumns.push("Sno"),this.SelectedGridColumns.push("ProductName_Key"),this.SelectedGridColumns.push("QTY")}this.GridDataColumns.push("Sno"),this.GridDataColumns.push("ProductName_Key"),this.GridDataColumns.push("QTYonHand"),this.GridDataColumns.push("Add"),this.GridDataColumns.push("Analysis"),this.GridDataColumns.push("Subtitutes"),this.setFullTextSearch=!0,this.GridDataObj.SearchVisible=!0}FilterDependencies(s){if(s instanceof a.y$){let D=s;this.ProductFields.filter(C=>null!=C.CC.DependantOn&&C.CC.DependantOn.toLowerCase()==D.DBColumnName.toLowerCase()).forEach(C=>{if(C.CC instanceof a.y$){let u="",i=0;C.CC instanceof a.y$&&(i=C.CC.CCID),i>5e4&&(C.CC instanceof a.y$&&!I.J0.IsEmpty(C.CC.ToolTipTitle)&&2==D.CCID?u=C.CC.ToolTipTitle+"="+D.SelectedValue.toString():C.CC instanceof a.y$&&C.CC.Dependantinuse?(u="("+D.DBColumnName.replace("dc","")+"="+D.SelectedValue.toString(),C.CC instanceof a.y$&&1==C.CC.Dependancy&&(u+=" OR "+D.DBColumnName.replace("dc","")+"=1 "),u+=")"):u=C.CC instanceof a.y$&&5==C.CC.Dependancy?"  JOIN "+this.GetTableName(i)+" CMJ with(nolock) ON a.lft between  CMJ.lft and CMJ.rgt JOIN COM_CostCenterCostCenterMap CM on CM.CostCenterID="+i+" and CM.ParentCostCenterID="+D.CCID+" and CM.ParentNodeID="+D.SelectedValue.toString()+" and CMJ.NodeID=CM.NodeID ":"  JOIN COM_CostCenterCostCenterMap CM with(nolock) on CM.ParentCostCenterID="+i+" and a.NodeID=CM.ParentNodeID \n                                JOIN "+this.GetTableName(D.CCID)+" CMJ with(nolock) ON CM.CostCenterID= "+D.CCID+"   and CM.NodeID=CMJ."+this.GetPrimaryKey(D.CCID)+" \n                                JOIN "+this.GetTableName(D.CCID)+" CMJG with(nolock) ON CMJG.lft between  CMJ.lft and CMJ.rgt and CMJG."+this.GetPrimaryKey(D.CCID)+" ="+D.SelectedValue),C.CC instanceof a.y$&&(C.CC.CustomWhere=u)}})}}GetPrimaryKey(s){return 2==s?"AccountID":3==s?"ProductID":"NodeID"}onSetFocusonGrid(s){this.setGridFocus=!0}onSetFocusonSearch(s){this.setFullTextSearch=!0}onSubtitutesClick(){if(this.DisplayMessage="",null!=this.SelectedRow){this.GridDataObj.TableColumns.Contains("ProductCode")&&(this.ProductCode=this.SelectedRow.ProductCode.toString()),this.GridDataObj.TableColumns.Contains("ProductName")&&(this.ProductName=this.SelectedRow.ProductName.toString()),this.ProductID=this.SelectedRow.ProductName_Key.toString();let s=null;if(s=this.Parent.ScreenObject.GetSubtituteProducts(parseInt(this.ProductID),this.Parent.DocumentDate,"0",this.Parent.SelectedRow?this.Parent.SelectedRow:null),s.Tables.length>0&&!s.Columns[0].Contains("ErrorMessage")&&s.Tables[0].length>0){let e=new r.j(this.Parent,s.Tables[0],s.Columns[0],s.Tables[1],this.ProductName,this.ProductCode,this.ProductID.toString());e.ColumnSource[0].IsVisible=!1,e.GridData.length>0&&d.d.page.ShowDialog(e,l.c)}}}onViewClick(){this.DisplayMessage="",null!=this.SelectedRow?(this.GridDataObj.TableColumns.Contains("ProductCode")&&(this.ProductCode=this.SelectedRow.ProductCode.toString()),this.GridDataObj.TableColumns.Contains("ProductName")&&(this.ProductName=this.SelectedRow.ProductName.toString()),this.ProductID=this.SelectedRow.ProductName_Key.toString(),this.ReportVisibility=!1,this.ReportsDialogVisibility=!0,this.SelectedItemsVisiblility=!1):this.DisplayMessage="Please Select Row"}onQtyClick(){if(null!=this.SelectedRow){this.GridDataObj.TableColumns.Contains("ProductCode")&&(this.ProductCode=this.SelectedRow.ProductCode.toString()),this.GridDataObj.TableColumns.Contains("ProductName")&&(this.ProductName=this.SelectedRow.ProductName.toString()),this.ProductID=this.SelectedRow.ProductName_Key.toString();let s=Date.Today();null!=this.Parent&&"AddEditDocumentViewModel"==this.Parent.ClassName&&(s=this.Parent.DocumentDate);let e=d.d.inventory.GetProductQOH(this.ProductID,s,"");if(null!=e&&e.Tables.length>0&&e.Columns[0].Contains("QOH")){this.ProductsGridData.Clear();let D=[];for(let C=0;C<e.Columns[0].length;C++){if("QOH"==e.Columns[0][C]){let u=new A.O7;u.Header="QOH",u.DisplayMember="QOH",u.DataType="FLOAT",u.Width=75,d.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=d.d.SessionManager.Preferences.DecimalsinQty&&(u.DecimalPoints=d.d.SessionManager.Preferences.DecimalsinQty),this.ProductsGridDataColumns.push("QOH"),D.push(u);break}{this.ProductsGridDataColumns.push(e.Columns[0][C+1]);let u=new A.O7;u.Header=e.Columns[0][C],u.DisplayMember=e.Columns[0][C+1],u.DataType="TextBlock",u.Width=150,D.push(u),C++}}this.ProductsColumnSource=D;for(let C=0;C<e.Tables[0].length;C++){let u=this.ProductsGridDataObj.NewRow();for(let i=0;i<e.Columns[0].length;i++){if("QOH"==e.Columns[0][i]){u.QOH=e.Tables[0][C].QOH.toString();break}u[e.Columns[0][i+1]]=e.Tables[0][C][e.Columns[0][i]].toString(),i++}this.ProductsGridDataObj.addRow(u)}}this.AllProducstsVisibility=!1,this.GridDataVisibility=!0}}onClick(){if(null!=this.lstctrl||null!=this.DisplayCOl&&3!=this.DisplayCOl.CostCenterID)this.AddData();else if(this.Parent instanceof Q.T)this.SelectTreeNode();else if(null!=this.Parent&&null!=this.SelectedRow){if("AddEditDocumentViewModel"==this.Parent.ClassName&&!I.J0.IsEmpty(this.SelectedRow.ProductName_Key)&&parseInt(this.SelectedRow.ProductName_Key)!=this.Parent.ScreenObject.TempProductID&&this.Parent.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=this.Parent.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&(0,_.yG0)(this.Parent.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)){let e=this.SelectedGrid.filter(D=>D.ProductName_Key==this.SelectedRow.ProductName_Key);if(e.length>0){let D=I.J0.Double(e[0].QTY);return void(e[0].QTY=D+1)}}let s=this.SelectedGridObj.NewRow();s.Sno=(this.SelectedGrid.length+1).toString();for(let e=0;e<this.SelectedGridColumns.length;e++)"Sno"==this.SelectedGridColumns[e]||"ProductName_Key"==this.SelectedGridColumns[e]||"QTY"==this.SelectedGridColumns[e]||(s[this.SelectedGridColumns[e]]=this.SelectedRow[this.SelectedGridColumns[e]]);s.ProductName_Key=this.SelectedRow.ProductName_Key,s.QTY=1,this.GridDataColumns.Contains("BUom")&&(this.SelectedGridColumns.Contains("BUom")||this.SelectedGridColumns.push("BUom"),s.BUom=this.SelectedRow.BUom),this.SelectedGridObj.addRow(s)}}AddData(){if(null!=this.SelectedRow&&!I.J0.IsEmpty(this.SelectedRow.ProductName_Key)){if(null!=this.lstctrl){if(this.lstctrl.SelectedValue=parseInt(this.SelectedRow.ProductName_Key),d.d.SessionManager.Preferences.ContainsKey("DisableAutoLoad")&&"true"==d.d.SessionManager.Preferences.DisableAutoLoad.toLowerCase()){var s=this.ColumnSource.find(e=>"name"==e.DisplayMember.toLowerCase());2==this.CostCenterID&&(s=this.ColumnSource.find(e=>"accountname"==e.DisplayMember.toLowerCase())),s&&(this.lstctrl.SelectedValueText=this.SelectedRow[s.DisplayMember].toString())}}else if(null!=this.DisplayCOl&&"AddEditDocumentViewModel"==this.Parent.ClassName)if(38!=this.Parent.ScreenObject.DocumentType&&39!=this.Parent.ScreenObject.DocumentType||!d.d.SessionManager.Preferences.ContainsKey("POSItemCodeDimension")||d.d.SessionManager.Preferences.POSItemCodeDimension!=this.CostCenterID.toString())null!=this.Parent.SelectedRow&&(s=this.ColumnSource.find(D=>"name"==D.DisplayMember.toLowerCase()),2==this.CostCenterID&&(s=this.ColumnSource.find(D=>"accountname"==D.DisplayMember.toLowerCase())),s&&this.Parent.SelectedRowColumns.Contains(this.DisplayCOl.DisplayMember)&&(this.Parent.SelectedRow[this.DisplayCOl.DisplayMember]=this.SelectedRow[s.DisplayMember].toString()),this.Parent.SelectedRowColumns.Contains(this.DisplayCOl.ValueMember)&&(this.Parent.SelectedRow[this.DisplayCOl.ValueMember]=this.SelectedRow.ProductName_Key.toString()));else{let e=this.Parent.GetEmptyRowPosition(this.Parent.ScreenObject.GridDataObj,"ProductID_Key"),D=this.Parent.ScreenObject.GridData[e];D[this.DisplayCOl.ValueMember]=this.SelectedRow.ProductName_Key.toString(),(s=this.ColumnSource.find(u=>"code"==u.DisplayMember.toLowerCase()))&&this.Parent.AddProductData(D,!1,!1,!1,null,this.SelectedRow[s.DisplayMember].toString())}d.d.page.HideDialog(this.PopUpGUID)}}GetLocations(s){let e=s.toString();if(null!=d.d.SessionManager.Locations){let D=s;for(;D>0;){let C=d.d.SessionManager.Locations.filter(u=>u.NodeID==D.toString());null!=C&&C.length>0&&!I.J0.IsEmpty(C[0].parentid)&&parseInt(C[0].parentid.toString())>0?(D=parseInt(C[0].parentid.toString()),C=d.d.SessionManager.Locations.filter(u=>u.NodeID==D.toString()),C.length>0&&!I.J0.IsEmpty(C[0].IsGroup)&&(0,_.yG0)(C[0].IsGroup.toString())?e+=","+D.toString():D=0):D=0}}return e}onSave(s){var e=this;return(0,o.A)(function*(){if("Clear"==s){e.GridDataObj.Clear();for(let C=0;C<e.ProductFields.length;C++)e.ProductFields[C].CC.Visible?e.ProductFields[C].CC.SelectedValue=0:e.ProductFields[C].FromValue.Text=""}else if("Add"==s||"DblClick"==s){if(null!=e.lstctrl||null!=e.DisplayCOl&&3!=e.DisplayCOl.CostCenterID)return void e.AddData();if(e.Parent instanceof Q.T)return void e.SelectTreeNode();if(null!=e.SelectedRow&&null!=e.Parent){if("AddEditDocumentViewModel"==e.Parent.ClassName&&!I.J0.IsEmpty(e.SelectedRow.ProductName_Key)&&parseInt(e.SelectedRow.ProductName_Key)!=e.Parent.ScreenObject.TempProductID&&e.Parent.ScreenObject.Preferences.ContainsKey("DuplicateProduct_IncrementQuantity")&&""!=e.Parent.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity&&(0,_.yG0)(e.Parent.ScreenObject.Preferences.DuplicateProduct_IncrementQuantity)){let u=e.SelectedGrid.filter(i=>i.ProductName_Key==e.SelectedRow.ProductName_Key);if(u.length>0){let i=I.J0.Double(u[0].QTY);return void(u[0].QTY=i+1)}}let C=e.SelectedGridObj.NewRow();C.Sno=(e.SelectedGrid.length+1).toString();for(let u=0;u<e.SelectedGridColumns.length;u++)"Sno"==e.SelectedGridColumns[u]||"ProductName_Key"==e.SelectedGridColumns[u]||"QTY"==e.SelectedGridColumns[u]||(C[e.SelectedGridColumns[u]]=e.SelectedRow[e.SelectedGridColumns[u]]);C.ProductName_Key=e.SelectedRow.ProductName_Key,C.QTY=1,e.GridDataColumns.Contains("BUom")&&(e.SelectedGridColumns.Contains("BUom")||e.SelectedGridColumns.push("BUom"),C.BUom=e.SelectedRow.BUom),e.SelectedGridObj.addRow(C),"DblClick"==s&&e.onSave("OK")}e.AllProducstsVisibility=!0,e.ReportsDialogVisibility=!1,e.GridDataVisibility=!0}else if("ViewReport"==s){const{ReportViewModel:C}=yield Promise.all([y.e(9891),y.e(534),y.e(1755),y.e(3884),y.e(7030),y.e(5984),y.e(5152),y.e(8405),y.e(895),y.e(5819),y.e(6015),y.e(2963),y.e(108),y.e(2290),y.e(8024),y.e(3364),y.e(9284),y.e(9128),y.e(1938),y.e(2726),y.e(4065),y.e(2014),y.e(2209),y.e(6084),y.e(4882),y.e(4119),y.e(2076)]).then(y.bind(y,39026));let u=new C;u.ReportViewModel_Document(98,"<XML><Row ColID='3' Value='"+e.ProductID+"'/></XML>",parseInt(e.Reports.SelectedValue),!1,null,null),null!=u.oReportDialog&&(u.oReportDialog.FromDate=e.ReportFromDate,u.oReportDialog.ToDate=e.ReportToDate),u.ShowHeaderButtons=!1,u.SearchVisibility=!1,e.Report=u,e.ReportVisibility=!0}else if("back"==s)e.AllProducstsVisibility=!0,e.GridDataVisibility=!0,e.ReportsDialogVisibility=!1,e.SelectedItemsVisiblility=!0;else if("Cancel"==s){if(null!=e.lstctrl||null!=e.DisplayCOl&&3!=e.DisplayCOl.CostCenterID)return void d.d.page.HideDialog(e.PopUpGUID);if(null==e.Parent)return;null!=e.FullTextSearch&&"AddEditDocumentViewModel"==e.Parent.ClassName&&(e.Parent.HoldProdSearch=e.FullTextSearch.toString()),d.d.page.HideDialog(e.PopUpGUID)}else if("Filter"==s||"Next"==s||"Previous"==s){e.AllProducstsVisibility=!0,e.ReportsDialogVisibility=!1,e.GridDataVisibility=!0;let C,u,i,n,g,m,j={},t=e.GetQuery(j);C=j.qtywhere,u=j.fulltext,i=j.join,n=j.OtherDimSelect,g=j.LocWhere,m=j.UOMSelect,u.length>3&&(u=u.Remove(0,3),""!=e.sFulltextSearchWhere&&(u=u+" "+e.sFulltextSearchWhere)),""!=e.GridFilter.Trim()?t.length>0?t+=" and "+e.GridFilter:t=e.GridFilter:t.length>0?t+=" and P.Isgroup=0":t=" P.Isgroup=0";let G=!1;if("Next"==s||"Previous"==s&&e.GridData.length>0){var D=e.ColumnSource.find(b=>"code"==b.DisplayMember.toLowerCase());2==e.CostCenterID&&(D=e.ColumnSource.find(b=>"accountcode"==b.DisplayMember.toLowerCase())),D||(D=e.ColumnSource.find(2==e.CostCenterID?b=>"accountname"==b.DisplayMember.toLowerCase():b=>"name"==b.DisplayMember.toLowerCase())),D&&e.GridData.length>0&&("Next"==s?t+=" and "+D.DisplayMember+">'"+e.GridData[e.GridData.length-1][D.DisplayMember]+"'":(t+=" and "+D.DisplayMember+"<'"+e.GridData[0][D.DisplayMember]+"'",G=!0))}let L=Date.Today();"AddEditDocumentViewModel"==e.Parent.ClassName&&(L=e.Parent.DocumentDate),""!=e.sBarcodeWhere&&(t=t+" "+e.sBarcodeWhere);let T=d.d.inventory.SearchProductCatalog(e.GridViewID,t,C,L,e.Options.Visible?e.Options.SelectedValue:"0",u,i,n,g,m,G,e.ExtraSelect);if(null!=e.GridData&&(e.GridDataColumns.Contains("Avg Rate")||e.GridDataColumns.Contains("AvgRate"))&&"AddEditDocumentViewModel"==e.Parent.ClassName&&null!=T&&T.Tables.length>0&&!T.Columns[0].Contains("ErrorMessage")){let b,O=new Array;d.d.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise AverageRate")&&I.J0.Int(d.d.SessionManager.Preferences["Maintain Dimensionwise AverageRate"])>5e4&&O.push(parseInt(b)),d.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&(0,_.yG0)(d.d.SessionManager.Preferences.EnableLocationWise)&&d.d.SessionManager.Preferences.ContainsKey("Location AverageRate")&&(0,_.yG0)(d.d.SessionManager.Preferences["Location AverageRate"])&&O.push(50002),d.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&(0,_.yG0)(d.d.SessionManager.Preferences.EnableDivisionWise)&&d.d.SessionManager.Preferences.ContainsKey("Division AverageRate")&&(0,_.yG0)(d.d.SessionManager.Preferences["Division AverageRate"])&&O.push(50001);let p="";for(let R=0;R<e.Parent.ScreenObject._CCFields.length;R++){const v=e.Parent.ScreenObject._CCFields[R];v instanceof a.y$&&v.DBColumnName.Contains("TO")&&5==e.Parent.ScreenObject.DocumentType||v instanceof a.y$&&v.SelectedValue>0&&O.Contains(v.CCID)&&(p+=" and dcCCNID"+(v.CCID-5e4).toString()+"="+v.SelectedValue.toString()+" ")}e.Parent.ScreenObject.ColumnSource.forEach(R=>{R.CostCenterID>5e4&&O.Contains(R.CostCenterID)&&e.Parent.ScreenObject.GridData.Columns.Contains(R.ValueMember)&&!I.J0.IsEmpty(e.Parent.ScreenObject.GridData[e.Parent.ScreenObject.SelectedGridRowIndex][R.ValueMember])&&(p+=" and dcCCNID"+(R.CostCenterID-5e4).toString()+"="+e.Parent.ScreenObject.GridData[e.Parent.ScreenObject.SelectedGridRowIndex][R.ValueMember].toString()+"  ")});let E="";E+="<PXML>";for(let R=0;R<T.Tables[0].length;R++)E+="<Row ",E+=' ProductID="'+T.Tables[0][R].productid.toString()+'" ',E+=' QTY="1" ',E+=' DETAILSID="0" ',E+=' avgwhere="'+p+'" ></Row> ';E+="</PXML>";let V=e.Parent.ScreenObject.GetReconcileAvgRate(E.toString(),L);if(null!=V&&V.Tables.length>0&&!V.Columns[0].Contains("ErrorMessage")){let R="";if(e.GridDataColumns.Contains("Avg Rate")?R="Avg Rate":e.GridDataColumns.Contains("Avg Rate")&&(R="AvgRate"),""!=R){T.Columns[0].push(R);for(let v=0;v<T.Tables[0].length;v++)T.Tables[0][v][R]=V.Tables[0][v].AvgRate.toString()}}}if(null!=T&&T.Tables.length>0&&!T.Columns[0].Contains("ErrorMessage")){if(("Next"==s||"Previous"==s)&&0==T.Tables[0].length)return;e.GridDataObj.Clear();for(let b=0;b<T.Tables[0].length;b++){let M=e.GridDataObj.NewRow();M.Sno=(b+1).toString(),M.ProductName_Key=T.Tables[0][b].productid;for(let O=0;O<e.GridDataColumns.length;O++)"Sno"==e.GridDataColumns[O]||"ProductName_Key"==e.GridDataColumns[O]||"QTY"==e.GridDataColumns[O]||("productid"==e.GridDataColumns[O].toLowerCase()&&e.CostCenterID.toString()==d.d.SessionManager.Preferences.POSItemCodeDimension?M.Productid=T.Tables[0][b].ProductName:T.Columns[0].Contains(e.GridDataColumns[O])&&(M[e.GridDataColumns[O]]=T.Tables[0][b][e.GridDataColumns[O]]));T.Columns[0].Contains("onHand")&&(M.QTYonHand=T.Tables[0][b].onHand),T.Columns[0].Contains("BUom")&&(e.GridDataColumns.Contains("BUom")||e.GridDataColumns.push("BUom"),M.BUom=T.Tables[0][b].BUom),M.Add=e.Parent instanceof Q.T?"Select":"Add",M.Analysis="View",M.Subtitutes="Subtitutes",G&&e.GridData.length>0?e.GridDataObj.insertRowAt(M,0):e.GridDataObj.addRow(M)}if(G)for(let b=0;b<e.GridData.length;b++)e.GridData[b].Sno=(b+1).toString();if(T.Tables.length>1){e.lst.Clear();let b="",M=e.GridData.length;for(let O=0;O<T.Tables[0].length;O++){let p=T.Tables[0][O];if(b=p.ParentID.toString(),0==e.lst.filter(E=>E.Name==b).length){let E=T.Tables[1].filter(V=>V.ProductID==p.ParentID);if(e.lst.push(F._p.ComboBoxItems_1(b)),E.length>0){let V=e.GridDataObj.NewRow();V.Sno=(M+1).toString(),V.ProductName_Key=p.ParentID;for(let R=0;R<e.SelectedGridColumns.length;R++)"Sno"==e.SelectedGridColumns[R]||"ProductName_Key"==e.SelectedGridColumns[R]||"QTY"==e.SelectedGridColumns[R]||T.Columns[1].Contains(e.SelectedGridColumns[R])&&(V[e.SelectedGridColumns[R]]=E[0][e.SelectedGridColumns[R]]);V.Add="",V.Analysis="View",V.Subtitutes="Subtitutes",e.GridDataObj.addRow(V),M+=1}}}}}}else if("OK"==s){if(null!=e.lstctrl||null!=e.DisplayCOl&&3!=e.DisplayCOl.CostCenterID)return void e.AddData();if(e.Parent instanceof Q.T)return void e.SelectTreeNode();if(null==e.Parent)return;if(null!=e.FullTextSearch&&(e.Parent.HoldProdSearch=e.FullTextSearch.toString()),d.d.page.HideDialog(e.PopUpGUID),"AddEditDocumentViewModel"==e.Parent.ClassName){let u,C=0;null!=e.Parent.SelectedRow&&(C=e.Parent.ScreenObject.GridData.indexOf(e.Parent.SelectedRow));for(let i=0;i<e.SelectedGrid.length;i++)null!=e.Parent.SelectedRow&&i==e.SelectedGrid.length-1?u=e.Parent.SelectedRow:(u=e.Parent.ScreenObject.GridDataObj.NewRow(),e.Parent.ScreenObject.GridDataObj.insertRowAt(u,C+i)),u.ProductID_Key=e.SelectedGrid[i].ProductName_Key.toString(),u.ProductID_Key=e.SelectedGrid[i].ProductName_Key.toString(),u.ProductID_Key=e.SelectedGrid[i].ProductName_Key.toString(),u.Quantity=I.J0.IsEmpty(e.SelectedGrid[i].QTY)?1:e.SelectedGrid[i].QTY,e.SelectedGridColumns.Contains("BUom")&&""!=e.SelectedGrid[i].BUom.toString()&&(u.Unit_Key=e.SelectedGrid[i].BUom),e.Parent.AddProductData(u,!1,!0),I.J0.IsNum(u.UOMConversion)&&(u.UOMConvertedQty=I.J0.Double(u.UOMConversion)*parseFloat(u.Quantity)),e.Parent.CalculateTotals(u,!1);e.Parent.ScreenObject.UpdateSequence(),e.Parent.RefreshGrid=!e.Parent.RefreshGrid}else if(null!=e.Parent&&"LeadsProductViewModel"==e.Parent.ClassName)for(let C=0;C<e.SelectedGrid.length;C++)I.J0.IsEmpty(e.SelectedGrid[C].ProductName_Key)||e.Parent.AddProductToGrid(parseInt(e.SelectedGrid[C].ProductName_Key))}})()}onTxtChanged(){}OnTimerTick(s,e){this.FullTextSearch.length>3&&this.onSave("Filter"),this._timer.Stop(),this._timer=null}GetTableName(s){let e="";return e=50001==s?" COM_Division":50002==s?" COM_Location":50003==s?" COM_Branch":50004==s?" COM_Department":50005==s?" COM_Salesman":50006==s?" COM_Category":50007==s?" COM_Area":50008==s?" COM_Teritory":" COM_CC"+s,e}GetQuery(s){s.UOMSelect=s.qtywhere="",s.fulltext="",s.join="",s.OtherDimSelect="",s.LocWhere="";let e="";this.sBarcodeWhere="",this.sFulltextSearchWhere="";let n,u="",i="",g=!1,m=[];for(let t=0;t<this.ProductFields.length;t++){if(e="",n="",this.ProductFields[t].IsEvaluated=!1,113==this.ProductFields[t].CC.CCID&&(s.join=s.join+" left join COM_Status sta WITH(NOLOCK) ON P.StatusID=sta.StatusID ",u+="sta.Status='"+this.ProductFields[t].CC.Text+"' and "),this.ProductFields[t].CC.Visible){if(!(this.ProductFields[t].CC.SelectedValue>0)){if(!I.J0.IsEmpty(this.FullTextSearch))if(3==this.ProductFields[t].CC.CCID&&this.CostCenterID.toString()!=d.d.SessionManager.Preferences.POSItemCodeDimension)s.fulltext+=" or "+this.ProductFields[t].ColumnName+" like '%"+this.FullTextSearch+"%' ";else if(""==this.ProductFields[t].ColumnName&&this.ProductFields[t].CC.CCID>5e4)if(null!=this.ProductFields[t].OtherDimensions){this.ProductFields[t].IsEvaluated=!0;let G,L=-1,T="",b="",M=[];if(t>0){for(let p=0;p<t;p++)M.push(0);for(let p=0;p<t;p++)if(M[p]=-1,null!=this.ProductFields[p].OtherDimensions&&0!=this.ProductFields[p].IsEvaluated)for(let E=0;E<this.ProductFields[t].OtherDimensions.length&&E<this.ProductFields[p].OtherDimensions.length&&this.ProductFields[p].OtherDimensions[E]==this.ProductFields[t].OtherDimensions[E];E++)M[p]++;let O=Math.max.apply(null,M);if(O>=0)for(let p=0;p<t;p++)if(M[p]==O){L=p;break}}for(let O=0;O<this.ProductFields[t].OtherDimensions.length;O++)G=Math.abs(this.ProductFields[t].OtherDimensions[O]),T=this.ProductFields[t].OtherDimensions[O]<0?T+"_N"+G:T+"_"+G,e="DIM"+T,-1!=L&&M[L]>=O?(this.ProductFields[t].OtherDimensionsTbl[O]=e,b=T):(this.ProductFields[t].OtherDimensions[O]<0?(n="CMAPDIM"+b,m.Contains(n)||(m.push(n),s.join+=0==O?"\nleft join COM_CostCenterCostCenterMap "+n+" with(nolock) on "+n+".ParentCostCenterID=3 AND "+n+".ParentNodeID=P.ProductID ":"\nleft join COM_CostCenterCostCenterMap "+n+" with(nolock) on "+n+".ParentCostCenterID="+Math.abs(this.ProductFields[t].OtherDimensions[O-1])+" and "+n+".ParentNodeID="+this.ProductFields[t].OtherDimensionsTbl[O-1]+".NodeID"),s.join+="\nleft join "+this.GetTableName(G)+" "+e+" with(nolock) on "+e+".NodeID="+n+".NodeID AND "+n+".CostCenterID="+G):0==O?s.join+="\nleft join "+this.GetTableName(G)+" "+e+" with(nolock) on C.CCNID"+(G-5e4).toString()+"="+e+".NodeID ":(m.Contains("C"+b)||(m.push("C"+b),s.join+="\nleft join COM_CCCCDATA C"+b+" with(nolock) on C"+b+".NodeID="+this.ProductFields[t].OtherDimensionsTbl[O-1]+".NodeID AND C"+b+".CostCenterID="+Math.abs(this.ProductFields[t].OtherDimensions[O-1])),s.join+="\nleft join "+this.GetTableName(G)+" "+e+" with(nolock) on C"+b+".CCNID"+(G-5e4).toString()+"="+e+".NodeID "),this.ProductFields[t].OtherDimensionsTbl[O]=e,b=this.ProductFields[t].OtherDimensions[O]<0?b+"_N"+G:b+"_"+G);s.fulltext+=" or "+e+".Name like '%"+this.FullTextSearch+"%' ",s.OtherDimSelect+=","+e+".Name "+this.ProductFields[t].OtherDimensionDisplayMember}else this.ProductFields[t].IsParentFilter?(n="GCMAP_"+this.ProductFields[t].CC.CCID,s.join+="\nleft join COM_CostCenterCostCenterMap "+n+" with(nolock) on "+n+".ParentCostCenterID=3 AND "+n+".CostCenterID="+this.ProductFields[t].CC.CCID+" and "+n+".ParentNodeID=P.ParentID ",s.join+="\nleft join "+this.GetTableName(this.ProductFields[t].CC.CCID)+" ft"+t.toString()+" with(nolock) on ft"+t.toString()+".NodeID="+n+".NodeID ",s.fulltext+=" or ft"+t.toString()+".Name like '%"+this.FullTextSearch+"%' "):(n="CMAP_"+this.ProductFields[t].CC.CCID,s.join+="\nleft join COM_CostCenterCostCenterMap "+n+" with(nolock) on "+n+".ParentCostCenterID=3 AND "+n+".CostCenterID="+this.ProductFields[t].CC.CCID+" and "+n+".ParentNodeID=P.ProductID ",s.join+="\nleft join "+this.GetTableName(this.ProductFields[t].CC.CCID)+" ft"+t.toString()+" with(nolock) on ft"+t.toString()+".NodeID="+n+".NodeID ",s.fulltext+=" or ft"+t.toString()+".Name like '%"+this.FullTextSearch+"%' ");else this.ProductFields[t].IsParentFilter?(g||(g=!0,s.join+=" join COM_CCCCData GC with(nolock) on GC.NodeID=p.ParentID  AND C.CostCenterID = 3 "),s.join+=" left join "+this.GetTableName(this.ProductFields[t].CC.CCID)+" ft"+t.toString()+" with(nolock) on GC.CCNID"+(this.ProductFields[t].CC.CCID-5e4).toString()+"=ft"+t.toString()+".NodeID ",s.fulltext+=" or ft"+t.toString()+".Name like '%"+this.FullTextSearch+"%' "):3==this.ProductFields[t].CC.CCID&&this.CostCenterID.toString()==d.d.SessionManager.Preferences.POSItemCodeDimension?s.fulltext+=" or PE.Productcode like '%"+this.FullTextSearch+"%' or PE.ProductName like '%"+this.FullTextSearch+"%' ":this.ProductFields[t].ColumnName.Contains("ptAlpha")?this.ProductFields[t].CC.CCID>5e4?(s.join+=" left join "+this.GetTableName(this.ProductFields[t].CC.CCID)+" ft"+t.toString()+" with(nolock) on E."+this.ProductFields[t].ColumnName+"=CONVERT(NVARCHAR,ft"+t.toString()+".NodeID) ",s.fulltext+=" or ft"+t.toString()+".Name like '%"+this.FullTextSearch+"%' "):2==this.ProductFields[t].CC.CCID&&(s.join+=" left join ACC_Accounts ft"+t.toString()+" with(nolock) on E."+this.ProductFields[t].ColumnName+"=CONVERT(NVARCHAR,ft"+t.toString()+".AccountID) ",s.fulltext+=" or ft"+t.toString()+".AccountName like '%"+this.FullTextSearch+"%' "):this.ProductFields[t].CC.CCID>5e4&&(s.join+=" left join "+this.GetTableName(this.ProductFields[t].CC.CCID)+" ft"+t.toString()+" with(nolock) on C.CCNID"+(this.ProductFields[t].CC.CCID-5e4).toString()+"=ft"+t.toString()+".NodeID ",s.fulltext+=" or ft"+t.toString()+".Name like '%"+this.FullTextSearch+"%' ");continue}if(this.qtycc.Contains(this.ProductFields[t].CC.CCID)&&(s.qtywhere+=" dcCCNID"+(this.ProductFields[t].CC.CCID-5e4).toString()+"="+this.ProductFields[t].CC.SelectedValue+" and "),3==this.CostCenterID&&d.d.SessionManager.Preferences.ContainsKey("LW Products")&&"True"==d.d.SessionManager.Preferences["LW Products"].toString()&&50002==this.ProductFields[t].CC.CCID&&(s.LocWhere=this.GetLocations(this.ProductFields[t].CC.SelectedValue)),!this.ProductFields[t].IsColumnInuse)continue;i=3==this.ProductFields[t].CC.CCID&&this.CostCenterID.toString()!=d.d.SessionManager.Preferences.POSItemCodeDimension?"='"+this.ProductFields[t].CC.Text+"'":"="+this.ProductFields[t].CC.SelectedValue}else{if(null==this.ProductFields[t].FromValue.Text||""==this.ProductFields[t].FromValue.Text.Trim()){I.J0.IsEmpty(this.FullTextSearch)||("description"==this.ProductFields[t].ColumnName.toLowerCase()||"aliasname"==this.ProductFields[t].ColumnName.toLowerCase()||this.CostCenterID>5e4?s.fulltext+=" or p."+this.ProductFields[t].ColumnName+" like '%"+this.FullTextSearch+"%' ":0==this.ProductFields[t].CC.CCID&&"barcodeid"==this.ProductFields[t].ColumnName.toLowerCase()?(s.fulltext+=" or P."+this.ProductFields[t].ColumnName+" like '%"+this.FullTextSearch+"%' ",s.join+="  LEFT JOIN INV_PRODUCTBARCODE B WITH(NOLOCK) on B.ProductID=P.ProductID ",this.sFulltextSearchWhere=" or B.Barcode like '%"+this.FullTextSearch+"%' "):s.fulltext+=" or "+this.ProductFields[t].ColumnName+" like '%"+this.FullTextSearch+"%' ");continue}switch(this.ProductFields[t].Condition.SelectedValue){case"1":i=" ='"+this.ProductFields[t].FromValue.Text+"' ";break;case"2":i=" <>'"+this.ProductFields[t].FromValue.Text+"' ";break;case"3":i=" like '"+this.ProductFields[t].FromValue.Text+"%' ";break;case"4":i=" like '%"+this.ProductFields[t].FromValue.Text+"' ";break;case"5":i=" like '%"+this.ProductFields[t].FromValue.Text+"%' ";break;case"6":i=" not like '%"+this.ProductFields[t].FromValue.Text+"%' "}}if("description"==this.ProductFields[t].ColumnName.toLowerCase()||"aliasname"==this.ProductFields[t].ColumnName.toLowerCase())u+=" p."+this.ProductFields[t].ColumnName+i+" and ";else if(""==this.ProductFields[t].ColumnName&&this.ProductFields[t].CC.CCID>5e4)if(null!=this.ProductFields[t].OtherDimensions)if(""!=e)u+=e+".NodeID"+i+" and ";else{this.ProductFields[t].IsEvaluated=!0;let G,L=-1,T="",b="",M=[];if(t>0){for(let p=0;p<t;p++)M.push(0);for(let p=0;p<t;p++)if(M[p]=-1,null!=this.ProductFields[p].OtherDimensions&&0!=this.ProductFields[p].IsEvaluated)for(let E=0;E<this.ProductFields[t].OtherDimensions.length&&E<this.ProductFields[p].OtherDimensions.length&&this.ProductFields[p].OtherDimensions[E]==this.ProductFields[t].OtherDimensions[E];E++)M[p]++;let O=Math.max.apply(null,M);if(O>=0)for(let p=0;p<t;p++)if(M[p]==O){L=p;break}}for(let O=0;O<this.ProductFields[t].OtherDimensions.length;O++)G=Math.abs(this.ProductFields[t].OtherDimensions[O]),T=this.ProductFields[t].OtherDimensions[O]<0?T+"_N"+G:T+"_"+G,e="DIM"+T,-1!=L&&M[L]>=O?(this.ProductFields[t].OtherDimensionsTbl[O]=e,b=T):(this.ProductFields[t].OtherDimensions[O]<0?(n="CMAPDIM"+b,m.Contains(n)||(m.push(n),s.join+=0==O?"\nleft join COM_CostCenterCostCenterMap "+n+" with(nolock) on "+n+".ParentCostCenterID=3 AND "+n+".ParentNodeID=P.ProductID ":"\nleft join COM_CostCenterCostCenterMap "+n+" with(nolock) on "+n+".ParentCostCenterID="+Math.abs(this.ProductFields[t].OtherDimensions[O-1])+" and "+n+".ParentNodeID="+this.ProductFields[t].OtherDimensionsTbl[O-1]+".NodeID"),s.join+="\nleft join "+this.GetTableName(G)+" "+e+" with(nolock) on "+e+".NodeID="+n+".NodeID AND "+n+".CostCenterID="+G):0==O?s.join+="\nleft join "+this.GetTableName(G)+" "+e+" with(nolock) on C.CCNID"+(G-5e4).toString()+"="+e+".NodeID ":(m.Contains("C"+b)||(m.push("C"+b),s.join+="\nleft join COM_CCCCDATA C"+b+" with(nolock) on C"+b+".NodeID="+this.ProductFields[t].OtherDimensionsTbl[O-1]+".NodeID AND C"+b+".CostCenterID="+Math.abs(this.ProductFields[t].OtherDimensions[O-1])),s.join+="\nleft join "+this.GetTableName(G)+" "+e+" with(nolock) on C"+b+".CCNID"+(G-5e4).toString()+"="+e+".NodeID "),this.ProductFields[t].OtherDimensionsTbl[O]=e,b=this.ProductFields[t].OtherDimensions[O]<0?b+"_N"+G:b+"_"+G);u+=e+".NodeID"+i+" and ",s.OtherDimSelect+=","+e+".Name "+this.ProductFields[t].OtherDimensionDisplayMember}else this.ProductFields[t].IsParentFilter?(""==n&&(n="GCMAP",s.join+=" left join COM_CostCenterCostCenterMap "+n+" with(nolock) on "+n+".ParentCostCenterID=3 AND "+n+".CostCenterID="+this.ProductFields[t].CC.CCID+" and "+n+".ParentNodeID=P.ParentID "),u+=n+".NodeID"+i+" and "):(""==n&&(n="CMAP",s.join+=" left join COM_CostCenterCostCenterMap "+n+" with(nolock) on "+n+".ParentCostCenterID=3 AND "+n+".CostCenterID="+this.ProductFields[t].CC.CCID+" and "+n+".ParentNodeID=P.ProductID "),u+=n+".NodeID"+i+" and ");else this.ProductFields[t].CC.CCID>5e4?this.ProductFields[t].IsParentFilter?(g||(g=!0,s.join+=" join COM_CCCCData GC with(nolock) on GC.NodeID=P.ParentID  AND C.CostCenterID = 3 "),u+="GC."+this.ProductFields[t].ColumnName+i+" and "):u+="C."+this.ProductFields[t].ColumnName+i+" and ":3==this.ProductFields[t].CC.CCID&&this.CostCenterID.toString()==d.d.SessionManager.Preferences.POSItemCodeDimension?u+="p.ProductID"+i+" and ":this.CostCenterID>5e4?u+="p."+this.ProductFields[t].ColumnName+i+" and ":0==this.ProductFields[t].CC.CCID&&"barcodeid"==this.ProductFields[t].ColumnName.toLowerCase()?(s.OtherDimSelect+=",case when B.Barcode  "+i+" then B.UnitID else 0 end BUom",s.UOMSelect="case when B.Barcode  "+i+" and  B.UnitID>0 then (select UnitName from COM_UOM WITH(NOLOCK) where UOMID=B.UnitID)",u+="P."+this.ProductFields[t].ColumnName+i+" and ",s.join+="  LEFT JOIN INV_PRODUCTBARCODE B WITH(NOLOCK) on B.ProductID=P.ProductID ",this.sBarcodeWhere=" or B.Barcode "+i):u+=this.ProductFields[t].ColumnName+i+" and "}for(let t=0;t<this.ProductFields.length;t++)null!=this.ProductFields[t].OtherDimensions&&(this.ColumnSource.find(G=>G.DisplayMember==this.ProductFields[t].OtherDimensionDisplayMember).IsVisible=this.ProductFields[t].IsEvaluated);if(this.ProductFields.filter(t=>null!=t.OtherDimensions).length>0){let t=[];this.ColumnSource.forEach(G=>{t.push(G)}),this.GridDataObj.Columns=t}return s.qtywhere.length>5&&(s.qtywhere=s.qtywhere.substr(0,s.qtywhere.length-4)),u.length>5?u.substr(0,u.length-4):""}SelectTreeNode(){null!=this.SelectedRow&&this.SelectedRow.ProductName_Key.toString().length>0&&parseInt(this.SelectedRow.ProductName_Key),d.d.page.HideDialog(this.PopUpGUID)}}},91767:(W,x,y)=>{y.d(x,{j:()=>A});var o=y(32040),d=y(43767),I=y(54581),_=y(98580),B=y(7321),F=y(23458),K=y(21774);class A extends _.g{get GridData(){return this.GridDataObj.Table}get ColumnSource(){return this.GridDataObj.Columns}get SelectedRow(){return this.GridDataObj.SelectedItem}set SelectedRow(a){this.GridDataObj.SelectedItem=a}get ProductsGridData(){return this.ProductsGridDataObj.Table}get ProductsColumnSource(){return this.ProductsGridDataObj.Columns}constructor(a,c,h,r,l,f,S){super(),this.GridDataObj=new B.vv,this.Width=0,this.AllProducstsVisibility=!0,this.AllLocationVisibility=!0,this.Parent=null,this.ProductsGridDataObj=new B.vv,this.PID="",this.GridDataObj.Columns=[],this.GridDataObj.Table=[],this.AllLocationVisibility=!1,this.Parent=a,this.PID=S,this.Title=" Subsitutes of : "+f+" - "+l,this.InitGrid(r,h.Contains("SubstituteType"));let P="",N=null;N=c;for(let e=0;e<N.length;e++){P+=N[e].ProductName_Key.toString()+",";let D=this.GridDataObj.NewRow();D.ProductName_Key=N[e].ProductName_Key.toString();for(let C=1;C<this.ColumnSource.length;C++)h.Contains(this.ColumnSource[C].DisplayMember)&&(D[this.ColumnSource[C].DisplayMember]=d.J0.StringValue(N[e][this.ColumnSource[C].DisplayMember]));N[e].ProductName_Key.toString()==S?this.GridDataObj.insertRowAt(D,0):this.GridDataObj.addRow(D)}P.length>1&&(P=P.substr(P.length-1,1));var w=a.ScreenObject.ColumnSource.find(e=>null!=e.DisplayMember&&"rate"==e.DisplayMember.toLowerCase());let s=null;if(w&&null!=w.Formula&&""!=w.Formula&&w.Formula.toLowerCase().Contains("avgrate")&&a.ScreenObject.AvgrateExists&&this.GridDataObj.TableColumns.Contains("Price")){let e=[],D=d.J0.IntTryParse(o.d.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]);D>5e4&&e.push(D),o.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&(0,I.yG0)(o.d.SessionManager.Preferences.EnableLocationWise)&&o.d.SessionManager.Preferences.ContainsKey("Location AverageRate")&&(0,I.yG0)(o.d.SessionManager.Preferences["Location AverageRate"])&&e.push(50002),o.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&(0,I.yG0)(o.d.SessionManager.Preferences.EnableDivisionWise)&&o.d.SessionManager.Preferences.ContainsKey("Division AverageRate")&&(0,I.yG0)(o.d.SessionManager.Preferences["Division AverageRate"])&&e.push(50001);let C="";C+="<PXML>";let u="";for(let i=0;i<a.ScreenObject._CCFields.length;i++){let n=a.ScreenObject._CCFields[i];n instanceof F.y$&&n.DBColumnName.Contains("TO")&&5==a.ScreenObject.DocumentType||n instanceof F.y$&&n.SelectedValue>0&&e.Contains(n.CCID)&&(u+=" and dcCCNID"+(n.CCID-5e4).toString()+"="+n.SelectedValue.toString()+" ")}a.ScreenObject.ColumnSource.forEach(i=>{i.CostCenterID>5e4&&e.Contains(i.CostCenterID)&&!d.J0.StringIsNullOrEmpty(a.ScreenObject.GridData[a.ScreenObject.SelectedGridRowIndex][i.ValueMember])&&(u+=" and dcCCNID"+(i.CostCenterID-5e4).toString()+"="+a.ScreenObject.GridData[a.ScreenObject.SelectedGridRowIndex][i.ValueMember].toString()+"  ")});for(let i=0;i<c.length;i++)C+="<Row ",C+=' ProductID="'+c[i].ProductName_Key.toString()+'" ',C+=' QTY="1" ',C+=' DETAILSID="0" ',C+=' avgwhere="'+u+'" ></Row> ';C+="</PXML>",s=a.ScreenObject.GetReconcileAvgRate(C.toString(),a.DocumentDate)}if(this.GridDataObj.TableColumns.Contains("Price")||this.GridDataObj.TableColumns.Contains("SellingRateA")||a.ScreenObject.Preferences.ContainsKey("TransitDOcs")&&""!=a.ScreenObject.Preferences.TransitDOcs){let e,D=a.ScreenObject.GetProductDetails(P,a.DocumentDate,0,1,"0",null);if(null!=D&&D.Tables.length>0&&D.Columns[0].Contains("ProductID")){let C="";C=1==a.ScreenObject.DocumentType||25==a.ScreenObject.DocumentType||2==a.ScreenObject.DocumentType||3==a.ScreenObject.DocumentType||4==a.ScreenObject.DocumentType||10==a.ScreenObject.DocumentType||26==a.ScreenObject.DocumentType||27==a.ScreenObject.DocumentType||34==a.ScreenObject.DocumentType||31==a.ScreenObject.DocumentType?"PurchaseRate":"SellingRate",w&&null!=w.Formula&&D.Columns[0].Contains(w.Formula)&&"avgrate"!=w.Formula.toLowerCase().trim()?C=w.Formula:null!=w&&null!=w.Formula&&""!=w.Formula&&(C="",a.FillDictionary(a.SelectedRow,!1));for(let i=0;i<this.GridData.length;i++){if(null==this.GridData[i].ProductName_Key)continue;let n=null;if(this.GridDataObj.TableColumns.Contains("Price"))if(D.Tables.length>1&&D.Tables[1].filter(g=>g.ProductID==this.GridData[i].ProductName_Key).length>0?n=D.Tables[1].filter(g=>g.ProductID==this.GridData[i].ProductName_Key):D.Tables.length>2&&D.Tables[2].filter(g=>g.ProductID==this.GridData[i].ProductName_Key).length>0?n=D.Tables[2].filter(g=>g.ProductID==this.GridData[i].ProductName_Key):D.Tables.length>0&&D.Tables[0].filter(g=>g.ProductID==this.GridData[i].ProductName_Key).length>0&&(n=D.Tables[0].filter(g=>g.ProductID==this.GridData[i].ProductName_Key)),""!=C)this.GridData[i].Price=null!=n&&n.length>0&&!d.J0.StringIsNullOrEmpty(n[0][C])?n[0][C].toString():0;else{let g=a.ScreenObject.GridDataObj.NewRow();if(null!=n&&n.length>0){if(g.RATE=1==a.ScreenObject.DocumentType||25==a.ScreenObject.DocumentType||2==a.ScreenObject.DocumentType||3==a.ScreenObject.DocumentType||4==a.ScreenObject.DocumentType||10==a.ScreenObject.DocumentType||26==a.ScreenObject.DocumentType||27==a.ScreenObject.DocumentType||34==a.ScreenObject.DocumentType||31==a.ScreenObject.DocumentType?d.J0.StringIsNullOrEmpty(n[0].PurchaseRate)?0:n[0].PurchaseRate.toString():d.J0.StringIsNullOrEmpty(n[0].SellingRate)?0:n[0].SellingRate.toString(),null!=s&&s.Tables.length>0&&s.Columns[0].Contains("PID")){let m=s.Tables[0].filter(j=>j.PID==this.GridData[i].ProductName_Key);m.length>0&&(g.AVGRATE=d.J0.StringIsNullOrEmpty(m[0].AvgRate)?0:m[0].AvgRate.toString())}this.FillSalesPurchase(g,n[0]),a.CalculateTotals(g,!1),this.GridData[i].Price=g.RATE.toString()}}this.GridDataObj.TableColumns.Contains("SellingRateA")&&(e=1,o.d.SessionManager.Preferences.ContainsKey("Use Foreign Currency")&&(0,I.yG0)(o.d.SessionManager.Preferences["Use Foreign Currency"])&&null!=a.Currency&&d.J0.IsNum(a.Currency.ExchangeRate.Text)&&(e=parseFloat(a.Currency.ExchangeRate.Text)),this.GridData[i].SellingRateA=D.Tables.length>1&&D.Tables[1].filter(g=>g.ProductID==this.GridData[i].ProductName_Key).length>0&&d.J0.DoubleTryParse(D.Tables[1].filter(g=>g.ProductID==this.GridData[i].ProductName_Key)[0].SellingRateA)>0?0!=e?parseFloat(D.Tables[1].filter(g=>g.ProductID==this.GridData[i].ProductName_Key.toString())[0].SellingRateA.toString())/e:D.Tables[1].filter(g=>g.ProductID==this.GridData[i].ProductName_Key.toString())[0].SellingRateA.toString():D.Tables.length>2&&D.Tables[2].filter(g=>g.ProductID==this.GridData[i].ProductName_Key.toString()).length>0&&d.J0.DoubleTryParse(D.Tables[2].filter(g=>g.ProductID==this.GridData[i].ProductName_Key.toString())[0].SellingRateA.toString())>0?0!=e?parseFloat(D.Tables[2].filter(g=>g.ProductID==this.GridData[i].ProductName_Key.toString())[0].SellingRateA.toString())/e:D.Tables[2].filter(g=>g.ProductID==this.GridData[i].ProductName_Key.toString())[0].SellingRateA.toString():D.Tables.length>0&&D.Tables[0].filter(g=>g.ProductID==this.GridData[i].ProductName_Key.toString()).length>0&&d.J0.DoubleTryParse(D.Tables[0].filter(g=>g.ProductID==this.GridData[i].ProductName_Key.toString())[0].SellingRateA.toString())>0?0!=e?parseFloat(D.Tables[0].filter(g=>g.ProductID==this.GridData[i].ProductName_Key.toString())[0].SellingRateA.toString())/e:D.Tables[0].filter(g=>g.ProductID==this.GridData[i].ProductName_Key.toString())[0].SellingRateA.toString():"0")}}this.CheckGoodsinTransit(D)}this.CheckLocationWiseQty(),this.ShowSubQOH(),this.GridData.length>0&&this.FillEmptyRows()}CheckGoodsinTransit(a){if(this.Parent.ScreenObject.Preferences.ContainsKey("TransitDOcs")&&""!=this.Parent.ScreenObject.Preferences.TransitDOcs){let r="";var c=this.Parent.ScreenObject._CCFields.find(f=>f instanceof F.y$&&50002==f.CCID);if(c&&c instanceof F.y$)r=c.Text;else{var h=this.ColumnSource.find(f=>null!=f.DisplayMember&&"50002"==f.DisplayMember);h&&(r=h.Header)}this.GridDataObj.TableColumns.push("transit");let l=new K.O7;if(l.Header=r+" transit",l.DisplayMember="transit",l.DataType="FLOAT",l.Width=80,l.ReadOnly=!0,l.DisableTab=!0,o.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=o.d.SessionManager.Preferences.DecimalsinQty&&(l.DecimalPoints=o.d.SessionManager.Preferences.DecimalsinQty),this.ColumnSource.length>9?this.ColumnSource.InsertAt(l,9):this.ColumnSource.push(l),null!=a&&a.Tables.length>3&&a.Columns[3].Contains("PendingOrders"))for(let f=0;f<this.GridData.length;f++)null!=this.GridData[f].ProductName_Key&&a.Tables[3].filter(S=>S.ProductID==this.GridData[f].ProductName_Key.toString()).length>0&&(this.GridData[f].transit=a.Tables[3].filter(S=>S.ProductID==this.GridData[f].ProductName_Key.toString())[0].PendingOrders.toString())}}ShowSubQOH(){if(this.Parent.ScreenObject.Preferences.ContainsKey("ShowSubQOH")&&""!=this.Parent.ScreenObject.Preferences.ShowSubQOH&&(0,I.yG0)(this.Parent.ScreenObject.Preferences.ShowSubQOH))if(this.GridDataObj.TableColumns.Contains("SubQOH")){let h=this.Parent.ScreenObject.ColumnSource.find(l=>!d.J0.StringIsNullOrEmpty(l.OPParams)&&l.OPParams.Contains(h.ID));if(h){let l=[];var a=h.IPParams.split(",");for(let S=0;S<a.length;S++)if(""!=a[S]){var c=this.Parent.ScreenObject.ColumnSource.find(P=>P.ID==a[S]);if(c&&3==c.CostCenterID){let P="";for(let N=0;N<this.GridData.length;N++)null!=this.GridData[N].ProductName_Key&&(P+=this.GridData[N].ProductName_Key.toString()+",");P.length>1&&(P=P.substr(0,P.length-1)),l.push(P)}else l.push(this.Parent.ScreenObject.GetValueBYCOLID(a[S],this.Parent.SelectedRow))}l.push(o.d.SessionManager.UserID),l.push(o.d.SessionManager.LanguageID);let f=o.d.document.GetData(JSON.stringify(l),h.SPName);if(null!=f&&f.Tables.length>0&&f.Columns[0].Contains("ProductID")&&f.Tables[0].length>0)for(let S=0;S<this.GridData.length;S++){let P=f.Tables[0].filter(N=>N.ProductID==this.GridData[S].ProductName_Key.toString());P.length>0&&d.J0.DoubleTryParse(P[0][f.Columns[0][0]])>0?P.length>0&&(this.GridData[S].SubQOH=P[0][f.Columns[0][0]].toString()):(this.GridDataObj.removeRow(this.GridData[S]),S--)}}let r=0;for(let l=0;l<this.GridData.length;l++)if(!d.J0.StringIsNullOrEmpty(this.GridData[l].ProductName_Key)&&this.GridData[l].ProductName_Key.toString()!=this.PID){r++;break}0==r&&this.GridData.Clear()}else if(this.GridDataObj.TableColumns.Contains("QOH"))for(let h=0;h<this.GridData.length;h++)null!=this.GridData[h].ProductName_Key&&(d.J0.DoubleTryParse(this.GridData[h].QOH)>0||(this.GridDataObj.removeRow(this.GridData[h]),h--));else{let h="";for(let l=0;l<this.GridData.length;l++)null!=this.GridData[l].ProductName_Key&&(h+=this.GridData[l].ProductName_Key.toString()+",");let r=this.Parent.ScreenObject.GetProductQtyOnHand(h,this.Parent.DocumentDate,null);if(""!=h&&null!=r&&r.Tables.length>0&&r.Columns[0].Contains("ProductID"))for(let l=0;l<this.GridData.length;l++){let f=r.Tables[0].filter(S=>S.ProductID==this.GridData[l].ProductName_Key.toString());f.length>0&&d.J0.DoubleTryParse(f[0].QOH)>0||(this.GridDataObj.removeRow(this.GridData[l]),l--)}}}CheckLocationWiseQty(){if(this.Parent.ScreenObject.Preferences.ContainsKey("LocationWiseQty")&&""!=this.Parent.ScreenObject.Preferences.LocationWiseQty&&(0,I.yG0)(this.Parent.ScreenObject.Preferences.LocationWiseQty)){let a="";for(let c=0;c<this.GridData.length;c++)null!=this.GridData[c].ProductName_Key&&(a+=this.GridData[c].ProductName_Key.toString()+",");if(""!=a){let c=!1;a=a.substr(a.length-1,1);let h=Date.Today();d.J0.IsType(this.Parent,"AddEditDocumentViewModel")&&(h=this.Parent.DocumentDate);let r=o.d.inventory.GetProductQOH("0",h,a);if(null!=r&&r.Tables.length>0&&r.Columns[0].Contains("QOH")){if(r.Tables.length>1&&r.Columns[1].Contains("NodeID"))for(let S=0;S<r.Tables[1].length;S++)if(c=o.d.SessionManager.IsActionAssigned(43,"Override Location For Substitutes"),!o.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")||""==o.d.SessionManager.Preferences.EnableLocationWise||!(0,I.yG0)(o.d.SessionManager.Preferences.EnableLocationWise)||o.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&""!=o.d.SessionManager.Preferences.EnableLocationWise&&(0,I.yG0)(o.d.SessionManager.Preferences.EnableLocationWise)&&(o.d.SessionManager.LocationWhere.Contains(","+r.Tables[1][S].NodeID.toString()+",")||o.d.SessionManager.LocationWhere.startsWith(r.Tables[1][S].NodeID.toString()+",")||o.d.SessionManager.LocationWhere.endsWith(","+r.Tables[1][S].NodeID.toString())||o.d.SessionManager.LocationWhere==r.Tables[1][S].NodeID.toString()||c)){this.GridDataObj.TableColumns.push(r.Tables[1][S].NodeID.toString());let P=new K.O7;P.Header=r.Tables[1][S].Name.toString(),P.DisplayMember=r.Tables[1][S].NodeID.toString(),P.DataType="FLOAT",P.Width=50,P.ReadOnly=!0,P.DisableTab=!0,o.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=o.d.SessionManager.Preferences.DecimalsinQty&&(P.DecimalPoints=o.d.SessionManager.Preferences.DecimalsinQty),(this.Parent.ScreenObject.LocationID>0&&r.Tables[1][S].NodeID.toString()==this.Parent.ScreenObject.LocationID.toString()||o.d.SessionManager.LocationID>0&&r.Tables[1][S].NodeID.toString()==o.d.SessionManager.LocationID.toString())&&this.ColumnSource.length>8?this.ColumnSource.InsertAt(P,8):this.ColumnSource.push(P)}let l="";if("true"==o.d.SessionManager.Preferences.EnableLocationWise.toLowerCase()&&"true"==o.d.SessionManager.Preferences["Location Stock"].toLowerCase()&&(l="dcccnid2"),"true"==o.d.SessionManager.Preferences.EnableDivisionWise.toLowerCase()&&"true"==o.d.SessionManager.Preferences["Division Stock"].toLowerCase()&&(l="dcccnid1"),d.J0.IntTryParse(o.d.SessionManager.Preferences["Maintain Dimensionwise stock"])>0&&(l="dcccnid"+(parseInt(o.d.SessionManager.Preferences["Maintain Dimensionwise stock"])-5e4)),r.Columns[0].Contains(l)){this.ColumnSource[4].IsVisible=!1,this.ColumnSource[5].DataType="FLOAT";for(let S=0;S<this.GridData.length;S++){if(null==this.GridData[S].ProductName_Key)continue;let P=r.Tables[0].filter(N=>N.ProductID==this.GridData[S].ProductName_Key.toString());for(let N=0;N<P.length;N++){if(!this.GridDataObj.TableColumns.Contains(P[N][l].toString())){if(r.Tables.length>1)continue;this.GridDataObj.TableColumns.push(P[N][l].toString());let w=new K.O7;w.Header=P[N][0].toString(),w.DisplayMember=P[N][l].toString(),w.DataType="FLOAT",w.ReadOnly=!0,w.Width=80,o.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=o.d.SessionManager.Preferences.DecimalsinQty&&(w.DecimalPoints=o.d.SessionManager.Preferences.DecimalsinQty),this.ColumnSource.push(w)}this.GridData[S][P[N][l].toString()]=P[N].QOH.toString()}}}for(let S=0;S<this.GridData.length;S++)if(null!=this.GridData[S].ProductName_Key)for(let P=5;P<this.GridDataObj.TableColumns.length;P++)""==this.GridData[S][P].toString()&&(this.GridData[S][P]=0)}}}}FillEmptyRows(){for(let a=0;a<this.GridData.length;a++)if(null!=this.GridData[a].ProductName_Key)for(let c=1;c<this.ColumnSource.length;c++)!d.J0.StringIsNullOrEmpty(this.ColumnSource[c].DecimalPoints)&&this.GridDataObj.TableColumns.Contains(this.ColumnSource[c].DisplayMember)&&d.J0.IsNum(this.GridData[a][this.ColumnSource[c].DisplayMember])&&(this.GridData[a][this.ColumnSource[c].DisplayMember]=parseFloat(this.GridData[a][this.ColumnSource[c].DisplayMember].toString()).ToString("N"+this.ColumnSource[c].DecimalPoints));for(let a=this.GridData.length;a<10;a++)this.GridDataObj.addEmptyRow();for(let a=0;a<this.GridData.length;a++)this.GridData[a].Select=!1}onClick(a,c){if(this.SelectedRow=a.item,c&&null!=this.SelectedRow&&!d.J0.StringIsNullOrEmpty(this.SelectedRow.ProductName_Key)){let h;if(o.d.page.HideDialog(this.PopUpGUID),h=this.Parent.SelectedRow,h.Subexists="1",h.ProductID_Key.toString()!=this.SelectedRow.ProductName_Key.toString()&&this.GridData.filter(r=>r.ProductName_Key==h.ProductID_Key).length>0){let r=this.Parent.ScreenObject.Data.Tables[0];r.length>0&&(r=this.Parent.ScreenObject.Data.Tables[0].filter(l=>null!=l.LocalReference&&79==l.LocalReference&&55200==l.LinkData),r.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName.toString())&&(this.Parent.ScreenObject.GridDataColumns.Contains(r[0].SysColumnName.toString()+"_Key")?(h[r[0].SysColumnName.toString()+"_Key"]=h.ProductID_Key,this.Parent.ScreenObject.GridDataColumns.Contains("ProductName")&&(h[r[0].SysColumnName.toString()]=h.ProductName)):h[r[0].SysColumnName.toString()]=h.ProductID_Key))}this.Parent.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")&&""!=this.Parent.ScreenObject.Preferences.Dontresetvaluesonproductchange&&(0,I.yG0)(this.Parent.ScreenObject.Preferences.Dontresetvaluesonproductchange)?h.ProductID_Key.toString()!=this.SelectedRow.ProductName_Key.toString()&&(h.ProductID_Key=this.SelectedRow.ProductName_Key.toString(),this.Parent.ScreenObject.GridDataColumns.Contains("ProductCode")&&this.GridDataObj.TableColumns.Contains("ProductCode")&&(h.ProductCode=this.SelectedRow.ProductCode.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("ProductName")&&this.GridDataObj.TableColumns.Contains("ProductName")&&(h.ProductName=this.SelectedRow.ProductName.toString()),this.dontresetvalues(h)):(h.ProductID_Key=this.SelectedRow.ProductName_Key.toString(),this.Parent.ScreenObject.GridDataColumns.Contains("ProductCode")&&this.GridDataObj.TableColumns.Contains("ProductCode")&&(h.ProductCode=this.SelectedRow.ProductCode.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("ProductName")&&this.GridDataObj.TableColumns.Contains("ProductName")&&(h.ProductName=this.SelectedRow.ProductName.toString()),h.Quantity="1",this.Parent.AddProductData(h,!1,!1,!0)),this.Parent.CalculateTotals(h,!1),this.Parent.SubDialogResult=!0,this.Parent.ReportDimension.SelectedValue=parseInt(this.SelectedRow.ProductName_Key.toString()),this.Parent.ProdID=0,this.Parent.ScreenObject.GridDataObj.updateRow(h)}}dontresetvalues(a){let c=this.Parent.GetProductValues(a,0);if(null!=c&&c.Tables.length>0&&c.Tables[0].length>0&&!c.Columns[0].Contains("ErrorMessage")&&(a.Type=c.Tables[0][0].ProductTypeID.toString(),this.Parent.ScreenObject.GridDataColumns.Contains("BinWise")&&c.Columns[0].Contains("BinWise")&&(a.BinWise=c.Tables[0][0].BinWise.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("QtyType")&&c.Columns[0].Contains("QtyAdjustType")&&(a.QtyType=c.Tables[0][0].QtyAdjustType.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("PackType")&&c.Columns[0].Contains("IsPacking")&&(a.PackType=c.Tables[0][0].IsPacking.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("IsTestCase")&&c.Columns[0].Contains("TestCaseExists")&&(a.IsTestCase=c.Tables[0][0].TestCaseExists.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("landingType")&&c.Columns[0].Contains("IsBillOfEntry")&&(a.landingType=c.Tables[0][0].IsBillOfEntry.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("SchemeProductID")&&(a.SchemeProductID=null),a.ExtraXML=null),this.Parent.ScreenObject.Preferences.ContainsKey("ResetFields")&&""!=this.Parent.ScreenObject.Preferences.ResetFields.toString()){let f="";var h=this.Parent.ScreenObject.Preferences.ResetFields.toString().split(",");for(let P=0;P<h.length;P++){f+="'"+h[P]+"',",this.Parent.ScreenObject.GridDataColumns.Contains(h[P])&&(a[h[P]]=null),this.Parent.ScreenObject.GridDataColumns.Contains(h[P]+"_Key")&&(a[h[P]+"_Key"]=null);let N=c.Tables[4].filter(w=>w.SysColumnName==h[P]);N.length>0?(a[h[P]]=N[0].Value.toString(),a["default"+h[P]]=N[0].Value.toString()):"Unit"==h[P]&&c.Tables.length>0&&c.Columns[0].Contains("uomid")&&!d.J0.StringIsNullOrEmpty(c.Tables[0][0].uomid)?(a.Unit=c.Tables[0][0].UnitName.toString(),a.Unit_key=c.Tables[0][0].uomid.toString()):"Rate"==h[P]&&(c.Tables.length>3&&c.Tables[3].length>0?1==this.Parent.ScreenObject.DocumentType||25==this.Parent.ScreenObject.DocumentType||2==this.Parent.ScreenObject.DocumentType||3==this.Parent.ScreenObject.DocumentType||4==this.Parent.ScreenObject.DocumentType||10==this.Parent.ScreenObject.DocumentType||26==this.Parent.ScreenObject.DocumentType||27==this.Parent.ScreenObject.DocumentType||34==this.Parent.ScreenObject.DocumentType||31==this.Parent.ScreenObject.DocumentType?d.J0.StringIsNullOrEmpty(c.Tables[3][0].PurchaseRate)||(a.Rate=c.Tables[3][0].PurchaseRate.toString()):d.J0.StringIsNullOrEmpty(c.Tables[3][0].SellingRate)||(a.Rate=c.Tables[3][0].SellingRate.toString()):c.Tables.length>0&&c.Tables[0].length>0&&(1==this.Parent.ScreenObject.DocumentType||25==this.Parent.ScreenObject.DocumentType||2==this.Parent.ScreenObject.DocumentType||3==this.Parent.ScreenObject.DocumentType||4==this.Parent.ScreenObject.DocumentType||10==this.Parent.ScreenObject.DocumentType||26==this.Parent.ScreenObject.DocumentType||27==this.Parent.ScreenObject.DocumentType||34==this.Parent.ScreenObject.DocumentType||31==this.Parent.ScreenObject.DocumentType?d.J0.StringIsNullOrEmpty(c.Tables[0][0].PurchaseRate)||(a.Rate=c.Tables[0][0].PurchaseRate.toString()):d.J0.StringIsNullOrEmpty(c.Tables[0][0].SellingRate)||(a.Rate=c.Tables[0][0].SellingRate.toString())))}f.length>1&&(f=f.substr(0,f.length-1));var r=this.Parent.ScreenObject.ColumnSource.find(P=>!d.J0.StringIsNullOrEmpty(P.ValueMember)&&"productid_key"==P.ValueMember.toLowerCase());let S=this.Parent.ScreenObject.Data.Tables[0].filter(P=>f.split(",").Contains(P.SysColumnName)&&null!=P.LocalReference&&P.LocalReference==r.ID);S.length>0&&this.Parent.ScreenObject.GetLinkReferenceData(parseInt(r.ID),this.Parent.DocumentID,parseInt(a.ProductID_Key),Date.Today(),"",3,a,h);var l=this.Parent.ScreenObject.ColumnSource.find(P=>!d.J0.StringIsNullOrEmpty(P.ValueMember)&&P.ValueMember.toLowerCase()==r.ValueMember.toLowerCase()&&P.ID!=r.ID);l&&(S=this.Parent.ScreenObject.Data.Tables[0].filter(P=>f.split(",").Contains(P.SysColumnName)&&null!=P.LocalReference&&P.LocalReference==l.ID),S.length>0&&this.Parent.ScreenObject.GetLinkReferenceData(parseInt(l.ID),this.Parent.DocumentID,parseInt(a.ProductID_Key),Date.Today(),"",3,a,h))}}InitGrid(a,c){this.GridDataObj.TableColumns.push("Select"),this.GridDataObj.TableColumns.push("ProductName_Key"),this.GridDataObj.TableColumns.push("SubstituteType");let r,h=[];this.Parent.ScreenObject.Preferences.ContainsKey("MultipleProductSubstitute")&&!d.J0.IsEmpty(this.Parent.ScreenObject.Preferences.MultipleProductSubstitute)&&(0,I.yG0)(this.Parent.ScreenObject.Preferences.MultipleProductSubstitute)?(r=new K.O7,r.Header="Select",r.DisplayMember="Select",r.DataType="CheckBox",r.Width=50,r.IsFrozen=!0,h.push(r),r=new K.O7,r.Header="Qty",r.DisplayMember="Qty",r.DataType="FLOAT",r.Width=50,r.IsFrozen=!0,r.DisplayIndex=2,h.push(r),this.GridDataObj.TableColumns.push("Qty")):(r=new K.O7,r.Header="Select",r.DisplayMember="Select",r.DataType="RadioButton",r.Width=50,r.CheckedChanged.Subscribe(this,"onClick"),r.IsFrozen=!0,h.push(r)),c&&(r=new K.O7,r.Header="Type",r.DisplayMember="SubstituteType",r.Width=75,r.IsFrozen=!0,r.ReadOnly=!0,h.push(r));for(let S=0;S<a.length;S++)r=new K.O7,r.Header=a[S].UserColumnName.toString(),r.DisplayMember=d.J0.StringValue(a[S].SYSCOLUMNNAME),r.Width=d.J0.StringIsNullOrEmpty(a[S].ColumnWidth)?50:parseInt(a[S].ColumnWidth.toString()),""==d.J0.StringValue(a[S].SYSCOLUMNNAME)?r.DisplayMember=a[S].CCID.toString():"26428"==a[S].ColID.toString()?r.DisplayMember="onHand":("PurchaseRate"==a[S].SYSCOLUMNNAME&&this.Parent.ScreenObject.IsPurchase||"SellingRate"==a[S].SYSCOLUMNNAME&&!this.Parent.ScreenObject.IsPurchase)&&(r.DisplayMember="Price"),"FLOAT"==a[S].usercolumntype&&(r.DataType="FLOAT","onHand"==r.DisplayMember||"Price"==r.DisplayMember||r.DisplayMember.Contains("Rate")?o.d.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&""!=o.d.SessionManager.Preferences.DecimalsinAmount&&(r.DecimalPoints=o.d.SessionManager.Preferences.DecimalsinAmount):o.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=o.d.SessionManager.Preferences.DecimalsinQty&&(r.DecimalPoints=o.d.SessionManager.Preferences.DecimalsinQty)),null!=a[S].ColumnOrder&&""!=a[S].ColumnOrder.toString()&&(r.DisplayIndex=parseInt(a[S].ColumnOrder.toString())),r.ReadOnly=!0,h.push(r),this.GridDataObj.TableColumns.push(r.DisplayMember);if(null!=h&&h.length>0&&h.sort((S,P)=>S.DisplayIndex-P.DisplayIndex).forEach(S=>{this.ColumnSource.push(S)}),this.Parent.ScreenObject.Preferences.ContainsKey("SubstituteOnQty")&&""!=this.Parent.ScreenObject.Preferences.SubstituteOnQty&&this.Parent.ScreenObject.GridDataColumns.Contains(this.Parent.ScreenObject.Preferences.SubstituteOnQty)){var f=this.Parent.ScreenObject.ColumnSource.find(S=>S.DisplayMember.toLowerCase()==this.Parent.ScreenObject.Preferences.SubstituteOnQty.toLowerCase());f&&(r=new K.O7,r.Header=f.Header,r.DisplayMember="SubQOH",r.Width=f.Width,r.ReadOnly=!0,this.ColumnSource.push(r),this.GridDataObj.TableColumns.push(r.DisplayMember))}}onQtyClick(){if(null!=this.SelectedRow&&null!=this.SelectedRow.ProductName_Key){this.GridDataObj.TableColumns.Contains("ProductCode")&&(this.ProductCode=this.SelectedRow.ProductCode.toString()),this.GridDataObj.TableColumns.Contains("ProductName")&&(this.ProductName=this.SelectedRow.ProductName.toString()),this.ProductID=this.SelectedRow.ProductName_Key.toString();let a=Date.Today();d.J0.IsType(this.Parent,"AddEditDocumentViewModel")&&(a=this.Parent.DocumentDate);let c=o.d.inventory.GetProductQOH(this.ProductID,a,"");if(null!=c&&c.Tables.length>0&&c.Columns[0].Contains("QOH")){this.ProductsGridDataObj.Table=[];let h=[];for(let r=0;r<c.Tables[0].Columns.length;r++){if("QOH"==c.Tables[0].Columns[r]){let l=new K.O7;l.Header="QOH",l.DisplayMember="QOH",l.DataType="FLOAT",l.ReadOnly=!0,l.Width=75,o.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=o.d.SessionManager.Preferences.DecimalsinQty&&(l.DecimalPoints=o.d.SessionManager.Preferences.DecimalsinQty),this.ProductsGridDataObj.TableColumns.push("QOH"),h.push(l);break}{this.ProductsGridDataObj.TableColumns.push(c.Tables[0].Columns[r+1]);let l=new K.O7;l.Header=c.Tables[0].Columns[r],l.DisplayMember=c.Tables[0].Columns[r+1],l.DataType="TextBlock",l.ReadOnly=!0,l.Width=150,o.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=o.d.SessionManager.Preferences.DecimalsinQty&&(l.DecimalPoints=o.d.SessionManager.Preferences.DecimalsinQty),h.push(l),r++}}this.ProductsGridDataObj.Columns=h;for(let r=0;r<c.Tables[0].length;r++){let l=this.ProductsGridDataObj.NewRow();for(let f=0;f<c.Tables[0].Columns.length;f++){if("QOH"==c.Tables[0].Columns[f]){l.QOH=c.Tables[0][r].QOH.toString();break}l[c.Tables[0].Columns[f+1]]=c.Tables[0][r][c.Tables[0].Columns[f]].toString(),f++}this.ProductsGridDataObj.addRow(l)}}this.AllProducstsVisibility=!1,this.AllLocationVisibility=!0}}OnButtonClick(a){if("Cancel"==a)o.d.page.HideDialog(this.PopUpGUID),null!=this.Parent&&null!=this.Parent.SelectedRow&&(this.Parent.SelectedRow.Subexists="1"),this.Parent.SubDialogResult=!1;else if("onClick"!=a)if("back"==a)this.AllProducstsVisibility=!0,this.AllLocationVisibility=!1;else if("OK"==a&&null!=this.Parent.SelectedRow&&this.ColumnSource[0].IsVisible)if(o.d.page.HideDialog(this.PopUpGUID),this.Parent.ScreenObject.Preferences.ContainsKey("MultipleProductSubstitute")&&""!=this.Parent.ScreenObject.Preferences.MultipleProductSubstitute&&(0,I.yG0)(this.Parent.ScreenObject.Preferences.MultipleProductSubstitute)){let c=this.Parent.ScreenObject.GridData.indexOf(this.Parent.SelectedRow);null!=this.Parent&&null!=this.Parent.SelectedRow&&(this.Parent.SelectedRow.Subexists="1");let h=!0;for(let r=0;r<this.GridData.length;r++)if(""!=d.J0.String(this.GridData[r].Select)&&""!=d.J0.String(this.GridData[r].ProductName_Key)&&(0,I.yG0)(this.GridData[r].Select.toString())){let l=null;if(h?l=this.Parent.SelectedRow:(l=this.Parent.ScreenObject.GridDataObj.NewRow(),c+=1),d.J0.String(l.ProductID_Key)!=this.GridData[r].ProductName_Key.toString()){let f=this.Parent.ScreenObject.Data.Tables[0];f.length>0&&(f=this.Parent.ScreenObject.Data.Tables[0].filter(S=>null!=S.LocalReference&&79==S.LocalReference&&55200==S.LinkData),f.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(f[0].SysColumnName.toString())&&(this.Parent.ScreenObject.GridDataColumns.Contains(f[0].SysColumnName.toString()+"_Key")?(l[f[0].SysColumnName.toString()+"_Key"]=l.ProductID_Key,this.Parent.ScreenObject.GridDataColumns.Contains("ProductName")&&(l[f[0].SysColumnName.toString()]=l.ProductName)):l[f[0].SysColumnName.toString()]=l.ProductID_Key))}this.Parent.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")&&""!=this.Parent.ScreenObject.Preferences.Dontresetvaluesonproductchange&&(0,I.yG0)(this.Parent.ScreenObject.Preferences.Dontresetvaluesonproductchange)?l.ProductID_Key.toString()!=this.GridData[r].ProductName_Key.toString()&&(l.ProductID_Key=this.GridData[r].ProductName_Key.toString(),this.Parent.ScreenObject.GridDataColumns.Contains("ProductCode")&&this.GridDataObj.TableColumns.Contains("ProductCode")&&(l.ProductCode=this.GridData[r].ProductCode.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("ProductName")&&this.GridDataObj.TableColumns.Contains("ProductName")&&(l.ProductName=this.GridData[r].ProductName.toString()),this.dontresetvalues(l)):(l.ProductID_Key=this.GridData[r].ProductName_Key.toString(),this.Parent.ScreenObject.GridDataColumns.Contains("ProductCode")&&this.GridDataObj.TableColumns.Contains("ProductCode")&&(l.ProductCode=this.GridData[r].ProductCode.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("ProductName")&&this.GridDataObj.TableColumns.Contains("ProductName")&&(l.ProductName=this.GridData[r].ProductName.toString()),h||this.Parent.ScreenObject.GridDataObj.insertRowAt(l,c),this.Parent.AddProductData(l,!1,!1,!0),l.Quantity=null!=this.GridData[r].Qty&&""!=this.GridData[r].Qty.toString()?this.GridData[r].Qty.toString():"1"),this.Parent.ReportDimension.SelectedValue=parseInt(this.GridData[r].ProductName_Key.toString()),this.Parent.CalculateTotals(l,!1,"Quantity"),this.Parent.SubDialogResult=!0,this.Parent.ProdID=0,this.Parent.ScreenObject.GridDataObj.updateRow(l),h=!1}}else{this.Parent.ScreenObject.GridData.indexOf(this.Parent.SelectedRow),null!=this.Parent&&null!=this.Parent.SelectedRow&&(this.Parent.SelectedRow.Subexists="1");for(let h=0;h<this.GridData.length;h++)if(!d.J0.StringIsNullOrEmpty(this.GridData[h].Select)&&!d.J0.StringIsNullOrEmpty(this.GridData[h].ProductName_Key)&&(0,I.yG0)(this.GridData[h].Select.toString())){let r=this.Parent.SelectedRow;if(r.ProductID_Key.toString()!=this.GridData[h].ProductName_Key.toString()&&this.GridData.filter(l=>l.ProductName_Key==r.ProductID_Key).length>0){let l=this.Parent.ScreenObject.Data.Tables[0];l.length>0&&(l=this.Parent.ScreenObject.Data.Tables[0].filter(f=>null!=f.LocalReference&&79==f.LocalReference&&55200==f.LinkData),l.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(l[0].SysColumnName.toString())&&(this.Parent.ScreenObject.GridDataColumns.Contains(l[0].SysColumnName.toString()+"_Key")?(r[l[0].SysColumnName.toString()+"_Key"]=r.ProductID_Key,this.Parent.ScreenObject.GridDataColumns.Contains("ProductName")&&(r[l[0].SysColumnName.toString()]=r.ProductName)):r[l[0].SysColumnName.toString()]=r.ProductID_Key))}this.Parent.ScreenObject.Preferences.ContainsKey("Dontresetvaluesonproductchange")&&""!=this.Parent.ScreenObject.Preferences.Dontresetvaluesonproductchange&&(0,I.yG0)(this.Parent.ScreenObject.Preferences.Dontresetvaluesonproductchange)?r.ProductID_Key.toString()!=this.GridData[h].ProductName_Key.toString()&&(r.ProductID_Key=this.GridData[h].ProductName_Key.toString(),this.Parent.ScreenObject.GridDataColumns.Contains("ProductCode")&&this.GridDataObj.TableColumns.Contains("ProductCode")&&(r.ProductCode=this.GridData[h].ProductCode.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("ProductName")&&this.GridDataObj.TableColumns.Contains("ProductName")&&(r.ProductName=this.GridData[h].ProductName.toString()),this.dontresetvalues(r)):(r.ProductID_Key=this.GridData[h].ProductName_Key.toString(),this.Parent.ScreenObject.GridDataColumns.Contains("ProductCode")&&this.GridDataObj.TableColumns.Contains("ProductCode")&&(r.ProductCode=this.GridData[h].ProductCode.toString()),this.Parent.ScreenObject.GridDataColumns.Contains("ProductName")&&this.GridDataObj.TableColumns.Contains("ProductName")&&(r.ProductName=this.GridData[h].ProductName.toString()),r.Quantity="1",this.Parent.AddProductData(r,!1,!1,!0)),this.Parent.ReportDimension.SelectedValue=parseInt(this.GridData[h].ProductName_Key.toString()),this.Parent.CalculateTotals(r,!1),this.Parent.SubDialogResult=!0,this.Parent.ProdID=0,this.Parent.ScreenObject.GridDataObj.updateRow(r)}}}FillSalesPurchase(a,c){this.FillDatarow(a,c,"22821","SellingRate"),this.FillDatarow(a,c,"22793","SellingRateA"),this.FillDatarow(a,c,"22794","SellingRateB"),this.FillDatarow(a,c,"22795","SellingRateC"),this.FillDatarow(a,c,"22796","SellingRateD"),this.FillDatarow(a,c,"22797","SellingRateE"),this.FillDatarow(a,c,"22798","SellingRateF"),this.FillDatarow(a,c,"22799","SellingRateG"),this.FillDatarow(a,c,"22820","PurchaseRate"),this.FillDatarow(a,c,"22786","PurchaseRateA"),this.FillDatarow(a,c,"22787","PurchaseRateB"),this.FillDatarow(a,c,"22788","PurchaseRateC"),this.FillDatarow(a,c,"22789","PurchaseRateD"),this.FillDatarow(a,c,"22790","PurchaseRateE"),this.FillDatarow(a,c,"22791","PurchaseRateF"),this.FillDatarow(a,c,"22792","PurchaseRateG")}FillDatarow(a,c,h,r){let l=this.Parent.ScreenObject.Data.Tables[0];l.length>0&&(l=this.Parent.ScreenObject.Data.Tables[0].filter(f=>null!=f.LocalReference&&f.LinkData==h),l.length>0&&this.Parent.ScreenObject.GridDataColumns.Contains(l[0].SysColumnName.toString())&&(d.J0.StringIsNullOrEmpty(c[r])?a[l[0].SysColumnName.toString()]=0:a[l[0].SysColumnName.toString()]=c[r].toString()))}}}}]);