"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[4286],{54286:(E,T,d)=>{d.r(T),d.d(T,{BulkDocumentPostingViewModel:()=>U});var u=d(32040),b=d(43767),g=d(54581),G=d(98580),A=d(23458),c=d(27730),w=d(7321),p=d(21774),V=d(67557),L=d(26336),y=d(23603),M=d(5109),v=d(30786);class B extends G.g{constructor(s,t,e,i,o,n){super(),this.CostCenterID=0,this.CostCenterName="",this.Cnt=0,this.DesCols=null,this.DocLinkDefID=0,this.LocID=0,Logger.InfoLog("BulkPostingViewModel::Entering BulkPostingViewModel"),this.LocID=n,this.Docs=s,this.CostCenterID=t,this.DesCols=o,this.CostCenterName=e,this.DocLinkDefID=i,this.LoadDocument(),Logger.InfoLog("BulkPostingViewModel::Exiting BulkPostingViewModel"),this.DisplayName=this.Document.DisplayName}onButtonClick(s){"Done"==s?u.d.page.HideDialog(this.PopUpGUID):"Next"==s&&(this.Cnt++,this.LoadDocument())}LoadDocument(){if(this.Cnt<this.Docs.length){this.Document=new M.AddEditDocumentViewModel(this.CostCenterID,this.CostCenterName,!0),this.Document.ChangeLocation(!1,!1,this.LocID),this.Document.ScreenObject.LocationID=this.LocID,this.Document.ScreenObject.SetDefaultValuesforCostCenters(0);for(let s=0;s<this.Docs.values[this.Cnt].length;s++)this.Document.FillLink(this.Docs.values[this.Cnt].keys[s],this.DocLinkDefID,this.Docs.values[this.Cnt].values[s],this.DesCols);if(null!=this.Document.ScreenObject.CreditAccount&&(this.Document.ScreenObject.CreditAccount.SelectedValue=this.Docs.keys[this.Cnt]),null!=this.Document.ScreenObject.Link){let s;this.Document.ScreenObject.Link.LinkCombo.SelectedValue=this.DocLinkDefID.toString(),s=this.Document.ScreenObject.GetLinkDetails(parseInt(this.Document.ScreenObject.Link.LinkCombo.SelectedValue),this.Document.ScreenObject.DocDate.Date.ToString("dd/MMM/yyyy"),null!=this.Document.ScreenObject.DueDate&&this.Document.ScreenObject.DueDate.Date?this.Document.ScreenObject.DueDate.Date.ToString("dd/MMM/yyyy"):""),s.Tables.length>0&&s.Columns[0].Contains("voucherno")&&(this.Document.ScreenObject.Link.VouchersList=s.Tables[0].AsDataView(),this.Document.ScreenObject.FillPendingList(!0))}this.Document.ScreenObject.UpdateSequence(),this.Document.RefreshGrid=!0}}}var x=d(11798),f=d(96598);let P=(()=>{class D{constructor(){this.form=new x.gE({})}ngOnInit(){}static{this.\u0275fac=function(e){return new(e||D)}}static{this.\u0275cmp=f.VBU({type:D,selectors:[["app-bulk-posting"]],standalone:!1,decls:3,vars:0,template:function(e,i){1&e&&(f.j41(0,"p"),f.EFF(1,"bulk-posting works!"),f.k0s(),f.EFF(2,"\n"))},encapsulation:2})}}return D})();class U extends G.g{constructor(){super(),this.StaticFields=new Array,this.lstLocation=new A.y$(0),this.lstNames=new c.y$(0),this.dvLoadNames=null,this.dtCompleteData=null,this.dtCompleteData_Columns=null,this.dtLinkColumns=null,this.dtLinkColumns_Columns=null,this.Source=0,this.Destination=0,this.LinkDefId=0,this.DestinationName="",this.dvSouceColumns=null,this.dvSouceColumnsTable=null,this.destinationCOls=new Array,this.lst1=new Array,this.lstCombo=new Array,this.sbAccounts="",this.strStatic="",this.sbNumeric="",this.sbText="",this.sbCC="",this.DisplayName=u.d.GetResource("BulkDocumentPosting"),this.Title=this.DisplayName,this.lstLocation.Label=u.d.GetResource("Location"),this.lstNames.Label=u.d.GetResource("AccountCreate_Name"),this.lstLocation.CCID=50002,this.lstLocation.TypeID=1,this.LoadGrid();let s=y.Document.GetBulkDocumentInfo(0,0);this.LoadNames(s)}LoadNames(s){if(this.lstNames.Items.Clear(),null!=s&&s.Tables[0].length>0){for(let t=0;t<s.Tables[0].length;t++)this.lstNames.Items.push(c._p.ComboBoxItems_2(s.Tables[0][t].NAME.toString(),s.Tables[0][t].BULKID.toString()));this.dvLoadNames=s.Tables[0].DefaultView}this.lstNames.Items.push(c._p.ComboBoxItems_2("New","-100"))}LoadGrid(){this.Grid=new w.vv,this.Grid.CanUserDeleteRows=!0,this.Grid.Table=[],this.Grid.TableColumns.push("Sno"),this.Grid.TableColumns.push("Doc No"),this.Grid.Height=0;let s=new p.O7;this.Grid.Columns=new Array,s=new p.O7,s.Header="S No",s.DisplayMember="Sno",s.DataType="TextBlock",s.Width=150,this.Grid.Columns.push(s),s=new p.O7,s.Header="Doc No",s.DisplayMember="Doc No",s.DataType="TextBlock",s.Width=250,this.Grid.Columns.push(s);for(let t=0;t<20;t++)this.Grid.addEmptyRow()}OnClick(s){if("Show"==s.toString()){if(this.MessageVisibility=!1,0==this.lstLocation.SelectedValue)return this.DisplayMessage="Please Select Location",void(this.MessageVisibility=!0);if(null==this.lstNames.SelectedValue)return this.DisplayMessage="Please Select Name",void(this.MessageVisibility=!0);let t=y.Document.GetBulkDocumentInfo(parseInt(this.lstNames.SelectedValue),this.lstLocation.SelectedValue);if(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("UserColumnName")){this.Grid.Table=[],this.Grid.TableColumns=[];let e=new Array;this.Grid.Columns=new Array;let i=new p.O7;this.Grid.TableColumns.push("InvDocDetailsID"),this.Grid.TableColumns.push("DocNo"),this.Grid.Columns=new Array,i=new p.O7,i.Header="#",i.DisplayMember="Select",i.DataType="CheckBox",i.Width=50,i.IsFrozen=!0,e.push(i),this.Grid.TableColumns.push("Select"),this.destinationCOls.Clear(),t.Tables[0].forEach(m=>{if(i=this.AddColumns(e,i,m),null!=this.lstLocation&&this.lstLocation.SelectedValue>0&&(i.LocationID=this.lstLocation.SelectedValue),"2"==m.Type.toString()&&this.destinationCOls.push(m.SysColumnName.toString()),t.Tables.length>6&&t.Columns[6].Contains("CostCenterColID")){let l=t.Tables[6].filter(C=>C.CostCenterColID==i.ID);l.length>0&&(i.FilterCondition=l[0].UserProbableValues.toString())}}),this.Grid.Columns=e;let o=t.Tables[0];this.dvSouceColumns=o,this.dvSouceColumnsTable=o,o=t.Tables[0].filter(m=>1==m.Type);let n=o.length;o.length>0&&(this.Source=parseInt(o[0].Document.toString())),o=t.Tables[0].filter(m=>2==m.Type),o.length>0&&(this.Destination=parseInt(o[0].Document.toString()),this.DestinationName=o[0].DocumentName.toString()),null!=t&&t.Tables.length>0&&t.Tables[1].length>0&&this.LoadEditData(t,n),null!=t&&t.Tables.length>0&&t.Tables[4].length>0&&(this.dtCompleteData=t.Tables[4],this.dtCompleteData_Columns=t.Columns[4]),null!=t&&t.Tables.length>5&&t.Tables[5].length>0&&(this.LinkDefId=parseInt(t.Tables[5][0][0].toString())),null!=t&&t.Tables.length>0&&t.Tables[3].length>0&&(this.dtLinkColumns=t.Tables[3],this.dtLinkColumns_Columns=t.Columns[3])}}else if("Post"==s.toString()&&this.ValidateOnGrid())try{this.PostDocument()}catch(t){throw t}}ValidateOnGrid(){let s=!1;for(let t=0;t<this.Grid.Table.length;t++)if(this.Grid.TableColumns.Contains("Select")&&(0,g.yG0)(this.Grid.Table[t].Select)){for(let e=1;e<this.Grid.Columns.length;e++)if(this.Grid.Columns[e].Mandatory&&(null==this.Grid.Table[t][this.Grid.Columns[e].DisplayMember].toString()||""==this.Grid.Table[t][this.Grid.Columns[e].DisplayMember].toString()||"0"==this.Grid.Table[t][this.Grid.Columns[e].DisplayMember].toString()))return this.DisplayMessage="Please provide valid details at Column : '"+this.Grid.Columns[e].Header+"'   at  row no:"+(t+1).toString(),this.MessageVisibility=!0,!1;s=!0}return s}CheckForSourceColumnsUpdate(){for(let s=1;s<this.Grid.Columns.length;s++)if(this.Grid.Columns[s].isUpdate)return!0;return!1}CheckForSourceColumnsUpdate_str(s){for(let t=1;t<this.Grid.Columns.length;t++)if(s==this.Grid.Columns[t].DisplayMember&&this.Grid.Columns[t].isUpdate)return!0;return!1}CheckForSourceColumnsUpdate_num(s){for(let t=1;t<this.Grid.Columns.length;t++)if(s.toString()==this.Grid.Columns[t].ID&&this.Grid.Columns[t].isUpdate)return!0;return!1}ReturnINVDocIDsNos(s,t){let e="";if((t=t.filter(i=>i.CreditAccount_Key==s)).length>0)for(let i=0;i<t.length;i++)b.J0.IsEmpty(t[i].InvDocDetailsID)||(e+="'"+t[i].InvDocDetailsID.toString()+"',");return e.Trim(",")}ReturnDocIDs(s,t){let e="";if((t=t.filter(i=>i.VoucherNo==s)).length>0)for(let i=0;i<t.length;i++)b.J0.IsEmpty(t[i].DocID)||(e+="'"+t[i].DocID.toString()+"',");return e.Trim(",")}PostDocument(){this.lst1.Clear(),this.lstCombo.Clear(),this.DisplayMessage="",this.MessageVisibility=!1;let e="",i=new V.a(0,0),o=this.dtCompleteData,n="";if(this.lst1.Clear(),this.lstCombo.Clear(),this.dvSouceColumns=this.dvSouceColumnsTable.filter(l=>1==l.Type),this.CheckForSourceColumnsUpdate()){for(let C=0;C<this.Grid.Table.length&&this.Grid.TableColumns.Contains("DocNo");C++){if(""==this.Grid.Table[C].Select.toString()||0==(0,g.yG0)(this.Grid.Table[C].Select))continue;let a={sbRows:e,DocIDS:n};this.UpdateSourceDocument(a,i,o,C),e=a.sbRows,n=a.DocIDS}let l=y.Document.GetBulkDocumentInfo(parseInt(this.lstNames.SelectedValue),this.lstLocation.SelectedValue);null!=l&&l.Tables.length>0&&l.Tables[4].length>0&&(this.dtCompleteData=l.Tables[4],this.dtCompleteData_Columns=l.Columns[4]),o=this.dtCompleteData}if(this.Destination>0){this.lst1.Clear(),this.lstCombo.Clear();let l=new L.G9,C=0;for(let a=0;a<this.Grid.Table.length;a++)if(""!=this.Grid.Table[a].Select.toString()&&0!=(0,g.yG0)(this.Grid.Table[a].Select))if(C=0,this.Grid.TableColumns.Contains("CreditAccount")&&b.J0.Int(this.Grid.Table[a].CreditAccount_Key)>0?C=parseInt(this.Grid.Table[a].CreditAccount_Key):this.Grid.TableColumns.Contains("CreditAccount1_Key")&&b.J0.Int(this.Grid.Table[a].CreditAccount1_Key)>0&&(C=parseInt(this.Grid.Table[a].CreditAccount1_Key)),l.ContainsKey(C))l[C].ContainsKey(this.Grid.Table[a].DocNo.toString())||l[C].push(this.Grid.Table[a].DocNo.toString(),new Array),l[C][this.Grid.Table[a].DocNo.toString()].push(this.Grid.Table[a]);else{let S=new L.bT;S.push(this.Grid.Table[a].DocNo.toString(),new Array),S[this.Grid.Table[a].DocNo.toString()].push(this.Grid.Table[a]),l.push(C,S)}if(l.length>0){let a=u.d.SessionManager.LocationID;null!=this.lstLocation&&this.lstLocation.SelectedValue>0&&(a=this.lstLocation.SelectedValue);let S=new B(l,this.Destination,this.DestinationName,this.LinkDefId,this.destinationCOls,a);u.d.page.ShowDialog(S,P,{ShowCenter:!0})}}}GetSourceColumnData(s,t){if(s>0){let e=this.Grid.Table.filter(i=>i.InvDocDetailsID==s);if(e.length>0&&("PRODUCTID1"==t.toUpperCase()&&(t="ProductID1_Key"),this.Grid.TableColumns.Contains(t)))return e[0][t].toString()}return""}UpdateSourceDocument(s,t,e,i){let o=0,n=0,m=0,l="";if(this.Grid.TableColumns.Contains("DocNo")&&(this.Grid.TableColumns.Contains("DocNo")&&(l=this.Grid.Table[i].DocNo.toString()),s.DocIDS=this.ReturnDocIDs(l,this.dtCompleteData),0==this.lst1.filter(C=>C.Name==l.toString()).length)){let C=0;e=e.filter(a=>s.DocIDS.split(",").Contains(a.DocID)),this.lst1.push(c._p.ComboBoxItems_1(l.toString())),e.length>0&&(m=parseInt(e[0].DocID)),s.sbRows="",s.sbRows+="<DocumentXML>",this.strStatic="",this.sbNumeric="",this.sbText="",this.sbCC="",this.sbAccounts="",n=this.CheckForSourceColumnsUpdate_str("DebitAccount1")?parseInt(this.GetSourceColumnData(parseInt(e[0].InvDocDetailsID.toString()),"DebitAccount1_Key")):parseInt(e[0].DebitAccount),this.sbAccounts=" DebitAccount="+n,this.sbAccounts+=",",o=this.CheckForSourceColumnsUpdate_str("CreditAccount1")?parseInt(this.GetSourceColumnData(parseInt(e[0].InvDocDetailsID.toString()),"CreditAccount1_Key")):parseInt(e[0].CreditAccount),this.sbAccounts+=" CreditAccount="+o,this.sbAccounts+=",";for(let a=0;a<e.length;a++)if(this.lstCombo.Clear(),this.sbNumeric="",this.sbText="",this.sbCC="",this.strStatic="",this.dtLinkColumns&&this.dtLinkColumns.length>0){this.lstCombo.push(c._p.ComboBoxItems_1("DebitAccount")),this.lstCombo.push(c._p.ComboBoxItems_1("CreditAccount")),this.lstCombo.push(c._p.ComboBoxItems_1("Amount")),this.lstCombo.push(c._p.ComboBoxItems_1("CurrencyID")),this.lstCombo.push(c._p.ComboBoxItems_1("ExchangeRate"));for(let r=0;r<this.dvSouceColumns.length;r++)0==this.lstCombo.filter(k=>k.Name==this.dvSouceColumns[r].SysColumnName.toString()).length&&this.dtCompleteData_Columns.Contains(this.dvSouceColumns[r].SysColumnName.toString())&&this.BuildSourceColumnData(e,a,r);this.sbNumeric.length>0&&(this.sbNumeric=this.sbNumeric.Trim(",")+" where InvDocDetailsID="+e[a].InvDocDetailsID.toString()),this.sbText.length>0&&(this.sbText=this.sbText.Trim(",")+" where InvDocDetailsID="+e[a].InvDocDetailsID.toString()),this.sbCC.length>0&&(this.sbCC=this.sbCC.Trim(",")+" where  InvDocDetailsID="+e[a].InvDocDetailsID.toString()),this.strStatic.length>0&&(this.strStatic=this.strStatic.Trim(",")+" where  InvDocDetailsID="+e[a].InvDocDetailsID.toString()),C=t.UpdateBulkInventoryDocument(this.sbAccounts.Trim(","),this.strStatic,this.sbNumeric,this.sbText,this.sbCC,this.Source,m).RetValue}C>0&&(this.DisplayMessage="Sucessfully Updated"),this.MessageVisibility=!0}}BuildSourceColumnData(s,t,e){this.lstCombo.push(c._p.ComboBoxItems_1(this.dvSouceColumns[e].SysColumnName.toString())),this.dvSouceColumns[e].SysColumnName.toString().Contains("dcNum")?this.CheckForSourceColumnsUpdate_num(parseInt(this.dvSouceColumns[e].CostcenterColID))&&(this.sbNumeric+=this.dvSouceColumns[e].SysColumnName.toString()+"='"+this.GetSourceColumnData(parseInt(s[t].InvDocDetailsID.toString()),this.dvSouceColumns[e].SysColumnName.toString()+"1")+"',"):this.dvSouceColumns[e].SysColumnName.toString().Contains("dcCCNID")?this.CheckForSourceColumnsUpdate_num(parseInt(this.dvSouceColumns[e].CostcenterColID))&&(this.sbCC+=this.dvSouceColumns[e].SysColumnName.toString()+"='"+this.GetSourceColumnData(parseInt(s[t].InvDocDetailsID.toString()),this.dvSouceColumns[e].SysColumnName.toString()+"1_Key")+"',"):this.dvSouceColumns[e].SysColumnName.toString().Contains("dcAlpha")?this.CheckForSourceColumnsUpdate_num(parseInt(this.dvSouceColumns[e].CostcenterColID))&&(this.sbText+=this.dvSouceColumns[e].SysColumnName.toString()+"='"+this.GetSourceColumnData(parseInt(s[t].InvDocDetailsID.toString()),this.dvSouceColumns[e].SysColumnName.toString()+"1")+"',"):(this.dvSouceColumns[e].SysColumnName.toString().Contains("Quantity"),this.CheckForSourceColumnsUpdate_num(parseInt(this.dvSouceColumns[e].CostcenterColID))&&(this.strStatic+=this.dvSouceColumns[e].SysColumnName.toString()+"='"+this.GetSourceColumnData(parseInt(s[t].InvDocDetailsID.toString()),this.dvSouceColumns[e].SysColumnName.toString()+"1")+"',"))}FreshDocument(s,t,e,i){let n,m,l,C,o=0;if(this.Grid.TableColumns.Contains("CreditAccount")&&(o=""!=this.Grid.Table[i].CreditAccount_Key&&0!=parseInt(this.Grid.Table[i].CreditAccount_Key)?parseInt(this.Grid.Table[i].CreditAccount_Key):parseInt(this.Grid.Table[i].CreditAccount1_Key),s.DocIDS=this.ReturnINVDocIDsNos(o,this.Grid.Table),0==this.lst1.filter(S=>S.Name==o.toString()).length)){e=e.filter(r=>s.DocIDS.split(",").Contains(r.InvDocDetailsID)),this.lst1.push(c._p.ComboBoxItems_1(o.toString())),s.sbRows="",s.sbRows+="<DocumentXML>";for(let r=0;r<e.length;r++){if(n="",m="",l="",C="",s.sbRows+="<Row>",s.sbRows+="<AccountsXML><Accounts ",n+="<Transactions ",m+="<Numeric ",l+="<Alpha ",C+="<CostCenters ",this.dtLinkColumns&&this.dtLinkColumns.length>0){let I=1,N=1;s.DebitAccount=parseInt(e[r].DebitAccount),this.lstCombo.push(c._p.ComboBoxItems_1("DebitAccount")),this.lstCombo.push(c._p.ComboBoxItems_1("CreditAccount")),this.lstCombo.push(c._p.ComboBoxItems_1("Amount")),this.lstCombo.push(c._p.ComboBoxItems_1("CurrencyID")),this.lstCombo.push(c._p.ComboBoxItems_1("ExchangeRate")),s.sbRows+='DebitAccount="'+s.DebitAccount+'" ',s.sbRows+='CreditAccount="'+o+'" ',s.sbRows+='Amount="'+I*N+'" ',s.sbRows+='AmtFc="'+I.toString()+'" ',s.sbRows+='CurrencyID="'+e[r].CurrencyID+'" ',s.sbRows+='ExchangeRate="'+e[r].ExchangeRate+'" ',s.sbRows+="></Accounts></AccountsXML>",n+="  DocSeqNo='0'  DocDetailsID='0'  ",n+=" RefNO='"+e[r].Voucherno.toString()+"'  LinkedInvDocDetailsID='"+e[r].InvDocDetailsID.toString()+"' LinkedFieldName='Quantity'  ";for(let h=0;h<this.dtLinkColumns.length;h++)0==this.lstCombo.filter(R=>R.Name==this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString()).length&&this.dtCompleteData_Columns.Contains(this.dtLinkColumns[h][this.dtLinkColumns_Columns[1]].toString())&&(this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString().Contains("dcNum")?this.CheckForSourceColumnsUpdate_num(parseInt(this.dtLinkColumns[h][this.dtLinkColumns_Columns[3]]))?m+=this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString()+'="'+this.GetSourceColumnData(parseInt(e[r].InvDocDetailsID.toString()),this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString())+'" ':m+=this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString()+'="'+e[r][this.dtLinkColumns[h][this.dtLinkColumns_Columns[1]].toString()].toString()+'" ':this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString().Contains("dcCCNID")?this.CheckForSourceColumnsUpdate_num(parseInt(this.dtLinkColumns[h][this.dtLinkColumns_Columns[3]]))?C+=this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString()+'="'+this.GetSourceColumnData(parseInt(e[r].InvDocDetailsID.toString()),this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString())+'" ':C+=this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString()+'="'+e[r][this.dtLinkColumns[h][this.dtLinkColumns_Columns[1]].toString()].toString()+'" ':this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString().Contains("dcAlpha")?this.CheckForSourceColumnsUpdate_num(parseInt(this.dtLinkColumns[h][this.dtLinkColumns_Columns[3]]))?l+=this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString()+'="'+this.GetSourceColumnData(parseInt(e[r].InvDocDetailsID.toString()),this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString())+'" ':l+=this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString()+'="'+e[r][this.dtLinkColumns[h][this.dtLinkColumns_Columns[1]].toString()].toString()+'" ':this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString().Contains("Quantity")?(n+='LinkedFieldValue="'+e[r].Quantity.toString()+'" ',n+=this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString()+'="'+e[r][this.dtLinkColumns[h][this.dtLinkColumns_Columns[1]].toString()].toString()+'" '):this.CheckForSourceColumnsUpdate_num(parseInt(this.dtLinkColumns[h][this.dtLinkColumns_Columns[3]]))?n+=this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString()+'="'+this.GetSourceColumnData(parseInt(e[r].InvDocDetailsID.toString()),this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString())+'" ':n+=this.dtLinkColumns[h][this.dtLinkColumns_Columns[2]].toString()+'="'+e[r][this.dtLinkColumns[h][this.dtLinkColumns_Columns[1]].toString()].toString()+'" ');n+='DebitAccount="'+s.DebitAccount+'" ',n+='CreditAccount="'+o+'" ',n+='Amount="'+I*N+'" ',n+='AmtFc="'+I.toString()+'" ',n+='CurrencyID="'+e[r].CurrencyID+'" ',n+='ExchangeRate="'+e[r].ExchangeRate+'" ',m+=" ></Numeric>",l+=" ></Alpha>",C+=" ></CostCenters>",n+=" ></Transactions>"}s.sbRows+=n.toString()+m.toString()+C.toString()+l.toString(),s.sbRows+="</Row>"}s.sbRows+="</DocumentXML>",t.CostCenterID=this.Destination,t.DocID=0;let S=0;if(null!=this.dvLoadNames&&(S=parseInt(this.dvLoadNames[0].MappingType)),1==S)this.MessageVisibility=!0;else if(2==S){let r=new M.AddEditDocumentViewModel(this.Destination,this.Destination.toString(),!0);r.ScreenObject.DocPrefix.ComboBox.SelectedValue="",r.ScreenObject.DocPrefix.TextBox.Text="",r.OnDocPrefixChanged("lostFocus"),r.ScreenObject.FillDocumentPrefix(!0),u.d.page.addNewTab({component:v.AddEditDocumentComponent,params:{obj:r}})}}}CheckExistingColumn(s){for(let t=1;t<this.Grid.Columns.length;t++)if(s==this.Grid.Columns[t].DisplayMember)return!0;return!1}LoadEditData(s,t){s.Tables[2][0][s.Columns[2][0]].toString().split(",");for(let i=0;i<s.Tables[1].length;i++){let o=this.Grid.NewRow();o.Select=!1,this.Grid.TableColumns.Contains("InvDocDetailsID")&&(o.InvDocDetailsID=s.Tables[1][i].InvDocDetailsID.toString()),this.Grid.TableColumns.Contains("DocNo")&&(o.DocNo=s.Tables[1][i].Docno.toString());for(let n=0;n<t;n++)if("DATE"==this.Grid.Columns[n+1].DataType){if(!b.J0.IsEmpty(s.Tables[1][i][this.Grid.Columns[n+1].DisplayMember.Remove(this.Grid.Columns[n+1].DisplayMember.length-1,1)])){let m="dd/MMM/yyyy";u.d.SessionManager.Preferences.ContainsKey("Date Format")&&""!=u.d.SessionManager.Preferences["Date Format"]&&(m=u.d.SessionManager.Preferences["Date Format"]),o[this.Grid.Columns[n+1].DisplayMember]=b.J0.ParseDate(s.Tables[1][i][this.Grid.Columns[n+1].DisplayMember.Remove(this.Grid.Columns[n+1].DisplayMember.length-1,1)].toString()).ToString(m),o[this.Grid.Columns[n+1].DisplayMember+"_Key"]=b.J0.ParseDate(s.Tables[1][i][this.Grid.Columns[n+1].DisplayMember.Remove(this.Grid.Columns[n+1].DisplayMember.length-1,1)].toString())}}else"ComboBox"==this.Grid.Columns[n+1].DataType?o[this.Grid.Columns[n+1].ValueBinding]=s.Tables[1][i][this.Grid.Columns[n+1].ValueBinding.Remove(this.Grid.Columns[n+1].ValueBinding.length-1,1)]:"PactComboBox"==this.Grid.Columns[n+1].DataType?(o[this.Grid.Columns[n+1].ValueBinding]=s.Tables[1][i][this.Grid.Columns[n+1].ValueBinding.Remove(this.Grid.Columns[n+1].ValueBinding.length-1,1)],o[this.Grid.Columns[n+1].ValueBinding+"_Key"]=s.Tables[1][i][this.Grid.Columns[n+1].ValueBinding.Remove(this.Grid.Columns[n+1].ValueBinding.length-1,1)]):"FLOAT"==this.Grid.Columns[n].DataType?b.J0.IsNum(s.Tables[1][i][this.Grid.Columns[n+1].DisplayMember.Remove(this.Grid.Columns[n+1].DisplayMember.length-1,1)])&&(o[this.Grid.Columns[n+1].DisplayMember]=s.Tables[1][i][this.Grid.Columns[n+1].DisplayMember.Remove(this.Grid.Columns[n+1].DisplayMember.length-1,1)]):3==this.Grid.Columns[n+1].CostCenterID?o[this.Grid.Columns[n+1].ValueMember]=s.Tables[1][i].ProductID:"LISTBOX"==this.Grid.Columns[n+1].DataType?o[this.Grid.Columns[n+1].ValueMember]=s.Tables[1][i][this.Grid.Columns[n+1].DisplayMember.Remove(this.Grid.Columns[n+1].DisplayMember.length-1,1)]:o[this.Grid.Columns[n+1].DisplayMember]=s.Tables[1][i][this.Grid.Columns[n+1].DisplayMember.Remove(this.Grid.Columns[n+1].DisplayMember.length-1,1)];this.Grid.Table.push(o)}this.Grid.refreshDataView()}AddColumns(s,t,e){let i=e.SysColumnName.toString();switch("1"==e.type.toString()&&(i+="1"),(t=new p.O7).Header=e.UserColumnName.toString(),t.DisplayMember=i,t.DataType=e.ColumnDataType.toString().toUpperCase(),t.ReadOnly=(0,g.yG0)(e.ReadOnly.toString()),t.IsColumnUserDefined=(0,g.yG0)(e.IsColumnUserDefined.toString()),t.Mandatory=(0,g.yG0)(e.Mandatory),t.isUpdate=(0,g.yG0)(e.Update),t.Width=150,t.ID=e.CostCenterColID.toString(),"VOUCHERNO"==t.DisplayMember.toUpperCase()&&(t.IsFrozen=!0),e.ColumnDataType.toString().toUpperCase()){case"BIGINT":case"INT":this.Grid.TableColumns.push(i);break;case"FLOAT":this.Grid.TableColumns.push(i),i.toLowerCase().Contains("dcnum")?(t.DefaultValue=e.UserDefaultValue.toString(),this.Grid.TableColumns.push("dcCalc"+i),b.J0.Double(e.Decimal)>0?t.DecimalPoints=e.Decimal.toString():u.d.SessionManager.Preferences.ContainsKey("DecimalsinExtraFields")&&""!=u.d.SessionManager.Preferences.DecimalsinExtraFields&&(t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinExtraFields)):i.toLowerCase().Contains("dcexchrt")||("Quantity"==i?(this.Grid.TableColumns.push("Linked"+i),u.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=u.d.SessionManager.Preferences.DecimalsinQty&&(t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinQty)):"Gross"==i||"Rate"==i?("Gross"==i&&this.Grid.TableColumns.push("Linked"+i),u.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=u.d.SessionManager.Preferences.DecimalsinRate&&(t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinRate)):("Amount"==i||"DebitAmount"==i||"CreditAmount"==i)&&u.d.SessionManager.Preferences.ContainsKey("DecimalsinAmount")&&""!=u.d.SessionManager.Preferences.DecimalsinAmount&&(t.DecimalPoints=u.d.SessionManager.Preferences.DecimalsinAmount)),"Quantity"==i?t.ShowTotal=!(!u.d.SessionManager.Preferences.ContainsKey("ShowQtyTotal")||""==u.d.SessionManager.Preferences.ShowQtyTotal||!(0,g.yG0)(u.d.SessionManager.Preferences.ShowQtyTotal)):("DebitAmount"==i||"CreditAmount"==i||!i.toLowerCase().Contains("dcexchrt")&&"exchangerate"!=i.toLowerCase()&&"rate"!=i.toLowerCase()&&(0,g.yG0)(e.ShowTotal))&&(t.ShowTotal=!0);break;case"LISTBOX":t.ValueMember="accountid"==i.toLowerCase()||"debitaccount"==i.toLowerCase()||"creditaccount"==i.toLowerCase()?"":i+"_Key","unit"==i.toLowerCase()?(this.Grid.TableColumns.push(i),this.Grid.TableColumns.push(i+"_Key"),this.Grid.TableColumns.push("UOMConversion"),this.Grid.TableColumns.push("UOMConvertedQty")):"productid1"==i.toLowerCase()||"productid"==i.toLowerCase()?(t.ValueMember="ProductID_Key",t.DisplayMember=e.UserColumnName.toString(),this.Grid.TableColumns.push(t.DisplayMember),this.Grid.TableColumns.Contains(t.ValueMember)||this.Grid.TableColumns.push(t.ValueMember)):"accountid"==i.toLowerCase()||"debitaccount"==i.toLowerCase()||"creditaccount"==i.toLowerCase()?(t.ValueMember=i+"_Key",i.Trim(),t.DisplayMember=i.Replace(" ",""),this.Grid.TableColumns.push(t.DisplayMember),this.Grid.TableColumns.Contains(t.ValueMember)||this.Grid.TableColumns.push(t.ValueMember)):(this.Grid.TableColumns.push(i),this.Grid.TableColumns.push(i+"_Key")),t.CostCenterID=parseInt(e.ColumnCostCenterID.toString()),t.TypeID=parseInt(e.ColumnCCListViewTypeID.toString()),u.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==u.d.SessionManager.Preferences.EnableDivisionWise.toString()&&50001==t.CostCenterID&&(t.ReadOnly=!0),u.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==u.d.SessionManager.Preferences.EnableLocationWise.toString()&&50002==t.CostCenterID&&(t.ReadOnly=!0);break;case"TEXT":case"COMBOTEXT":case"STRING":if(this.Grid.TableColumns.push(i),t.IsColumnUserDefined)if("Date"==e.UserColumnType.toString())t.DataType="DATE",this.Grid.TableColumns.push(i+"_Key");else if("Numeric"==e.UserColumnType.toString())t.DataType="FLOAT";else if("SELECTIONBOX"==e.UserColumnType.toString()||"editablecombobox"==e.UserColumnType.toString().toLowerCase())t.DataType="SELECTIONBOX",t.CostCenterID=0;else if("Combobox"==e.UserColumnType.toString()){if(t.ValueBinding=i,this.Grid.TableColumns.Contains("linkData")&&22803==b.J0.Int(e.linkData)){t.DataType="PactComboBox";let o=[];for(let n=1980;n<2100;n++){let m={};m.Year=n.toString(),o.push(m)}t.DisplayMember="Year",t.ValueMember="Year",t.ComboData=o}else{t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value";let o=[],n=e.UserProbableValues.toString().Trim();if(n.length>0){let m=n.split(";");for(let l=0;l<m.length;l++)o.push(c._p.ComboBoxItems_2(m[l],m[l]))}t.ComboData=o}this.Grid.TableColumns.push(i+"_Key")}else"LISTBOX"==e.UserColumnType.toString()&&(t.DataType="LISTBOX",t.CostCenterID=0,t.ValueMember=i+"_Key",this.Grid.TableColumns.push(i+"_Key"),t.CostCenterID=parseInt(e.ColumnCostCenterID.toString()),t.TypeID=parseInt(e.ColumnCCListViewTypeID.toString()));else if("VoucherType"==i){t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.ValueBinding=i;let o=[];o.push(c._p.ComboBoxItems_2(u.d.GetResource("StockJVIssue"),"-1")),o.push(c._p.ComboBoxItems_2(u.d.GetResource("StockJVRecieve"),"1")),t.ComboData=o}break;case"DATE":t.DataType="DATE",this.Grid.TableColumns.push(i),this.Grid.TableColumns.push(i+"_Key")}return s.push(t),t}}}}]);