"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[6084],{63703:(S,f,a)=>{a.r(f),a.d(f,{DocumentDraftsViewModel:()=>y});var s=a(74523),n=a(32040),l=a(43767),I=a(98580),c=a(7321),r=a(21774),m=a(3338),p=a(61301),C=a(76555),T=a(82503);class y extends I.g{get Table(){return this.Grid.Table}set Table(o){this.Grid.Table=o}get TableColumns(){return this.Grid.TableColumns}set TableColumns(o){this.Grid.TableColumns=o}get ColSource(){return this.Grid.Columns}set ColSource(o){this.Grid.Columns=o}get SelectedRow(){return this.Grid.SelectedItem}set SelectedRow(o){this.Grid.SelectedItem=o}constructor(o,i,D=0){if(super(),this.Grid=new c.vv,this.IsFromDocs=!1,this.PopupWidth=0,this.ReportType=0,this.Parent=null,this.CCID=0,this.WID=0,this.LevelID=0,this.PactGridVisible=!1,this.iScreenWidth="",this.CCID=D,this.Parent=o,this.ReportType=i,this.Parent instanceof m.GeneralDashboardViewModel||"DashAddOnsViewModel"==this.Parent.ClassName)1==i&&(this.ColSource=m.GeneralDashboardViewModel.InitColumns("Document Drafts_DashBoardCustomize"));else{let e;if(1==i?this.DisplayName="Drafts":2==i?this.DisplayName="Hold Documents":3==i?this.DisplayName="Approval History":4==i?(this.DisplayName="Level Info",this.PactGrid=new c.vv):5==i&&(this.DisplayName="Task History",this.PactGrid=new c.vv),this.Title=this.DisplayName,this.IsFromDocs=!0,this.FillGrid(),this.Grid.OnLinkClick.Subscribe(this,"GridLinkClick"),this.ColSource=[],1==i){if(this.ColSource=m.GeneralDashboardViewModel.InitColumns("Document Drafts_DashBoardCustomize"),"AddEditRenContractViewModel"==this.Parent.ClassName){let t=new r.O7;t.Header="Property",t.DisplayMember="Property",t.ReadOnly=!0,t.Width=150,this.ColSource.push(t),t=new r.O7,t.Header="Unit",t.DisplayMember="Unit",t.ReadOnly=!0,t.Width=100,this.ColSource.push(t),t=new r.O7,t.Header="Tenant",t.DisplayMember="Tenant",t.ReadOnly=!0,t.Width=100,this.ColSource.push(t)}this.PopupWidth=22,this.ColSource.forEach(t=>{this.PopupWidth=this.PopupWidth+t.Width})}else 2==i?(this.TableColumns.Contains("Register")&&(e=new r.O7,e.DataType="TextBlock",e.Header="Register",e.DisplayMember="Register",e.Width=100,this.ColSource.push(e)),e=new r.O7,e.DataType="TextBlock",e.Header="Hold Date",e.DisplayMember="HoldDate_Key",e.Width=100,this.ColSource.push(e),e=new r.O7,e.DataType="LINK",e.Header=n.d.GetResource("DocName"),e.DisplayMember="DocName",e.Width=135,this.ColSource.push(e),e=new r.O7,e.DataType="TextBlock",e.Header="NetValue",e.DisplayMember="NetValue",e.Width=100,this.ColSource.push(e),e=new r.O7,e.DataType="TextBlock",e.Header="NoOfProducts",e.DisplayMember="NoOfProducts",e.Width=50,this.ColSource.push(e),e=new r.O7,e.DataType="LINK",e.Header=n.d.GetResource("Delete"),e.DisplayMember="Delete",e.Width=100,this.ColSource.push(e),this.PopupWidth=450):3==i?(e=new r.O7,e.DataType="TextBlock",e.Header="User",e.DisplayMember="CreatedBy",e.Width=90,this.ColSource.push(e),e=new r.O7,e.DataType="TextBlock",e.Header="FirstName",e.DisplayMember="FirstName",e.Width=90,this.ColSource.push(e),e=new r.O7,e.DataType="TextBlock",e.Header="LastName",e.DisplayMember="LastName",e.Width=90,this.ColSource.push(e),e=new r.O7,e.DataType="TextBlock",e.Header="Email",e.DisplayMember="Email1",e.Width=150,this.ColSource.push(e),e=new r.O7,e.DataType="TextBlock",e.Header=n.d.GetResource("Date"),e.DisplayMember="AppDate",e.Width=128,this.ColSource.push(e),e=new r.O7,e.DataType="LINK",e.Header="Level",e.DisplayMember="LevelName",e.Width=93,this.ColSource.push(e),e=new r.O7,e.DataType="TextBlock",e.Header="Status",e.DisplayMember="Status",e.Width=80,this.ColSource.push(e),e=new r.O7,e.DataType="TextBlock",e.Header="Remarks",e.DisplayMember="Remarks",e.Width=190,this.ColSource.push(e),this.PopupWidth=1050,"AddEditDocumentViewModel"==this.Parent.ClassName&&(e=new r.O7,e.Header="WorkFlowName",e.DisplayMember="WorkFlowName",e.Width=200,this.ColSource.push(e)),this.PopupWidth=1050):4==i?(e=new r.O7,e.DataType="TextBlock",e.ReadOnly=!0,e.Header="User Name",e.DisplayMember="UserName",e.Width=120,this.ColSource.push(e),e=new r.O7,e.DataType="TextBlock",e.ReadOnly=!0,e.Header="First Name",e.DisplayMember="FirstName",e.Width=120,this.ColSource.push(e),e=new r.O7,e.DataType="TextBlock",e.ReadOnly=!0,e.Header="Last Name",e.DisplayMember="LastName",e.Width=120,this.ColSource.push(e),this.PactGrid.Columns=this.ColSource,this.PopupWidth=400):5==i&&(e=new r.O7,e.DataType="TextBlock",e.ReadOnly=!0,e.Header="Start Date",e.DisplayMember="StartDate",e.Width=100,this.ColSource.push(e),e=new r.O7,e.DataType="TextBlock",e.ReadOnly=!0,e.Header="End Date",e.DisplayMember="EndDate",e.Width=100,this.ColSource.push(e),e=new r.O7,e.DataType="TextBlock",e.ReadOnly=!0,e.Header="Status",e.DisplayMember="Status",e.Width=100,this.ColSource.push(e),e=new r.O7,e.DataType="TextBlock",e.ReadOnly=!0,e.Header="Duration",e.ShowTotal=!0,e.DisplayMember="Duration",e.Width=80,this.ColSource.push(e),this.PactGrid.Columns=this.ColSource,this.PopupWidth=400)}this.iScreenWidth=this.PopupWidth+"px"}onClick(o){event.preventDefault(),null!=this.SelectedRow&&this.LoadDraft(this.SelectedRow)}FillGrid(){let o=0,i=0,D=0,e=null;if("AddEditDocumentViewModel"==this.Parent.ClassName||"POSDocumentViewModel"==this.Parent.ClassName?(e=this.Parent,i=e.ScreenObject.LocationID,D=e.ScreenObject.DivisionID,o=0==this.CCID?e.CostCenterID:this.CCID):!l.J0.IsEmpty(this.Parent.ClassName)&&"AddEditRenContractViewModel"==this.Parent.ClassName&&(o=this.CCID),1==this.ReportType||2==this.ReportType){let t=[];t=l.J0.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?null==e||38!=e.ScreenObject.DocumentType&&39!=e.ScreenObject.DocumentType?n.d.document.GetDocumentDrafts(0,o,this.ReportType,!1,!1,i,D):n.d.document.GetDocumentDrafts(e.ScreenObject.RegisterNodeID,o,this.ReportType,!1,!0,i,D):n.d.document.GetDocumentDrafts(0,this.Parent.CostCenterID,this.ReportType,!1),null!=t&&t.Tables.length>0&&(this.Table=t.Tables[0],this.TableColumns=t.Columns[0],this.TableColumns.Contains("Date_Text")||(this.Grid.TableColumns.push("Date_Text"),this.Grid.TableColumns.push("Delete")),this.TableColumns.Contains("HoldDate_Key")||this.TableColumns.push("HoldDate_Key"),this.Table.forEach(d=>{d.Delete="Delete",d.id=n.d.slick.rowid,d.Date_Text=l.J0.ParseDate(d.Date).ToString(n.d.SessionManager.Preferences["Date Format"]+" hh:mm a"),null!=d.HoldDate&&(d.HoldDate_Key=l.J0.ParseDate(d.HoldDate).ToString(n.d.SessionManager.Preferences["Date Format"]))}))}else if(3==this.ReportType){let t=null;if("AddEditDocumentViewModel"==this.Parent.ClassName?(t=this.Parent.ScreenObject.GetDocStatusHistory(),t.Tables.length>1&&t.Tables[1].length>0&&t.Columns[1].Contains("WID")&&(this.WID=parseInt(t.Tables[1][0].WID))):l.J0.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?l.J0.IsEmpty(this.Parent.ClassName)||"AddEditCasesViewModel"!=this.Parent.ClassName?l.J0.IsEmpty(this.Parent.ClassName)||"AddEditAccountViewModel"!=this.Parent.ClassName?l.J0.IsEmpty(this.Parent.ClassName)||"AddProductScreenViewModel"!=this.Parent.ClassName?l.J0.IsEmpty(this.Parent.ClassName)||"AddCostCenterViewModel"!=this.Parent.ClassName?l.J0.IsEmpty(this.Parent.ClassName)||"AddEditUnitsViewModel"!=this.Parent.ClassName?l.J0.IsEmpty(this.Parent.ClassName)||"AddEditTenantViewModel"!=this.Parent.ClassName?l.J0.IsEmpty(this.Parent.ClassName)||"AddEditPropertyViewModel"!=this.Parent.ClassName?l.J0.IsEmpty(this.Parent.ClassName)||"AddEditLeads"!=this.Parent.ClassName?l.J0.IsEmpty(this.Parent.ClassName)||"AddEditOpportunity"!=this.Parent.ClassName?l.J0.IsEmpty(this.Parent.ClassName)||"AddCustomerViewModel"!=this.Parent.ClassName?l.J0.IsEmpty(this.Parent.ClassName)||"AssetManagement"!=this.Parent.ClassName?l.J0.IsEmpty(this.Parent.ClassName)||"AddEditBOMViewModel"!=this.Parent.ClassName?!l.J0.IsEmpty(this.Parent.ClassName)&&"MultiBOMTreeViewModel"==this.Parent.ClassName&&(t=this.GetDocStatusHistory(this.Parent.CostCenterID,this.Parent.BID,!1)):t=this.GetDocStatusHistory(this.Parent.CostCenterID,this.Parent.BID,!1):t=this.GetDocStatusHistory(this.Parent.CostCenterID,this.Parent.objAsset.AMAssetID,!1):t=this.GetDocStatusHistory(this.Parent.CostCenterID,this.Parent.obj.CustomerID,!1):t=this.GetDocStatusHistory(this.Parent.CostCenterID,this.Parent.OppID,!1):t=this.GetDocStatusHistory(this.Parent.CostCenterID,this.Parent.LeadID,!1):t=this.GetDocStatusHistory(this.Parent.CostCenterID,this.Parent.PropertyID,!1):t=this.GetDocStatusHistory(this.Parent.CostCenterID,this.Parent.TntObj.TenantID,!1):t=this.GetDocStatusHistory(this.Parent.CostCenterID,this.Parent.UnitID,!1):t=this.GetDocStatusHistory(this.Parent.CostCenterID,this.Parent.NodeID,!1):t=this.GetDocStatusHistory(3,this.Parent.ProductID,!1):t=this.GetDocStatusHistory(2,this.Parent.AccountID,!1):t=this.GetDocStatusHistory(73,this.Parent.CaseID,!1):t=n.d.rental.GetHistory(o,this.Parent.ContractID),null!=t&&t.Tables.length>0){this.Table=t.Tables[0],this.Grid.TableColumns.push("AppDate");let d=0,u=0;for(let h=0;h<this.Table.length;h++)""!=this.Table[h].Date.toString()&&(this.Table[h].AppDate=l.J0.ParseDate(this.Table[h].Date.toString()).ToString(n.d.SessionManager.Preferences["Date Format"]+" hh:mm a")),u=l.J0.IntTryParse(this.Table[h].StatusID.toString()),499!=u&&438!=u&&(d=l.J0.IntTryParse(this.Table[h].WorkFlowLevel.toString()));369!=u&&(t.Tables[1]=t.Tables[1].filter(h=>h.levelID>d),t.Tables[1].forEach(h=>{let P=this.Grid.NewRow();P.LevelName=h.LevelName,P.Status="Pending",P.WorkFlowLevel=h.levelID,this.Grid.addRow(P)}));for(let h=this.Table.length;h<7;h++)this.Grid.addEmptyRow()}}else if(4==this.ReportType){let t=null;if("WFLevelDoc"==this.Parent.ClassName?t=n.d.SessionManager.Preferences.ContainsKey("CanApproveFunction")&&"True"==n.d.SessionManager.Preferences.CanApproveFunction?n.d.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.ccid,this.Parent.DOcId):n.d.report.GetWorkFlowLevelDetails(this.Parent.WID,this.Parent.LevelID,this.Parent.ccDate):this.Parent instanceof y&&(n.d.SessionManager.Preferences.ContainsKey("CanApproveFunction")&&"True"==n.d.SessionManager.Preferences.CanApproveFunction?"AddEditDocumentViewModel"==this.Parent.Parent.ClassName?t=n.d.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.Parent.CostCenterID,this.Parent.Parent.ScreenObject.DocID):"ReportViewModel"==this.Parent.Parent.ClassName&&"INV_ComparisonReport"==this.Parent.Parent.StaticReportObject&&(t=n.d.report.GetExtWFDet(this.Parent.WID,this.Parent.LevelID,this.Parent.Parent.StaticReportObject.QuotationDocument,this.Parent.Parent.StatusDocID)):t=n.d.report.GetWorkFlowLevelDetails(this.Parent.WID,this.Parent.LevelID,"AddEditDocumentViewModel"==this.Parent.Parent.ClassName?this.Parent.Parent.ScreenObject.DocDate.Date:Date.Today())),null!=t){for(let d=t.Tables[0].length;d<8;d++)t.Tables[0].push();this.PactGrid.Table=t.Tables[0]}this.PactGrid.Width="",this.PactGrid.SearchVisible=!0,this.PactGrid.SearchCols.Width="85",this.PactGrid.SearchOptions.Width="90",this.PactGrid.SearchText.Width="110",this.PactGridVisible=!0}else if(5==this.ReportType){let t=n.d.common.GetDataSet3("DDVM001",this.Parent.CostCenterID,this.Parent.NodeID);if(null!=t){for(let d=t.Tables[0].length;d<8;d++)t.Tables[0].push();this.PactGrid.Table=t.Tables[0]}this.PactGrid.Width="",this.PactGrid.SearchVisible=!1,this.PactGridVisible=!0}}GetDocStatusHistory(o,i,D){Logger.InfoLog("DocumentDraftsViewModel:: Inside GetDocStatusHistory");let e=[];e.push(o),e.push(i),e.push(D),e.push(n.d.SessionManager.UserID),e.push(n.d.SessionManager.LanguageID);let t=n.d.document.GetDocStatusHistory(e);return Logger.InfoLog("DocumentDraftsViewModel:: Exiting GetDocStatusHistory"),t}OnButtonClick(o){"Cancel"==o.toString()&&("AddEditDocumentViewModel"==this.Parent.ClassName&&this.CCID>0&&(this.Parent.res="No"),n.d.page.HideDialog(this.PopUpGUID))}DeleteDraft(o){let D;D=l.J0.IsEmpty(this.Parent.ClassName)||"AddEditRenContractViewModel"!=this.Parent.ClassName?n.d.document.DeleteDocumentDraft(parseInt(o.DraftID)):n.d.rental.DeleteQuotation(parseInt(o.CostCenterID),parseInt(o.DraftID)),D.RetValue>0&&this.Grid.removeRow(o)}LoadDraft(o){var i=this;return(0,s.A)(function*(){if(l.J0.IsEmpty(i.Parent.ClassName)||"AddEditRenContractViewModel"!=i.Parent.ClassName){const{AddEditDocumentViewModel:e}=yield Promise.all([a.e(9891),a.e(534),a.e(7996),a.e(1755),a.e(3884),a.e(7030),a.e(4628),a.e(5984),a.e(5152),a.e(8405),a.e(895),a.e(5819),a.e(6015),a.e(2963),a.e(108),a.e(2290),a.e(8024),a.e(3364),a.e(9284),a.e(9128),a.e(1938),a.e(2726),a.e(4065),a.e(2014),a.e(2209),a.e(2771),a.e(4882),a.e(4119),a.e(2076)]).then(a.bind(a,5109)),{AddEditDocumentComponent:t}=yield Promise.all([a.e(7996),a.e(8405),a.e(895),a.e(1884)]).then(a.bind(a,30786));let d,u={};if(u=n.d.document.GetDocumentDrafts(parseInt(o.DraftID),0,1,!1),null!=u&&u.Tables.length>0&&(d=u.Tables[0],null!=d&&d.length>0))if("AddEditDocumentViewModel"==i.Parent.ClassName||"POSDocumentViewModel"==i.Parent.ClassName){if(i.CCID>0||(i.Parent.clear(1),i.Parent.LoadDraftXML(d[0]),n.d.page.HideDialog(i.PopUpGUID),i.Parent.ScreenObject.GridDataObj.RefreshGridView()),38==i.Parent.ScreenObject.DocumentType||39==i.Parent.ScreenObject.DocumentType||i.Parent.ScreenObject.GridDataColumns.Contains("FieldType")){var D=i.Parent.ScreenObject.HeaderFields.find(h=>h instanceof T.l6&&"docdate"==h.DBColumnName.toLowerCase());null!=D&&!l.J0.IsEmpty(i.Parent.ScreenObject.Data.Tables[1][0].Day)&&(D.DefaultValue=l.J0.String(i.Parent.ScreenObject.Data.Tables[1][0].Day),D.Date=new Date(l.J0.String(i.Parent.ScreenObject.Data.Tables[1][0].Day)),D.Text=new Date(l.J0.String(i.Parent.ScreenObject.Data.Tables[1][0].Day)).ToString(n.d.SessionManager.Preferences["Date Format"]),i.Parent.DocumentDate=new Date(l.J0.String(i.Parent.ScreenObject.Data.Tables[1][0].Day)))}}else{let h=1==i.ReportType,P=new e(parseInt(o.CostCenterID),o.Type.toString(),h);n.d.page.addNewTab({component:t,params:{obj:P}}),P.LoadDraftXML(d[0],h)}}else p.RibbonExtViewModel.LoadDraftRentalContract(i.Parent,parseInt(o.DraftID)),n.d.page.HideDialog(i.PopUpGUID)})()}GridLinkClick(o,i,D){if(event.preventDefault(),"Delete"==i)this.DeleteDraft(o);else if("Date_Text"==i||"DocName"==i)this.LoadDraft(o);else if("LevelName"==i){let e=this.Grid.SelectedItem;null!=e&&l.J0.StringValue(e.WorkFlowLevel).toString().length>0&&(this.LevelID=parseInt(e.WorkFlowLevel),n.d.page.ShowDialog(new y(this,4),C.DocumentDraftsComponent,{ShowCenter:!0}))}}}},76555:(S,f,a)=>{a.r(f),a.d(f,{DocumentDraftsComponent:()=>I});var s=a(96598);function n(c,r){if(1&c&&(s.j41(0,"div",6),s.EFF(1,"\n            "),s.nrm(2,"app-PactGridView",7),s.EFF(3,"  \n        "),s.k0s()),2&c){const m=s.XpG();s.R7$(2),s.Y8G("obj",m.obj.Grid)("group",m.form)}}function l(c,r){if(1&c&&(s.j41(0,"div",6),s.EFF(1,"\n            "),s.nrm(2,"app-PactGridView",7),s.EFF(3,"  \n        "),s.k0s()),2&c){const m=s.XpG();s.R7$(2),s.Y8G("obj",m.obj.PactGrid)("group",m.form)}}let I=(()=>{class c{constructor(){}ngOnInit(){}static{this.\u0275fac=function(p){return new(p||c)}}static{this.\u0275cmp=s.VBU({type:c,selectors:[["app-document-drafts"]],inputs:{obj:"obj"},standalone:!1,decls:21,vars:7,consts:[[1,"master-screen",2,"padding-bottom","4px"],[1,"PACTHeaderFields","row","form-row","dialogSubBody"],["class","row form-row","style","width: 100%;",4,"ngIf"],[1,"Pactdailogfooter"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[1,"row","form-row",2,"width","100%"],[2,"width","100%",3,"obj","group"]],template:function(p,C){1&p&&(s.j41(0,"div",0),s.EFF(1,"\n    "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.DNE(4,n,4,2,"div",2),s.EFF(5,"\n        "),s.DNE(6,l,4,2,"div",2),s.EFF(7,"\n    "),s.k0s(),s.EFF(8,"\n    "),s.j41(9,"div",3),s.EFF(10,"\n      "),s.j41(11,"div"),s.EFF(12,"\n        "),s.j41(13,"button",4),s.bIt("click",function(){return C.obj.OnButtonClick("Cancel")}),s.nrm(14,"i",5),s.EFF(15),s.nI1(16,"translate"),s.k0s(),s.EFF(17,"\n      "),s.k0s(),s.EFF(18,"\n  "),s.k0s(),s.EFF(19,"\n"),s.k0s(),s.EFF(20,"\n")),2&p&&(s.xc7("width",C.obj.IsMobile?"unset":C.obj.iScreenWidth),s.R7$(4),s.Y8G("ngIf",!C.obj.PactGridVisible),s.R7$(2),s.Y8G("ngIf",C.obj.PactGridVisible),s.R7$(9),s.JRh(s.bMT(16,5,"Cancel")))},encapsulation:2})}}return c})()}}]);