"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[5078],{35078:(p,c,r)=>{r.r(c),r.d(c,{UpdatePayTermsViewModel:()=>f});var n=r(32040),o=r(43767),u=r(54581),S=r(98580),g=r(23458),h=r(27730),P=r(82503),y=r(84151),m=r(7321),d=r(21774),b=r(61301),T=r(58170);class f extends S.g{get Title(){return this.DisplayName}get MxHeight(){return(window.innerHeight-150).toString()}get SelectAll(){return this._SelectAll}set SelectAll(e){e!=this._SelectAll&&(this._SelectAll=e,this.SelectAllRows())}get angularGrid(){return this.PstDocGrid.angularGrid}get PstDocGridTable(){return this.PstDocGrid.Table}get PstDocGridTableColumns(){return this.PstDocGrid.TableColumns}get angularGrid1(){return this.PartGrid.angularGrid}get PartGridTable(){return this.PartGrid.Table}get PartGridTableableColumns(){return this.PartGrid.TableColumns}constructor(e){super(),this.SavePostedDocument=new T.Yk,this._SelectAll=!1,this.Payterms=new h.y$,this.Phases=new h.y$,this.Filter=new h.y$,this.CopyRows=new y.Dw,this.IsCancelVisible=!1,this.IsSaveVisible=!0,this.Aliasname="",this.Rows=[],this.Calltype=0,this.dsPayterms=null,this.CCID=0,this.CompletionDateColName="",this.DocCCID="",this.Columns="",this.Joins="",this.CopyRows.Visible=!1,this.DisplayName=e,this.PstDocGrid=new m.vv,this.PartGrid=new m.vv,this.onLoad(),this.IsCancelVisible=!1,this.Filter.Visible=!1}onLoad(){this.InitColumns(),this.SavePostedDocument.Subscribe(this,"ButtonSave")}InitColumns(){let e;this.Tower=new g.y$(0),this.CompletionDate=new P.C_(0),this.CompletionDate.Date=(new Date).OnlyDate(),this.CompletionDate.Label="New CompletionDate",this.EndDate=new P.C_(0),this.EndDate.Date=(new Date).OnlyDate(),this.EndDate.Visible=!1,this.PartGrid=new m.vv,this.PartGrid.Visible=!1,this.PstDocGrid=new m.vv,this.PstDocGrid.CanUserSortColumns=!0,this.PstDocGrid.Columns=[],this.PstDocGrid.Width="",this.PstDocGridTableColumns.push("Sno"),this.PstDocGridTableColumns.push("Select"),this.PstDocGridTableColumns.push("DocNumber"),this.PstDocGridTableColumns.push("DocPrefix"),this.PstDocGridTableColumns.push("DocID"),this.PstDocGridTableColumns.push("CostCenterID"),this.PstDocGridTableColumns.push("VNO"),e=new d.O7,e.Header=n.d.GetResource("DocumentDesigner_Sno"),e.DisplayMember="Sno",e.ReadOnly=!0,e.Width=50,this.PstDocGrid.Columns.push(e),e=new d.O7,e.Header="Select",e.DisplayMember="Select",e.Width=60,e.DataType="CheckBox",this.PstDocGrid.Columns.push(e);let i=n.d.rental.GetPaymentScreenDef(),s=null;for(let t=0;t<i.Tables[0].length;t++)"PaymentTermDocumentName"==i.Tables[0][t].DBText.toString()?""!=i.Tables[0][t].Value.toString()&&(this.DocCCID=i.Tables[0][t].Value.toString()):"TowerStartDate"==i.Tables[0][t].DBText.toString()?this.CompletionDateColName=i.Tables[0][t].Value.toString():"PaymentTermtowerDim"==i.Tables[0][t].DBText.toString()?""!=i.Tables[0][t].Value.toString()&&(this.CCID=parseInt(i.Tables[0][t].Value.toString())):"PaymentTermFields"==i.Tables[0][t].DBText.toString()&&(s=i.Tables[0][t].Value.toString().split(";"));this.Tower.CCID=this.CCID,this.Tower.TypeID=1,this.Tower.Label="Tower",this.Tower.OnPactListBoxValueChanged.Subscribe(this,"OntowerChanged"),this.Payterms.Label="Payment terms",this.Payterms.SelectionChangedCommand.Subscribe(this,"ButtonSave"),this.Phases.Label="Phases",this.Phases.SelectionChangedCommand.Subscribe(this,"PhasesChanged"),s.forEach(t=>{let a=[]=i.Tables[1].filter(l=>l.SysColumnName==t);if(a.length>0)if(e=new d.O7,e.Header=a[0].ResourceData.toString(),e.DisplayMember=a[0].SysColumnName.toString(),"VoucherNo"==e.DisplayMember&&(e.DataType="LINK",e.Click.Subscribe(this,"onClick")),e.ReadOnly=!0,e.Width=100,this.PstDocGrid.Columns.push(e),e.SectionName=a[0].UserColumnType.toString(),this.PstDocGridTableColumns.push(a[0].SysColumnName.toString()),a[0].SysColumnName.toString().toLowerCase().Contains("dcccnid")){let l=parseInt(a[0].SysColumnName.toString().toLowerCase().Replace("dcccnid",""));l+=5e4,this.Joins+=" left Join "+this.GetTableName(l)+" c"+l.toString()+"  WITH(NOLOCK) on c."+a[0].SysColumnName.toString()+"= c"+l.toString()+".NODEID  ",this.Columns+=",c"+l.toString()+".name "+e.DisplayMember}else"debitaccount"==a[0].SysColumnName.toString().toLowerCase()||"creditaccount"==a[0].SysColumnName.toString().toLowerCase()?(this.Joins+=" left Join "+this.GetTableName(2)+" c"+a[0].SysColumnName.toString()+"  WITH(NOLOCK) on a."+a[0].SysColumnName.toString()+"= c"+a[0].SysColumnName.toString()+".AccountID  ",this.Columns+=",c"+a[0].SysColumnName.toString()+".Accountname "+e.DisplayMember):"duedate"==a[0].SysColumnName.toString().toLowerCase()||"docdate"==a[0].SysColumnName.toString().toLowerCase()||"billdate"==a[0].SysColumnName.toString().toLowerCase()?this.Columns+=",Convert(datetime,"+e.DisplayMember+") "+e.DisplayMember:"voucherno"==e.DisplayMember.toLowerCase()?this.Columns+=",a."+e.DisplayMember:this.Columns+=","+e.DisplayMember;else"PaymentTerm"==t&&(e=new d.O7,e.Header="PaymentTerm",e.DisplayMember="PaymentTerm",e.ReadOnly=!0,e.Width=100,e.SectionName="PaymentTerm",this.PstDocGrid.Columns.push(e),this.PstDocGridTableColumns.push("PaymentTerm"),this.Columns+=",(select top 1 pd.ProfileName from  Acc_PaymentDiscountProfile pd WITH(NOLOCK) where p.ProfileID=pd.ProfileID )  "+e.DisplayMember)}),this.PstDocGrid.SearchVisible=!0,this.PstDocGrid.SelectAll.Visible=!0,this.PstDocGrid.AddSearchCols()}GetTableName(e){return 2==e?"ACC_Accounts":3==e?"INV_Product":50001==e?"COM_Division":50002==e?"COM_Location":50003==e?"COM_Branch":50004==e?"COM_Department":50005==e?"COM_Salesman":50006==e?"COM_Category":50007==e?"COM_Area":50008==e?"COM_Teritory":"COM_CC"+e}onClick(){null!=this.PstDocGrid.SelectedItem&&""!=o.J0.String(this.PstDocGrid.SelectedItem.CostCenterID)&&b.RibbonExtViewModel.LoadDocument(this.PstDocGrid.SelectedItem)}SelectAllRows(){for(let e=0;e<this.PstDocGrid.Table.length;e++)this.PstDocGridTable[e].Select=this.SelectAll}LoadData(){if(null!=this.Tower&&this.Tower.CCID>0&&this.Tower.SelectedValue>0){let e,i;this.PstDocGrid.Clear();let s=" where c.dcCCNID"+(this.Tower.CCID-5e4).toString()+"="+this.Tower.SelectedValue;if(o.J0.IsEmpty(this.Payterms.SelectedValue))return this.DisplayMessage="select "+this.Payterms.Label,void(this.MessageVisibility=!0);if(s+=" and p.ProfileID="+this.Payterms.SelectedValue,o.J0.IsEmpty(this.Phases.SelectedValue)||null==this.Phases.SelectedItem)return this.DisplayMessage="select "+this.Phases.Label,void(this.MessageVisibility=!0);s+=this.Phases.SelectedItem.Parent,""!=this.DocCCID&&(s+=" and a.CostCenterID in("+this.DocCCID+")");let t=n.d.admin.GetPayTermsofTower(2,s,this.Columns,this.Joins);if(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("DocPrefix")){for(let a=0;a<t.Tables[0].length;a++){i=this.PstDocGrid.NewRow(),i.Sno=(a+1).toString(),i.Select=!1,i.DocNumber=t.Tables[0][a].DocNumber.toString(),i.DocPrefix=t.Tables[0][a].DocPrefix.toString(),i.DocID=t.Tables[0][a].DocID.toString(),i.CostCenterID=t.Tables[0][a].CostCenterID.toString(),i.VNO=t.Tables[0][a].VNO.toString();for(let l=2;l<this.PstDocGrid.Columns.length;l++)t.Columns[0].Contains(this.PstDocGrid.Columns[l].DisplayMember)&&("date"==this.PstDocGrid.Columns[l].SectionName.toLowerCase()&&!o.J0.IsEmpty(t.Tables[0][a][this.PstDocGrid.Columns[l].DisplayMember])&&o.J0.isValidDate(t.Tables[0][a][this.PstDocGrid.Columns[l].DisplayMember].toString())?(e=o.J0.isValidDate(t.Tables[0][a][this.PstDocGrid.Columns[l].DisplayMember].toString()),i[this.PstDocGrid.Columns[l].DisplayMember]=o.J0.ParseDate(o.J0.String(t.Tables[0][a][this.PstDocGrid.Columns[l].DisplayMember])).ToString(n.d.SessionManager.Preferences["Date Format"])):"datetime"==this.PstDocGrid.Columns[l].SectionName.toLowerCase()&&!o.J0.IsEmpty(t.Tables[0][a][this.PstDocGrid.Columns[l].DisplayMember])&&o.J0.isValidDate(t.Tables[0][a][this.PstDocGrid.Columns[l].DisplayMember].toString())?(e=o.J0.isValidDate(t.Tables[0][a][this.PstDocGrid.Columns[l].DisplayMember].toString()),i[this.PstDocGrid.Columns[l].DisplayMember]=o.J0.ParseDate(o.J0.String(t.Tables[0][a][this.PstDocGrid.Columns[l].DisplayMember])).ToString(n.d.SessionManager.Preferences["Date Format"]+" hh:mm:ss")):i[this.PstDocGrid.Columns[l].DisplayMember]=o.J0.String(t.Tables[0][a][this.PstDocGrid.Columns[l].DisplayMember]))}this.PstDocGrid.addRow(i)}}}OntowerChanged(e){this.Phases.Items.Clear(),this.Phases.Items.push(h._p.ComboBoxItems_2("","")),this.Aliasname="",this.Payterms.Items.Clear(),this.Payterms.Items.push(h._p.ComboBoxItems_2("",""));let i=" and c.dcCCNID"+(this.Tower.CCID-5e4).toString()+"="+this.Tower.SelectedValue;if(""!=this.DocCCID&&(i+=" and a.CostCenterID in("+this.DocCCID+")"),this.dsPayterms=n.d.admin.GetPayTermsofTower(1,i,"",""),null!=this.dsPayterms&&this.dsPayterms.Tables.length>0&&this.dsPayterms.Columns[0].Contains("ProfileID"))for(let s=0;s<this.dsPayterms.Tables[0].length;s++)null==this.Payterms.Items.find(t=>t.Value==this.dsPayterms.Tables[0][s].ProfileID.toString())&&this.Payterms.Items.push(h._p.ComboBoxItems_2(this.dsPayterms.Tables[0][s].ProfileName.toString(),this.dsPayterms.Tables[0][s].ProfileID.toString()))}PhasesChanged(e){this.Aliasname=this.Phases?.SelectedItem?.Aliasname}ButtonSave(e){if(this.DisplayMessage="",this.PstDocGrid&&this.PstDocGrid.angularGrid?.slickGrid&&this.PstDocGrid.angularGrid?.slickGrid.getActiveCellNode()&&(this.PstDocGrid.angularGrid.slickGrid.getActiveCell(),this.PstDocGrid.angularGrid.slickGrid.getEditorLock().commitCurrentEdit()),"Save"==e){if(!(null!=this.CompletionDate.Date&&this.CompletionDate.Date&&this.PstDocGrid.Table.length>0))return this.PstDocGrid.Table.length>0?(this.DisplayMessage="can not save blank data ",void(this.MessageVisibility=!0)):(this.DisplayMessage="Select Completion Date",void(this.MessageVisibility=!0));{let s="";for(let t=0;t<this.PstDocGrid.Table.length;t++)""!=o.J0.String(this.PstDocGrid.Table[t].Select)&&(0,u.yG0)(this.PstDocGrid.Table[t].Select.toString())&&(s+='<Row ID="'+this.PstDocGrid.Table[t].DocID.toString()+'" ',s+=' CostCenterID="'+this.PstDocGrid.Table[t].CostCenterID.toString()+'" ',s+=' VNO="'+this.PstDocGrid.Table[t].VNO.toString()+'" ',o.J0.IsEmpty(this.Payterms.SelectedValue)||(s+=' Payterms="'+this.Payterms.SelectedValue+'" '),s+="/>");if(!(s.length>0))return this.DisplayMessage="Select data to save",void(this.MessageVisibility=!0);{s="<XML>"+s+"</XML>";let t=0,a=0,l="";if(!o.J0.IsEmpty(this.Phases.SelectedValue)&&null!=this.Phases.SelectedItem){let D=this.Phases.SelectedItem.obj;if(""!=o.J0.String(D.Basedate)&&(a=o.J0.GetDateDifference(this.CompletionDate.Date,o.J0.ParseDate(D.Basedate))),a<0)return this.DisplayMessage="select greater completion date",void(this.MessageVisibility=!0);l=" and DimNodeID="+D.DimNodeID.toString()+" and days="+D.days.toString()}let C=n.d.inventory.UpdatePayTermsofProperty(s.toString(),a,l);this.DisplayMessage=C.Message,t=o.J0.Int(C.RetValue),this.MessageVisibility=!0,t>0&&this.PstDocGrid.Clear()}}}else if("OK"==e)this.LoadData();else if("Close"==e)n.d.page.HideDialog(this.PopUpGUID);else if(e&&e instanceof h.y$&&(this.Aliasname="",this.Phases.Items.Clear(),this.Phases.Items.push(h._p.ComboBoxItems_2("","")),!o.J0.IsEmpty(this.Payterms.SelectedValue)&&null!=this.dsPayterms)){var i=this.dsPayterms.Tables[0].filter(s=>s.ProfileID==this.Payterms.SelectedValue);for(let s=0;s<i.length;s++){let t=" and p.DimNodeID="+i[s].DimNodeID.toString()+" and p.Period="+i[s].Period.toString()+" and p.days="+i[s].days.toString(),a="";!o.J0.IsEmpty(i[s].Basedate)&&!o.J0.IsEmpty(i[s].days)&&("1"==i[s].Period.toString()?a=new Date(i[s].Basedate.toString()).AddDays(parseInt(i[s].days.toString())).ToString(n.d.SessionManager.Preferences["Date Format"]):"2"==i[s].Period.toString()&&(a=new Date(i[s].Basedate.toString()).AddMonths(parseInt(i[s].days.toString())).ToString(n.d.SessionManager.Preferences["Date Format"]))),this.Phases.Items.push(h._p.ComboBoxItems_9(i[s].Name.toString(),i[s].DimNodeID.toString(),t,a,i[s]))}}}}}}]);