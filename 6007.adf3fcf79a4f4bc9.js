"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[6007],{96007:(se,w,I)=>{I.r(w),I.d(w,{RibbonExtPrd:()=>ie});var Y=I(74523),l=I(32040),$=I(31425),n=I(43767),u=I(54581),O=I(85985),V=I(98580),G=I(58941),g=I(27730),b=I(84151),C=I(23458),D=I(82503),y=I(7321);class P{constructor(){this.ColumnSpan="4",this.BomGrid=new y.vv}}var h=I(21774);class x{get angularGrid(){return this.ProductionMethodGridDataObj.angularGrid}get ProductionMethodGridData(){return this.ProductionMethodGridDataObj.Table}get ProductionMethodColumnSource(){return this.ProductionMethodGridDataObj.Columns}constructor(t,e){let i;this.ColumnSpan="4",this.SNO=1,this.Bparent=t,this.Mparent=e,this.ProductionMethodGridDataObj=new y.vv,this.ProductionMethodGridDataObj.TableColumns.push("Sno"),this.ProductionMethodGridDataObj.TableColumns.push("BOMID"),this.ProductionMethodGridDataObj.TableColumns.push("BOMName"),this.ProductionMethodGridDataObj.TableColumns.push("Particulars"),this.ProductionMethodGridDataObj.Columns=[],i=new h.O7,i.Header=l.d.GetResource("Sno"),i.DisplayMember="Sno",i.DataType="TEXTBOX",i.Width=50,i.IsVisible=!0,i.ReadOnly=!0,this.ProductionMethodGridDataObj.Columns.push(i),this.ProductionMethodGridDataObj.TableNewRow.Subscribe(this,"ProductionMethodGridData_TableNewRow"),null!=this.Mparent&&null==this.Bparent&&(i=new h.O7,i.Header=l.d.GetResource("MO_BOMName"),i.DisplayMember="BOMName",i.DataType="TEXTBOX",i.Width=150,i.IsVisible=!0,i.ReadOnly=!0,this.ProductionMethodGridDataObj.Columns.push(i)),i=new h.O7,i.Header=l.d.GetResource("Deposits_Particulars"),i.DisplayMember="Particulars",i.DataType="TEXTBOX",i.Width=500,i.IsVisible=!0,this.ProductionMethodGridDataObj.Columns.push(i);for(let s=0;s<10;s++)this.ProductionMethodGridDataObj.addEmptyRow()}ProductionMethodGridData_TableNewRow(t,e){this.UpdateSequence()}UpdateSequence(){this.SNO=1,this.ProductionMethodGridData.forEach(t=>{t.Sno=this.SNO++}),this.ProductionMethodGridDataObj.refreshDataView()}GETXML(){let t="";t+="<XML>";for(let e=0;e<this.ProductionMethodGridData.length;e++)n.J0.IsEmpty(this.ProductionMethodGridData[e].Particulars)||(t+="<Row ",t+=' SequenceNo="'+e+'1"',null!=this.Mparent&&null==this.Bparent&&(t+=' BOMID="'+this.ProductionMethodGridData[e].BOMID.toString()+'"'),t+=' Particulars="'+this.ProductionMethodGridData[e].Particulars.toString()+'"',t+="/>");return t+="</XML>",t.toString()}Load(t){let e=0;if(null!=this.Mparent&&null==this.Bparent)for(let i=0;i<this.ProductionMethodGridData.length;i++)"0"!=n.J0.String(this.ProductionMethodGridData[i].BOMID)?(this.ProductionMethodGridDataObj.removeRowAt(i),i--):e++;if(null!=t&&t.length>0){for(let i=0;i<t.length;i++)this.ProductionMethodGridDataObj.addEmptyRow(),null!=this.Mparent&&null==this.Bparent&&(this.ProductionMethodGridData[e].BOMName=t[i].BOMName.toString(),this.ProductionMethodGridData[e].BOMID=t[i].BOMID.toString()),this.ProductionMethodGridData[e].Particulars=t[i].Particulars.toString(),e++;this.SequenceNo(),this.ProductionMethodGridDataObj.refreshDatawithIDs()}}SequenceNo(){let t=1;if(this.ProductionMethodGridDataObj.TableColumns.Contains("Sno"))for(let e=0;e<this.ProductionMethodGridData.length;e++)this.ProductionMethodGridData[e].Sno=t.toString(),t++}}var J=I(26336),M=I(89731),A=I(12002),B=I(20354),F=I(48800),j=I(96099),L=I(75052),U=I(31347),z=I(13054),Z=I(58170),v=I(41264),_=I(41820),K=I(63703),W=I(76555);class q extends V.g{get ScreenObject(){return this._ScreenObject}constructor(t,e){super(),this.BID=0,this.parentid=0,this.QtyDecimals="",this.RateDecimals="",this.objBOM=new B.b,this.lstEventCtrls=[],this._ScreenObject=new O.ControlGenerator,this.btnHistoryVisible=!1,this.BtnApprove=new G.v,this.txtCode=new b.Dw(555025),this.txtName=new b.Dw(555026),this.txtCost=new b.Dw(0),this.txtUsage=new b.Dw(0),this.txtCapacity=new b.Dw(0),this.txtEffeciency=new b.Dw(0),this.Description=new b.Dw(23903),this.MStatus=new g.y$(23898),this.Group=new g.y$(23897),this.Location=new C.y$(23900),this.Division=new C.y$(23901),this.Product=new C.y$(23899),this.UOM=new g.y$(109),this.FPQty=new b.Dw(27269),this.Date=new D.Lc(23902),this.txtDesc=new b.Dw(23903),this.FilterCCID=0,this.MachineCCID=0,this.SNo=0,this.MachineID=0,this.IsExportPrint=!1,this.drSelPrintLayout=null,this.dsTotLayouts=null,this.MoreThanOneLayout=!1,this.AttachmentVisibility=!1,this.ClassName="AddEditBOMViewModel",Logger.InfoLog("AddEditBOMViewModel::Entering AddEditBOMViewModel "),this.ButtonSave=new G.v,this.parentid=e,this.BID=t,this.MessageVisibility=!1,this.InputGrid=new P,this.ExpenseGrid=new P,this.ResourcesGrid=new P,this.OutputGrid=new P,this.ProductionsMethod=new x(this,null),this._ScreenObject.LoadScreen_2(this,76),this.CostCenterID=76,this.BtnApprove.Visible=!1,l.d.SessionManager.Preferences.ContainsKey("isYearMonthWiseFolder")&&"FALSE"==l.d.SessionManager.Preferences.isYearMonthWiseFolder.toUpperCase()&&(this.ScreenObject.YearMonth=""),this.ViewAttachments=new A.ViewAttachmentViewModel(this),this.Product.SelectionChangedCommand.Subscribe(this,"OnProductChange"),this.lstEventCtrls.push(this.Product.DBColumnID),0==t?l.d.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=l.d.SessionManager.IsActionAssigned(76,"Create"):this.ButtonSave.Enable=l.d.SessionManager.IsActionAssigned(76,"Create"):(this.ScreenObject.IsEdit=!0,l.d.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=l.d.SessionManager.IsActionAssigned(76,"Update"):this.ButtonSave.Enable=l.d.SessionManager.IsActionAssigned(76,"Update"));let i=this.ScreenObject.StaticFields.find(d=>23899==d.DBColumnID);null!=i?(this.Product.CCID=i.CCID,this.Product.TypeID=i.TypeID,0==this.Product.CCID&&(this.Product.CCID=3),0==this.Product.TypeID&&(this.Product.TypeID=10)):(this.Product.CCID=3,this.Product.TypeID=10);let s=this.ScreenObject.Data.Tables[4].filter(d=>"CapsLock"==d.Name);s.length>0&&(0,u.yG0)(s[0].Value)&&(this.txtName.IsAllCaps=!0),s=this.ScreenObject.Data.Tables[4].filter(d=>"CapsToFirstLetter"==d.Name),s.length>0&&(0,u.yG0)(s[0].Value)&&(this.txtName.IsFirstLetterCaps=!0),s=this.ScreenObject.Data.Tables[4].filter(d=>"BOMDecimalsinQty"==d.Name),s.length>0&&!n.J0.IsEmpty(s[0].Value)&&(this.QtyDecimals=n.J0.String(s[0].Value)),s=this.ScreenObject.Data.Tables[4].filter(d=>"BOMDecimalsinRate"==d.Name),s.length>0&&!n.J0.IsEmpty(s[0].Value)&&(this.RateDecimals=n.J0.String(s[0].Value)),this.LoadData(),this.FPQty.Text="1",Logger.InfoLog("AddEditBOMViewModel::Exiting AddEditBOMViewModel "),this.loadtabs();let a,r=this.objBOM.GetBOMDetails(this.BID);if(this.BID>0?(this.OnLoad(this.BID),this.OnProductChange(null),this.UOM.SelectedValue=r.Tables[0][0].UOMID.toString(),this.objBOM.GUID=r.Tables[0][0].GUID.toString(),this.Title=l.d.GetResource("BOM_EditBOM"),this.ScreenObject.YearMonth=l.d.SessionManager.Preferences.ContainsKey("isYearMonthWiseFolder")&&"TRUE"==l.d.SessionManager.Preferences.isYearMonthWiseFolder.toUpperCase()?new Date(r.Tables[0][0].CDATE.toString()).ToString("yyyyMMM"):""):(this.Title=l.d.GetResource("BOM_AddBOM"),this.objBOM.GUID="GUID",this.AutoGenerateCode()),this.DisplayName=this.Title,r.Tables[4].length>0){for(let d=0;d<r.Tables[4].length;d++)this.Group.Items.push(g._p.ComboBoxItems_2(r.Tables[4][d].BOMName.toString(),r.Tables[4][d].BOMID.toString()));this.Group.SelectedValue=0==this.BID?r.Tables[4][0].BOMID.toString():this.parentid.toString()}this.CheckViewForUser(),this.InputGrid.BomGrid.ColumnSpan=4,this.ExpenseGrid.BomGrid.ColumnSpan=4,this.ResourcesGrid.BomGrid.ColumnSpan=4,this.OutputGrid.BomGrid.ColumnSpan=4,this.ProductionsMethod.ProductionMethodGridDataObj.ColumnSpan=4;for(let d=0;d<this.ScreenObject.StaticFields.length;d++)a=this.ScreenObject.StaticFields[d],a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&!this.lstEventCtrls.Contains(a.DBColumnID)?this.SetControlEvent(a):this.BID>0&&a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&19==a.Mode&&this.OnGetExtFunctionData(a);if(null!=this.ScreenObject.HeaderFields)for(let d=0;d<this.ScreenObject.HeaderFields.length;d++)a=this.ScreenObject.HeaderFields[d],a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&!this.lstEventCtrls.Contains(a.DBColumnID)?this.SetControlEvent(a):this.BID>0&&a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&19==a.Mode&&this.OnGetExtFunctionData(a);this.ScreenObject.CustomTab.Pages.forEach(d=>{a=d.Fields.find(c=>c instanceof Z.MI&&null!=c.ToolTipFooterTitle),a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&!this.lstEventCtrls.Contains(a.DBColumnID)?this.SetControlEvent(a):this.BID>0&&a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&19==a.Mode&&this.OnGetExtFunctionData(a)})}HideControls(){this.AttachmentVisibility=!1}SetControlEvent(t){try{t instanceof b.Dw?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof g.y$?t.SelectionChangedCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof z.I||t instanceof b.L6?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof C.y$?t.OnPactListBoxValueChanged.Subscribe(this,"OnGetExtFunctionData"):(t instanceof D.Lc||t instanceof D.P6||t instanceof D.C_)&&t.SelectedDateChanged.Subscribe(this,"OnGetExtFunctionData"),this.BID>0&&19==t.Mode&&this.OnGetExtFunctionData(t)}catch{}}OnGetExtFunctionData(t){null!=t.ToolTipFooterTitle&&!n.J0.IsEmpty(t.KeyTip)&&"lostfocus"==t.KeyTip.toLowerCase()&&this.ScreenObject.ValidateExtData(t,null,!0)&&this.ScreenObject.GetExternalFuncData(t.Mode,this.BID,t.ToolTipFooterTitle,t.ToolTipFooterDescription,t.ToolTipDescription,null,null)}CheckViewForUser(){this.InputGrid.BomGrid.Columns.forEach(t=>{null!=t.ID&&this.ScreenObject.SetView(t,this.BID>0?1:0)}),this.ExpenseGrid.BomGrid.Columns.forEach(t=>{null!=t.ID&&this.ScreenObject.SetView(t,this.BID>0?1:0)}),this.ResourcesGrid.BomGrid.Columns.forEach(t=>{null!=t.ID&&this.ScreenObject.SetView(t,this.BID>0?1:0)}),this.OutputGrid.BomGrid.Columns.forEach(t=>{null!=t.ID&&this.ScreenObject.SetView(t,this.BID>0?1:0)})}loadtabs(){this.AssignRowColumns();let t=null;for(let e=this._ScreenObject.CustomTab.Pages.length-1;e>=0;e--){let i=this._ScreenObject.CustomTab.Pages[e];switch(i.Name){case"Production Method":i.Fields.push(this.ProductionsMethod.ProductionMethodGridDataObj);break;case"Raw Materials":i.Fields.push(this.InputGrid.BomGrid);break;case"Stages":t=i;break;case"Expenses":i.Fields.push(this.ExpenseGrid.BomGrid);break;case"Machines":i.Fields.push(this.ResourcesGrid.BomGrid);break;case"Other Outputs":i.Fields.push(this.OutputGrid.BomGrid);break;case"Attachments":i.Fields.push(this.ViewAttachments)}}this.ScreenObject.CustomTab.Pages.Remove(t),this.ScreenObject.CustomTab.SelectedTab=this.ScreenObject.CustomTab.Pages[0]}AutoGenerateCode(){this.objBOM.GetBOMDetails(this.BID);let e=l.d.common.GetAutoSequence(76,"","76",l.d.SessionManager.CompanyIndex.toString()),i=this.ScreenObject.Data.Tables[4].filter(s=>"CodeAutoGen"==s.Name);i.length>0&&((0,u.yG0)(i[0].Value)?(this.txtCode.Enable=!1,this.txtCode.Mandatory=!1,0==this.BID&&(this.txtCode.Text=e)):this.txtCode.Enable=!0),i=this.ScreenObject.Data.Tables[4].filter(s=>"CapsLock"==s.Name),i.length>0&&(0,u.yG0)(i[0].Value)&&(this.txtName.IsAllCaps=!0),i=this.ScreenObject.Data.Tables[4].filter(s=>"CapsToFirstLetter"==s.Name),i.length>0&&(0,u.yG0)(i[0].Value)&&(this.txtName.IsFirstLetterCaps=!0)}AssignRowColumns(){let t;t=this._ScreenObject.CustomFields.length;for(let e=0;e<t;e++)this._ScreenObject.CustomFields[e].Row=e/4,this._ScreenObject.CustomFields[e].Column=e%4}LoadData(){let t,e;this.InputGrid.BomGrid.Table=[],this.InputGrid.BomGrid.Columns=[],this.InputGrid.BomGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.InputGrid.BomGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.InputGrid.BomGrid.CanUserAddRows=!0,this.InputGrid.BomGrid.CanUserDeleteRows=!0,this.InputGrid.BomGrid.TableColumns.push("Sno"),this.InputGrid.BomGrid.TableColumns.push("ProductCode"),this.InputGrid.BomGrid.TableColumns.push("ProductCode_Key"),this.InputGrid.BomGrid.TableColumns.push("ProductName"),this.InputGrid.BomGrid.TableColumns.push("ProductName_Key"),this.InputGrid.BomGrid.TableColumns.push("Qty"),this.InputGrid.BomGrid.TableColumns.push("UOM"),this.InputGrid.BomGrid.TableColumns.push("UOM_Key"),this.InputGrid.BomGrid.TableColumns.push("UnitPrice"),this.InputGrid.BomGrid.TableColumns.push("Value"),this.InputGrid.BomGrid.TableColumns.push("Wastage"),this.InputGrid.BomGrid.TableColumns.push("BOMProductID"),e=new h.O7,e.Header="#",e.DisplayMember="Sno",e.DataType="TextBlock",e.Width=23,e.IsVisible=!0,e.ReadOnly=!0,this.InputGrid.BomGrid.Columns.push(e),this.ScreenObject.Data.Tables.length>4&&(t=this.ScreenObject.Data.Tables[4].filter(s=>"BomFilterDimension"==s.Name),t.length>0&&!n.J0.IsEmpty(t[0].Value)&&n.J0.Int(t[0].Value)>0&&parseInt(t[0].Value.toString())>0&&(this.FilterCCID=parseInt(t[0].Value.toString()),e=new h.O7,e.Header="FilterOn",e.DisplayMember="FilterOn",e.ValueMember="FilterOn_Key",e.DataType="LISTBOX",e.Width=230,e.CostCenterID=parseInt(t[0].Value.toString()),e.TypeID=3==parseInt(t[0].Value.toString())?12:1,e.IsVisible=!0,this.InputGrid.BomGrid.Columns.push(e),this.InputGrid.BomGrid.TableColumns.push("FilterOn"),this.InputGrid.BomGrid.TableColumns.push("FilterOn_Key"))),e=new h.O7,e.Header=l.d.GetResource("BOM_ProductCOde"),e.DisplayMember="ProductCode",e.ValueMember="ProductName_Key",e.DataType="LISTBOX",e.CostCenterID=3,e.TypeID=100,t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMProducts"==i.SysTableName&&"ProductCode"==i.SysColumnName&&1==i.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):150,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.InputGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("BOM_ProductName"),e.DisplayMember="ProductName",e.ValueMember="ProductName_Key",e.DataType="LISTBOX",e.CostCenterID=3,e.TypeID=10,e.IsFrozen=!0,t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMProducts"==i.SysTableName&&"ProductID"==i.SysColumnName&&1==i.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):220,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.InputGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("Quantity"),e.DisplayMember="Qty",e.DataType="INT",t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMProducts"==i.SysTableName&&"Quantity"==i.ysColumnName&&1==i.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):90,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.QtyDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=l.d.SessionManager.Preferences.DecimalsinQty&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinQty):e.DecimalPoints=this.QtyDecimals,this.InputGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("UOM"),e.DisplayMember="UOM",e.ValueMember="UOM_Key",e.DataType="LISTBOX",e.CostCenterID=11,e.TypeID=1,t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMProducts"==i.SysTableName&&"UOMID"==i.SysColumnName&&1==i.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.InputGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("UnitPrice"),e.DisplayMember="UnitPrice",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMProducts"==i.SysTableName&&"UnitPrice"==i.SysColumnName&&1==i.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.RateDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=l.d.SessionManager.Preferences.DecimalsinRate&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinRate):e.DecimalPoints=this.RateDecimals,this.InputGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("Value"),e.DisplayMember="Value",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMProducts"==i.SysTableName&&"Value"==i.SysColumnName&&1==i.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.RateDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=l.d.SessionManager.Preferences.DecimalsinRate&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinRate):e.DecimalPoints=this.RateDecimals,this.InputGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("Waistage"),e.DisplayMember="Wastage",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMProducts"==i.SysTableName&&"Wastage"==i.SysColumnName&&1==i.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.InputGrid.BomGrid.Columns.push(e),this.ExpenseGrid.BomGrid.Table=[],this.ExpenseGrid.BomGrid.Columns=[],this.ExpenseGrid.BomGrid.CanUserAddRows=!0,this.ExpenseGrid.BomGrid.CanUserDeleteRows=!0,e=new h.O7,e.Header="#",e.DisplayMember="Sno",e.DataType="TextBlock",e.Width=23,e.IsVisible=!0,e.ReadOnly=!0,this.ExpenseGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header="Name",e.DisplayMember="Name",e.DataType="TextBlock",t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_Expenses"==i.SysTableName&&"Name"==i.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):200,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.ExpenseGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header="Debit",e.DisplayMember="Expense",e.ValueMember="Expense_Key",e.DataType="LISTBOX",e.CostCenterID=2,t=this.ScreenObject.Data.Tables[4].filter(i=>"DrAccListview"==i.Name),e.TypeID=null!=t&&t.length>0?parseInt(t[0].Value.toString()):2,t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_Expenses"==i.SysTableName&&"DebitAccountID"==i.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):200,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.ExpenseGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header="Credit",e.DisplayMember="AccountName",e.ValueMember="AccountName_Key",e.DataType="LISTBOX",e.CostCenterID=2,t=this.ScreenObject.Data.Tables[4].filter(i=>"CrAccListview"==i.Name),e.TypeID=null!=t&&t.length>0?parseInt(t[0].Value.toString()):2,t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_Expenses"==i.SysTableName&&"CreditAccountID"==i.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):200,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.ExpenseGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("Value"),e.DisplayMember="Value",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_Expenses"==i.SysTableName&&"Value"==i.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):90,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.RateDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=l.d.SessionManager.Preferences.DecimalsinRate&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinRate):e.DecimalPoints=this.RateDecimals,this.ExpenseGrid.BomGrid.Columns.push(e),this.ExpenseGrid.BomGrid.TableColumns.push("Sno"),this.ExpenseGrid.BomGrid.TableColumns.push("Name"),this.ExpenseGrid.BomGrid.TableColumns.push("AccountName"),this.ExpenseGrid.BomGrid.TableColumns.push("AccountName_Key"),this.ExpenseGrid.BomGrid.TableColumns.push("Expense"),this.ExpenseGrid.BomGrid.TableColumns.push("Expense_Key"),this.ExpenseGrid.BomGrid.TableColumns.push("Value"),this.ExpenseGrid.BomGrid.TableColumns.push("ExpenseID"),this.ResourcesGrid.BomGrid.Table=[],this.ResourcesGrid.BomGrid.Columns=[],this.ResourcesGrid.BomGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.ResourcesGrid.BomGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.ResourcesGrid.BomGrid.CanUserAddRows=!0,this.ResourcesGrid.BomGrid.CanUserDeleteRows=!0,e=new h.O7,e.Header="#",e.DisplayMember="Sno",e.DataType="TextBlock",e.Width=23,e.IsVisible=!0,e.ReadOnly=!0,e.IsFrozen=!0,this.ResourcesGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("Machine"),e.DisplayMember="Machine",e.DataType="LISTBOX",t=this.ScreenObject.Data.Tables[4].filter(i=>"MachineDimension"==i.Name),t.length>0&&t[0].Value.toString().length>0&&(this.MachineCCID=parseInt(t[0].Value),e.CostCenterID=parseInt(t[0].Value)),e.TypeID=3,t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMResources"==i.SysTableName&&"ResourceID"==i.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):200,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.ResourcesGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("HRS"),e.DisplayMember="Hrs",e.DataType="FLOAT",e.IsFrozen=!0,t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMResources"==i.SysTableName&&"Hours"==i.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),e=new h.O7,e.Header="Cost/Hr",e.DisplayMember="Value",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMResources"===i.SysTableName&&"Value"==i.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.RateDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=l.d.SessionManager.Preferences.DecimalsinRate&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinRate):e.DecimalPoints=this.RateDecimals,this.ResourcesGrid.BomGrid.Columns.push(e),this.ResourcesGrid.BomGrid.TableColumns.push("Sno"),this.ResourcesGrid.BomGrid.TableColumns.push("Machine"),this.ResourcesGrid.BomGrid.TableColumns.push("Machine_Key"),this.ResourcesGrid.BomGrid.TableColumns.push("Hrs"),this.ResourcesGrid.BomGrid.TableColumns.push("Value"),this.ResourcesGrid.BomGrid.TableColumns.push("BOMResourceID"),this.OutputGrid.BomGrid.Table=[],this.OutputGrid.BomGrid.Columns=[],this.OutputGrid.BomGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.OutputGrid.BomGrid.CanUserAddRows=!0,this.OutputGrid.BomGrid.CanUserDeleteRows=!0,e=new h.O7,e.Header="#",e.DisplayMember="Sno",e.DataType="TextBlock",e.Width=23,e.IsVisible=!0,e.ReadOnly=!0,e.IsFrozen=!0,this.OutputGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("BOM_ProductCOde"),e.DisplayMember="ProductCode",e.ValueMember="ProductName_Key",e.DataType="LISTBOX",e.CostCenterID=3,e.TypeID=100,t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMProducts"==i.SysTableName&&"ProductCode"==i.SysColumnName&&2==i.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):200,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.OutputGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("BOM_ProductName"),e.DisplayMember="ProductName",e.ValueMember="ProductName_Key",e.DataType="LISTBOX",e.CostCenterID=3,e.TypeID=10,t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMProducts"==i.SysTableName&&"ProductID"==i.SysColumnName&&2==i.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):220,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.OutputGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header="Qty",e.DisplayMember="Qty",e.DataType="INT",t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMProducts"==i.SysTableName&&"Quantity"==i.SysColumnName&&2==i.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):90,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.QtyDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=l.d.SessionManager.Preferences.DecimalsinQty&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinQty):e.DecimalPoints=this.QtyDecimals,this.OutputGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header="UnitPrice",e.DisplayMember="UnitPrice",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMProducts"==i.SysTableName&&"UnitPrice"==i.SysColumnName&&2==i.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.RateDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=l.d.SessionManager.Preferences.DecimalsinRate&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinRate):e.DecimalPoints=this.RateDecimals,this.OutputGrid.BomGrid.Columns.push(e),e=new h.O7,e.Header="Value",e.DisplayMember="Value",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(i=>"PRD_BOMProducts"==i.SysTableName&&"Value"==i.SysColumnName&&2==i.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.RateDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=l.d.SessionManager.Preferences.DecimalsinRate&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinRate):e.DecimalPoints=this.RateDecimals,this.OutputGrid.BomGrid.Columns.push(e),this.OutputGrid.BomGrid.TableColumns.push("Sno"),this.OutputGrid.BomGrid.TableColumns.push("ProductCode"),this.OutputGrid.BomGrid.TableColumns.push("ProductName"),this.OutputGrid.BomGrid.TableColumns.push("ProductName_Key"),this.OutputGrid.BomGrid.TableColumns.push("Qty"),this.OutputGrid.BomGrid.TableColumns.push("UnitPrice"),this.OutputGrid.BomGrid.TableColumns.push("Value"),this.OutputGrid.BomGrid.TableColumns.push("BOMProductID"),this.FillEmptyRows(),this._ScreenObject.Data.Tables[3].forEach(i=>{this.MStatus.Items.push(g._p.ComboBoxItems_2(i[Object.keys(i)[1]].toString(),i[Object.keys(i)[0]].toString()))}),"1"!=l.d.SessionManager.RoleID&&l.d.SessionManager.IsActionAssigned(76,"Save as UnApproved")&&(this.MStatus.SelectedValue="464",this.MStatus.Visible=!1)}FillEmptyRows(){for(let t=0;t<8;t++)this.InputGrid.BomGrid.addEmptyRow();for(let t=0;t<5;t++)this.ExpenseGrid.BomGrid.addEmptyRow();for(let t=0;t<5;t++)this.ResourcesGrid.BomGrid.addEmptyRow();for(let t=0;t<5;t++)this.OutputGrid.BomGrid.addEmptyRow();this.UpdateSequence()}BOMExpenseXML(t){Logger.InfoLog("AddEditBOMViewModel::Entering BOMExpenseXML ");let e="";e+="<BOMExpenseXML>";for(let i=0;i<this.ExpenseGrid.BomGrid.Table.length;i++)n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[i].AccountName_Key)||(e+="<Row ",null!=t&&(null==t||"SaveAs"==t.toString())||n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[i].ExpenseID)?e+=" ExpenseID='0'":e+=" ExpenseID='"+this.ExpenseGrid.BomGrid.Table[i].ExpenseID.toString()+"'",e+=" Name='"+this.ExpenseGrid.BomGrid.Table[i].Name+"'",e+=" ResourceID='1'",e+=" CreditAccountID='"+this.ExpenseGrid.BomGrid.Table[i].AccountName_Key+"'",n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[i].Expense_Key)||(e+=" DebitAccountID='"+this.ExpenseGrid.BomGrid.Table[i].Expense_Key+"'"),e+=" Action='New'",e+=" Value='"+this.ExpenseGrid.BomGrid.Table[i].Value+"'/>");return e+="</BOMExpenseXML>",Logger.InfoLog("AddEditBOMViewModel::Exiting BOMExpenseXML"),e.toString()}BOMResourceXML(t){Logger.InfoLog("AddEditBOMViewModel::Entering BOMResourceXML ");let e="";e+="<BOMResourceXML>";for(let i=0;i<this.ResourcesGrid.BomGrid.Table.length;i++)n.J0.IsEmpty(this.ResourcesGrid.BomGrid.Table[i].Machine_Key)||(e+="<Row ",null!=t&&(null==t||"SaveAs"==t.toString())||n.J0.IsEmpty(this.ResourcesGrid.BomGrid.Table[i].BOMResourceID)?e+=" BOMResourceID='0'":e+=" BOMResourceID='"+this.ResourcesGrid.BomGrid.Table[i].BOMResourceID.toString()+"'",e+=" ResourceID='"+this.ResourcesGrid.BomGrid.Table[i].Machine_Key+"'",e+=" Hours='1' ",e+=" Action='New'",e+=" Value='"+this.ResourcesGrid.BomGrid.Table[i].Value+"'/>");return e+="</BOMResourceXML>",Logger.InfoLog("AddEditBOMViewModel::Exiting BOMResourceXML"),e.toString()}BOMProductXML(t){Logger.InfoLog("AddEditBOMViewModel::Entering MachineXML ");let e="";e+="<BOMProductXML>";for(let i=0;i<this.InputGrid.BomGrid.Table.length;i++)n.J0.IsEmpty(this.InputGrid.BomGrid.Table[i].ProductName_Key)||(e+="<Row ",null!=t&&(null==t||"SaveAs"==t.toString())||n.J0.IsEmpty(this.InputGrid.BomGrid.Table[i].BOMProductID)?e+=" BOMProductID='0'":e+=" BOMProductID='"+this.InputGrid.BomGrid.Table[i].BOMProductID.toString()+"'",e+=" ProductID='"+this.InputGrid.BomGrid.Table[i].ProductName_Key+"'",e+=" Quantity='"+n.J0.String(this.InputGrid.BomGrid.Table[i].Qty)+"'",e+=" UOMID='"+n.J0.String(this.InputGrid.BomGrid.Table[i].UOM_Key)+"'",e+=" UnitPrice='"+n.J0.String(this.InputGrid.BomGrid.Table[i].UnitPrice)+"'",this.InputGrid.BomGrid.TableColumns.Contains("FilterOn_Key")&&!n.J0.IsEmpty(this.InputGrid.BomGrid.Table[i].FilterOn_Key)&&(e+=" FilterOn='"+this.InputGrid.BomGrid.Table[i].FilterOn_Key.toString()+"'"),e+=" ProductUse='1'",e+=" Action='New'",e+=" Wastage='"+this.InputGrid.BomGrid.Table[i].Wastage+"'",e+=" Value='"+this.InputGrid.BomGrid.Table[i].Value+"'/>");for(let i=0;i<this.OutputGrid.BomGrid.Table.length;i++)n.J0.IsEmpty(this.OutputGrid.BomGrid.Table[i].ProductName_Key)||(e+="<Row ",null!=t&&(null==t||"SaveAs"==t.toString())||n.J0.IsEmpty(this.OutputGrid.BomGrid.Table[i].BOMProductID)?e+=" BOMProductID='0'":e+=" BOMProductID='"+this.OutputGrid.BomGrid.Table[i].BOMProductID.toString()+"'",e+=" ProductID='"+this.OutputGrid.BomGrid.Table[i].ProductName_Key+"'",e+=" Quantity='"+n.J0.String(this.OutputGrid.BomGrid.Table[i].Qty)+"'",e+=" UnitPrice='"+n.J0.String(this.OutputGrid.BomGrid.Table[i].UnitPrice)+"'",e+=" ProductUse='2'",e+=" Action='New'",e+=" Value='"+this.OutputGrid.BomGrid.Table[i].Value+"'/>");return e+="</BOMProductXML>",Logger.InfoLog("AddEditBOMViewModel::Exiting MachineXML"),e.toString()}ValidateGrids(){for(let e=0;e<this.ExpenseGrid.BomGrid.Table.length;e++)if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].AccountName_Key))if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Expense_Key))if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Value))if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Name));else{if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].AccountName_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Expense_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Value))return"Incomplete Expenses Information at Row :"+(e+1).toString()}else{if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].AccountName_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Expense_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Name))return"Incomplete Expenses Information at Row :"+(e+1).toString()}else{if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].AccountName_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Value))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Name))return"Incomplete Expenses Information at Row :"+(e+1).toString()}else{if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Expense_Key))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Value))return"Incomplete Expenses Information at Row :"+(e+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.BomGrid.Table[e].Name))return"Incomplete Expenses Information at Row :"+(e+1).toString()}return""}OnSaveBOM(t){if(Logger.InfoLog("AddEditBOMViewModel::Entering OnSaveMachine "),"Save"==t.toString()||"SaveAs"==t.toString())try{let i,e=this._ScreenObject.ValidateData();if(!n.J0.IsEmpty(e))return this.DisplayMessage=e,void(this.MessageVisibility=!0);if(e=this.ValidateGrids(),!n.J0.IsEmpty(e))return this.DisplayMessage=e,void(this.MessageVisibility=!0);if(!this.ScreenObject.ValidateDataonSave())return;this.objBOM.BOMID=null!=t&&"SaveAs"==t.toString()?0:this.BID,this.objBOM.Code=this.txtCode.Text,this.objBOM.Name=this.txtName.Text,this.objBOM.Date=new Date,this.objBOM.ProductID=this.Product.SelectedValue,this.objBOM.UOMID=n.J0.IsEmpty(this.UOM.SelectedValue)?0:parseInt(this.UOM.SelectedValue),this.objBOM.FPQty=n.J0.Double(this.FPQty.Text),this.objBOM.FPQty<=0&&(this.objBOM.FPQty=1),this.objBOM.LocationID=this.Location.SelectedValue,this.objBOM.DivisionID=this.Division.SelectedValue,this.objBOM.group=!1,this.objBOM.selectednodeid=parseInt(this.Group.SelectedValue),this.objBOM.Desc=this.txtDesc.Text,this.objBOM.StatusID=parseInt(this.MStatus.SelectedValue),this.objBOM.BOMProductXML=this.BOMProductXML(t),this.objBOM.BOMExpenseXML=this.BOMExpenseXML(t),this.objBOM.BOMResourceXML=this.BOMResourceXML(t),this.objBOM.CustomFieldsQuery=this._ScreenObject.GetCustomFieldsQuery(),this.objBOM.CustomCCQuery=this._ScreenObject.GetCustomCostCenterFieldsQuery(),this.objBOM.ProductionXML=this.ProductionsMethod.GETXML(),this.objBOM.AttachmetsXML=this.ViewAttachments.GetXML(),this.objBOM.WID=464==this.objBOM.StatusID?0:this.ScreenObject.CheckWorkFlow(),l.d.inventory.SaveBOM(this.objBOM,"SaveBOM").subscribe(s=>{this.DisplayMessage=s.Message,this.MessageVisibility=!0,i=s.RetValue,i>0&&(this.txtCode.Text="",this.txtName.Text="",this.InputGrid.BomGrid.Table.Clear(),this.ExpenseGrid.BomGrid.Table.Clear(),this.OutputGrid.BomGrid.Table.Clear(),this.ResourcesGrid.BomGrid.Table.Clear(),this.FillEmptyRows(),this.Date.Date=new Date,this.Product.SelectedValue=0,this.Location.SelectedValue=0,this.Division.SelectedValue=0,this.txtDesc.Text="",this.FPQty.Text="1",this.BID=0,this.objBOM.BOMID=this.BID,this.AutoGenerateCode())},s=>{console.log(" BOM Save : "+JSON.stringify(s))})}catch(e){Logger.ErrorLog("AddEditBOMViewModel:: OnSAVE"+e.stack)}else if("ShowApprove"!=t.toString())if("ApproveMaster"==t.toString()){this.HideControls();let e=new v.i(76,this.BID,this.ScreenObject,this);l.d.page.ShowDialog(e,_.R,{ShowCenter:!0,Title:l.d.GetResource("ApproveReject")})}else"ViewHistory"==t.toString()?l.d.page.ShowDialog(new K.DocumentDraftsViewModel(this,3),W.DocumentDraftsComponent):"Print"==t.toString()?this.btnPrint_Click():"PrintPreview"==t.toString()&&this.btnPrintPreview_Click();Logger.InfoLog("AddEditBOMViewModel::Exiting OnSaveMachine ")}UpdateSequence(){this.SNo=1,this.InputGrid.BomGrid.Table.forEach(t=>{t.Sno=this.SNo++}),this.SNo=1,this.OutputGrid.BomGrid.Table.forEach(t=>{t.Sno=this.SNo++}),this.SNo=1,this.ExpenseGrid.BomGrid.Table.forEach(t=>{t.Sno=this.SNo++}),this.SNo=1,this.ResourcesGrid.BomGrid.Table.forEach(t=>{t.Sno=this.SNo++}),this.InputGrid.BomGrid.refreshDataView(),this.OutputGrid.BomGrid.refreshDataView(),this.ExpenseGrid.BomGrid.refreshDataView(),this.ResourcesGrid.BomGrid.refreshDataView()}OnCellEditEnding(t){let e=t.item,i=t.column.field;if(Object.keys(e).Contains("Machine_Key")){if("Machine"==i&&""!=e.Machine_Key.toString()){if(this.MachineID==parseInt(e.Machine_Key.toString()))return;e.Value=this.objBOM.getMachineCostHr(this.MachineCCID,parseInt(e.Machine_Key.toString())),this.ResourcesGrid.BomGrid.updateRow(e)}}else{if("DataGridComboBoxColumn"==t.column.className)return;if(Object.keys(e).Contains("UOM")&&"ProductName"==i&&!n.J0.IsEmpty(e.ProductName_Key)){let s=0;"UOM"==i&&!n.J0.IsEmpty(e.UOM_Key)&&(s=parseInt(e.UOM_Key.toString()));let r=O.ControlGenerator.GetProductTypeDetails(parseInt(e.ProductName_Key.toString()),this.Date.Date,s,78,"",!1,!1,!1,!1,!1,!1,!1,!1,!1);r.Tables.length>0&&r.Columns[0].Contains("uomid")&&!n.J0.IsEmpty(r.Tables[0][0].uomid)&&(e.UOM=r.Tables[0][0].UnitName.toString(),e.UOM_Key=r.Tables[0][0].uomid.toString(),r.Tables.length>3&&r.Tables[3].length>0&&r.Columns[3].Contains("SellingRate")&&""!=r.Tables[3][0].SellingRate.toString()?e.UnitPrice=r.Tables[3][0].SellingRate.toString():r.Tables.length>0&&r.Tables[0].length>0&&r.Columns[0].Contains("SellingRate")&&""!=r.Tables[0][0].SellingRate.toString()&&(e.UnitPrice=r.Tables[0][0].SellingRate.toString()))}this.CalculateTotals(e)}}CalculateTotals(t){let e=new J.bT,i=new M.Nl;i.setFieldDetails("RATE",1,1,"",1,!1,!1),e.push("RATE",i),i=new M.Nl,i.setFieldDetails("QTY",4,1,"",1,!1,!1),e.push("QTY",i),n.J0.IsEmpty(t.UnitPrice)?e.RATE.setFieldValue(0):e.RATE.setFieldValue(t.UnitPrice),n.J0.IsEmpty(t.Qty)?e.QTY.setFieldValue(0):e.QTY.setFieldValue(t.Qty),t.Value=l.d.eval.EvaluateExpression("QTY*RATE",e).toString()}onBeginEdit(t){let e=t.args.item,i=t.args.column,s=i.DgCol,a=(n.J0.IsEmpty(s.ValueBinding),n.J0.IsEmpty(s.ValueBinding)?s.ValueMember:s.ValueBinding);if(Object.keys(e).Contains("Machine_Key")||"Machine_Key"==a)this.MachineID=n.J0.IsEmpty(e.Machine_Key)?0:parseInt(e.Machine_Key.toString());else if("DataGridPactListBoxColumn"==i.className){let p=t.args.model;if(11==p.CostCenterID){let o=" (BaseID IN ";o+=" (SELECT BaseID ",o+=" FROM COM_UOM AS COM_UOM_1 with(nolock) ",o=o+" WHERE      (UOMID ="+e.UOM_Key.toString()+" ))) ",""==e.UOM_Key.toString()&&(o=" (BaseID IN ",o+=" (SELECT BaseID ",o+=" FROM COM_UOM AS COM_UOM_1 with(nolock) ",o+=" WHERE (UOMID =-1 ))) "),p.FilterCondition=o}3==p.CostCenterID&&"ProductName_Key"==p.SelectedValueBinding&&this.FilterCCID>0&&Object.keys(e).Contains("FilterOn_Key")&&!n.J0.IsEmpty(e.FilterOn_Key)&&parseInt(e.FilterOn_Key.toString())>0&&(3==this.FilterCCID?p.Where=" ParentID="+e.FilterOn_Key.toString()+" ":50006==this.FilterCCID?p.Where=" CategoryID="+e.FilterOn_Key.toString()+" ":50004==this.FilterCCID?p.Where=" DepartmentID="+e.FilterOn_Key.toString()+" ":this.FilterCCID>5e4&&(p.Where=" a.ProductID IN (select NodeID from COM_CCCCData with(nolock) where CostCenterID=3 and ",p.Where+=" CCNID"+this.FilterCCID.toString()+"="+e.FilterOn_Key.toString()+" )"))}}OnCustomizeExtraFields(t){}OnProductChange(t){if(this.UOM.Length!=this.Product.SelectedValue.toString()&&(this.UOM.Items.Clear(),this.UOM.Length=this.Product.SelectedValue.toString(),this.UOM.SelectedValue=null,this.Product.SelectedValue>0)){let e=this.objBOM.GetProductUnits(this.Product.SelectedValue);e.Tables[0].length>0&&(e.Tables[0].forEach(i=>{this.UOM.Items.push(g._p.ComboBoxItems_2(i.UnitName.toString(),i.UOMID.toString()))}),e.Columns[0].Contains("DefaultUOM")&&(this.UOM.SelectedValue=e.Tables[0][0].DefaultUOM.toString()))}}OnLoad(t){let e=this.objBOM.GetBOMDetails(t);if(e.Tables.length>5){if(e.Tables[0].length>0&&(this.txtCode.Text=e.Tables[0][0].BOMCode.toString(),this.txtName.Text=e.Tables[0][0].BOMName.toString(),this.Group.SelectedValue=e.Tables[0][0].ParentID.toString(),this.MStatus.SelectedValue=e.Tables[0][0].StatusID.toString(),this.txtDesc.Text=e.Tables[0][0].Description.toString(),n.J0.IsEmpty(e.Tables[0][0].ProductID)||(this.Product.SelectedValue=parseInt(e.Tables[0][0].ProductID.toString())),n.J0.IsEmpty(e.Tables[0][0].LocationID)||(this.Location.SelectedValue=parseInt(e.Tables[0][0].LocationID.toString())),n.J0.IsEmpty(e.Tables[0][0].DivisionID)||(this.Division.SelectedValue=parseInt(e.Tables[0][0].DivisionID.toString())),n.J0.IsEmpty(e.Tables[0][0].Date)||(this.Date.Date=n.J0.ParseDate(e.Tables[0][0].Date.toString())),this.FPQty.Text=e.Tables[0][0].FPQty.toString()),e.Tables.length>8&&e.Tables[8].length>0&&this.ProductionsMethod.Load(e.Tables[8]),this.ScreenObject.LoadCustomFieldsData(e.Tables[6]),this.ScreenObject.LoadCustomFieldsCCData(e.Tables[7]),this.ScreenObject.CanApprove(e.Tables[0][0],e.Tables[10][0],this.ButtonSave),this.ViewAttachments.LoadAttachments(e.Tables[13]),this.InputGrid.BomGrid.Table.Clear(),this.ExpenseGrid.BomGrid.Table.Clear(),this.ResourcesGrid.BomGrid.Table.Clear(),this.OutputGrid.BomGrid.Table.Clear(),e.Tables[1].length>0)for(let i=0;i<e.Tables[1].length;i++){let s=this.InputGrid.BomGrid.NewRow();s.ProductCode=n.J0.String(e.Tables[1][i].ProductCOde),s.ProductName=n.J0.String(e.Tables[1][i].ProductName),s.ProductName_Key=n.J0.String(e.Tables[1][i].ProductID),s.Qty=e.Tables[1][i].Quantity.toString(),e.Columns[1].Contains("UOM")&&(s.UOM=n.J0.String(e.Tables[1][i].UOM)),s.UOM_Key=n.J0.String(e.Tables[1][i].UOMID),s.UnitPrice=n.J0.String(e.Tables[1][i].UnitPrice),s.Wastage=n.J0.String(e.Tables[1][i].Wastage),s.Value=n.J0.String(e.Tables[1][i].Value),s.BOMProductID=n.J0.String(e.Tables[1][i].BOMProductID),this.InputGrid.BomGrid.TableColumns.Contains("FilterOn_Key")&&!n.J0.IsEmpty(e.Tables[1][i].FilterOn)&&(s.FilterOn_Key=n.J0.String(e.Tables[1][i].FilterOn)),this.InputGrid.BomGrid.addRow(s)}if(e.Tables[2].length>0)for(let i=0;i<e.Tables[2].length;i++){let s=this.ExpenseGrid.BomGrid.NewRow();s.Name=e.Tables[2][i].Name.toString(),s.AccountName=e.Tables[2][i].CRAccountName.toString(),n.J0.IsEmpty(e.Tables[2][i].CreditAccountID)||(s.AccountName_Key=e.Tables[2][i].CreditAccountID.toString()),s.Expense=e.Tables[2][i].DRAccountName.toString(),n.J0.IsEmpty(e.Tables[2][i].DebitAccountID)||(s.Expense_Key=e.Tables[2][i].DebitAccountID.toString()),s.Value=e.Tables[2][i].Value.toString(),s.ExpenseID=e.Tables[2][i].ExpenseID.toString(),this.ExpenseGrid.BomGrid.addRow(s)}if(e.Tables[3].length>0)for(let i=0;i<e.Tables[3].length;i++){let s=this.ResourcesGrid.BomGrid.NewRow();s.Machine=e.Tables[3][i].ResourceName.toString(),s.Machine_Key=e.Tables[3][i].ResourceID.toString(),s.Hrs=e.Tables[3][i].Hours.toString(),s.Value=e.Tables[3][i].Value.toString(),s.BOMResourceID=e.Tables[3][i].BOMResourceID.toString(),this.ResourcesGrid.BomGrid.addRow(s)}if(e.Tables[5].length>0)for(let i=0;i<e.Tables[5].length;i++){let s=this.OutputGrid.BomGrid.NewRow();s.ProductCode=e.Tables[5][i].ProductCode.toString(),s.ProductName=e.Tables[5][i].ProductName.toString(),s.ProductName_Key=e.Tables[5][i].ProductID.toString(),s.Qty=e.Tables[5][i].Quantity.toString(),s.UnitPrice=e.Tables[5][i].UnitPrice.toString(),s.Value=e.Tables[5][i].Value.toString(),s.BOMProductID=e.Tables[5][i].BOMProductID.toString(),this.OutputGrid.BomGrid.addRow(s)}this.FillEmptyRows()}if(this.InputGrid.BomGrid.RefreshGrid=this.ExpenseGrid.BomGrid.RefreshGrid=this.ResourcesGrid.BomGrid.RefreshGrid=this.OutputGrid.BomGrid.RefreshGrid=!0,e.Columns[0].Contains("WorkFlowID")&&e.Tables[0].length>0&&!n.J0.IsEmpty(e.Tables[0][0].WorkFlowID)&&parseInt(e.Tables[0][0].WorkFlowID.toString())>0&&(this.objBOM.WID=parseInt(e.Tables[0][0].WorkFlowID.toString()),this.btnHistoryVisible=!0,("1002"==this.MStatus.SelectedValue||"1001"==this.MStatus.SelectedValue||"1003"==this.MStatus.SelectedValue)&&(this.MStatus.IsReadOnly=!0),e.Tables.length>11&&e.Columns[11].Contains("WorkFlowLevel"))){""!=e.Tables[10][0].canEdit.toString()&&(0,u.yG0)(e.Tables[10][0].canEdit.toString())&&(this.ButtonSave.Enable=!0),""!=e.Tables[10][0].canApprove.toString()&&(0,u.yG0)(e.Tables[10][0].canApprove.toString())&&(this.BtnApprove.Visible=!0,this.ButtonSave.Enable=!1);let i,s,r=0;i=e.Tables[12],s=e.Tables[11],""!=e.Tables[0][0].WorkFlowLevel.toString()&&(r=parseInt(e.Tables[0][0].WorkFlowLevel.toString())),this.ScreenObject.GetWorkFlowLevels(r,s,i)}}btnPrint_Click(){this.BID>0?this.PrintBOM():(this.DisplayMessage="",this.MessageVisibility=!0)}btnPrintPreview_Click(){this.BID>0?this.PrintBOM():(this.DisplayMessage="",this.MessageVisibility=!0)}PrintBOM(){this.MoreThanOneLayout=!1;let e=this.BID;this.IsExportPrint=!1;let i=null,s=j.VoucherExportExcel.GetLocationPrintLayouts(76,0,e);if(this.IsExportPrint)i=null;else{if(null==s||0==s.Tables[0].length)return l.d.GetResource("Err_PrintLayoutNotDefined");if(s.Tables[0].length>1){this.MoreThanOneLayout=!0;let r=new L.VPTDialogViewModel(s.Tables[0]);l.d.page.ShowDialog(r,U.VPTDialogComponent,{ShowCenter:!0},()=>{r.IsOkClicked&&(i=r.SelectedRow),null!=i&&l.d.report.ExportPDF_Masters(76,e.toString(),parseInt(i.DocPrintLayoutID),"PDF").subscribe(d=>{l.d.SessionManager.printTab(d.FileName),n.J0.IsEmpty(d.Message)&&!n.J0.IsEmpty(d.FileName)&&(this.DisplayMessage="Printed Sucessfully")},d=>{this.DisplayMessage="Error in Preview",console.log(d)})})}else i=s.Tables[0][0]}return this.dsTotLayouts=s,this.drSelPrintLayout=i,null!=i&&!this.MoreThanOneLayout&&l.d.report.ExportPDF_Masters(76,e.toString(),parseInt(i.DocPrintLayoutID),"PDF").subscribe(r=>{console.log(r),l.d.SessionManager.Download(r.FileName,"abcd"),l.d.SessionManager.printTab(r.FileName),n.J0.IsEmpty(r.Message)&&!n.J0.IsEmpty(r.FileName)&&(this.DisplayMessage="printed Successfully")},r=>{this.DisplayMessage="Error in Preview",console.log(r)}),""}OnShowContact(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering OnShowContact"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting OnShowContact")}OnShowAddress(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering OnShowAddress"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting OnShowAddress")}OnAddContact(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering AddContact"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting AddContact")}OnShowNote(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering OnShowNote"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting OnShowNote")}OnShowAttachment(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering OnShowAttachment"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting OnShowAttachment")}OnAddAttachment(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering AddAttachment"),this.Attachment=new F.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting AddAttachment")}}var ee=I(38397),k=I(72247);class te{constructor(){this.ColumnSpan="4",this.Tree=new k.T}}var S=I(84833),T=I(69883),E=I(31884);class H extends V.g{get ScreenObject(){return this._ScreenObject}constructor(t,e,i,s){super(),this.StageID=0,this.parentid=0,this.FilterCCID=0,this.MachineCCID=0,this.MachineID=0,this.SNo=0,this.QtyDecimals="",this.RateDecimals="",this.objBOM=new B.b,this._ScreenObject=new O.ControlGenerator,this.Stage=new C.y$(0),this.Code="",this.Name="",this.StageNodeID=0,this.txtCost=new b.Dw(0),this.txtUsage=new b.Dw(0),this.txtDuration=new b.Dw(0),this.txtEffeciency=new b.Dw(0),this.Description=new b.Dw(0),this.MStatus=new g.y$(23898),this.Group=new g.y$(23897),this.Location=new C.y$(23900),this.Division=new C.y$(23901),this.UOM=new g.y$(109),this.Date=new D.Lc(23902),this.txtDesc=new b.Dw(23903),this.Pickrate=new E.Q("Pickrate"),this.CancelVisible=!1,this.TreeObject=null,this.Childrens=new Array,this.Parent=null,this.IsExportPrint=!1,this.drSelPrintLayout=null,this.dsTotLayouts=null,this.MoreThanOneLayout=!1,this.InputYes=!1,this.OutputYes=!1,this.ExpenseYes=!1,this.ResourceYes=!1,this.PrevValue="",this.parentid=e,this.Parent=i,this.StageID=t,this.TreeObject=s,this.MessageVisibility=!1,l.d.SessionManager.Preferences.ContainsKey("isYearMonthWiseFolder")&&"FALSE"==l.d.SessionManager.Preferences.isYearMonthWiseFolder.toUpperCase()&&(this.ScreenObject.YearMonth=""),this.Pickrate.IsHorizontalOrientation=!0,this._ScreenObject.Data=s.ScreenObject.Data;let r=this.ScreenObject.Data.Tables[4].filter(d=>"StageDimension"==d.Name);r.length>0&&r[0].Value.toString().length>0&&(this.Stage.CCID=parseInt(r[0].Value),this.Stage.TypeID=1),r=this.ScreenObject.Data.Tables[4].filter(d=>"EnableDuration"==d.Name),r.length>0&&(0,u.yG0)(r[0].Value.toString())?(this.txtDuration.Visible=!0,this.txtDuration.Label="Duration"):this.txtDuration.Visible=!1,r=this.ScreenObject.Data.Tables[4].filter(d=>"BOMDecimalsinQty"==d.Name),r.length>0&&!n.J0.IsEmpty(r[0].Value)&&(this.QtyDecimals=n.J0.String(r[0].Value)),r=this.ScreenObject.Data.Tables[4].filter(d=>"BOMDecimalsinRate"==d.Name),r.length>0&&!n.J0.IsEmpty(r[0].Value)&&(this.RateDecimals=n.J0.String(r[0].Value)),this.Pickrate.Label="Pick rate for issue products";let a=new E.u("Master",1);a.Label="Product master",a.Group=this.Pickrate,r=this.ScreenObject.Data.Tables[4].filter(d=>"BomDefaultRate"==d.Name),(0==r.length||r.length>0&&"0"==r[0].Value.toString())&&(a.IsChecked=!0),this.Pickrate.Items.push(a),a=new E.u("Chart",1),a.Label="Price chart",a.Group=this.Pickrate,r.length>0&&"1"==r[0].Value.toString()&&(a.IsChecked=!0),this.Pickrate.Items.push(a),a=new E.u("AvgRate",1),a.Label="Avg. Rate",a.Group=this.Pickrate,r.length>0&&"2"==r[0].Value.toString()&&(a.IsChecked=!0),this.Pickrate.Items.push(a),this.Pickrate.Enable=!l.d.SessionManager.IsActionAssigned(76,"Do not allow to change Pick Rate"),this.LoadData(),this.MStatus.SelectedValue="1",this.loadtabs(),t>0?this.Title="Edit Stage":(this.Title="Add Stage",this.objBOM.GUID="GUID"),this.DisplayName=this.Title,this.CheckViewForUser(),this.Stage.Label="Stage"}CheckViewForUser(){this.InputGrid.Columns.forEach(t=>{null!=t.ID&&this.ScreenObject.SetView(t,this.TreeObject.BID>0?1:0)}),this.ExpenseGrid.Columns.forEach(t=>{null!=t.ID&&this.ScreenObject.SetView(t,this.TreeObject.BID>0?1:0)}),this.ResourcesGrid.Columns.forEach(t=>{null!=t.ID&&this.ScreenObject.SetView(t,this.TreeObject.BID>0?1:0)}),this.OutputGrid.Columns.forEach(t=>{null!=t.ID&&this.ScreenObject.SetView(t,this.TreeObject.BID>0?1:0)})}loadtabs(){this.AssignRowColumns();for(let t=this._ScreenObject.CustomTab.Pages.length-1;t>=0;t--){let e=this._ScreenObject.CustomTab.Pages[t];"Production Method"===e.Name&&e.Fields.push(x)}}AssignRowColumns(){let t;t=this._ScreenObject.CustomFields.length;for(let e=0;e<t;e++)this._ScreenObject.CustomFields[e].Row=e/4,this._ScreenObject.CustomFields[e].Column=e%4}LoadData(){let t,e;this.InputGrid=new y.vv,this.InputGrid.Table=[],this.InputGrid.Columns=[],this.InputGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.InputGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.InputGrid.CanUserAddRows=!0,this.InputGrid.CanUserDeleteRows=!0,this.InputGrid.Height=230,this.InputGrid.Width="880",this.InputGrid.ShowTotals=!0,this.InputGrid.TableColumns.push("Sno"),this.InputGrid.TableColumns.push("ProductCode"),this.InputGrid.TableColumns.push("ProductName"),this.InputGrid.TableColumns.push("ProductName_Key"),this.InputGrid.TableColumns.push("Qty"),this.InputGrid.TableColumns.push("UOM"),this.InputGrid.TableColumns.push("UOM_Key"),this.InputGrid.TableColumns.push("UnitPrice"),this.InputGrid.TableColumns.push("Value"),this.InputGrid.TableColumns.push("Wastage"),this.InputGrid.TableColumns.push("BOMProductID"),this.InputGrid.TableColumns.push("IncludeinStage"),this.InputGrid.TableColumns.push("IncludeinFinal"),this.InputGrid.TableColumns.push("Stage"),this.InputGrid.TableColumns.push("Stage_Key"),this.InputGrid.TableColumns.push("Remarks"),e=new h.O7,e.Header="#",e.DisplayMember="Sno",e.DataType="TextBlock",e.Width=23,e.IsVisible=!0,e.ReadOnly=!0,e.ShowTotal=!0,this.InputGrid.Columns.push(e),this.ScreenObject.Data.Tables.length>4&&(t=this.ScreenObject.Data.Tables[4].filter(a=>"BomFilterDimension"==a.Name),t.length>0&&!n.J0.IsEmpty(t[0].Value)&&n.J0.Int(t[0].Value.toString())>0&&parseInt(t[0].Value.toString())>0&&(this.FilterCCID=parseInt(t[0].Value.toString()),e=new h.O7,e.Header="FilterOn",e.DisplayMember="FilterOn",e.ValueMember="FilterOn_Key",e.DataType="LISTBOX",e.Width=230,e.CostCenterID=parseInt(t[0].Value.toString()),e.TypeID=3==parseInt(t[0].Value.toString())?12:1,e.IsVisible=!0,this.InputGrid.Columns.push(e),this.InputGrid.TableColumns.push("FilterOn"),this.InputGrid.TableColumns.push("FilterOn_Key"))),e=new h.O7,e.Header=l.d.GetResource("BOM_ProductCOde"),e.DisplayMember="ProductCode",e.ValueMember="ProductName_Key",e.DataType="LISTBOX",e.CostCenterID=3,e.TypeID=100,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"ProductCode"==r.SysColumnName&&1==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):150,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.InputGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("BOM_ProductName"),e.DisplayMember="ProductName",e.ValueMember="ProductName_Key",e.DataType="LISTBOX",e.CostCenterID=3,e.TypeID=10,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"ProductID"==r.SysColumnName&&1==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):220,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.InputGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("Quantity"),e.DisplayMember="Qty",e.DataType="INT",e.ShowTotal=!0,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"Quantity"==r.SysColumnName&&1==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):90,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.QtyDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=l.d.SessionManager.Preferences.DecimalsinQty&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinQty):e.DecimalPoints=this.QtyDecimals,this.InputGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("UOM"),e.DisplayMember="UOM",e.ValueMember="UOM_Key",e.DataType="LISTBOX",e.CostCenterID=11,e.TypeID=1,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"UOMID"==r.SysColumnName&&1==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.InputGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("UnitPrice"),e.DisplayMember="UnitPrice",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"UnitPrice"==r.SysColumnName&&1==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.RateDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=l.d.SessionManager.Preferences.DecimalsinRate&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinRate):e.DecimalPoints=this.RateDecimals,this.InputGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("Value"),e.DisplayMember="Value",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"Value"==r.SysColumnName&&1==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.RateDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=l.d.SessionManager.Preferences.DecimalsinRate&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinRate):e.DecimalPoints=this.RateDecimals,this.InputGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("Waistage"),e.DisplayMember="Wastage",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"Wastage"==r.SysColumnName&&1==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.InputGrid.Columns.push(e);let s,i=new Array;if(i.push(g._p.ComboBoxItems_2("No","0")),i.push(g._p.ComboBoxItems_2("Yes","1")),e=new h.O7,e.Header="Incl. in Final Cost",e.ValueBinding="IncludeinFinal",e.ValueMember="Value",e.DisplayMember="Name",e.DataType="ComboBox",e.ComboData=i,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"IncInFinalCost"==r.SysColumnName&&1==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.InputGrid.Columns.push(e),e=new h.O7,e.Header="Incl. in Stage Cost",e.ValueBinding="IncludeinStage",e.DataType="ComboBox",e.ValueMember="Value",e.DisplayMember="Name",t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"IncInStageCost"==r.SysColumnName&&1==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),e.ComboData=i,this.InputGrid.Columns.push(e),l.d.SessionManager.Preferences.ContainsKey("AutoProduceDoc")&&""!=l.d.SessionManager.Preferences.AutoProduceDoc&&this.Stage.Visible&&this.Stage.CCID>5e4&&"0"!=l.d.SessionManager.Preferences.AutoProduceDoc&&parseInt(l.d.SessionManager.Preferences.AutoProduceDoc)>4e4&&(e=new h.O7,e.Header="Auto Produce",e.DisplayMember="Stage",e.ValueMember="Stage_Key",e.DataType="LISTBOX",e.Width=150,e.CostCenterID=this.Stage.CCID,e.TypeID=this.Stage.TypeID,e.IsVisible=!0,this.InputGrid.Columns.push(e)),e=new h.O7,e.Header=l.d.GetResource("Remarks"),e.DisplayMember="Remarks",e.DataType="TextBlock",t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"Remarks"==r.SysColumnName&&1==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):75,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.InputGrid.Columns.push(e),this.ExpenseGrid=new y.vv,this.ExpenseGrid.Table=[],this.ExpenseGrid.Columns=[],this.ExpenseGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.ExpenseGrid.CanUserAddRows=!0,this.ExpenseGrid.CanUserDeleteRows=!0,this.ExpenseGrid.Height=230,this.ExpenseGrid.Width="880",this.ExpenseGrid.ShowTotals=!0,e=new h.O7,e.Header="#",e.DisplayMember="Sno",e.DataType="TextBlock",e.Width=23,e.IsVisible=!0,e.ReadOnly=!0,e.ShowTotal=!0,this.ExpenseGrid.Columns.push(e),e=new h.O7,e.Header="Name",e.DisplayMember="Name",e.DataType="TextBlock",t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_Expenses"==r.SysTableName&&"Name"==r.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):200,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(e),e=new h.O7,e.Header="Debit",e.DisplayMember="Expense",e.ValueMember="Expense_Key",e.DataType="LISTBOX",e.CostCenterID=2,t=this.ScreenObject.Data.Tables[4].filter(r=>"DrAccListview"==r.Name),e.TypeID=null!=t&&t.length>0?parseInt(t[0].Value.toString()):2,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_Expenses"==r.SysTableName&&"DebitAccountID"==r.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):200,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(e),e=new h.O7,e.Header="Credit",e.DisplayMember="AccountName",e.ValueMember="AccountName_Key",e.DataType="LISTBOX",e.CostCenterID=2,t=this.ScreenObject.Data.Tables[4].filter(r=>"CrAccListview"==r.Name),e.TypeID=null!=t&&t.length>0?parseInt(t[0].Value.toString()):2,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_Expenses"==r.SysTableName&&"CreditAccountID"==r.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):200,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("Value"),e.DisplayMember="Value",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_Expenses"==r.SysTableName&&"Value"==r.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):90,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.RateDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=l.d.SessionManager.Preferences.DecimalsinRate&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinRate):e.DecimalPoints=this.RateDecimals,this.ExpenseGrid.Columns.push(e),e=new h.O7,e.Header="Incl. in Final Cost",e.ValueBinding="IncludeinFinal",e.ValueMember="Value",e.DisplayMember="Name",e.DataType="ComboBox",e.ComboData=i,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_Expenses"==r.SysTableName&&"IncInFinalCost"==r.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):107,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(e),e=new h.O7,e.Header="Incl. in Stage Cost",e.ValueBinding="IncludeinStage",e.DataType="ComboBox",e.ValueMember="Value",e.DisplayMember="Name",e.ComboData=i,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_Expenses"==r.SysTableName&&"IncInStageCost"==r.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):114,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.ExpenseGrid.Columns.push(e),this.ExpenseGrid.TableColumns.push("Sno"),this.ExpenseGrid.TableColumns.push("Name"),this.ExpenseGrid.TableColumns.push("AccountName"),this.ExpenseGrid.TableColumns.push("AccountName_Key"),this.ExpenseGrid.TableColumns.push("Expense"),this.ExpenseGrid.TableColumns.push("Expense_Key"),this.ExpenseGrid.TableColumns.push("Value"),this.ExpenseGrid.TableColumns.push("ExpenseID"),this.ExpenseGrid.TableColumns.push("IncludeinStage"),this.ExpenseGrid.TableColumns.push("IncludeinFinal"),this.ResourcesGrid=new y.vv,this.ResourcesGrid.Table=[],this.ResourcesGrid.Columns=[],this.ResourcesGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.ResourcesGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.ResourcesGrid.CanUserAddRows=!0,this.ResourcesGrid.CanUserDeleteRows=!0,this.ResourcesGrid.Height=230,this.ResourcesGrid.Width="880",this.ResourcesGrid.ShowTotals=!0,e=new h.O7,e.Header="#",e.DisplayMember="Sno",e.DataType="TextBlock",e.Width=40,e.IsVisible=!0,e.ReadOnly=!0,e.ShowTotal=!0,e.ShowTotal=!0,this.ResourcesGrid.Columns.push(e),t=this.ScreenObject.Data.Tables[4].filter(r=>"EnableMachineoptions"==r.Name),t.length>0&&t[0].Value.toString().length>0&&(0,u.yG0)(t[0].Value.toString())){e=new h.O7,e.Header="Options",e.DisplayMember="Sno",e.Width=80,e.ValueBinding="Options",e.ValueMember="Value",e.DisplayMember="Name",e.DataType="ComboBox";let r=new Array;for(let a=1;a<10;a++)r.push(g._p.ComboBoxItems_2("Option "+a,a.toString()));e.ComboData=r,this.ResourcesGrid.Columns.push(e),this.ResourcesGrid.TableColumns.push("Options")}if(e=new h.O7,e.Header=l.d.GetResource("Machine"),e.DisplayMember="Machine",e.DataType="LISTBOX",t=this.ScreenObject.Data.Tables[4].filter(r=>"MachineDimension"==r.Name),t.length>0&&t[0].Value.toString().length>0&&(this.MachineCCID=parseInt(t[0].Value),e.CostCenterID=parseInt(t[0].Value)),e.TypeID=3,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMResources"==r.SysTableName&&"ResourceID"==r.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):200,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.ResourcesGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("HRS"),e.DisplayMember="Hrs",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMResources"==r.SysTableName&&"Hours"==r.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.ResourcesGrid.Columns.push(e),e=new h.O7,e.Header="Cost/Hr",e.DisplayMember="Value",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMResources"==r.SysTableName&&"Value"==r.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.RateDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=l.d.SessionManager.Preferences.DecimalsinRate&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinRate):e.DecimalPoints=this.RateDecimals,this.ResourcesGrid.Columns.push(e),t=this._ScreenObject.Data.Tables[4].filter(r=>"MachineDim1"==r.Name),t.length>0&&!n.J0.IsEmpty(t[0].Value)&&n.J0.Int(t[0].Value.toString())>5e4){s=n.J0.Int(t[0].Value.toString());let r=this._ScreenObject.GetfeatureNames(s.toString());e=new h.O7,e.Header=r.Tables[0][0].Name.toString(),e.DisplayMember="MachineDim1",e.DataType="LISTBOX",e.CostCenterID=s,e.TypeID=1,e.Width=200,this.ResourcesGrid.Columns.push(e),this.ResourcesGrid.TableColumns.push("MachineDim1"),this.ResourcesGrid.TableColumns.push("MachineDim1_Key")}if(t=this._ScreenObject.Data.Tables[4].filter(r=>"MachineDim2"==r.Name),t.length>0&&!n.J0.IsEmpty(t[0].Value)&&n.J0.Int(t[0].Value.toString())>5e4){s=n.J0.Int(t[0].Value.toString());let r=this._ScreenObject.GetfeatureNames(s.toString());e=new h.O7,e.Header=r.Tables[0][0].Name.toString(),e.DisplayMember="MachineDim2",e.DataType="LISTBOX",e.CostCenterID=s,e.TypeID=1,e.Width=200,this.ResourcesGrid.Columns.push(e),this.ResourcesGrid.TableColumns.push("MachineDim2"),this.ResourcesGrid.TableColumns.push("MachineDim2_Key")}e=new h.O7,e.Header="Incl. in Final Cost",e.ValueBinding="IncludeinFinal",e.ValueMember="Value",e.DisplayMember="Name",e.DataType="ComboBox",e.ComboData=i,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMResources"==r.SysTableName&&"IncInFinalCost"==r.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):107,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.ResourcesGrid.Columns.push(e),e=new h.O7,e.Header="Incl. in Stage Cost",e.ValueBinding="IncludeinStage",e.DataType="ComboBox",e.ValueMember="Value",e.DisplayMember="Name",e.ComboData=i,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMResources"==r.SysTableName&&"IncInStageCost"==r.SysColumnName),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):114,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.ResourcesGrid.Columns.push(e),this.ResourcesGrid.TableColumns.push("Sno"),this.ResourcesGrid.TableColumns.push("Machine"),this.ResourcesGrid.TableColumns.push("Machine_Key"),this.ResourcesGrid.TableColumns.push("Hrs"),this.ResourcesGrid.TableColumns.push("Value"),this.ResourcesGrid.TableColumns.push("BOMResourceID"),this.ResourcesGrid.TableColumns.push("IncludeinStage"),this.ResourcesGrid.TableColumns.push("IncludeinFinal"),this.OutputGrid=new y.vv,this.OutputGrid.Table=[],this.OutputGrid.Columns=[],this.OutputGrid.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.OutputGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.OutputGrid.CanUserAddRows=!0,this.OutputGrid.CanUserDeleteRows=!0,this.OutputGrid.Height=230,this.OutputGrid.Width="880",this.OutputGrid.ShowTotals=!0,e=new h.O7,e.Header="#",e.DisplayMember="Sno",e.DataType="TextBlock",e.Width=23,e.IsVisible=!0,e.ReadOnly=!0,e.ShowTotal=!0,this.OutputGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("BOM_ProductCOde"),e.DisplayMember="ProductCode",e.ValueMember="ProductName_Key",e.DataType="LISTBOX",e.CostCenterID=3,e.TypeID=100,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"ProductCode"==r.SysColumnName&&2==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):200,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.OutputGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("BOM_ProductName"),e.DisplayMember="ProductName",e.ValueMember="ProductName_Key",e.DataType="LISTBOX",e.CostCenterID=3,e.TypeID=10,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"ProductID"==r.SysColumnName&&2==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):220,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.OutputGrid.Columns.push(e),e=new h.O7,e.Header="Qty",e.DisplayMember="Qty",e.DataType="INT",t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"Quantity"==r.SysColumnName&&2==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):90,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.QtyDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinQty")&&""!=l.d.SessionManager.Preferences.DecimalsinQty&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinQty):e.DecimalPoints=this.QtyDecimals,this.OutputGrid.Columns.push(e),e=new h.O7,e.Header=l.d.GetResource("UOM"),e.DisplayMember="UOM",e.ValueMember="UOM_Key",e.DataType="LISTBOX",e.CostCenterID=11,e.TypeID=1,t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"UOMID"==r.SysColumnName&&2==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),this.OutputGrid.Columns.push(e),e=new h.O7,e.Header="UnitPrice",e.DisplayMember="UnitPrice",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"UnitPrice"==r.SysColumnName&&2==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.RateDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=l.d.SessionManager.Preferences.DecimalsinRate&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinRate):e.DecimalPoints=this.RateDecimals,this.OutputGrid.Columns.push(e),e=new h.O7,e.Header="Value",e.DisplayMember="Value",e.DataType="FLOAT",t=this._ScreenObject.Data.Tables[0].filter(r=>"PRD_BOMProducts"==r.SysTableName&&"Value"==r.SysColumnName&&2==r.LinkData),t.length>0&&(e.Width=""!=n.J0.String(t[0].UIWidth)?parseInt(t[0].UIWidth):100,e.IsVisible=""==n.J0.String(t[0].IsVisible)||(0,u.yG0)(t[0].IsVisible),e.ID=t[0].CostCenterColID.toString()),n.J0.IsEmpty(this.RateDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=l.d.SessionManager.Preferences.DecimalsinRate&&(e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinRate):e.DecimalPoints=this.RateDecimals,this.OutputGrid.Columns.push(e),this.OutputGrid.TableColumns.push("Sno"),this.OutputGrid.TableColumns.push("ProductCode"),this.OutputGrid.TableColumns.push("ProductName"),this.OutputGrid.TableColumns.push("ProductName_Key"),this.OutputGrid.TableColumns.push("Qty"),this.OutputGrid.TableColumns.push("UnitPrice"),this.OutputGrid.TableColumns.push("Value"),this.OutputGrid.TableColumns.push("BOMProductID"),this.OutputGrid.TableColumns.push("UOM_Key"),this.OutputGrid.TableColumns.push("UOM"),this.FillEmptyRows(),this.MStatus.Items.push(g._p.ComboBoxItems_2("Active","1")),this.MStatus.Items.push(g._p.ComboBoxItems_2("InActive","2"))}FillEmptyRows(){for(let t=0;t<10;t++)this.InputGrid.addEmptyRow();for(let t=0;t<10;t++)this.ExpenseGrid.addEmptyRow();for(let t=0;t<10;t++)this.ResourcesGrid.addEmptyRow();for(let t=0;t<10;t++)this.OutputGrid.addEmptyRow();this.UpdateSequence()}ValidateGrids(){let i=0,s=!0,r=this.ScreenObject.Data.Tables[4].filter(a=>"DontSaveIf_QtyIsZero"==a.Name);r.length>0&&(s=n.J0.DoubleBool(r[0].Value.toString()));for(let a=0;a<this.OutputGrid.Table.length;a++)if(!n.J0.IsEmpty(this.OutputGrid.Table[a].ProductName_Key)&&parseInt(this.OutputGrid.Table[a].ProductName_Key.toString())>0){if(""==n.J0.String(this.OutputGrid.Table[a].Qty)||0==parseFloat(n.J0.String(this.OutputGrid.Table[a].Qty)))return"Enter Output product Qty at Row :"+(a+1).toString();i++}if(0==i&&!confirm("Output products not defined.\nDo you want to continue?"))return"Output products not defined.";for(let a=0;a<this.InputGrid.Table.length;a++)if(!n.J0.IsEmpty(this.InputGrid.Table[a].ProductName_Key)&&parseInt(this.InputGrid.Table[a].ProductName_Key.toString())>0&&(""==n.J0.String(this.InputGrid.Table[a].Qty)||0==parseFloat(n.J0.String(this.InputGrid.Table[a].Qty))&&s))return"Enter Input product Qty at Row :"+(a+1).toString();for(let a=0;a<this.ExpenseGrid.Table.length;a++)if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].AccountName_Key))if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].Expense_Key))if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].Value))if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].Name));else{if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].AccountName_Key))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].Expense_Key))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].Value))return"Incomplete Expenses Information at Row :"+(a+1).toString()}else{if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].AccountName_Key))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].Expense_Key))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].Name))return"Incomplete Expenses Information at Row :"+(a+1).toString()}else{if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].AccountName_Key))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].Value))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].Name))return"Incomplete Expenses Information at Row :"+(a+1).toString()}else{if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].Expense_Key))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].Value))return"Incomplete Expenses Information at Row :"+(a+1).toString();if(n.J0.IsEmpty(this.ExpenseGrid.Table[a].Name))return"Incomplete Expenses Information at Row :"+(a+1).toString()}return""}OnSaveBOM(t){if("Save"==t.toString())try{let e="";if(this.DisplayMessage="",0==this.Stage.SelectedValue)return this.DisplayMessage="Please select stage",void(this.MessageVisibility=!0);if(this.TreeObject.BOMNodes.forEach(i=>{if(this.IsStageExists(this.Stage.SelectedValue,i))return this.DisplayMessage="Stage already exists",void(this.MessageVisibility=!0)}),this.StageNodeID!=this.Stage.SelectedValue){let i=l.d.common.GetCodeName(this.Stage.CCID,this.Stage.SelectedValue).Tables[0];null!=i&&i.length>0&&(this.Code=i[0].Code.toString(),this.Name=i[0].Name.toString())}if(e=this.ValidateGrids(),!n.J0.IsEmpty(e))return this.DisplayMessage=e,void(this.MessageVisibility=!0);this.CancelVisible&&(null!=this.Parent?this.Parent.Childrens.push(this):this.TreeObject.BOMNodes.push(this)),this.TreeObject.RefreshBOMTree(),this.TreeObject.Tree.treecomp?.angularGrid&&(this.TreeObject.Tree.treecomp.gridObj.getData().setItems(this.TreeObject.Tree.Rows),this.TreeObject.Tree.treecomp.gridObj.getData().refresh(),this.TreeObject.Tree.treecomp.gridObj.invalidate(),l.d.page.RefreshSlickGridUI(),this.TreeObject.Tree._selectedNode=this.TreeObject.Tree.Rows[0],this.TreeObject.Tree.treecomp.gridObj.setActiveCell(0,0)),l.d.page.HideDialog(this.PopUpGUID)}catch(e){Logger.ErrorLog("MultiBOMAddEditViewModel:: OnSAVE"+e.stack)}else if("Cancel"==t)l.d.page.HideDialog(this.PopUpGUID);else if("Pickrate"==t){if("AvgRate"==this.Pickrate.CheckedItem.DBColumnName){let e=new Array,i=0;l.d.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise AverageRate")&&n.J0.Int(l.d.SessionManager.Preferences["Maintain Dimensionwise AverageRate"])>5e4&&(i=n.J0.Int(l.d.SessionManager.Preferences["Maintain Dimensionwise AverageRate"]),e.push(i)),l.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&(0,u.yG0)(l.d.SessionManager.Preferences.EnableLocationWise)&&l.d.SessionManager.Preferences.ContainsKey("Location AverageRate")&&(0,u.yG0)(l.d.SessionManager.Preferences["Location AverageRate"])&&e.push(50002),l.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&(0,u.yG0)(l.d.SessionManager.Preferences.EnableDivisionWise)&&l.d.SessionManager.Preferences.ContainsKey("Division AverageRate")&&(0,u.yG0)(l.d.SessionManager.Preferences["Division AverageRate"])&&e.push(50001);let r="";r+="<PXML>";let a="";null!=this.TreeObject.Location&&this.TreeObject.Location.SelectedValue>0&&e.Contains(50002)&&(a+=" and dcCCNID2="+this.TreeObject.Location.SelectedValue.toString()+" "),null!=this.TreeObject.Division&&this.TreeObject.Division.SelectedValue>0&&e.Contains(50001)&&(a+=" and dcCCNID1="+this.TreeObject.Division.SelectedValue.toString()+" ");for(let c=0;c<this.InputGrid.Table.length;c++)if(!n.J0.IsEmpty(this.InputGrid.Table[c].ProductName_Key)){let p="",o=1;o=n.J0.Double(this.InputGrid.Table[c].Qty),0==o&&(o=1),r+="<Row ",r+=' ProductID="'+this.InputGrid.Table[c].ProductName_Key.toString()+'" ',r+=' QTY="'+o+'" ',r+=' DETAILSID="0" ',r+=' avgwhere="'+p+a+'" ></Row> '}r+="</PXML>";let d=this.ScreenObject.GetReconcileAvgRate(r.toString(),new Date);if(null!=d&&d.Tables.length>0&&d.Columns[0].Contains("invid"))for(let c=0;c<this.InputGrid.Table.length;c++)if(!n.J0.IsEmpty(this.InputGrid.Table[c].ProductName_Key)){let p=d.Tables[0].filter(o=>o.PID==this.InputGrid.Table[c].ProductName_Key.toString());p.length>0&&(this.InputGrid.Table[c].UnitPrice=n.J0.IsEmpty(p[0].AvgRate)?0:n.J0.String(p[0].AvgRate),this.CalculateTotals(this.InputGrid.Table[c]),this.InputGrid.updateRow(this.InputGrid.Table[c]))}}else{let e="<XML>",i="";null!=this.TreeObject.Location&&this.TreeObject.Location.SelectedValue>0&&(e+='<Row CostCenterID="50002" NODEID="'+this.TreeObject.Location.SelectedValue.toString()+'" />'),null!=this.TreeObject.Division&&this.TreeObject.Division.SelectedValue>0&&(e+='<Row CostCenterID="50001" NODEID="'+this.TreeObject.Division.SelectedValue.toString()+'" />'),e+="</XML>";for(let r=0;r<this.InputGrid.Table.length;r++)n.J0.IsEmpty(this.InputGrid.Table[r].ProductName_Key)||(i+=this.InputGrid.Table[r].ProductName_Key.toString()+",");i.length>1&&(i=i.substr(0,i.length-1));let s=this.ScreenObject.GetProductDetails(i,e);if(this.ScreenObject.YearMonth=l.d.SessionManager.Preferences.ContainsKey("isYearMonthWiseFolder")&&"TRUE"==l.d.SessionManager.Preferences.isYearMonthWiseFolder.toUpperCase()?new Date(s.Tables[0][0].CDATE.toString()).ToString("yyyyMMM"):"",null!=s&&s.Tables.length>0&&s.Columns[0].Contains("ProductID")){let r="PurchaseRate",a=null;for(let d=0;d<this.InputGrid.Table.length;d++)n.J0.IsEmpty(this.InputGrid.Table[d].ProductName_Key)||(a=null,"Master"==this.Pickrate.CheckedItem.DBColumnName?s.Tables.length>0&&s.Tables[0].filter(c=>c.ProductID==this.InputGrid.Table[d].ProductName_Key.toString()).length>0&&(a=s.Tables[0].filter(c=>c.ProductID==this.InputGrid.Table[d].ProductName_Key.toString())):"Chart"==this.Pickrate.CheckedItem.DBColumnName&&(s.Tables.length>1&&s.Tables[1].filter(c=>c.ProductID==this.InputGrid.Table[d].ProductName_Key.toString()).length>0?a=s.Tables[1].filter(c=>c.ProductID==this.InputGrid.Table[d].ProductName_Key.toString()):s.Tables.length>2&&s.Tables[2].filter(c=>c.ProductID==this.InputGrid.Table[d].ProductName_Key.toString()).length>0&&(a=s.Tables[2].filter(c=>c.ProductID==this.InputGrid.Table[d].ProductName_Key.toString()))),""!=r&&(this.InputGrid.Table[d].UnitPrice=null!=a&&a.length>0&&!n.J0.IsEmpty(a[0][r])?n.J0.String(a[0][r]):0,this.CalculateTotals(this.InputGrid.Table[d]),this.InputGrid.updateRow(this.InputGrid.Table[d])))}}if(this.TreeObject.CalcOutputProductRate)for(let e=0;e<this.OutputGrid.Table.length;e++)if(!n.J0.IsEmpty(this.OutputGrid.Table[e].ProductName_Key)&&parseInt(this.OutputGrid.Table[e].ProductName_Key.toString())>0){this.OutputGrid.Table[e].Value=parseInt(this.OutputGrid.Table[e].ProductName_Key.toString())==this.TreeObject.Product.SelectedValue?this.CalcValue(!0):this.CalcValue(!1),this.CalculateTotals(this.OutputGrid.Table[e]),this.OutputGrid.updateRow(this.OutputGrid.Table[e]);break}}else"Print"==t.toString()?this.btnPrint_Click():"PrintPreview"==t.toString()&&this.btnPrintPreview_Click()}btnPrint_Click(){this.TreeObject.BID>0?this.PrintBOM():(this.DisplayMessage="",this.MessageVisibility=!0)}btnPrintPreview_Click(){this.TreeObject.BID>0?this.PrintBOM():(this.DisplayMessage="",this.MessageVisibility=!0)}PrintBOM(){this.MoreThanOneLayout=!1;let e=this.TreeObject.BID;this.IsExportPrint=!1;let i=null,s=j.VoucherExportExcel.GetLocationPrintLayouts(76,0,e);if(this.IsExportPrint)i=null;else{if(null==s||0==s.Tables[0].length)return l.d.GetResource("Err_PrintLayoutNotDefined");if(s.Tables[0].length>1){this.MoreThanOneLayout=!0;let r=new L.VPTDialogViewModel(s.Tables[0]);l.d.page.ShowDialog(r,U.VPTDialogComponent,{ShowCenter:!0},()=>{r.IsOkClicked&&(i=r.SelectedRow),null!=i&&l.d.report.ExportPDF_Masters(76,e.toString(),parseInt(i.DocPrintLayoutID),"PDF").subscribe(d=>{l.d.SessionManager.printTab(d.FileName),n.J0.IsEmpty(d.Message)&&!n.J0.IsEmpty(d.FileName)&&(this.DisplayMessage="Printed Sucessfully")},d=>{this.DisplayMessage="Error in Preview",console.log(d)})})}else i=s.Tables[0][0]}return this.dsTotLayouts=s,this.drSelPrintLayout=i,null!=i&&!this.MoreThanOneLayout&&l.d.report.ExportPDF_Masters(76,e.toString(),parseInt(i.DocPrintLayoutID),"PDF").subscribe(r=>{console.log(r),l.d.SessionManager.Download(r.FileName,"abcd"),l.d.SessionManager.printTab(r.FileName),n.J0.IsEmpty(r.Message)&&!n.J0.IsEmpty(r.FileName)&&(this.DisplayMessage="printed Successfully")},r=>{this.DisplayMessage="Error in Preview",console.log(r)}),""}IsStageExists(t,e){if(e!=this&&e.Stage.SelectedValue==t)return!0;if(e.Childrens.length>0)for(let i=0;i<e.Childrens.length;i++)if(this.IsStageExists(t,e.Childrens[i]))return!0;return!1}UpdateSequence(){this.SNo=1,this.InputGrid.Table.forEach(t=>{t.Sno=this.SNo++}),this.SNo=1,this.OutputGrid.Table.forEach(t=>{t.Sno=this.SNo++}),this.SNo=1,this.ExpenseGrid.Table.forEach(t=>{t.Sno=this.SNo++}),this.SNo=1,this.ResourcesGrid.Table.forEach(t=>{t.Sno=this.SNo++}),this.InputGrid.refreshDataView(),this.OutputGrid.refreshDataView(),this.ExpenseGrid.refreshDataView(),this.ResourcesGrid.refreshDataView()}CalculateFooter(t){let r,e=0,i=0,s="2";if(n.J0.IsEmpty(this.RateDecimals)?l.d.SessionManager.Preferences.ContainsKey("DecimalsinRate")&&""!=l.d.SessionManager.Preferences.DecimalsinRate&&(s=l.d.SessionManager.Preferences.DecimalsinRate):s=this.RateDecimals,this.ExpenseYes){for(let a=0;a<this.ExpenseGrid.Table.length;a++)!n.J0.IsEmpty(this.ExpenseGrid.Table[a].Value)&&!n.J0.IsEmpty(this.ExpenseGrid.Table[a].AccountName_Key)&&!n.J0.IsEmpty(this.ExpenseGrid.Table[a].Expense_Key)&&(e+=parseFloat(this.ExpenseGrid.Table[a].Value.toString()));r=this.ExpenseGrid.Columns.find(a=>"Value"==a.DisplayMember),null!=r&&(r.footer=e.ToString("N"+s))}else if(this.InputYes){for(let a=0;a<this.InputGrid.Table.length;a++)n.J0.IsEmpty(this.InputGrid.Table[a].ProductName_Key)||(n.J0.IsEmpty(this.InputGrid.Table[a].Qty)||(i+=parseFloat(this.InputGrid.Table[a].Qty.toString())),n.J0.IsEmpty(this.InputGrid.Table[a].Value)||(e+=parseFloat(this.InputGrid.Table[a].Value.toString())));r=this.InputGrid.Columns.find(a=>"Value"==a.DisplayMember),null!=r&&(r.footer=e.ToString("N"+s)),r=this.InputGrid.Columns.find(a=>"Qty"==a.DisplayMember),null!=r&&(r.footer=i.ToString("N"+s))}else if(this.ResourceYes){for(let a=0;a<this.ResourcesGrid.Table.length;a++)!n.J0.IsEmpty(this.ResourcesGrid.Table[a].Value)&&!n.J0.IsEmpty(this.ResourcesGrid.Table[a].Machine_Key)&&(e+=parseFloat(this.ResourcesGrid.Table[a].Value.toString()));r=this.ResourcesGrid.Columns.find(a=>"Value"==a.DisplayMember),null!=r&&(r.footer=e.ToString("N"+s))}else if(this.OutputYes){for(let a=0;a<this.OutputGrid.Table.length;a++)n.J0.IsEmpty(this.OutputGrid.Table[a].ProductName_Key)||(n.J0.IsEmpty(this.OutputGrid.Table[a].Qty)||(i+=parseFloat(this.OutputGrid.Table[a].Qty.toString())),n.J0.IsEmpty(this.OutputGrid.Table[a].Value)||(e+=parseFloat(this.OutputGrid.Table[a].Value.toString())));r=this.OutputGrid.Columns.find(a=>"Value"==a.DisplayMember),null!=r&&(r.footer=e.ToString("N"+s)),r=this.OutputGrid.Columns.find(a=>"Qty"==a.DisplayMember),null!=r&&(r.footer=i.ToString("N"+s))}this.InputGrid.UpdateFooter(),this.ExpenseGrid.UpdateFooter(),this.ResourcesGrid.UpdateFooter(),this.OutputGrid.UpdateFooter()}changeVal(){this.InputYes=!1,this.OutputYes=!1,this.ExpenseYes=!1,this.ResourceYes=!1}FindRow(t){let e=this.InputGrid.Table.find(i=>i==t);e?(this.changeVal(),this.InputYes=!0):(e=this.OutputGrid.Table.find(i=>i==t),e?(this.changeVal(),this.OutputYes=!0):(e=this.ExpenseGrid.Table.find(i=>i==t),e?(this.changeVal(),this.ExpenseYes=!0):(e=this.ResourcesGrid.Table.find(i=>i==t),e&&(this.changeVal(),this.ResourceYes=!0))))}OnCellEditEnding(t){if("DataGridComboBoxColumn"==t.column.className)return;let e=t.item,i=t.column.field;if(this.FindRow(e),Object.keys(e).Contains("Machine_Key")){if("Machine"==i&&!n.J0.IsEmpty(e.Machine_Key)){if(this.MachineID==parseInt(e.Machine_Key.toString()))return;if(e.Value=this.objBOM.getMachineCostHr(this.MachineCCID,parseInt(e.Machine_Key)),n.J0.hasprop(e,"Options")&&""==n.J0.String(e.Options)){let s=this.ResourcesGrid.Table.indexOf(e);s>0&&!n.J0.IsEmpty(this.ResourcesGrid.Table[s-1].Options)&&(e.Options=this.ResourcesGrid.Table[s-1].Options),this.ResourcesGrid.updateRow(e)}}}else if(this.InputYes||this.OutputYes){if(("ProductCode"==i||"ProductName"==i)&&!n.J0.IsEmpty(e.ProductName_Key)&&e.ProductName_Key.toString()!=this.PrevValue){let s=0;Object.keys(e).Contains("UOM")&&"UOM"==i&&!n.J0.IsEmpty(e.UOM_Key)&&(s=parseInt(e.UOM_Key.toString()));let r=!1;"AvgRate"==this.Pickrate.CheckedItem.DBColumnName&&!this.OutputYes&&(r=!0);let a=O.ControlGenerator.GetProductTypeDetails(parseInt(e.ProductName_Key.toString()),this.Date.Date,s,76,"",r,!1,!1,!1,!1,!1,!1,!1,!1);""==n.J0.String(e.Qty)&&(e.Qty="1"),a.Tables.length>0&&a.Columns[0].Contains("uomid")&&!n.J0.IsEmpty(a.Tables[0][0].uomid)&&(e.UOM=n.J0.String(a.Tables[0][0].UnitName),e.UOM_Key=n.J0.String(a.Tables[0][0].uomid),this.InputGrid.Table==e.Table&&("AvgRate"==this.Pickrate.CheckedItem.DBColumnName&&a.Columns[0].Contains("AvgRate")&&!n.J0.IsEmpty(a.Tables[0][0].AvgRate)&&(e.UnitPrice=a.Tables[0][0].AvgRate.toString()),"Master"==this.Pickrate.CheckedItem.DBColumnName&&a.Tables.length>0&&a.Tables[0].length>0&&a.Columns[0].Contains("PurchaseRate")&&!n.J0.IsEmpty(a.Tables[0][0].PurchaseRate)&&(e.UnitPrice=a.Tables[0][0].PurchaseRate.toString()),"Chart"==this.Pickrate.CheckedItem.DBColumnName&&a.Tables.length>3&&a.Tables[3].length>0&&a.Columns[3].Contains("PurchaseRate")&&!n.J0.IsEmpty(a.Tables[3][0].PurchaseRate)&&(e.UnitPrice=a.Tables[3][0].PurchaseRate.toString())))}this.CalculateTotals(e),this.InputYes?this.InputGrid.updateRow(e):this.OutputYes&&this.OutputGrid.updateRow(e)}if(this.TreeObject.CalcOutputProductRate)for(let s=0;s<this.OutputGrid.Table.length;s++)if(!n.J0.IsEmpty(this.OutputGrid.Table[s].ProductName_Key)&&parseInt(this.OutputGrid.Table[s].ProductName_Key.toString())>0){this.OutputGrid.Table[s].Value=parseInt(this.OutputGrid.Table[s].ProductName_Key.toString())==this.TreeObject.Product.SelectedValue?this.CalcValue(!0):this.CalcValue(!1),this.CalculateTotals(this.OutputGrid.Table[s]),this.OutputGrid.updateRow(this.OutputGrid.Table[s]);break}this.CalculateFooter(e.Table)}CalcValue(t){let e=0,i=0;for(let s=0;s<this.InputGrid.Table.length;s++)!n.J0.IsEmpty(this.InputGrid.Table[s].ProductName_Key)&&parseInt(this.InputGrid.Table[s].ProductName_Key.toString())>0&&!n.J0.IsEmpty(this.InputGrid.Table[s].Value)&&("1"==n.J0.String(this.InputGrid.Table[s].IncludeinFinal)&&(e+=parseFloat(this.InputGrid.Table[s].Value.toString())),"1"==n.J0.String(this.InputGrid.Table[s].IncludeinStage)&&(i+=parseFloat(this.InputGrid.Table[s].Value.toString())));for(let s=0;s<this.ExpenseGrid.Table.length;s++)!n.J0.IsEmpty(this.ExpenseGrid.Table[s].AccountName_Key)&&!n.J0.IsEmpty(this.ExpenseGrid.Table[s].Expense_Key)&&!n.J0.IsEmpty(this.ExpenseGrid.Table[s].Value)&&("1"==n.J0.String(this.ExpenseGrid.Table[s].IncludeinFinal)&&(e+=parseFloat(this.ExpenseGrid.Table[s].Value.toString())),"1"==n.J0.String(this.ExpenseGrid.Table[s].IncludeinStage)&&(i+=parseFloat(this.ExpenseGrid.Table[s].Value.toString())));for(let s=0;s<this.ResourcesGrid.Table.length;s++)!n.J0.IsEmpty(this.ResourcesGrid.Table[s].Machine_Key)&&!n.J0.IsEmpty(this.ResourcesGrid.Table[s].Value)&&!n.J0.IsEmpty(this.ResourcesGrid.Table[s].Hrs)&&("1"==n.J0.String(this.ResourcesGrid.Table[s].IncludeinFinal)&&(e+=parseFloat(this.ResourcesGrid.Table[s].Value.toString())*parseFloat(this.ResourcesGrid.Table[s].Hrs.toString())),"1"==n.J0.String(this.ResourcesGrid.Table[s].IncludeinStage)&&(i+=parseFloat(this.ResourcesGrid.Table[s].Value.toString())*parseFloat(this.ResourcesGrid.Table[s].Hrs.toString())));if(t){for(let s=0;s<this.TreeObject.BOMNodes.length;s++){const r=this.TreeObject.BOMNodes[s];if(r!=this){for(let a=0;a<r.InputGrid.Table.length;a++)!n.J0.IsEmpty(r.InputGrid.Table[a].ProductName_Key)&&parseInt(r.InputGrid.Table[a].ProductName_Key.toString())>0&&!n.J0.IsEmpty(r.InputGrid.Table[a].Value)&&"1"==n.J0.String(r.InputGrid.Table[a].IncludeinFinal)&&(e+=parseFloat(r.InputGrid.Table[a].Value.toString()));for(let a=0;a<r.ExpenseGrid.Table.length;a++)!n.J0.IsEmpty(r.ExpenseGrid.Table[a].AccountName_Key)&&!n.J0.IsEmpty(r.ExpenseGrid.Table[a].Expense_Key)&&!n.J0.IsEmpty(r.ExpenseGrid.Table[a].Value)&&"1"==n.J0.String(r.ExpenseGrid.Table[a].IncludeinFinal)&&(e+=parseFloat(r.ExpenseGrid.Table[a].Value.toString()));for(let a=0;a<r.ResourcesGrid.Table.length;a++)!n.J0.IsEmpty(r.ResourcesGrid.Table[a].Machine_Key)&&!n.J0.IsEmpty(r.ResourcesGrid.Table[a].Value)&&!n.J0.IsEmpty(r.ResourcesGrid.Table[a].Hrs)&&"1"==n.J0.String(r.ResourcesGrid.Table[a].IncludeinFinal)&&(e+=parseFloat(r.ResourcesGrid.Table[a].Value.toString())*parseFloat(r.ResourcesGrid.Table[a].Hrs.toString()))}}return e.toString()}return i.toString()}CalculateTotals(t){let e=new J.bT,i=new M.Nl;i.setFieldDetails("RATE",1,1,"",1,!1,!1),e.push("RATE",i),i=new M.Nl,i.setFieldDetails("QTY",4,1,"",1,!1,!1),e.push("QTY",i),i=new M.Nl,i.setFieldDetails("Value",4,1,"",1,!1,!1),e.push("Value",i),n.J0.IsEmpty(t.UnitPrice)?e.RATE.setFieldValue(0):e.RATE.setFieldValue(t.UnitPrice),n.J0.IsEmpty(t.Qty)?e.QTY.setFieldValue(0):e.QTY.setFieldValue(t.Qty),n.J0.IsEmpty(t.Value)?e.Value.setFieldValue(0):e.Value.setFieldValue(t.Value);let s=e;this.OutputGrid.Table.find(a=>a==t)&&this.TreeObject.CalcOutputProductRate?t.UnitPrice=l.d.eval.EvaluateExpression("Value/QTY",s).toString():t.Value=l.d.eval.EvaluateExpression("QTY*RATE",s).toString()}onBeginEdit(t){let e=t.args.item,i=t.args.column,s=i.DgCol;if(n.J0.IsEmpty(s.ValueBinding),n.J0.IsEmpty(s.ValueBinding),Object.keys(e).Contains("Machine_Key"))this.MachineID=n.J0.IsEmpty(e.Machine_Key)?0:parseInt(e.Machine_Key.toString());else if("DataGridPactListBoxColumn"==i.className){let p=t.args.model;if(11==p.CostCenterID){let o="";Object.keys(e).Contains("ProductName_Key")&&(o=e.ProductName_Key.toString());let m=" (BaseID IN ";m+=" (SELECT     BaseID ",m+=" FROM          COM_UOM AS COM_UOM_1 with(nolock) ",m=m+" WHERE      (UOMID =(select UOMID from inv_product with(nolock) where productid="+o+") ))) ",""==o&&(m=" (BaseID IN ",m+=" (SELECT BaseID ",m+=" FROM COM_UOM AS COM_UOM_1 with(nolock) ",m+=" WHERE (UOMID =-1 ))) "),p.FilterCondition=m}else p.CostCenterID==this.Stage.CCID&&(p.FilterCondition="a.NodeID in(-1",null!=this.Parent?this.Parent.Childrens.forEach(o=>{o!=this&&o.Stage.SelectedValue>0&&!n.J0.IsEmpty(e.ProductName_Key)&&o.OutputGrid.Table.filter(m=>m.ProductName_Key==e.ProductName_Key.toString()).length>0&&(p.FilterCondition+=","+o.Stage.SelectedValue)}):this.TreeObject.BOMNodes.forEach(o=>{o!=this&&o.Stage.SelectedValue>0&&!n.J0.IsEmpty(e.ProductName_Key)&&o.OutputGrid.Table.filter(m=>m.ProductName_Key==e.ProductName_Key.toString()).length>0&&(p.FilterCondition+=","+o.Stage.SelectedValue)}),p.FilterCondition+=")");if(3==p.CostCenterID&&"ProductName_Key"==p.SelectedValueBinding&&(this.PrevValue=n.J0.String(e.ProductName_Key)),3==p.CostCenterID&&"ProductName_Key"==p.SelectedValueBinding&&this.FilterCCID>0&&Object.keys(e).Contains("FilterOn_Key")&&!n.J0.IsEmpty(e.FilterOn_Key)&&parseInt(e.FilterOn_Key.toString())>0&&(3==this.FilterCCID?p.Where=" ParentID="+e.FilterOn_Key.toString()+" ":50006==this.FilterCCID?p.Where=" CategoryID="+e.FilterOn_Key.toString()+" ":50004==this.FilterCCID?p.Where=" DepartmentID="+e.FilterOn_Key.toString()+" ":this.FilterCCID>5e4&&(p.Where=" a.ProductID IN (select NodeID from COM_CCCCData with(nolock) where CostCenterID=3 and ",p.Where+=" CCNID"+(this.FilterCCID-5e4).toString()+"="+e.FilterOn_Key.toString()+" )")),3==p.CostCenterID&&"ProductName_Key"==p.SelectedValueBinding){let o=this.InputGrid.Table.indexOf(e);if(o=-1==o||this.InputGrid.Table.length-o<3?3:0,this.InputGrid.CanUserAddRows)for(let m=0;m<o;m++){let X=this.InputGrid.NewRow();X.Sno=this.InputGrid.Table.length+1,this.InputGrid.addRow(X)}}}}OnCustomizeExtraFields(t){}LoadBOM(t){let e;this.InputGrid.Table.Clear(),this.ExpenseGrid.Table.Clear(),this.ResourcesGrid.Table.Clear(),this.OutputGrid.Table.Clear(),e=t.Tables[1],e=e.filter(i=>i.StageID==this.StageID),e.forEach(i=>{let s=this.InputGrid.NewRow();s.ProductCode=n.J0.String(i.ProductCOde),s.ProductName=n.J0.String(i.ProductName),s.ProductName_Key=n.J0.String(i.ProductID),s.Qty=n.J0.String(i.Quantity),Object.keys(i).Contains("UOM")&&(s.UOM=n.J0.String(i.UOM)),s.UOM_Key=n.J0.String(i.UOMID),s.UnitPrice=n.J0.String(i.UnitPrice),s.Wastage=n.J0.String(i.Wastage),s.Value=n.J0.String(i.Value),s.BOMProductID=n.J0.String(i.BOMProductID),s.IncludeinFinal=!n.J0.IsEmpty(i.IncInFinalCost)&&(0,u.yG0)(i.IncInFinalCost.toString())?"1":"0",s.IncludeinStage=!n.J0.IsEmpty(i.IncInStageCost)&&(0,u.yG0)(i.IncInStageCost.toString())?"1":"0",this.InputGrid.TableColumns.Contains("FilterOn_Key")&&!n.J0.IsEmpty(i.FilterOn)&&(s.FilterOn_Key=n.J0.String(i.FilterOn)),this.InputGrid.TableColumns.Contains("Stage_Key")&&!n.J0.IsEmpty(i.AutoStage)&&(s.Stage_Key=n.J0.String(i.AutoStage)),s.Remarks=n.J0.String(i.Remarks),this.InputGrid.addRow(s)}),this.changeVal(),this.InputYes=!0,this.CalculateFooter(this.InputGrid.Table),e=t.Tables[2],e=e.filter(i=>i.StageID==this.StageID),e.forEach(i=>{let s=this.ExpenseGrid.NewRow();s.Name=n.J0.String(i.Name),s.AccountName=n.J0.String(i.CRAccountName),n.J0.IsEmpty(i.CreditAccountID)||(s.AccountName_Key=i.CreditAccountID.toString()),s.Expense=n.J0.String(i.DRAccountName),n.J0.IsEmpty(i.DebitAccountID)||(s.Expense_Key=i.DebitAccountID.toString()),s.Value=n.J0.String(i.Value),s.ExpenseID=n.J0.String(i.ExpenseID),s.IncludeinFinal=!n.J0.IsEmpty(i.IncInFinalCost)&&(0,u.yG0)(i.IncInFinalCost.toString())?"1":"0",s.IncludeinStage=!n.J0.IsEmpty(i.IncInStageCost)&&(0,u.yG0)(i.IncInStageCost.toString())?"1":"0",this.ExpenseGrid.addRow(s)}),this.changeVal(),this.ExpenseYes=!0,this.CalculateFooter(this.ExpenseGrid.Table),e=t.Tables[3],e=e.filter(i=>i.StageID==this.StageID),e.forEach(i=>{let s=this.ResourcesGrid.NewRow();s.Machine=n.J0.String(i.ResourceName),s.Machine_Key=n.J0.String(i.ResourceID),s.Hrs=n.J0.String(i.Hours),s.Value=n.J0.String(i.Value),s.BOMResourceID=n.J0.String(i.BOMResourceID),this.ResourcesGrid.TableColumns.Contains("MachineDim1_Key")&&!n.J0.IsEmpty(i.MachineDim1)&&(s.MachineDim1_Key=i.MachineDim1.toString()),this.ResourcesGrid.TableColumns.Contains("MachineDim2_Key")&&!n.J0.IsEmpty(i.MachineDim2)&&(s.MachineDim2_Key=i.MachineDim2.toString()),this.ResourcesGrid.TableColumns.Contains("Options")&&n.J0.IsEmpty(i.Options)&&(s.Options=n.J0.String(i.Options)),s.IncludeinFinal=!n.J0.IsEmpty(i.IncInFinalCost)&&(0,u.yG0)(i.IncInFinalCost.toString())?"1":"0",s.IncludeinStage=!n.J0.IsEmpty(i.IncInStageCost)&&(0,u.yG0)(i.IncInStageCost.toString())?"1":"0",this.ResourcesGrid.addRow(s)}),this.changeVal(),this.ResourceYes=!0,this.CalculateFooter(this.ResourcesGrid.Table),e=t.Tables[5],e=e.filter(i=>i.StageID==this.StageID),e.forEach(i=>{let s=this.OutputGrid.NewRow();s.ProductCode=n.J0.String(i.ProductCode),s.ProductName=n.J0.String(i.ProductName),s.ProductName_Key=n.J0.String(i.ProductID),s.Qty=n.J0.String(i.Quantity),s.UnitPrice=n.J0.String(i.UnitPrice),s.Value=n.J0.String(i.Value),Object.keys(i).Contains("UnitName")&&(s.UOM=n.J0.String(i.UnitName)),n.J0.IsEmpty(i.UOMID)||(s.UOM_Key=i.UOMID.toString()),s.BOMProductID=n.J0.String(i.BOMProductID),this.OutputGrid.addRow(s)}),this.changeVal(),this.OutputYes=!0,this.CalculateFooter(this.OutputGrid.Table),this.FillEmptyRows(),this.InputGrid.RefreshGrid=this.ExpenseGrid.RefreshGrid=this.ResourcesGrid.RefreshGrid=this.OutputGrid.RefreshGrid=!0}}var Q=I(50761);class R extends V.g{get ScreenObject(){return this._ScreenObject}get MoveSelectedBomStageVisibility(){return this._MoveSelectedBomStageVisibility}set MoveSelectedBomStageVisibility(t){t!=this._MoveSelectedBomStageVisibility&&(this._MoveSelectedBomStageVisibility=t,this._MoveSelectedBomStageVisibility&&(this._AttachmentVisibility=!1))}constructor(t,e){super(),this.BID=0,this.parentid=0,this.IsClone=!1,this.iCntBOM=-1,this.objBOM=new B.b,this.btnHistoryVisible=!1,this.BtnApprove=new G.v,this.ButtonCopy=new G.v,this._ScreenObject=new O.ControlGenerator,this.Packing=new b.Dw(27305),this.txtCode=new b.Dw(555025),this.txtName=new b.Dw(555026),this.txtCost=new b.Dw(0),this.txtUsage=new b.Dw(0),this.txtCapacity=new b.Dw(0),this.txtEffeciency=new b.Dw(0),this.Description=new b.Dw(23903),this.MStatus=new g.y$(23898),this.Group=new g.y$(23897),this.Location=new C.y$(23900),this.Division=new C.y$(23901),this.Product=new C.y$(23899),this.UOM=new g.y$(109),this.FPQty=new b.Dw(27269),this.Date=new D.Lc(23902),this.txtDesc=new b.Dw(23903),this._MoveSelectedBomStageVisibility=!1,this.brush="Red",this.TreeFlds=null,this.BOMNodes=new Array,this.CalcOutputProductRate=!1,this.IsMultiBom=!0,this._AttachmentVisibility=!1,this.ClassName="MultiBOMTreeViewModel",this.ButtonSave=new G.v,Logger.InfoLog("MultiBOMTreeViewModel::Entering MultiBOMTreeViewModel "),this.parentid=e,this.BID=t,this.MessageVisibility=!1,this.CostCenterID=76,this._ScreenObject.LoadScreen_2(this,76),this.BtnApprove.Visible=!1,this.Product.SelectionChangedCommand.Subscribe(this,"OnProductChange"),this._ScreenObject.CustomTab.OnTabChange.Subscribe(this,"onTabSelectionChanged"),this.ViewAttachments=new A.ViewAttachmentViewModel(this),0==t?(l.d.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=l.d.SessionManager.IsActionAssigned(76,"Create"):this.ButtonSave.Enable=l.d.SessionManager.IsActionAssigned(76,"Create"),this.ButtonCopy.Visible=!1):(this.ScreenObject.IsEdit=!0,l.d.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=l.d.SessionManager.IsActionAssigned(76,"Update"):this.ButtonSave.Enable=l.d.SessionManager.IsActionAssigned(76,"Update"),l.d.SessionManager.HideUnathorizedAccess?this.ButtonCopy.Visible=l.d.SessionManager.IsActionAssigned(this.CostCenterID,"Clone"):this.ButtonCopy.Enable=l.d.SessionManager.IsActionAssigned(this.CostCenterID,"Clone"));let i=this.ScreenObject.StaticFields.find(r=>23899==r.DBColumnID);null!=i?(this.Product.CCID=i.CCID,this.Product.TypeID=i.TypeID,0==this.Product.CCID&&(this.Product.CCID=3),0==this.Product.TypeID&&(this.Product.TypeID=10)):(this.Product.CCID=3,this.Product.TypeID=10),this._ScreenObject.Data.Tables[3].forEach(r=>{this.MStatus.Items.push(g._p.ComboBoxItems_2(r[Object.keys(r)[1]].toString(),r[Object.keys(r)[0]].toString()))}),"1"!=l.d.SessionManager.RoleID&&l.d.SessionManager.IsActionAssigned(76,"Save as UnApproved")&&(this.MStatus.SelectedValue="464",this.MStatus.Visible=!1),this.FPQty.Text="1";let s=this.ScreenObject.Data.Tables[4].filter(r=>"CapsLock"==r.Name);s.length>0&&(0,u.yG0)(s[0].Value)&&(this.txtName.IsAllCaps=!0),s=this.ScreenObject.Data.Tables[4].filter(r=>"CapsToFirstLetter"==r.Name),s.length>0&&(0,u.yG0)(s[0].Value)&&(this.txtName.IsFirstLetterCaps=!0),s=this.ScreenObject.Data.Tables[4].filter(r=>"CalcOutputProductRate"==r.Name),s.length>0&&(0,u.yG0)(s[0].Value)&&(this.CalcOutputProductRate=!0),s=this.ScreenObject.Data.Tables[4].filter(r=>"BomTreeFields"==r.Name),s.length>0&&!n.J0.IsEmpty(s[0].Value)&&(this.TreeFlds=s[0].Value.toString().split(",")),this.InitTree(),this.BOMTreeControl=new te,this.BOMTreeControl.Tree=this.Tree,this.BOMTreeControl.Parent=this,this.BOMTreeControl.Tree.ClassName="TreeViewModel",this.loadtabs(),this.BID>0?(this.OnLoad(this.BID),this.Title=l.d.GetResource("BOM_EditBOM")):(this.Title=l.d.GetResource("BOM_AddBOM"),this.objBOM.GUID="GUID",this.AutoGenerateCode()),this.DisplayName=this.Title,this.Group.SelectedValue=this.parentid.toString(),null==this.BOMTreeControl.Tree.SelectedNode&&(this.BOMTreeControl.Tree.SelectedNode=this.BOMTreeControl.Tree.Rows[0],this.BOMTreeControl.Tree.Rows.length>1&&(this.BOMTreeControl.Tree.SelectedNode=this.BOMTreeControl.Tree.Rows[1],this.OnNodeSelected(this.BOMTreeControl.Tree.Rows[1])))}OnNodeSelected(t){(null==this.SelectedNodeObj||this.BOMTreeControl.Tree.SelectedNode?.Tag!=this.SelectedNodeObj)&&(null!=this.SelectedNodeObj&&l.d.page.ActiveTab.grids?.length>0&&(l.d.page.ActiveTab.grids.Remove(this.SelectedNodeObj.InputGrid),l.d.page.ActiveTab.grids.Remove(this.SelectedNodeObj.ExpenseGrid),l.d.page.ActiveTab.grids.Remove(this.SelectedNodeObj.ResourcesGrid),l.d.page.ActiveTab.grids.Remove(this.SelectedNodeObj.OutputGrid)),this.SelectedNodeObj=null,setTimeout(()=>{this.SelectedNodeObj=this.BOMTreeControl.Tree.SelectedNode?.Tag},5))}AssignRowColumns(){let t;t=this._ScreenObject.CustomFields.length;for(let e=0;e<t;e++)this._ScreenObject.CustomFields[e].Row=e/4,this._ScreenObject.CustomFields[e].Column=e%4}loadtabs(){this.AssignRowColumns();let t=null,e=null,i=null,s=null,r=null;for(let a=this._ScreenObject.CustomTab.Pages.length-1;a>=0;a--){let d=this._ScreenObject.CustomTab.Pages[a];switch(d.Name){case"Production Method":r=d;break;case"Raw Materials":t=d;break;case"Expenses":e=d;break;case"Machines":i=d;break;case"Other Outputs":s=d;break;case"Stages":d.Fields.push(this.BOMTreeControl.Tree);break;case"Attachments":d.Fields.push(this.ViewAttachments)}}this.ScreenObject.CustomTab.Pages.Remove(t),this.ScreenObject.CustomTab.Pages.Remove(r),this.ScreenObject.CustomTab.Pages.Remove(e),this.ScreenObject.CustomTab.Pages.Remove(i),this.ScreenObject.CustomTab.Pages.Remove(s)}InitTree(){this.Tree=new k.T,this.Tree.ColumnsSource=new Array;let t="STRING";if(null!=this.TreeFlds){let i=1;if(this.TreeFlds.Contains("ProductCode")&&this.TreeFlds.Contains("ProductName")){let r=new S.i;r.DataType=t,r.HeaderText="Code-Name",r.DisplayMember="Text[0]",r.DisplayIndex="0",r.width="240",this.Tree.ColumnsSource.push(r)}else if(this.TreeFlds.Contains("ProductCode")){let r=new S.i;r.DataType=t,r.HeaderText="Code",r.DisplayMember="Text[0]",r.DisplayIndex="0",r.width="120",this.Tree.ColumnsSource.push(r)}else{let r=new S.i;r.DataType=t,r.HeaderText="Name",r.DisplayMember="Text[0]",r.DisplayIndex="0",r.width="120",this.Tree.ColumnsSource.push(r)}let s=0;if(this.TreeFlds.Contains("Qty")||this.TreeFlds.Contains("Hrs")){let r=new S.i;r.DataType=t,r.HeaderText="Qty/Hrs",s=i++,r.DisplayMember="Text["+s+"]",r.DisplayIndex=s.toString(),r.width="120",this.Tree.ColumnsSource.push(r)}if(this.TreeFlds.Contains("UOM")||this.TreeFlds.Contains("Debit")){let r=new S.i;r.DataType=t,r.HeaderText="UOM/Debit",s=i++,r.DisplayMember="Text["+s+"]",r.DisplayIndex=s.toString(),r.width="120",this.Tree.ColumnsSource.push(r)}if(this.TreeFlds.Contains("UnitPrice")||this.TreeFlds.Contains("Credit")){let r=new S.i;r.DataType=t,r.HeaderText="UnitPrice/Credit",s=i++,r.DisplayMember="Text["+s+"]",r.DisplayIndex=s.toString(),r.width="120",this.Tree.ColumnsSource.push(r)}if(this.TreeFlds.Contains("Value")){let r=new S.i;r.DataType=t,r.HeaderText="Value",s=i++,r.DisplayMember="Text["+s+"]",r.DisplayIndex=s.toString(),r.width="120",this.Tree.ColumnsSource.push(r)}if(this.TreeFlds.Contains("IncludeinFinal")){let r=new S.i;r.DataType=t,r.HeaderText="Incl. in Final Cost",s=i++,r.DisplayMember="Text["+s+"]",r.DisplayIndex=s.toString(),r.width="120",this.Tree.ColumnsSource.push(r)}if(this.TreeFlds.Contains("IncludeinStage")){let r=new S.i;r.DataType=t,r.HeaderText="Incl. in Stage Cost",s=i++,r.DisplayMember="Text["+s+"]",r.DisplayIndex=s.toString(),r.width="120",this.Tree.ColumnsSource.push(r)}}else{let i=new S.i;i.DataType=t,i.HeaderText="Code",i.DisplayMember="Text[0]",i.DisplayIndex="0",i.width="380",this.Tree.ColumnsSource.push(i),i=new S.i,i.DataType=t,i.HeaderText="Name",i.DisplayMember="Text[0]",i.DisplayIndex="1",i.width="420",this.Tree.ColumnsSource.push(i)}this.Tree.Rows=[],this.Tree.AllNodes=new Array,this.Tree.Root=new T.n,this.Tree.Root.Tree=this.Tree,this.Tree.Root.Children=(new T.n.NodeCollection).NodeCollection_1(this.Tree.Root),this.Tree.Root.Nodes=this.Tree.Root.Children,this.Tree.lstParents=new Array;let e=new T.n;e.IsGroup=!0,e.LevelNo=0,e.Tree=this.Tree,e.Children=(new T.n.NodeCollection).NodeCollection_1(e),e.Nodes=e.Children,e.IsExpandedOnce=!0,e.AssignIsExpanded(!0),e.Text.push("All Stages"),e.Text.push(""),e.Id=1,e.id=1,e.CallPropertyChange(),this.Tree.Rows.push(e),this.Tree.Root.Children.push(e),this.Tree.BtnSelectionVisibility=!0}onTabSelectionChanged(t){try{null!=this.ScreenObject.CustomTab.SelectedTab&&("Attachments"==this.ScreenObject.CustomTab.SelectedTab.Name?this.ViewAttachments.OnShowNewAttachment(null):this.AttachmentVisibility=!1)}catch(e){this.DisplayMessage=this.ScreenObject.CustomTab.SelectedTab.Name+": "+e.Message,this.MessageVisibility=!0}}AutoGenerateCode(){this.objBOM.GetBOMDetails(this.BID);let e=l.d.common.GetAutoSequence(76,"","76",l.d.SessionManager.CompanyIndex.toString()),i=this.ScreenObject.Data.Tables[4].filter(s=>"CodeAutoGen"==s.Name);i.length>0&&((0,u.yG0)(i[0].Value)?(this.txtCode.Enable=!1,this.txtCode.Mandatory=!1,0==this.BID&&(this.txtCode.Text=e)):this.txtCode.Enable=!0),i=this.ScreenObject.Data.Tables[4].filter(s=>"CapsLock"==s.Name),i.length>0&&(0,u.yG0)(i[0].Value)&&(this.txtName.IsAllCaps=!0),i=this.ScreenObject.Data.Tables[4].filter(s=>"CapsToFirstLetter"==s.Name),i.length>0&&(0,u.yG0)(i[0].Value)&&(this.txtName.IsFirstLetterCaps=!0)}OnLoad(t){let e=this.objBOM.GetBOMDetails(t);if(e.Tables[0].length>0&&(this.txtCode.Text=n.J0.String(e.Tables[0][0].BOMCode),this.txtName.Text=n.J0.String(e.Tables[0][0].BOMName),this.Group.SelectedValue=n.J0.String(e.Tables[0][0].ParentID),this.MStatus.SelectedValue=n.J0.String(e.Tables[0][0].StatusID),this.txtDesc.Text=n.J0.String(e.Tables[0][0].Description),n.J0.IsEmpty(e.Tables[0][0].ProductID)||(this.Product.SelectedValue=parseInt(e.Tables[0][0].ProductID.toString())),n.J0.IsEmpty(e.Tables[0][0].LocationID)||(this.Location.SelectedValue=parseInt(e.Tables[0][0].LocationID.toString())),n.J0.IsEmpty(e.Tables[0][0].DivisionID)||(this.Division.SelectedValue=parseInt(e.Tables[0][0].DivisionID.toString())),n.J0.IsEmpty(e.Tables[0][0].Date)||(this.Date.Date=n.J0.ParseDate(e.Tables[0][0].Date.toString())),this.FPQty.Text=n.J0.String(e.Tables[0][0].FPQty),this.OnProductChange(null),this.UOM.SelectedValue=n.J0.String(e.Tables[0][0].UOMID),e.Columns[0].Contains("Packing")&&(this.Packing.Text=n.J0.String(e.Tables[0][0].Packing)),this.objBOM.GUID=n.J0.String(e.Tables[0][0].GUID)),this.ScreenObject.LoadCustomFieldsData(e.Tables[6]),this.ScreenObject.LoadCustomFieldsCCData(e.Tables[7]),this.ScreenObject.CanApprove(e.Tables[0][0],e.Tables[10][0],this.ButtonSave),this.IsClone&&e.Tables.length>13&&e.Tables[13].length>0)for(let i=0;i<e.Tables[13].length;i++)e.Tables[13][i].FileID=0,e.Tables[13][i].GUID=n.J0.NewGuid();if(this.ViewAttachments.LoadAttachments(e.Tables[13]),e.Tables[9].forEach(i=>{let s=new H(parseInt(i.StageID),parseInt(i.ParentID),null,this);s.Code=n.J0.String(i.Code),s.Name=n.J0.String(i.Name),s.StageNodeID=parseInt(i.StageNodeID),s.Stage.SelectedValue=parseInt(i.StageNodeID),e.Columns[9].Contains("Duration")&&!n.J0.IsEmpty(i.Duration)&&(s.txtDuration.Text=i.Duration.toString()),s.LoadBOM(e),1!=s.parentid?(s.Parent=this.GetParent(this.BOMNodes,s.parentid),s.Parent.Childrens.push(s)):this.BOMNodes.push(s)}),e.Columns[0].Contains("WorkFlowID")&&e.Tables[0].length>0&&!n.J0.IsEmpty(e.Tables[0][0].WorkFlowID)&&parseInt(e.Tables[0][0].WorkFlowID.toString())>0&&(this.objBOM.WID=parseInt(e.Tables[0][0].WorkFlowID.toString()),this.btnHistoryVisible=!0,("1002"==this.MStatus.SelectedValue||"1001"==this.MStatus.SelectedValue||"1003"==this.MStatus.SelectedValue)&&(this.MStatus.IsReadOnly=!0),e.Tables.length>11&&e.Columns[11].Contains("WorkFlowLevel"))){""!=e.Tables[10][0].canEdit.toString()&&(0,u.yG0)(e.Tables[10][0].canEdit.toString())&&(this.ButtonSave.Enable=!0),""!=e.Tables[10][0].canApprove.toString()&&(0,u.yG0)(e.Tables[10][0].canApprove.toString())&&(this.BtnApprove.Visible=!0,this.ButtonSave.Enable=!1);let i,s,r=0;i=e.Tables[12],s=e.Tables[11],""!=e.Tables[0][0].WorkFlowLevel.toString()&&(r=parseInt(e.Tables[0][0].WorkFlowLevel.toString())),this.ScreenObject.GetWorkFlowLevels(r,s,i)}this.RefreshBOMTree()}GetParent(t,e){let i=t.find(s=>s.StageID==e);return null!=i&&null!=i?i:(t.forEach(s=>s.Childrens.length>0?this.GetParent(s.Childrens,e):[]),null)}get AttachmentVisibility(){return this._AttachmentVisibility}set AttachmentVisibility(t){t!=this._AttachmentVisibility&&(this._AttachmentVisibility=t,this._AttachmentVisibility&&(this._MoveSelectedBomStageVisibility=!1))}OnShowAttachment(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering OnShowAttachment"),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting OnShowAttachment")}OnAddAttachment(){Logger.InfoLog("AddEditAccountScreenViewModel::Entering AddAttachment"),this.Attachment=new F.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),Logger.InfoLog("AddEditAccountScreenViewModel::Exiting AddAttachment")}OnSaveBOM(t){if("AddStage"==t){let e=1,i=null;null!=this.BOMTreeControl.Tree.SelectedNode&&null!=this.BOMTreeControl.Tree.SelectedNode.Tag?(e=this.BOMTreeControl.Tree.SelectedNode.Parent.Id,1!=e&&(i=this.BOMTreeControl.Tree.SelectedNode.Parent.Tag)):null!=this.BOMTreeControl.Tree.SelectedNode&&null!=this.BOMTreeControl.Tree.SelectedNode.Parent&&null!=this.BOMTreeControl.Tree.SelectedNode.Parent.Tag&&(e=this.BOMTreeControl.Tree.SelectedNode.Parent.Id,i=this.BOMTreeControl.Tree.SelectedNode.Parent.Tag);let s=new H(--this.iCntBOM,e,i,this);s.CancelVisible=!0,l.d.page.ShowDialog(s,Q.Y,{HideClose:!1,HideHeader:!0,ShowCenter:!0})}else if("EditStage"==t)null!=this.BOMTreeControl.Tree.SelectedNode&&null!=this.BOMTreeControl.Tree.SelectedNode.Tag?(this.BOMTreeControl.Tree.SelectedNode.Tag.CancelVisible=!1,l.d.page.ShowDialog(this.BOMTreeControl.Tree.SelectedNode.Tag,Q.Y,{HideClose:!1,HideHeader:!0,ShowCenter:!0})):this.DisplayMessage="Please Select Stage";else if("DeleteStage"==t)if(this.DisplayMessage="",null!=this.BOMTreeControl.Tree.SelectedNode&&null!=this.BOMTreeControl.Tree.SelectedNode.Tag){let e=this.BOMTreeControl.Tree.SelectedNode.Tag;null!=e.Parent?e.Parent.Childrens.Remove(e):this.BOMNodes.Remove(e),this.RefreshBOMTree()}else this.DisplayMessage="Please Select Stage";else if("Save"==t||"SaveAs"==t)try{let i,e=this._ScreenObject.ValidateData();if(!n.J0.IsEmpty(e))return this.DisplayMessage=e,void(this.MessageVisibility=!0);if(!n.J0.IsEmpty(e))return this.DisplayMessage=e,void(this.MessageVisibility=!0);if(!this.ScreenObject.ValidateDataonSave())return;this.objBOM.BOMID=null!=t&&"SaveAs"==t.toString()?0:this.BID,this.objBOM.Code=this.txtCode.Text,this.objBOM.Name=this.txtName.Text,this.objBOM.Date=this.Date.Date,this.objBOM.ProductID=this.Product.SelectedValue,this.objBOM.Packing=n.J0.IsEmpty(this.Packing.Text)?"":this.Packing.Text,this.objBOM.UOMID=n.J0.IsEmpty(this.UOM.SelectedValue)?0:parseInt(this.UOM.SelectedValue),this.objBOM.FPQty=n.J0.Double(this.FPQty.Text),this.objBOM.FPQty<=0&&(this.objBOM.FPQty=1),this.objBOM.LocationID=this.Location.SelectedValue,this.objBOM.DivisionID=this.Division.SelectedValue,this.objBOM.group=!1,this.objBOM.selectednodeid=parseInt(this.Group.SelectedValue),this.objBOM.Desc=this.txtDesc.Text,this.objBOM.StatusID=parseInt(this.MStatus.SelectedValue);let s="";s+="<Stages>";let r=1,a=new Array;this.BOMTreeControl.Tree.AllNodes.forEach(d=>{if(null!=d.Tag){let c=d.Tag;"SaveAs"==t.toString()&&(c.StageID=--this.iCntBOM),s+='<Stage ID="'+c.StageID,s+='" StageNodeID="'+c.Stage.SelectedValue,n.J0.IsEmpty(c.txtDuration.Text)||""!=c.txtDuration.ValidateData()?s+='" Duration="0':s+='" Duration="'+c.txtDuration.Text,s+='" Parent="'+d.Parent.Id,s+='" lft="'+r,s+='" Depth="'+d.LevelNo+'" />',a.push(c),r++}}),s+="</Stages>",this.objBOM.StageXML=s.toString(),this.objBOM.BOMProductXML=this.BOMProductXML(a,t),this.objBOM.BOMExpenseXML=this.BOMExpenseXML(a,t),this.objBOM.BOMResourceXML=this.BOMResourceXML(a,t),this.objBOM.CustomFieldsQuery=this._ScreenObject.GetCustomFieldsQuery(),this.objBOM.CustomCCQuery=this._ScreenObject.GetCustomCostCenterFieldsQuery(),this.objBOM.AttachmetsXML=this.ViewAttachments.GetXML(),this.objBOM.WID=464==this.objBOM.StatusID?0:this.ScreenObject.CheckWorkFlow(),l.d.inventory.AddMultiStageBOM(this.objBOM,"AddMultiStageBOM").subscribe(d=>{this.DisplayMessage=d.Message,this.MessageVisibility=!0,i=d.RetValue,i>0&&(this.BID=i,this.objBOM.BOMID=i)},d=>{console.log(" BOM Save : "+JSON.stringify(d))})}catch(e){Logger.ErrorLog("MultiBOMTreeViewModel:: OnSAVE"+e.stack)}else if("Clone"==t.toString())this.IsClone=!0,this.OnLoad(this.BID),this.BID=0,this.Title=l.d.GetResource("BOM_AddBOM"),this.AutoGenerateCode();else if("ShowApprove"!=t.toString())if("ApproveMaster"==t.toString()){this.AttachmentVisibility=!1;let e=new v.i(76,this.BID,this.ScreenObject,this);l.d.page.ShowDialog(e,_.R,{ShowCenter:!0,Title:l.d.GetResource("ApproveReject")})}else"ViewHistory"==t.toString()&&l.d.page.ShowDialog(new K.DocumentDraftsViewModel(this,3),W.DocumentDraftsComponent)}BOMProductXML(t,e){Logger.InfoLog("MultiBOMAddEditViewModel::Entering MachineXML ");let i="";return i+="<BOMProductXML>",t.forEach(s=>{for(let r=0;r<s.InputGrid.Table.length;r++)n.J0.IsEmpty(s.InputGrid.Table[r].ProductName_Key)||(i+="<Row ",null!=e&&(null==e||"SaveAs"==e.toString())||n.J0.IsEmpty(s.InputGrid.Table[r].BOMProductID)?i+=" BOMProductID='0'":i+=" BOMProductID='"+s.InputGrid.Table[r].BOMProductID.toString()+"'",i+=' StageID="'+s.StageID+'"',i+=" ProductID='"+s.InputGrid.Table[r].ProductName_Key+"'",i+=" Quantity='"+n.J0.String(s.InputGrid.Table[r].Qty)+"'",i+=" UOMID='"+n.J0.String(s.InputGrid.Table[r].UOM_Key)+"'",i+=" UnitPrice='"+n.J0.String(s.InputGrid.Table[r].UnitPrice)+"'",s.InputGrid.TableColumns.Contains("FilterOn_Key")&&!n.J0.IsEmpty(s.InputGrid.Table[r].FilterOn_Key)&&(i+=" FilterOn='"+s.InputGrid.Table[r].FilterOn_Key.toString()+"'"),i+=" ProductUse='1'",i+=" Wastage='"+n.J0.String(s.InputGrid.Table[r].Wastage)+"'",i+=" IncInStageCost='"+n.J0.String(s.InputGrid.Table[r].IncludeinStage)+"'",i+=" IncInFinalCost='"+n.J0.String(s.InputGrid.Table[r].IncludeinFinal)+"'",n.J0.IsEmpty(s.InputGrid.Table[r].Stage_Key)||(i+=" AutoStage='"+s.InputGrid.Table[r].Stage_Key+"'"),i+=" Value='"+n.J0.String(s.InputGrid.Table[r].Value)+"'",i+=" Remarks='"+n.J0.String(s.InputGrid.Table[r].Remarks).Replace("&","&am;").Replace("<","&lt;").Replace(">","&gt;").Replace('"',"&quot;")+"'/>");for(let r=0;r<s.OutputGrid.Table.length;r++)n.J0.IsEmpty(s.OutputGrid.Table[r].ProductName_Key)||(i+="<Row ",null!=e&&(null==e||"SaveAs"==e.toString())||n.J0.IsEmpty(s.OutputGrid.Table[r].BOMProductID)?i+=" BOMProductID='0'":i+=" BOMProductID='"+s.OutputGrid.Table[r].BOMProductID.toString()+"'",i+=' StageID="'+s.StageID+'"',i+=" ProductID='"+s.OutputGrid.Table[r].ProductName_Key+"'",i+=" Quantity='"+n.J0.String(s.OutputGrid.Table[r].Qty)+"'",i+=" UnitPrice='"+n.J0.String(s.OutputGrid.Table[r].UnitPrice)+"'",i+=" UOMID='"+n.J0.String(s.OutputGrid.Table[r].UOM_Key)+"'",i+=" ProductUse='2'",i+=" Value='"+n.J0.String(s.OutputGrid.Table[r].Value)+"'/>")}),i+="</BOMProductXML>",Logger.InfoLog("MultiBOMAddEditViewModel::Exiting MachineXML"),i.toString()}BOMExpenseXML(t,e){let i="";return i+="<BOMExpenseXML>",t.forEach(s=>{for(let r=0;r<s.ExpenseGrid.Table.length;r++)n.J0.IsEmpty(s.ExpenseGrid.Table[r].AccountName_Key)||(i+="<Row ",null!=e&&(null==e||"SaveAs"==e.toString())||n.J0.IsEmpty(s.ExpenseGrid.Table[r].ExpenseID)?i+=" ExpenseID='0'":i+=" ExpenseID='"+s.ExpenseGrid.Table[r].ExpenseID.toString()+"'",i+=' StageID="'+s.StageID+'"',i+=" Name='"+n.J0.String(s.ExpenseGrid.Table[r].Name)+"'",i+=" ResourceID='1'",i+=" CreditAccountID='"+s.ExpenseGrid.Table[r].AccountName_Key+"'",n.J0.IsEmpty(s.ExpenseGrid.Table[r].Expense_Key)||(i+=" DebitAccountID='"+s.ExpenseGrid.Table[r].Expense_Key+"'"),i+=" IncInStageCost='"+n.J0.String(s.ExpenseGrid.Table[r].IncludeinStage)+"'",i+=" IncInFinalCost='"+n.J0.String(s.ExpenseGrid.Table[r].IncludeinFinal)+"'",i+=" Value='"+n.J0.String(s.ExpenseGrid.Table[r].Value)+"'/>")}),i+="</BOMExpenseXML>",i.toString()}BOMResourceXML(t,e){let i="";return i+="<BOMResourceXML>",t.forEach(s=>{for(let r=0;r<s.ResourcesGrid.Table.length;r++)n.J0.IsEmpty(s.ResourcesGrid.Table[r].Machine_Key)||(i+="<Row ",null!=e&&(null==e||"SaveAs"==e.toString())||n.J0.IsEmpty(s.ResourcesGrid.Table[r].BOMResourceID)?i+=" BOMResourceID='0'":i+=" BOMResourceID='"+s.ResourcesGrid.Table[r].BOMResourceID.toString()+"'",i+=' StageID="'+s.StageID+'"',i+=" ResourceID='"+s.ResourcesGrid.Table[r].Machine_Key+"'",s.ResourcesGrid.TableColumns.Contains("MachineDim1_Key")&&!n.J0.IsEmpty(s.ResourcesGrid.Table[r].MachineDim1_Key)&&(i+=" MachineDim1='"+s.ResourcesGrid.Table[r].MachineDim1_Key+"'"),s.ResourcesGrid.TableColumns.Contains("MachineDim2_Key")&&!n.J0.IsEmpty(s.ResourcesGrid.Table[r].MachineDim2_Key)&&(i+=" MachineDim2='"+s.ResourcesGrid.Table[r].MachineDim2_Key+"'"),s.ResourcesGrid.TableColumns.Contains("Options")&&!n.J0.IsEmpty(s.ResourcesGrid.Table[r].Options)&&(i+=" Options='"+s.ResourcesGrid.Table[r].Options+"'"),n.J0.IsEmpty(s.ResourcesGrid.Table[r].Hrs)?i+=" Hours='1' ":i+=" Hours='"+s.ResourcesGrid.Table[r].Hrs.toString()+"'",i+=" IncInStageCost='"+n.J0.String(s.ResourcesGrid.Table[r].IncludeinStage)+"'",i+=" IncInFinalCost='"+n.J0.String(s.ResourcesGrid.Table[r].IncludeinFinal)+"'",i+=" Value='"+n.J0.String(s.ResourcesGrid.Table[r].Value)+"'/>")}),i+="</BOMResourceXML>",i.toString()}DeleteNode(t){t.Children.forEach(e=>{this.DeleteNode(e)}),this.BOMTreeControl.Tree.Rows.Remove(t),this.BOMTreeControl.Tree.AllNodes.Remove(t),this.BOMTreeControl.Tree.Root.Children[0].Children.Contains(t)&&this.BOMTreeControl.Tree.Root.Children[0].Children.Remove(t)}OnProductChange(t){if(this.UOM.Length!=this.Product.SelectedValue.toString()&&(this.UOM.Items.Clear(),this.UOM.Length=this.Product.SelectedValue.toString(),this.UOM.SelectedValue=null,this.Product.SelectedValue>0)){let e=this.objBOM.GetProductUnits(this.Product.SelectedValue);null!=e&&e.Tables.length>0&&e.Tables[0].length>0&&(e.Tables[0].forEach(i=>{this.UOM.Items.push(g._p.ComboBoxItems_2(i.UnitName.toString(),i.UOMID.toString()))}),e.Columns[0].Contains("DefaultUOM")&&(this.UOM.SelectedValue=n.J0.String(e.Tables[0][0].DefaultUOM))),null!=e&&e.Tables.length>1&&e.Columns[1].Contains("Packing")&&e.Tables[1].length>0&&(this.Packing.Text=n.J0.String(e.Tables[1][0].Packing))}}OnAddEditSatge(t){let s,i=this.BOMTreeControl.Tree.SelectedNode,r=0,d=null,c=null;if(null!=i&&i.Tag==t){for(;i.Children.length>0&&null==i.Children[0].Tag;)this.BOMTreeControl.Tree.Rows.Remove(i.Children[0]),this.BOMTreeControl.Tree.AllNodes.Remove(i.Children[0]),i.Children.Remove(i.Children[0]);s=i,s.Text.Clear(),s.Text.push(t.Code),s.Text.push(t.Name),s.CallPropertyChange()}else{if(s=new T.n,s.IsGroup=!0,s.LevelNo=1,s.Tree=this.BOMTreeControl.Tree,s.Children=(new T.n.NodeCollection).NodeCollection_1(s),s.Nodes=s.Children,s.Text.push(t.Code),s.Text.push(t.Name),s.IsExpandedOnce=!0,s.AssignIsExpanded(!0),s.CallPropertyChange(),null!=i&&null!=i.Tag){d=i,c=d.Parent,s.LevelNo=d.Level;let m=this.BOMTreeControl.Tree.Rows.indexOf(i);this.BOMTreeControl.Tree.Rows.Insert(m,s),m=this.BOMTreeControl.Tree.AllNodes.indexOf(i),this.BOMTreeControl.Tree.AllNodes.Insert(m-1,s),c.Children.Insert(c.Children.indexOf(d),s)}else if(null!=i&&null!=i.Parent&&null!=i.Parent.Tag){if(d=i.Parent,s.LevelNo=d.Level+1,null!=d.NextNode){let m=this.BOMTreeControl.Tree.Rows.indexOf(d.NextNode);this.BOMTreeControl.Tree.Rows.Insert(m,s),this.BOMTreeControl.Tree.AllNodes.Insert(m-1,s)}else this.BOMTreeControl.Tree.Rows.push(s),this.BOMTreeControl.Tree.AllNodes.push(s);d.Children.push(s)}else this.BOMTreeControl.Tree.Rows.push(s),this.BOMTreeControl.Tree.AllNodes.push(s),this.BOMTreeControl.Tree.Root.Children[0].Children.push(s);s.Tag=t}s.Id=t.StageID,s.id=t.StageID,r=this.BOMTreeControl.Tree.Rows.indexOf(s)}RefreshBOMTree(){for(let t=this.BOMTreeControl.Tree.Rows.length-1;t>0;t--)this.BOMTreeControl.Tree.Rows.RemoveAt(t);this.BOMTreeControl.Tree.AllNodes.Clear(),this.BOMTreeControl.Tree.Root.Children[0].Children.Clear(),this.BOMNodes.forEach(t=>{this.RecursuveAdd(t)})}RecursuveAdd(t){1!=t.parentid?(this.BOMTreeControl.Tree.SelectedNode=this.BOMTreeControl.Tree.AllNodes.find(e=>e.Id==t.parentid),null!=this.BOMTreeControl.Tree.SelectedNode&&this.BOMTreeControl.Tree.SelectedNode.Children.length>0&&(this.BOMTreeControl.Tree.SelectedNode=this.BOMTreeControl.Tree.SelectedNode.Children[0])):this.BOMTreeControl.Tree.SelectedNode=null,this.OnAddEditSatge(t),t.Childrens.forEach(e=>{this.RecursuveAdd(e)})}OnCustomizeExtraFields(t){}}var N=I(70373);class ie{static AddPage(t,e,i,s,r,a){let d=t.obj;if(76==d.CostCenterID)if(l.d.page.ShowLoading=!0,null==d.SelectedNode&&null==d.SelectedNode||1!=d.SelectedNode.TypeID||-999!=s)if(null==d.SelectedNode&&null==d.SelectedNode||2!=d.SelectedNode.TypeID){let p={obj:new q(s,r)};l.d.page.addNewTab({component:ee.J,params:p})}else{let p={obj:new R(s,r)};l.d.page.addNewTab({component:N.H,params:p})}else{let p={obj:new R(0,r)};l.d.page.addNewTab({component:N.H,params:p})}}static LoadPRDScreen(t,e){switch(t.FeatureActionID.toString()){case"6334":case"6327":case"6354":case"6388":case"6355":case"491":case"492":case"506":case"523":case"546":break;case"6389":return{component:$.TreeViewPageComponent,params:{ScreenName:t.ScreenName,FeatureActionID:t.FeatureActionID,CostCenterID:t.FeatureID,Call:"C3"},basedon:"CostCenterID"}}return{}}static LoadDimension(t,e){return(0,Y.A)(function*(){if(76==t){let i=new R(e,0);l.d.page.addNewTab({title:i.ScreenName,component:N.H,params:{obj:i}})}})()}}}}]);