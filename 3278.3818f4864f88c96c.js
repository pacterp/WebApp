"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[3278],{60897:(Te,M,r)=>{r.r(M),r.d(M,{RibbonExtCrm:()=>ge});var n=r(9659),i=r(41360),g=r(73955),T=r(32881),I=r(89417),y=r(45319);function K(c,t){if(1&c&&(i.j41(0,"div",9),i.EFF(1,"\n          "),i.eu8(2,10),i.EFF(3,"\n        "),i.k0s()),2&c){const e=i.XpG().$implicit,s=i.XpG();i.R7$(2),i.Y8G("obj",e)("group",s.obj.ScreenObject.form)}}function Y(c,t){if(1&c&&(i.qex(0),i.EFF(1,"\n        "),i.DNE(2,K,4,2,"div",8),i.EFF(3,"\n      "),i.bVm()),2&c){const e=t.$implicit;i.R7$(2),i.Y8G("ngIf",e.Visible)}}function Z(c,t){if(1&c){const e=i.RV6();i.j41(0,"button",11),i.bIt("click",function(){i.eBV(e);const o=i.XpG();return i.Njj(o.obj.OnSaveCustomer("Details"))}),i.EFF(1),i.nI1(2,"translate"),i.k0s()}2&c&&(i.R7$(),i.JRh(i.bMT(2,1,"QuidAdd_Details")))}function z(c,t){if(1&c){const e=i.RV6();i.j41(0,"button",12),i.bIt("click",function(){i.eBV(e);const o=i.XpG();return i.Njj(o.obj.OnSaveCustomer("ApproveMaster"))}),i.nrm(1,"i",5),i.EFF(2),i.nI1(3,"translate"),i.k0s()}2&c&&(i.R7$(2),i.JRh(i.bMT(3,1,"Approve")))}let x=(()=>{class c{constructor(e){this.translate=e}ngOnInit(){}static{this.\u0275fac=function(s){return new(s||c)(i.rXU(g.c$))}}static{this.\u0275cmp=i.VBU({type:c,selectors:[["app-quick-add-customer"]],standalone:!1,decls:22,vars:7,consts:[[1,"master-screen",3,"formGroup"],[1,"PACTHeaderFields","dialogSubBody"],[4,"ngFor","ngForOf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"fa-light","fa-floppy-disk"],["class","secondary-btn-wicon",3,"click",4,"ngIf"],["class","secondary-btn",3,"click",4,"ngIf"],["class","form-group col PACTControl",4,"ngIf"],[1,"form-group","col","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"secondary-btn-wicon",3,"click"],[1,"secondary-btn",3,"click"]],template:function(s,o){1&s&&(i.j41(0,"div",0),i.EFF(1,"\n    "),i.j41(2,"div",1),i.EFF(3,"\n      "),i.DNE(4,Y,4,1,"ng-container",2),i.EFF(5,"\n  "),i.k0s(),i.EFF(6,"\n\n  "),i.j41(7,"div",3),i.EFF(8,"\n    "),i.j41(9,"div"),i.EFF(10,"\n        "),i.j41(11,"button",4),i.bIt("click",function(){return o.obj.OnSaveCustomer("Save")}),i.nrm(12,"i",5),i.EFF(13),i.nI1(14,"translate"),i.k0s(),i.EFF(15,"\n        "),i.DNE(16,Z,3,3,"button",6),i.EFF(17,"\n        "),i.DNE(18,z,4,3,"button",7),i.EFF(19,"\n    "),i.k0s(),i.EFF(20,"      \n  "),i.k0s(),i.EFF(21,"\n"),i.k0s()),2&s&&(i.Y8G("formGroup",o.obj.ScreenObject.form),i.R7$(4),i.Y8G("ngForOf",o.obj.ScreenObject.QuickAddFields),i.R7$(9),i.JRh(i.bMT(14,5,"Save")),i.R7$(3),i.Y8G("ngIf",o.obj.DetailButtonVisibility),i.R7$(2),i.Y8G("ngIf",o.obj.ScreenObject.ButtonApproveVisible))},dependencies:[T.Sq,T.bT,I.cb,I.j4,y._,g.D9],encapsulation:2})}}return c})();var W=r(74523),D=r(66148),p=r(76962),V=r(76199),j=r(92014),f=r(6532),b=r(1077),C=r(5349),S=r(4884),q=r(75961),G=r(80223),E=r(23073),A=r(90673),w=r(35235),R=r(19439);class k extends V.g{get CustomerID(){return this.obj.CustomerID}set CustomerID(t){this.obj.CustomerID=t}constructor(t,e,s,o,u){super(),this.Height=700,this.obj=new q.C,this.ScreenObject=new j.ControlGenerator,this.ParentId=0,this.CustomerCode=null,this.CustomerName=null,this.Status=null,this.Group=null,this.QuickAddVisibility=!1,this.DetailButtonVisibility=!0,this.RetVal=0,this.Load(t,e,s,e>0&&1==o||o,u)}Load(t,e,s,o,u){this.Parent=u,this.CustomerID=t,this.obj.CustomerID=this.CustomerID,this.ScreenObject.LoadQuickScreen(this,83,o),this.CustomerCode=this.ScreenObject.GetQuickCode(24200),this.CustomerName=this.ScreenObject.GetQuickText(24201),this.Status=this.ScreenObject.GetQuickCombo(24204),this.ParentId=s,this.obj.ParentID=s,this.obj.IsGroup=o,null!=this.Status&&(this.ScreenObject.Data.Tables[3].forEach(l=>{this.Status.Items.push(C._p.ComboBoxItems_2(l.Status.toString(),l.StatusID.toString()))}),this.Status.SelectedValue="393"),this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[6],this.obj.IsGroup),this.obj.CustomerID>0&&0==o?(this.LoadEditData(),null!=this.Group&&(this.Group.Enable=!1,this.Group.CCID=83,this.Group.TypeID=2)):(this.obj.GUID="",null!=this.Group&&(this.Group.CCID=83,this.Group.TypeID=2)),this.DisplayName=this.ScreenName,this.obj.SelectedNodeID=e,this.obj.IsGroup=o,0==this.CustomerID&&this.AutoGenerateCode();let a,h=this.ScreenObject.Data.Tables[5].filter(l=>"CapsLock"==l.Name);if(h.length>0&&(0,p.yG0)(h[0].Value)&&null!=this.CustomerName&&(this.CustomerName.IsAllCaps=!0),h=this.ScreenObject.Data.Tables[5].filter(l=>"CapsToFirstLetter"==l.Name),h.length>0&&(0,p.yG0)(h[0].Value)&&null!=this.CustomerName&&(this.CustomerName.IsFirstLetterCaps=!0),o?(this.DetailButtonVisibility=!1,this.CustomerID>0?(this.LoadEditData(),this.Title=n.d.GetResource("Customer_EditGroup")):this.Title=n.d.GetResource("Customer_AddGroup")):this.Title=n.d.GetResource(this.CustomerID>0?"Customer_EditCustomer":"Customer_AddCustomer"),this.QuickAddVisibility=!0,this.DisplayName=this.Title,null!=this.Group&&(this.Group.SelectedValue=s),null!=this.ScreenObject.HeaderFields)for(let l=0;l<this.ScreenObject.StaticFields.length;l++)a=this.ScreenObject.StaticFields[l],a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip?this.SetControlEvent(a):this.CustomerID>0&&a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&19==a.Mode&&this.OnGetExtFunctionData(a);if(null!=this.ScreenObject.HeaderFields)for(let l=0;l<this.ScreenObject.HeaderFields.length;l++)a=this.ScreenObject.HeaderFields[l],a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip?this.SetControlEvent(a):this.CustomerID>0&&a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&19==a.Mode&&this.OnGetExtFunctionData(a);Logger.InfoLog("QuickAddCustomersViewModel::Exiting QuickAddCustomersViewModel")}SetControlEvent(t){try{t instanceof f.Dw?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof C.y$?t.SelectionChangedCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof A.I||t instanceof f.L6?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof b.y$?t.OnPactListBoxValueChanged.Subscribe(this,"OnGetExtFunctionData"):(t instanceof S.Lc||t instanceof S.P6||t instanceof S.C_)&&t.SelectedDateChanged.Subscribe(this,"OnGetExtFunctionData"),this.CustomerID>0&&19==t.Mode&&this.OnGetExtFunctionData(t)}catch{}}OnGetExtFunctionData(t){null!=t.ToolTipFooterTitle&&!D.J0.IsEmpty(t.KeyTip)&&"lostfocus"==t.KeyTip.toLowerCase()&&this.ScreenObject.ValidateExtData(t,null,!0)&&this.ScreenObject.GetExternalFuncData(t.Mode,this.CustomerID,t.ToolTipFooterTitle,t.ToolTipFooterDescription,t.ToolTipDescription,null,null)}AutoGenerateCode(){0==this.CustomerID&&null!=this.CustomerCode&&this.ScreenObject.SetAutoCode(this.CustomerCode,this.obj.IsGroup,this.ParentId,this.ScreenObject.Data.Tables[6])}LoadEditData(){Logger.InfoLog("QuickAddCustomersViewModel::Entering LoadEditData");let t=this.obj.GetCustomerDetails();null!=this.CustomerCode&&(this.CustomerCode.Text=this.obj.CustomerCode,(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.CustomerCode.Enable=!1));let e=null;t.Tables[7].length>0&&(e=t.Tables[7][0]),this.ScreenObject.FillControls(t.Tables[0][0],t.Tables[1][0],e,null),null!=this.Group&&(this.Group.SelectedValue=parseInt(t.Tables[0][0].ParentID)),Logger.InfoLog("QuickAddCustomersViewModel::Exiting LoadEditData")}OnSaveCustomer(t){var e=this;return(0,W.A)(function*(){if("Cancel"==t.toString())null!=e.Parent?(e.Parent.QuickAddCustomersVisibility=!1,e.Parent.SetDetailsVisibile(),e.QuickAddVisibility=!1,e.Parent.DetailsVisibility=!0):n.d.page.HideDialog(e.PopUpGUID);else if("ApproveMaster"==t.toString()){let s=new w.i(83,e.obj.CustomerID,e.ScreenObject,e);n.d.page.ShowDialog(s,R.R,{ShowCenter:!0,Title:n.d.GetResource("ApproveReject")})}else if(Logger.InfoLog("QuickAddCustomersViewModel::Entering OnSaveCustomer"),"Details"==t.toString()){n.d.page.HideDialog(e.PopUpGUID);let s=new G.I(e.obj.CustomerID,e.obj.SelectedNodeID,e.obj.ParentID,e.obj.IsGroup);n.d.page.addNewTab({component:E.AddCustomerComponent,params:{obj:s}})}else try{let s=e.ScreenObject.ValidateData();if(!D.J0.IsEmpty(s))return e.DisplayMessage=s,void(e.MessageVisibility=!0);if(0==e.obj.CustomerID){if(null!=e.CustomerCode){let u={StrCode:e.obj.CustomerCode,CodePrefix:e.obj.CodePrefix,CodeNumber:e.obj.CodeNumber};if(e.DisplayMessage=e.ScreenObject.SetAutoCodeParams_3(e.CustomerCode,e.ParentId,e.ScreenObject.Data.Tables[6],u),e.obj.CustomerCode=u.StrCode,e.obj.CodePrefix=u.CodePrefix,e.obj.CodeNumber=u.CodeNumber,e.DisplayMessage.length>0)return}else e.obj.CustomerCode=null!=e.CustomerCode?e.CustomerCode.Text:"";if(null!=e.CustomerName&&null!=e.CustomerName.Text&&""!=e.CustomerName.Text.Trim()&&(e.obj.CustomerName=e.CustomerName.Text),null==e.obj.AliasName&&(e.obj.AliasName=""),e.obj.SelectedNodeID=null!=e.Group&&e.Group.SelectedValue>0?e.Group.SelectedValue:e.ParentId,null!=e.Status&&e.Status.Enable&&null!=e.Status.SelectedValue&&""!=e.Status.SelectedValue&&(e.obj.StatusID=parseInt(e.Status.SelectedValue)),0==e.CustomerID&&(e.obj.AliasName=e.obj.CustomerName),e.obj.ContactsXML="",e.obj.NotesXML="",e.obj.AttachmetsXML="",e.obj.AddressXML="",e.obj.CustomFieldsQuery=e.ScreenObject.GetQuickExtraFieldsQuery(),e.obj.CustomCostCenterFieldsQuery=e.ScreenObject.GetQuickExtraCCFieldsQuery(),e.obj.PrimaryContactQuery="",!e.ScreenObject.ValidateDataonSave())return;let o=e.obj.SaveCustomer();e.DisplayMessage=o.Message,e.RetVal=o.RetValue}else{e.obj.StatusID=e.ScreenObject.GetTextComboValue_int(24204,0);let o=e.ScreenObject.GetStaticFieldsQuery();if(e.obj.StaticFieldsQuery=o,e.obj.CustomFieldsQuery=e.ScreenObject.GetQuickExtraFieldsQuery(),e.obj.CustomCostCenterFieldsQuery=e.ScreenObject.GetQuickExtraCCFieldsQuery(),!e.ScreenObject.ValidateDataonSave())return;let u=e.obj.SaveCustomerQuick();e.DisplayMessage=u.Message,e.RetVal=u.RetValue}e.MessageVisibility=!0,e.RetVal>0&&(e.AutoGenerateCode(),null!=e.CustomerName&&(e.CustomerName.Text=""),null!=e.Group&&(e.Group.SelectedValue=e.ParentId),null!=e.Parent&&(null!=e.Parent.SelectedNode&&(e.Parent.tree[0].SetFocusNodeID=e.Parent.SelectedNode.Id),e.Parent.Refresh()),e.ScreenObject.Clear(),null!=e.CustomerCode&&(e.CustomerCode.Text=""),Logger.InfoLog("QuickAddCustomersViewModel::Exiting OnSaveCustomer"))}catch(s){Logger.ErrorLog("QuickAddCustomersViewModel:: OnSaveCustomer"+s.stack)}})()}GetCustomFieldsQuery(){let t,e="";return this.ScreenObject.CustomFields.forEach(s=>{(s instanceof f.Dw||s instanceof C.y$||s instanceof S.Lc)&&(t=null,e+=s.DBColumnName+"='null',")}),e.toString()}GetCustomCostCenterFieldsQuery(){let t,e="";return this.ScreenObject.CustomFields.forEach(s=>{s instanceof b.y$&&(t=null,e+=s.DBColumnName+"='null',")}),e}}var _=r(81322),B=r(11311),Q=r(53724),N=r(79352),P=r(30055),X=r(64351);class m extends V.g{constructor(t,e,s,o,u){super(),this.LED=new X.k,this.ScreenObject=new j.ControlGenerator,this.parentid=1,this.selectedNode=0,this.group=!1,this.Company=null,this.Subject=null,this.Code=new f.s3(24198),this.Status=null,this.Mode=null,this.Group=null,this.Ret=0,this.RetValue=0,this.lstEventCtrls=[],this.CostCenterID=0,this.NodeID=0,this.ActVisibility=!1,this.ClassName="QuickAddLeads",this.parent=t,this.NodeID=e,this.parentid=s,this.selectedNode=u,this.CostCenterID=86,this.group=o,this.ButtonSave=new _.v,this.ScreenObject.LoadQuickScreen(this,86,o),o?this.ActVisibility=!1:m.SetActivityUI(this,this.ScreenObject.dtActivityQuick),this.LED.LeadID=this.NodeID;let a,h=this.ScreenObject.GetQuickCode(24198);if(null!=h?this.Code=h:this.Code.Visible=!1,this.Company=this.ScreenObject.GetQuickText(24399),this.Status=this.ScreenObject.GetQuickCombo(24400),this.Mode=this.ScreenObject.GetQuickCombo(26637),this.Group=this.ScreenObject.GetQuickField(25905),this.Subject=this.ScreenObject.GetQuickText(25069),null!=this.Group&&(this.Group.Enable=!1,this.Group.CCID=86,this.Group.TypeID=2,this.Group.SelectedValue=s),null!=this.Status&&(this.ScreenObject.Data.Tables[3].forEach(l=>{this.Status.Items.push(C._p.ComboBoxItems_2(D.J0.String(l.Status),l.StatusID.toString()))}),this.Status.SelectedValue="415"),null!=this.Company){let l=this.ScreenObject.Data.Tables[4].filter(d=>"CapsLock"==d.Name);l.length>0&&(0,p.yG0)(l[0].Value)&&(this.Company.IsAllCaps=!0),l=this.ScreenObject.Data.Tables[4].filter(d=>"CapsToFirstLetter"==d.Name),l.length>0&&(0,p.yG0)(l[0].Value)&&(this.Company.IsFirstLetterCaps=!0)}this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[7],this.group),this.AutoGenerateCode(),0==this.NodeID?(this.Title=n.d.GetResource("CRMLead_AddLead"),this.LED.GUID="GUID"):(this.Title=n.d.GetResource("CRMLead_EditLead"),this.LoadEditData()),this.Title=0==this.group?n.d.GetResource(0==this.NodeID?"CRMLead_AddLead":"CRMLead_EditLead"):0==this.NodeID?n.d.GetResource("CRMLead_AddGroup"):"Edit Group",null!=this.Mode&&this.lstEventCtrls.push(this.Mode.DBColumnID),null!=this.Status&&this.lstEventCtrls.push(this.Status.DBColumnID);for(let l=0;l<this.ScreenObject.StaticFields.length;l++)a=this.ScreenObject.StaticFields[l],a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&!this.lstEventCtrls.Contains(a.DBColumnID)?this.SetControlEvent(a):this.NodeID>0&&a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&19==a.Mode&&this.OnGetExtFunctionData(a);if(null!=this.ScreenObject.HeaderFields)for(let l=0;l<this.ScreenObject.HeaderFields.length;l++)a=this.ScreenObject.HeaderFields[l],a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&!this.lstEventCtrls.Contains(a.DBColumnID)?this.SetControlEvent(a):this.NodeID>0&&a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&19==a.Mode&&this.OnGetExtFunctionData(a)}SetControlEvent(t){try{t instanceof f.Dw?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof C.y$?t.SelectionChangedCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof A.I||t instanceof f.L6?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof b.y$?t.OnPactListBoxValueChanged.Subscribe(this,"OnGetExtFunctionData"):(t instanceof S.Lc||t instanceof S.P6||t instanceof S.C_)&&t.SelectedDateChanged.Subscribe(this,"OnGetExtFunctionData"),this.NodeID>0&&19==t.Mode&&this.OnGetExtFunctionData(t)}catch{}}OnGetExtFunctionData(t){null!=t.ToolTipFooterTitle&&!D.J0.IsEmpty(t.KeyTip)&&"lostfocus"==t.KeyTip.toLowerCase()&&this.ScreenObject.ValidateExtData(t,null,!0)&&this.ScreenObject.GetExternalFuncData(t.Mode,this.NodeID,t.ToolTipFooterTitle,t.ToolTipFooterDescription,t.ToolTipDescription,null,null)}LoadEditData(){let t=this.LED.GetLead(this.NodeID);null!=t&&t.Tables.length>5&&t.Columns[5].Contains("ConvertFromLeadID")&&t.Tables[5].length>0&&parseInt(t.Tables[5][0][t.Columns[5][0]].toString())>0&&(this.ButtonSave.Enable=!1,this.DisplayMessage="Lead is converted to Opportunity cannot be edited"),null!=this.Code&&(this.Code.Text=t.Tables[0][0].Code.toString(),(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.Code.Enable=!1)),this.LED.GUID=t.Tables[0][0].GUID.toString(),this.LED.Company=t.Tables[0][0].Company.toString(),this.LED.Code=t.Tables[0][0].Code.toString();let e=null;t.Tables[11].length>0&&(e=t.Tables[11][0]);let s=null;t.Tables[3].length>0&&(s=t.Tables[3][0]),this.ScreenObject.FillControls(t.Tables[0][0],t.Tables[4][0],e,s),this.ScreenObject.LoadPrimaryContactData(t.Tables[3],t.Columns[3]),this.ActVisibility&&!this.group&&t.Tables.length>7&&(this.ViewActivities.LoadActivityData(t.Tables[8]),this.ViewActivities.ActivityGridData.length>0?(this.ViewActivities.SelectedRow=this.ViewActivities.ActivityGridData[this.ViewActivities.ActivityGridData.length-1],this.ViewActivities.OnCmnItem_Click("EDIT","EDIT")):this.ActVisibility=!1),null!=this.Group&&(this.Group.SelectedValue=parseInt(t.Tables[0][0].ParentID)),null!=this.Status&&(this.Status.SelectedValue=t.Tables[0][0].StatusID.toString()),Logger.InfoLog("QuickAddCustomersViewModel::Exiting LoadEditData")}AutoGenerateCode(){let t;0==this.NodeID&&null!=this.Code&&this.ScreenObject.SetAutoCode(this.Code,this.group,this.parentid,this.ScreenObject.Data.Tables[7]);var e=this.ScreenObject.StaticFields.find(s=>26637==s.DBColumnID);e&&e instanceof C.y$&&(e.Items.Clear(),t=this.ScreenObject.Data.Tables[4].filter(s=>"IncludeNewInMode"==s.Name),t.length>0&&""!=t[0].Value.toString()&&(0,p.yG0)(t[0].Value.toString())&&(e.Items.push(C._p.ComboBoxItems_2("New","0")),e.SelectedValue="0"),t=this.ScreenObject.Data.Tables[4].filter(s=>"LinkDimension"==s.Name),t.length>0&&""!=t[0].Value.toString()&&e.Items.push(C._p.ComboBoxItems_2("Existing lead","1")),t=this.ScreenObject.Data.Tables[4].filter(s=>"AccountLinkDimension"==s.Name),t.length>0&&""!=t[0].Value.toString()&&e.Items.push(C._p.ComboBoxItems_2("Account","2")),t=this.ScreenObject.Data.Tables[4].filter(s=>"CustomerInMode"==s.Name),t.length>0&&(0,p.yG0)(t[0].Value)&&e.Items.push(C._p.ComboBoxItems_2("Customer","3")))}OnSave(t){if("Cancel"==t)this.parent.DetailsVisibility=!0;else if("ApproveMaster"==t.toString()){let e=new w.i(86,this.LED.LeadID,this.ScreenObject,this);n.d.page.ShowDialog(e,R.R,{ShowCenter:!0,Title:n.d.GetResource("ApproveReject")})}else if("Save"==t)try{this.LED.LeadID=this.NodeID,this.LED.IsGroup=this.group;let e=this.ScreenObject.ValidateData();if(!D.J0.IsEmpty(e))return this.DisplayMessage=e,void(this.MessageVisibility=!0);if(0==this.LED.LeadID){if(0==this.LED.LeadID&&null!=this.Code){let o={StrCode:this.LED.Code,CodePrefix:this.LED.CodePrefix,CodeNumber:this.LED.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.parentid,this.ScreenObject.Data.Tables[7],o),this.LED.Code=o.StrCode,this.LED.CodePrefix=o.CodePrefix,this.LED.CodeNumber=o.CodeNumber,this.DisplayMessage.length>0)return}if(this.Company&&(this.LED.Company=this.Company.Text),this.Subject?this.LED.Name=this.Subject.Text:this.Code&&(this.LED.Name=this.Code.Text),this.LED.StatusID=this.Status?parseInt(this.Status.SelectedValue):415,this.LED.SelectedNodeID=this.Group&&this.Group.SelectedValue>0?this.Group.SelectedValue:this.parentid,this.LED.Date=this.ScreenObject.GetDatePickerValue(25068,Date.Today()),this.LED.CampaignID=this.ScreenObject.GetPactListValue(25073,1),this.LED.SourceID=this.ScreenObject.GetTextComboValue_int(25071,0),this.LED.RatingID=this.ScreenObject.GetTextComboValue_int(25072,0),this.LED.IndustryID=this.ScreenObject.GetTextComboValue_int(25074,0),this.LED.Contact=this.ScreenObject.GetTextComboValue_int(26651,0),this.LED.Details=this.details(),this.ActVisibility){if(this.Activities.onSaveActivity("Save"),!D.J0.IsEmpty(this.Activities.DisplayMessage))return void(this.DisplayMessage=this.Activities.DisplayMessage);this.LED.ActivityXML=this.ViewActivities.ActivitiesXML()}else this.LED.ActivityXML="";if(this.LED.ProductsXML="",this.LED.TabXML="",this.LED.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.LED.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.LED.NotesXML="",this.LED.FeedBackXML="",this.LED.CVRXML="",this.LED.AttachmentXML="",this.LED.ContactsXML="",this.LED.PrimaryContactXML=this.ScreenObject.GetPrimaryContact(),!this.ScreenObject.ValidateDataonSave())return;let s=this.LED.SaveLead();this.DisplayMessage=s.Message,this.Ret=s.RetValue}else{if(null!=this.Code&&(this.LED.Code=this.Code.Text),null!=this.Company&&(this.LED.Company=this.Company.Text),this.ActVisibility){if(this.Activities.onSaveActivity("Save"),!D.J0.IsEmpty(this.Activities.DisplayMessage))return void(this.DisplayMessage=this.Activities.DisplayMessage);this.LED.ActivityXML=this.ViewActivities.ActivitiesXML()}else this.LED.ActivityXML="";if(this.LED.StaticFieldsQuery=this.ScreenObject.GetStaticFieldsQuery(),this.LED.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.LED.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.LED.Details=this.details(),!this.ScreenObject.ValidateDataonSave())return;let s=this.LED.SaveLeadQuick();this.DisplayMessage=s.Message,this.Ret=s.RetValue}this.MessageVisibility=!0,this.RetValue=this.Ret,this.Ret>0&&(null!=this.Company&&(this.Company.Text=""),null!=this.Status&&(this.Status.SelectedValue="415"),null!=this.parent&&(null!=this.parent.SelectedNode&&(this.parent.obj.SetFocusNodeID=this.parent.SelectedNode.Id),this.parent.Refresh()),this.AutoGenerateCode(),null!=this.Activities&&this.Activities.ClearFields())}catch(e){Logger.ErrorLog("SaveLeadViewModel:: OnSave"+e.stack)}else{let e=new N.p(this.NodeID,this.parentid,this.group);this.ScreenObject.StaticFields.forEach(s=>{var o=e.ScreenObject.StaticFields.find(u=>u.DBColumnID==s.DBColumnID);o&&(o instanceof f.Dw?o.Text=s.Text:o instanceof b.gH?s instanceof f.Dw&&(o.Text=s.Text):o instanceof C.y$||o instanceof b.y$?o.SelectedValue=s.SelectedValue:o instanceof S.Lc?o.Date=s.Date:o instanceof f.s3&&s instanceof f.s3&&(o.Text=s.Text,o.SuffixCode=s.SuffixCode,o.PrefixCode=s.PrefixCode))}),n.d.page.addNewTab({component:P.AddEditLeadComponent,params:{obj:e}}),n.d.page.HideDialog(this.PopUpGUID)}}static GetValidXml(t){return(t=(t=(t=t.Replace("&","&amp;")).Replace("'","&apos;&apos;")).Replace('"',"&quot;")).Replace("<","&lt;")}details(){Logger.InfoLog("AddEditLeads::Entering details");try{let t="";return 0==this.NodeID?(t+="<Row ",this.ScreenObject.StaticFields.forEach(e=>{"CRM_CONTACTS"==e.SysTableName.toUpperCase()&&("FirstName"==e.DBColumnName&&""!=e.Text?t+=' FirstName="'+m.GetValidXml(e.Text)+'"':"MiddleName"==e.DBColumnName&&""!=e.Text?t+=' MiddleName="'+m.GetValidXml(e.Text)+'"':"LastName"==e.DBColumnName&&""!=e.Text?t+=' LastName="'+m.GetValidXml(e.Text)+'"':"JobTitle"==e.DBColumnName&&""!=e.Text?t+=' JobTitle="'+m.GetValidXml(e.Text)+'"':"Phone1"==e.DBColumnName&&""!=e.Text?t+=' Phone1="'+m.GetValidXml(e.Text)+'"':"Phone2"==e.DBColumnName&&""!=e.Text?t+=' Phone2="'+m.GetValidXml(e.Text)+'"':"Email"==e.DBColumnName&&""!=e.Text?t+=' Email="'+m.GetValidXml(e.Text)+'"':"Fax"==e.DBColumnName&&""!=e.Text?t+=' Fax="'+m.GetValidXml(e.Text)+'"':"Department"==e.DBColumnName&&""!=e.Text&&(t+=' Department="'+m.GetValidXml(e.Text)+'"'))}),t+="/>"):this.ScreenObject.StaticFields.forEach(e=>{"CRM_CONTACTS"==e.SysTableName.toUpperCase()&&"CRM_CONTACTS"==e.SysTableName.toUpperCase()&&("FirstName"==e.DBColumnName&&""!=e.Text?t+=" FirstName='"+m.GetValidXml(e.Text)+"'":"MiddleName"==e.DBColumnName&&""!=e.Text?t+=" MiddleName='"+m.GetValidXml(e.Text)+"'":"LastName"==e.DBColumnName&&""!=e.Text?t+=" LastName='"+m.GetValidXml(e.Text)+"'":"JobTitle"==e.DBColumnName&&""!=e.Text?t+=" JobTitle='"+m.GetValidXml(e.Text)+"'":"Phone1"==e.DBColumnName&&""!=e.Text?t+=" Phone1='"+m.GetValidXml(e.Text)+"'":"Phone2"==e.DBColumnName&&""!=e.Text?t+=" Phone2='"+m.GetValidXml(e.Text)+"'":"Email"==e.DBColumnName&&""!=e.Text?t+=" Email='"+m.GetValidXml(e.Text)+"'":"Fax"==e.DBColumnName&&""!=e.Text?t+=" Fax='"+m.GetValidXml(e.Text)+"'":"Department"==e.DBColumnName&&""!=e.Text&&(t+=" Department='"+m.GetValidXml(e.Text)+"'"))}),t.toString()}catch{return""}}static SetActivityUI(t,e){if(e.length>0){t.ActVisibility=!0,t.Activities=new Q.ActivitiesViewModel(t,!1),t.Activities.IsPopup=!1,t.Activities.LoadCustomFields(86),t.Activities.AssignVisiblity=!1,t.Activities.HeaderVisible=!1,t.Activities.ButtonsVisible=!1,t.ViewActivities=new B.ViewActivitiesViewModel(t),t.ViewActivities.Activities=t.Activities;let s=e.filter(o=>"ActivityTypeName"==o.SysColumnName);t.Activities.ActivityType.Visible=s.length>0,s=e.filter(o=>"StatusID"==o.SysColumnName),t.Activities.StatusVisible=s.length>0,s=e.filter(o=>"Subject"==o.SysColumnName),t.Activities.Subject.Visible=s.length>0,s=e.filter(o=>"CRMCustomer"==o.SysColumnName),t.Activities.CRMCustomer.Visible=s.length>0,s=e.filter(o=>"CRMContactPerson"==o.SysColumnName),t.Activities.CRMContactPerson.Visible=s.length>0,s=e.filter(o=>"AssignUserID"==o.SysColumnName),t.Activities.AssignUserList.Visible=s.length>0,s=e.filter(o=>"Remarks"==o.SysColumnName),t.Activities.Remarks.Visible=s.length>0,t.Activities.Fields.forEach(o=>{s=e.filter(u=>u.SysColumnName==o.SysColumnName),o.Visible=s.length>0})}else t.ActVisibility=!1}}function ee(c,t){if(1&c&&(i.j41(0,"div",9),i.EFF(1,"\n          "),i.eu8(2,10),i.EFF(3,"\n        "),i.k0s()),2&c){const e=i.XpG().$implicit,s=i.XpG();i.R7$(2),i.Y8G("obj",e)("group",s.obj.ScreenObject.form)}}function te(c,t){if(1&c&&(i.qex(0),i.EFF(1,"\n        "),i.DNE(2,ee,4,2,"div",8),i.EFF(3,"\n      "),i.bVm()),2&c){const e=t.$implicit;i.R7$(2),i.Y8G("ngIf",e.Visible)}}function ie(c,t){if(1&c){const e=i.RV6();i.j41(0,"button",11),i.bIt("click",function(){i.eBV(e);const o=i.XpG();return i.Njj(o.obj.OnSave("ApproveMaster"))}),i.nrm(1,"i",5),i.EFF(2),i.nI1(3,"translate"),i.k0s()}2&c&&(i.R7$(2),i.JRh(i.bMT(3,1,"Approve")))}let se=(()=>{class c{constructor(e){this.translate=e}ngOnInit(){}static{this.\u0275fac=function(s){return new(s||c)(i.rXU(g.c$))}}static{this.\u0275cmp=i.VBU({type:c,selectors:[["app-quick-add-lead"]],standalone:!1,decls:24,vars:9,consts:[[1,"master-screen",3,"formGroup"],[1,"PACTHeaderFields","dialogSubBody"],[4,"ngFor","ngForOf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"fa-light","fa-floppy-disk"],[1,"secondary-btn-wicon",3,"click"],["class","secondary-btn",3,"click",4,"ngIf"],["class","form-group col PACTControl",4,"ngIf"],[1,"form-group","col","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"secondary-btn",3,"click"]],template:function(s,o){1&s&&(i.j41(0,"div",0),i.EFF(1,"\n    "),i.j41(2,"div",1),i.EFF(3,"\n      "),i.DNE(4,te,4,1,"ng-container",2),i.EFF(5,"\n  "),i.k0s(),i.EFF(6,"\n\n  "),i.j41(7,"div",3),i.EFF(8,"\n    "),i.j41(9,"div"),i.EFF(10,"\n        "),i.j41(11,"button",4),i.bIt("click",function(){return o.obj.OnSave("Save")}),i.nrm(12,"i",5),i.EFF(13),i.nI1(14,"translate"),i.k0s(),i.EFF(15,"\n        "),i.j41(16,"button",6),i.bIt("click",function(){return o.obj.OnSave("Details")}),i.EFF(17),i.nI1(18,"translate"),i.k0s(),i.EFF(19,"\n        "),i.DNE(20,ie,4,3,"button",7),i.EFF(21,"\n    "),i.k0s(),i.EFF(22,"      \n  "),i.k0s(),i.EFF(23,"\n"),i.k0s()),2&s&&(i.Y8G("formGroup",o.obj.ScreenObject.form),i.R7$(4),i.Y8G("ngForOf",o.obj.ScreenObject.QuickAddFields),i.R7$(9),i.JRh(i.bMT(14,5,"Save")),i.R7$(4),i.JRh(i.bMT(18,7,"QuidAdd_Details")),i.R7$(3),i.Y8G("ngIf",o.obj.ScreenObject.ButtonApproveVisible))},dependencies:[T.Sq,T.bT,I.cb,I.j4,y._,g.D9],encapsulation:2})}}return c})();var $=r(93320),oe=r(15877),ae=r(1286),le=r(2599),F=r(95596),v=r(40909),ne=r(95439),re=r(74205),ce=r(72695),ue=r(77287),de=r(25823),he=r(9017),U=r(42312),Ce=r(54487),me=r(29089),J=r(43071),O=r(82721);class L extends V.g{constructor(t,e,s,o,u){super(),this.lstatusid="",this.AllowCreationofCase=!1,this.ActMandatory=!1,this.ScreenObject=new j.ControlGenerator,this.Casesmodel=new me.K,this.CaseID=0,this.parentid=1,this.selectedNode=1,this.group=!1,this.GroupVisible=!1,this.QuickVisible=!0,this.DetailButtonVisibility=!0,this.RetValue=0,this.CName=new f.s3(0),this.CaseDate=new S.Lc(0),this.Status=new C.y$(0),this.Customer=new b.y$(0),this.Group=new b.y$(0),this.dsinfo=null,this.lstEventCtrls=[],this.CostCenterID=0,this.NodeID=0,this.ActVisibility=!1,this.CaseID=e;let h=this.Casesmodel.GetCaseScreenDetails(this.CaseID);this.parent=t,this.parentid=s,this.selectedNode=u,this.CostCenterID=73,this.group=o,this.ScreenObject.LoadQuickScreen(this,73,this.group),o?(this.GroupVisible=!0,this.QuickVisible=!1,this.CName.Label=n.d.GetResource("CRMCases_CaseNumber"),this.CaseDate.Label=n.d.GetResource("CRMCases_CaseDate"),this.Status.Label=n.d.GetResource("CRMCases_Status"),this.Group.Label=n.d.GetResource("CRMCases_Group"),this.Customer.Label=n.d.GetResource("CRMCases_Customer")):(this.QuickVisible=!0,this.GroupVisible=!1,this.CaseDate=this.ScreenObject.GetQuickField(24233),null==this.CaseDate&&(this.CaseDate=new S.Lc(24233),this.CaseDate.Visible=!1,this.CaseDate.Date=Date.Today()),this.CName=this.ScreenObject.GetQuickCode(24234),this.Status=this.ScreenObject.GetQuickCombo(24235),null==this.Status&&(this.Status=new C.y$(24235),this.Status.Visible=!1),this.Customer=this.ScreenObject.GetQuickField(24238),null==this.Customer&&(this.Customer=new b.y$(24238),this.Customer.Visible=!1),this.Group=this.ScreenObject.GetQuickField(24398),null==this.Group&&(this.Group=new b.y$(24398)),this.FillComboBoxItems(h)),null!=this.Group?(this.Group.Visible=!0,this.Group.CCID=73,this.Group.TypeID=2):(this.Group=new b.y$(0),this.Group.SelectedValue=s),null!=this.Customer&&(this.Customer.CCID=83,this.Customer.TypeID=1),this.dsinfo=this.ScreenObject.Data,this.ScreenObject.Data=this.dsinfo,this.ScreenObject.CostCenterID=73,o?this.ActVisibility=!1:(L.SetActivityUI(this,this.ScreenObject.dtActivityQuick),null!=this.Activities&&this.Activities.AssignRowColumns()),0==this.group?this.Title=n.d.GetResource(0==this.CaseID?"CRMCase_AddCase":"CRMCase_EditCase"):(this.Title=n.d.GetResource("CRMLead_AddGroup"),this.DetailButtonVisibility=!1,this.Casesmodel.GUID="GUID"),this.Casesmodel.CaseID=this.CaseID,null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>7&&this.ScreenObject.Data.Columns[7].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[7].length>0&&this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[7],this.group);let l,a=this.ScreenObject.Data.Tables[4].filter(d=>"AllowCreationofCase"==d.Name);a.length>0&&""!=a[0].Value.toString()&&(this.AllowCreationofCase=(0,p.yG0)(a[0].Value)),this.AllowCreationofCase&&(a=this.ScreenObject.Data.Tables[4].filter(d=>"StatusDuplicateCreationofCases"==d.Name),a.length>0&&""!=a[0].Value.toString()&&(this.lstatusid=a[0].Value.toString())),a=this.ScreenObject.Data.Tables[4].filter(d=>"Activitymandatorywhilecreatingcase"==d.Name),a.length>0&&""!=a[0].Value.toString()&&(this.ActMandatory=(0,p.yG0)(a[0].Value)),null!=this.Status&&this.dsinfo.Tables[5].forEach(d=>{this.Status.Items.push(C._p.ComboBoxItems_2(d.Name.toString(),d.NodeID.toString())),(0,p.yG0)(d.IsDefault)&&(this.Status.SelectedValue=d.NodeID.toString(),this.Status.DefaultValue=d.NodeID.toString())}),null!=this.Group&&this.Group.SelectionChangedCommand.Subscribe(this,"OnGroupSelectionChanged"),0==this.CaseID?(this.Group.SelectedValue=s,this.AutoGenerateCode(),this.Casesmodel.GUID="GUID",n.d.SessionManager.Preferences.ContainsKey("Date Format")&&(this.CaseDate.Text=(new Date).ToString(n.d.SessionManager.Preferences["Date Format"].toString()))):(h.Tables.length>4&&h.Tables[4].length>0&&((this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.CName.Enable=!1),this.Casesmodel.GUID=h.Tables[4][0].GUID.toString(),this.CaseDate.Date=D.J0.ParseDate(h.Tables[4][0].CDAte.toString()),this.CName.Text=h.Tables[4][0].CaseNumber.toString(),this.Status.SelectedValue=h.Tables[4][0].StatusID.toString(),this.Group.SelectedValue=parseInt(h.Tables[4][0].ParentID),this.Customer.SelectedValue=parseInt(h.Tables[4][0].CustomerID)),this.ActVisibility&&!this.group&&h.Tables.length>7&&(this.ViewActivities.LoadActivityData(h.Tables[7]),this.ViewActivities.ActivityGridData.length>0?(this.ViewActivities.SelectedRow=this.ViewActivities.ActivityGridData[this.ViewActivities.ActivityGridData.length-1],this.ViewActivities.OnCmnItem_Click("EDIT","EDIT")):this.ActVisibility=!1)),this.MessageVisibility=!1,null!=this.Group&&this.lstEventCtrls.push(this.Group.DBColumnID),null!=this.Status&&this.lstEventCtrls.push(this.Status.DBColumnID),null!=this.Customer&&this.lstEventCtrls.push(this.Customer.DBColumnID);for(let d=0;d<this.ScreenObject.StaticFields.length;d++)l=this.ScreenObject.StaticFields[d],l&&null!=l.ToolTipFooterTitle&&null!=l.KeyTip&&!this.lstEventCtrls.Contains(l.DBColumnID)?this.SetControlEvent(l):this.CaseID>0&&l&&null!=l.ToolTipFooterTitle&&null!=l.KeyTip&&19==l.Mode&&this.OnGetExtFunctionData(l);if(null!=this.ScreenObject.HeaderFields)for(let d=0;d<this.ScreenObject.HeaderFields.length;d++)l=this.ScreenObject.HeaderFields[d],l&&null!=l.ToolTipFooterTitle&&null!=l.KeyTip&&!this.lstEventCtrls.Contains(l.DBColumnID)?this.SetControlEvent(l):this.CaseID>0&&l&&null!=l.ToolTipFooterTitle&&null!=l.KeyTip&&19==l.Mode&&this.OnGetExtFunctionData(l)}SetControlEvent(t){try{t instanceof f.Dw?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof C.y$?t.SelectionChangedCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof A.I||t instanceof f.L6?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof b.y$?t.OnPactListBoxValueChanged.Subscribe(this,"OnGetExtFunctionData"):(t instanceof S.Lc||t instanceof S.P6||t instanceof S.C_)&&t.SelectedDateChanged.Subscribe(this,"OnGetExtFunctionData"),this.CaseID>0&&19==t.Mode&&this.OnGetExtFunctionData(t)}catch{}}OnGetExtFunctionData(t){null!=t.ToolTipFooterTitle&&!D.J0.IsEmpty(t.KeyTip)&&"lostfocus"==t.KeyTip.toLowerCase()&&this.ScreenObject.ValidateExtData(t,null,!0)&&this.ScreenObject.GetExternalFuncData(t.Mode,this.CaseID,t.ToolTipFooterTitle,t.ToolTipFooterDescription,t.ToolTipDescription,null,null)}FillComboBoxItems(t){this.cType=this.ScreenObject.GetQuickCombo(24397),null!=this.cType&&C.y$.FillComboWithDefaultOption(t.Tables[7],this.ScreenObject.GetQuickCombo(24397)),this.origin=this.ScreenObject.GetQuickCombo(24237),null!=origin&&C.y$.FillComboWithDefaultOption(t.Tables[6],this.ScreenObject.GetQuickCombo(24237)),this.priority=this.ScreenObject.GetQuickCombo(24236),null!=this.priority&&C.y$.FillComboWithDefaultOption(t.Tables[5],this.ScreenObject.GetQuickCombo(24236)),this.cmode=this.ScreenObject.GetQuickCombo(53516),null!=this.cmode&&(this.cmode.Items.Clear(),this.cmode.Items.push(C._p.ComboBoxItems_2("Manual","Manual")),this.cmode.Items.push(C._p.ComboBoxItems_2("PM","PM")),this.cmode.SelectedValue="Manual")}OnGroupSelectionChanged(t){this.Group.SelectedValue>0&&(this.parentid=this.Group.SelectedValue,this.AutoGenerateCode())}AutoGenerateCode(){this.ScreenObject.SetAutoCode(this.CName,this.group,this.parentid,this.dsinfo.Tables[7])}OnSave(t){if("Cancel"==t)n.d.page.HideDialog(this.PopUpGUID);else if("Save"==t)try{let e=0;if(!this.group&&(0==this.Customer.SelectedValue||null==this.Customer.SelectedValue))return this.DisplayMessage="Select "+this.Customer.Label,void(this.MessageVisibility=!0);if(0==this.Casesmodel.CaseID){if(0==this.Casesmodel.CaseID&&this.AllowCreationofCase){let o=0,u=0,h="";2==this.Customer.CCID?u=1:83==this.Customer.CCID&&(u=2);let a=n.d.common.GetDataSet3("CRM002",this.lstatusid.toString().Replace(";",","),u.toString(),this.Customer.SelectedValue.toString());if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&""!=a.Tables[0][0][0].toString()&&(o=parseInt(a.Tables[0][0][1].toString()),h=a.Tables[0][0][0].toString(),o>0&&!confirm("Case already opened with Customer and Case Number is "+h+", Are you sure you want to continue?")))return}if(0==this.Casesmodel.CaseID&&this.ActMandatory)return void alert("Activity is mandatory");let s={StrCode:this.Casesmodel.CaseNumber,CodePrefix:this.Casesmodel.CodePrefix,CodeNumber:this.Casesmodel.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.CName,this.parentid,this.ScreenObject.Data.Tables[7],s),this.Casesmodel.CaseNumber=s.StrCode,this.Casesmodel.CodePrefix=s.CodePrefix,this.Casesmodel.CodeNumber=s.CodeNumber,this.DisplayMessage.length>0)return}else this.Casesmodel.CaseNumber=this.CName.Text;if(this.group){if(null==this.CaseDate.Date)return this.MessageVisibility=!0,void(this.DisplayMessage="Please Enter Case Date");this.Casesmodel.CaseDate=this.CaseDate.Date,this.Casesmodel.StatusID=parseInt(this.Status.SelectedValue),this.Casesmodel.IsGroup=this.group,this.Casesmodel.Customer=this.Customer.SelectedValue,2==this.Customer.CCID?this.Casesmodel.CustomerMode=1:83==this.Customer.CCID&&(this.Casesmodel.CustomerMode=2),this.Casesmodel.SelectedNodeID=this.Group.SelectedValue}else{if(null==this.CaseDate.Date)return this.MessageVisibility=!0,void(this.DisplayMessage="Please Enter Case Date");this.Casesmodel.CaseDate=this.ScreenObject.GetDatePickerValue(24233,Date.Today()),""==this.Status.DefaultValue&&(this.Status.DefaultValue="0"),""==this.Customer.DefaultValue&&(this.Customer.DefaultValue="0"),""==this.Group.DefaultValue&&(this.Group.DefaultValue=this.selectedNode.toString()),this.Casesmodel.StatusID=this.ScreenObject.GetTextComboValue_int(24235,parseInt(this.Status.DefaultValue)),this.Casesmodel.IsGroup=this.group,this.Casesmodel.Customer=this.ScreenObject.GetPactListValue(24238,parseInt(this.Customer.DefaultValue)),2==this.Customer.CCID?this.Casesmodel.CustomerMode=1:83==this.Customer.CCID&&(this.Casesmodel.CustomerMode=2),this.Casesmodel.SelectedNodeID=null==this.ScreenObject.GetQuickField(24398)?this.selectedNode:this.ScreenObject.GetPactListValue(24398,parseInt(this.Group.DefaultValue))}if(this.ActVisibility){if(this.Activities.onSaveActivity("Save"),!D.J0.IsEmpty(this.Activities.DisplayMessage))return void(this.DisplayMessage=this.Activities.DisplayMessage);this.Casesmodel.ActivityXml=this.ViewActivities.ActivitiesXML()}else this.Casesmodel.ActivityXml="";if(this.Casesmodel.Subject=this.ScreenObject.GetTextComboValue_string(27293,""),null!=this.cType&&(this.Casesmodel.CaseTypeID=this.ScreenObject.GetTextComboValue_int(24397,0)),null!=origin&&(this.Casesmodel.CaseOriginID=this.ScreenObject.GetTextComboValue_int(24237,0)),null!=this.priority&&(this.Casesmodel.CasePriorityID=this.ScreenObject.GetTextComboValue_int(24236,0)),null!=this.cmode&&(this.Casesmodel.Mode=this.ScreenObject.GetTextComboValue_string(53516,"")),!this.ScreenObject.ValidateDataonSave())return;if(0==this.Casesmodel.CaseID){let s=this.Casesmodel.SaveCase(0,0);e=s.RetValue,this.DisplayMessage=s.Message}else{let s=this.Casesmodel.QuickUpdateCase();e=s.RetValue,this.DisplayMessage=s.RetValue}this.RetValue=e,e>0&&(this.CName.Text="",this.Casesmodel.CaseID=0,n.d.SessionManager.Preferences.ContainsKey("Date Format")&&(this.CaseDate.Text=(new Date).ToString(n.d.SessionManager.Preferences["Date Format"].toString())),this.Status.SelectedValue="1",null!=this.parent&&(null!=this.parent.SelectedNode&&(this.parent.tree[0].SetFocusNodeID=this.parent.SelectedNode.Id),this.parent.Refresh()),this.AutoGenerateCode(),this.Group.SelectedValue=this.selectedNode)}catch(e){Logger.ErrorLog("SaveCaseViewModel:: OnSave",e)}else if("Details"==t.toString()){null!=this.Group&&(this.parentid=this.Group.SelectedValue);let e=new O.AddEditCasesViewModel(this.CaseID,this.parentid,this.group);e.isClose||n.d.page.addNewTab({component:J.AddEditCaseComponent,params:{obj:e}}),n.d.page.HideDialog(this.PopUpGUID)}}static SetActivityUI(t,e){if(e.length>0){t.ActVisibility=!0,t.Activities=new Q.ActivitiesViewModel(t,!1),t.Activities.IsPopup=!1,t.Activities.LoadCustomFields(73),t.Activities.AssignVisiblity=!1,t.Activities.HeaderVisible=!1,t.Activities.ButtonsVisible=!1,t.ViewActivities=new B.ViewActivitiesViewModel(t),t.ViewActivities.Activities=t.Activities;let s=e.filter(o=>"ActivityTypeName"==o.SysColumnName);t.Activities.ActivityType.Visible=s.length>0,s=e.filter(o=>"StatusID"==o.SysColumnName),t.Activities.StatusVisible=s.length>0,s=e.filter(o=>"Subject"==o.SysColumnName),t.Activities.Subject.Visible=s.length>0,s=e.filter(o=>"CRMCustomer"==o.SysColumnName),t.Activities.CRMCustomer.Visible=s.length>0,s=e.filter(o=>"CRMContactPerson"==o.SysColumnName),t.Activities.CRMContactPerson.Visible=s.length>0,s=e.filter(o=>"AssignUserID"==o.SysColumnName),t.Activities.AssignUserList.Visible=s.length>0,s=e.filter(o=>"Remarks"==o.SysColumnName),t.Activities.Remarks.Visible=s.length>0,t.Activities.Fields.forEach(o=>{s=e.filter(u=>u.SysColumnName==o.SysColumnName),o.Visible=s.length>0})}else t.ActVisibility=!1}}function fe(c,t){if(1&c&&(i.j41(0,"div",9),i.EFF(1,"\n          "),i.eu8(2,10),i.EFF(3,"\n        "),i.k0s()),2&c){const e=i.XpG().$implicit,s=i.XpG();i.R7$(2),i.Y8G("obj",e)("group",s.obj.ScreenObject.form)}}function Se(c,t){if(1&c&&(i.qex(0),i.EFF(1,"\n        "),i.DNE(2,fe,4,2,"div",8),i.EFF(3,"\n      "),i.bVm()),2&c){const e=t.$implicit;i.R7$(2),i.Y8G("ngIf",e.Visible)}}let De=(()=>{class c{constructor(e){this.translate=e}ngOnInit(){}static{this.\u0275fac=function(s){return new(s||c)(i.rXU(g.c$))}}static{this.\u0275cmp=i.VBU({type:c,selectors:[["app-quick-add-case"]],standalone:!1,decls:27,vars:11,consts:[[1,"master-screen",3,"formGroup"],[1,"PACTHeaderFields","dialogSubBody"],[4,"ngFor","ngForOf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"fa-light","fa-floppy-disk"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],["class","form-group col PACTControl",4,"ngIf"],[1,"form-group","col","PACTControl"],["FieldDirective","",3,"obj","group"]],template:function(s,o){1&s&&(i.j41(0,"div",0),i.EFF(1,"\n    "),i.j41(2,"div",1),i.EFF(3,"\n      "),i.DNE(4,Se,4,1,"ng-container",2),i.EFF(5,"\n  "),i.k0s(),i.EFF(6,"\n\n  "),i.j41(7,"div",3),i.EFF(8,"\n    "),i.j41(9,"div"),i.EFF(10,"\n        "),i.j41(11,"button",4),i.bIt("click",function(){return o.obj.OnSave("Save")}),i.nrm(12,"i",5),i.EFF(13),i.nI1(14,"translate"),i.k0s(),i.EFF(15,"\n        "),i.j41(16,"button",6),i.bIt("click",function(){return o.obj.OnSave("Details")}),i.EFF(17),i.nI1(18,"translate"),i.k0s(),i.EFF(19,"\n        "),i.j41(20,"button",6),i.bIt("click",function(){return o.obj.OnSave("Cancel")}),i.nrm(21,"i",7),i.EFF(22),i.nI1(23,"translate"),i.k0s(),i.EFF(24,"\n    "),i.k0s(),i.EFF(25,"      \n  "),i.k0s(),i.EFF(26,"\n"),i.k0s()),2&s&&(i.Y8G("formGroup",o.obj.ScreenObject.form),i.R7$(4),i.Y8G("ngForOf",o.obj.ScreenObject.QuickAddFields),i.R7$(9),i.JRh(i.bMT(14,5,"Save")),i.R7$(4),i.JRh(i.bMT(18,7,"QuidAdd_Details")),i.R7$(5),i.JRh(i.bMT(23,9,"Cancel")))},dependencies:[T.Sq,T.bT,I.cb,I.j4,y._,g.D9],encapsulation:2})}}return c})();var H=r(91250),pe=r(67875),be=r(53806);class ge{static AddPage(t,e,s,o,u,h){let a=t.obj;if(83==a.CostCenterID)if(n.d.page.ShowLoading=!0,a.IsQuickNodeDefined&&!e){let l=new k(o,a.SelectedNode.id,u,s?a.SelectedNode.IsGroup:h,t);n.d.page.ShowDialog(l,x)}else{let d={obj:new G.I(o,a.SelectedNode.id,u,!1)};n.d.page.addNewTab({component:E.AddCustomerComponent,params:d})}else if(86==a.CostCenterID)if(n.d.page.ShowLoading=!0,a.IsQuickNodeDefined&&!e){let l=new m(t,o,u,s?a.SelectedNode.IsGroup:h,a.SelectedNode.id);n.d.page.ShowDialog(l,se)}else{let d={obj:new N.p(o,a.SelectedNode.id,!1)};n.d.page.addNewTab({component:P.AddEditLeadComponent,params:d})}else if(88==a.CostCenterID){n.d.page.ShowLoading=!0;let d={obj:new U.Q(o,a.SelectedNode.id)};n.d.page.addNewTab({component:Ce.AddEditCampaignComponent,params:d})}else if(89==a.CostCenterID){n.d.page.ShowLoading=!0;{let d={obj:new $.AddEditOpportunity(o,a.SelectedNode.id,!1)};n.d.page.addNewTab({component:oe.AddEditOpportunityComponent,params:d})}}else if(91==a.CostCenterID){n.d.page.ShowLoading=!0;let d={obj:new H.TeamViewModel(o,a.SelectedNode.id)};n.d.page.addNewTab({component:pe.TeamviewmodelComponent,params:d})}else if(73==a.CostCenterID)if(n.d.page.ShowLoading=!0,a.IsQuickNodeDefined&&!e){let l=new L(t,o,u,s?a.SelectedNode.IsGroup:h,a.SelectedNode.id);n.d.page.ShowDialog(l,De)}else{let d={obj:new O.AddEditCasesViewModel(o,u,!1)};n.d.page.addNewTab({component:J.AddEditCaseComponent,params:d})}else if(65==a.CostCenterID){n.d.page.ShowLoading=!0;{let d={obj:new ae.AddDContactViewModel(o,!1,a.SelectedNode.id)};n.d.page.addNewTab({component:le.m,params:d})}}}static Convert(t){if(t.SelectedNode.IsGroup)alert("Group cannot be converted ");else if(null!=t.SelectedNode)if(83==t.CostCenterID){let e=new G.I(83,t.SelectedNode.id,1,!1);e.CustomerID=t.SelectedNode.id;let s=new ne.a;s.ConvertCustomer_1(e),n.d.page.ShowDialog(s,re.Z,{ShowCenter:!0})}else if(86==t.CostCenterID){let e=(new X.k).GetLead(t.SelectedNode.id),s=null;if(s=e.Tables[2].filter(o=>"ConvertApprovedLeads"==o.Name),s.length>0)if(D.J0.IsEmpty(s[0].Value)||"0"==s[0].Value.toString()){let o=new F._(t.SelectedNode.id,e,t.CostCenterID);n.d.page.ShowDialog(o,v.i,{ShowCenter:!0})}else if((0,p.yG0)(s[0].Value)){if(null!=e&&e.Tables.length>1&&e.Tables[0].length>0&&e.Columns[0].Contains("IsApproved")&&(D.J0.IsEmpty(e.Tables[0][0].IsApproved)||!(0,p.yG0)(e.Tables[0][0].IsApproved)))return void alert("Lead should be in approved status! ");let o=new F._(t.SelectedNode.id,e,t.CostCenterID);n.d.page.ShowDialog(o,v.i,{ShowCenter:!0})}else{let o=new F._(t.SelectedNode.id,e,t.CostCenterID);n.d.page.ShowDialog(o,v.i,{ShowCenter:!0})}}else if(89==t.CostCenterID){let e=new F._(t.SelectedNode.id,null,t.CostCenterID);n.d.page.ShowDialog(e,v.i,{ShowCenter:!0})}}static Close(t,e){if(e.SelectedNode.IsGroup)alert("Group cannot be converted ");else if(null!=e.SelectedNode&&86==e.CostCenterID){let s=n.d.common.GetDataSet("CRM001",e.SelectedNode.id.toString());if(null!=s&&s.Tables.length>0&&s.Tables[0].length>0&&"419"==s.Tables[0][0].StatusID.toString()){let o=new ce.V(e.SelectedNode.id,t,86);n.d.page.ShowDialog(o,ue.CloseLeadComponent,{ShowCenter:!0,NoWidth:!0})}else e.DisplayMessage="Select Assigned lead"}}static Assign(t,e){if(null!=e.SelectedNode){if(1==e.SelectedNode.id)return;let s=new Array;null!=e.SelectedNodes&&e.SelectedNodes.forEach(u=>{s.push(C.oN.CheckedListBoxItem_6(u.Text[0],u.Id.toString(),!0,u.TypeID))});let o=new de.AssignFeatureViewModel;s.length>0?o.AssignFeatureViewModel_2(this,s,e.CostCenterID):o.AssignFeatureViewModel_1(this,e.SelectedNode.id,e.CostCenterID),n.d.page.ShowDialog(o,he.AssignFeatureComponent)}}static LoadCRMScreen(t,e){return"6558"===t.FeatureActionID.toString()?{component:be.TreeViewPageComponent,params:{ScreenName:t.ScreenName,FeatureActionID:t.FeatureActionID,CostCenterID:t.FeatureID,Call:"C3"},basedon:"CostCenterID"}:{}}static ShowQuickAdd_CRMIsQuick(t,e){if(83==t){let s=new k(e,0,1,!1,null);return s.Height=400,n.d.page.ShowDialog(s,x),s.CustomerID}return 0}static ShowQuickAdd_CRM(t,e){if(83==t){let s=null;s=0==e?new G.I(0,0,1,!1):new G.I(83,e,1,!1),n.d.page.ShowDialog(s,E.AddCustomerComponent,{ShowCenter:!0})}}static GetCRMActivityScreen(t){let e=null;return 86==t.FeatureID?e=new N.p(t.DBColumnID,0,!1):89==t.FeatureID?e=new $.AddEditOpportunity(t.DBColumnID,0,!1):73==t.FeatureID?e=new O.AddEditCasesViewModel(t.DBColumnID,0,!1):88==t.FeatureID?e=new U.Q(t.DBColumnID,0):83==t.FeatureID?e=new G.I(t.DBColumnID,t.DBColumnID,0,!1):91==t.FeatureID&&(e=new H.TeamViewModel(t.DBColumnID,t.DBColumnID)),e}}}}]);