"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[2686],{60305:(A,D,u)=>{u.r(D),u.d(D,{QuickAddProductViewModel:()=>B});var p=u(85985),I=u(84151),h=u(27730),P=u(23458),j=u(58941),c=u(32040),b=u(54581),l=u(43767),V=u(98580),_=u(92442),G=u(81547),y=u(95328),x=u(51842),N=u(58170),C=u(53461),f=u(92467),g=u(82503),M=u(13054),E=u(41264),L=u(41820);class B extends V.g{constructor(e,r,i,o,t){super(),this.oProduct=new x.c,this.ImageView=null,this.InheritImage=!1,this.InheritGrpImage=!1,this.InheritDimImageID=-1,this.ScreenObject=new p.ControlGenerator,this.NameSameasCode=!1,this.RetValue=0,this.Height="",this.IsAutoBarCode=!1,this.ParentId=0,this.SelectedNode=0,this.NodeID=0,this.lstEventCtrls=[],this.objProduct={},this.GParentID=0,this.LinkColumnCostcenterID=-1,this.DefaultValuation=1,this.sProdType="",this.sBinWise="",this.FileID=0,this.ProductPhoto="",this.isPhotoChanged=!1,this.ClassName="QuickAddProductViewModel",this.LoadViewModel(e,r,i,o,t)}LoadViewModel(e,r,i,o,t){Logger.InfoLog("QuickAddProductViewModel::Entering QuickAddProductViewModel"),0==r&&(r=1),this.NodeID=e,this.GParentID=o,this.oProduct.ProductID=this.NodeID,this.ParentId=r,this.oProduct.IsGroup=t,this.ScreenObject.LoadQuickScreen(this,3,t),this.OnLoad(),this.FillControls(),this.Title=t?0!=this.NodeID?"Edit Group":"Add Group":c.d.GetResource(0!=this.NodeID?"Product_QuickEdit":"Product_QuickAdd"),this.DisplayName=this.Title;var s=this.ScreenObject.StaticFields.find(n=>26722==n.DBColumnID);let a;!t&&null!=s&&null!=s&&(s.Visible=!1),null!=this.Code&&this.Code.TextChangedCommand.Subscribe(this,"OnTextChanged"),this.SetViewByType(),null!=this.Code&&this.lstEventCtrls.push(this.Code.DBColumnID),null!=this.Name&&this.lstEventCtrls.push(this.Name.DBColumnID),null!=this.UOM&&this.lstEventCtrls.push(this.UOM.DBColumnID),null!=this.ProductGroup&&this.lstEventCtrls.push(this.ProductGroup.DBColumnID),null!=this.ProductType&&this.lstEventCtrls.push(this.ProductType.DBColumnID);for(let n=0;n<this.ScreenObject.StaticFields.length;n++)a=this.ScreenObject.StaticFields[n],a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&!this.lstEventCtrls.Contains(a.DBColumnID)?this.SetControlEvent(a):this.NodeID>0&&a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&19==a.Mode&&this.OnGetExtFunctionData(a);if(null!=this.ScreenObject.HeaderFields)for(let n=0;n<this.ScreenObject.HeaderFields.length;n++)a=this.ScreenObject.HeaderFields[n],a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&!this.lstEventCtrls.Contains(a.DBColumnID)?this.SetControlEvent(a):this.NodeID>0&&a&&null!=a.ToolTipFooterTitle&&null!=a.KeyTip&&19==a.Mode&&this.OnGetExtFunctionData(a);Logger.InfoLog("QuickAddProductViewModel::BuildControls Success")}SetControlEvent(e){try{e instanceof I.Dw?e.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):e instanceof h.y$?e.SelectionChangedCommand.Subscribe(this,"OnGetExtFunctionData"):e instanceof M.I||e instanceof I.L6?e.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):e instanceof P.y$?e.OnPactListBoxValueChanged.Subscribe(this,"OnGetExtFunctionData"):(e instanceof g.Lc||e instanceof g.P6||e instanceof g.C_)&&e.SelectedDateChanged.Subscribe(this,"OnGetExtFunctionData"),this.NodeID>0&&19==e.Mode&&this.OnGetExtFunctionData(e)}catch{}}OnGetExtFunctionData(e){null!=e.ToolTipFooterTitle&&!l.J0.IsEmpty(e.KeyTip)&&"lostfocus"==e.KeyTip.toLowerCase()&&this.ScreenObject.ValidateExtData(e,null,!0)&&this.ScreenObject.GetExternalFuncData(e.Mode,this.NodeID,e.ToolTipFooterTitle,e.ToolTipFooterDescription,e.ToolTipDescription,null,null)}SetViewFilter(e,r){return r.filter="",e.forEach(i=>{if("3"==i){if(!(null!=(o=this.ScreenObject.QuickAddFields.find(t=>281==t.DBColumnID))&&null!=o&&o instanceof P.y$&&o.SelectedValue>0))return!1;r.filter+=" and GroupID="+o.SelectedValue}else if(!l.J0.IsEmpty(i)&&parseInt(i)>5e4){var o;if(!(null!=(o=this.ScreenObject.QuickAddFields.find(s=>s instanceof P.y$&&s.CCID==parseInt(i)))&&null!=o&&o instanceof P.y$&&o.SelectedValue>0))return!1;r.filter+=" and DcCCNID"+(parseInt(i)-5e4)+"="+o.SelectedValue}return!0}),!0}SetViewByType(){let t,e=null,r="",i=this.ScreenObject.Data.Tables[10].filter(a=>"PrDimWiseFields"==a.Name),o=null;if(i.length>0&&""!=i[0].Value.toString()&&(o=i[0].Value.toString().split(";")),null!=o){let a={filter:r};this.SetViewFilter(o,a)||(r=a.filter),r=a.filter,o.forEach(n=>{if("3"==n)e=this.ScreenObject.QuickAddFields.find(m=>281==m.DBColumnID),null!=e&&null!=e&&e instanceof P.y$&&(e.Enable=!1);else if(!l.J0.IsEmpty(n)&&parseInt(n)>5e4){var S=this.ScreenObject.QuickAddFields.find(m=>m instanceof P.y$&&m.CCID==parseInt(n));null!=S&&null!=S&&S instanceof P.y$&&(S.Enable=!1)}})}l.J0.IsEmpty(r)||(this.ScreenObject.Data.Tables[18].filter(a=>0==a.IsTab).forEach(a=>{e=this.ScreenObject.QuickAddFields.find(n=>n instanceof N.MI&&n.DBColumnID==parseInt(a.CostCenterColID)),null!=e&&null!=e&&(t=parseInt(a.Hide),(1==t||2==t)&&(e.Visible=!1),t=parseInt(a.Mandatory),(1==t||2==t)&&(e.Mandatory=!0))}),this.SetFieldPOsition())}SetFieldPOsition(){let e=this.ScreenObject.QuickAddFields.filter(i=>!l.J0.IsEmpty(i.Row));e.sort((i,o)=>i.Row-o.Row);let r=0;for(let i=0;i<e.length;i++){let o=e.ElementAt(i);o.Visible&&(o.Row=r++)}}OnLoad(){if(this.ButtonSave=new j.v,0==this.NodeID?c.d.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=c.d.SessionManager.IsActionAssigned(3,"Create"):this.ButtonSave.Enable=c.d.SessionManager.IsActionAssigned(3,"Create"):(this.ScreenObject.IsEdit=!0,c.d.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=c.d.SessionManager.IsActionAssigned(3,"Update"):this.ButtonSave.Enable=c.d.SessionManager.IsActionAssigned(3,"Update")),this.QuickAssign=new _.d,this.QuickAssign.QuickAssignGrid_1(2,this.ScreenObject.Data,this.oProduct.IsGroup),this.Code=this.ScreenObject.GetQuickCode(261),this.Name=this.ScreenObject.GetQuickText(262),this.BarCode=this.ScreenObject.GetQuickText(280),this.ProductLength=this.ScreenObject.GetQuickText(601),null!=this.ProductLength){this.ProductLength.TextChangedCommand.Subscribe(this,"onTextValueChanged");let t=0;t=l.J0.IntTryParse(this.ScreenObject.Data.Tables[10].filter(s=>"LengthDecimals"==s.Name)[0].Value.toString()),this.ProductLength.DecimalPoints=t.toString(),this.ProductLength.LostFocusCommand.Subscribe(this,"onLostFocus")}if(this.ProductWidth=this.ScreenObject.GetQuickText(602),null!=this.ProductWidth){this.ProductWidth.TextChangedCommand.Subscribe(this,"onTextValueChanged");let t=0;t=l.J0.IntTryParse(this.ScreenObject.Data.Tables[10].filter(s=>"WidthDecimals"==s.Name)[0].Value.toString()),this.ProductWidth.DecimalPoints=t.toString(),this.ProductWidth.LostFocusCommand.Subscribe(this,"onLostFocus")}if(this.ProductHeight=this.ScreenObject.GetQuickText(603),null!=this.ProductHeight){this.ProductHeight.TextChangedCommand.Subscribe(this,"onTextValueChanged");let t=0;t=l.J0.IntTryParse(this.ScreenObject.Data.Tables[10].filter(s=>"HeightDecimals"==s.Name)[0].Value.toString()),this.ProductHeight.DecimalPoints=t.toString(),this.ProductHeight.LostFocusCommand.Subscribe(this,"onLostFocus")}if(this.ProductVolume=this.ScreenObject.GetQuickText(604),null!=this.ProductVolume){let t=0;t=l.J0.IntTryParse(this.ScreenObject.Data.Tables[10].filter(s=>"VolumeDecimals"==s.Name)[0].Value.toString()),this.ProductVolume.DecimalPoints=t.toString(),this.ProductVolume.LostFocusCommand.Subscribe(this,"onLostFocus")}if(this.ProductWeight=this.ScreenObject.GetQuickText(605),null!=this.ProductWeight){let t=0;t=l.J0.IntTryParse(this.ScreenObject.Data.Tables[10].filter(s=>"VolumeDecimals"==s.Name)[0].Value.toString()),this.ProductWeight.DecimalPoints=t.toString(),this.ProductWeight.LostFocusCommand.Subscribe(this,"onLostFocus")}if(this.ProductWastage=this.ScreenObject.GetQuickText(584),null!=this.ProductWastage){let t=0;t=l.J0.IntTryParse(this.ScreenObject.Data.Tables[10].filter(s=>"VolumeDecimals"==s.Name)[0].Value.toString()),this.ProductWastage.DecimalPoints=t.toString(),this.ProductWastage.LostFocusCommand.Subscribe(this,"onLostFocus")}null!=this.Name&&this.Name.LostFocusCommand.Subscribe(this,"OnNameLostFocus"),this.oCombo=this.ScreenObject.GetQuickCombo(266),null!=this.oCombo&&(this.ScreenObject.Data.Tables[3].forEach(t=>{this.oCombo.Items.push(h._p.ComboBoxItems_2(t[Object.keys(t)[1]].toString(),t[Object.keys(t)[0]].toString()))}),this.ScreenObject.Data.Tables[3].length>0&&(l.J0.StringIsNullOrEmpty(this.oCombo.SelectedValue)||parseInt(this.oCombo.SelectedValue)<=1||0==this.ScreenObject.Data.Tables[3].filter(t=>t.StatusID==this.oCombo.SelectedValue).length)&&(this.oCombo.SelectedValue=this.ScreenObject.Data.Tables[3][0][Object.keys(this.ScreenObject.Data.Tables[3][0])[0]].toString())),this.oCombo=this.ScreenObject.GetQuickCombo(264),null!=this.oCombo&&(this.ScreenObject.Data.Tables[4].forEach(t=>{"2"==t[Object.keys(t)[0]].toString()&&!(0,b.yG0)(c.d.SessionManager.Preferences.EnableSerialProducts.toString())||"5"==t[Object.keys(t)[0]].toString()&&!(0,b.yG0)(c.d.SessionManager.Preferences.EnableBatchProducts.toString())||("8"==t[Object.keys(t)[0]].toString()||"3"==t[Object.keys(t)[0]].toString())&&!(0,b.yG0)(c.d.SessionManager.Preferences.EnableDynamicProducts.toString())||this.oCombo.Items.push(h._p.ComboBoxItems_2(t[Object.keys(t)[1]].toString(),t[Object.keys(t)[0]].toString()))}),this.ProductType=this.oCombo,this.ProductType.SelectionChangedCommand.Subscribe(this,"OnProductTypeChange")),this.ProductGroup=this.ScreenObject.GetQuickField(281),null!=this.ProductGroup&&(0!=this.ParentId&&0==this.NodeID?(this.ProductGroup.SelectedValue=this.ParentId,this.ProductGroup.DefaultValue=this.ProductGroup.SelectedValue.toString()):(this.ProductGroup.SelectedValue=this.GParentID,this.ProductGroup.DefaultValue=this.ProductGroup.SelectedValue.toString()),this.ProductGroup.SelectionChangedCommand.Subscribe(this,"OnGroupSelectionChanged"),this.ProductGroup.Enable=0==this.NodeID);let e,r=this.ScreenObject.Data.Tables[10];if(e=r,r=r.filter(t=>"DefaultProductValuation"==t.Name),null!=r&&r.length>0){let t=this.ScreenObject.Data.Tables[6].filter(s=>s.ValuationMethod==r[0][Object.keys(r[0])[1]].toString());null!=t&&t.length>0&&(this.DefaultValuation=parseInt(t[0].ValuationID))}r=e,r=r.filter(t=>"AutoBarcode"==t.Name),null!=r&&r.length>0&&(0,b.yG0)(r[0].Value)?(this.IsAutoBarCode=!0,null!=this.BarCode&&(this.BarCode.Enable=!1)):this.IsAutoBarCode=!1;let i=this.ScreenObject.Data.Tables[10].filter(t=>"DefaultImage"==t.Name);if(null!=i&&i.length>0&&(this.InheritImage=(0,b.yG0)(i[0].Value)),i=this.ScreenObject.Data.Tables[10].filter(t=>"InheritGroupImage"==t.Name),null!=i&&i.length>0&&(this.InheritGrpImage=(0,b.yG0)(i[0].Value)),i=this.ScreenObject.Data.Tables[10].filter(t=>"InheritDimensionImage"==t.Name),null!=i&&i.length>0&&(this.InheritDimImageID=""!=i[0].Value.toString()?parseInt(i[0].Value):-1),null!=this.ScreenObject.Data&&null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>14&&(this.ImageView=this.ScreenObject.Data.Tables[14]),this.oCombo=this.ScreenObject.GetQuickCombo(265),null!=this.oCombo&&(this.ScreenObject.Data.Tables[6].forEach(t=>{this.oCombo.Items.push(h._p.ComboBoxItems_2(t[Object.keys(t)[1]].toString(),t[Object.keys(t)[0]].toString()))}),this.oCombo.SelectedValue=this.DefaultValuation.toString()),this.oCombo=this.ScreenObject.GetQuickCombo(269),null!=this.oCombo&&this.ScreenObject.Data.Tables[7].forEach(t=>{this.oCombo.Items.push(h._p.ComboBoxItems_2(t[Object.keys(t)[1]].toString(),t[Object.keys(t)[0]].toString()))}),this.oCombo=this.ScreenObject.GetQuickCombo(50392),null!=this.oCombo&&(this.oCombo.Items.push(h._p.ComboBoxItems_2("Yes","1")),this.oCombo.Items.push(h._p.ComboBoxItems_2("No","0")),this.oCombo.SelectedValue=this.oCombo.DefaultValue),this.oCombo=this.ScreenObject.GetQuickCombo(275),null!=this.oCombo&&(this.oCombo.Items.push(h._p.ComboBoxItems_2("Yes","1")),this.oCombo.Items.push(h._p.ComboBoxItems_2("No","0")),this.oCombo.SelectedValue="0",this.BinWise=this.oCombo),this.oCombo=this.ScreenObject.GetQuickCombo(600),null!=this.oCombo&&(this.oCombo.Items.push(h._p.ComboBoxItems_2("No","0")),this.oCombo.Items.push(h._p.ComboBoxItems_2("Yes","1")),this.oCombo.SelectedValue=c.d.SessionManager.Preferences.ContainsKey("PackDimension")&&""!=c.d.SessionManager.Preferences.PackDimension&&parseInt(c.d.SessionManager.Preferences.PackDimension)>0?"1":"0"),this.oCombo=this.ScreenObject.GetQuickCombo(587),null!=this.oCombo&&(this.oCombo.Items.push(h._p.ComboBoxItems_2("No","0")),this.oCombo.Items.push(h._p.ComboBoxItems_2("Yes","1")),this.oCombo.Items.push(h._p.ComboBoxItems_2("FIFO","2")),this.oCombo.SelectedValue="0"),this.oCombo=this.ScreenObject.GetQuickCombo(588),null!=this.oCombo&&(this.oCombo.Items.push(h._p.ComboBoxItems_2("None","0")),this.oCombo.Items.push(h._p.ComboBoxItems_2("Order","1")),this.oCombo.Items.push(h._p.ComboBoxItems_2("Max.Level","2")),this.oCombo.Items.push(h._p.ComboBoxItems_2("Reorder","3")),this.oCombo.SelectedValue="0"),this.oCombo=this.ScreenObject.GetQuickCombo(593),null!=this.oCombo&&(this.oCombo.Items.push(h._p.ComboBoxItems_2("None","0")),this.oCombo.Items.push(h._p.ComboBoxItems_2("MRP","1")),this.oCombo.SelectedValue="0"),this.oCombo=this.ScreenObject.GetQuickCombo(594),null!=this.oCombo&&(this.oCombo.Items.push(h._p.ComboBoxItems_2("Purchased","0")),this.oCombo.Items.push(h._p.ComboBoxItems_2("Produced","1")),this.oCombo.SelectedValue="0"),this.oCombo=this.ScreenObject.GetQuickCombo(585),null!=this.oCombo){if(this.ScreenObject.Data.Tables.length>17&&this.ScreenObject.Data.Tables[17].length>0){let t=this.ScreenObject.Data.Tables[17];if(t=t.filter(s=>0==s.RuleType),null!=t&&null!=t&&t.length>0)for(let s=0;s<t.length;s++)this.oCombo.Items.push(h._p.ComboBoxItems_2(t[s].ProfileName.toString(),t[s].ProfileID.toString()))}this.oCombo.SelectedValue=""}if(this.oCombo=this.ScreenObject.GetQuickCombo(586),null!=this.oCombo){if(this.ScreenObject.Data.Tables.length>17&&this.ScreenObject.Data.Tables[17].length>0){let t=this.ScreenObject.Data.Tables[17];if(t=t.filter(s=>0==s.RuleType),null!=t&&null!=t&&t.length>0)for(let s=0;s<t.length;s++)this.oCombo.Items.push(h._p.ComboBoxItems_2(t[s].ProfileName.toString(),t[s].ProfileID.toString()))}this.oCombo.SelectedValue=""}this.oCombo=this.ScreenObject.GetQuickCombo(274),null!=this.oCombo&&(this.oCombo.Items.push(h._p.ComboBoxItems_2("Not Applicable","3")),this.oCombo.Items.push(h._p.ComboBoxItems_2("Optional","2")),this.oCombo.Items.push(h._p.ComboBoxItems_2("Mandatory","1")),this.oCombo.SelectedValue="3"),this.ReorderQty=this.ScreenObject.GetQuickTextBoxWithCombo(277),null!=this.ReorderQty&&(this.ReorderQty.Items.push(h._p.ComboBoxItems_2("Value","0")),this.ReorderQty.Items.push(h._p.ComboBoxItems_2("Percentage","1")),this.ReorderQty.SelectedValue="0"),this.ReorderTrigger=this.ScreenObject.GetQuickTextBoxWithCombo(11496),null!=this.ReorderTrigger&&(this.ReorderTrigger.Items.push(h._p.ComboBoxItems_2("Value","0")),this.ReorderTrigger.Items.push(h._p.ComboBoxItems_2("Percentage","1")),this.ReorderTrigger.SelectedValue="0"),this.UOM=this.ScreenObject.GetQuickUom(268),null!=this.UOM&&(this.ScreenObject.Data.Tables[13].forEach(t=>{this.UOM.Items.push(h._p.ComboBoxItems_2(t.UnitName.toString(),t.UOMID.toString()))}),this.UOM.Items.push(h._p.ComboBoxItems_2("Product-Wise","-399")),this.UOM.SelectedValue=this.UOM.DefaultValue),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>15&&this.ScreenObject.Data.Columns[15].Contains("IsParentCodeInherited")&&this.ScreenObject.Data.Tables[15].length>0&&this.ScreenObject.InitAutoCode(this.ScreenObject.Data.Tables[15],this.oProduct.IsGroup);let o=this.ScreenObject.Data.Tables[10].filter(t=>t.Name==(this.oProduct.IsGroup?"GroupNameSameasCode":"NameSameasCode"));null!=o&&o.length>0&&(0,b.yG0)(o[0].Value)?(this.NameSameasCode=!0,null!=this.Name&&(this.Name.Enable=!1)):(this.NameSameasCode=!1,null!=this.Name&&(this.Name.Enable=!0))}LoadUnitsProductWise(e){}AutoGenerateCode(){let e=this.ScreenObject.Data.Tables[10].filter(i=>"CodeCapsLock"==i.Name);if(null!=this.Code&&(e.length>0&&(0,b.yG0)(e[0].Value)&&(this.Code.IsAllCaps=!0),e=this.ScreenObject.Data.Tables[10].filter(i=>"CodeCapsToFirstLetter"==i.Name),null!=this.Code&&e.length>0&&(0,b.yG0)(e[0].Value)&&(this.Code.IsFirstLetterCaps=!0),e=this.ScreenObject.Data.Tables[10].filter(i=>"CodeIgnoreSpaces"==i.Name),e.length>0&&(0,b.yG0)(e[0].Value)&&(this.Code.IgnoreSpaces=!0)),e=this.ScreenObject.Data.Tables[10].filter(i=>i.Name==(this.oProduct.IsGroup?"GroupNameSameasCode":"NameSameasCode")),e.length>0&&(0,b.yG0)(e[0].Value)?(this.NameSameasCode=!0,null!=this.Name&&(this.Name.Enable=!1)):(this.NameSameasCode=!1,null!=this.Name&&(this.Name.Enable=!0)),0==this.NodeID&&null!=this.BarCode&&this.IsAutoBarCode&&(this.BarCode.Text=this.oProduct.GetAutoBarcode()),0==this.NodeID&&null!=this.Code?(null!=this.ProductGroup&&null!=this.ProductGroup.SelectedValue&&(this.ParentId=this.ProductGroup.SelectedValue),this.ScreenObject.SetAutoCode(this.Code,this.oProduct.IsGroup,this.ParentId,this.ScreenObject.Data.Tables[15]),this.OnTextChanged("")):this.ScreenObject.GetCodeParams(this.ScreenObject.Data.Tables[15]),null!=this.Name){let i=this.ScreenObject.Data.Tables[10].filter(o=>"CapsLock"==o.Name);if(i.length>0&&(0,b.yG0)(i[0].Value)&&(this.Name.IsAllCaps=!0),i=this.ScreenObject.Data.Tables[10].filter(o=>"CapsToFirstLetter"==o.Name),i.length>0&&(0,b.yG0)(i[0].Value)&&(this.Name.IsFirstLetterCaps=!0),i=this.ScreenObject.Data.Tables[10].filter(o=>"IgnoreSpaces"==o.Name),i.length>0&&(0,b.yG0)(i[0].Value)&&(this.Name.IgnoreSpaces=!0),null!=this.ScreenObject.Data.Tables[10]){if(i=this.ScreenObject.Data.Tables[10].filter(o=>"ProductName"==o.Name),i.length>0&&""!=i[0].Value.toString()&&(this.LinkColumnCostcenterID=parseInt(i[0].Value),this.ScreenObject.LinkColumnCostcenterID=this.LinkColumnCostcenterID,this.LinkColumnCostcenterID>0)){if(null!=this.ScreenObject.Data.Tables[12]&&this.ScreenObject.Data.Tables[12].length>0){let o=this.ScreenObject.Data.Tables[12].filter(t=>t.FeatureID==this.LinkColumnCostcenterID);o.length>0&&!l.J0.StringIsNullOrEmpty(o[0].NAME)&&0==this.NodeID&&(this.Name.Text=o[0].NAME.toString())}this.Name.Enable=!1}(-1==this.LinkColumnCostcenterID||0==this.LinkColumnCostcenterID)&&(i=this.ScreenObject.Data.Tables[10].filter(o=>o.Name==(this.oProduct.IsGroup?"GroupNameSameasCode":"NameSameasCode")),i.length>0&&(0,b.yG0)(i[0].Value)?this.Name.Enable=!1:this.ScreenObject.IsAutoName?(this.ScreenObject.IsNameAutoGenerate=!0,this.Name.Enable=!1):(this.ScreenObject.IsNameAutoGenerate=!1,this.Name.Enable=!0))}}let r=this.ScreenObject.GetQuickCombo(264);if(null!=r&&0==this.NodeID){let i=this.ScreenObject.Data.Tables[10].filter(o=>"DefaultProductType"==o.Name);i.length>0&&""!=i[0].Value.toString()&&(r.SelectedValue=i[0].Value.toString())}if(null!=this.UOM&&null!=this.UOM&&null!=this.ScreenObject.Data.Tables[10]&&0==this.NodeID){let i=this.ScreenObject.Data.Tables[10].filter(o=>"DefaultUOM"==o.Name);i.length>0&&""!=i[0].Value.toString()&&(this.UOM.SelectedValue=i[0].Value.toString())}}OnTextChanged(e){null!=this.Name&&null!=this.Name&&(!this.NameSameasCode||this.Code.PrefixVisibility||this.Code.SuffixVisibility?this.NameSameasCode&&this.Code.PrefixVisibility&&this.Code.SuffixVisibility&&this.Code.Enable?this.Name.Text=this.Code.PrefixCode+this.Code.SuffixCode:this.NameSameasCode&&this.Code.PrefixVisibility&&!this.Code.SuffixVisibility?this.Name.Text=this.Code.PrefixCode+this.Code.Text:this.NameSameasCode&&!this.Code.PrefixVisibility&&this.Code.SuffixVisibility&&(this.Name.Text=this.Code.Text+this.Code.SuffixCode):this.Name.Text=this.Code.Text)}onTextValueChanged(e){let r=0,i=0,o=0;r=l.J0.DoubleTryParse(this.ProductLength.Text),i=l.J0.DoubleTryParse(this.ProductWidth.Text),o=l.J0.DoubleTryParse(this.ProductHeight.Text),this.ProductVolume.Text=(r*i*o).ToString("N"+this.ProductVolume.DecimalPoints)}onLostFocus(e){let r=0;r=l.J0.DoubleTryParse(e.Text),r&&(e.Text=r.ToString("N"+e.DecimalPoints)),this.ScreenObject.onTextBoxLostFocus(e)}FillControls(){if(0!=this.NodeID){this.oProduct.ProductID=this.NodeID;let e=this.oProduct.GetProductDetails();this.QuickAssign.LoadGrid(this.NodeID,e.Tables[11]),null!=this.Code&&(this.Code.Text=this.oProduct.ProductCode,this.Code.Code=this.oProduct.ProductCode,(this.ScreenObject.InheritParentCode||this.ScreenObject.IsAutoCode)&&(this.Code.Enable=parseInt(e.Tables[0][0].Depth)<=1&&!this.ScreenObject.IsRootAutoCode));let r=this.ScreenObject.GetQuickField(281);null!=r&&(r.SelectedValue=this.oProduct.ProductGroup),this.ScreenObject.FillControls(e.Tables[0][0],e.Tables[1][0],e.Tables[7].length>0?e.Tables[7][0]:null,null,e.Tables[19],e.Tables[4]),e.Tables[7].length>0&&this.ScreenObject.LoadCustomFieldsCCData(e.Tables[7],e.Tables[19]),this.ScreenObject.CanApprove(e.Tables[0][0],e.Tables[16][0],this.ButtonSave),null!=this.ScreenObject.StatusAssignGrid&&this.ScreenObject.StatusAssignGrid.Load(e.Tables[20]),this.AddCCFieldsSelectionChange(),this.AutoGenerateCode(),e.Tables.length>13&&null!=this.UOM&&e.Tables[13].length>0&&(this.UOM.SelectedValue="-399",this.UOM.DefaultValue=e.Tables[0][0].UOMID.toString());let o=e.Tables[4].filter(t=>1==t.IsProductImage);o.length>0?this.FileID=parseInt(o[0].FileID):this.InheritImage?this.FileID=0:(this.FileID=0,this.InheritGrpImage?this.OnLoadImage("Group",this.ProductGroup.SelectedValue):this.OnLoadImage("Dimension",this.GetImageCCVal())),c.d.SessionManager.IsOffline&&this.NodeID>0&&(this.ButtonSave.Visible=!1)}else this.AutoGenerateCode(),this.LoadParentData(),this.oProduct.GUID="";this.OnProductTypeChange(null),this.sProdType=this.sBinWise="",l.J0.IsEmpty(this.ProductType)||(this.sProdType=this.ProductType.SelectedValue),l.J0.IsEmpty(this.BinWise)||(this.sBinWise=this.BinWise.SelectedValue)}OnLoadImage(e,r){("Group"==e||"Dimension"==e)&&!this.InheritImage&&(null!=this.ScreenObject.Data&&null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>14&&(this.ImageView=this.ScreenObject.Data.Tables[14]),this.InheritGrpImage?this.ImageView=this.ImageView.filter(i=>3==i.FeatureID&&i.FeaturePK==r&&1==i.IsProductImage):this.InheritDimImageID>5e4&&(this.ImageView=this.ImageView.filter(i=>i.FeatureID==this.InheritDimImageID&&i.FeaturePK==r&&1==i.IsProductImage)),this.ImageView.length>0&&(this.isPhotoChanged=!0))}onSaveProduct(e){Logger.InfoLog("QuickAddProductViewModel::Entering onSaveProduct");try{if("Save"==e.toString()||"APPROVE_CALL"==e.toString()){if(0==this.oProduct.ProductID){if(null!=this.Code){let s;s=this.ScreenObject.Data.Tables[15],s=s.filter(n=>0==n.IsName);let a={StrCode:this.oProduct.ProductCode,CodePrefix:this.oProduct.CodePrefix,CodeNumber:this.oProduct.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.ParentId,s,a),this.oProduct.ProductCode=a.StrCode,this.oProduct.CodePrefix=a.CodePrefix,this.oProduct.CodeNumber=a.CodeNumber,this.OnTextChanged(""),this.DisplayMessage.length>0)return}}else if(this.oProduct.ProductID>0&&null!=this.Code){if(this.Code.Enable||this.ScreenObject.CodeSeqExist)null!=this.Code&&(this.oProduct.ProductCode=this.Code.Text);else{let s;s=this.ScreenObject.Data.Tables[15],s=s.filter(n=>0==n.IsName);let a={StrCode:this.oProduct.ProductCode,CodePrefix:this.oProduct.CodePrefix,CodeNumber:this.oProduct.CodeNumber};if(this.DisplayMessage=this.ScreenObject.SetAutoCodeParams_3(this.Code,this.ParentId,s,a),this.oProduct.ProductCode=a.StrCode,this.oProduct.CodePrefix=a.CodePrefix,this.oProduct.CodeNumber=a.CodeNumber,this.OnTextChanged(""),this.DisplayMessage.length>0)return}this.Code.Code=this.Code.Text}if(this.oProduct.ProductName=this.ScreenObject.GetTextComboValue_string(262,"").trim(),null!=this.Name&&this.ScreenObject.IsNameAutoGenerate){let s;if(s=this.ScreenObject.Data.Tables[15],s=s.filter(n=>1==n.IsName),this.ScreenObject.IsName=!0,null!=s&&s.length>0&&(this.Name.Text=this.ScreenObject.SetAutoCodeParams_1(this.Name,this.ParentId,s),this.oProduct.ProductName=this.Name.Text.trim(),null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>9&&!l.J0.StringIsNullOrEmpty(this.ScreenObject.Data.Tables[10].filter(n=>"ShowAutoProductname"==n.Name)[0].Value)&&"TRUE"==this.ScreenObject.Data.Tables[10].filter(n=>"ShowAutoProductname"==n.Name)[0].Value.toString().toUpperCase()&&!confirm('Product Name :: "'+this.Name.Text.trim()+'", Are you sure want to continue with this ProductName.?')))return}let i=this.ScreenObject.ValidateData();if(i.length>0)return this.MessageVisibility=!0,void(this.DisplayMessage=i);if(0==this.oProduct.ProductID){this.oProduct.AliasName=this.ScreenObject.GetTextComboValue_string(263,this.oProduct.ProductName),this.oProduct.ProductType=this.ScreenObject.GetTextComboValue_int(264,1,"ProductTypeID"),this.oProduct.UOM=this.ScreenObject.GetTextComboValue_int(268,1,"UOMID"),this.oProduct.ProductStatus=this.ScreenObject.GetTextComboValue_int(266,31,"StatusID"),this.oProduct.Valuation=this.ScreenObject.GetTextComboValue_int(265,this.DefaultValuation,"ValuationID"),this.oProduct.ProductGroup=this.ScreenObject.GetPactListValue(281,this.ParentId),this.oProduct.Currency=this.ScreenObject.GetTextComboValue_int(269,1,"CurrencyID");let s=1;null!=this.ScreenObject.dsParentData&&this.ScreenObject.dsParentData.Tables.length>0&&!l.J0.StringIsNullOrEmpty(this.ScreenObject.dsParentData.Tables[0][0].ManufacturerBarcode)&&(s=(0,b.yG0)(this.ScreenObject.dsParentData.Tables[0][0].ManufacturerBarcode)?1:0);let a=!1,n=this.ScreenObject.GetTextComboValue_int(50392,s);null!=n&&1===n&&(a=!0),this.oProduct.ManufacturerBarcode=a,s=1,null!=this.ScreenObject.dsParentData&&this.ScreenObject.dsParentData.Tables.length>0&&!l.J0.StringIsNullOrEmpty(this.ScreenObject.dsParentData.Tables[0][0].PrintBarcode)&&(s=(0,b.yG0)(this.ScreenObject.dsParentData.Tables[0][0].PrintBarcode)?1:0),a=!1;let S=this.ScreenObject.GetTextComboValue_int(11394,s);null!=S&&1===S&&(a=!0),this.oProduct.PrintBarcode=a,s=0;let m=this.ScreenObject.Data.Tables[0].filter(d=>270==d.CostCenterColID);if(m.length>0&&!l.J0.IsEmpty(m[0].UserDefaultValue)&&(s=l.J0.Double(m[0].UserDefaultValue)),this.oProduct.SalesAccount=this.ScreenObject.GetPactListValue(270,s,"SalesAccountID"),s=0,m=this.ScreenObject.Data.Tables[0].filter(d=>271==d.CostCenterColID),m.length>0&&!l.J0.IsEmpty(m[0].UserDefaultValue)&&(s=l.J0.Double(m[0].UserDefaultValue)),this.oProduct.PurchaseAccount=this.ScreenObject.GetPactListValue(271,s,"PurchaseAccountID"),s=0,m=this.ScreenObject.Data.Tables[0].filter(d=>272==d.CostCenterColID),m.length>0&&!l.J0.IsEmpty(m[0].UserDefaultValue)&&(s=l.J0.Double(m[0].UserDefaultValue)),this.oProduct.COGSAccount=this.ScreenObject.GetPactListValue(272,s,"COGSAccountID"),s=0,m=this.ScreenObject.Data.Tables[0].filter(d=>273==d.CostCenterColID),m.length>0&&!l.J0.IsEmpty(m[0].UserDefaultValue)&&(s=l.J0.Double(m[0].UserDefaultValue)),this.oProduct.ClosingStockAccount=this.ScreenObject.GetPactListValue(273,s,"ClosingStockAccountID"),this.oProduct.QtyAdjustment=this.ScreenObject.GetTextComboValue_int(274,3,"QtyAdjustType"),l.J0.StringIsNullOrEmpty(this.ScreenObject.Data.Tables[10].filter(d=>"BinsDimension"==d.Name)[0].Value))this.oProduct.BinWise=!1;else{s=0,null!=this.ScreenObject.dsParentData&&null!=this.ScreenObject.dsParentData&&this.ScreenObject.dsParentData.Tables.length>0&&!l.J0.StringIsNullOrEmpty(this.ScreenObject.dsParentData.Tables[0][0].BinWise)&&(s=(0,b.yG0)(this.ScreenObject.dsParentData.Tables[0][0].BinWise)?1:0);let d=!1,T=this.ScreenObject.GetTextComboValue_int(275,0,"BinWise");null!=T&&1===T&&(d=!0),this.oProduct.BinWise=d}this.oProduct.PurchaseRates=this.ScreenObject.GetTextComboValue_double(22820,0,"PurchaseRate"),this.oProduct.PurchaseRateA=this.ScreenObject.GetTextComboValue_double(22786,0,"PurchaseRateA"),this.oProduct.PurchaseRateB=this.ScreenObject.GetTextComboValue_double(22787,0,"PurchaseRateB"),this.oProduct.PurchaseRateC=this.ScreenObject.GetTextComboValue_double(22788,0,"PurchaseRateC"),this.oProduct.PurchaseRateD=this.ScreenObject.GetTextComboValue_double(22789,0,"PurchaseRateD"),this.oProduct.PurchaseRateE=this.ScreenObject.GetTextComboValue_double(22790,0,"PurchaseRateE"),this.oProduct.PurchaseRateF=this.ScreenObject.GetTextComboValue_double(22791,0,"PurchaseRateF"),this.oProduct.PurchaseRateG=this.ScreenObject.GetTextComboValue_double(22792,0,"PurchaseRateG"),this.oProduct.SellingRates=this.ScreenObject.GetTextComboValue_double(22821,0,"SellingRate"),this.oProduct.SellingRateA=this.ScreenObject.GetTextComboValue_double(22793,0,"SellingRateA"),this.oProduct.SellingRateB=this.ScreenObject.GetTextComboValue_double(22794,0,"SellingRateB"),this.oProduct.SellingRateC=this.ScreenObject.GetTextComboValue_double(22795,0,"SellingRateC"),this.oProduct.SellingRateD=this.ScreenObject.GetTextComboValue_double(22796,0,"SellingRateD"),this.oProduct.SellingRateE=this.ScreenObject.GetTextComboValue_double(22797,0,"SellingRateE"),this.oProduct.SellingRateF=this.ScreenObject.GetTextComboValue_double(22798,0,"SellingRateF"),this.oProduct.SellingRateG=this.ScreenObject.GetTextComboValue_double(22799,0,"SellingRateG"),this.oProduct.ProductLength=this.ScreenObject.GetTextComboValue_double(601,0,"Length"),this.oProduct.ProductWidth=this.ScreenObject.GetTextComboValue_double(602,0,"Width"),this.oProduct.ProductHeight=this.ScreenObject.GetTextComboValue_double(603,0,"Height"),this.oProduct.ProductVolume=this.ScreenObject.GetTextComboValue_double(604,0,"Volume"),this.oProduct.ProductWeight=this.ScreenObject.GetTextComboValue_double(605,0,"Weight"),this.oProduct.ProductWastage=this.ScreenObject.GetTextComboValue_double(584,0,"Wastage"),this.oProduct.ProductPacking=this.ScreenObject.GetTextComboValue_int(600,0,"IsPacking"),this.oProduct.ProductBillOfEntry=this.ScreenObject.GetTextComboValue_int(587,0,"IsBillOfEntry"),this.oProduct.ReorderPolicy=this.ScreenObject.GetTextComboValue_int(588,0,"ReorderPolicy"),this.oProduct.MaxInventoryLevel=this.ScreenObject.GetTextComboValue_double(589,0,"MaxInventoryLevel"),this.oProduct.ReorderMinOrderQty=this.ScreenObject.GetTextComboValue_double(590,0,"ReorderMinOrderQty"),this.oProduct.ReorderMaxOrderQty=this.ScreenObject.GetTextComboValue_double(591,0,"ReorderMaxOrderQty"),this.oProduct.ReorderOrderMultiple=this.ScreenObject.GetTextComboValue_double(592,0,"ReorderOrderMultiple"),this.oProduct.PlanningMethod=this.ScreenObject.GetTextComboValue_int(593,0,"PlanningMethod"),this.oProduct.ProcurementMethod=this.ScreenObject.GetTextComboValue_int(594,0,"ProcurementMethod"),this.oProduct.LeadTime=this.ScreenObject.GetTextComboValue_double(597,0,"LeadTime"),this.oProduct.SafetyStock=this.ScreenObject.GetTextComboValue_double(598,0,"SafetyStock"),this.oProduct.ProductBOM=this.ScreenObject.GetPactListValue(599,0,"BOM"),this.oProduct.ReorderLevel=this.ScreenObject.GetTextComboValue_double(276,0,"ReorderLevel"),null!=this.ReorderQty&&null!=this.ReorderQty&&(this.oProduct.ReorderQty=l.J0.DoubleTryParse(this.ReorderQty.Text),this.oProduct.ReorderQtyType=l.J0.IntTryParse(this.ReorderQty.SelectedValue)),null!=this.ReorderTrigger&&null!=this.ReorderTrigger&&(this.oProduct.ReorderTrigger=l.J0.DoubleTryParse(this.ReorderTrigger.Text),this.oProduct.ReorderTriggerType=l.J0.IntTryParse(this.ReorderTrigger.SelectedValue)),this.oProduct.ShelfLife=this.ScreenObject.GetTextComboValue_double(278,0,"ShelfLife"),this.oProduct.Packing=this.ScreenObject.GetTextComboValue_string(279,"0","Packing"),this.oProduct.Barcode=this.ScreenObject.GetTextComboValue_string(280,""),this.oProduct.Category=this.ScreenObject.GetPactListValue(284,0,"CategoryID"),this.oProduct.Department=this.ScreenObject.GetPactListValue(285,0,"DepartmentID"),this.oProduct.Description=this.ScreenObject.GetTextComboValue_string(282,"","Description"),this.oProduct.ProductPacking=this.ScreenObject.GetTextComboValue_int(581,0,"IsWeightable"),this.oProduct.SerialNumber=this.ScreenObject.GetTextComboValue_string(582,"","SerialNumber"),this.oProduct.KitSize=this.ScreenObject.GetTextComboValue_double(583,0,"KitSize"),this.oProduct.MinTolerancePer=this.ScreenObject.GetTextComboValue_double(53726,0,"MinTolerancePer"),this.oProduct.MinToleranceVal=this.ScreenObject.GetTextComboValue_double(53727,0,"MinToleranceVal"),this.oProduct.MaxTolerancePer=this.ScreenObject.GetTextComboValue_double(53586,0,"MaxTolerancePer"),this.oProduct.MaxToleranceVal=this.ScreenObject.GetTextComboValue_double(53587,0,"MaxToleranceVal"),this.oProduct.CreditDays=this.ScreenObject.GetTextComboValue_int(53588,0,"CreditDays"),this.oProduct.PreExpiryDays=this.ScreenObject.GetTextComboValue_int(53585,0,"PreexpiryDays");var r=this.ScreenObject.StaticFields.find(d=>26722==d.DBColumnID);this.oProduct.GroupSeqNoLength=null!=r&&null!=r&&this.oProduct.IsGroup?parseInt(r.Text):0,this.oProduct.LotWise=!1,this.oProduct.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.oProduct.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery(),this.oProduct.ContactsXML="",this.oProduct.NotesXML="",this.GetAttachmentXML(),this.oProduct.AttachmetsXML+=this.ScreenObject.GetExtraAttachmentXML(),this.oProduct.ProductwiseUOM="",this.oProduct.ProductwiseUOM1="";let O={};if(this.DisplayMessage=this.QuickAssign.GetXML(O),!l.J0.StringIsNullOrEmpty(this.DisplayMessage)||(this.oProduct.CCCCMapDATA=O.strXML,this.oProduct.HistoryXML=this.ScreenObject.HistoryCCXML,this.oProduct.StatusXML=null!=this.ScreenObject.StatusAssignGrid?this.ScreenObject.StatusAssignGrid.GetXML():"",!this.ScreenObject.ValidateDataonSave()))return;this.oProduct.WID=this.ScreenObject.CheckWorkFlow(),this.oProduct.IsLink=this.ScreenObject.EvaluateExpression(this.ScreenObject.Data.Tables[10].filter(d=>"LinkDimensionBasedOn"==d.Name)[0].Value.toString(),this.oProduct.IsGroup),this.oProduct.AddProduct("","AddProduct").subscribe(d=>{this.SaveCallBack(d)},d=>{alert(JSON.stringify(d)),console.log("Quick Product Save : "+JSON.stringify(d))})}else{if(c.d.SessionManager.Preferences.ContainsKey("DonotDeActiveProductifBalQtyGreaterthanZero")&&(0,b.yG0)(c.d.SessionManager.Preferences.DonotDeActiveProductifBalQtyGreaterthanZero)&&this.ScreenObject.StaticFields.forEach(a=>{if(a instanceof h.y$&&266==a.DBColumnID&&"32"==a.SelectedValue){let n=c.d.common.GetDataTable("QAPSVM1",this.oProduct.ProductID.toString());if(null!=n&&n.length>0&&(parseFloat(n[0].BalQty)>0&&(this.DisplayMessage="Unable to Inactive the Product, Balance Quantity Exists"),!l.J0.IsEmpty(this.DisplayMessage)))return void(this.MessageVisibility=!0)}}),null!=this.Name&&(this.oProduct.ProductName=this.Name.Text.trim()),this.oProduct.AliasName=this.ScreenObject.GetTextComboValue_string(263,this.oProduct.ProductName),this.oProduct.ProductType=this.ScreenObject.GetTextComboValue_int(264,1),this.oProduct.ProductGroup=this.ScreenObject.GetPactListValue(281,this.ParentId),this.oProduct.QuickStaticFieldsQuery=this.ScreenObject.GetStaticFieldsQuery(),null!=this.ProductType||null!=this.BinWise){let n=c.d.report.ReportDataSet("RPT022",!1,"Select COUNT(InvDocDetailsID) as InvCount From INV_DocDetails WITH(NOLOCK) Where IsQtyIgnored=0 AND ProductID="+this.oProduct.ProductID+"\n                                  Select COUNT(InvDocDetailsID) as InvCount From INV_DocDetails WITH(NOLOCK) Where IsQtyIgnored=1 AND ProductID="+this.oProduct.ProductID);if(null!=this.ProductType&&this.ProductType.SelectedValue!=this.sProdType&&null!=n&&n.Tables.length>0){if(n.Tables[0].length>0&&!l.J0.IsEmpty(n.Tables[0][0].InvCount)&&parseInt(n.Tables[0][0].InvCount.toString())>0){let S=new C.MessageDialogViewModel;return S.MessageDialogViewModel_5("Inventory documents are Posted, changing of Product Type Field is not allowed.","Ok"),void c.d.page.ShowDialog(S,f.MessageDialogViewModelComponent,{ShowCenter:!0,Title:c.d.GetResource("Warning")})}if(n.Tables[1].length>0&&!l.J0.IsEmpty(n.Tables[1][0].InvCount)&&parseInt(n.Tables[1][0].InvCount.toString())>0){if("3"==this.sProdType||"7"==this.sProdType||"8"==this.sProdType||"9"==this.sProdType||"11"==this.sProdType||"12"==this.sProdType){let S=new C.MessageDialogViewModel;return S.MessageDialogViewModel_5("Non-inventory documents are Posted, changing of Product Type Field is not allowed for this Product.","Ok"),void c.d.page.ShowDialog(S,f.MessageDialogViewModelComponent,{ShowCenter:!0,Title:c.d.GetResource("Warning")})}if(!confirm("Non-inventory documents are Posted, Do you want to Proceed to changing of Product Type Field.?"))return}}if(null!=this.BinWise&&this.BinWise.SelectedValue!=this.sBinWise&&null!=n&&n.Tables.length>0){if(n.Tables[0].length>0&&!l.J0.IsEmpty(n.Tables[0][0].InvCount)&&parseInt(n.Tables[0][0].InvCount.toString())>0){let S=new C.MessageDialogViewModel;return S.MessageDialogViewModel_5("Inventory documents are Posted, changing of Bin wise Field is not allowed.","Ok"),void c.d.page.ShowDialog(S,f.MessageDialogViewModelComponent,{ShowCenter:!0,Title:c.d.GetResource("Warning")})}if(n.Tables[1].length>0&&!l.J0.IsEmpty(n.Tables[1][0].InvCount)&&parseInt(n.Tables[1][0].InvCount.toString())>0&&!confirm("Non-inventory documents are Posted, Do you want to Proceed to changing of Bin wise Field.?"))return}}this.oProduct.CustomFieldsQuery=this.ScreenObject.GetQuickExtraFieldsQuery(),this.oProduct.CustomCostCenterFieldsQuery=this.ScreenObject.GetQuickExtraCCFieldsQuery();let s={};if(this.DisplayMessage=this.QuickAssign.GetXML(s),!l.J0.StringIsNullOrEmpty(this.DisplayMessage)||(this.oProduct.CCCCMapDATA=s.strXML,this.oProduct.HistoryXML=this.ScreenObject.HistoryCCXML,this.oProduct.StatusXML=null!=this.ScreenObject.StatusAssignGrid?this.ScreenObject.StatusAssignGrid.GetXML():"",this.GetAttachmentXML(),this.oProduct.AttachmetsXML+=this.ScreenObject.GetExtraAttachmentXML(),!this.ScreenObject.ValidateDataonSave()))return;this.oProduct.WID=this.ScreenObject.CheckWorkFlow(),this.oProduct.IsLink=this.ScreenObject.EvaluateExpression(this.ScreenObject.Data.Tables[10].filter(a=>"LinkDimensionBasedOn"==a.Name)[0].Value.toString(),this.oProduct.IsGroup),this.oProduct.AddProduct("","SetProductQuick").subscribe(a=>{this.SaveCallBack(a)},a=>{alert(JSON.stringify(a)),console.log("Quick Product Save : "+JSON.stringify(a))})}}else if("Details"==e.toString())c.d.page.ShowLoading=!0,setTimeout(()=>{c.d.page.HideDialog(this.PopUpGUID);let i="";i=c.d.GetResource(0==this.oProduct.ProductID?"Product_NewScreenName":"Product_EditScreenName");let o=new G.AddProductScreenViewModel(this.NodeID,this.ScreenName,this.ParentId,this.oProduct.IsGroup),t={obj:o};null!=this.Name&&(o.ProductName.Text=this.Name.Text),null!=this.Code&&(o.ProductCode.Text=this.Code.Text,o.ProductCode.PrefixCode=this.Code.PrefixCode),o.OnGroupSelectionChanged("Group"),o.ScreenObject.CopyQuickToDetail(this.ScreenObject.QuickAddFields,[null!=this.Code?this.Code.DBColumnID:0,null!=this.Name?this.Name.DBColumnID:0]),o.OnTypeChanged(),null!=o.DimFields&&o.DimFields.length>0&&(o.SetViewByType(),o.SetFieldsposition()),c.d.page.addNewTab({title:i,component:y.AddProductComponent,params:t})},50);else if("Cancel"==e.toString())c.d.page.HideDialog(this.PopUpGUID);else if("ApproveMaster"==e.toString()){let i=new E.i(3,this.oProduct.ProductID,this.ScreenObject,this);c.d.page.ShowDialog(i,L.R,{ShowCenter:!0,Title:c.d.GetResource("ApproveReject")})}Logger.InfoLog("QuickAddProductViewModel::Exiting onSaveProduct")}catch(i){Logger.ErrorLog("QuickAddProductViewModel:: onSaveProduct"+i.stack)}}SaveCallBack(e){e.Message&&(this.MessageVisibility=!0,this.DisplayMessage=e.Message,this.RetValue=e.RetValue,(this.RetValue>0||this.RetValue<-1e4)&&(this.sProdType="",this.sBinWise="",this.NodeID=0,this.oProduct.ProductID=0,this.QuickAssign.Clear(),this.ScreenObject.Clear(),null!=this.Code&&(this.Code.Text=""),this.Title=this.oProduct.IsGroup?"Add Group":c.d.GetResource("Product_QuickAdd"),this.AutoGenerateCode(),this.LoadParentData(),null==this.Parent||null==this.Parent?c.d.page.HideDialog(this.PopUpGUID):(null!=this.Parent.SelectedNode&&(this.Parent.obj.SetFocusNodeID=this.Parent.SelectedNode.Id),this.Parent.Refresh(),this.Parent.AddEditProductVisibility=!0)))}GetAttachmentXML(){this.InheritImage||!this.isPhotoChanged&&this.FileID>0?this.oProduct.AttachmetsXML="":(null!=this.ScreenObject.Data&&null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>14&&(this.ImageView=this.ScreenObject.Data.Tables[14]),this.InheritGrpImage?this.ImageView=this.ImageView.filter(e=>3==e.FeatureID&&e.FeaturePK==this.oProduct.ProductGroup&&1==e.IsProductImage):this.InheritDimImageID>5e4&&(this.ImageView=this.ImageView.filter(e=>e.FeatureID==this.InheritDimImageID&&e.FeaturePK==this.GetImageCCVal()&&1==e.IsProductImage)),this.ImageView.length>0?l.J0.GetPath(this.ImageView[0].GUID.toString()+"."+this.ImageView[0].FileExtension.toString()):this.oProduct.AttachmetsXML="")}GetImageCCVal(){return this.ScreenObject.StaticFields.forEach(r=>r instanceof P.y$&&r.DBColumnName.toUpperCase().startsWith("CCNID")&&r.CCID==this.InheritDimImageID?r.SelectedValue:r),0}OnNameLostFocus(e){if(!l.J0.StringIsNullOrEmpty(this.Name.Text)){let r=c.d.accounting.CheckDuplicateName(3,this.NodeID,this.Name.Text,0,this.oProduct.IsGroup);r.length>0&&(this.DisplayMessage=r)}this.ScreenObject.onTextBoxLostFocus(e)}OnGroupSelectionChanged(e){this.ProductGroup.SelectedValue>0&&(this.ProductGroup.DefaultValue=this.ProductGroup.SelectedValue.toString(),this.AutoGenerateCode(),this.LoadParentData()),this.InheritGrpImage&&this.OnLoadImage("Group",this.ProductGroup.SelectedValue)}OnProductTypeChange(e){null!=this.ProductType&&this.ScreenObject.SetViewByType(this.ProductType.SelectedValue,this.oProduct.IsGroup)}ParentCallBack(e){null!=e.SelectedNode&&e.PickerType.startsWith("PRODUCTGROUPS")&&(this.ProductGroup.SelectedValue=e.SelectedNode.Id,this.ProductGroup.DefaultValue=this.ProductGroup.SelectedValue.toString())}AddCCFieldsSelectionChange(){this.ScreenObject.StaticFields.forEach(e=>{e instanceof P.y$&&e.CCID==this.InheritDimImageID&&e.SelectionChangedCommand.Subscribe(this,"OnccChanged")})}OnccChanged(e){null!=e&&null!=e&&e instanceof P.y$&&e.SelectedValue>1&&e.CCID==this.InheritDimImageID&&this.OnLoadImage("Dimension",e.SelectedValue)}LoadParentData(){if(this.ScreenObject.dsParentData=null,0!=this.NodeID||0==this.ParentId||this.oProduct.IsGroup)return;let e=this.ScreenObject.Data.Tables[10].filter(i=>"Copygroupdatatonode"==i.Name);0!=e.length&&l.J0.StringIsNullOrEmpty(e[0].Value)&&(0,b.yG0)(e[0].Value)&&(this.ScreenObject.dsParentData=this.oProduct.GetCopyProductDetails(this.ParentId),0!=this.ScreenObject.dsParentData.Tables[0].length?this.ScreenObject.FillParentData(this.ScreenObject.dsParentData.Tables[0][0],this.ScreenObject.dsParentData.Tables[1][0],this.ScreenObject.dsParentData.Tables[7][0],["ProductCode","ProductName","ProductGroup"]):this.ScreenObject.dsParentData=null)}}}}]);