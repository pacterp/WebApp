"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[5152],{85152:(De,oe,$)=>{$.r(oe),$.d(oe,{DocClass:()=>K,IPrefetchFilter:()=>k});var N=$(32040),C=$(43767),q=$(26336),Z=$(54581),Ce=$(98580),z=$(54047),U=$(89731),te=$(95083);class K{constructor(){this.ParentDocID=0,this.IsInventory=!1,this.IsDebit=!0,this.ShowAccountingData=!0,this.dvCommon=null,this.dvCommonTable=null,this._DocID=0,this.AbsDocID=0}get DocID(){return this._DocID}set DocID(t){this._DocID=t,this.AbsDocID=t<0?-t:t}Clone(){let t=new K;return t.DocID=this.DocID,t.AbsDocID=this.AbsDocID,t.ParentDocID=this.ParentDocID,t.IsInventory=this.IsInventory,t.IsDebit=this.IsDebit,t.dvCommon=this.dvCommon,t}}class k extends Ce.g{constructor(){super(...arguments),this._ShowFilter=!1,this._ShowStaticFilter=!1,this._ShowReport=!1,this._ReportVisibility=!0,this.IsSSRS=!1,this.SSRSVisibility=!1,this.SSRSReportName="",this.ShowRightPanel=!0,this._ShowMasters=!1,this._ShowPrintDesigner=!1,this._ShowOptions=!1,this.Filter=null,this.FieldsDialog=null,this.oReportDialog=null,this.Entities=new q.bT,this.BaseReportColumns=[],this.ReportGroups=[],this.FormulaObjects=[],this.StaticReportType=0,this.CostCenterID=0,this.IgnoreTreeLoad=!1,this.DontApplyDateFilter=!1,this.RepeatOn="",this.RepeatStartIndex=-1,this.RepeatNextCols=0,this.RepeatSets=0,this.RepeatEmptyColumns=0,this.RepeatPrevData=0,this.RepeatPrevNextCols=1,this.RepeatType=z.b2.None,this.RepeatShowPrevMn=!1,this.RepeatPrevDataFull=!1,this.RepeatPrevDiff=!1,this.RepeatPrevPercent=!1,this.RepeatPrevDataSeperately=!1,this.RepeatPrevDataOfCurrYr=!1,this.isFromBE=!1,this.PrevDateColumsUsed=!1,this.LevelTreeCostCenterID=0,this.ExQCnt=0,this.LevelColumn=null,this.LevelSubGroup="",this.ReportViewType=z.Zv.General,this.IsPreProcessQuery=!1,this.IsPreProcessQueryClick=!1,this.IsInventory=!0,this.IsHistory=!1,this.IsRevision=!1,this.iHistoryStatusID=0,this.strHistorySepChar="",this.FileProtection="",this.LinkSubCCID=0,this.LinkSubVoucherNo="",this.IsOrderByGroupFields=!0,this.IsBudgetFound=!1,this.IsBudgetNewFound=!1,this.IsAuthLevelReport=!1,this.IsNoDataGroups=!1,this.IsSummaryReportType=!1,this.IsKANBAN=!1,this.IsOpeningStockExists=!1,this.IsClosingStockExists=!1,this.IsAvgRateExists=!1,this.ShowUnAppDocsToApprove=!1,this.ShowUnAppDocsToApprove_UseFuncCall=!1,this.ShowMyUnAppDocsToBeApproved=!1,this.UnPostedDocsInclude=!1,this.UnPostedDocsReserveQtyInclude=!1,this.UnPostedDocsHoldQtyInclude=!1,this.IncludeUnPostedDocsReserveQty=!1,this.IncludeUnPostedDocsHoldQty=!1,this.PDCInclude=!1,this.ShowOnlyAccountingData=!1,this.ShowDebitCreditAmount=!1,this.IsNewFromClause=!0,this.IncludeNonAccDocs=null,this.UnPostedDocsList="",this.RowFiltersXML="",this.RowFiltersWhere="",this.dtLWApproval=null,this.sbQuery="",this.sbFinalQuery="",this.DocumentFiltersIDs=new q.bT,this.DocumentFiltersText=new q.bT,this.DocumentFilters=new q.bT,this.DocumentCCFilters=new q.bT,this.SelectTag="",this.DbSelectTag="",this.FromTag="",this.FromTagExtra="",this.WhereTag="",this.OrderByTag="",this.SelectTagAliasOnly="",this.FinalQuery="",this.GroupSelectTag="",this.DbGroupSelectTag="",this.GroupFromTag="",this.GroupSelectTagAlias="",this.SummarySELECT="",this.SummaryGROUPBY="",this.DocumentFields=[135,185,23144,23145,23146,23147,23148,24500,24501,23149,23826,26583,23831,11364,11365,480020,480021,480022,480023,11375,11490,11405,11505,11516,11426,11683,11643],this.InvDocumentFields=[23150,23822,23823,23824,26250,21356,21357,25523,11371,11372,11373,11374,11383,11384,11403,11404,11484,13964,11491,11514,164,165,166,167,11361,11415,27266,182,11676,11677,11686,11494,11956],this.AccDocumentFields=[186,23825,23827,23828,23829,23830,11366,11367,11416,11417,205,206,11493],this.IgnoreObjectsForFields=[26648,11396,101,189,11509,11510,11511,11512,11513,26419,26420,50453,11515,11691,11692,170,181,182,209,11377,11378,11379,11380,214,26426],this.ReportParams=new q.bT,this.Report=null,this.ParentReport=null,this.ReportViewFrom=null,this.ReportViewFromReorder=null,this.MRPFilter=null,this.MRPII=null,this.BulkEdit=null,this.PrefetchReportTreeFilter=null,this.IncludeLFTColumn=[],this.earningfields=null,this.Vacationfields=null,this.EmpAsonDate=null,this.evalCheck=null,this.fldCheck=null,this.strHideBiddingPriceVoucher=""}get ShowFilter(){return this._ShowFilter}set ShowFilter(t){t!=this._ShowFilter&&(t?(this.ShowReport=!1,this.ShowStaticFilter=!1,this.ShowPrintDesigner=!1,this.ShowOptions=!1):null!=this.PrefetchReportTreeFilter&&(this.PrefetchReportTreeFilter.ReportWidth="480",this.PrefetchReportTreeFilter.ReportHeight="430"),this._ShowFilter=t)}get ShowStaticFilter(){return this._ShowStaticFilter}set ShowStaticFilter(t){t!=this._ShowStaticFilter&&(t?(this.ShowFilter=!1,this.ShowReport=!1,this.ShowPrintDesigner=!1,this.ShowOptions=!1):null!=this.PrefetchReportTreeFilter&&(this.PrefetchReportTreeFilter.ReportWidth="480",this.PrefetchReportTreeFilter.ReportHeight="430"),this._ShowStaticFilter=t)}get ShowReport(){return this._ShowReport}set ShowReport(t){t!=this._ShowReport&&(t&&(this.ShowFilter=!1,this.ShowStaticFilter=!1,this.ShowPrintDesigner=!1,this.ShowOptions=!1,this.ShowMasters=!1,this.IsSSRS?(this.ReportVisibility=!1,this.SSRSVisibility=!0,this.ShowRightPanel=!1):this.ReportVisibility=!0,this.Chart&&this.Chart.RefreshChart()),this._ShowReport=t)}get ReportVisibility(){return this._ReportVisibility}set ReportVisibility(t){t!=this._ReportVisibility&&(t&&(this.ShowMasters=!1),this._ReportVisibility=t)}get ShowMasters(){return this._ShowMasters}set ShowMasters(t){t!=this._ShowMasters&&(t&&(this.ReportVisibility=!1),this._ShowMasters=t)}get ShowPrintDesigner(){return this._ShowPrintDesigner}set ShowPrintDesigner(t){}get ShowOptions(){return this._ShowOptions}set ShowOptions(t){t!=this._ShowOptions&&(t&&(this.ShowFilter=!1,this.ShowReport=!1,this.ShowStaticFilter=!1,this.ShowPrintDesigner=!1),this._ShowOptions=t)}static{this.dtExDocs=new q.G9}static{this.ForeignMAPTables=["COM_ADDRESS","CRM_ACTIVITIES","CRM_FEEDBACK","COM_NOTES","CRM_LEADCVRDETAILS","COM_CONTACTS"]}static{this.HistoryTables=new q.G9}static{this.IgnoreFormulas=["FOR_PERIOD","AFTER_PERIOD"]}static IPrefetchFilter(){k.HistoryTables.push(11375,["INV_DocDetails","ACC_DocDetails","COM_DocCCData","COM_DocNumData","COM_DocTextData"]),k.HistoryTables.push(11490,["INV_DocDetails","ACC_DocDetails","COM_DocCCData","COM_DocNumData","COM_DocTextData"]),k.HistoryTables.push(53517,["REN_Contract","REN_ContractExtended","REN_ContractParticulars","REN_ContractPayTerms"]),k.HistoryTables.push(11418,["ACC_Accounts","ACC_AccountsExtended"]),k.HistoryTables.push(11419,["INV_Product","INV_ProductExtended"]),k.HistoryTables.push(11684,["PRD_BillOfMaterial","PRD_BillOfMaterialExtended","PRD_BOMProducts","PRD_BOMResources","PRD_BOMStages"]),k.HistoryTables.push(191,["ADM_Users"]),k.HistoryTables.push(11701,["COM_Division","COM_CCCCDATA"]),k.HistoryTables.push(11702,["COM_Location","COM_CCCCDATA"]),k.HistoryTables.push(11703,["COM_Branch","COM_CCCCDATA"]),k.HistoryTables.push(11704,["COM_Department","COM_CCCCDATA"]),k.HistoryTables.push(11705,["COM_Salesman","COM_CCCCDATA"]),k.HistoryTables.push(11706,["COM_Category","COM_CCCCDATA"]),k.HistoryTables.push(11707,["COM_Area","COM_CCCCDATA"]),k.HistoryTables.push(11708,["COM_Teritory","COM_CCCCDATA"]),k.HistoryTables.push(11751,["COM_CC50051","COM_CCCCDATA"]),k.HistoryTables.push(12109,["PAY_EmpPay"]),k.HistoryTables.push(11951,["PAY_EmpDetail"]),k.HistoryTables.push(11952,["PAY_EmpDetail"]),k.HistoryTables.push(11953,["PAY_EmpDetail"]),k.HistoryTables.push(11954,["PAY_EmpDetail"]),k.HistoryTables.push(11955,["PAY_EmpDetail"])}SetQueryXMLTags(t=""){let e=0,m=0;this.IsHistory=!1,this.IsAuthLevelReport=!1,this.IsBudgetNewFound=!1,this.IsNoDataGroups=!1,this.LevelColumn=null;let o=null,r="",M="";this.SelectTag=this.FromTag=this.WhereTag=this.OrderByTag=this.SelectTagAliasOnly="",this.GroupSelectTag=this.GroupFromTag=this.GroupSelectTagAlias="",this.SummarySELECT=this.SummaryGROUPBY="",this.Entities=new q.bT,this.Objects=[];let T=[];if(this.sbFinalQuery="",this.ReportParams.Clear(),this.fldCheck=null,null!=this.ParentReport&&this.ApplyParentReportFilters(),"ReportViewModel"==this.ClassName&&(this.Report=this,this.Report.SetDatePickers(),this.Report.Preferences.ContainsKey("IsKANBAN")&&(this.IsKANBAN=!0),this.ReportViewType==z.Zv.ExternalQuery))return void(this.FinalQuery=this.Report.Reportds.Tables[0][0].Query.toString());if(this.FormulaObjects.Clear(),this.BaseReportColumns.forEach(l=>{l.CDGDO.Formula=l.Formula.Text,l.FormulaExpression="",l.ColumnFilterExpression="",l.FormulaErrorMessage="",C.J0.IsEmpty(l.Formula.Text)||this.ParseFormula(l,!0),""==l.FormulaErrorMessage&&!C.J0.IsEmpty(l.Expression.Text)&&this.ParseFormula(l,!1),11406==l.CDGDO.FieldValue||11408==l.CDGDO.FieldValue||l.CDGDO.FieldValue>=11485&&l.CDGDO.FieldValue<=11489?this.IsBudgetNewFound=!0:181==l.CDGDO.FieldValue&&(l.CDGDO.Formula=l.FormulaEvaluateAtEnd.SelectedValue)}),this.ReportGroups.forEach(l=>{l.CDGDO.Formula=l.Formula.Text,l.FormulaExpression="",l.ColumnFilterExpression="",l.FormulaErrorMessage="",C.J0.IsEmpty(l.Formula.Text)||this.ParseFormula(l,!0)}),0!=this.StaticReportType&&110!=this.StaticReportType&&144!=this.StaticReportType){try{-1==this.StaticReportType?this.SetQueryXMLTagsForQueryReports():this.SetQueryXMLTagsForStaticReports()}catch(l){Logger.ErrorLog("SetQueryXMLTagsForStaticReports/SetQueryXMLTagsForQueryReports :: "+l.stack)}return}if(0==this.StaticReportType&&this.IsPreProcessQuery&&!this.IsPreProcessQueryClick)return void this.SetQueryXMLTagsForPreProcessQuery();let A,D=[];for(this.BaseReportColumns.forEach(l=>{0!=l.CDGDO.FieldValue&&(C.J0.IsEmpty(l.Formula.Text)||188==l.CDGDO.FieldValue||"$TOTALHOURS$"==l.Formula.Text||"H"==l.Formula.Text)&&D.push(l.CDGDO)}),this.ReportGroups.forEach(l=>{C.J0.IsEmpty(l.Formula.Text)&&D.push(l.CDGDO)}),D.AddRange(this.FormulaObjects),this.Filter.Fields.forEach(l=>{D.push(l.CDGDO)}),this.earningfields=D.filter(l=>(50051==l.CategoryValue||l.CategoryValue>=40051&&l.CategoryValue<=40099&&40064!=l.CategoryValue)&&(405==l.ColumnCostCenterID||406==l.ColumnCostCenterID||407==l.ColumnCostCenterID||410==l.ColumnCostCenterID)),this.earningfields.length>0&&this.earningfields.forEach(l=>{D.Remove(l)}),this.Vacationfields=D.filter(l=>50051==l.CategoryValue&&411==l.ColumnCostCenterID),this.Vacationfields.length>0&&this.Vacationfields.forEach(l=>{D.Remove(l)}),this.EmpAsonDate=D.filter(l=>50051==l.CategoryValue&&-601==l.FieldValue),this.EmpAsonDate.length>0&&this.EmpAsonDate.forEach(l=>{D.Remove(l)}),D.find(l=>400==l.CategoryValue&&(205==l.FieldValue||206==l.FieldValue||207==l.FieldValue))&&(this.ShowOnlyAccountingData=!0,this.ShowDebitCreditAmount=!0),A=0;A<D.length;A++)if(Math.abs(D[A].CategoryValue)>4e4&&Math.abs(D[A].CategoryValue)<5e4){let l=this.FieldsDialog.DocumentTypes.filter(P=>P.CostCenterID==Math.abs(D[A].CategoryValue));l.length>0&&(this.IsInventory=(0,Z.yG0)(l[0].IsInventory));let b="";if(0==T.filter(P=>P.DocID==D[A].CategoryValue).length)if(D[A].CategoryValue>0){let P=new K;P.DocID=D[A].CategoryValue,P.IsInventory=this.IsInventory,T.push(P)}else b="DocumentType=@DType",C.J0.IsEmpty(D[A].ALLOtherDocuments)||(b="("+b+" or CostCenterID IN ("+D[A].ALLOtherDocuments.Replace("~1","")+"))");else C.J0.IsEmpty(D[A].ALLOtherDocuments)||(b="",D[A].ALLOtherDocuments.Replace("~1","").split(",").forEach(P=>{null==T.find(w=>w.DocID==-parseInt(P))&&(b.length>0&&(b+=","),b+=P)}),b.length>0&&(b=" CostCenterID IN ("+b+")"));if(b.length>0){let P=N.d.report.DataSet("RPT032",Math.abs(D[A].CategoryValue).toString(),b);P.Tables[1].forEach(w=>{if(w.cType){let v=parseInt(w.cType);2==v?w.SysColumnName=w.SysColumnName.toString().Replace("dcNum","dcCalcNum"):3==v&&(w.SysColumnName=w.SysColumnName.toString().Replace("dcNum","dcCalcNumFC"))}}),P.Tables[0].forEach(w=>{let v=parseInt(w.CostCenterID);if(!T.find(f=>f.DocID==v)){let f=new K;f.DocID=v,f.IsInventory=this.IsInventory,f.ParentDocID=D[A].CategoryValue,T.push(f),v!=D[A].CategoryValue&&(T[T.length-1].dvCommonTable=P.Tables[1])}})}}for(let l=0;l<this.Filter.CostCenterFilters.length;l++){let b=this.Filter.CostCenterFilters[l];if(300==b.CostCenterID){if(T.filter(P=>P.DocID<-4e4).length>0&&b.SelectedNodes.length>0)for(let P=T.length-1;P>=0;P--)Math.abs(T[P].DocID)>4e4&&Math.abs(T[P].DocID)<5e4&&0==b.SelectedNodes.filter(w=>w.Id==Math.abs(T[P].DocID)).length&&T.RemoveAt(P);b.SelectedNodes.forEach(P=>{let w=this.FieldsDialog.DocumentTypes.filter(v=>v.CostCenterID==P.Id);if(w.length>0&&(this.IsInventory=(0,Z.yG0)(w[0].IsInventory),0==T.filter(v=>Math.abs(v.DocID)==P.Id).length)){let v=new K;v.DocID=P.Id,v.IsInventory=this.IsInventory,T.push(v)}})}}if(this.ReportViewType==z.Zv.TransactionQuery||this.ReportViewType==z.Zv.LinkingQuery)if("LINKED_SUB_VOUCHERS"==t){this.IsInventory=!0,T.Clear();let l=new K;l.DocID=this.LinkSubCCID,l.IsInventory=this.IsInventory,T.push(l)}else if(null!=this.TQDocumentType&&this.TQDocumentType.SelectedValue>0&&(""==t||"LINKED_VOUCHERS"==t)){let l=this.FieldsDialog.DocumentTypes.filter(P=>P.CostCenterID==this.TQDocumentType.SelectedValue);l.length>0&&(this.IsInventory=(0,Z.yG0)(l[0].IsInventory)),T.Clear();let b=new K;b.DocID=this.TQDocumentType.SelectedValue,b.IsInventory=this.IsInventory,T.push(b)}if(this.ShowOnlyAccountingData&&null!=this.IncludeNonAccDocs)for(let l=T.length-1;l>=0;l--)this.IncludeNonAccDocs.Contains(T[l].DocID.toString())&&T.Remove(T[l]);if(0==T.length)if(this.ShowOnlyAccountingData){let l=new K;l.DocID=-2,l.IsInventory=!1,T.push(l),l=new K,l.DocID=-1,l.IsInventory=!0,T.push(l)}else{if(D.filter(l=>400==l.CategoryValue&&this.InvDocumentFields.Contains(l.FieldValue)).length>0){let l=new K;l.DocID=-1,l.IsInventory=!0,T.push(l)}if(D.filter(l=>400==l.CategoryValue&&this.AccDocumentFields.Contains(l.FieldValue)).length>0){let l=new K;l.DocID=-2,l.IsInventory=!1,T.push(l)}if(D.filter(l=>!this.IgnoreObjectsForFields.Contains(l.FieldValue)&&l.CategoryValue>=400&&l.CategoryValue<=408&&210!=l.FieldValue&&0==T.length).length>0){let l=new K;l.DocID=-1,l.IsInventory=!0,T.push(l),l=new K,l.DocID=-2,l.IsInventory=!1,T.push(l)}if(0==T.length){let l=new K;l.DocID=0,l.IsInventory=!0,T.push(l)}}for(this.ShowOnlyAccountingData&&null!=this.IncludeNonAccDocs&&this.IncludeNonAccDocs.forEach(l=>{let b=new K;b.DocID=parseInt(l),b.IsInventory=!0,b.ShowAccountingData=!1,T.push(b)}),A=0;A<T.length;A++)for(let l=A+1;l<T.length;l++)Math.abs(T[A].DocID)==Math.abs(T[l].DocID)&&(0!=T[l].ParentDocID&&(T[A].DocID=T[l].DocID,T[A].dvCommon=T[l].dvCommon,T[A].dvCommonTable=T[l].dvCommonTable,T[A].ParentDocID=T[l].ParentDocID),T.RemoveAt(l),l--);if(this.ShowDebitCreditAmount)for(A=T.length-1;A>=0;A--)if(T[A].ShowAccountingData){let l=T[A].Clone();l.IsDebit=!1,T.push(l)}this.IsBudgetNewFound&&(m=C.J0.Int(this.Filter.Budget.SelectedValue),o=N.d.report.DataSet("RPT033",m.toString()));try{let l="",b="",P=this.Filter.CostCenterFilters.find(v=>-100==v.CostCenterID);if(P&&P.SelectedNodes.length>0){let v="";for(let G=0;G<P.SelectedNodes.length;G++)G>0&&(v+=","),v+=P.SelectedNodes[G].Id;let f=N.d.report.ReportDataTable("RPT034",null!=this.Report&&this.Report.IsReportDB,v);if(C.J0.IsEmpty(f[0].Job))return void(this.FinalQuery="select 1 where 1!=1");let H=parseInt(f[0].Job);l=f[0].LinkDimension.toString(),H>0&&l.length>0?b="CREATE TABLE #TblJobDim(NodeID BIGINT)\nDECLARE @SQL NVARCHAR(MAX)\nset @SQL='insert into #TblJobDim\nselect "+l+"\nfrom inv_docdetails i with(nolock)\ninner join (select InvDocDetailsID from inv_docdetails with(nolock) where DocID IN ("+v.toString()+")) AS B on i.LinkedInvDocDetailsID=B.InvDocDetailsID\ninner join com_docccdata dcc with(nolock) on dcc.InvDocDetailsID=i.InvDocDetailsID \ngroup by "+l+"'\nEXEC(@SQL)\n":P=null}let w="";if(this.ShowUnAppDocsToApprove){let f=N.d.report.GetReportData(9,this.ShowUnAppDocsToApprove_UseFuncCall?0:1,'<XML UID="'+N.d.SessionManager.UserID+'" ShowMyQueue="'+(this.ShowMyUnAppDocsToBeApproved?"1":"0")+'"></XML>');w=C.J0.String(f.Tables[0][0].Qry)}else if(this.ShowMyUnAppDocsToBeApproved){let v=N.d.report.GetReportData(10,this.ShowUnAppDocsToApprove_UseFuncCall?0:1,N.d.SessionManager.UserID.toString());w=C.J0.String(v.Tables[0][0].Qry)}this.Filter.IsReportViewScreen&&this.Report.Preferences.ContainsKey("FromOldCode")&&(this.IsNewFromClause=!1);for(let v=0;v<T.length;v++){let f=T[v],H=null;this.IsInventory=f.IsInventory,this.SelectTag=this.FromTag=this.FromTagExtra=this.WhereTag=this.OrderByTag=this.SelectTagAliasOnly="",r="",M="",this.ExQCnt=0;let G=[];for(A=0;A<D.length;A++)this.IgnoreObject(f,D[A])||(Math.abs(D[A].CategoryValue)>4e4&&Math.abs(D[A].CategoryValue)<5e4?(Math.abs(D[A].CategoryValue)==Math.abs(f.DocID)||D[A].CategoryValue==f.ParentDocID)&&G.push(D[A]):400==D[A].CategoryValue?this.IsInventory&&!this.AccDocumentFields.Contains(D[A].FieldValue)?(G.push(D[A]),this.DocumentFields.Contains(D[A].FieldValue)&&(D[A].IsForeignKey?D[A].ParentTable="INV_DocDetails":D[A].Table="INV_DocDetails")):!this.IsInventory&&!this.InvDocumentFields.Contains(D[A].FieldValue)&&(G.push(D[A]),this.DocumentFields.Contains(D[A].FieldValue)&&(D[A].IsForeignKey?D[A].ParentTable="ACC_DocDetails":D[A].Table="ACC_DocDetails")):101==D[A].CategoryValue?""==D[A].Column||G.push(D[A]):144==D[A].CategoryValue&&65==D[A].ParentCostCenterID||G.push(D[A]));this.Entities.Clear(),this.Objects.Clear();for(let a=0;a<G.length;a++){let i=G[a];if("Shipping_Address"!=i.Table&&"Billing_Address"!=i.Table&&"Permanent_Address"!=i.Table&&"Contact_Address"!=i.Table)if(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(s=>s.FeatureID==(i.IsForeignKey?i.ParentCostCenterID:i.CategoryValue)),2==i.CategoryValue&&12==i.ColumnCostCenterID?(i.Table="COM_Currency",i.Column="Symbol"):1001==i.ColumnCostCenterID&&(i.Table="COM_Notes",i.Column="Note"),i.CategoryValue>=400&&i.CategoryValue<=408&&!i.IsForeignKey&&(this.drrCCTbl[0].TableName=this.IsInventory?"INV_DocDetails":"ACC_DocDetails"),this.ShowDebitCreditAmount&&f.ShowAccountingData&&207==i.FieldValue&&2==i.ParentCostCenterID&&(i.ParentColumn=f.IsDebit?"DebitAccount":"CreditAccount"),!this.Entities.ContainsKey(i.CategoryText)||null!=i.ChildCDGDO&&!this.Entities.ContainsKey(i.ChildCDGDO.CategoryText)){if(this.drrCCTbl.length>0){if(null!=i.ChildCDGDO){if(i.ChildCDGDO.ColumnCostCenterID>0&&i.ChildCDGDO.ParentTableAlias.Contains("_CCMAP")&&!this.Entities.ContainsKey(i.ChildCDGDO.ParentTableAlias)){let s,E;this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(O=>O.FeatureID==i.ChildCDGDO.CategoryValue),s=C.J0.String(this.drrCCTbl[0].PK),E=this.drrCCTbl[0].TableName.toString(),400==i.CategoryValue&&!this.IsInventory&&"inv_docdetails"==E.toLowerCase()&&(s="AccDocDetailsID",E="ACC_DocDetails");let p=i.ChildCDGDO.CategoryText.substr(0,i.ChildCDGDO.CategoryText.lastIndexOf("."));if(p.Contains(".")&&!this.Entities.ContainsKey(p)){let O=i.CloneObject();O.ChildCDGDO=null,O.ParentCDGDO=null;let W=this.FieldsDialog.FilterView.filter(x=>x.CostCenterColID==i.FieldValue);O.Table=W[0].SysTableName.toString(),O.Column=W[0].SysColumnName.toString(),O.FieldText=W[0].UserColumnName.toString(),O.DataType=W[0].ColumnDataType.toString(),O.ParentCCDefaultColID=parseInt(W[0].ParentCCDefaultColID),W=this.FieldsDialog.FilterView.filter(x=>x.CostCenterColID==O.ParentCCDefaultColID),O.Table=W[0].SysTableName.toString(),O.Column=W[0].SysColumnName.toString(),this.Objects.push(O),this.Entities.push(O.CategoryText,"")}let V=i.ChildCDGDO.CloneObject();V.ColumnCostCenterID=0,V.ParentTableAlias=V.ParentTableAlias.Replace("_CCMAP",""),V.Table=V.ParentTable,V.ParentCostCenterColSysName="NodeID",V.ParentTable=E,V.ParentColumn=s,this.Objects.push(V),this.Entities.push(i.ChildCDGDO.ParentTableAlias,""),this.Objects.push(i.ChildCDGDO),this.Entities.push(i.ChildCDGDO.CategoryText,"")}else this.Entities.ContainsKey(i.CategoryText)||(this.Objects.push(i),this.Entities.push(i.CategoryText,"")),null!=i.ChildCDGDO&&(144!=i.ChildCDGDO.CategoryValue||65!=i.ChildCDGDO.ParentCostCenterID)&&(this.Entities.ContainsKey(i.ChildCDGDO.CategoryText)||(this.Objects.push(i.ChildCDGDO),this.Entities.push(i.ChildCDGDO.CategoryText,"")));continue}if(C.J0.StringValue(this.drrCCTbl[0].TableName).toString()!=i.Table){let s=i.CloneObject();s.ParentCDGDO=null,s.Table=C.J0.StringValue(this.drrCCTbl[0].TableName).toString(),this.Objects.push(s),this.Entities.push(i.CategoryText,""),i.ParentCDGDO=s,this.Objects.push(i),this.Entities.push(i.CategoryText+i.Table,"");continue}}if(i.ColumnCostCenterID>0&&null!=i.ParentTableAlias&&i.ParentTableAlias.Contains("_CCMAP")&&!this.Entities.ContainsKey(i.ParentTableAlias)){let s,E;this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(V=>V.FeatureID==i.CategoryValue),400!=i.CategoryValue||this.IsInventory?(s=C.J0.String(this.drrCCTbl[0].PK),E=C.J0.StringValue(this.drrCCTbl[0].TableName).toString()):(s="AccDocDetailsID",E="ACC_DocDetails");let p=i.CloneObject();if(p.ColumnCostCenterID=0,p.ParentTableAlias=p.ParentTableAlias.Replace("_CCMAP",""),p.Table=p.ParentTable,p.ParentCostCenterColSysName=400==i.CategoryValue||Math.abs(i.CategoryValue)>=40001&&Math.abs(i.CategoryValue)<5e4?s:"NodeID",p.ParentTable=E,p.ParentColumn=s,!this.Entities.ContainsKey(p.ParentTableAlias)){let V=p.CloneObject();V.Table=E,V.ColumnCostCenterID=0,V.CategoryText=p.ParentTableAlias,V.IsForeignKey=!1,this.Objects.push(V),this.Entities.push(p.ParentTableAlias,"")}this.Objects.push(p),this.Entities.push(i.ParentTableAlias,"")}else if(i.IsForeignKey&&!this.Entities.ContainsKey(i.ParentTableAlias)){let s=i.CloneObject();if(400==i.CategoryValue||Math.abs(i.CategoryValue)>=40001&&Math.abs(i.CategoryValue)<5e4)this.Entities.length>0&&210==i.FieldValue||(s.Table=this.IsInventory?"INV_DocDetails":"ACC_DocDetails",s.ColumnCostCenterID=0,s.CategoryText=i.ParentTableAlias,s.IsForeignKey=!1,this.Objects.push(s),this.Entities.push(i.ParentTableAlias,""));else if(k.ForeignMAPTables.Contains(i.Table.toUpperCase())){this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(p=>p.FeatureID==i.CategoryValue),s.Table=s.ParentTable;let E=i.CategoryText.substr(0,i.CategoryText.lastIndexOf("."));s.CategoryText=E,0!=C.J0.stringCompare(s.Table,this.drrCCTbl[0].TableName.toString(),!0)&&(s.ParentCDGDO=this.Objects[this.Entities.keys.indexOf(E)]),s.ColumnCostCenterID=0,s.IsForeignKey=!1,this.Objects.push(s),this.Entities.push(i.ParentTableAlias,"")}else if("CRM_ProductMapping"==i.ParentTable){let E=i.CloneObject();E.ColumnCostCenterID=0,E.Table=E.ParentTable,E.ParentTableAlias=E.ParentTableAlias.Replace("CRM_ProductMapping",""),E.ParentCostCenterColSysName="CCNodeID",89==E.CategoryValue?(E.ParentTable="CRM_Opportunities",E.ParentColumn="OpportunityID"):(E.ParentTable="CRM_Leads",E.ParentColumn="LeadID"),this.Objects.push(E),this.Entities.push(i.ParentTableAlias,"")}else if("REN_QuotationParticulars"==i.ParentTable){let E=i.CloneObject();E.ColumnCostCenterID=0,E.Table=E.ParentTable,E.ParentTableAlias=E.ParentTableAlias.Replace("REN_QuotationParticulars",""),E.ParentCostCenterColSysName="CCNodeID",129==E.CategoryValue&&(E.ParentTable="REN_Quotation",E.ParentColumn="QuotationID"),this.Objects.push(E),this.Entities.push(i.ParentTableAlias,"")}else s.Table=i.ParentTable,s.ColumnCostCenterID=0,s.CategoryText=i.ParentTableAlias,s.IsForeignKey=!1,this.Objects.push(s),this.Entities.push(i.ParentTableAlias,"")}if(this.Objects.push(i),this.Entities.push(i.CategoryText,""),(64==i.ParentCCDefaultColID||65==i.ParentCCDefaultColID)&&!this.Entities.ContainsKey(i.CategoryText+"_MAXMIN")){let s=i.CloneObject();s.DimensionsFilter="MAXMIN",this.Objects.push(s),this.Entities.push(s.CategoryText+"_MAXMIN","")}}else{if(null!=i.ChildCDGDO&&this.Entities.ContainsKey(i.ChildCDGDO.CategoryText))continue;if(this.drrCCTbl.length>0)if(C.J0.StringValue(this.drrCCTbl[0].TableName).toString()!=i.Table){if(i.ParentCDGDO=this.Objects[this.Entities.keys.indexOf(i.CategoryText)],!this.Entities.ContainsKey(i.CategoryText+i.Table)&&(this.Objects.push(i),this.Entities.push(i.CategoryText+i.Table,""),3==i.ColumnCostCenterID&&i.Table.toLowerCase().Contains("extended")&&i.Column.toLowerCase().Contains("alpha")&&i.CategoryValue<400)){let s=i.CloneObject();s.Column="ProductName",s.Table="INV_Product",s.DataType="STRING",s.CategoryText="Product",s.ParentTable="extended",s.ColumnCostCenterID=3,s.ParentColumn=i.Column,s.ParentCostCenterColSysName="ProductID",s.ParentTableAlias=i.CategoryText+i.Table,this.Entities.ContainsKey(i.CategoryText+s.Table)||(this.Objects.push(s),this.Entities.push(i.CategoryText+"INV_Product",""))}}else if(64==i.ParentCCDefaultColID||65==i.ParentCCDefaultColID)this.Entities.ContainsKey(i.CategoryText+"_MAXMIN")||(this.Objects.push(i),i.DimensionsFilter="MAXMIN",this.Entities.push(i.CategoryText+"_MAXMIN",""));else if(599==i.FieldValue){let s="Product";if(i.ParentTableAlias=s,i.Column="BOMName",i.Table="PRD_BillOfMaterial",0!=C.J0.stringCompare(i.Table,this.FieldsDialog.CostCenterTables[0].TableName.toString(),!0)){let E=this.Entities.keys.indexOf(s);-1!=E&&(i.ParentCDGDO=this.Objects[E])}i.ColumnCostCenterID=76,i.IsForeignKey=!1,this.Objects.push(i),this.Entities.ContainsKey("BOM")||this.Entities.push("BOM",""),i.CategoryText=s}}}for(let a=0;a<this.Objects.length;a++){let i=this.Entities.keys[a];if(Math.abs(this.Objects[a].CategoryValue)>4e4&&Math.abs(this.Objects[a].CategoryValue)<5e4||this.Objects[a].CategoryValue>=401&&this.Objects[a].CategoryValue<=408){let s=this.FieldsDialog.DocumentTypes.filter(E=>E.CostCenterID==this.Objects[a].CategoryValue);if(s.length>0&&(this.IsInventory=(0,Z.yG0)(s[0].IsInventory)),this.Objects[a].IsForeignKey)i.endsWith("_CCMAP")&&"COM_DOCCCDATA"==this.Objects[a].Table.toUpperCase()?this.Entities.SetValue(i,"TDCC"):this.Entities.SetValue(i,"T"+a);else if(0==C.J0.stringCompare(C.J0.StringValue(this.Objects[a].Table),"COM_DocNumData",!0)){for(A=0;A<a;A++)if(C.J0.String(this.Entities.keys[A]).endsWith("COM_DocNumData")){this.Entities.SetValue(i,this.Entities.values[A]);break}A==a&&this.Entities.SetValue(i,"T"+a)}else if(0==C.J0.stringCompare(C.J0.StringValue(this.Objects[a].Table),"PAY_DocNumData",!0)){for(A=0;A<a;A++)if(C.J0.String(this.Entities.keys[A]).endsWith("PAY_DocNumData")){this.Entities.SetValue(i,this.Entities.values[A]);break}A==a&&this.Entities.SetValue(i,"T"+a)}else if(0==C.J0.stringCompare(C.J0.StringValue(this.Objects[a].Table),"COM_DocTextData",!0)){for(A=0;A<a;A++)if(C.J0.String(this.Entities.keys[A]).endsWith("COM_DocTextData")){this.Entities.SetValue(i,this.Entities.values[A]);break}A==a&&this.Entities.SetValue(i,"T"+a)}else this.IsInventory?0==C.J0.stringCompare(C.J0.StringValue(this.Objects[a].Table),"INV_DOCDETAILS",!0)?this.Entities.SetValue(i,"INV"):this.Entities.SetValue(i,"T"+a):0==C.J0.stringCompare(C.J0.StringValue(this.Objects[a].Table),"ACC_DOCDETAILS",!0)?this.Entities.SetValue(i,"ACC"):this.Entities.SetValue(i,"T"+a)}else if(400==this.Objects[a].CategoryValue)this.Objects[a].IsForeignKey?i.endsWith("_CCMAP")&&"COM_DOCCCDATA"==this.Objects[a].Table.toUpperCase()?this.Entities.SetValue(i,"TDCC"):this.Entities.SetValue(i,"T"+a):this.IsInventory?(this.Objects[a].Table="INV_DocDetails",this.Entities.SetValue(i,"INV")):(this.Objects[a].Table="ACC_DocDetails",this.Entities.SetValue(i,"ACC"));else if(95==this.Objects[a].CategoryValue)if(0==C.J0.stringCompare(C.J0.StringValue(this.Objects[a].Table),"REN_Contract",!0)){for(A=0;A<a;A++){if(C.J0.String(this.Entities.keys[A]).endsWith("REN_Contract")){this.Entities.SetValue(i,this.Entities.values[A]);break}if(this.Objects[A].Table==this.Objects[a].Table){this.Entities.SetValue(i,this.Entities.values[A]);break}}A==a&&this.Entities.SetValue(i,"T"+a)}else if(0==C.J0.stringCompare(C.J0.StringValue(this.Objects[a].Table),"REN_ContractExtended",!0)){for(A=0;A<a;A++)if(C.J0.String(this.Entities.keys[A]).endsWith("REN_ContractExtended")){this.Entities.SetValue(i,this.Entities.values[A]);break}A==a&&this.Entities.SetValue(i,"T"+a)}else this.Entities.SetValue(i,"T"+a);else this.Entities.SetValue(i,"T"+a)}if(Math.abs(f.DocID)>4e4&&Math.abs(f.DocID)<5e4)if(this.IsInventory){var n=this.Entities.keys.find(a=>C.J0.String(a).endsWith("COM_DocTextData"));M=null!=n&&f.DocID>=40050&&f.DocID<=40199&&40064!=f.DocID?this.Entities[n]+".tCostCenterID="+Math.abs(f.DocID):"INV.CostCenterID="+Math.abs(f.DocID)}else M="ACC.CostCenterID="+Math.abs(f.DocID);if("LINKED_VOUCHERS"==t)this.SelectTag="DISTINCT INV.DocID,INV.CostCenterID,VoucherNo";else{this.sbQuery="",e=0;for(let i=0;i<this.BaseReportColumns.length;i++){let s=this.BaseReportColumns[i];if(!(C.J0.IsEmpty(s.FormulaExpression)||0==C.J0.stringCompare(s.Formula.Text,"LATEST",!0)||0==C.J0.stringCompare(s.Formula.Text,"OLDEST",!0)||0==C.J0.stringCompare(s.Formula.Text,"$TOTALHOURS$",!0)||s.Formula.Text.startsWith("$")&&s.Formula.Text.endsWith("$")||"H"==s.Formula.Text))continue;if(0==s.CDGDO.FieldValue)continue;if(!C.J0.IsEmpty(s.PrevRowValue.SelectedValue))continue;if(this.earningfields.length>0&&this.earningfields.find(p=>p==s.CDGDO))continue;if(this.Vacationfields.length>0&&null!=this.Vacationfields.find(p=>p==s.CDGDO))continue;if(this.EmpAsonDate.length>0&&null!=this.EmpAsonDate.find(p=>p==s.CDGDO))continue;if(e>0&&(this.sbQuery+=","),this.SetActualColumn(s.CDGDO,f,s),11515==s.CDGDO.FieldValue)C.J0.IsEmpty(s.CDGDO.ActualTable)&&(s.CDGDO.ActualTable=this.IsInventory?"INV":"ACC"),this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+s.CDGDO.ActualTable+".CostCenterID AND FeaturePK="+s.CDGDO.ActualTable+".DocID FOR XML PATH('')),1,1,'') "+s.ID+"_ID,",s.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+s.CDGDO.ActualTable+".CostCenterID AND FeaturePK="+s.CDGDO.ActualTable+".DocID FOR XML PATH('')),1,2,'')";else if(s.CDGDO.FieldValue>=11678&&s.CDGDO.FieldValue<=11682)this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+s.CDGDO.CategoryValue+" AND FeaturePK="+s.CDGDO.ActualTable+".NodeID FOR XML PATH('')),1,1,'') "+s.ID+"_ID,",s.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+s.CDGDO.CategoryValue+" AND FeaturePK="+s.CDGDO.ActualTable+".NodeID FOR XML PATH('')),1,2,'')";else if(27291==s.CDGDO.FieldValue||27291==s.CDGDO.ParentCCDefaultColID)this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID=3 AND FeaturePK="+s.CDGDO.ActualTable+".ProductID FOR XML PATH('')),1,1,'') "+s.ID+"_ID,",s.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID=3 AND FeaturePK="+s.CDGDO.ActualTable+".ProductID FOR XML PATH('')),1,2,'')";else if(27290==s.CDGDO.FieldValue||27290==s.CDGDO.ParentCCDefaultColID)this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID=2 AND FeaturePK="+s.CDGDO.ActualTable+".AccountID FOR XML PATH('')),1,1,'') "+s.ID+"_ID,",s.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID=2 AND FeaturePK="+s.CDGDO.ActualTable+".AccountID FOR XML PATH('')),1,2,'')";else if("Attachments"==s.CDGDO.Column)this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+s.CDGDO.CategoryValue+" AND FeaturePK="+s.CDGDO.ActualTable+"."+this.drrCCTbl[0].PK+" FOR XML PATH('')),1,1,'') "+s.ID+"_ID,",s.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+s.CDGDO.CategoryValue+" AND FeaturePK="+s.CDGDO.ActualTable+"."+this.drrCCTbl[0].PK+" FOR XML PATH('')),1,2,'')";else if(50051==s.CDGDO.CategoryValue&&"ServiceDays"==s.CDGDO.Column)this.sbQuery+="(Select ISNULL((DATEDIFF(day,CONVERT(DATETIME,DOJ),GETDATE())+1),0) From COM_CC50051 WITH(NOLOCK) WHERE NodeID="+s.CDGDO.ActualTable+".NodeId ) "+s.ID+"_ID,",s.CDGDO.ActualColumn="(Select ISNULL((DATEDIFF(day,CONVERT(DATETIME,DOJ),GETDATE())+1),0) From COM_CC50051 WITH(NOLOCK) WHERE NodeID="+s.CDGDO.ActualTable+".NodeId )";else if(50051==s.CDGDO.ColumnCostCenterID&&-608==s.CDGDO.ParentCCDefaultColID&&null!=this.Report){if(N.d.SessionManager.Preferences.ContainsKey("PayrollFinancialPostingXml")&&""!=N.d.SessionManager.Preferences.PayrollFinancialPostingXml&&N.d.SessionManager.Preferences.PayrollFinancialPostingXml.length>0){let p=new C.VB;if(p.ReadXml(N.d.SessionManager.Preferences.PayrollFinancialPostingXml),null!=p&&p.Tables.length>0&&p.Tables[0].length>0&&p.Columns[0].Contains("ReportID")){let V=p.Tables[0].filter(O=>O.ReportID==this.Report.ReportID);if(null!=V&&V.length>0)if("Payroll"!=V[0].Type.toString())C.J0.IsEmpty(V[0].ReportColID)||null!=(h=this.BaseReportColumns.find(O=>O.ID==V[0].ReportColID.toString()))&&(this.sbQuery+="(select "+V[0].Provision.toString()+" from PAY_FinancePostings PFP WITH(NOLOCK) WHERE TYPE='"+V[0].Type.toString()+"' AND PFP.ParentRef="+h.CDGDO.ActualColumn+") "+s.ID+"_ID,",s.CDGDO.ActualColumn="(select "+V[0].Provision.toString()+" from PAY_FinancePostings PFP WITH(NOLOCK) WHERE TYPE='"+V[0].Type.toString()+"' AND PFP.ParentRef="+h.CDGDO.ActualColumn+") ");else if("Payroll"==V[0].Type.toString()&&null!=(h=this.BaseReportColumns.find(W=>50051==W.CDGDO.CategoryValue||W.CDGDO.IsForeignKey&&50051==W.CDGDO.ParentCostCenterID))){let W=new Date,x=new Date,B=new Date;if(null!=(c=this.Filter.Fields.find(Q=>null!=Q.CDGDO.DataType&&"DATE"==Q.CDGDO.DataType.toUpperCase()&&40054==Q.CDGDO.CategoryValue))){let Q={PayrollMonth:W,PayrollMonthStart:x,PayrollMonthEnd:B};C.J0.SetPayrollDate_1(c.FromDatePicker.Date,Q),W=Q.PayrollMonth,x=Q.PayrollMonthStart,B=Q.PayrollMonthEnd,this.sbQuery+="(select "+V[0].Provision.toString()+" from PAY_FinancePostings PFP WITH(NOLOCK) WHERE TYPE='"+V[0].Type.toString()+"' AND PFP.EmployeeID="+h.CDGDO.ActualTable+".NodeID and PFP.PayrollMonth=convert(datetime,'"+W.ToString("dd MMM yyyy")+"')) "+s.ID+"_ID,",s.CDGDO.ActualColumn="(select "+V[0].Provision.toString()+" from PAY_FinancePostings PFP WITH(NOLOCK) WHERE TYPE='"+V[0].Type.toString()+"' AND PFP.EmployeeID="+h.CDGDO.ActualTable+".NodeID and PFP.PayrollMonth=convert(datetime,'"+W.ToString("dd MMM yyyy")+"')) "}else if(null!=(h=this.BaseReportColumns.find(Q=>50051==Q.CDGDO.CategoryValue||Q.CDGDO.IsForeignKey&&50051==Q.CDGDO.ParentCostCenterID))){let Q=new Date,ae=new Date,re=new Date;if(null!=(c=this.Filter.Fields.find(ee=>null!=ee.CDGDO.DataType&&"DATE"==ee.CDGDO.DataType.toUpperCase()&&40079==ee.CDGDO.CategoryValue))){let ee={PayrollMonth:Q,PayrollMonthStart:ae,PayrollMonthEnd:re};C.J0.SetPayrollDate_1(c.FromDatePicker.Date,ee),Q=ee.PayrollMonth,ae=ee.PayrollMonthStart,re=ee.PayrollMonthEnd,this.sbQuery+="(select "+V[0].Provision.toString()+" from PAY_FinancePostings PFP WITH(NOLOCK) WHERE TYPE='"+V[0].Type.toString()+"' AND PFP.EmployeeID="+h.CDGDO.ActualTable+".NodeID and PFP.PayrollMonth=convert(datetime,'"+Q.ToString("dd MMM yyyy")+"')) "+s.ID+"_ID,",s.CDGDO.ActualColumn="(select "+V[0].Provision.toString()+" from PAY_FinancePostings PFP WITH(NOLOCK) WHERE TYPE='"+V[0].Type.toString()+"' AND PFP.EmployeeID="+h.CDGDO.ActualTable+".NodeID and PFP.PayrollMonth=convert(datetime,'"+Q.ToString("dd MMM yyyy")+"')) "}}}}}}else if(72==s.CDGDO.CategoryValue&&26432==s.CDGDO.FieldValue)s.CDGDO.ActualColumn="CASE WHEN "+s.CDGDO.ActualColumn+"=1 THEN 'Yes' ELSE 'No' END";else if(72==s.CDGDO.CategoryValue&&26402==s.CDGDO.FieldValue)s.CDGDO.ActualColumn="CASE WHEN "+s.CDGDO.ActualColumn+"=1 THEN 'Calendar Days' WHEN "+s.CDGDO.ActualColumn+"=2 THEN 'Full Month' WHEN "+s.CDGDO.ActualColumn+"=3 THEN 'Mid Month' ELSE '' END";else if(72==s.CDGDO.CategoryValue&&26401==s.CDGDO.FieldValue)s.CDGDO.ActualColumn="CASE WHEN "+s.CDGDO.ActualColumn+"=1 THEN 'Monthly' WHEN "+s.CDGDO.ActualColumn+"=2 THEN 'Quarterly' WHEN "+s.CDGDO.ActualColumn+"=3 THEN 'Half Yearly' WHEN "+s.CDGDO.ActualColumn+"=4 THEN 'Yearly' ELSE '' END";else if(72==s.CDGDO.CategoryValue&&26399==s.CDGDO.FieldValue)s.CDGDO.ActualColumn="(SELECT Name FROM ACC_DepreciationMethods WITH(NOLOCK) WHERE DepreciationMethodID="+s.CDGDO.ActualColumn+")";else if(95==s.CDGDO.CategoryValue&&(s.CDGDO.Column.startsWith("DIMCodes_")||s.CDGDO.Column.startsWith("DIMNames_")))s.CDGDO.Column.startsWith("DIMCodes_")?(this.sbQuery+="STUFF( (SELECT '|'+Code FROM "+C.J0.GetTagTableName(parseInt(s.CDGDO.Column.Replace("DIMCodes_","")))+" aa WITH(NOLOCK) \n                                JOIN COM_CostCenterCostCenterMap bb WITH(NOLOCK) on bb.ParentCostCenterID = 95 AND ParentNodeID = T0.ContractID AND CostCenterID = "+s.CDGDO.Column.Replace("DIMCodes_","")+" AND bb.NodeID = aa.NodeID\n                                ORDER BY bb.CCCCMapID\n                                FOR XML PATH('') ), 1, 1, '') "+s.ID+"_ID, ",s.CDGDO.ActualColumn="STUFF( (SELECT '|'+Code FROM "+C.J0.GetTagTableName(parseInt(s.CDGDO.Column.Replace("DIMCodes_","")))+" aa WITH(NOLOCK) \n                                JOIN COM_CostCenterCostCenterMap bb WITH(NOLOCK) on bb.ParentCostCenterID = 95 AND ParentNodeID = T0.ContractID AND CostCenterID = "+s.CDGDO.Column.Replace("DIMCodes_","")+" AND bb.NodeID = aa.NodeID\n                                ORDER BY bb.CCCCMapID\n                                FOR XML PATH('') ), 1, 1, '') "):s.CDGDO.Column.startsWith("DIMNames_")&&(this.sbQuery+="STUFF( (SELECT '|'+Name FROM "+C.J0.GetTagTableName(parseInt(s.CDGDO.Column.Replace("DIMNames_","")))+" aa WITH(NOLOCK) \n                                JOIN COM_CostCenterCostCenterMap bb WITH(NOLOCK) on bb.ParentCostCenterID = 95 AND ParentNodeID = T0.ContractID AND CostCenterID = "+s.CDGDO.Column.Replace("DIMNames_","")+" AND bb.NodeID = aa.NodeID\n                                ORDER BY bb.CCCCMapID\n                                FOR XML PATH('') ), 1, 1, '') "+s.ID+"_ID, ",s.CDGDO.ActualColumn="STUFF( (SELECT '|'+Name FROM "+C.J0.GetTagTableName(parseInt(s.CDGDO.Column.Replace("DIMNames_","")))+" aa WITH(NOLOCK) \n                                JOIN COM_CostCenterCostCenterMap bb WITH(NOLOCK) on bb.ParentCostCenterID = 95 AND ParentNodeID = T0.ContractID AND CostCenterID = "+s.CDGDO.Column.Replace("DIMNames_","")+" AND bb.NodeID = aa.NodeID\n                                ORDER BY bb.CCCCMapID\n                                FOR XML PATH('') ), 1, 1, '') ");else if(11691==s.CDGDO.FieldValue)C.J0.IsEmpty(s.CDGDO.ActualTable)&&(s.CDGDO.ActualTable=this.IsInventory?"INV":"ACC"),this.sbQuery+=144==s.CDGDO.CategoryValue&&"CRM_Activities"==s.CDGDO.Table?"convert(nvarchar,"+s.CDGDO.ActualTable+".CostCenterID)+'~'+CASE WHEN "+s.CDGDO.ActualTable+".CostCenterID=1000 THEN convert(nvarchar,"+s.CDGDO.ActualTable+".ActivityID) ELSE convert(nvarchar,"+s.CDGDO.ActualTable+".NodeID) END "+s.ID+"_ID,":"convert(nvarchar,"+s.CDGDO.ActualTable+".CostCenterID)+'~'+convert(nvarchar,"+s.CDGDO.ActualTable+".DocID)"+s.ID+"_ID,",s.CDGDO.ActualColumn="'Activity'";else if(11691==s.CDGDO.ParentCCDefaultColID&&144==s.CDGDO.ParentCostCenterID&&"CRM_ACTIVITIES"==s.CDGDO.ParentCostCenterSysName.toUpperCase())this.sbQuery+="convert(nvarchar,"+s.CDGDO.ActualTable+".CostCenterID)+'~'+CASE WHEN "+s.CDGDO.ActualTable+".CostCenterID=1000 THEN convert(nvarchar,"+s.CDGDO.ActualTable+".ActivityID) ELSE convert(nvarchar,"+s.CDGDO.ActualTable+".NodeID) END "+s.ID+"_ID,",s.CDGDO.ActualColumn="'Activity'";else if(113==s.CDGDO.ParentCostCenterID&&"Status"==s.CDGDO.Column&&!this.IsInventory&&this.Report.Preferences.ContainsKey("ReplaceStatus"))s.CDGDO.ActualColumn="case when ACC.StatusID=429 then case when ACC.BillDate=1 then 'Replace' when ACC.BillDate=2 then 'Partial Replace' else 'Bounced' end else "+s.CDGDO.ActualColumn+" end";else if(C.J0.StringIsNullOrEmpty(s.CDGDO.ActualTable)||"INV_DocDetails"!=s.CDGDO.Table||"Quantity"!=s.CDGDO.Column)if(C.J0.StringIsNullOrEmpty(s.CDGDO.ActualTable)||"INV_DocDetails"!=s.CDGDO.Table||"Gross"!=s.CDGDO.Column){if(599==s.CDGDO.FieldValue)s.CDGDO.ActualColumn="BOMName";else if("Attachments"==s.CDGDO.Column){let p;p=s.CDGDO.FieldValue>0?s.CDGDO.CategoryValue:s.CDGDO.ParentCostCenterID,92==p||p>5e4?(this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+p+" AND FeaturePK="+s.CDGDO.ActualTable+".NodeID FOR XML PATH('')),1,1,'') "+s.ID+"_ID,",s.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+p+" AND FeaturePK="+s.CDGDO.ActualTable+".NodeID FOR XML PATH('')),1,2,'')"):93==p?(this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+p+" AND FeaturePK="+s.CDGDO.ActualTable+".UnitID FOR XML PATH('')),1,1,'') "+s.ID+"_ID,",s.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+p+" AND FeaturePK="+s.CDGDO.ActualTable+".UnitID FOR XML PATH('')),1,2,'')"):94==p?(this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+p+" AND FeaturePK="+s.CDGDO.ActualTable+".TenantID FOR XML PATH('')),1,1,'') "+s.ID+"_ID,",s.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+p+" AND FeaturePK="+s.CDGDO.ActualTable+".TenantID FOR XML PATH('')),1,2,'')"):95==p||104==p?(this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+p+" AND FeaturePK="+s.CDGDO.ActualTable+".ContractID FOR XML PATH('')),1,1,'') "+s.ID+"_ID,",s.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+p+" AND FeaturePK="+s.CDGDO.ActualTable+".ContractID FOR XML PATH('')),1,2,'')"):(103==p||129==p)&&(this.sbQuery+="stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+p+" AND FeaturePK="+s.CDGDO.ActualTable+".QuotationID FOR XML PATH('')),1,1,'') "+s.ID+"_ID,",s.CDGDO.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+p+" AND FeaturePK="+s.CDGDO.ActualTable+".QuotationID FOR XML PATH('')),1,2,'')")}}else s.CDGDO.ActualColumn="CASE WHEN (SELECT DocumentType FROM ADM_DocumentTypes WITH(NOLOCK) WHERE CostCenterID="+s.CDGDO.ActualTable+".CostCenterID)=38 AND VoucherType=1 THEN -"+s.CDGDO.ActualTable+"."+s.CDGDO.Column+" ELSE "+s.CDGDO.ActualTable+"."+s.CDGDO.Column+" END";else s.CDGDO.ActualColumn="CASE WHEN (SELECT DocumentType FROM ADM_DocumentTypes WITH(NOLOCK) WHERE CostCenterID="+s.CDGDO.ActualTable+".CostCenterID)=38 AND VoucherType=1 THEN -"+s.CDGDO.ActualTable+"."+s.CDGDO.Column+" ELSE "+s.CDGDO.ActualTable+"."+s.CDGDO.Column+" END";let E=s.CDGDO.ActualColumn;if("DATE"==s.CDGDO.DataType&&("MMM-yy"==s.DateType.Text&&this.ReportGroups.find(p=>p.ID==s.ID)?E="dateadd(day,1-datepart(day,"+E+"),"+E+")":"yyyy"==s.DateType.Text&&this.ReportGroups.find(p=>p.ID==s.ID)&&(E="convert(datetime,'01-01-'+convert(nvarchar,year("+E+")))")),""==E&&(E="NULL"),this.sbQuery+=E,0==this.sbFinalQuery.length&&(this.IsSummaryReportType&&(this.SummarySELECT.length>0&&(this.SummarySELECT+=","),"FLOAT"==s.CDGDO.DataType?this.SummarySELECT+="sum("+s.ID+") AS "+s.ID:(this.SummarySELECT+=s.ID,this.SummaryGROUPBY.length>0&&(this.SummaryGROUPBY+=","),this.SummaryGROUPBY+=s.ID),("Attachments"==s.CDGDO.Column||"Attachment Names"==s.CDGDO.FieldText)&&(this.SummarySELECT.length>0&&(this.SummarySELECT+=","),this.SummaryGROUPBY.length>0&&(this.SummaryGROUPBY+=","),this.SummarySELECT+=s.ID+"_ID",this.SummaryGROUPBY+=s.ID+"_ID")),this.sbQuery+=" ["+s.ID+"]"),this.IncludeLFTColumn.Contains(s.ID)){let p=s.CDGDO.ActualColumn.lastIndexOf(".");this.sbQuery+=p>0?","+s.CDGDO.ActualColumn.substr(0,p+1)+"lft":",null",0==this.sbFinalQuery.length&&(this.sbQuery+=" ["+s.ID+"lft_CF]")}if(s.Sort.SelectedValue.startsWith("NUM"))this.sbQuery+=",CASE WHEN isnumeric("+s.CDGDO.ActualColumn+")=1 THEN CONVERT(FLOAT,"+s.CDGDO.ActualColumn+") ELSE 0 END AS ["+s.ID+"SORT]";else if(s.Sort.SelectedValue.startsWith("TREE")){let p=s.CDGDO.ActualColumn.lastIndexOf(".");p>0&&(this.sbQuery+=","+s.CDGDO.ActualColumn.substr(0,p+1)+"lft AS ["+s.ID+"SORT]")}else"VoucherNo"==s.CDGDO.Column&&0==s.CDGDO.IsForeignKey&&(400==s.CDGDO.CategoryValue||Math.abs(s.CDGDO.CategoryValue)>4e4&&Math.abs(s.CDGDO.CategoryValue)<5e4)&&(""!=s.Sort.SelectedValue||"1"==s.ShowAsColumn.SelectedValue?this.sbQuery+=0==this.sbFinalQuery.length?this.IsInventory?",INV.DocAbbr ["+s.ID+"Abr],INV.DocPrefix ["+s.ID+"prf],CONVERT(BIGINT,INV.DocNumber) ["+s.ID+"dno]":",ACC.DocAbbr ["+s.ID+"Abr],ACC.DocPrefix ["+s.ID+"prf],CONVERT(BIGINT,ACC.DocNumber) ["+s.ID+"dno]":this.IsInventory?",INV.DocAbbr,INV.DocPrefix,CONVERT(BIGINT,INV.DocNumber)":",ACC.DocAbbr,ACC.DocPrefix,CONVERT(BIGINT,ACC.DocNumber)":(this.sbQuery+=","+(this.IsInventory?"INV":"ACC")+".VersionNo",0==this.sbFinalQuery.length&&(this.sbQuery+=" ["+s.ID+"Ver]")),"2"==s.LinkType.SelectedValue?this.sbQuery+=this.IsInventory?",INV.InvDocDetailsID ["+s.ID+"_ID]":",ACC.AccDocDetailsID ["+s.ID+"_ID]":"8"==s.LinkType.SelectedValue&&(this.sbQuery+=this.IsInventory?",INV.DocID ["+s.ID+"_DID]":",ACC.DocID ["+s.ID+"_DID]"));if("8"==s.LinkType.SelectedValue&&(400==s.CDGDO.CategoryValue||Math.abs(s.CDGDO.CategoryValue)>4e4&&Math.abs(s.CDGDO.CategoryValue)<5e4)&&(this.sbQuery+=this.IsInventory?",INV.DocID ["+s.ID+"_DID]":",ACC.DocID ["+s.ID+"_DID]"),"-1"==s.LinkDimension.SelectedValue&&"1"==s.LinkType.SelectedValue&&(this.sbQuery+=95==s.CDGDO.CategoryValue?",T0.ContractID AS ["+s.ID+"_ID]":this.IsInventory?",INV.DocID AS ["+s.ID+"_ID]":",ACC.DocID AS ["+s.ID+"_ID]"),s.IsReportMappingFilter||"3"==s.LinkType.SelectedValue||"4"==s.LinkType.SelectedValue){let p=0;p=null!=s.CDGDO.ChildCDGDO&&s.CDGDO.ChildCDGDO.IsForeignKey?s.CDGDO.ChildCDGDO.ParentCostCenterID:s.CDGDO.IsForeignKey?s.CDGDO.ParentCostCenterID:s.CDGDO.CategoryValue,400!=p&&(p<4e4||p>5e4)&&("NULL"!=s.CDGDO.ActualColumn?(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(V=>V.FeatureID==p),this.sbQuery+=","+s.CDGDO.ActualTable+"."+this.drrCCTbl[0].PK.toString()+" AS ["+s.ID+"_ID]"):this.sbQuery+=",NULL AS ["+s.ID+"_ID]")}if("1"==s.ShowLevel.SelectedValue||"2"==s.ShowLevel.SelectedValue)if(null==H){if(null==H&&"NULL"!=s.CDGDO.ActualColumn&&(s.CDGDO.IsForeignKey&&s.CDGDO.ColumnCostCenterID>0||!s.CDGDO.IsForeignKey)){let p=s.CDGDO.ActualColumn.lastIndexOf(".");if(p>0){s.CDGDO.IsForeignKey?this.LevelTreeCostCenterID=s.CDGDO.ColumnCostCenterID:(this.LevelTreeCostCenterID=s.CDGDO.CategoryValue,s.CDGDO.ParentCostCenterSysName=s.CDGDO.Table,this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(O=>O.FeatureID==s.CDGDO.CategoryValue),s.CDGDO.ParentCostCenterColSysName=this.drrCCTbl[0].PK.toString());let V=s.CDGDO.ActualColumn.substr(0,p+1);this.sbQuery+=null!=s.CDGDO.ChildCDGDO?","+V+s.CDGDO.ChildCDGDO.ParentCostCenterColSysName+" AS TreeNodeID":","+V+s.CDGDO.ParentCostCenterColSysName+" AS TreeNodeID",null==this.LevelColumn&&(this.LevelColumn=s)}}H=this.LevelColumn}else this.LevelSubGroup=s.ID;e++}for(let i=0;i<this.ReportGroups.length;i++){let s=this.ReportGroups[i];if("0"==s.ShowAsColumn.SelectedValue){if(!C.J0.IsEmpty(s.FormulaExpression))continue;e>0&&(this.sbQuery+=","),this.SetActualColumn(s.CDGDO,f);let E=s.CDGDO.ActualColumn;if("DATE"==s.CDGDO.DataType&&("MMM-yy"==s.DateType.Text?E="dateadd(day,1-datepart(day,"+E+"),"+E+")":"yyyy"==s.DateType.Text&&(E="convert(datetime,'01-01-'+convert(nvarchar,year("+E+")))")),this.sbQuery+=E,0==this.sbFinalQuery.length&&(this.sbQuery+=" ["+s.ID+"]"),s.Sort.SelectedValue.startsWith("NUM"))this.sbQuery+=",CASE WHEN isnumeric("+s.CDGDO.ActualColumn+")=1 THEN CONVERT(FLOAT,"+s.CDGDO.ActualColumn+") ELSE 0 END AS ["+s.ID+"SORT]";else if(s.Sort.SelectedValue.startsWith("TREE")){let p=s.CDGDO.ActualColumn.lastIndexOf(".");p>0&&(this.sbQuery+=","+s.CDGDO.ActualColumn.substr(0,p+1)+"lft AS ["+s.ID+"SORT]")}else"VoucherNo"==s.CDGDO.Column&&0==s.CDGDO.IsForeignKey&&(this.sbQuery+=0==this.sbFinalQuery.length?this.IsInventory?",INV.DocAbbr ["+s.ID+"Abr],INV.DocPrefix ["+s.ID+"prf],CONVERT(BIGINT,INV.DocNumber) ["+s.ID+"dno]":",ACC.DocAbbr ["+s.ID+"Abr],ACC.DocPrefix ["+s.ID+"prf],CONVERT(BIGINT,ACC.DocNumber) ["+s.ID+"dno]":this.IsInventory?",INV.DocAbbr,INV.DocPrefix,CONVERT(BIGINT,INV.DocNumber)":",ACC.DocAbbr,ACC.DocPrefix,CONVERT(BIGINT,ACC.DocNumber)");e++}}let a=0;for(let i=0;i<this.FormulaObjects.length;i++){let s=this.FormulaObjects[i];e>0&&(this.sbQuery+=","),this.SetActualColumn(s,f),this.sbQuery+=s.ActualColumn,0==this.sbFinalQuery.length&&(this.sbQuery+=" F"+a),e++,a++}if(this.IsAvgRateExists&&(this.StaticReportType>0||(0==f.DocID&&this.Entities.ContainsKey("Product")?this.sbQuery+=","+this.Entities.Product+".ProductID AvgRateOpStkPID,convert(float,convert(int,CONVERT(float,getdate()))) AvgRateOpStkDate":this.Entities.values.Contains("INV")?this.sbQuery+=",INV.ProductID AvgRateOpStkPID,INV.DocDate AvgRateOpStkDate":this.sbQuery+=",null AvgRateOpStkPID,null AvgRateOpStkDate"),this.IsSummaryReportType&&!this.SummarySELECT.Contains("AvgRateOpStkPID")&&(this.SummarySELECT.length>0&&(this.SummarySELECT+=","),this.SummarySELECT+="MAX(AvgRateOpStkPID) AvgRateOpStkPID,MIN(AvgRateOpStkDate)-1 AvgRateOpStkDate")),this.IsAuthLevelReport){var u=this.BaseReportColumns.find(i=>95==i.CDGDO.CategoryValue||103==i.CDGDO.CategoryValue||104==i.CDGDO.CategoryValue||129==i.CDGDO.CategoryValue);this.sbQuery+=u&&95==u.CDGDO.CategoryValue?","+this.Entities.Contract+".WorkFlowLevel,"+this.Entities.Contract+".WorkFlowID":u&&103==u.CDGDO.CategoryValue?","+this.Entities.Quotation+".WorkFlowLevel,"+this.Entities.Quotation+".WorkFlowID":u&&104==u.CDGDO.CategoryValue?","+this.Entities["Purchase Contract"]+".WorkFlowLevel,"+this.Entities["Purchase Contract"]+".WorkFlowID":u&&129==u.CDGDO.CategoryValue?","+this.Entities["Unit Reservation"]+".WorkFlowLevel,"+this.Entities["Unit Reservation"]+".WorkFlowID":this.IsInventory?",INV.WorkFlowLevel,INV.WorkFlowID":",ACC.WorkFlowLevel,ACC.WorkFlowID"}else null!=this.BulkEdit&&this.BulkEdit.IsLWApproval&&(this.sbQuery+=this.IsInventory?",INV.WorkFlowID":",ACC.WorkFlowID");this.isFromBE&&(this.Entities.values.Contains("INV")||this.Entities.values.Contains("ACC"))&&(this.sbQuery+=",DID.GUID",this.FromTagExtra+=" Left Join Com_DOCID DID with(nolock) on DID.ID = "+(this.IsInventory?"INV":"ACC")+".DocID"),this.IsRevision&&(this.sbQuery+=this.IsInventory?",INV.VoucherNo RevDocNo,INV.VersionNo RevVersionNo,INV.ModifiedDate RevModDate,INV.ModifiedBy RevModBy":",ACC.VoucherNo RevDocNo,ACC.VersionNo RevVersionNo,ACC.ModifiedDate RevModDate,ACC.ModifiedBy RevModBy"),C.J0.IsEmpty(this.FileProtection)||("Account1"==this.FileProtection&&this.IsInventory?this.sbQuery+=",INV.Account1 FilePwdID":this.FileProtection.Contains("Account")?this.sbQuery+="INV":"Employee"==this.FileProtection&&(this.sbQuery+=",TDCC.dcCCNID51 FilePwdID")),112==this.CostCenterID&&(this.sbQuery+=",INV.InvDocDetailsID ReorderDetailsID"),this.SelectTag=this.sbQuery.toString()}this.sbQuery="";let X=[],y=[];if(this.IsNewFromClause){if(this.ShowOnlyAccountingData&&f.ShowAccountingData)if(f.IsInventory){if(this.sbQuery+="ACC_DocDetails ACC with(nolock) join ",Math.abs(f.DocID)<4e4&&null!=this.IncludeNonAccDocs){let a="";this.IncludeNonAccDocs.forEach(i=>{a.length>0&&(a+=","),a+="'"+i+"'"}),r.length>0&&(r+=" AND "),r+="INV.CostCenterID not in ("+a+")"}}else r.length>0&&(r+=" AND "),r+="ACC.InvDocDetailsID is null";if((this.Entities.values.Contains("INV")||this.Entities.values.Contains("ACC"))&&(this.IsInventory&&"INV"!=this.Entities.values[0]||!this.IsInventory&&"ACC"!=this.Entities.values[0])){var F=Object.assign([],this.Entities.values),L=Object.assign([],this.Entities.keys),R=Object.assign([],this.Objects);let a=F.indexOf(this.IsInventory?"INV":"ACC");this.Entities.Clear(),this.Objects.Clear(),this.Entities.push(L[a],F[a]),this.Objects.push(R[a]);for(let i=0;i<F.length;i++)i!=a&&(this.Entities.push(L[i],F[i]),this.Objects.push(R[i]))}e=0;for(let a=0;a<this.Entities.length;a++){let i=this.Objects[a];for(A=0;A<a&&this.Entities.values[A]!=this.Entities.values[a];A++);if(A==a&&(this.IsInventory||"LinkStatusID"!=i.ParentColumn)){if(e>0&&(this.sbQuery+=" left join "),null!=i.DimensionsFilter&&(64==i.ParentCCDefaultColID||64==i.ParentCCDefaultColID)){this.sbQuery+="(select BaseID,max(Conversion) MaxConv,min(Conversion) MinConv from COM_UOM with(nolock) group by BaseID)"+this.Entities[i.CategoryText+"_MAXMIN"],this.sbQuery+=" on "+this.Entities[i.CategoryText]+".BaseID="+this.Entities[i.CategoryText+"_MAXMIN"]+".BaseID";continue}if(210==i.FieldValue){if(this.IsInventory&&this.Filter.IsReportViewScreen){let s=C.J0.IsEmpty(i.DimensionsFilter)?[null,null,null,null]:i.DimensionsFilter.split("~"),E=this;if(E.SetDatePickers(),C.J0.IsEmptySpace(s[2])){let p=null!=G.find(V=>3==V.CategoryValue)?this.Entities.Product:"INV";this.sbQuery+="dbo.fnRPT_AvgRateAllProds('','','"+E.FromDatePicker.Date.ToString("dd MMM yyyy")+"','"+E.ToDatePicker.Date.ToString("dd MMM yyyy")+"',0,0,0,0,'') "+this.Entities.values[a],this.sbQuery+=" on "+this.Entities.values[a]+".ProductID="+p+".ProductID"}else{let p=C.J0.IsEmptySpace(s[1])?0:parseInt(s[1]);this.sbQuery+="dbo."+s[2]+"('','','"+E.FromDatePicker.Date.ToString("dd MMM yyyy")+"','"+E.ToDatePicker.Date.ToString("dd MMM yyyy")+"',0,0,0,0,'') "+this.Entities.values[a],p>0?(s.length>3&&"1"==s[3]&&(r+=this.Entities.values[a]+".ProductID=INV.ProductID and"),this.sbQuery+=" on "+this.Entities.values[a]+".TagID=TDCC.dcCCNID"+(p-5e4)):this.sbQuery+=" on "+this.Entities.values[a]+".ProductID=INV.ProductID"}}continue}if(this.IsHistory&&k.HistoryTables.keys.Contains(this.iHistoryStatusID)&&k.HistoryTables[this.iHistoryStatusID].Contains(i.Table)&&"RptManager"!=i.ParentColumn?(this.Filter.ShowArchive.Visible&&this.Filter.ShowArchive.IsChecked&&(this.sbQuery+="PACT2C"+N.d.SessionManager.CompanyIndex+"_ARCHIVE.dbo."),i.CategoryValue>=50001&&50051!=i.CategoryValue&&0==C.J0.stringCompare(k.HistoryTables[this.iHistoryStatusID][0],i.Table,!0)?(r.length>0&&(r+=" AND "),r+=this.Entities.values[a]+".CostCenterID="+i.CategoryValue,this.sbQuery+="COM_CCMastHistory "+this.Entities.values[a]+" with(nolock)"):"COM_CCCCDATA"==i.Table.toUpperCase()?this.sbQuery+=i.Table+"History "+this.Entities.values[a]+" with(nolock)":this.sbQuery+=i.Table+this.strHistorySepChar+"History "+this.Entities.values[a]+" with(nolock)"):this.sbQuery+=i.Table+" "+this.Entities.values[a]+" with(nolock)","COM_ADDRESS"==i.Table.toUpperCase()){if(this.Entities.ContainsKey(i.CategoryText)){let s="NodeID";2==i.ColumnCostCenterID?s="AccountID":83==i.ColumnCostCenterID&&(s="CustomerID"),this.sbQuery+=" on "+this.Entities[i.CategoryText]+"."+s+"="+this.Entities.values[a]+".FeaturePK",this.sbQuery+=50051==i.ColumnCostCenterID?" AND "+this.Entities.values[a]+".AddressTypeID=4 AND "+this.Entities.values[a]+".FeatureID="+i.ColumnCostCenterID:" AND "+this.Entities.values[a]+".AddressTypeID=1 AND "+this.Entities.values[a]+".FeatureID="+i.ColumnCostCenterID}}else if("COM_CONTACTSEXTENDED"!=i.Table.toUpperCase())if("COM_CONTACTS"==i.Table.toUpperCase()&&"COM_DOCCCDATA"!=i.ParentTable.toUpperCase()){if(65!=i.CategoryValue&&this.Entities.ContainsKey(i.CategoryText)||null!=i.ChildCDGDO&&(144!=i.ChildCDGDO.CategoryValue||65!=i.ChildCDGDO.ParentCostCenterID)){let s=i.ColumnCostCenterID>0?i.ColumnCostCenterID.toString():i.CategoryValue.toString();this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(p=>p.FeatureID==s);let E=i.CategoryText.lastIndexOf(".");this.sbQuery+=-1==E||"51"==s?" on "+this.Entities[i.CategoryText]+"."+this.drrCCTbl[0].PK.toString()+"="+this.Entities.values[a]+".FeaturePK":" on "+this.Entities[i.CategoryText.substr(0,E)]+"."+this.drrCCTbl[0].PK.toString()+"="+this.Entities.values[a]+".FeaturePK",this.sbQuery+=" AND "+this.Entities.values[a]+".FeatureID="+s}}else if("CRM_CONTACTS"==i.Table.toUpperCase()){if(this.Entities.ContainsKey(i.CategoryText)){let s="";s="Leads"==i.CategoryText?"LeadID":"Opportunity"==i.CategoryText?"OpportunityID":this.drrCCTbl[0].PK.toString(),this.sbQuery+=" on "+this.Entities[i.CategoryText]+"."+s+"="+this.Entities.values[a]+".FeaturePK",this.sbQuery+=" AND "+this.Entities.values[a]+".FeatureID="+i.CategoryValue}}else if("CRM_ACTIVITIES"==i.Table.toUpperCase()){if(144!=i.CategoryValue&&this.Entities.ContainsKey(i.CategoryText)&&null!=i.ParentTableAlias&&this.Entities.ContainsKey(i.ParentTableAlias))this.sbQuery+=" on "+this.Entities[i.ParentTableAlias]+"."+i.ParentColumn+"="+this.Entities.values[a]+"."+i.ParentCostCenterColSysName,this.sbQuery+=" AND "+this.Entities.values[a]+".CostCenterID="+i.CategoryValue;else if(this.Filter.ActivityTypes.Visible){let s="";this.Filter.ActivityTypes.Items.forEach(E=>{E.IsChecked&&(s+=E.Value+",")}),s.length>0&&(s=s.TrimEnd(","),s.Contains(",")?r+=this.Entities.values[a]+".CostCenterID IN ("+s+")":r+=this.Entities.values[a]+".CostCenterID="+s)}if(this.Filter.UsersList.Visible){let s="";this.Filter.UsersList.Items.forEach(E=>{E.IsChecked&&(s+=E.Value+",")}),0==s.length&&"1"!=N.d.SessionManager.RoleID&&(s="-1"),s.length>0&&(s=s.TrimEnd(","),s.length>0&&(this.sbQuery.length>0&&(this.sbQuery+=" join "),this.sbQuery+="  (select a.ISFROMACTIVITY,a.ccid,a.CCNODEID  from CRM_Assignment a with(nolock) where ISFROMACTIVITY>0 and UserID>0 and IsTeam=0 and IsRole=0 and IsGroup=0 and TeamNodeID=0 and a.UserID IN ("+s+") union select a.ISFROMACTIVITY,a.ccid,a.ccnodeid  from CRM_Assignment a with(nolock) join ADM_UserRoleMap map  with(nolock) on a.userid=map.roleid where ISFROMACTIVITY>0 and  a.UserID>0 and a.IsTeam=0 and a.IsRole=1 and a.IsGroup=0 and map.UserID IN ("+s+") union select a.ISFROMACTIVITY,a.ccid,a.ccnodeid  from CRM_Assignment a with(nolock) join com_groups g on a.TeamNodeID=g.gid join ADM_UserRoleMap map  with(nolock) on g.userid=map.userid or g.roleid=map.roleid where ISFROMACTIVITY>0 and  a.UserID=0 and a.IsTeam=0 and a.IsRole=0 and a.IsGroup=1 and a.TeamNodeID>0  and map.UserID IN ("+s+") union select a.ISFROMACTIVITY,a.ccid,a.ccnodeid   from CRM_Assignment a with(nolock) join CRM_Teams T   with(nolock) on a.TEAMNodeID=T.TEAMID and a.userid=t.userid where ISFROMACTIVITY>0 and a.UserID>0 and a.IsTeam=0 AND a.TeamNodeID>0 and a.IsRole=0 and a.IsGroup=0  and T.UserID IN ("+s+")) T ",this.sbQuery+=" on T.ISFROMACTIVITY="+this.Entities.values[a]+".ActivityID and T.ccid="+this.Entities.values[a]+".COSTCENTERID AND T.CCNODEID="+this.Entities.values[a]+".NODEID"))}}else if("CRM_FEEDBACK"==i.Table.toUpperCase()||"CRM_LEADCVRDETAILS"==i.Table.toUpperCase())this.Entities.ContainsKey(i.CategoryText)&&(this.sbQuery+=" on "+this.Entities[i.ParentTableAlias]+"."+i.ParentColumn+"="+this.Entities.values[a]+"."+i.ParentCostCenterColSysName,this.sbQuery+=" AND "+this.Entities.values[a]+".CCID="+i.CategoryValue);else if("CRM_PRODUCTMAPPING"==i.Table.toUpperCase())this.Entities.ContainsKey(i.CategoryText)&&(this.sbQuery+=" on "+this.Entities[i.ParentTableAlias]+"."+i.ParentColumn+"="+this.Entities.values[a]+"."+i.ParentCostCenterColSysName,this.sbQuery+=" AND "+this.Entities.values[a]+".CostCenterID="+i.CategoryValue);else if("COM_NOTES"==i.Table.toUpperCase()){if(this.Entities.ContainsKey(i.CategoryText)){let s;2==i.CategoryValue&&(s="AccountID"),3==i.CategoryValue&&(s="ProductID"),72==i.CategoryValue?s="AssetID":73==i.CategoryValue?s="CaseID":83==i.CategoryValue?s="CustomerID":86==i.CategoryValue?s="LeadID":88==i.CategoryValue?s="CampaignID":89==i.CategoryValue?s="OpportunityID":93==i.CategoryValue?s="UnitID":94==i.CategoryValue?s="TenantID":(95==i.CategoryValue||104==i.CategoryValue)&&(s="ContractID"),this.sbQuery+=" on "+this.Entities[i.CategoryText]+"."+s+"="+this.Entities.values[a]+".FeaturePK",this.sbQuery+=" AND "+this.Entities.values[a]+".FeatureID="+i.CategoryValue}}else if("PAY_EMPPAY"==i.Table.toUpperCase())405==i.CategoryValue&&(this.sbQuery+=" on "+this.Entities.values[a]+".SeqNo IN (SELECT TOP 1 SeqNo FROM PAY_EMPPAY with(nolock) WHERE EmployeeID=TDCC.dcCCNID51 AND (DATEDIFF(day,CONVERT(DATETIME,EffectFrom),CONVERT(DATETIME,INV.DueDate))>=0 OR ((month(CONVERT(DATETIME,EffectFrom)))=MONTH(CONVERT(DATETIME,INV.DueDate)) AND (YEAR(CONVERT(DATETIME,EffectFrom)))=YEAR(CONVERT(DATETIME,INV.DueDate))))  ORDER BY EffectFrom DESC)");else if("REN_ContractParticulars"==i.Table||"REN_ContractPayTerms"==i.Table||"REN_QuotationParticulars"==i.Table||"REN_QuotationPayTerms"==i.Table){if(this.Entities.ContainsKey(i.CategoryText)&&!C.J0.IsEmpty(i.ParentTableAlias)){let s=i.ColumnCostCenterID>0?i.ColumnCostCenterID.toString():i.CategoryValue.toString();this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(E=>E.FeatureID==s),this.sbQuery+=" on "+this.Entities[i.ParentTableAlias]+"."+this.drrCCTbl[0].PK.toString()+"="+this.Entities[i.ParentTableAlias.Replace(i.Table,"")]+"."+this.drrCCTbl[0].PK.toString();continue}}else"PRD_BILLOFMATERIAL"==i.Table.toUpperCase()&&599==i.FieldValue?this.sbQuery+=" on "+this.Entities[i.ParentTableAlias]+"."+i.FieldText.toString()+"="+this.Entities.values[a]+".BOMID":i.IsForeignKey&&("ACC"==this.Entities[i.ParentTableAlias]&&"AccountID"==i.ParentColumn?(this.sbQuery+=" on ((ACC.DebitAccount>0 and ACC.DebitAccount="+this.Entities.values[a]+".AccountID) or (ACC.CreditAccount>0 and ACC.CreditAccount="+this.Entities.values[a]+".AccountID))",X.push(this.Entities.values[a]),y.push(this.Entities.values[a])):("INV_ProductExtended"==i.Table||"ACC_AccountsExtended"==i.Table||"REN_PropertyExtended"==i.Table||"REN_UnitsExtended"==i.Table||"REN_TenantExtended"==i.Table||(this.sbQuery+=this.ShowOnlyAccountingData&&f.ShowAccountingData&&f.IsInventory&&(2==i.ParentCostCenterID||12==i.ParentCostCenterID)?" on ACC."+i.ParentColumn+"="+this.Entities.values[a]+"."+i.ParentCostCenterColSysName:" on "+this.Entities[i.ParentTableAlias]+"."+i.ParentColumn+"="+this.Entities.values[a]+"."+i.ParentCostCenterColSysName),0==C.J0.stringCompare("DebitAccount",i.ParentColumn,!0)?X.push(this.Entities.values[a]):0==C.J0.stringCompare("CreditAccount",i.ParentColumn,!0)?y.push(this.Entities.values[a]):0==C.J0.stringCompare("Account1",i.ParentColumn,!0)&&(X.push(this.Entities.values[a]),y.push(this.Entities.values[a])),65==i.CategoryValue?26645==i.FieldValue?this.sbQuery+=" AND "+this.Entities[i.ParentTableAlias]+".FeatureID=2":26644==i.FieldValue&&(this.sbQuery+=" AND "+this.Entities[i.ParentTableAlias]+".FeatureID=83"):24==i.CategoryValue&&107==i.FieldValue?this.sbQuery+=" AND "+this.Entities[i.ParentTableAlias]+".ProductID="+this.Entities.values[a]+".ProductID":86==i.CategoryValue?27179==i.FieldValue?this.sbQuery+=" AND "+this.Entities[i.ParentTableAlias]+".Mode=3":27180==i.FieldValue&&(this.sbQuery+=" AND "+this.Entities[i.ParentTableAlias]+".Mode=2"):73==i.CategoryValue&&(27303==i.FieldValue?this.sbQuery+=" AND "+this.Entities[i.ParentTableAlias]+".CustomerMode=2":27304==i.FieldValue&&(this.sbQuery+=" AND "+this.Entities[i.ParentTableAlias]+".CustomerMode=1"))),0==C.J0.stringCompare(i.Table,"COM_CCCCData",!0)&&(this.sbQuery+=" AND "+this.Entities.values[a]+".CostCenterID="+i.CategoryValue),this.IsHistory&&k.HistoryTables.keys.Contains(this.iHistoryStatusID)&&k.HistoryTables[this.iHistoryStatusID].Contains(i.Table)&&"RptManager"!=i.ParentColumn&&(this.sbQuery+=this.iHistoryStatusID>=11701&&this.iHistoryStatusID<=11750?" AND "+this.Entities[i.ParentTableAlias]+".NodeHistoryID="+this.Entities.values[a]+".NodeHistoryID":" AND "+this.Entities[i.ParentTableAlias]+".ModifiedDate="+this.Entities.values[a]+".ModifiedDate"));if(null!=i.ParentCDGDO){let s=this.FieldsDialog.Relations.filter(E=>E.PK_Table==i.ParentCDGDO.Table.toUpperCase()&&E.FK_Table==i.Table.toUpperCase());s.length>0?(this.sbQuery+=" on "+this.Entities[i.ParentCDGDO.CategoryText]+"."+s[0].PK_Column.toString()+"="+this.Entities.values[a]+"."+s[0].FK_Column.toString(),this.IsHistory&&k.HistoryTables.keys.Contains(this.iHistoryStatusID)&&k.HistoryTables[this.iHistoryStatusID].Contains(i.Table)&&(this.sbQuery+=" AND "+this.Entities[i.ParentCDGDO.CategoryText]+".ModifiedDate="+this.Entities.values[a]+".ModifiedDate")):(s=this.FieldsDialog.Relations.filter(E=>E.FK_Table==i.ParentCDGDO.Table.toUpperCase()&&E.PK_Table==i.Table.toUpperCase()),s.length>0&&(this.sbQuery+=" on "+this.Entities[i.ParentCDGDO.CategoryText]+"."+s[0].FK_Column.toString()+"="+this.Entities.values[a]+"."+s[0].PK_Column.toString()))}0==a&&this.ShowOnlyAccountingData&&f.ShowAccountingData&&f.IsInventory?this.sbQuery+=" on ACC.InvDocDetailsID=INV.InvDocDetailsID":2==i.CategoryValue&&12==i.ColumnCostCenterID?this.sbQuery+=" on "+this.Entities[i.ParentCDGDO.CategoryText]+".Currency="+this.Entities.values[a]+".CurrencyID":3==i.ColumnCostCenterID&&null!=i.ParentTable&&i.ParentTable.toLowerCase().Contains("extended")&&null!=i.Column&&i.Column.Contains("ProductName")&&i.CategoryValue<400&&(this.sbQuery+=" on "+this.Entities[i.ParentTableAlias]+"."+i.ParentColumn+"="+this.Entities.values[a]+"."+i.ParentCostCenterColSysName),e++}}}else{if(this.ShowOnlyAccountingData&&f.ShowAccountingData)if(r.length>0&&(r+=" AND "),f.IsInventory){if(this.sbQuery+="ACC_DocDetails ACC with(nolock),",r+="ACC.InvDocDetailsID=INV.InvDocDetailsID",Math.abs(f.DocID)<4e4&&null!=this.IncludeNonAccDocs){let a="";this.IncludeNonAccDocs.forEach(i=>{a.length>0&&(a+=","),a+="'"+i+"'"}),r+=" AND INV.CostCenterID not in ("+a+")"}}else r+="ACC.InvDocDetailsID is null";e=0;for(let a=0;a<this.Entities.length;a++){let i=this.Objects[a];for(A=0;A<a&&this.Entities.values[A]!=this.Entities.values[a];A++);if(A==a){if(e>0&&(this.sbQuery+=","),null!=i.DimensionsFilter&&(64==i.ParentCCDefaultColID||64==i.ParentCCDefaultColID)){this.sbQuery+="(select BaseID,max(Conversion) MaxConv,min(Conversion) MinConv from COM_UOM with(nolock) group by BaseID)"+this.Entities[i.CategoryText+"_MAXMIN"],r.length>0&&(r+=" AND "),r+=this.Entities[i.CategoryText]+".BaseID="+this.Entities[i.CategoryText+"_MAXMIN"]+".BaseID";continue}if(210==i.FieldValue){if(this.IsInventory&&this.Filter.IsReportViewScreen){let s=C.J0.IsEmpty(i.DimensionsFilter)?[null,null,null,null]:i.DimensionsFilter.split("~"),E=this;if(E.SetDatePickers(),C.J0.IsEmptySpace(s[2])){let p=null!=G.find(V=>3==V.CategoryValue)?this.Entities.Product:"INV";this.sbQuery+="dbo.fnRPT_AvgRateAllProds('','','"+E.FromDatePicker.Date.ToString("dd MMM yyyy")+"','"+E.ToDatePicker.Date.ToString("dd MMM yyyy")+"',0,0,0,0,'') "+this.Entities.values[a],r.length>0&&(r+=" AND "),r+=this.Entities.values[a]+".ProductID="+p+".ProductID"}else{let p=C.J0.IsEmptySpace(s[1])?0:parseInt(s[1]);this.sbQuery+="dbo."+s[2]+"('','','"+E.FromDatePicker.Date.ToString("dd MMM yyyy")+"','"+E.ToDatePicker.Date.ToString("dd MMM yyyy")+"',0,0,0,0,'') "+this.Entities.values[a],r.length>0&&(r+=" AND "),p>0?(this.sbQuery+=" on ",s.length>3&&"1"==s[3]&&(this.sbQuery+=this.Entities.values[a]+".ProductID=INV.ProductID and "),this.sbQuery+=this.Entities.values[a]+".TagID=TDCC.dcCCNID"+(p-5e4)):r+=this.Entities.values[a]+".ProductID=INV.ProductID"}}continue}if(this.IsHistory&&k.HistoryTables.keys.Contains(this.iHistoryStatusID)&&k.HistoryTables[this.iHistoryStatusID].Contains(i.Table)?(this.Filter.ShowArchive.Visible&&this.Filter.ShowArchive.IsChecked&&(this.sbQuery+="PACT2C"+N.d.SessionManager.CompanyIndex+"_ARCHIVE.dbo."),i.CategoryValue>=50001&&50051!=i.CategoryValue&&0==C.J0.stringCompare(k.HistoryTables[this.iHistoryStatusID][0],i.Table,!0)?(r.length>0&&(r+=" AND "),r+=this.Entities.values[a]+".CostCenterID="+i.CategoryValue,this.sbQuery+="COM_CCMastHistory "+this.Entities.values[a]+" with(nolock)"):this.sbQuery+=i.Table+this.strHistorySepChar+"History "+this.Entities.values[a]+" with(nolock)"):this.sbQuery+=i.Table+" "+this.Entities.values[a]+" with(nolock)","COM_ADDRESS"==i.Table.toUpperCase()){if(this.Entities.ContainsKey(i.CategoryText)){r.length>0&&(r+=" AND ");let s="NodeID";2==i.ColumnCostCenterID?s="AccountID":83==i.ColumnCostCenterID&&(s="CustomerID"),r+=this.Entities[i.CategoryText]+"."+s+"="+this.Entities.values[a]+".FeaturePK",r+=" AND "+this.Entities.values[a]+".AddressTypeID=1 AND "+this.Entities.values[a]+".FeatureID="+i.ColumnCostCenterID}}else if("COM_CONTACTSEXTENDED"!=i.Table.toUpperCase())if("COM_CONTACTS"==i.Table.toUpperCase()&&"COM_DOCCCDATA"!=i.ParentTable.toUpperCase()){if(65!=i.CategoryValue&&this.Entities.ContainsKey(i.CategoryText)||null!=i.ChildCDGDO&&(144!=i.ChildCDGDO.CategoryValue||65!=i.ChildCDGDO.ParentCostCenterID)){r.length>0&&(r+=" AND ");let s=i.ColumnCostCenterID>0?i.ColumnCostCenterID.toString():i.CategoryValue.toString();this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(p=>p.FeatureID==s);let E=i.CategoryText.lastIndexOf(".");r+=-1==E||"51"==s?this.Entities[i.CategoryText]+"."+this.drrCCTbl[0].PK.toString()+"="+this.Entities.values[a]+".FeaturePK":this.Entities[i.CategoryText.substr(0,E)]+"."+this.drrCCTbl[0].PK.toString()+"="+this.Entities.values[a]+".FeaturePK",r+=" AND "+this.Entities.values[a]+".FeatureID="+s}}else if("CRM_CONTACTS"==i.Table.toUpperCase()){if(this.Entities.ContainsKey(i.CategoryText)){let s="";r.length>0&&(r+=" AND "),s="Leads"==i.CategoryText?"LeadID":"Opportunity"==i.CategoryText?"OpportunityID":this.drrCCTbl[0].PK.toString(),r+=this.Entities[i.CategoryText]+"."+s+"="+this.Entities.values[a]+".FeaturePK",r+=" AND "+this.Entities.values[a]+".FeatureID="+i.CategoryValue}}else if("CRM_ACTIVITIES"==i.Table.toUpperCase()){if(144!=i.CategoryValue&&this.Entities.ContainsKey(i.CategoryText)&&null!=i.ParentTableAlias&&this.Entities.ContainsKey(i.ParentTableAlias))r.length>0&&(r+=" AND "),r+=this.Entities[i.ParentTableAlias]+"."+i.ParentColumn+"="+this.Entities.values[a]+"."+i.ParentCostCenterColSysName,r+=" AND "+this.Entities.values[a]+".CostCenterID="+i.CategoryValue;else if(this.Filter.ActivityTypes.Visible){let s="";this.Filter.ActivityTypes.Items.forEach(E=>{E.IsChecked&&(s+=E.Value+",")}),s.length>0&&(s=s.TrimEnd(","),s.Contains(",")?r+=this.Entities.values[a]+".CostCenterID IN ("+s+")":r+=this.Entities.values[a]+".CostCenterID="+s)}if(this.Filter.UsersList.Visible){let s="";this.Filter.UsersList.Items.forEach(E=>{E.IsChecked&&(s+=E.Value+",")}),0==s.length&&"1"!=N.d.SessionManager.RoleID&&(s="-1"),s.length>0&&(s=s.TrimEnd(","),s.length>0&&(this.sbQuery.length>0&&(this.sbQuery+=","),this.sbQuery+="  (select a.ISFROMACTIVITY,a.ccid,a.CCNODEID  from CRM_Assignment a with(nolock) where ISFROMACTIVITY>0 and UserID>0 and IsTeam=0 and IsRole=0 and IsGroup=0 and TeamNodeID=0 and a.UserID IN ("+s+") union select a.ISFROMACTIVITY,a.ccid,a.ccnodeid  from CRM_Assignment a with(nolock) join ADM_UserRoleMap map  with(nolock) on a.userid=map.roleid where ISFROMACTIVITY>0 and  a.UserID>0 and a.IsTeam=0 and a.IsRole=1 and a.IsGroup=0 and map.UserID IN ("+s+") union select a.ISFROMACTIVITY,a.ccid,a.ccnodeid  from CRM_Assignment a with(nolock) join com_groups g on a.TeamNodeID=g.gid join ADM_UserRoleMap map  with(nolock) on g.userid=map.userid or g.roleid=map.roleid where ISFROMACTIVITY>0 and  a.UserID=0 and a.IsTeam=0 and a.IsRole=0 and a.IsGroup=1 and a.TeamNodeID>0  and map.UserID IN ("+s+") union select a.ISFROMACTIVITY,a.ccid,a.ccnodeid   from CRM_Assignment a with(nolock) join CRM_Teams T   with(nolock) on a.TEAMNodeID=T.TEAMID and a.userid=t.userid where ISFROMACTIVITY>0 and a.UserID>0 and a.IsTeam=0 AND a.TeamNodeID>0 and a.IsRole=0 and a.IsGroup=0  and T.UserID IN ("+s+")) T ",r.length>0&&(r+=" AND "),r+="T.ISFROMACTIVITY="+this.Entities.values[a]+".ActivityID and T.ccid="+this.Entities.values[a]+".COSTCENTERID AND T.CCNODEID="+this.Entities.values[a]+".NODEID"))}}else"CRM_FEEDBACK"==i.Table.toUpperCase()||"CRM_LEADCVRDETAILS"==i.Table.toUpperCase()?this.Entities.ContainsKey(i.CategoryText)&&(r.length>0&&(r+=" AND "),r+=this.Entities[i.ParentTableAlias]+"."+i.ParentColumn+"="+this.Entities.values[a]+"."+i.ParentCostCenterColSysName,r+=" AND "+this.Entities.values[a]+".CCID="+i.CategoryValue):"CRM_PRODUCTMAPPING"==i.Table.toUpperCase()?this.Entities.ContainsKey(i.CategoryText)&&(r.length>0&&(r+=" AND "),r+=this.Entities[i.ParentTableAlias]+"."+i.ParentColumn+"="+this.Entities.values[a]+"."+i.ParentCostCenterColSysName,r+=" AND "+this.Entities.values[a]+".CostCenterID="+i.CategoryValue):"COM_NOTES"==i.Table.toUpperCase()?this.Entities.ContainsKey(i.CategoryText)&&(r.length>0&&(r+=" AND "),r+=this.Entities[i.ParentTableAlias]+"."+i.ParentColumn+"="+this.Entities.values[a]+"."+i.ParentCostCenterColSysName,r+=" AND "+this.Entities.values[a]+".FeatureID="+i.CategoryValue):i.IsForeignKey&&(r.length>0&&(r+=" AND "),"ACC"==this.Entities[i.ParentTableAlias]&&"AccountID"==i.ParentColumn?(r+="((ACC.DebitAccount>0 and ACC.DebitAccount="+this.Entities.values[a]+".AccountID) or (ACC.CreditAccount>0 and ACC.CreditAccount="+this.Entities.values[a]+".AccountID))",X.push(this.Entities.values[a]),y.push(this.Entities.values[a])):(r+=this.ShowOnlyAccountingData&&f.ShowAccountingData&&f.IsInventory&&(2==i.ParentCostCenterID||12==i.ParentCostCenterID)?"ACC."+i.ParentColumn+"="+this.Entities.values[a]+"."+i.ParentCostCenterColSysName:this.Entities[i.ParentTableAlias]+"."+i.ParentColumn+"="+this.Entities.values[a]+"."+i.ParentCostCenterColSysName,0==C.J0.stringCompare("DebitAccount",i.ParentColumn,!0)?X.push(this.Entities.values[a]):0==C.J0.stringCompare("CreditAccount",i.ParentColumn,!0)?y.push(this.Entities.values[a]):0==C.J0.stringCompare("Account1",i.ParentColumn,!0)&&(X.push(this.Entities.values[a]),y.push(this.Entities.values[a])),65==i.CategoryValue?26645==i.FieldValue?r+=" AND "+this.Entities[i.ParentTableAlias]+".FeatureID=2":26644==i.FieldValue&&(r+=" AND "+this.Entities[i.ParentTableAlias]+".FeatureID=83"):24==i.CategoryValue&&107==i.FieldValue?r+=" AND "+this.Entities[i.ParentTableAlias]+".ProductID="+this.Entities.values[a]+".ProductID":86==i.CategoryValue?27179==i.FieldValue?r+=" AND "+this.Entities[i.ParentTableAlias]+".Mode=3":27180==i.FieldValue&&(r+=" AND "+this.Entities[i.ParentTableAlias]+".Mode=2"):73==i.CategoryValue&&(27303==i.FieldValue?r+=" AND "+this.Entities[i.ParentTableAlias]+".CustomerMode=2":27304==i.FieldValue&&(r+=" AND "+this.Entities[i.ParentTableAlias]+".CustomerMode=1"))),0==C.J0.stringCompare(i.Table,"COM_CCCCData",!0)&&(r+=" AND "+this.Entities.values[a]+".CostCenterID="+i.CategoryValue),this.IsHistory&&k.HistoryTables.keys.Contains(this.iHistoryStatusID)&&k.HistoryTables[this.iHistoryStatusID].Contains(i.Table)&&(r+=this.iHistoryStatusID>=11701&&this.iHistoryStatusID<=11750?" AND "+this.Entities[i.ParentTableAlias]+".NodeHistoryID="+this.Entities.values[a]+".NodeHistoryID":" AND "+this.Entities[i.ParentTableAlias]+".ModifiedDate="+this.Entities.values[a]+".ModifiedDate"));if(null!=i.ParentCDGDO){let s=this.FieldsDialog.Relations.filter(E=>E.PK_Table==i.ParentCDGDO.Table.toUpperCase()&&E.FK_Table==i.Table.toUpperCase());s.length>0?(r.length>0&&(r+=" AND "),r+=this.Entities[i.ParentCDGDO.CategoryText]+"."+s[0].PK_Column.toString()+"="+this.Entities.values[a]+"."+s[0].FK_Column.toString(),this.IsHistory&&k.HistoryTables.keys.Contains(this.iHistoryStatusID)&&k.HistoryTables[this.iHistoryStatusID].Contains(i.Table)&&(r+=" AND "+this.Entities[i.ParentCDGDO.CategoryText]+".ModifiedDate="+this.Entities.values[a]+".ModifiedDate")):(s=this.FieldsDialog.Relations.filter(E=>E.FK_Table==i.ParentCDGDO.Table.toUpperCase()&&E.PK_Table==i.Table.toUpperCase()),s.length>0&&(r.length>0&&(r+=" AND "),r+=this.Entities[i.ParentCDGDO.CategoryText]+"."+s[0].FK_Column.toString()+"="+this.Entities.values[a]+"."+s[0].PK_Column.toString()))}e++}}}!this.Entities.values.Contains("TDCC")&&this.Filter.CostCenterFilters.find(a=>a.CostCenterID>5e4)&&(this.Entities.values.Contains("INV")||this.Entities.values.Contains("ACC"))&&(this.IsNewFromClause?(this.sbQuery+=" join COM_DocCCDATA TDCC with(nolock) on ",this.Entities.values.Contains("INV")?this.sbQuery+="INV.InvDocDetailsID=TDCC.InvDocDetailsID":this.sbQuery+="ACC.AccDocDetailsID=TDCC.AccDocDetailsID"):(this.sbQuery+=",COM_DocCCDATA TDCC with(nolock)",r.length>0&&(r+=" AND "),this.Entities.values.Contains("INV")?r+="INV.InvDocDetailsID=TDCC.InvDocDetailsID":r+="ACC.AccDocDetailsID=TDCC.AccDocDetailsID")),this.FromTagExtra.length>0&&(this.sbQuery+=this.FromTagExtra),this.ShowUnAppDocsToApprove&&!this.ShowUnAppDocsToApprove_UseFuncCall&&(this.sbQuery+=",#TblUsrWF WF");let _=this.BaseReportColumns.find(a=>27296==a.CDGDO.FieldValue);if(_&&(this.sbQuery+=" LEFT JOIN CRM_Assignment ASS WITH(nolock) ON "+this.Entities[_.CDGDO.CategoryText]+".ActivityID=ASS.ISFROMACTIVITY LEFT JOIN ADM_Users U WITH(NOLOCK) ON ASS.UserID=U.UserID"),null!=o){this.sbQuery+=",COM_BudgetAlloc BALL with(nolock)";let a,i="BALL.BudgetDefID="+m;o.Tables[0].forEach(s=>{a=parseInt(s.CostCenterID),a>5e4?(i+=" AND BALL.CCNID"+(a-5e4)+"="+this.Entities.Documents_CCMAP+".dcCCNID"+(a-5e4),this.SelectTag+=",BALL.CCNID"+(a-5e4)+" AS BUD_"+a):2==a?(i+=this.IsInventory?" AND (BALL.AccountID=INV.DebitAccount OR BALL.AccountID=INV.CreditAccount)":" AND (BALL.AccountID=ACC.DebitAccount OR BALL.AccountID=ACC.CreditAccount)",this.SelectTag+=",BALL.AccountID AS BUD_2"):3==a&&(this.IsInventory&&(i+=" AND BALL.ProductID=INV.ProductID"),this.SelectTag+=",BALL.ProductID AS BUD_3")}),r.length>0?r+=" AND "+i:r=i}this.FromTag=this.sbQuery.toString(),this.sbQuery="";let d="";d+=r;let Y=0;if(this.Filter.IsReportViewScreen){let a=this;a.Preferences.ContainsKey("DebitCreditAccountFilter")&&("CreditAccount"==a.Preferences.DebitCreditAccountFilter?Y=1:"Both"==a.Preferences.DebitCreditAccountFilter&&(Y=2))}let j=this.Filter.CostCenterFilters.find(a=>502==a.CostCenterID),se=this.Filter.CostCenterFilters.find(a=>-502==a.CostCenterID);if(j||se){let a="",i="";if(j&&j.SelectedNodes.forEach(s=>{a.length>0&&(a+=","),a+=s.Id}),se&&se.SelectedNodes.forEach(s=>{i.length>0&&(i+=","),i+=s.Id}),a.length>0||i.length>0){let s="ACC",E=null,p=null;f.IsInventory&&(s="INV"),X.length>0?E=X[0]+".AccountTypeID":this.ShowDebitCreditAmount&&f.ShowAccountingData&&!f.IsDebit&&0==i.length||(this.FromTag+=",ACC_Accounts XADRX with(nolock)",d.length>0&&(d+=" AND "),d+="XADRX.AccountID="+s+".DebitAccount",E="XADRX.AccountTypeID"),y.length>0?p=y[0]+".AccountTypeID":this.ShowDebitCreditAmount&&f.ShowAccountingData&&f.IsDebit&&0==i.length||(this.FromTag+=",ACC_Accounts XACRX with(nolock)",d.length>0&&(d+=" AND "),d+="XACRX.AccountID="+s+".CreditAccount",p="XACRX.AccountTypeID"),d.length>0&&(d+=" AND "),this.ShowDebitCreditAmount&&f.ShowAccountingData?(a.length>0&&(d+=f.IsDebit?E:p,a.Contains(",")?d+=" in ("+a+")":d+="="+a),i.length>0&&(a.length>0&&(d+=" and "),d+=f.IsDebit?p:E,i.Contains(",")?d+=" in ("+i+")":d+="="+i)):a.Contains(",")?d+="("+E+" in ("+a+") or "+p+" in ("+a+"))":d+="("+E+"="+a+" or "+p+"="+a+")"}}let ne=0,le="1"==N.d.SessionManager.UserID||"1"==N.d.SessionManager.RoleID;for(let a=0;a<this.Filter.CostCenterFilters.length;a++){let i=this.Filter.CostCenterFilters[a];if(300!=i.CostCenterID&&-100!=i.CostCenterID&&502!=i.CostCenterID&&-502!=i.CostCenterID){if(44!=i.CostCenterID)if(113==i.CostCenterID&&Math.abs(f.DocID)>4e4&&Math.abs(f.DocID)<5e4){if(0!=i.SelectedNodes.length){d.length>0&&(d+=" AND "),d+=(f.IsInventory?"INV":"ACC")+".StatusID IN (";for(let s=0;s<i.SelectedNodes.length;s++)s>0&&(d+=","),d+=i.SelectedNodes[s].Id;d+=")"}}else{let s,E="";ne++;let V,p="GT"+ne,O=!1,W=i.CostCenterID;50==i.CostCenterID&&(W=this.Filter.lstPreFetchReportCC[i.LookupTypeID]);for(let x=0;x<this.Objects.length;x++)if("RptManager"!=this.Objects[x].ParentColumn&&(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(B=>B.FeatureID==this.Objects[x].CategoryValue),s=400!=this.Objects[x].CategoryValue||this.IsInventory?this.drrCCTbl[0].TableName.toString():"ACC_DocDetails",(this.Objects[x].IsForeignKey&&this.Objects[x].ColumnCostCenterID==W&&null==this.Objects[x].ParentCDGDO||!this.Objects[x].IsForeignKey&&this.Objects[x].CategoryValue==W&&this.Objects[x].Table==s)&&(O=!0,this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(B=>B.FeatureID==W),this.drrCCTbl.length>0))){if(2==W&&-1==Y)continue;if(V=C.J0.String(this.drrCCTbl[0].PK),2==W&&2==Y){if(Y=-1,i.SelectedNodes.length>0||!i.DeleteButtonVisibility){if(d.length>0&&(d+=" AND "),d+="(",0==E.length){for(let B=0;B<i.SelectedNodes.length;B++)(null==i.SelectedNodes[B].Parent||!i.SelectedNodes[B].Parent.IsSelected)&&(E.length>0&&(E+=","),E+=i.SelectedNodes[B].Id);0==E.length&&(E+=-12912)}X.length>0&&(d+=X[0]+"."+V+"="+p+".GTID"),X.length>0&&y.length>0&&(d+=" OR "),y.length>0&&(d+=y[0]+"."+V+"="+p+".GTID"),d+=")"}}else{if(0==Y){if(y.Contains(this.Entities.values[x]))continue}else if(1==Y&&X.Contains(this.Entities.values[x]))continue;if(this.IsPreProcessQuery&&i.IsPrePocessFilter){this.SelectTag+=","+this.Entities.values[x]+"."+V+" PPQ"+W;continue}if(i.SelectedNodes.length>0||!i.DeleteButtonVisibility)if(d.length>0&&(d+=" AND "),k.IsGroupTree(i)&&(i.DeleteButtonVisibility||le)){if(0==E.length){for(let B=0;B<i.SelectedNodes.length;B++)(null==i.SelectedNodes[B].Parent||!i.SelectedNodes[B].Parent.IsSelected)&&(E.length>0&&(E+=","),E+=i.SelectedNodes[B].Id);0==E.length&&(E+=-12912)}d+=this.Entities.values[x]+"."+V+"="+p+".GTID"}else{let B=null;if(50002==i.CostCenterID&&i.SelectedNodes.length>0&&"True"==N.d.SessionManager.Preferences.EnableLocationWise&&this.Report.ShowLocationFilter&&(B=i.SelectedNodes.find(Q=>2==Q.Id&&Q.IsGroup)),!(null!=B&&B.Children.length>0||N.d.SessionManager.IsEmpUser&&50002==i.CostCenterID&&N.d.SessionManager.IsActionAssigned(50051,"Override Location wise"))){0==this.StaticReportType&&7==i.CostCenterID&&(d+="("),d+=this.Entities.values[x]+"."+V+" IN (";for(let Q=0;Q<i.SelectedNodes.length;Q++)Q>0&&(d+=","),d+=i.SelectedNodes[Q].Id;0==i.SelectedNodes.length&&(d+=-12912),d+=")"}}}}if(!O&&W>5e4&&(this.Entities.values.Contains("INV")||this.Entities.values.Contains("ACC"))&&(i.SelectedNodes.length>0||!i.DeleteButtonVisibility))if(d.length>0&&(d+=" AND "),V="TDCC.dcCCNID"+(W-5e4),k.IsGroupTree(i)&&(i.DeleteButtonVisibility||le)){if(0==E.length){for(let x=0;x<i.SelectedNodes.length;x++)(null==i.SelectedNodes[x].Parent||!i.SelectedNodes[x].Parent.IsSelected)&&(E.length>0&&(E+=","),E+=i.SelectedNodes[x].Id);0==E.length&&(E+=-12912)}d+=V+"="+p+".GTID"}else{d+=V+" IN (";for(let x=0;x<i.SelectedNodes.length;x++)x>0&&(d+=","),d+=i.SelectedNodes[x].Id;0==i.SelectedNodes.length&&(d+=-12912),d+=")"}if(E.length>0&&(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(x=>x.FeatureID==W),this.FromTag+="\r\n ,(select T."+this.drrCCTbl[0].PK.toString()+" GTID from "+this.drrCCTbl[0].TableName.toString()+" T with(nolock),"+this.drrCCTbl[0].TableName.toString()+" "+p+" with(nolock) where T.lft BETWEEN "+p+".lft AND "+p+".rgt AND "+p+"."+this.drrCCTbl[0].PK.toString()+" IN ("+E.toString()+") group by T."+this.drrCCTbl[0].PK.toString()+") AS "+p),7==W&&i.SelectedNodes.length>0){let x=[];x.AddRange(this.BaseReportColumns),x.AddRange(this.ReportGroups),x.forEach(B=>{if("CreatedBy"==B.CDGDO.Column||"ModifiedBy"==B.CDGDO.Column){d.length>0&&(d+=0==this.StaticReportType&&7==i.CostCenterID?" OR ":" AND "),0==d.length&&(d+="("),d+=B.CDGDO.ActualColumn+" IN (";for(let Q=0;Q<i.SelectedNodes.length;Q++)Q>0&&(d+=","),d+="'"+i.SelectedNodes[Q].Text[0]+"'";0==i.SelectedNodes.length&&(d+="NO USER"),d+=")"}}),d+=")"}}else if(i.SelectedNodes.length>0){let s=this.BaseReportColumns.find(E=>E.CDGDO.ColumnCCListViewTypeID==i.LookupTypeID&&(44==E.CDGDO.ColumnCostCenterID||44==E.CDGDO.LocalReference));if(s||(s=this.ReportGroups.find(E=>E.CDGDO.ColumnCCListViewTypeID==i.LookupTypeID&&(44==E.CDGDO.ColumnCostCenterID||44==E.CDGDO.LocalReference))),s){d.length>0&&(d+=" AND "),d+=s.CDGDO.ActualTable+" IN (";for(let E=0;E<i.SelectedNodes.length;E++)E>0&&(d+=","),d+="'"+i.SelectedNodes[E].Id+"'";0==i.SelectedNodes.length&&(d+="NO USER"),d+=")"}}}else 300==i.CostCenterID&&this.IsPreProcessQuery&&i.IsPrePocessFilter&&this.Entities.ContainsKey("Documents")&&(this.SelectTag+=","+this.Entities.Documents+".CostCenterID PPQ"+i.CostCenterID)}if(M.length>0&&(d.length>0&&(d+=" AND "),d+="("+M+")"),this.BaseReportColumns.find(a=>103==a.CDGDO.CategoryValue)?(d.length>0&&(d+=" AND "),d+=(this.Entities.ContainsKey("Quotation")?this.Entities.Quotation:"T0")+".CostCenterID=103"):this.BaseReportColumns.find(a=>129==a.CDGDO.CategoryValue)&&(d.length>0&&(d+=" AND "),d+=(this.Entities.ContainsKey("Unit Reservation")?this.Entities["Unit Reservation"]:"T0")+".CostCenterID=129"),this.BaseReportColumns.find(a=>251==a.CDGDO.CategoryValue)?(d.length>0&&(d+=" AND "),d+="T0.DType=251"):this.BaseReportColumns.find(a=>252==a.CDGDO.CategoryValue)?(d.length>0&&(d+=" AND "),d+="T0.DType=252"):this.BaseReportColumns.find(a=>253==a.CDGDO.CategoryValue)?(d.length>0&&(d+=" AND "),d+="T0.DType=253"):this.BaseReportColumns.find(a=>254==a.CDGDO.CategoryValue)?(d.length>0&&(d+=" AND "),d+="T0.DType=254"):this.BaseReportColumns.find(a=>255==a.CDGDO.CategoryValue)&&(d.length>0&&(d+=" AND "),d+="T0.DType=255"),this.ShowDebitCreditAmount&&f.ShowAccountingData){f.IsInventory||(d.length>0&&(d+=" AND "),d+=f.IsDebit?"ACC.DebitAccount>0":"ACC.CreditAccount>0");let a="";a=0==this.UnPostedDocsList.length?"(ACC.StatusID=369 or ACC.StatusID=429)":" ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")",d.length>0&&(d+=" AND "),d+=f.IsInventory?a:this.PDCInclude?"(ACC.StatusID=370 OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19 and "+a+"))":"ACC.DocumentType<>14 AND ACC.DocumentType<>19 and "+a}if(this.Entities.ContainsKey("Asset Management")){d.length>0&&(d+=" AND "),d+=this.Entities["Asset Management"]+".IsGroup=0";var g=this.Filter.Fields.find(a=>169==a.CDGDO.FieldValue);if(g){try{0==this.StaticReportType&&N.d.report.GetDataTable("RPT057",g.FromDatePicker.Date.ToString("dd MMM yyyy"),g.ToDatePicker.Date.ToString("dd MMM yyyy"))}catch{}d+=" AND "+this.Entities["Asset Management"]+".DeprStartDate<=convert(float,convert(datetime,'"+g.ToDatePicker.Date.ToString("dd MMM yyyy")+"'))"}}let J="",ie="";for(let a=0;a<this.Filter.Fields.length;a++){let i=this.Filter.Fields[a];if(this.SetActualColumn(i.CDGDO,f),"NULL"!=i.CDGDO.ActualColumn&&(f.IsInventory||"LinkStatusID"!=i.CDGDO.ParentColumn)&&!(this.EmpAsonDate.length>0&&null!=this.EmpAsonDate.filter(s=>s==i.CDGDO))){if(J="","DATE"==i.CDGDO.DataType){if(this.Filter.IsReportViewScreen&&!this.DontApplyDateFilter){if(this.IsPreProcessQuery&&i.IsPrePocessFilter){let p="";p=i.CDGDO.ActualColumn.Contains("CreatedDate")||i.CDGDO.ActualColumn.Contains("ModifiedDate")?i.CDGDO.ActualColumn.Replace("CONVERT(DATETIME,","CONVERT(DATETIME,floor(")+")":i.CDGDO.Column.startsWith("dcAlpha")?"CONVERT(DATE,CONVERT(DATETIME,"+i.CDGDO.ActualTable+"."+i.CDGDO.Column+"))":i.CDGDO.ActualColumn,this.SelectTag+=","+p+" PPQ"+i.ID.Replace("-","")}let s="";if(i.CDGDO.Column.startsWith("dcAlpha")&&(67==i.CDGDO.DocumentType&&"DCALPHA1"==i.CDGDO.Column.toUpperCase()&&(s+="ISNULL("+i.CDGDO.ActualTable+"."+i.CDGDO.Column+",'')<>'' AND LEN("+i.CDGDO.ActualTable+"."+i.CDGDO.Column+")=11 AND "),s+="isDate("+i.CDGDO.ActualTable+"."+i.CDGDO.Column+")=1 AND ",s+="isNumeric("+i.CDGDO.ActualTable+"."+i.CDGDO.Column+")=0 AND "),i.CDGDO.ActualColumn.Contains("CreatedDate")||i.CDGDO.ActualColumn.Contains("ModifiedDate")?s+=i.CDGDO.ActualColumn.replace("CONVERT(DATETIME,","CONVERT(DATETIME,floor(")+")":i.CDGDO.Column.startsWith("dcAlpha")?67==i.CDGDO.DocumentType&&"DCALPHA1"==i.CDGDO.Column.toUpperCase()?s+="CONVERT(DATETIME,REPLACE(REPLACE("+i.CDGDO.ActualTable+"."+i.CDGDO.Column+",'/',' '),'-',' '))":s+="CONVERT(DATE,CONVERT(DATETIME,"+i.CDGDO.ActualTable+"."+i.CDGDO.Column+"))":s+=i.CDGDO.ActualColumn,"Between"==i.Condition.SelectedValue||"NotBetween"==i.Condition.SelectedValue)s+=i.Condition.SelectedItem.Parent,s+="'"+i.FromDatePicker.Date.ToString("dd MMM yyyy")+"' AND ",s+="'"+i.ToDatePicker.Date.ToString("dd MMM yyyy")+"'";else if("FUTURE"==i.Condition.SelectedValue||"PAST"==i.Condition.SelectedValue){let p;i.ToDatePicker.Mode=1,i.FromDatePicker.Mode=1,p=C.J0.Int(i.FromValue.TextBox.Text),0==p&&(p=1);let V="";if(V=""!=i.FromValue.ComboBox.SelectedValue?i.FromValue.ComboBox.SelectedValue:"Days","Days"==V)"FUTURE"==i.Condition.SelectedValue?(i.FromDatePicker.Date=Date.Today(),i.ToDatePicker.Date=Date.Today().AddDays(p)):(i.FromDatePicker.Date=Date.Today().AddDays(-p),i.ToDatePicker.Date=Date.Today());else if("Weeks"!=V)if("Months"==V)if("FUTURE"==i.Condition.SelectedValue){let O=Date.Today().AddMonths(p);O=O.MonthsFirst(),i.FromDatePicker.Date=O,O=O.AddMonths(p).AddDays(-1),i.ToDatePicker.Date=O}else{let O=Date.Today().AddMonths(-p);O=O.MonthsFirst(),i.FromDatePicker.Date=O,O=O.AddMonths(p).AddDays(-1),i.ToDatePicker.Date=O}else if("Quarter"==V)if("FUTURE"==i.Condition.SelectedValue){let O=Date.Today().AddMonths(3*p);O=new Date(O.getFullYear(),O.getMonth()-(O.getMonth()-1)%3,1),i.FromDatePicker.Date=O,O=O.AddMonths(3*p).AddDays(-1),i.ToDatePicker.Date=O}else{let O=Date.Today().AddMonths(3*-p);O=new Date(O.getFullYear(),O.getMonth()-(O.getMonth()-1)%3,1),i.FromDatePicker.Date=O,O=O.AddMonths(3*p).AddDays(-1),i.ToDatePicker.Date=O}else if("Year"==V)if("FUTURE"==i.Condition.SelectedValue){let O=Date.Today().AddYears(p);O=new Date(O.getFullYear(),0,1),i.FromDatePicker.Date=O,O=O.AddYears(p-1),O=new Date(O.getFullYear(),11,31),i.ToDatePicker.Date=O}else{let O=Date.Today().AddYears(1-p);O=new Date(O.getFullYear(),0,1),i.FromDatePicker.Date=O,i.ToDatePicker.Date=Date.Today()}s+=" BETWEEN ",s+="'"+i.FromDatePicker.Date.ToString("dd MMM yyyy")+"' AND ",s+="'"+i.ToDatePicker.Date.ToString("dd MMM yyyy")+"'"}else"IsNull"==i.Condition.SelectedValue||"IsNotNull"==i.Condition.SelectedValue?s+=i.Condition.SelectedItem.Parent:(s+=i.Condition.SelectedItem.Parent,s+="'"+i.FromDatePicker.Date.ToString("dd MMM yyyy")+"'");let E="";if("Between"==i.Condition.SelectedValue||"FUTURE"==i.Condition.SelectedValue||"PAST"==i.Condition.SelectedValue){let p=new Date(i.ToDatePicker.Date.getFullYear(),N.d.SessionManager.AccountingFromMonth-1,1);p>i.ToDatePicker.Date&&(p=p.AddYears(-1));let V="";if(i.CDGDO.Column.startsWith("dcAlpha")&&(67==i.CDGDO.DocumentType&&"DCALPHA1"==i.CDGDO.Column.toUpperCase()&&(V+="ISNULL("+i.CDGDO.ActualTable+"."+i.CDGDO.Column+",'')<>'' AND LEN("+i.CDGDO.ActualTable+"."+i.CDGDO.Column+")=11 AND "),V="isDate("+i.CDGDO.ActualTable+"."+i.CDGDO.Column+")=1 AND ",V="isNumeric("+i.CDGDO.ActualTable+"."+i.CDGDO.Column+")=0 AND "),i.CDGDO.ActualColumn.Contains("CreatedDate")||i.CDGDO.ActualColumn.Contains("ModifiedDate")?V+=i.CDGDO.ActualColumn.replace("CONVERT(DATETIME,","CONVERT(DATETIME,floor(")+")":i.CDGDO.Column.startsWith("dcAlpha")?V+="CONVERT(DATETIME,"+i.CDGDO.ActualTable+"."+i.CDGDO.Column+")":V+=i.CDGDO.ActualColumn,this.RepeatShowPrevMn){let O=p.AddYears(-1);for(let W=1;W<=this.RepeatPrevData;W++){if(E+=" OR ("+V+" BETWEEN ",this.RepeatPrevDataFull)E+="'"+O.ToString("dd MMM yyyy")+"' AND ",E+="'"+O.AddYears(1).AddDays(-1).ToString("dd MMM yyyy")+"'",O=O.AddYears(-1);else if(this.RepeatPrevDataOfCurrYr&&this.RepeatType==z.b2.Monthly){let x=new Date(i.FromDatePicker.Date.getFullYear(),i.FromDatePicker.Date.getMonth(),1);x=x.AddMonths(-W),E+="'"+x.ToString("dd MMM yyyy")+"' AND ",E+="'"+x.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'"}else E+="'"+i.FromDatePicker.Date.AddYears(-W).ToString("dd MMM yyyy")+"' AND ",E+="'"+i.ToDatePicker.Date.AddYears(-W).ToString("dd MMM yyyy")+"'";E+=")"}this.RepeatEmptyColumns=1}this.BaseReportColumns.find(O=>!C.J0.IsEmpty(O.Formula.Text)&&O.Formula.Text.Contains("PRV_YEARSTART"))||this.ReportGroups.find(O=>!C.J0.IsEmpty(O.Formula.Text)&&O.Formula.Text.Contains("PRV_YEARSTART"))?(this.PrevDateColumsUsed=!0,E+=" OR ("+V+" BETWEEN ",E+="'"+p.AddYears(-1).ToString("dd MMM yyyy")+"' AND ",E+="'"+p.AddDays(-1).ToString("dd MMM yyyy")+"'",E+=")"):this.BaseReportColumns.find(O=>!C.J0.IsEmpty(O.Formula.Text)&&O.Formula.Text.Contains("PRV_YEARFROMDATE"))||this.ReportGroups.find(O=>!C.J0.IsEmpty(O.Formula.Text)&&O.Formula.Text.Contains("PRV_YEARFROMDATE"))||this.BaseReportColumns.find(O=>!C.J0.IsEmpty(O.Formula.Text)&&O.Formula.Text.Contains("PRV_YEARTODATE"))||this.ReportGroups.find(O=>!C.J0.IsEmpty(O.Formula.Text)&&O.Formula.Text.Contains("PRV_YEARTODATE"))?(this.PrevDateColumsUsed=!0,E+=" OR ("+V+" BETWEEN ",E+="'"+i.FromDatePicker.Date.AddYears(-1).ToString("dd MMM yyyy")+"' AND ",E+="'"+i.ToDatePicker.Date.AddYears(-1).ToString("dd MMM yyyy")+"'",E+=")"):(null!=this.BaseReportColumns.find(O=>!C.J0.IsEmpty(O.Formula.Text)&&O.Formula.Text.Contains("PRV_MONTHFROMDATE"))||null!=this.ReportGroups.find(O=>!C.J0.IsEmpty(O.Formula.Text)&&O.Formula.Text.Contains("PRV_MONTHFROMDATE"))||null!=this.BaseReportColumns.find(O=>!C.J0.IsEmpty(O.Formula.Text)&&O.Formula.Text.Contains("PRV_MONTHTODATE"))||null!=this.ReportGroups.find(O=>!C.J0.IsEmpty(O.Formula.Text)&&O.Formula.Text.Contains("PRV_MONTHTODATE")))&&(this.PrevDateColumsUsed=!0,E+=" OR ("+V+" BETWEEN ",E+="'"+i.FromDatePicker.Date.AddMonths(-1).ToString("dd MMM yyyy")+"' AND ",E+="'"+i.ToDatePicker.Date.AddMonths(-1).ToString("dd MMM yyyy")+"'",E+=")")}E.length>0?(J+="(("+s+")",J+=E.toString(),J+=")"):J+=s}}else if("Between"==i.Condition.SelectedValue||"NotBetween"==i.Condition.SelectedValue)if(i.FromValue.Visible){if(C.J0.IsEmpty(i.FromValue.TextBox.Text)&&C.J0.IsEmpty(i.ToValue.Text))continue;J+=i.CDGDO.ActualColumn,J+=i.Condition.SelectedItem.Parent,J+="'"+i.FromValue.TextBox.Text+"' AND ",J+="'"+i.ToValue.Text+"'"}else{if(C.J0.IsEmpty(i.FromList.Text)&&C.J0.IsEmpty(i.ToList.Text))continue;J+=i.CDGDO.ActualColumn,J+=i.Condition.SelectedItem.Parent,J+="'"+i.FromList.Text+"' AND ",J+="'"+i.ToList.Text+"'"}else if("Contains"==i.Condition.SelectedValue||"NotContain"==i.Condition.SelectedValue){if(C.J0.IsEmpty(i.FromValue.TextBox.Text))continue;J+=i.CDGDO.ActualColumn,J+=i.Condition.SelectedItem.Parent,J+="'%"+i.FromValue.TextBox.Text+"%'"}else if("IsNull"==i.Condition.SelectedValue||"IsNotNull"==i.Condition.SelectedValue)J+=i.CDGDO.ActualColumn,J+=i.Condition.SelectedItem.Parent;else if(i.FromValue.Visible){if(C.J0.IsEmpty(i.FromValue.TextBox.Text))continue;J+=i.CDGDO.ActualColumn,J+=i.Condition.SelectedItem.Parent,J+="'"+i.FromValue.TextBox.Text+"'"}else if(i.FromList.CCID>0){if(0==i.FromList.SelectedValue&&3!=i.FromList.CCID)continue;this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(s=>s.FeatureID==i.FromList.CCID),i.CDGDO.Column.startsWith("CCNID")&&null!=i.CDGDO.ChildCDGDO?J+=this.Entities[i.CDGDO.ChildCDGDO.CategoryText]+"."+this.drrCCTbl[0].PK.toString():J+=this.Entities[i.CDGDO.CategoryText]+"."+this.drrCCTbl[0].PK.toString(),J+=i.Condition.SelectedItem.Parent,J+=i.FromList.SelectedValue}J.length>0&&(i.QuickSearchField.IsChecked?(ie.length>0&&(ie+=" OR "),ie+=J):(d.length>0&&(d+=" AND "),d+=J))}}if(ie.length>0&&(d.length>0&&(d+=" AND "),d+="("+ie+")"),!this.IsInventory&&this.Entities.values.Contains("ACC")&&this.Filter.IsReportViewScreen&&!this.Report.Preferences.ContainsKey("extrafieldsaccountposting")&&(d.length>0&&(d+=" AND "),d+="ACC.LinkedAccDocDetailsID is null"),this.IsNewFromClause&&f.IsInventory&&this.Filter.IsReportViewScreen&&this.Report.Preferences.ContainsKey("ExQtyCol")){var S=this.BaseReportColumns.find(a=>a.ID==this.Report.Preferences.ExQtyCol);S&&(d.length>0&&(d+=" AND "),!C.J0.IsEmpty(S.CDGDO.ActualColumn)&&S.CDGDO.ActualColumn.Contains("ExQ")?d+="1"==this.Report.Preferences.ExQtyType?"(INV.LinkStatusID=445 or "+S.CDGDO.ActualTable+"=INV.Quantity)":"INV.LinkStatusID!=445 and ("+S.CDGDO.ActualTable+" is null or "+S.CDGDO.ActualTable+"<INV.Quantity)":d+="1"==this.Report.Preferences.ExQtyType?"(INV.LinkStatusID=445 or ("+S.CDGDO.ActualColumn+")=INV.Quantity)":"INV.LinkStatusID!=445 and ("+S.CDGDO.ActualColumn+")<INV.Quantity")}if(null!=this.TQDocPrefix&&(this.ReportViewType==z.Zv.TransactionQuery||this.ReportViewType==z.Zv.LinkingQuery&&"LINKED_VOUCHERS"==t)){if(null!=this.TQDocPrefix.SelectedValue&&"ALL"!=this.TQDocPrefix.SelectedValue&&(d.length>0&&(d+=" AND "),d+=this.IsInventory?"INV.DocPrefix='"+this.TQDocPrefix.SelectedValue+"'":"ACC.DocPrefix='"+this.TQDocPrefix.SelectedValue+"'"),!C.J0.IsEmpty(this.TQDocNo_From.Text)){let a=C.J0.Int(this.TQDocNo_From.Text);C.J0.IsNum(this.TQDocNo_From.Text)&&(d.length>0&&(d+=" AND "),d+=this.IsInventory?"INV.DocNumber>="+a:"ACC.DocNumber>="+a)}if(!C.J0.IsEmpty(this.TQDocNo_To.Text)){let a=C.J0.Int(this.TQDocNo_To.Text);C.J0.IsNum(this.TQDocNo_To.Text)&&(d.length>0&&(d+=" AND "),d+=this.IsInventory?"INV.DocNumber<="+a:"ACC.DocNumber<="+a)}}if(this.ReportViewType==z.Zv.LinkingQuery&&"LINKED_SUB_VOUCHERS"==t&&(d.length>0&&(d+=" AND "),d+="INV.VoucherNo='"+this.LinkSubVoucherNo+"'"),this.IsAuthLevelReport&&(d.length>0&&(d+=" AND "),u=this.BaseReportColumns.find(i=>95==i.CDGDO.CategoryValue||103==i.CDGDO.CategoryValue||104==i.CDGDO.CategoryValue||129==i.CDGDO.CategoryValue),d+=u&&95==u.CDGDO.CategoryValue?this.Entities.Contract+".WorkFlowID>0":u&&103==u.CDGDO.CategoryValue?this.Entities.Quotation+".WorkFlowID>0":u&&104==u.CDGDO.CategoryValue?this.Entities["Purchase Contract"]+".WorkFlowID>0":u&&129==u.CDGDO.CategoryValue?this.Entities["Unit Reservation"]+".WorkFlowID>0":this.IsInventory?"INV.WorkFlowID>0":"ACC.WorkFlowID>0 AND ACC.InvDocDetailsID IS NULL"),this.ShowUnAppDocsToApprove)if(this.ShowUnAppDocsToApprove_UseFuncCall)this.IsAuthLevelReport||(d.length>0&&(d+=" AND "),d+=this.IsInventory?"INV.WorkFlowID>0":"ACC.WorkFlowID>0 AND ACC.InvDocDetailsID IS NULL"),d.length>0&&(d+=" AND "),d+=this.IsInventory?w:w.Replace("INV.","ACC.");else{d.length>0&&(d+=" AND ");let a=this.BaseReportColumns.find(i=>95==i.CDGDO.CategoryValue||103==i.CDGDO.CategoryValue||104==i.CDGDO.CategoryValue||129==i.CDGDO.CategoryValue);d+=a&&95==a.CDGDO.CategoryValue?" WF.WID="+this.Entities.Contract+".WorkflowID and WF.LevelID>"+this.Entities.Contract+".WorkFlowLevel and("+this.Entities.Contract+".StatusID = 440 or "+this.Entities.Contract+".StatusID = 466 or "+this.Entities.Contract+".StatusID = 470) AND(WF.Type = 1 or("+this.Entities.Contract+".WorkFlowLevel + 1=WF.LevelID and "+this.Entities.Contract+".StatusID != 470)) ":a&&103==a.CDGDO.CategoryValue?" WF.WID="+this.Entities.Quotation+".WorkflowID and WF.LevelID>"+this.Entities.Quotation+".WorkFlowLevel  and("+this.Entities.Quotation+".StatusID = 440 or "+this.Entities.Quotation+".StatusID = 466 or "+this.Entities.Quotation+".StatusID = 470) AND(WF.Type = 1 or("+this.Entities.Quotation+".WorkFlowLevel + 1=WF.LevelID and "+this.Entities.Quotation+".StatusID != 470)) ":a&&104==a.CDGDO.CategoryValue?" WF.WID="+this.Entities["Purchase Contract"]+".WorkflowID and WF.LevelID>"+this.Entities["Purchase Contract"]+".WorkFlowLevel and("+this.Entities["Purchase Contract"]+".StatusID = 440 or "+this.Entities["Purchase Contract"]+".StatusID = 466 or "+this.Entities["Purchase Contract"]+".StatusID = 470) AND(WF.Type = 1 or("+this.Entities["Purchase Contract"]+".WorkFlowLevel + 1=WF.LevelID and "+this.Entities["Purchase Contract"]+".StatusID != 470)) ":a&&129==a.CDGDO.CategoryValue?" WF.WID="+this.Entities["Unit Reservation"]+".WorkflowID and WF.LevelID>"+this.Entities["Unit Reservation"]+".WorkFlowLevel and("+this.Entities["Unit Reservation"]+".StatusID = 440 or "+this.Entities["Unit Reservation"]+".StatusID = 466 or "+this.Entities["Unit Reservation"]+".StatusID = 470) AND(WF.Type = 1 or("+this.Entities["Unit Reservation"]+".WorkFlowLevel + 1=WF.LevelID and "+this.Entities["Unit Reservation"]+".StatusID != 470)) ":this.IsInventory?w:w.Replace("INV.","ACC.")}else this.ShowMyUnAppDocsToBeApproved&&(d.length>0&&(d+=" AND "),d+=this.IsInventory?w:w.Replace("INV.","ACC."));if(this.IsInventory&&null!=P&&P.SelectedNodes.length>0){let a="";for(let i=0;i<this.Objects.length;i++)if(this.Entities.keys[i].endsWith("_CCMAP")&&0==C.J0.stringCompare(this.Objects[i].Table,"COM_DOCCCDATA",!0)){a=this.Entities.keys[i];break}C.J0.IsEmpty(a)||(d.length>0&&(d+=" AND "),d+=this.Entities[a]+"."+l+" IN (select NodeID from #TblJobDim)")}if(this.DocumentFilters.ContainsKey("CRM_Masters_DocumentsTab")&&this.Entities.ContainsKey("Documents_CCMAP")&&(d.length>0&&(d+=" AND "),d+=this.DocumentFilters.CRM_Masters_DocumentsTab.Replace("DCC",this.Entities.Documents_CCMAP)),_=this.BaseReportColumns.find(a=>27295==a.CDGDO.FieldValue),_&&(d.length>0&&(d+=" AND "),d+="  ("+this.Entities[_.CDGDO.CategoryText]+".InviteRefActID>0  OR "+this.Entities[_.CDGDO.CategoryText]+".ActivityID IN (select InviteRefActID from CRM_Activities with(nolock)  where InviteRefActID>0))"),C.J0.IsEmpty(N.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(_=this.BaseReportColumns.find(a=>50051==a.CDGDO.CategoryValue||a.CDGDO.IsForeignKey&&50051==a.CDGDO.ParentCostCenterID),_&&(N.d.SessionManager.LocationID>0&&N.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&N.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(d.length>0&&(d+=" AND "),d+=_.CDGDO.ActualTable+".NodeID in (Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and (CCNID2="+N.d.SessionManager.LocationID+(N.d.SessionManager.Preferences.ContainsKey("ShowDefaultEmployee")&&"TRUE"==N.d.SessionManager.Preferences.ShowDefaultEmployee.toUpperCase()?" or NodeID=1":"")+" ))"),d.length>0&&(d+=" AND "),d+=this.PayrollWidgetEmpID>0?_.CDGDO.ActualTable+".NodeID in ("+this.PayrollWidgetEmpID+")":_.CDGDO.ActualTable+".NodeID in ("+N.d.SessionManager.sWHEmpFilteredEmpSeqNos+")")),"ReportViewModel"==this.ClassName&&this.Report.Preferences.ContainsKey("HideBiddingPrice")&&"1"==this.Report.Preferences.HideBiddingPrice&&(this.GetVoucherNoHideBiddingPrice(),this.strHideBiddingPriceVoucher.length>0&&this.Entities.values.Contains("INV")&&(d.length>0&&(d+=" AND "),d+=" INV.VoucherNo not in ("+this.strHideBiddingPriceVoucher+") ")),"ReportViewModel"==this.ClassName&&this.Report.Preferences.ContainsKey("ShowPayrollJVStatus")&&null!=this.Report&&"1"==this.Report.Preferences.ShowPayrollJVStatus&&this.Filter.PayrollJVStatus.Visible&&null!=this.Filter.PayrollJVStatus.SelectedValue&&"1"!=this.Filter.PayrollJVStatus.SelectedValue&&N.d.SessionManager.Preferences.ContainsKey("PayrollFinancialPostingXml")&&""!=N.d.SessionManager.Preferences.PayrollFinancialPostingXml&&N.d.SessionManager.Preferences.PayrollFinancialPostingXml.length>0){let i=new C.VB;if(i.ReadXml(N.d.SessionManager.Preferences.PayrollFinancialPostingXml),null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&i.Columns[0].Contains("ReportID")){let s=i.Tables[0].filter(E=>E.ReportID==this.Report.ReportID);if(null!=s&&s.length>0){let E="";if("2"==this.Filter.PayrollJVStatus.SelectedValue?E="IN":"3"==this.Filter.PayrollJVStatus.SelectedValue&&(E="NOT IN"),"Payroll"!=s[0].Type.toString())null!=s[0].ReportColID&&""!=s[0].ReportColID&&null!=(h=this.BaseReportColumns.find(V=>V.ID==s[0].ReportColID.toString()))&&(d.length>0&&(d+=" AND "),d+=h.CDGDO.ActualColumn+" "+E+" (SELECT PFP.ParentRef from PAY_FinancePostings PFP WITH(NOLOCK) WHERE ISNULL("+s[0].Provision.toString()+",'')<>'' AND TYPE='"+s[0].Type.toString()+"') ");else if("Payroll"==s[0].Type.toString()){var h;if(null!=(h=this.BaseReportColumns.find(V=>50051==V.CDGDO.CategoryValue||V.CDGDO.IsForeignKey&&50051==V.CDGDO.ParentCostCenterID))){let V=new Date,O=new Date,W=new Date;if(null!=(c=this.Filter.Fields.find(B=>null!=B.CDGDO.DataType&&"DATE"==B.CDGDO.DataType.toUpperCase()&&40054==B.CDGDO.CategoryValue))){let B={PayrollMonth:V,PayrollMonthStart:O,PayrollMonthEnd:W};C.J0.SetPayrollDate_1(c.FromDatePicker.Date,B),V=B.PayrollMonth,O=B.PayrollMonthStart,W=B.PayrollMonthEnd}d.length>0&&(d+=" AND "),d+=h.CDGDO.ActualTable+".NodeID "+E+" (SELECT PFP.EmployeeID from PAY_FinancePostings PFP WITH(NOLOCK) WHERE ISNULL("+s[0].Provision.toString()+",'')<>'' AND TYPE='"+s[0].Type.toString()+"' AND PFP.EmployeeID="+h.CDGDO.ActualTable+".NodeID and PFP.PayrollMonth=convert(datetime,'"+V.ToString("dd MMM yyyy")+"')) "}}}}}this.WhereTag=d.toString(),this.sbFinalQuery.length>0&&(this.sbFinalQuery+="\r\n UNION ALL \r\n"),0==f.DocID&&this.IsBudgetFound?this.SelectTag=this.SelectTag+","+this.Entities.Budget+".BudgetDefID,"+this.Entities.Budget+".BudgetAllocID":0==f.DocID&&(this.earningfields.length>0||this.Vacationfields.length>0)?this.SelectTag=this.SelectTag+",T0.NodeID  XEmpIDX":this.earningfields.length>0&&(_=this.BaseReportColumns.find(a=>50051==a.CDGDO.CategoryValue||a.CDGDO.IsForeignKey&&50051==a.CDGDO.ParentCostCenterID&&""!=a.CDGDO.ActualTable.toString()),null!=_&&(this.SelectTag=this.SelectTag+","+_.CDGDO.ActualTable+".NodeID  XEmpIDX")),this.sbFinalQuery+="SELECT "+this.SelectTag+"\r\n FROM "+this.FromTag,null!=this.WhereTag&&""!=this.WhereTag&&(this.sbFinalQuery+="\r\n WHERE "+this.WhereTag)}if(this.IsSummaryReportType&&(this.sbFinalQuery="select "+this.SummarySELECT+" from ("+this.sbFinalQuery+") AS T group by "+this.SummaryGROUPBY),this.IsPreProcessQuery&&null!=this.Report&&(this.sbFinalQuery="Select * into PACT2C"+N.d.SessionManager.CompanyIndex+"_TEMP.dbo.RPT_TBL"+this.Report.ReportID+" from ("+this.sbFinalQuery+") as T "),"LINKED_VOUCHERS"==t)this.OrderByTag="DocAbbr,DocPrefix,DocNumber";else{if(this.IsOrderByGroupFields)for(let v=0;v<this.ReportGroups.length;v++){let f=this.ReportGroups[v];C.J0.IsEmpty(f.Formula.Text)&&(this.OrderByTag.length>0&&(this.OrderByTag+=","),f.Sort.SelectedValue.startsWith("NUM")||f.Sort.SelectedValue.startsWith("TREE")?this.OrderByTag+="["+f.ID+"SORT] "+f.Sort.SelectedValue.substr(4):this.OrderByTag+="VoucherNo"==f.CDGDO.Column&&0==f.CDGDO.IsForeignKey?"["+f.ID+"Abr] "+f.Sort.SelectedValue+",["+f.ID+"prf] "+f.Sort.SelectedValue+",["+f.ID+"dno] "+f.Sort.SelectedValue:"["+f.ID+"] "+f.Sort.SelectedValue)}for(let v=0;v<this.BaseReportColumns.length;v++){let f=this.BaseReportColumns[v];!f.IsGroup&&!C.J0.IsEmpty(f.Sort.SelectedValue)&&C.J0.IsEmpty(f.Formula.Text)&&(this.OrderByTag.length>0&&(this.OrderByTag+=","),f.Sort.SelectedValue.startsWith("NUM")||f.Sort.SelectedValue.startsWith("TREE")?this.OrderByTag+="["+f.ID+"SORT] "+f.Sort.SelectedValue.substr(4):this.OrderByTag+="VoucherNo"==f.CDGDO.Column&&0==f.CDGDO.IsForeignKey&&""!=f.Sort.SelectedValue?"["+f.ID+"Abr] "+f.Sort.SelectedValue+",["+f.ID+"prf] "+f.Sort.SelectedValue+",["+f.ID+"dno] "+f.Sort.SelectedValue:"["+f.ID+"] "+f.Sort.SelectedValue)}null!=this.OrderByTag&&""!=this.OrderByTag&&(this.sbFinalQuery+=" ORDER BY "+this.OrderByTag)}if(this.IsAuthLevelReport)this.sbFinalQuery+="\r\n SELECT WorkFlowID,MAX(LevelID) Levels FROM COM_WorkFlow with(nolock) GROUP BY WorkFlowID";else if(null!=this.LevelColumn){let v,f,H="";this.Entities.Clear(),null!=this.LevelColumn.CDGDO.ChildCDGDO?(v=this.LevelColumn.CDGDO.ChildCDGDO.ParentCostCenterColSysName,f="LT."+this.LevelColumn.CDGDO.ChildCDGDO.Column+" AS "+this.LevelColumn.ID,this.Entities.push(this.LevelColumn.CDGDO.ChildCDGDO.ParentCostCenterSysName,"LT"),f+=this.GetLink_IDColumn("LT",this.LevelColumn)):(v=this.LevelColumn.CDGDO.ParentCostCenterColSysName,f="LT."+this.LevelColumn.CDGDO.Column+" AS "+this.LevelColumn.ID,this.Entities.push(this.LevelColumn.CDGDO.ParentCostCenterSysName,"LT"),f+=this.GetLink_IDColumn("LT",this.LevelColumn));let G=[25900,26428];for(let X=0;X<this.BaseReportColumns.length;X++){let y=this.BaseReportColumns[X];if(y==this.LevelColumn||null==y.CDGDO.ActualColumn||C.J0.IsEmpty(y.CDGDO.Column)){if(214==y.CDGDO.FieldValue){let _="",d=C.J0.IsEmpty(y.CDGDO.DimensionsFilter)?[]:y.CDGDO.DimensionsFilter.split("~");if(d.length>2&&d[1].length>0&&d[2].length>0){let Y=d[2].split(",");for(let j=0;j<Y.length;j++)if(j>0&&(_+=","),Y[j]=="EFPD_"+v||Y[j]=="EFPRD_"+v||Y[j]=="EFPBW_"+v)_+="LT."+v;else{if(!Y[j].startsWith("EF_")){_="";break}this.SetExtFunctionParams(Y[j],_)}_.length>0&&(_="dbo."+d[1]+"("+_+")",this.sbFinalQuery.Replace(_.Replace("LT.","INV."),"null"),this.sbFinalQuery.Replace(_.Replace("LT.","ACC."),"null"),f+=","+_+" AS "+y.ID)}}}else if(y.CDGDO.IsForeignKey&&y.CDGDO.ColumnCostCenterID>0||!y.CDGDO.IsForeignKey){let _=y.CDGDO.ActualColumn.lastIndexOf(".");_>0&&!G.Contains(y.CDGDO.FieldValue)&&(y.CDGDO.IsForeignKey?y.CDGDO.ColumnCostCenterID==this.LevelTreeCostCenterID&&(this.Entities.ContainsKey(y.CDGDO.ParentCostCenterSysName),this.Entities.ContainsKey(y.CDGDO.ParentCostCenterSysName)&&(y.CDGDO.ParentCostCenterSysName!=y.CDGDO.Table&&y.CDGDO.Table.Contains("Extended")?(this.Entities.ContainsKey(y.CDGDO.Table)||(this.Entities.push(y.CDGDO.Table,"LTEXT"),H+=" LEFT JOIN "+y.CDGDO.Table+" LTEXT WITH(NOLOCK) ON LTEXT."+v+"=LT."+v),"DATE"==y.CDGDO.DataType?f+=",CONVERT(DATETIME,"+this.Entities[y.CDGDO.Table]+"."+y.CDGDO.Column+") AS "+y.ID:(f+=","+this.Entities[y.CDGDO.Table]+"."+y.CDGDO.Column+" AS "+y.ID,f+=this.GetLink_IDColumn(this.Entities[y.CDGDO.Table],y))):"ParentID"==y.CDGDO.Column?(f+=",GRPLT."+y.CDGDO.ActualColumn.substr(_+1)+" AS "+y.ID,H.Contains("GRPLT.")||(H+=" LEFT JOIN "+y.CDGDO.Table+" GRPLT WITH(NOLOCK) ON GRPLT."+v+"=LT."+y.CDGDO.Column)):"DATE"==y.CDGDO.DataType?f+=",CONVERT(DATETIME,"+this.Entities[y.CDGDO.ParentCostCenterSysName]+"."+y.CDGDO.Column+") AS "+y.ID:(f+=","+this.Entities[y.CDGDO.ParentCostCenterSysName]+"."+y.CDGDO.Column+" AS "+y.ID,f+=this.GetLink_IDColumn(this.Entities[y.CDGDO.ParentCostCenterSysName],y)))):y.CDGDO.CategoryValue==this.LevelTreeCostCenterID&&this.Entities.ContainsKey(y.CDGDO.Table)&&("DATE"==y.CDGDO.DataType?f+=",CONVERT(DATETIME,"+this.Entities[y.CDGDO.Table]+"."+y.CDGDO.Column+") AS "+y.ID:(f+=","+this.Entities[y.CDGDO.Table]+"."+y.CDGDO.Column+" AS "+y.ID,f+=this.GetLink_IDColumn(this.Entities[y.CDGDO.Table],y))))}}null!=this.Report&&null!=this.Filter&&(this.Report.LevelNo=C.J0.Int(this.Filter.ShowLevel.Text)),this.sbFinalQuery+=null!=this.Report&&-2==this.Report.LevelNo?"\r\n SELECT "+f+",LT."+v+" AS TreeNodeID,0 Depth,0 ParentID,LT.lft,LT.rgt,LT.IsGroup FROM ":"\r\n SELECT "+f+",LT."+v+" AS TreeNodeID,LT.Depth,LT.ParentID,LT.lft,LT.rgt,LT.IsGroup FROM ",this.sbFinalQuery+=null!=this.LevelColumn.CDGDO.ChildCDGDO?this.LevelColumn.CDGDO.ChildCDGDO.ParentCostCenterSysName:this.LevelColumn.CDGDO.ParentCostCenterSysName,this.sbFinalQuery+=" LT WITH(NOLOCK)"+H,this.sbFinalQuery+=" WHERE ",this.sbFinalQuery+="AccountID"!=this.LevelColumn.CDGDO.ParentCostCenterColSysName&&"ProductID"!=this.LevelColumn.CDGDO.ParentCostCenterColSysName||null!=this.LevelColumn.CDGDO.ChildCDGDO?"LT."+v+">0":"LT."+v+">1",null!=this.Report&&-2==this.Report.LevelNo&&(this.sbFinalQuery+=" and LT.IsGroup=0");for(let X=0;X<this.Filter.CostCenterFilters.length;X++){let y=this.Filter.CostCenterFilters[X];if(y.CostCenterID==this.LevelTreeCostCenterID){if(y.SelectedNodes.length>0||!y.DeleteButtonVisibility){this.sbFinalQuery+=" AND LT."+v+" IN (";for(let _=0;_<y.SelectedNodes.length;_++)_>0&&(this.sbFinalQuery+=","),this.sbFinalQuery+=y.SelectedNodes[_].Id;0==y.SelectedNodes.length&&(this.sbFinalQuery+=-12912),this.sbFinalQuery+=")"}break}}this.sbFinalQuery+=" ORDER BY lft"}else this.IsBudgetNewFound&&(this.sbFinalQuery+="\r\n SELECT D.CostCenterID,CONVERT(DATETIME,FinYearStartDate) StartDate FROM COM_BudgetDef B with(nolock),COM_BudgetDefDims D with(nolock) WHERE B.BudgetDefID="+m+" AND B.BudgetDefID=D.BudgetDefID\n                select * from COM_BudgetAlloc with(nolock) WHERE BudgetDefID="+m);if(this.earningfields.length>0){var c=this.Filter.Fields.find(f=>null!=f.CDGDO.DataType&&"DATE"==f.CDGDO.DataType.toUpperCase()&&50051==f.CDGDO.CategoryValue&&-601==f.CDGDO.FieldValue);this.sbFinalQuery+=null!=c?" SELECT Convert(DateTime,P.EffectFrom) as CEffectFrom,Convert(DateTime,P.ApplyFrom) as CApplyFrom, P.* FROM PAY_EMPPAY P with(nolock), COM_CC50051 C with(nolock) WHERE C.NodeID>2 AND C.NodeID=P.EmployeeID AND P.SeqNo IN (SELECT TOP 1 SeqNo FROM PAY_EMPPAY with(nolock) WHERE EmployeeID=C.NodeID AND Convert(DateTime,EffectFrom) <='"+c.FromDatePicker.Date.ToString("dd MMM yyyy")+"' ORDER BY EffectFrom DESC)":" SELECT Convert(DateTime,P.EffectFrom) as CEffectFrom,Convert(DateTime,P.ApplyFrom) as CApplyFrom, P.* FROM PAY_EMPPAY P with(nolock), COM_CC50051 C with(nolock) WHERE C.NodeID>2 AND C.NodeID=P.EmployeeID AND P.SeqNo IN (SELECT TOP 1 SeqNo FROM PAY_EMPPAY with(nolock) WHERE EmployeeID=C.NodeID ORDER BY EffectFrom DESC)"}if(null!=P&&P.SelectedNodes.length>0&&(this.sbFinalQuery=b+this.sbFinalQuery,this.sbFinalQuery+=" \r\n DROP TABLE #TblJobDim"),this.ShowUnAppDocsToApprove&&!this.ShowUnAppDocsToApprove_UseFuncCall&&(N.d.SessionManager.IsEmpUser&&N.d.SessionManager.IsRptManagerUser?(this.sbFinalQuery="create table #TblUsrWF(WID int,LevelID int,Type int,CtWef float,LvWef int)\n                EXEC spRPT_GetReportData @Type=8,@Param1="+N.d.SessionManager.UserID+",@strXML=null,@RoleID=-1\n"+this.sbFinalQuery,this.sbFinalQuery+=" \r\n DROP TABLE #TblUsrWF"):(this.sbFinalQuery="create table #TblUsrWF(WID int,LevelID int,Type int,CtWef float,LvWef int)\n                EXEC spRPT_GetReportData @Type=8,@Param1="+N.d.SessionManager.UserID+",@strXML=null,@RoleID="+N.d.SessionManager.RoleID+"\n"+this.sbFinalQuery,this.sbFinalQuery+=" \r\n DROP TABLE #TblUsrWF")),this.Filter.IsReportViewScreen&&this.Report.Preferences.ContainsKey("NoDataGroups")&&this.ReportGroups.length>0&&"1"==this.ReportGroups[0].Visibility.SelectedValue){var I=this.ReportGroups[0];let v,f,H,G;if(this.Entities.Clear(),G=null!=I.CDGDO.ChildCDGDO?I.CDGDO.ChildCDGDO:I.CDGDO,f="LT."+G.Column+" AS "+I.ID,this.LevelTreeCostCenterID=G.ColumnCostCenterID,this.Entities.push(G.ParentCostCenterSysName,"LT"),I.CDGDO.IsForeignKey&&I.CDGDO.ColumnCostCenterID>0&&I.CDGDO.ActualColumn.lastIndexOf(".")>0&&(this.Entities.ContainsKey(G.ParentCostCenterSysName),this.Entities.ContainsKey(G.ParentCostCenterSysName)))if(f=this.Entities[G.ParentCostCenterSysName]+"."+G.Column+" AS NoDataGroup",I.IsReportMappingFilter){let y=I.CDGDO.IsForeignKey?I.CDGDO.ParentCostCenterID:I.CDGDO.CategoryValue;400!=y&&(y<4e4||y>5e4)&&("NULL"!=I.CDGDO.ActualColumn?(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(_=>_.FeatureID==y),f+=","+this.Entities[I.CDGDO.ParentCostCenterSysName]+"."+this.drrCCTbl[0].PK.toString()+" AS ["+I.ID+"_ID]"):f+=",NULL AS ["+I.ID+"_ID]")}else if("3"==I.LinkType.SelectedValue||"4"==I.LinkType.SelectedValue){let y=I.CDGDO.IsForeignKey?I.CDGDO.ParentCostCenterID:I.CDGDO.CategoryValue;400!=y&&(y<4e4||y>5e4)&&("NULL"!=I.CDGDO.ActualColumn?(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(_=>_.FeatureID==y),f+=","+this.Entities[I.CDGDO.ParentCostCenterSysName]+"."+this.drrCCTbl[0].PK.toString()+" AS ["+I.ID+"_ID]"):f+=",NULL AS ["+I.ID+"_ID]")}if(f.length>0){let X=[25900,26428];this.BaseReportColumns.forEach(y=>{if((y==this.LevelColumn||null==y.CDGDO.ActualColumn||C.J0.IsEmpty(y.CDGDO.Column))&&214==y.CDGDO.FieldValue){let _="",d=C.J0.IsEmpty(y.CDGDO.DimensionsFilter)?[]:y.CDGDO.DimensionsFilter.split("~");if(d.length>2&&d[1].length>0&&d[2].length>0){let Y=d[2].split(",");for(let j=0;j<Y.length;j++)if(j>0&&(_+=","),Y[j]=="EFPD_"+v||Y[j]=="EFPRD_"+v||Y[j]=="EFPBW_"+v)_+="LT."+v;else{if(!Y[j].startsWith("EF_")){_="";break}this.SetExtFunctionParams(Y[j],_)}_.length>0&&(_="dbo."+d[1]+"("+_+")",this.sbFinalQuery.replace(_.replace("LT.","INV."),"null"),this.sbFinalQuery.replace(_.replace("LT.","ACC."),"null"),f+=","+_+" AS "+y.ID)}}if(y.CDGDO.IsForeignKey&&y.CDGDO.ColumnCostCenterID>0||!y.CDGDO.IsForeignKey){let _=y.CDGDO.ActualColumn.lastIndexOf(".");_>0&&!X.Contains(y.CDGDO.FieldValue)&&(y.CDGDO.IsForeignKey?y.CDGDO.ColumnCostCenterID==this.LevelTreeCostCenterID&&(this.Entities.ContainsKey(y.CDGDO.ParentCostCenterSysName),this.Entities.ContainsKey(y.CDGDO.ParentCostCenterSysName)&&(y.CDGDO.ParentCostCenterSysName!=y.CDGDO.Table&&(y.CDGDO.Table.Contains("Extended")||y.CDGDO.Table.Contains("COM_CCCCDATA"))?(y.CDGDO.Table.Contains("Extended")&&!this.Entities.ContainsKey(y.CDGDO.Table)?(this.Entities.push(y.CDGDO.Table,"LTEXT"),H+=" LEFT JOIN "+y.CDGDO.Table+" LTEXT WITH(NOLOCK) ON LTEXT."+v+"=LT."+v):y.CDGDO.Table.Contains("COM_CCCCDATA")&&!this.Entities.ContainsKey(y.CDGDO.Table)&&(this.Entities.push(y.CDGDO.Table,"LTCCD"),H+=" LEFT JOIN "+y.CDGDO.Table+" LTCCD WITH(NOLOCK) ON LTCCD.CostCenterID="+this.LevelTreeCostCenterID+" AND LTCCD."+v+"=LT."+v),"DATE"==y.CDGDO.DataType?f+=",CONVERT(DATETIME,"+this.Entities[y.CDGDO.Table]+"."+y.CDGDO.Column+") AS "+y.ID:(null!=y.CDGDO.ChildCDGDO&&y.CDGDO.Table.Contains("COM_CCCCDATA")?(f+=","+y.CDGDO.ChildCDGDO.ActualColumn+" AS "+y.ID,H+=" LEFT JOIN "+y.CDGDO.ChildCDGDO.ParentCostCenterSysName+" "+y.CDGDO.ChildCDGDO.ActualColumn.substr(0,_)+" WITH(NOLOCK) ON "+y.CDGDO.ChildCDGDO.ActualColumn.substr(0,_)+"."+v+"="+this.Entities[y.CDGDO.Table]+"."+y.CDGDO.Column):f+=","+this.Entities[y.CDGDO.Table]+"."+y.CDGDO.Column+" AS "+y.ID,f+=this.GetLink_IDColumn(this.Entities[y.CDGDO.Table],y))):"ParentID"==y.CDGDO.Column?(f+=",GRPLT."+y.CDGDO.ActualColumn.substr(_+1)+" AS "+y.ID,H.Contains("GRPLT.")||(H+=" LEFT JOIN "+y.CDGDO.Table+" GRPLT WITH(NOLOCK) ON GRPLT."+v+"=LT."+y.CDGDO.Column)):null!=y.CDGDO.ChildCDGDO&&"StatusID"==y.CDGDO.Column?(f+=","+y.CDGDO.ChildCDGDO.ActualColumn+" AS "+y.ID,H+=" LEFT JOIN "+y.CDGDO.ChildCDGDO.ParentCostCenterSysName+" "+y.CDGDO.ChildCDGDO.ActualColumn.substr(0,_)+" WITH(NOLOCK) ON "+y.CDGDO.ChildCDGDO.ActualColumn.substr(0,_)+"."+y.CDGDO.Column+"="+this.Entities[y.CDGDO.Table]+"."+y.CDGDO.Column):"DATE"==y.CDGDO.DataType?f+=",CONVERT(DATETIME,"+this.Entities[y.CDGDO.ParentCostCenterSysName]+"."+y.CDGDO.Column+") AS "+y.ID:(f+=","+this.Entities[y.CDGDO.ParentCostCenterSysName]+"."+y.CDGDO.Column+" AS "+y.ID,f+=this.GetLink_IDColumn(this.Entities[y.CDGDO.ParentCostCenterSysName],y)))):y.CDGDO.CategoryValue==this.LevelTreeCostCenterID&&this.Entities.ContainsKey(y.CDGDO.Table)&&("DATE"==y.CDGDO.DataType?f+=",CONVERT(DATETIME,"+this.Entities[y.CDGDO.Table]+"."+y.CDGDO.Column+") AS "+y.ID:(f+=","+this.Entities[y.CDGDO.Table]+"."+y.CDGDO.Column+" AS "+y.ID,f+=this.GetLink_IDColumn(this.Entities[y.CDGDO.Table],y))))}}),this.IsNoDataGroups=!0,this.sbFinalQuery+="\r\n SELECT "+f+", LT.IsGroup FROM ",this.sbFinalQuery+=G.ParentCostCenterSysName+" LT WITH(NOLOCK) "+H,this.sbFinalQuery+=" WHERE LT.IsGroup=0";for(let y=0;y<this.Filter.CostCenterFilters.length;y++){let _=this.Filter.CostCenterFilters[y];if(_.CostCenterID==I.CDGDO.ColumnCostCenterID){if(_.SelectedNodes.length>0||!_.DeleteButtonVisibility){this.sbFinalQuery+=" AND LT."+v+" IN (";for(let d=0;d<_.SelectedNodes.length;d++)d>0&&(this.sbFinalQuery+=","),this.sbFinalQuery+=_.SelectedNodes[d].Id;0==_.SelectedNodes.length&&(this.sbFinalQuery+=-12912),this.sbFinalQuery+=")"}break}}this.sbFinalQuery+=" ORDER BY NoDataGroup"}}this.FinalQuery=this.sbFinalQuery.toString()}catch(l){Logger.ErrorLog("SetQueryXMLTags :: "+l.stack)}}SetQueryXMLTagsForStaticReports(){let e,o,t=0,m="",r=!1,M=!1,T=!1,D="",A="",n="";this.DbGroupSelectTag="";let h=new q.bT;if(9==this.StaticReportType||10==this.StaticReportType||198==this.StaticReportType?m="B":(m="DCC",this.Entities.push("Documents",150==this.StaticReportType?"ACC":"D")),1==this.StaticReportType||86==this.StaticReportType||2==this.StaticReportType||3==this.StaticReportType||4==this.StaticReportType||200==this.StaticReportType?(this.Entities.push("Account","A1"),this.IsInventory=!1,1==this.StaticReportType&&(h.push("Documents","D"),this.ReportParams.push("ProductSelect",""),this.ReportParams.push("ProductFrom",""))):this.StaticReportType>=5&&this.StaticReportType<=12||198==this.StaticReportType||185==this.StaticReportType?this.Entities.push("Account","A"):118==this.StaticReportType?this.Entities.push("Asset Management","A"):73==this.StaticReportType||this.StaticReportType>=209&&this.StaticReportType<=215?(this.Entities.push("Contract","C"),this.Entities.push("Contract.Property","P"),this.Entities.push("Contract.Unit","U"),this.Entities.push("Contract.Tenant","T"),this.Entities.push("Contract.PropertyID","P"),this.Entities.push("Contract.UnitID","U"),this.Entities.push("Contract.TenantID","T"),this.Entities.push("ContractREN_ContractParticulars","CP"),this.Entities.push("Units","U")):87==this.StaticReportType?(this.Entities.push("Contract.Unit","U"),this.Entities.push("Contract.UnitID","U"),this.Entities.push("Units","U")):196==this.StaticReportType||(13==this.StaticReportType||14==this.StaticReportType||15==this.StaticReportType||16==this.StaticReportType||81==this.StaticReportType||82==this.StaticReportType||83==this.StaticReportType||84==this.StaticReportType||112==this.StaticReportType||114==this.StaticReportType||115==this.StaticReportType||158==this.StaticReportType||165==this.StaticReportType||195==this.StaticReportType||203==this.StaticReportType||204==this.StaticReportType?(this.Entities.push("Product","P"),81==this.StaticReportType||82==this.StaticReportType?this.Entities.Add("Batch","B"):(203==this.StaticReportType||204==this.StaticReportType)&&this.Entities.push("Documents.Product Name","P")):this.IsInventory=!0),this.DocumentFilters.ContainsKey("GLParticularSelect")&&(this.DocumentFilters.Remove("GLParticularSelect"),this.DocumentFilters.Remove("GLParticularFrom")),1==this.StaticReportType||2==this.StaticReportType||3==this.StaticReportType||13==this.StaticReportType||81==this.StaticReportType||82==this.StaticReportType||86==this.StaticReportType||94==this.StaticReportType||95==this.StaticReportType||111==this.StaticReportType||150==this.StaticReportType||320==this.StaticReportType||323==this.StaticReportType||156==this.StaticReportType||158==this.StaticReportType||185==this.StaticReportType||195==this.StaticReportType||200==this.StaticReportType||203==this.StaticReportType||204==this.StaticReportType||207==this.StaticReportType||-2==this.StaticReportType){let g=new Array;g.AddRange(this.BaseReportColumns),g.AddRange(this.ReportGroups);for(let S=0;S<g.length;S++){let I=g[S];if(e=I.CDGDO,33==I.ID.length)if(400==e.CategoryValue||401==e.CategoryValue||402==e.CategoryValue||Math.abs(e.CategoryValue)>4e4&&Math.abs(e.CategoryValue)<5e4){if(1==this.StaticReportType&&[23150,23822,23823,23824,11491,11676].Contains(e.FieldValue)){if(e.ActualColumn=null,3==e.ColumnCostCenterID)h.ContainsKey(e.CategoryText)||h.push(e.CategoryText,"P"),"INV_Product"==e.Table?e.ActualColumn=h[e.CategoryText]+"."+e.Column:"INV_ProductExtended"==e.Table?(o=e.CategoryText+"INV_ProductExtended",h.ContainsKey(o)||(h.push(o,"PRODEXT"),this.ReportParams.ProductFrom+=" LEFT JOIN INV_ProductExtended AS "+h[o]+" with(nolock) ON P.ProductID=PRODEXT.ProductID"),e.ActualColumn=h[o]+"."+e.Column):null!=e.ChildCDGDO&&e.ChildCDGDO.IsForeignKey&&(h.ContainsKey(e.ChildCDGDO.CategoryText)||(o="T"+ ++t,h.push(e.ChildCDGDO.CategoryText,o),0==C.J0.stringCompare(e.ChildCDGDO.ParentTable,"COM_CCCCData",!0)?(h.ContainsKey("CC")||(h.push("CC","CC"),this.ReportParams.ProductFrom+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID=P.ProductID AND CC.CostCenterID="+e.ChildCDGDO.CategoryValue),this.ReportParams.ProductFrom+=" LEFT JOIN "+e.ChildCDGDO.ParentCostCenterSysName+" AS "+o+" with(nolock) ON "+o+"."+e.ChildCDGDO.ParentCostCenterColSysName+"=CC."+e.ChildCDGDO.ParentColumn):this.ReportParams.ProductFrom+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+o+" with(nolock) ON "+o+"."+e.ChildCDGDO.ParentCostCenterColSysName+"="+h.Product+"."+e.ChildCDGDO.ParentColumn,e.ActualColumn=o+"."+e.ChildCDGDO.Column));else{if(!h.ContainsKey(e.CategoryText))return;e.ActualColumn=h[e.CategoryText]+"."+e.Column}null!=e.ActualColumn&&(this.ReportParams.ProductSelect+=","+e.ActualColumn+" ["+I.ID+"]");continue}if(207==e.FieldValue&&"Shipping_Address"!=e.Table&&"Billing_Address"!=e.Table){if(this.DocumentFilters.ContainsKey("GLParticularSelect")||(this.DocumentFilters.push("GLParticularSelect","A.AccountID"),this.DocumentFilters.push("GLParticularFrom","ACC_Accounts A with(nolock)")),"ACC_Accounts"==e.Table){this.DocumentFilters.GLParticularSelect+=",A."+e.Column+" AS ["+I.ID+"]";continue}if("ACC_AccountsExtended"==e.Table){o=e.CategoryText+"ACC_AccountsExtended",this.Entities.ContainsKey(o)||(this.Entities.push(o,"ACCEXT"),this.DocumentFilters.GLParticularFrom+=" LEFT JOIN ACC_AccountsExtended AS "+this.Entities[o]+" with(nolock) ON A.AccountID=ACCEXT.AccountID"),this.DocumentFilters.GLParticularSelect+=",ACCEXT."+e.Column+" AS ["+I.ID+"]";continue}if("COM_ADDRESS"==e.Table.toUpperCase()){o=e.CategoryText+"COM_ADDRESS",this.Entities.ContainsKey(o)||(this.Entities.push(o,"ACCADD"),this.DocumentFilters.GLParticularFrom+=" LEFT JOIN COM_ADDRESS AS "+this.Entities[o]+" with(nolock) ON ACCADD.AddressTypeID=1 AND ACCADD.FeatureID=2 AND A.AccountID=ACCADD.FeaturePK"),this.DocumentFilters.GLParticularSelect+=",ACCADD."+e.Column+" AS ["+I.ID+"]";continue}if("Shipping_Address"==e.Table||"Billing_Address"==e.Table){this.DocumentFilters.GLParticularSelect+=",(select "+this.GetAddressColumn(e.Column.substr(5))+" from COM_ADDRESS with(nolock) where AddressID=(select min(AddressID) from COM_ADDRESS with(nolock) where AddressTypeID="+("Shipping_Address"==e.Table?"3":"2")+" and FeatureID=2 AND A.AccountID=FeaturePK)) AS ["+I.ID+"]";continue}continue}if(401==e.CategoryValue||402==e.CategoryValue||Math.abs(e.CategoryValue)>4e4&&Math.abs(e.CategoryValue)<5e4)if("COM_DocTextData"==e.Table){this.Entities.ContainsKey(e.CategoryText)||this.Entities.push(e.CategoryText,this.Entities.Documents),o=e.CategoryText+"COM_DocTextData";let l=this.FieldsDialog.DocumentTypes.filter(b=>b.CostCenterID==Math.abs(e.CategoryValue));l.length>0&&(0,Z.yG0)(l[0].IsInventory)||111==this.StaticReportType?(this.Entities.ContainsKey(o)||this.Entities.push(o,"DOCTEXT"),r||(n+=" LEFT JOIN COM_DocTextData AS "+this.Entities[o]+" with(nolock) ON "+this.Entities[o]+".InvDocDetailsID="+this.Entities.Documents+".InvDocDetailsID"),r=!0):(this.Entities.ContainsKey(o)||this.Entities.push(o,"DOCATEXT"),M||150!=this.StaticReportType?M||(n+=" LEFT JOIN COM_DocTextData AS "+this.Entities[o]+" with(nolock) ON "+this.Entities[o]+".AccDocDetailsID="+this.Entities.Documents+".AccDocDetailsID"):n+=" LEFT JOIN COM_DocTextData_History AS "+this.Entities[o]+" with(nolock) ON "+this.Entities[o]+".AccDocDetailsID="+this.Entities.Documents+".AccDocDetailsID AND "+this.Entities[o]+".ModifiedDate="+this.Entities.Documents+".ModifiedDate",M=!0),e.ParentCDGDO=new te.ir}else if("COM_DocNumData"==e.Table){if(this.Entities.ContainsKey(e.CategoryText)||this.Entities.push(e.CategoryText,this.Entities.Documents),1==this.StaticReportType||2==this.StaticReportType||3==this.StaticReportType||86==this.StaticReportType||156==this.StaticReportType){188==e.FieldValue?(e.ActualColumn="CASE WHEN D.InvDocDetailsID is null THEN NULL ELSE\n(SELECT top 1 (select top 1 X.value('@Remarks','nvarchar(max)') from NUM.Remarks.nodes('/XML/Row') as Data(X) where ",C.J0.IsEmpty(e.Formula)?e.ActualColumn+="X.value('@CreditAcount','bigint')=A1.AccountID or X.value('@DebitAcount','bigint')=A1.AccountID":e.ActualColumn+="X.value('@Columnname','nvarchar(50)')='dcNum"+e.Formula+"'",e.ActualColumn+=") FROM COM_DocNumData NUM WITH(NOLOCK) WHERE NUM.InvDocDetailsID=D.InvDocDetailsID) end",D+=","+e.ActualColumn+" AS ["+I.ID+"]",this.SelectTagAliasOnly+=","+I.ID):(this.FieldsDialog.DocumentTypes.filter(b=>b.CostCenterID==Math.abs(e.CategoryValue)),e.ActualColumn=this.FieldsDialog.DocumentTypes.length>0&&(0,Z.yG0)(this.FieldsDialog.DocumentTypes[0].IsInventory)?" CASE WHEN D.CostCenterID="+Math.abs(e.CategoryValue)+" THEN (select sum("+e.Column+") from COM_DocNumData with(nolock) where InvDocDetailsID in (select InvDocDetailsID FROM INV_DocDetails with(nolock) WHERE VoucherNo=D.VoucherNo)) ELSE NULL END ":" CASE WHEN D.CostCenterID="+Math.abs(e.CategoryValue)+" THEN (select sum("+e.Column+") from COM_DocNumData with(nolock) where AccDocDetailsID in (select AccDocDetailsID FROM ACC_DocDetails with(nolock) WHERE VoucherNo=D.VoucherNo)) ELSE NULL END ",D+=","+e.ActualColumn+" AS ["+I.ID+"]",this.SelectTagAliasOnly+=","+I.ID);continue}o=e.CategoryText+"COM_DocNumData",this.Entities.ContainsKey(o)||this.Entities.push(o,"DOCNUM"),T||(n+=this.IsInventory?150==this.StaticReportType?" LEFT JOIN COM_DocNumData_History AS "+this.Entities[o]+" with(nolock) ON "+this.Entities[o]+".InvDocDetailsID="+this.Entities.Documents+".InvDocDetailsID AND "+this.Entities[o]+".ModifiedDate="+this.Entities.Documents+".ModifiedDate":" LEFT JOIN COM_DocNumData AS "+this.Entities[o]+" with(nolock) ON "+this.Entities[o]+".InvDocDetailsID="+this.Entities.Documents+".InvDocDetailsID":" LEFT JOIN COM_DocNumData AS "+this.Entities[o]+" with(nolock) ON "+this.Entities[o]+".AccDocDetailsID="+this.Entities.Documents+".AccDocDetailsID"),T=!0,e.ParentCDGDO=new te.ir}else if(2==e.ColumnCostCenterID&&-2!=this.StaticReportType&&0!=C.J0.stringCompare(e.Formula,"LATEST")&&0!=C.J0.stringCompare(e.Formula,"OLDEST")){let l=e.ParentColumn;this.Entities.ContainsKey(l)||(this.Entities.push(l,"T"+ ++t),n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[l]+" with(nolock) ON "+this.Entities[l]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn),e.ActualColumn=" CASE WHEN "+this.Entities.Documents+".CostCenterID="+Math.abs(e.CategoryValue)+" THEN "+this.Entities[l]+"."+e.Column+" ELSE NULL END",A+=","+e.ActualColumn,D+=","+e.ActualColumn+" AS ["+I.ID+"]",this.SelectTagAliasOnly+=","+I.ID;continue}if(e.ColumnCostCenterID>0&&null!=e.ParentTableAlias&&e.ParentTableAlias.Contains("_CCMAP")){if(this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"T"+ ++t),n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+m+"."+e.ParentColumn),"COM_ADDRESS"==e.Table.toUpperCase()){e.ActualColumn="(select CCADD."+e.Column+" from COM_ADDRESS CCADD with(nolock) where CCADD.AddressTypeID=1 AND CCADD.FeatureID="+e.ColumnCostCenterID+" AND "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CCADD.FeaturePK)",D+=","+e.ActualColumn,D+=" AS ["+I.ID+"]",this.SelectTagAliasOnly+=","+I.ID;continue}if(null!=e.ChildCDGDO&&!this.Entities.ContainsKey(e.ChildCDGDO.CategoryText))if("COM_CCCCDATA"==e.ChildCDGDO.ParentTable.toUpperCase())this.Entities.ContainsKey(e.ChildCDGDO.ParentTableAlias)||(this.Entities.push(e.ChildCDGDO.ParentTableAlias,"T"+ ++t),n+=" LEFT JOIN COM_CCCCDATA AS "+this.Entities[e.ChildCDGDO.ParentTableAlias]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities[e.ChildCDGDO.ParentTableAlias]+".NodeID and "+this.Entities[e.ChildCDGDO.ParentTableAlias]+".CostCenterID="+e.ParentCostCenterID),this.Entities.ContainsKey(e.ChildCDGDO.CategoryText)||(this.Entities.push(e.ChildCDGDO.CategoryText,"T"+ ++t),n+=" LEFT JOIN "+e.ChildCDGDO.ParentCostCenterSysName+" AS "+this.Entities[e.ChildCDGDO.CategoryText]+" with(nolock) ON "+this.Entities[e.ChildCDGDO.CategoryText]+"."+e.ChildCDGDO.ParentCostCenterColSysName+"="+this.Entities[e.ChildCDGDO.ParentTableAlias]+"."+e.ChildCDGDO.ParentColumn);else if(e.ChildCDGDO.ParentColumn.startsWith("ccAlpha")||e.ChildCDGDO.ParentColumn.startsWith("Alpha")||e.ChildCDGDO.ParentColumn.startsWith("alpha")){e.ActualColumn=" case when isnumeric("+this.Entities[e.CategoryText]+"."+e.ChildCDGDO.ParentColumn+")=1 then (select "+e.ChildCDGDO.Column+" from "+e.ChildCDGDO.ParentCostCenterSysName+" with(nolock) where "+e.ChildCDGDO.ParentCostCenterColSysName+"="+this.Entities[e.CategoryText]+"."+e.ChildCDGDO.ParentColumn+") else null end",D+=","+e.ActualColumn+" AS ["+I.ID+"]",this.SelectTagAliasOnly+=","+I.ID;continue}}else{if(2==e.ColumnCostCenterID&&156==this.StaticReportType){e.ActualColumn=" CASE WHEN D.CostCenterID="+Math.abs(e.CategoryValue)+" THEN (select "+e.Column+" from Acc_Accounts with(nolock) where AccountID =D."+e.ParentColumn+") ELSE NULL END ",D+=","+e.ActualColumn+" AS ["+I.ID+"]",this.SelectTagAliasOnly+=","+I.ID;continue}113==e.ColumnCostCenterID?this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"T"+ ++t),n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn,C.J0.IntTryParse(N.d.SessionManager.LangID)>1&&(n+=" LEFT JOIN COM_LanguageResources LR"+this.Entities[e.CategoryText]+" WITH(NOLOCK) ON LR"+this.Entities[e.CategoryText]+".LanguageID="+C.J0.IntTryParse(N.d.SessionManager.LangID)+" AND LR"+this.Entities[e.CategoryText]+".ResourceID="+this.Entities[e.CategoryText]+".ResourceID")):12==e.ParentCostCenterID||16==e.ParentCostCenterID?this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,12==e.ParentCostCenterID?"T"+ ++t+"CUR":"T"+ ++t),n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn):(7==e.ColumnCostCenterID||3==e.ColumnCostCenterID&&(203==this.StaticReportType||204==this.StaticReportType))&&(this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"T"+ ++t),n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn))}(-2==this.StaticReportType||81==this.StaticReportType)&&(2==e.ColumnCostCenterID?this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"A"+ ++t),n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn):3==e.ColumnCostCenterID&&(this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"PRD"),n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn)));try{if(400==e.CategoryValue)if(214==e.FieldValue){let l="",b=C.J0.IsEmpty(e.DimensionsFilter)?[]:e.DimensionsFilter.split("~");if(b.length>2&&b[1].length>0&&b[2].length>0){let P=b[2].split(",");for(let w=0;w<P.length;w++)w>0&&(l+=","),P[w].startsWith("EFPRD_")?l+="P."+P[w].Replace("EFPRD_",""):P[w].startsWith("EFPD_")?l+="D."+P[w].Replace("EFPD_",""):P[w].startsWith("EF_")&&(l=this.SetExtFunctionParams(P[w],l));l.length>0&&(e.ActualColumn="dbo."+b[1]+"("+l+")")}else e.ActualColumn="null "}else if(11515==I.CDGDO.FieldValue)D+=",stuff((select ','+[GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+this.Entities.Documents+".CostCenterID AND FeaturePK="+this.Entities.Documents+".DocID FOR XML PATH('')),1,1,'') "+I.ID+"_ID",this.SelectTagAliasOnly+=","+I.ID+"_ID",e.ActualColumn="stuff((select ', '+ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+this.Entities.Documents+".CostCenterID AND FeaturePK="+this.Entities.Documents+".DocID FOR XML PATH('')),1,2,'')";else if(11484==I.CDGDO.FieldValue)e.ActualColumn="(SELECT VoucherNo FROM INV_DocDetails with(nolock)\tWHERE InvDocDetailsID IN (select LinkedInvDocDetailsID from INV_DocDetails with(nolock) WHERE InvDocDetailsID="+this.Entities.Documents+".InvDocDetailsID and LinkedInvDocDetailsID>0))";else if(11514==I.CDGDO.FieldValue)e.ActualColumn="(SELECT convert(datetime,DocDate) FROM INV_DocDetails with(nolock)\tWHERE InvDocDetailsID IN (select LinkedInvDocDetailsID from INV_DocDetails with(nolock) WHERE InvDocDetailsID="+this.Entities.Documents+".InvDocDetailsID and LinkedInvDocDetailsID>0))";else if(21358==I.CDGDO.FieldValue)this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"DocumentType"),n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+e.ParentColumn),e.ActualColumn="DocumentType.DocumentName";else if(11413==I.CDGDO.FieldValue)e.ActualColumn="D.BankAccountID";else{let l=new K;l.DocID=-1,l.IsInventory=this.IsInventory,this.SetActualColumn(e,l)}else 0==C.J0.stringCompare(e.Formula,"LATEST")||0==C.J0.stringCompare(e.Formula,"OLDEST")?e.ActualColumn=this.GetLatestOldestQuery(e,"P",""):(this.Entities.ContainsKey(e.CategoryText)||this.Entities.push(e.CategoryText,this.Entities.Documents),this.SetActualColumn_1(e));"CASE WHEN "==e.ActualColumn&&e.IsForeignKey&&e.CategoryValue>=40001&&e.CategoryValue<5e4||(A+=","+e.ActualColumn,D+=","+e.ActualColumn,D+=" AS ["+I.ID+"]",this.SelectTagAliasOnly+=","+I.ID,("3"==I.LinkType.SelectedValue||"4"==I.LinkType.SelectedValue)&&e.ColumnCostCenterID>5e4&&(D+=","+e.ActualTable+".NodeID",D+=" ["+I.ID+"_ID]",this.SelectTagAliasOnly+=","+I.ID+"_ID"))}catch{}}else if(320==this.StaticReportType)2==e.ColumnCostCenterID||e.ColumnCostCenterID>5e4?this.Entities.ContainsKey(e.CategoryText)||(0==t&&(t=2),this.Entities.Add(e.CategoryText,"T"+ ++t),e.ActualColumn=e.Column,D+=","+this.Entities[e.CategoryText]+"."+e.ActualColumn+" AS ["+I.ID+"]",n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON T0."+e.ParentColumn+"="+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName):D+=",T0."+e.Column+" AS  + col.ID + ";else if(323==this.StaticReportType)2==e.ColumnCostCenterID||e.ColumnCostCenterID>5e4?this.Entities.ContainsKey(e.CategoryText)||(0==t&&(t=12),this.Entities.Add(e.CategoryText,"T"+ ++t),e.ActualColumn=e.Column,D+=","+this.Entities[e.CategoryText]+"."+e.ActualColumn+" AS ["+I.ID+"]",n+=2==e.ColumnCostCenterID?" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON T1."+e.ParentColumn+"="+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName:" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON T12."+e.ParentColumn+"="+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName):e.Column.Contains("Alpha")?D+=",T1."+e.Column+" AS ["+I.ID+"]":D+=",T0."+e.Column+" AS ["+I.ID+"]";else if(2==e.CategoryValue){if("ACC_AccountsExtended"==e.Table){o=e.CategoryText+"ACC_AccountsExtended",this.Entities.ContainsKey(o)||(this.Entities.push(o,"ACCEXT"),this.GroupFromTag+=" LEFT JOIN ACC_AccountsExtended AS "+this.Entities[o]+" with(nolock) ON "+this.Entities.Account+".AccountID=ACCEXT.AccountID"),this.GroupSelectTag+=",ACCEXT."+e.Column+" AS ["+I.ID+"]",this.GroupSelectTagAlias+=","+I.ID;continue}if("COM_ADDRESS"==e.Table.toUpperCase()){o=e.CategoryText+"COM_ADDRESS",this.Entities.ContainsKey(o)||(this.Entities.push(o,"ACCADD"),this.GroupFromTag+=" LEFT JOIN COM_ADDRESS AS "+this.Entities[o]+" with(nolock) ON ACCADD.AddressTypeID=1 AND ACCADD.FeatureID=2 AND "+this.Entities.Account+".AccountID=ACCADD.FeaturePK"),this.GroupSelectTag+=",ACCADD."+e.Column+" AS ["+I.ID+"]",this.GroupSelectTagAlias+=","+I.ID;continue}if("Shipping_Address"==e.Table||"Billing_Address"==e.Table){this.GroupSelectTag+=",(select "+this.GetAddressColumn(e.Column.substr(5))+" from COM_ADDRESS with(nolock) where AddressID=(select min(AddressID) from COM_ADDRESS with(nolock) where AddressTypeID="+("Shipping_Address"==e.Table?"3":"2")+" and FeatureID=2 AND "+this.Entities.Account+".AccountID=FeaturePK)) AS ["+I.ID+"]",this.GroupSelectTagAlias+=","+I.ID;continue}if(e.IsForeignKey&&(this.Entities.ContainsKey(e.CategoryText)||(o="T"+ ++t,this.Entities.push(e.CategoryText,o),0==C.J0.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||(this.Entities.push("CC","CC"),this.GroupFromTag+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID=P.AccountID AND CC.CostCenterID="+e.CategoryValue),this.GroupFromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):this.GroupFromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Account+"."+e.ParentColumn)),!this.Entities.ContainsKey(e.CategoryText))return;let l=new K;l.DocID=-1,l.IsInventory=this.IsInventory,this.SetActualColumn(e,l),this.GroupSelectTag+=","+e.ActualColumn+" AS ["+I.ID+"]",this.GroupSelectTagAlias+=","+I.ID}else if(3==e.CategoryValue){if("INV_ProductExtended"==e.Table){o=e.CategoryText+"INV_ProductExtended",this.Entities.ContainsKey(o)||(this.Entities.push(o,"PRODEXT"),this.GroupFromTag+=" LEFT JOIN INV_ProductExtended AS "+this.Entities[o]+" with(nolock) ON P.ProductID=PRODEXT.ProductID"),this.DbGroupSelectTag+=",PRODEXT."+e.Column,this.GroupSelectTag+=",PRODEXT."+e.Column+" AS ["+I.ID+"]",this.GroupSelectTagAlias+=","+I.ID;continue}if(e.IsForeignKey&&!this.Entities.ContainsKey(e.CategoryText)&&8!=e.ParentCostCenterID&&(o="T"+ ++t,this.Entities.push(e.CategoryText,o),0==C.J0.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||(this.Entities.push("CC","CC"),this.GroupFromTag+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID=P.ProductID AND CC.CostCenterID="+e.CategoryValue),this.GroupFromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):this.GroupFromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Product+"."+e.ParentColumn),!this.Entities.ContainsKey(e.CategoryText)&&8!=e.ParentCostCenterID)continue;let l=new K;l.DocID=-1,l.IsInventory=this.IsInventory,this.SetActualColumn(e,l),this.DbGroupSelectTag+=","+e.ActualColumn,this.GroupSelectTag+=","+e.ActualColumn+" AS ["+I.ID+"]",this.GroupSelectTagAlias+=","+I.ID}else if(16==e.CategoryValue){if(e.IsForeignKey&&(this.Entities.ContainsKey(e.CategoryText)||(o="T"+ ++t,this.Entities.push(e.CategoryText,o),0==C.J0.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||(this.Entities.push("CC","CC"),this.GroupFromTag+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID=B.BatchID AND CC.CostCenterID="+e.CategoryValue),this.GroupFromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):this.GroupFromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Product+"."+e.ParentColumn)),!this.Entities.ContainsKey(e.CategoryText))return;let l=new K;l.DocID=-1,l.IsInventory=this.IsInventory,this.SetActualColumn(e,l),this.DbGroupSelectTag+=","+e.ActualColumn,this.GroupSelectTag+=","+e.ActualColumn+" AS ["+I.ID+"]",this.GroupSelectTagAlias+=","+I.ID}}112==this.CostCenterID&&(D+=",D.InvDocDetailsID ReorderDetailsID",this.SelectTagAliasOnly+=",ReorderDetailsID"),this.DbSelectTag=A.toString(),this.SelectTag=D.toString(),this.FromTag=n.toString()}else if(9==this.StaticReportType||10==this.StaticReportType||11==this.StaticReportType||198==this.StaticReportType){let g=!1,S=new Array;S.AddRange(this.BaseReportColumns),S.AddRange(this.ReportGroups);let I=!1,l="DocNo";"ReportViewModel"==this.ClassName&&this.Report.Preferences.ContainsKey("FIFO")&&"1"==this.Report.Preferences.FIFO&&(I=!0,l="VoucherNo");for(let b=0;b<S.length;b++){let P=S[b];if(e=P.CDGDO,33==P.ID.length)if(400==e.CategoryValue||401==e.CategoryValue||Math.abs(e.CategoryValue)>4e4&&Math.abs(e.CategoryValue)<5e4){if(g=!0,400==e.CategoryValue)if(214==e.FieldValue){let w="",v=C.J0.IsEmpty(e.DimensionsFilter)?[]:e.DimensionsFilter.split("~");if(v.length>2&&v[1].length>0&&v[2].length>0){let f=v[2].split(",");for(let H=0;H<f.length;H++)H>0&&(w+=","),f[H].startsWith("EFPBW_")?w+="B."+f[H].Replace("EFPBW_",""):f[H].startsWith("EFPD_")?w+="D."+f[H].Replace("EFPD_",""):f[H].startsWith("EF_")?w=this.SetExtFunctionParams(f[H],w):w+="null";D+=w.length>0?",dbo."+v[1]+"("+w+")"+P.ID:",null "+P.ID}else D+=",null "+P.ID}else if(0==e.ColumnCostCenterID)"AmountFC"==e.Column?D+=",B."+e.Column+" "+P.ID:"ExchangeRate"==e.Column?D+=I?",B.ExchangeRate "+P.ID:",B.AdjExchRT "+P.ID:"CurrencyID"==e.ParentColumn?(this.Entities.ContainsKey(e.CategoryText)||(o="T"+ ++t,this.Entities.push(e.CategoryText,o),n+=" INNER JOIN "+e.ParentCostCenterSysName+" AS "+o+" with(nolock) ON "+o+".CurrencyID=",n+=I?"B.CurrencyID":"B.AdjCurrID"),D+=","+this.Entities[e.CategoryText]+"."+e.Column+" AS "+P.ID):"ChequeNumber"==e.Column||"ChequeDate"==e.Column||"ChequeMaturityDate"==e.Column?I?(e.ActualColumn="DATE"==e.DataType?"convert(datetime,B."+e.Column+")":"B."+e.Column,D+=",MAX("+e.ActualColumn+") "+P.ID,this.SelectTagAliasOnly+=","+P.ID):(e.ActualColumn="DATE"==e.DataType?"convert(datetime,DOC."+e.Column+")":"DOC."+e.Column,D+=",CASE WHEN DType.IsInventory=0 THEN (SELECT MAX("+e.ActualColumn+") FROM Acc_DocDetails DOC WITH(NOLOCK) WHERE DOC.VoucherNo=B.DocNo) ELSE NULL END "+P.ID):11516==e.FieldValue?D+=",CASE WHEN DType.IsInventory=0 THEN\nstuff((SELECT ','+N.Note FROM Acc_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_Notes N WITH(NOLOCK) ON N.FeatureID=DOC.CostCenterID AND N.FeaturePK=DOC.DocID WHERE DOC.VoucherNo=B."+l+" FOR XML PATH('')),1,1,'')\nELSE\nstuff((SELECT ','+N.Note FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_Notes N WITH(NOLOCK) ON N.FeatureID=DOC.CostCenterID AND N.FeaturePK=DOC.DocID WHERE DOC.VoucherNo=B."+l+" FOR XML PATH('')),1,1,'')  END AS "+P.ID:11484==P.CDGDO.FieldValue?D+=",CASE WHEN DType.IsInventory=0 THEN NULL ELSE\n(STUFF((SELECT distinct ','+VoucherNo FROM INV_DocDetails with(nolock) WHERE InvDocDetailsID IN \n(select LinkedInvDocDetailsID from INV_DocDetails with(nolock) WHERE VoucherNo=B.DocNo and LinkedInvDocDetailsID>0) FOR XML PATH('')),1,1,'')) END AS "+P.ID:11514==P.CDGDO.FieldValue?D+=",CASE WHEN DType.IsInventory=0 THEN NULL ELSE\n(SELECT top 1 convert(datetime,DocDate) FROM INV_DocDetails with(nolock) WHERE InvDocDetailsID IN \n(select LinkedInvDocDetailsID from INV_DocDetails with(nolock) WHERE VoucherNo=B."+l+" and LinkedInvDocDetailsID>0)) END AS "+P.ID:21358==P.CDGDO.FieldValue?D+=",(select "+e.Column+" from ADM_DocumentTypes with(nolock) where CostCenterID=(select top 1 CostCenterID from ACC_DocDetails with(nolock) WHERE VoucherNo=B."+l+")) AS "+P.ID:I?(e.ActualColumn="DATE"==e.DataType?"convert(datetime,B."+e.Column+")":"B."+e.Column,D+=",MAX("+e.ActualColumn+") "+P.ID,this.SelectTagAliasOnly+=","+P.ID):(e.ActualColumn="DATE"==e.DataType?"convert(datetime,DOC."+e.Column+")":"DOC."+e.Column,D+=",CASE WHEN DType.IsInventory=0 THEN\n  (SELECT MAX("+e.ActualColumn+") FROM Acc_DocDetails DOC WITH(NOLOCK) WHERE DOC.VoucherNo=B."+l+" and Doc.DocSeqNo=B.DocSeqNo)\n  ELSE\n  (SELECT MAX("+e.ActualColumn+") FROM INV_DocDetails DOC WITH(NOLOCK) WHERE DOC.VoucherNo=B."+l+")  END AS "+P.ID);else if(7==e.ParentCostCenterID)D+=",CASE WHEN DType.IsInventory=0 THEN (select top 1 [USER]."+e.Column+" from ACC_DocDetails DOC with(nolock) JOIN "+e.ParentCostCenterSysName+" [USER] with(nolock) ON [USER]."+e.ParentCostCenterColSysName+"=DOC."+e.ParentColumn+" WHERE DOC.VoucherNo=B."+l+")\nELSE\n(select top 1 [USER]."+e.Column+" from INV_DocDetails DOC with(nolock) JOIN "+e.ParentCostCenterSysName+" [USER] with(nolock) ON [USER]."+e.ParentCostCenterColSysName+"=DOC."+e.ParentColumn+" WHERE DOC.VoucherNo=B."+l+")\nEND AS "+P.ID;else if(12==e.ParentCostCenterID)this.Entities.ContainsKey(e.CategoryText)||(this.Entities.push(e.CategoryText,"T"+ ++t),n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=B.AdjCurrID"),I?(D+=",max("+this.Entities[e.CategoryText]+"."+e.Column+") "+P.ID,this.SelectTagAliasOnly+=","+P.ID):D+=","+this.Entities[e.CategoryText]+"."+e.Column+" "+P.ID;else if(e.ColumnCostCenterID>5e4&&(0==this.ReportGroups.filter(w=>w.ID==P.ID).length||198==this.StaticReportType)){if("COM_ADDRESS"==e.Table.toUpperCase()){e.ActualColumn="(select CCADD."+e.Column+" from COM_ADDRESS CCADD with(nolock) where CCADD.AddressTypeID=1 AND CCADD.FeatureID="+e.ColumnCostCenterID+" AND B.dcCCNID"+(e.ColumnCostCenterID-5e4)+"=CCADD.FeaturePK)",D+=","+e.ActualColumn,D+=" AS ["+P.ID+"]";continue}this.Entities.ContainsKey(e.CategoryText)||(o="T"+ ++t,this.Entities.push(e.CategoryText,o),n+=" INNER JOIN "+e.ParentCostCenterSysName+" AS "+o+" with(nolock) ON "+o+".NodeID="+(I?"DCC.":"B.")+e.ParentColumn),I?(D+=",max("+this.Entities[e.CategoryText]+"."+e.Column+") "+P.ID,this.SelectTagAliasOnly+=","+P.ID):D+=","+this.Entities[e.CategoryText]+"."+e.Column+" "+P.ID}else("Shipping_Address"==e.Table||"Billing_Address"==e.Table)&&2==e.ColumnCostCenterID&&10==this.StaticReportType&&(D+=",(select "+this.GetAddressColumn(e.Column.substr(5))+" from COM_ADDRESS with(nolock) where AddressID=(select min(AddressID) from COM_DocAddressData DA with(nolock) JOIN INV_DocDetails I WITH(NOLOCK) ON I.DocID=DA.DocID where DA. AddressTypeID="+("Shipping_Address"==e.Table?"3":"2")+" and I.VoucherNo=B.DocNO)) AS ["+P.ID+"]");else if(401==e.CategoryValue||Math.abs(e.CategoryValue)>4e4&&Math.abs(e.CategoryValue)<5e4){if("COM_DocTextData"==e.Table){if(e.CategoryValue>4e4)if(e.ColumnCostCenterID>0){let w,v,f;if(C.J0.IsEmpty(e.ParentCostCenterSysName)){let H=N.d.report.GetTableColumns(e.ColumnCostCenterID);H.TableName=w,H.PrimaryKey=v,H.ColumnName=f}else w=e.ParentCostCenterSysName,v=e.ParentCostCenterColSysName,f=e.ParentColumn;D+=",(select "+f+" from "+w+" with(nolock) where "+v+"=\n                                        (CASE WHEN DType.IsInventory=0 THEN\n  (SELECT MAX(TXT."+e.Column+') FROM Acc_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocTextData TXT WITH(NOLOCK)\n    ON TXT.AccDocDetailsID=DOC.AccDocDetailsID WHERE DOC.VoucherNo=B." + strDocNo + " AND DOC.CostCenterID='+e.CategoryValue+" and Doc.DocSeqNo=B.DocSeqNo and isnumeric(TXT."+e.Column+")=1)\n  ELSE\n  (SELECT MAX(TXT."+e.Column+") FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocTextData TXT WITH(NOLOCK)\n    ON TXT.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+l+" AND DOC.CostCenterID="+e.CategoryValue+" and isnumeric(TXT."+e.Column+")=1)  END)) AS "+P.ID}else D+=",CASE WHEN DType.IsInventory=0 THEN\n  (SELECT MAX(TXT."+e.Column+") FROM Acc_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocTextData TXT WITH(NOLOCK)\n    ON TXT.AccDocDetailsID=DOC.AccDocDetailsID WHERE DOC.VoucherNo=B."+l+" AND DOC.CostCenterID="+e.CategoryValue+" and Doc.DocSeqNo=B.DocSeqNo)\n  ELSE\n  (SELECT MAX(TXT."+e.Column+") FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocTextData TXT WITH(NOLOCK)\n    ON TXT.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+l+" AND DOC.CostCenterID="+e.CategoryValue+")  END AS "+P.ID;else{let w=this.GetTextField_AllDocuments(e.CategoryValue,e.FieldText);if(w.Tables[1].length>0){let v=(0,Z.yG0)(w.Tables[0][0].IsInventory),f=" CASE";for(let H=0;H<w.Tables[1].length;H++)f+=" WHEN MAX(DOC.CostCenterID)="+w.Tables[1][H].CostCenterID.toString(),f+=" THEN MAX(TXT."+w.Tables[1][H].SysColumnName.toString()+")";f+="END ",D+=v?",CASE WHEN DType.IsInventory=0 THEN NULL ELSE (SELECT "+f+" FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocTextData TXT WITH(NOLOCK) ON TXT.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+l+") END AS "+P.ID:",CASE WHEN DType.IsInventory=1 THEN NULL ELSE (SELECT "+f+" FROM ACC_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocTextData TXT WITH(NOLOCK) ON TXT.AccDocDetailsID=DOC.AccDocDetailsID WHERE DOC.VoucherNo=B."+l+") END AS "+P.ID}}continue}if("COM_DocNumData"==e.Table){if(401==e.CategoryValue)188==e.FieldValue?(D+=",CASE WHEN DType.IsInventory=0 THEN NULL\nELSE\n(SELECT top 1 (select  top 1 X.value('@Remarks','nvarchar(max)') from NUM.Remarks.nodes('/XML/Row') as Data(X) where ",C.J0.IsEmpty(e.Formula)?D+="X.value('@CreditAcount','bigint')=A.AccountID or X.value('@DebitAcount','bigint')=A.AccountID":D+="X.value('@Columnname','nvarchar(50)')='dcNum"+e.Formula+"'",D+=") FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK)\nON NUM.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+l+")  END AS "+P.ID):D+=",CASE WHEN DType.IsInventory=0 THEN\n  (SELECT SUM(NUM."+e.Column+") FROM Acc_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK)\n    ON NUM.AccDocDetailsID=DOC.AccDocDetailsID WHERE DOC.VoucherNo=B."+l+" and Doc.DocSeqNo=B.DocSeqNo)\n  ELSE\n  (SELECT SUM(NUM."+e.Column+") FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK)\n    ON NUM.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+l+")  END AS "+P.ID;else if(e.CategoryValue>4e4)D+=",CASE WHEN DType.IsInventory=0 THEN\n  (SELECT SUM(NUM."+e.Column+") FROM Acc_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK)\n    ON NUM.AccDocDetailsID=DOC.AccDocDetailsID WHERE DOC.VoucherNo=B."+l+" AND DOC.CostCenterID="+e.CategoryValue+" and Doc.DocSeqNo=B.DocSeqNo)\n  ELSE\n  (SELECT SUM(NUM."+e.Column+") FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK)\n    ON NUM.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+l+" AND DOC.CostCenterID="+e.CategoryValue+")  END AS "+P.ID;else{let w=this.GetTextField_AllDocuments(e.CategoryValue,e.FieldText);if(w.Tables[1].length>0){let v=(0,Z.yG0)(w.Tables[0][0].IsInventory),f=" CASE";for(let H=0;H<w.Tables[1].length;H++)f+=" WHEN SUM(DOC.CostCenterID)="+w.Tables[1][H].CostCenterID.toString(),f+=" THEN SUM(NUM."+w.Tables[1][H].SysColumnName.toString()+")";f+="END ",D+=v?",CASE WHEN DType.IsInventory=0 THEN NULL ELSE (SELECT "+f+" FROM INV_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK) ON NUM.InvDocDetailsID=DOC.InvDocDetailsID WHERE DOC.VoucherNo=B."+l+") END AS "+P.ID:",CASE WHEN DType.IsInventory=1 THEN NULL ELSE (SELECT "+f+" FROM ACC_DocDetails DOC WITH(NOLOCK) INNER JOIN COM_DocNumData NUM WITH(NOLOCK) ON NUM.AccDocDetailsID=DOC.AccDocDetailsID WHERE DOC.VoucherNo=B."+l+") END AS "+P.ID}}continue}2==e.ColumnCostCenterID&&(I?(D+=",CASE WHEN DType.IsInventory=0 THEN \n(select TOP 1 A."+e.Column+" from acc_accounts A with(nolock) where A.AccountID=max(B."+e.ParentColumn+"))\nELSE \n(select TOP 1 A."+e.Column+" from inv_docdetails D with(nolock) inner join acc_accounts A with(nolock) on A.AccountID=D."+e.ParentColumn+" where D.CostCenterID="+e.CategoryValue+" AND D.VoucherNo=B.VoucherNo) END AS ["+P.ID+"]",this.SelectTagAliasOnly+=","+P.ID):D+=",CASE WHEN DType.IsInventory=0 THEN \n(select TOP 1 A."+e.Column+" from acc_docdetails D with(nolock) inner join acc_accounts A with(nolock) on A.AccountID=D."+e.ParentColumn+" where D.CostCenterID="+e.CategoryValue+" AND D.VoucherNo=B.DocNo)\nELSE \n(select TOP 1 A."+e.Column+" from inv_docdetails D with(nolock) inner join acc_accounts A with(nolock) on A.AccountID=D."+e.ParentColumn+" where D.CostCenterID="+e.CategoryValue+" AND D.VoucherNo=B.DocNo) END AS ["+P.ID+"]")}}else if(2==e.CategoryValue){if(!this.Entities.ContainsKey(e.CategoryText)&&!e.IsForeignKey)return;if("ACC_AccountsExtended"==e.Table)o=e.CategoryText+"ACC_AccountsExtended",this.Entities.ContainsKey(o)||(this.Entities.push(o,"ACCEXT"),n+=" LEFT JOIN ACC_AccountsExtended AS "+this.Entities[o]+" with(nolock) ON A.AccountID=ACCEXT.AccountID"),D+=",ACCEXT."+e.Column+" AS ["+P.ID+"]";else if("COM_ADDRESS"==e.Table.toUpperCase())o=e.CategoryText+"COM_ADDRESS",this.Entities.ContainsKey(o)||(this.Entities.push(o,"ACCADD"),n+=" LEFT JOIN COM_ADDRESS AS "+this.Entities[o]+" with(nolock) ON ACCADD.AddressTypeID=1 AND ACCADD.FeatureID=2 AND A.AccountID=ACCADD.FeaturePK"),D+=",ACCADD."+e.Column+" AS ["+P.ID+"]";else if("Shipping_Address"==e.Table||"Billing_Address"==e.Table)D+=",(select "+this.GetAddressColumn(e.Column.substr(5))+" from COM_ADDRESS with(nolock) where AddressID=(select min(AddressID) from COM_ADDRESS with(nolock) where AddressTypeID="+("Shipping_Address"==e.Table?"3":"2")+" and FeatureID=2 AND A.AccountID=FeaturePK)) AS ["+P.ID+"]";else if(e.IsForeignKey)this.Entities.ContainsKey(e.CategoryText)||(o="T"+ ++t,this.Entities.push(e.CategoryText,o),0==C.J0.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey(e.ParentTableAlias)||(this.Entities.push(e.ParentTableAlias,e.ParentTableAlias),n+=" LEFT JOIN COM_CCCCData "+e.ParentTableAlias+" with(nolock) ON "+e.ParentTableAlias+".NodeID="+this.Entities.Account+".AccountID AND "+e.ParentTableAlias+".CostCenterID="+e.CategoryValue),n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+e.ParentTableAlias+"."+e.ParentColumn):n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Account+"."+e.ParentColumn),I?(D+=",max("+this.Entities[e.CategoryText]+"."+e.Column+") "+P.ID,this.SelectTagAliasOnly+=","+P.ID):"accounttypeid"!=e.Column.toLowerCase()||9!=this.StaticReportType&&10!=this.StaticReportType&&11!=this.StaticReportType?D+=","+this.Entities[e.CategoryText]+"."+e.Column+" "+P.ID:D+=", AT.AccountType "+P.ID;else{let w=new K;w.DocID=-1,w.IsInventory=this.IsInventory,this.SetActualColumn(e,w),D+=","+e.ActualColumn+" ["+P.ID+"]",e.ActualColumn.startsWith("A.")&&("3"==P.LinkType.SelectedValue||"4"==P.LinkType.SelectedValue)&&(D+=",A.AccountID AS "+P.ID+"_ID")}}else 99==e.CategoryValue&&"COM_DocTextData"!=e.Table&&(I?(e.ActualColumn="DATE"==e.DataType?"convert(datetime,B."+e.Column+")":"B."+e.Column,D+=",MAX("+e.ActualColumn+") "+P.ID,this.SelectTagAliasOnly+=","+P.ID):(e.ActualColumn="CommonNarration"==e.Column?"B.Narration":"DATE"==e.DataType?"convert(datetime,B."+e.Column+")":"B."+e.Column,D+=","+e.ActualColumn+" "+P.ID))}S.find(b=>"AgainstAccount"==b.ID&&"1"==b.Visibility.SelectedValue)&&(D+=",isnull((select top 1 SA.AccountName from ACC_DocDetails with(nolock)\ninner join ACC_Accounts SA with(nolock) on SA.AccountID=CreditAccount where B.RefDocNo is not null and VoucherNo=B.RefDocNo and DebitAccount=B.AccountID and (InvDocDetailsID is not null or DocSeqNo=B.RefDocSeqNo))\n,(select top 1 SA.AccountName from ACC_DocDetails with(nolock)\ninner join ACC_Accounts SA with(nolock) on SA.AccountID=DebitAccount where B.RefDocNo is not null and VoucherNo=B.RefDocNo and CreditAccount=B.AccountID and (InvDocDetailsID is not null or DocSeqNo=B.RefDocSeqNo))) AgainstAccount"),this.SelectTag=D.toString(),this.FromTag=n.toString(),this.SelectTag.length>0&&g&&this.SelectTag.Contains("DType.")&&(this.FromTag=" INNER JOIN (SELECT DocumentType DocType1,IsInventory FROM ADM_DocumentTypes with(nolock) Group By DocumentType,IsInventory) AS DType ON  DType.DocType1=B."+(I?"DocumentType ":"DocType ")+this.FromTag)}else if(171==this.StaticReportType){let g=new Array;g.AddRange(this.BaseReportColumns),g.AddRange(this.ReportGroups);let S=!1;"ReportViewModel"==this.ClassName&&this.Report.Preferences.ContainsKey("FIFO")&&"1"==this.Report.Preferences.FIFO&&(S=!0);for(let I=0;I<g.length;I++){let l=g[I];if(e=l.CDGDO,33==l.ID.length&&((400==e.CategoryValue||Math.abs(e.CategoryValue)>4e4&&Math.abs(e.CategoryValue)<5e4)&&(400==e.CategoryValue&&0==e.ColumnCostCenterID?"CurrencyID"==e.ParentColumn?(this.Entities.ContainsKey(e.CategoryText)||(o="T"+ ++t,this.Entities.push(e.CategoryText,o),n+=" INNER JOIN "+e.ParentCostCenterSysName+" AS "+o+" with(nolock) ON "+o+".CurrencyID=D.CurrencyID"),D+=","+this.Entities[e.CategoryText]+"."+e.Column+" "+l.ID,this.SelectTagAliasOnly+=","+l.ID):(e.ActualColumn="DATE"==e.DataType?"convert(datetime,D."+e.Column+")":"D."+e.Column,D+=","+e.ActualColumn+" "+l.ID,this.SelectTagAliasOnly+=","+l.ID):e.ColumnCostCenterID>5e4?(this.Entities.ContainsKey(e.CategoryText)||(o="T"+ ++t,this.Entities.push(e.CategoryText,o),n+=" INNER JOIN "+e.ParentCostCenterSysName+" AS "+o+" with(nolock) ON "+o+".NodeID=DCC."+e.ParentColumn),D+=","+this.Entities[e.CategoryText]+"."+e.Column+" "+l.ID,this.SelectTagAliasOnly+=","+l.ID):"COM_DocTextData"==e.Table&&(r||(n+=" LEFT JOIN COM_DocTextData AS DOCTEXT with(nolock) ON DOCTEXT.InvDocDetailsID=D.InvDocDetailsID"),r=!0,D+=",DOCTEXT."+e.Column+" "+l.ID,this.SelectTagAliasOnly+=","+l.ID)),400==e.CategoryValue&&2==e.ColumnCostCenterID||2==e.CategoryValue))if("ACC_AccountsExtended"==e.Table)o=e.CategoryText+"ACC_AccountsExtended",this.Entities.ContainsKey(o)||(this.Entities.push(o,"ACCEXT"),n+=" LEFT JOIN ACC_AccountsExtended AS "+this.Entities[o]+" with(nolock) ON A.AccountID=ACCEXT.AccountID"),D+=",ACCEXT."+e.Column+" AS ["+l.ID+"]";else if("COM_ADDRESS"==e.Table.toUpperCase())o=e.CategoryText+"COM_ADDRESS",this.Entities.ContainsKey(o)||(this.Entities.push(o,"ACCADD"),n+=" LEFT JOIN COM_ADDRESS AS "+this.Entities[o]+" with(nolock) ON ACCADD.AddressTypeID=1 AND ACCADD.FeatureID=2 AND A.AccountID=ACCADD.FeaturePK"),D+=",ACCADD."+e.Column+" AS ["+l.ID+"]";else{let b=new K;b.DocID=-1,b.IsInventory=this.IsInventory,this.SetActualColumn(e,b),D+=","+e.ActualColumn+" AS ["+l.ID+"]"}}this.SelectTag=D.toString(),this.FromTag=n.toString()}else if(4==this.StaticReportType||12==this.StaticReportType||this.StaticReportType>=5&&this.StaticReportType<=8){for(let g=0;g<this.BaseReportColumns.length;g++){let S=this.BaseReportColumns[g];if(e=S.CDGDO,33==S.ID.length)if(2==e.CategoryValue)if("ACC_AccountsExtended"==e.Table)o=e.CategoryText+"ACC_AccountsExtended",this.Entities.ContainsKey(o)||(this.Entities.push(o,"ACCEXT"),n+=" LEFT JOIN ACC_AccountsExtended AS "+this.Entities[o]+" with(nolock) ON "+this.Entities.Account+".AccountID=ACCEXT.AccountID"),D+=",ACCEXT."+e.Column+" AS ["+S.ID+"]";else if(null!=e.Table&&"COM_ADDRESS"==e.Table.toUpperCase())o=e.CategoryText+"COM_ADDRESS",this.Entities.ContainsKey(o)||(this.Entities.push(o,"ACCADD"),n+=" LEFT JOIN COM_ADDRESS AS "+this.Entities[o]+" with(nolock) ON ACCADD.AddressTypeID=1 AND ACCADD.FeatureID=2 AND "+this.Entities.Account+".AccountID=ACCADD.FeaturePK"),D+=",ACCADD."+e.Column+" AS ["+S.ID+"]";else if(e.IsForeignKey)this.Entities.ContainsKey(e.CategoryText)||(o="T"+ ++t,this.Entities.push(e.CategoryText,o),0==C.J0.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||(this.Entities.push("CC","CC"),n+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID="+this.Entities.Account+".AccountID AND CC.CostCenterID="+e.CategoryValue),n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Account+"."+e.ParentColumn),"accounttypeid"==e.Column.toLowerCase()&&12==this.StaticReportType?D+=", AT.AccountType AS ["+S.ID+"]":D+=","+this.Entities[e.CategoryText]+"."+e.Column+" AS ["+S.ID+"]";else if(11396==e.FieldValue){let I=new K;I.DocID=-1,I.IsInventory=!1,this.SetActualColumn(e,I),D+=","+e.ActualColumn+" AS ["+S.ID+"]"}else C.J0.IsEmpty(e.Column)||(D+=","+this.Entities.Account+"."+e.Column+" AS ["+S.ID+"]");else if(400==e.CategoryValue&&214==e.FieldValue){let I="",l=C.J0.IsEmpty(e.DimensionsFilter)?[]:e.DimensionsFilter.split("~");if(l.length>2&&l[1].length>0&&l[2].length>0){let b=l[2].split(",");for(let P=0;P<b.length;P++)P>0&&(I+=","),b[P].startsWith("EFPBW_")?I+="A."+b[P].Replace("EFPBW_",""):b[P].startsWith("EF_")?I=this.SetExtFunctionParams(b[P],I):I+="null";D+=I.length>0?",dbo."+l[1]+"("+I+")"+S.ID:",null "+S.ID}else D+=",null "+S.ID}}this.SelectTag=D.toString(),this.FromTag=n.toString()}else if(14==this.StaticReportType||15==this.StaticReportType||16==this.StaticReportType||83==this.StaticReportType||84==this.StaticReportType||112==this.StaticReportType||114==this.StaticReportType||115==this.StaticReportType||165==this.StaticReportType){for(let g=0;g<this.BaseReportColumns.length;g++){let S=this.BaseReportColumns[g];if(e=S.CDGDO,33==S.ID.length)if(11509==e.FieldValue||11510==e.FieldValue)D+=",(select top 1 StockValue/UOMConvertedQty from INV_DocDetails with(nolock) where ProductID=P.ProductID and VoucherType=1 and UOMConvertedQty>0",C.J0.IsEmptySpace(e.ExecutedDocument)?D+=" and IsQtyIgnored=0":D+=" and CostCenterID IN ("+e.ExecutedDocument+")",D+=" order by docdate desc) AS ["+S.ID+"]";else if(189==e.FieldValue)C.J0.IsEmptySpace(e.ExecutedDocument)?D+=",(select top 1 Rate*ExchangeRate from INV_DocDetails with(nolock) where ProductID=P.ProductID and IsQtyIgnored=0 and UOMConvertedQty>0 order by docdate desc) AS ["+S.ID+"]":D+=",(select top 1 Rate*ExchangeRate from INV_DocDetails with(nolock) where ProductID=P.ProductID and UOMConvertedQty>0 and CostCenterID IN ("+e.ExecutedDocument+") order by docdate desc) AS ["+S.ID+"]";else if(11508!=e.FieldValue)if(181==e.FieldValue){let I=new K;I.DocID=-1,I.IsInventory=this.IsInventory,this.SetActualColumn(e,I),this.GroupSelectTag+=","+e.ActualColumn+" AS ["+S.ID+"]",this.GroupSelectTagAlias+=","+S.ID}else if(214==e.FieldValue){let I="",l=C.J0.IsEmpty(e.DimensionsFilter)?[]:e.DimensionsFilter.split("~");if(l.length>2&&l[1].length>0&&l[2].length>0){let b=l[2].split(",");for(let P=0;P<b.length;P++)P>0&&(I+=","),b[P].startsWith("EFPRD_")?I+="P."+b[P].Replace("EFPRD_",""):b[P].startsWith("EF_")&&(I=this.SetExtFunctionParams(b[P],I));I.length>0&&(D+=",dbo."+l[1]+"("+I+")"+S.ID)}else D+=",null "+S.ID}else if(3==e.CategoryValue)if("INV_ProductExtended"==e.Table)o=e.CategoryText+"INV_ProductExtended",this.Entities.ContainsKey(o)||(this.Entities.push(o,"PRODEXT"),n+=" LEFT JOIN INV_ProductExtended AS "+this.Entities[o]+" with(nolock) ON P.ProductID=PRODEXT.ProductID"),D+=",PRODEXT."+e.Column+" AS ["+S.ID+"]",this.GroupSelectTag+=",MAX(PRODEXT."+e.Column+") AS ["+S.ID+"]";else if(26419==S.CDGDO.FieldValue||26420==S.CDGDO.FieldValue||50453==S.CDGDO.FieldValue||26426==S.CDGDO.FieldValue){if(26420==S.CDGDO.FieldValue&&null!=this.Report&&16==this.StaticReportType&&2==this.ReportGroups.length||26426==S.CDGDO.FieldValue&&null!=this.Report&&16==this.StaticReportType&&2==this.ReportGroups.length)continue;let I=new K;I.DocID=e.CategoryValue,I.IsInventory=!0,this.SetActualColumn(e,I),D+=","+e.ActualColumn+" AS ["+S.ID+"]",this.GroupSelectTag+=",MAX("+e.ActualColumn+") AS ["+S.ID+"]"}else if(170==S.CDGDO.FieldValue||208==S.CDGDO.FieldValue){let I=new K;I.DocID=0,I.IsInventory=!0,this.SetActualColumn(e,I),D+=","+e.ActualColumn+" AS ["+S.ID+"]",this.GroupSelectTag+=",MAX("+e.ActualColumn+") AS ["+S.ID+"]"}else if(e.IsForeignKey)this.Entities.ContainsKey(e.CategoryText)||(o="T"+ ++t,this.Entities.push(e.CategoryText,o),0==C.J0.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||(this.Entities.push("CC","CC"),n+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID=P.ProductID AND CC.CostCenterID="+e.CategoryValue),n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):(n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities.Product+"."+e.ParentColumn,"AccountID"==e.Column&&"INV_ProductVendors"==e.ParentCostCenterSysName&&null!=e.ChildCDGDO&&(o="T"+ ++t,this.Entities.push(e.ChildCDGDO.CategoryText,o),n+=" LEFT JOIN "+e.ChildCDGDO.ParentCostCenterSysName+" AS "+this.Entities[e.ChildCDGDO.CategoryText],n+=" with(nolock) ON "+this.Entities[e.ChildCDGDO.CategoryText]+"."+e.ChildCDGDO.ParentCostCenterColSysName,n+="="+this.Entities[e.CategoryText]+"."+e.ChildCDGDO.ParentColumn))),"AccountID"==e.Column&&"INV_ProductVendors"==e.ParentCostCenterSysName&&null!=e.ChildCDGDO?(D+=","+this.Entities[e.ChildCDGDO.CategoryText]+"."+e.ChildCDGDO.Column+" AS ["+S.ID+"]",this.GroupSelectTag+=",MAX("+this.Entities[e.ChildCDGDO.CategoryText]+"."+e.ChildCDGDO.Column+") AS ["+S.ID+"]"):(D+=","+this.Entities[e.CategoryText]+"."+e.Column+" AS ["+S.ID+"]",this.GroupSelectTag+=",MAX("+this.Entities[e.CategoryText]+"."+e.Column+") AS ["+S.ID+"]");else if("BinDimension"==e.Column){if(this.ReportParams.ContainsKey("BinDimension")||this.ReportParams.push("BinDimension",S.ID),84==this.StaticReportType){let I=0;if(I=C.J0.Int(N.d.SessionManager.Preferences.DimensionwiseBins),"TRUE"==N.d.SessionManager.Preferences["LW Bins"].toUpperCase()||"TRUE"==N.d.SessionManager.Preferences["DW Bins"].toUpperCase()||I>5e4){let l=N.d.report.GetDataTable("RPT024","");if(l.length>0){let b="";"TRUE"==N.d.SessionManager.Preferences["LW Bins"].toUpperCase()?b=this.ReportGroups.length>0&&50002==this.ReportGroups[0].CDGDO.ColumnCostCenterID?" AND B.Location=TBL.TagID":C.J0.IsEmpty(this.oReportDialog.LocationWhere)||this.oReportDialog.LocationWhere.Contains(",")?" AND B.Location="+N.d.SessionManager.LocationID:" AND B.Location="+this.oReportDialog.LocationWhere:"TRUE"==N.d.SessionManager.Preferences["DW Bins"].toUpperCase()&&(b=this.ReportGroups.length>0&&50001==this.ReportGroups[0].CDGDO.ColumnCostCenterID?" AND B.Division=TBL.TagID":" AND B.Division="+N.d.SessionManager.DivisionID),D+=",stuff((select ', '+ D.Name from INV_ProductBins B with(nolock)\ninner join "+l[0].TableName.toString()+" D with(nolock) on B.BinNodeID=D.NodeID\nwhere B.NodeID=P.ProductID AND B.CostCenterID=3"+b+" FOR XML PATH('')),1,2,'') AS ["+S.ID+"]"}}}}else"ProductImage"==e.Column?(D+=",(select top 1 F.GUID+'.'+F.FileExtension from COM_Files F WITH(NOLOCK) where F.FeatureID=3 and F.IsProductImage=1 and F.FeaturePK="+this.Entities.Product+".ProductID and F.IsDefaultImage=1) ["+S.ID+"]",this.GroupSelectTag+=",MAX(select top 1 F.GUID+'.'+F.FileExtension from COM_Files F WITH(NOLOCK) where F.FeatureID=3 and F.IsProductImage=1 and F.FeaturePK="+this.Entities.Product+".ProductID and F.IsDefaultImage=1) ["+S.ID+"]"):"Attachments"==e.Column?(D+=",stuff((select ','+[GUID]+'.'+FileExtension from COM_Files F WITH(NOLOCK) WHERE FeatureID=3 AND F.FeaturePK="+this.Entities.Product+".ProductID and F.IsDefaultImage=0 FOR XML PATH('')),1,1,'')  ["+S.ID+"_ID]",D+=",stuff((select ','+ActualFileName from COM_Files F WITH(NOLOCK) WHERE FeatureID=3 AND F.FeaturePK="+this.Entities.Product+".ProductID and F.IsDefaultImage=0 FOR XML PATH('')),1,1,'')  ["+S.ID+"]"):(D+=",P."+e.Column+" AS ["+S.ID+"]",this.GroupSelectTag+=",MAX(P."+e.Column+") AS ["+S.ID+"]");else e.CategoryValue>4e4&&e.CategoryValue<5e4&&(0==C.J0.stringCompare(S.Formula.Text,"LATEST",!0)?0==e.IsForeignKey&&("DocDate"==e.Column?D+=",(select TOP 1 CONVERT(DATETIME,A.DocDate) from inv_docdetails A with(nolock) @CCWHERE@ where A.productid=P.productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc) AS ["+S.ID+"]":e.Column.startsWith("dcCalcNum")||e.Column.startsWith("dcNum")?D+=",(select TOP 1 N."+e.Column+" from inv_docdetails A with(nolock) inner join COM_DocNumData N with(nolock) on N.invdocdetailsid=A.invdocdetailsid @CCWHERE@ where A.productid=P.productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc) AS ["+S.ID+"]":D+=",(select TOP 1 "+e.Column+" from inv_docdetails A with(nolock) @CCWHERE@ where A.productid=P.productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc) AS ["+S.ID+"]"):0==C.J0.stringCompare(S.Formula.Text,"OLDEST",!0)&&0==e.IsForeignKey&&("DocDate"==e.Column?D+=",(select TOP 1 CONVERT(DATETIME,A.DocDate) from inv_docdetails A with(nolock) @CCWHERE@ where A.productid=P.productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc) AS ["+S.ID+"]":e.Column.startsWith("dcCalcNum")||e.Column.startsWith("dcNum")?D+=",(select TOP 1 N."+e.Column+" from inv_docdetails A with(nolock) inner join COM_DocNumData N with(nolock) on N.invdocdetailsid=A.invdocdetailsid @CCWHERE@ where A.productid=P.productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc) AS ["+S.ID+"]":D+=",(select TOP 1 "+e.Column+" from inv_docdetails A with(nolock) @CCWHERE@ where A.productid=P.productID AND A.costcenterid="+e.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc) AS ["+S.ID+"]"))}this.SelectTag=D.toString(),this.FromTag=n.toString()}else if(118==this.StaticReportType){for(let g=0;g<this.BaseReportColumns.length;g++){let S=this.BaseReportColumns[g];e=S.CDGDO,33==S.ID.length&&e.IsForeignKey&&(this.Entities.ContainsKey(e.CategoryText)||(o="T"+ ++t,this.Entities.push(e.CategoryText,o),0==C.J0.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||(this.Entities.push("CC","CC"),n+=" LEFT JOIN COM_CCCCData CC with(nolock) ON CC.NodeID=P.ProductID AND CC.CostCenterID="+e.CategoryValue),n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):n+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=A."+e.ParentColumn),D+=","+this.Entities[e.CategoryText]+"."+e.Column+" AS ["+S.ID+"]")}this.SelectTag=D.toString(),this.FromTag=n.toString()}else if(196==this.StaticReportType){let g=new Array;g.AddRange(this.BaseReportColumns),g.AddRange(this.ReportGroups);for(let S=0;S<g.length;S++){let I=g[S];if(e=I.CDGDO,33==I.ID.length&&N.d.SessionManager.Preferences.Registers.length>0&&e.CategoryValue==parseInt(N.d.SessionManager.Preferences.Registers)){let l=e.CategoryText.split(".")[0];if(this.Entities.ContainsKey(l)||this.Entities.push(l,"R"),e.IsForeignKey&&(this.Entities.ContainsKey(e.CategoryText)||(o="T"+ ++t,this.Entities.push(e.CategoryText,o),0==C.J0.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("REG_CC")||(this.Entities.push("REG_CC","REG_CC"),this.FromTag+=" LEFT JOIN COM_CCCCData CC with(nolock) ON REG_CC.NodeID=R.NodeID AND REG_CC.CostCenterID="+e.CategoryValue),this.FromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=REG_CC."+e.ParentColumn):this.FromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities[l]+"."+e.ParentColumn)),!this.Entities.ContainsKey(e.CategoryText))continue;let b=new K;b.DocID=-1,b.IsInventory=this.IsInventory,this.SetActualColumn(e,b),this.SelectTag+=","+e.ActualColumn+" AS ["+I.ID+"]"}}}else if(73==this.StaticReportType||87==this.StaticReportType||this.StaticReportType>=209&&this.StaticReportType<=215){let g=new Array;g.AddRange(this.BaseReportColumns),g.AddRange(this.ReportGroups);for(let S=0;S<g.length;S++){let I=g[S];if(33==I.ID.length&&(92==I.CDGDO.CategoryValue||93==I.CDGDO.CategoryValue||94==I.CDGDO.CategoryValue||95==I.CDGDO.CategoryValue||214==I.CDGDO.CategoryValue))if(e=I.CDGDO,e.IsForeignKey){if(this.Entities.ContainsKey(e.CategoryText))if("REN_PropertyExtended"==e.Table||"REN_UnitsExtended"==e.Table||"REN_TenantExtended"==e.Table)o=e.CategoryText+e.Table,this.Entities.ContainsKey(o)||("REN_PropertyExtended"==e.Table?(this.Entities.push(o,"PRPEXT"),n+=" JOIN "+e.Table+" AS "+this.Entities[o]+" with(nolock) ON C.PropertyID="+this.Entities[o]+".NodeID"):"REN_UnitsExtended"==e.Table?(this.Entities.push(o,"UNTEXT"),n+=" JOIN "+e.Table+" AS "+this.Entities[o]+" with(nolock) ON C.UnitID="+this.Entities[o]+".UnitID"):"REN_TenantExtended"==e.Table&&(this.Entities.push(o,"TNTEXT"),n+=" JOIN "+e.Table+" AS "+this.Entities[o]+" with(nolock) ON C.TenantID="+this.Entities[o]+".TenantID")),D+=44==e.LocalReference?",case when "+this.Entities[o]+"."+e.Column+" is not null and isnumeric("+this.Entities[o]+"."+e.Column+")=1 then (select TOP 1 Name from COM_Lookup L with(nolock) where L.NodeID="+this.Entities[o]+"."+e.Column+") else '' end AS ["+I.ID+"]":","+this.Entities[o]+"."+e.Column+" AS ["+I.ID+"]";else if(null!=e.ChildCDGDO&&e.IsForeignKey)0==C.J0.stringCompare(e.Table,"COM_CCCCData",!0)&&!this.Entities.ContainsKey(e.ChildCDGDO.ParentTableAlias)&&(this.Entities.push(e.ChildCDGDO.ParentTableAlias,"RTCC"+ ++t),n+=" LEFT JOIN COM_CCCCData "+this.Entities[e.ChildCDGDO.ParentTableAlias]+" with(nolock) ON "+this.Entities[e.ChildCDGDO.ParentTableAlias]+".NodeID="+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+" AND "+this.Entities[e.ChildCDGDO.ParentTableAlias]+".CostCenterID="+e.ColumnCostCenterID),o=e.CategoryText+e.ChildCDGDO.Table,this.Entities.ContainsKey(o)||(this.Entities.push(o,"RT"+ ++t),n+=" JOIN "+e.ChildCDGDO.Table+" AS "+this.Entities[o]+" with(nolock) ON "+this.Entities[o]+"."+e.ChildCDGDO.ParentCostCenterColSysName+"="+this.Entities[e.ChildCDGDO.ParentTableAlias]+"."+e.ChildCDGDO.ParentColumn),D+=","+this.Entities[o]+"."+e.ChildCDGDO.Column+" AS ["+I.ID+"]";else{let l=new K;l.DocID=-1,l.IsInventory=this.IsInventory,this.SetActualColumn(e,l),D+=44==e.LocalReference?","+e.ActualColumn+" AS ["+I.ID+"]":"REN_Contract"==e.Table&&"ExpectedEndDate"==e.Column?",CONVERT(DATETIME,"+this.Entities[e.CategoryText]+"."+e.Column+") AS ["+I.ID+"]":","+this.Entities[e.CategoryText]+"."+e.Column+" AS ["+I.ID+"]"}else{let l=e.CategoryText.split(".")[0];this.Entities.ContainsKey(l)||this.Entities.push(l,"R"),0==C.J0.stringCompare(e.ParentTable,"COM_CCCCData",!0)&&!this.Entities.ContainsKey(e.ParentTableAlias)&&(this.Entities.push(e.ParentTableAlias,"RTCC"+ ++t),95==e.CategoryValue&&(this.FromTag+=" LEFT JOIN COM_CCCCData "+this.Entities[e.ParentTableAlias]+" with(nolock) ON "+this.Entities[e.ParentTableAlias]+".NodeID="+this.Entities[l]+".ContractID  AND "+this.Entities[e.ParentTableAlias]+".CostCenterID="+e.CategoryValue),l=e.ParentTableAlias),o="X"+ ++t,this.Entities.push(e.CategoryText,o),this.FromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities[l]+"."+e.ParentColumn,D+=","+this.Entities[e.CategoryText]+"."+e.Column+" AS ["+I.ID+"]"}209==this.StaticReportType&&(this.GroupSelectTag+=",max("+I.ID+") ["+I.ID+"]"),214==this.StaticReportType&&(this.SelectTagAliasOnly+=","+I.ID)}else if(214==e.FieldValue){var c="",u=C.J0.IsEmpty(e.DimensionsFilter)?[]:e.DimensionsFilter.split("~");if(u.length>2&&u[1].length>0&&u[2].length>0){var F=u[2].split(",");for(let l=0;l<F.length;l++)if(l>0&&(c+=","),F[l].startsWith("EFPD_"))if(l>0&&"EFPD_CostCenterID"==F[l]&&!this.Entities.values.Contains("C")&&F[l-1].startsWith("COL_")&&"ReportViewModel"==this.ClassName){var L=0;null!=(R=this.BaseReportColumns.find(b=>b.ID==F[l-1].substr(4)))&&((L=R.CDGDO.IsForeignKey?R.CDGDO.ParentCostCenterID:R.CDGDO.CategoryValue)<4e4||L>5e4||(L=0)),c+=L}else c+="C."+F[l].Replace("EFPD_","");else if(F[l].startsWith("EF_"))this.SetExtFunctionParams(F[l],c);else if(F[l].startsWith("COL_")&&"ReportViewModel"==this.ClassName){var R;null!=(R=this.BaseReportColumns.find(P=>P.ID==F[l].substr(4)))&&400!=(L=R.CDGDO.IsForeignKey?R.CDGDO.ParentCostCenterID:R.CDGDO.CategoryValue)&&(L<4e4||L>5e4)&&("NULL"!=R.CDGDO.ActualColumn?(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(w=>w.FeatureID==L),c+=R.CDGDO.ActualTable+"."+this.FieldsDialog.CostCenterTables[0].PK.toString()):c+="NULL")}D+=c.length>0?",dbo."+u[1]+"("+c+") ["+I.ID+"]":",null ["+I.ID+"]"}else D+=",null ["+I.ID+"]";209==this.StaticReportType&&(this.GroupSelectTag+=",max("+I.ID+") ["+I.ID+"]")}else if(11691==I.CDGDO.FieldValue)o="",this.Entities.ContainsKey(e.CategoryText)&&(o=this.Entities[e.CategoryText]),o=92==I.CDGDO.CategoryValue?(C.J0.IsEmpty(o)?"P":o)+".NodeID":93==I.CDGDO.CategoryValue?(C.J0.IsEmpty(o)?"U":o)+".UnitID":94==I.CDGDO.CategoryValue?(C.J0.IsEmpty(o)?"T":o)+".TenantID":(C.J0.IsEmpty(o)?"C":o)+".ContractID",D+=",'Activity' ["+I.ID+"],'"+I.CDGDO.CategoryValue+"~'+convert(nvarchar,"+o+") ["+I.ID+"_ID]";else if(95==e.CategoryValue){if("REN_ContractExtended"==e.Table)o=e.CategoryText+"REN_ContractExtended",this.Entities.ContainsKey(o)||(this.Entities.push(o,"CNTEXT"),n+=" JOIN REN_ContractExtended AS "+this.Entities[o]+" with(nolock) ON C.ContractID=CNTEXT.NodeID"),D+=",CNTEXT."+e.Column+" AS ["+I.ID+"]";else if("REN_ContractParticulars"==e.Table)D+=","+this.Entities.ContractREN_ContractParticulars+"."+e.Column+" AS ["+I.ID+"]";else{let l=new K;l.DocID=-1,l.IsInventory=this.IsInventory,this.SetActualColumn(e,l),D+=","+e.ActualColumn+" AS ["+I.ID+"]"}209==this.StaticReportType&&(this.GroupSelectTag+=",max("+I.ID+") ["+I.ID+"]"),214==this.StaticReportType&&(this.SelectTagAliasOnly+=","+I.ID)}else this.Entities.ContainsKey(e.CategoryText)&&(D+=","+this.Entities[e.CategoryText]+"."+e.Column+" AS ["+I.ID+"]",C.J0.IsEmpty(e.ActualTable)&&(e.ActualTable=this.Entities[e.CategoryText]+"."+e.Column))}if(this.SelectTag+=D.toString(),this.FromTag+=n.toString(),this.IsOrderByGroupFields)for(let S=0;S<this.ReportGroups.length;S++){let I=this.ReportGroups[S];C.J0.IsEmpty(I.Formula.Text)&&(this.OrderByTag.length>0&&(this.OrderByTag+=","),this.OrderByTag+="["+I.ID+"] "+I.Sort.SelectedValue)}}else if(319==this.StaticReportType){let g=new Array;g.AddRange(this.BaseReportColumns);for(let S=0;S<g.length;S++){let I=g[S];if(e=I.CDGDO,33==I.ID.length&&50051==e.CategoryValue){let l=e.CategoryText.split(".")[0];if(this.Entities.ContainsKey(l)||this.Entities.push(l,"C51"),e.IsForeignKey&&(this.Entities.ContainsKey(e.CategoryText)||(o="T"+ ++t,this.Entities.push(e.CategoryText,o),0==C.J0.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||this.Entities.push("CC","CC"),this.FromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):this.FromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities[l]+"."+e.ParentColumn)),!this.Entities.ContainsKey(e.CategoryText))continue;let b=new K;b.DocID=-1,b.IsInventory=this.IsInventory,this.SetActualColumn(e,b),this.SelectTag+=","+e.ActualColumn+" AS ["+I.ID+"]",this.SelectTagAliasOnly+=","+I.ID}}}else if(328==this.StaticReportType){let g=new Array;g.AddRange(this.BaseReportColumns);for(let S=0;S<g.length;S++){let I=g[S];if(e=I.CDGDO,33==I.ID.length)if(50051==e.CategoryValue){let l=e.CategoryText.split(".")[0];if(this.Entities.ContainsKey(l)||this.Entities.push(l,"C51"),e.IsForeignKey&&(this.Entities.ContainsKey(e.CategoryText)||(o="T"+ ++t,this.Entities.push(e.CategoryText,o),0==C.J0.stringCompare(e.ParentTable,"COM_CCCCData",!0)?(this.Entities.ContainsKey("CC")||this.Entities.push("CC","CC"),this.FromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"=CC."+e.ParentColumn):this.FromTag+=" LEFT JOIN "+e.ParentCostCenterSysName+" AS "+this.Entities[e.CategoryText]+" with(nolock) ON "+this.Entities[e.CategoryText]+"."+e.ParentCostCenterColSysName+"="+this.Entities[l]+"."+e.ParentColumn)),!this.Entities.ContainsKey(e.CategoryText))continue;let b=new K;b.DocID=-1,b.IsInventory=this.IsInventory,this.SetActualColumn(e,b),this.SelectTag+=","+e.ActualColumn+" AS ["+I.ID+"]",this.SelectTagAliasOnly+=","+I.ID}else if(409==e.CategoryValue){let l=e.CategoryText.split(".")[0];if(this.Entities.ContainsKey(l)||this.Entities.push(l,"AP"),!this.Entities.ContainsKey(e.CategoryText))continue;let b=new K;b.DocID=-1,b.IsInventory=this.IsInventory,this.SetActualColumn(e,b),this.SelectTag+=","+e.ActualColumn+" AS ["+I.ID+"]",this.SelectTagAliasOnly+=","+I.ID}}}}SetQueryXMLTagsForQueryReports(){if(this.BaseReportColumns.forEach(e=>{"1"==e.ShowLevel.SelectedValue&&null==this.LevelColumn&&(this.LevelColumn=e)}),this.Filter.IsReportViewScreen){let e=this;if(this.FinalQuery=e.ReportQuery,e.Preferences.Filters.length>0){let m,o="",r="",M=new C.VB;M.LoadXml("<XML>"+e.Preferences.Filters+"</XML>");let T=M.DocumentElement.childNodes;for(let D=0;D<T.length;D++){let A=T[D];r="";let n=C.VB.SelectNodes(A,"Filter");for(let h=0;h<n.length;h++){let c=n[h];m=c.attributes.MapField.value;let u=this.Filter.Fields.find(F=>F.ID==m);if(u){if(u.CDGDO.ActualColumn=c.attributes.Column.value,"DATE"==u.CDGDO.DataType){if(!this.DontApplyDateFilter)if(r+=" AND ",r+=u.CDGDO.ActualColumn,"Between"==u.Condition.SelectedValue||"NotBetween"==u.Condition.SelectedValue)r+=u.Condition.SelectedItem.Parent,r+="'"+u.FromDatePicker.Date.ToString("dd MMM yyyy")+"' AND ",r+="'"+u.ToDatePicker.Date.ToString("dd MMM yyyy")+"'";else if("FUTURE"==u.Condition.SelectedValue||"PAST"==u.Condition.SelectedValue){let F;F=C.J0.Int(u.FromValue.TextBox.Text),0==F&&(F=1);let L="";if(L=""!=u.FromValue.ComboBox.SelectedValue?u.FromValue.ComboBox.SelectedValue:"Days",r+=" BETWEEN ","Days"==L)"FUTURE"==u.Condition.SelectedValue?(r+="'"+Date.Today().ToString("dd MMM yyyy")+"' AND ",r+="'"+Date.Today().AddDays(F).ToString("dd MMM yyyy")+"'"):(r+="'"+Date.Today().AddDays(-F).ToString("dd MMM yyyy")+"' AND ",r+="'"+Date.Today().ToString("dd MMM yyyy")+"'");else if("Weeks"==L)(304==e.Report.ReportID||305==e.Report.ReportID)&&N.d.IsMobile&&(r+="'"+Date.Today().ToString("dd MMM yyyy")+"' AND ",r+="'"+Date.Today().AddDays(7).ToString("dd MMM yyyy")+"'");else if("Months"==L)if("FUTURE"==u.Condition.SelectedValue){let R=Date.Today().AddMonths(F);R=new Date(R.getFullYear(),R.getMonth(),1),r+="'"+R.ToString("dd MMM yyyy")+"' AND ",R=R.AddMonths(F).AddDays(-1),r+="'"+R.ToString("dd MMM yyyy")+"'"}else{let R=Date.Today().AddMonths(-F);R=new Date(R.getFullYear(),R.getMonth(),1),r+="'"+R.ToString("dd MMM yyyy")+"' AND ",R=R.AddMonths(F).AddDays(-1),r+="'"+R.ToString("dd MMM yyyy")+"'"}else if("Quarter"==L)if("FUTURE"==u.Condition.SelectedValue){let R=Date.Today().AddMonths(3*F);R=new Date(R.getFullYear(),R.getMonth()-(R.getMonth()-1)%3,1),r+="'"+R.ToString("dd MMM yyyy")+"' AND ",R=R.AddMonths(3*F).AddDays(-1),r+="'"+R.ToString("dd MMM yyyy")+"'"}else{let R=Date.Today().AddMonths(3*-F);R=new Date(R.getFullYear(),R.getMonth()-(R.getMonth()-1)%3,1),r+="'"+R.ToString("dd MMM yyyy")+"' AND ",R=R.AddMonths(3*F).AddDays(-1),r+="'"+R.ToString("dd MMM yyyy")+"'"}else if("Year"==L)if("FUTURE"==u.Condition.SelectedValue){let R=Date.Today().AddYears(F);R=new Date(R.getFullYear(),0,1),r+="'"+R.ToString("dd MMM yyyy")+"' AND ",R=R.AddYears(F-1),R=new Date(R.getFullYear(),11,31),r+="'"+R.ToString("dd MMM yyyy")+"'"}else{let R=Date.Today().AddYears(1-F);R=new Date(R.getFullYear(),0,1),u.FromDatePicker.Date=R,u.ToDatePicker.Date=Date.Today(),r+="'"+R.ToString("dd MMM yyyy")+"' AND ",r+="'"+Date.Today().ToString("dd MMM yyyy")+"'"}}else r+=u.Condition.SelectedItem.Parent,r+="'"+u.FromDatePicker.Date.ToString("dd MMM yyyy")+"'"}else if("Between"==u.Condition.SelectedValue||"NotBetween"==u.Condition.SelectedValue)if(u.FromValue.Visible){if(C.J0.IsEmpty(u.FromValue.TextBox.Text)&&C.J0.IsEmpty(u.ToValue.Text))continue;r+=" AND ",r+=u.CDGDO.ActualColumn,r+=u.Condition.SelectedItem.Parent,r+="'"+u.FromValue.TextBox.Text+"' AND ",r+="'"+u.ToValue.Text+"'"}else{if(C.J0.IsEmpty(u.FromList.Text)&&C.J0.IsEmpty(u.ToList.Text))continue;r+=" AND ",r+=u.CDGDO.ActualColumn,r+=u.Condition.SelectedItem.Parent,r+="'"+u.FromList.Text+"' AND ",r+="'"+u.ToList.Text+"'"}else if("Contains"==u.Condition.SelectedValue||"NotContain"==u.Condition.SelectedValue){if(C.J0.IsEmpty(u.FromValue.TextBox.Text))continue;r+=" AND ",r+=u.CDGDO.ActualColumn,r+=u.Condition.SelectedItem.Parent,r+="'%"+u.FromValue.TextBox.Text+"%'"}else if(u.FromValue.Visible){if(C.J0.IsEmpty(u.FromValue.TextBox.Text))continue;r+=" AND ",r+=u.CDGDO.ActualColumn,"Equal"==u.Condition.SelectedValue&&u.FromValue.TextBox.Text.startsWith("'")&&u.FromValue.TextBox.Text.endsWith("'")?u.FromValue.TextBox.Text.Contains("','")?r+=" IN ("+u.FromValue.TextBox.Text+")":r+=u.Condition.SelectedItem.Parent+u.FromValue.TextBox.Text:(r+=u.Condition.SelectedItem.Parent,r+="'"+u.FromValue.TextBox.Text+"'")}else if(u.FromList.CCID>0){if(0==u.FromList.SelectedValue&&3!=u.FromList.CCID)continue;r+=" AND ",r+=u.CDGDO.ActualColumn,r+=u.Condition.SelectedItem.Parent,r+=u.FromList.SelectedValue}}else if(m.startsWith("CC_")){let F,L=0;m.startsWith("CC_44_")?(F=44,L=C.J0.Int(m.substr(6))):F=C.J0.Int(m.substr(3));let R=null;var t=this.Filter.CostCenterFilters.find(g=>g.CostCenterID==F&&g.LookupTypeID==L);if(null!=c.attributes.PRID&&(R=this.Filter.CostCenterFilters.find(g=>50==g.CostCenterID&&g.LookupTypeID==parseInt(c.attributes.PRID.value))),null==R&&null!=t){if(t.SelectedNodes.length>0||!t.DeleteButtonVisibility)if(o="",k.IsGroupTree(t)&&t.DeleteButtonVisibility){for(let I=0;I<t.SelectedNodes.length;I++)(null==t.SelectedNodes[I].Parent||!t.SelectedNodes[I].Parent.IsSelected)&&(o.length>0&&(o+=","),o+=t.SelectedNodes[I].Id);let g,S;0==o.length&&(o+=-12912),r+=" AND ",r+=c.attributes.Column.value+" IN (",this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(I=>I.FeatureID==t.CostCenterID),g=C.J0.String(this.drrCCTbl[0].PK),S=this.drrCCTbl[0].TableName.toString(),r+="select T."+g+" from "+S+" T with(nolock),"+S+" GT with(nolock) where T.lft between GT.lft and GT.rgt and GT."+g+" IN ("+o.toString()+") group by T."+g,r+=")"}else{if("1"!=N.d.SessionManager.UserID&&"1"!=N.d.SessionManager.RoleID&&92==parseInt(F)){let g=!1;this.Filter.CostCenters.Items.filter(S=>"92"==S.Value).forEach(S=>{"1"==S.Aliasname&&(g=!0)}),1==t.SelectedNodes.length&&!t.SelectedNodes[0].IsSelected&&!g&&(t.SelectedNodes=this.Filter.SelectedNodes)}for(let g=0;g<t.SelectedNodes.length;g++)92==parseInt(F)&&"1"!=N.d.SessionManager.UserID&&"1"!=N.d.SessionManager.RoleID?!t.SelectedNodes[g].IsGroup&&0!=t.SelectedNodes[g].Id&&t.SelectedNodes[g].IsSelected&&(o.length>0&&(o+=","),o+=t.SelectedNodes[g].Id):!t.SelectedNodes[g].IsGroup&&0!=t.SelectedNodes[g].Id&&(o.length>0&&(o+=","),o+=t.SelectedNodes[g].Id);0==o.length&&(o+=-12912),r+=" AND ",r+=c.attributes.Column.value+" IN (",r+=o.toString(),r+=")"}}else if(null!=R){o="";let g=new Array;for(let S=0;S<R.SelectedNodes.length;S++)0!=R.SelectedNodes[S].Id&&!g.Contains(R.SelectedNodes[S].Id)&&(o.length>0&&(o+=","),o+=R.SelectedNodes[S].Id,g.push(R.SelectedNodes[S].Id));!R.DeleteButtonVisibility&&0==o.length&&(o+=-12912),0!=o.length&&(r+=" AND ",r+=c.attributes.Column.value+" IN (",r+=o.toString(),r+=")")}}else"Employee_Filter"==m&&(C.J0.IsEmpty(N.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(N.d.SessionManager.LocationID>0&&N.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&N.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(r+=" AND ",r+=c.attributes.Column.value+" IN (Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and (CCNID2="+N.d.SessionManager.LocationID+(N.d.SessionManager.Preferences.ContainsKey("ShowDefaultEmployee")&&"TRUE"==N.d.SessionManager.Preferences.ShowDefaultEmployee.toUpperCase()?" or NodeID=1":"")+" )) "),r+=" AND ",r+=this.PayrollWidgetEmpID>0?c.attributes.Column.value+" in ("+this.PayrollWidgetEmpID+")":c.attributes.Column.value+" in ("+N.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"))}this.FinalQuery=this.FinalQuery.Replace(A.attributes.Name.value,r.toString())}}if(this.DocumentFilters.ContainsKey("CRM_Cases_DocumentsTab")&&(this.FinalQuery=this.FinalQuery.Replace("@CRM_Cases_DocumentsTab@",this.DocumentFilters.CRM_Cases_DocumentsTab)),this.DocumentFilters.ContainsKey("CRM_CasesRef_DocumentsTab")&&(this.FinalQuery=this.FinalQuery.Replace("@CRM_CasesRef_DocumentsTab@",this.DocumentFilters.CRM_CasesRef_DocumentsTab)),(this.FinalQuery.Contains("@TODATE@")||this.FinalQuery.Contains("@FROMDATE@"))&&(e.SetDatePickers(),this.FinalQuery=this.FinalQuery.Replace("@TODATE@","'"+e.ToDatePicker.Date.ToString("dd MMM yyyy")+"'"),this.FinalQuery=this.FinalQuery.Replace("@FROMDATE@","'"+e.FromDatePicker.Date.ToString("dd MMM yyyy")+"'")),this.FinalQuery.Contains("@USERID@")&&(this.FinalQuery=this.FinalQuery.Replace("@USERID@",N.d.SessionManager.UserID.toString())),this.FinalQuery.Contains("@ROLEID@")&&(this.FinalQuery=this.FinalQuery.Replace("@ROLEID@",N.d.SessionManager.RoleID.toString())),this.FinalQuery.Contains("@USERNAME@")&&(this.FinalQuery=this.FinalQuery.Replace("@USERNAME@",N.d.SessionManager.UserName)),this.FinalQuery.Contains("@LOCATIONID@")&&(this.FinalQuery=this.FinalQuery.Replace("@LOCATIONID@",N.d.SessionManager.LocationID.toString())),this.FinalQuery.Contains("@DIVISIONID@")&&(this.FinalQuery=this.FinalQuery.Replace("@DIVISIONID@",N.d.SessionManager.DivisionID.toString())),this.FinalQuery.Contains("@SEARCHTEXT@")){let m=this.Filter.Fields.find(o=>null==o.CDGDO.DataType||"INT"!=o.CDGDO.DataType.toUpperCase()&&"FLOAT"!=o.CDGDO.DataType.toUpperCase()&&"DATE"!=o.CDGDO.DataType.toUpperCase());this.FinalQuery=this.FinalQuery.Replace("@SEARCHTEXT@",m&&null!=m.FromValue.TextBox.Text?"'"+m.FromValue.TextBox.Text+"'":"''")}if(308==e.Report.ReportID)if(N.d.SessionManager.IsEmpUser||N.d.SessionManager.IsRptManagerUser){let m=C.J0.StringValue(N.d.SessionManager.Preferences.HolidaysBasedOn).split(","),o=" ",r="",M="";if(null!=m&&m.length>0)for(let T=0;T<m.length;T++)null!=m[T]&&""!=m[T]&&(r="dcCCNID"+(parseInt(m[T])-5e4)+" IN (1, ",M="CC.CCNID"+(parseInt(m[T])-5e4));r.length>0&&(o=" DECLARE @WH NVARCHAR(MAX),@sQ nvarchar(max),@temp1 nvarchar(max)\n                        SET @temp1='@WH NVARCHAR(max) output'\n                        SET @sQ='\n                        SELECT @WH=''"+r+"''+CONVERT(NVARCHAR,"+M+")+'')''  FROM COM_CC50051 C51 WITH(NOLOCK)\n                        JOIN COM_CCCCData CC WITH(NOLOCK) ON CC.NODEID=C51.NODEID AND CC.COSTCENTERID=50051\n                        WHERE C51.NODEID="+N.d.SessionManager.iEmployee+"'          \n                        EXEC sp_executesql @sQ,@temp1,@WH output\n                                                        \n",this.FinalQuery=o+this.FinalQuery)}else this.FinalQuery="DECLARE @WH NVARCHAR(MAX)  "+this.FinalQuery}}SetQuery(t,e){let o,m=0;this.IsInventory=e;let M,r="",T=!1,D=!1,A="",n="";r="DCC";for(let h=0;h<t.length;h++){let c=t[h];if(o=c.CDGDO,33==c.ID.length)if(400==o.CategoryValue||o.CategoryValue>4e4&&o.CategoryValue<5e4){if(o.CategoryValue>4e4&&o.CategoryValue<5e4&&("COM_DocTextData"==o.Table?(this.Entities.ContainsKey(o.CategoryText)||this.Entities.push(o.CategoryText,this.Entities.Documents),M=o.CategoryText+"COM_DocTextData",this.Entities.ContainsKey(M)||this.Entities.push(M,"DOCTEXT"),T||(n+=e?" LEFT JOIN COM_DocTextData AS "+this.Entities[M]+" with(nolock) ON "+this.Entities[M]+".InvDocDetailsID="+this.Entities.Documents+".InvDocDetailsID":" LEFT JOIN COM_DocTextData AS "+this.Entities[M]+" with(nolock) ON "+this.Entities[M]+".AccDocDetailsID="+this.Entities.Documents+".AccDocDetailsID"),T=!0,o.ParentCDGDO=new te.ir):("COM_DocNumData"==o.Table||"PAY_DocNumData"==o.Table)&&(this.Entities.ContainsKey(o.CategoryText)||this.Entities.push(o.CategoryText,this.Entities.Documents),M=o.CategoryText+o.Table,this.Entities.ContainsKey(M)||this.Entities.push(M,"DOCNUM"),D||(n+=e?" LEFT JOIN "+o.Table+" AS "+this.Entities[M]+" with(nolock) ON "+this.Entities[M]+".InvDocDetailsID="+this.Entities.Documents+".InvDocDetailsID":" LEFT JOIN "+o.Table+" AS "+this.Entities[M]+" with(nolock) ON "+this.Entities[M]+".AccDocDetailsID="+this.Entities.Documents+".AccDocDetailsID"),D=!0,o.ParentCDGDO=new te.ir)),o.ColumnCostCenterID>0&&o.ParentTableAlias.Contains("_CCMAP"))this.Entities.ContainsKey(o.CategoryText)||(this.Entities.push(o.CategoryText,"T"+m),m++,n+=" LEFT JOIN "+o.ParentCostCenterSysName+" AS "+this.Entities[o.CategoryText]+" with(nolock) ON "+this.Entities[o.CategoryText]+"."+o.ParentCostCenterColSysName+"=DCC."+o.ParentColumn);else if(o.IsForeignKey){this.Entities.ContainsKey(o.CategoryText)||(M="T"+ ++m,this.Entities.push(o.CategoryText,M),0==C.J0.stringCompare(o.ParentTable,"COM_CCCCData",!0)||(n+=" LEFT JOIN "+o.ParentCostCenterSysName+" AS "+this.Entities[o.CategoryText]+" with(nolock) ON "+this.Entities[o.CategoryText]+"."+o.ParentCostCenterColSysName+"="+this.Entities.Documents+"."+o.ParentColumn)),A+=","+this.Entities[o.CategoryText]+"."+o.Column+" AS ["+c.ID+"]";continue}try{let u=new K;u.DocID=-1,u.IsInventory=e,400==o.CategoryValue?this.SetActualColumn(o,u):0==C.J0.stringCompare(o.Formula,"LATEST")||0==C.J0.stringCompare(o.Formula,"OLDEST")?o.ActualColumn=this.GetLatestOldestQuery(o,"D","VENDOR"):(this.Entities.ContainsKey(o.CategoryText)||this.Entities.push(o.CategoryText,this.Entities.Documents),u=new K,u.DocID=o.CategoryValue,u.IsInventory=e,this.SetActualColumn(o,u)),A+=","+o.ActualColumn,A+=" AS ["+c.ID+"]",this.SelectTagAliasOnly+=","+c.ID}catch{}}else if(2==o.CategoryValue){if(!this.Entities.ContainsKey(o.CategoryText))return;let u=new K;u.DocID=-1,this.SetActualColumn(o,u),this.GroupSelectTag+=","+o.ActualColumn+" AS ["+c.ID+"]",this.GroupSelectTagAlias+=","+c.ID}}this.SelectTag=A.toString(),this.FromTag=n.toString()}SetQueryXMLTagsForPreProcessQuery(){let t=0,e="";"ReportViewModel"==this.ClassName&&(this.Report=this,this.Report.SetDatePickers(),this.Report.ProcessdOn.Visible=!1);for(let M=0;M<this.Filter.CostCenterFilters.length;M++){let T=this.Filter.CostCenterFilters[M];if(!T.IsPrePocessFilter)continue;let D,A="";t++;let h,n="GT"+t;if(D="RPT_TBL"+this.Report.ReportID,this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(c=>c.FeatureID==T.CostCenterID),this.FieldsDialog.CostCenterTables.length>0&&(h="T.PPQ"+T.CostCenterID,T.SelectedNodes.length>0||!T.DeleteButtonVisibility)){e.length>0&&(e+=" AND "),e+=h+" IN (";for(let c=0;c<T.SelectedNodes.length;c++)c>0&&(e+=","),e+=T.SelectedNodes[c].Id;0==T.SelectedNodes.length&&(e+=-12912),e+=")"}A.length>0&&(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(c=>c.FeatureID==T.CostCenterID),this.FromTag+="\r\n ,(select T."+this.drrCCTbl[0].PK.toString()+" GTID from "+this.drrCCTbl[0].TableName.toString()+" T with(nolock),"+this.drrCCTbl[0].TableName.toString()+" "+n+" with(nolock) where T.lft BETWEEN "+n+".lft AND "+n+".rgt AND "+n+"."+this.drrCCTbl[0].PK.toString()+" IN ("+A.toString()+") group by T."+this.drrCCTbl[0].PK.toString()+") AS "+n)}let o="",r="";for(let M=0;M<this.Filter.Fields.length;M++){let T=this.Filter.Fields[M];if(o="","DATE"==T.CDGDO.DataType&&this.Filter.IsReportViewScreen&&!this.DontApplyDateFilter){let D="PPQ"+T.ID.Replace("-","");if("Between"==T.Condition.SelectedValue||"NotBetween"==T.Condition.SelectedValue)D+=T.Condition.SelectedItem.Parent,D+="'"+T.FromDatePicker.Date.ToString("dd MMM yyyy")+"' AND ",D+="'"+T.ToDatePicker.Date.ToString("dd MMM yyyy")+"'";else if("FUTURE"==T.Condition.SelectedValue||"PAST"==T.Condition.SelectedValue){T.ToDatePicker.Mode=1,T.FromDatePicker.Mode=1;let n=C.J0.Int(T.FromValue.TextBox.Text);0==n&&(n=1);let h="";if(h=""!=T.FromValue.ComboBox.SelectedValue?T.FromValue.ComboBox.SelectedValue:"Days","Days"==h)"FUTURE"==T.Condition.SelectedValue?(T.FromDatePicker.Date=Date.Today(),T.ToDatePicker.Date=Date.Today().AddDays(n)):(T.FromDatePicker.Date=Date.Today().AddDays(-n),T.ToDatePicker.Date=Date.Today());else if("Weeks"==h){Date.Today().getDay();let F,u=new Date;u=Date.Today().AddDays(-0),"FUTURE"==T.Condition.SelectedValue?(u=u.AddDays(7*n),F=u.AddDays(7*n-1)):(u=u.AddDays(-7*n),F=u.AddDays(7*n-1)),T.FromDatePicker.Date=u,T.ToDatePicker.Date=F}else if("Months"==h)if("FUTURE"==T.Condition.SelectedValue){let c=Date.Today().AddMonths(n);c=new Date(c.getFullYear(),c.getMonth(),1),T.FromDatePicker.Date=c,c=c.AddMonths(n).AddDays(-1),T.ToDatePicker.Date=c}else{let c=Date.Today().AddMonths(-n);c=new Date(c.getFullYear(),c.getMonth(),1),T.FromDatePicker.Date=c,c=c.AddMonths(n).AddDays(-1),T.ToDatePicker.Date=c}else if("Quarter"==h)if("FUTURE"==T.Condition.SelectedValue){let c=Date.Today().AddMonths(3*n);c=new Date(c.getFullYear(),c.iMonth()-(c.iMonth()-1)%3-1,1),T.FromDatePicker.Date=c,c=c.AddMonths(3*n).AddDays(-1),T.ToDatePicker.Date=c}else{let c=Date.Today().AddMonths(3*-n);c=new Date(c.getFullYear(),c.iMonth()-(c.iMonth()-1)%3-1,1),T.FromDatePicker.Date=c,c=c.AddMonths(3*n).AddDays(-1),T.ToDatePicker.Date=c}else if("Year"==h)if("FUTURE"==T.Condition.SelectedValue){let c=Date.Today().AddYears(n);c=new Date(c.getFullYear(),0,1),T.FromDatePicker.Date=c,c=c.AddYears(n-1),c=new Date(c.getFullYear(),11,31),T.ToDatePicker.Date=c}else{let c=Date.Today().AddYears(1-n);c=new Date(c.getFullYear(),0,1),T.FromDatePicker.Date=c,T.ToDatePicker.Date=Date.Today()}D+=" BETWEEN ",D+="'"+T.FromDatePicker.Date.ToString("dd MMM yyyy")+"' AND ",D+="'"+T.ToDatePicker.Date.ToString("dd MMM yyyy")+"'"}else"IsNull"==T.Condition.SelectedValue||"IsNotNull"==T.Condition.SelectedValue?D+=T.Condition.SelectedItem.Parent:(D+=T.Condition.SelectedItem.Parent,D+="'"+T.FromDatePicker.Date.ToString("dd MMM yyyy")+"'");let A="";if("Between"==T.Condition.SelectedValue||"FUTURE"==T.Condition.SelectedValue||"PAST"==T.Condition.SelectedValue){let n=new Date(T.ToDatePicker.Date.getFullYear(),N.d.SessionManager.AccountingFromMonth-1,1);n>T.ToDatePicker.Date&&(n=n.AddYears(-1));let h="PPQ"+T.ID.Replace("-","");if(this.RepeatShowPrevMn){let c=n.AddYears(-1);for(let u=1;u<=this.RepeatPrevData;u++){if(A+=" OR ("+h+" BETWEEN ",this.RepeatPrevDataFull)A+="'"+c.ToString("dd MMM yyyy")+"' AND ",A+="'"+c.AddYears(1).AddDays(-1).ToString("dd MMM yyyy")+"'",c=c.AddYears(-1);else if(this.RepeatPrevDataOfCurrYr&&this.RepeatType==z.b2.Monthly){let F=new Date(T.FromDatePicker.Date.getFullYear(),T.FromDatePicker.Date.getMonth(),1);F=F.AddMonths(-u),A+="'"+F.ToString("dd MMM yyyy")+"' AND ",A+="'"+F.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"'"}else A+="'"+T.FromDatePicker.Date.AddYears(-u).ToString("dd MMM yyyy")+"' AND ",A+="'"+T.ToDatePicker.Date.AddYears(-u).ToString("dd MMM yyyy")+"'";A+=")"}this.RepeatEmptyColumns=1}this.BaseReportColumns.find(c=>!C.J0.IsEmpty(c.Formula.Text)&&c.Formula.Text.Contains("PRV_YEARSTART"))||this.ReportGroups.find(c=>!C.J0.IsEmpty(c.Formula.Text)&&c.Formula.Text.Contains("PRV_YEARSTART"))?(this.PrevDateColumsUsed=!0,A+=" OR ("+h+" BETWEEN ",A+="'"+n.AddYears(-1).ToString("dd MMM yyyy")+"' AND ",A+="'"+n.AddDays(-1).ToString("dd MMM yyyy")+"'",A+=")"):this.BaseReportColumns.find(c=>!C.J0.IsEmpty(c.Formula.Text)&&c.Formula.Text.Contains("PRV_YEARFROMDATE"))||this.ReportGroups.find(c=>!C.J0.IsEmpty(c.Formula.Text)&&c.Formula.Text.Contains("PRV_YEARFROMDATE"))||this.BaseReportColumns.find(c=>!C.J0.IsEmpty(c.Formula.Text)&&c.Formula.Text.Contains("PRV_YEARTODATE"))||this.ReportGroups.find(c=>!C.J0.IsEmpty(c.Formula.Text)&&c.Formula.Text.Contains("PRV_YEARTODATE"))?(this.PrevDateColumsUsed=!0,A+=" OR ("+h+" BETWEEN ",A+="'"+T.FromDatePicker.Date.AddYears(-1).ToString("dd MMM yyyy")+"' AND ",A+="'"+T.ToDatePicker.Date.AddYears(-1).ToString("dd MMM yyyy")+"'",A+=")"):(null!=this.BaseReportColumns.find(c=>!C.J0.IsEmpty(c.Formula.Text)&&c.Formula.Text.Contains("PRV_MONTHFROMDATE"))||null!=this.ReportGroups.find(c=>!C.J0.IsEmpty(c.Formula.Text)&&c.Formula.Text.Contains("PRV_MONTHFROMDATE"))||null!=this.BaseReportColumns.find(c=>!C.J0.IsEmpty(c.Formula.Text)&&c.Formula.Text.Contains("PRV_MONTHTODATE"))||null!=this.ReportGroups.find(c=>!C.J0.IsEmpty(c.Formula.Text)&&c.Formula.Text.Contains("PRV_MONTHTODATE")))&&(this.PrevDateColumsUsed=!0,A+=" OR ("+h+" BETWEEN ",A+="'"+T.FromDatePicker.Date.AddMonths(-1).ToString("dd MMM yyyy")+"' AND ",A+="'"+T.ToDatePicker.Date.AddMonths(-1).ToString("dd MMM yyyy")+"'",A+=")")}A.length>0?(o+="(("+D+")",o+=A.toString(),o+=")"):o+=D}o.length>0&&(T.QuickSearchField.IsChecked?(r.length>0&&(r+=" OR "),r+=o):(e.length>0&&(e+=" AND "),e+=o))}this.FinalQuery="select * from PACT2C"+N.d.SessionManager.CompanyIndex+"_TEMP.dbo.RPT_TBL"+this.Report.ReportID+" T with(nolock)",e.length>0&&(this.FinalQuery+=" where "+e.toString()),null!=this.Report&&N.d.report.ReportDataSetAsync("RPT022",this.Report.IsReportDB,"select convert(datetime,ProcessedOn) ProcessedOn from adm_revenureports with(nolock) where ReportID="+this.Report.ReportID).then(M=>{let T=M.Tables[0];T.length>0&&(this.Report.ProcessdOn.Label="[Processed On "+C.J0.ParseDate(T[0].ProcessedOn).ToString(N.d.SessionManager.Preferences["Date Format"]+" hh:mm a")+"]",this.Report.ProcessdOn.Visible=!0)})}ApplyParentReportFilters(){if(null!=this.oReportDialog&&null!=this.oReportDialog.ParentReportDateFilter)this.oReportDialog.FromDate=this.oReportDialog.ParentReportDateFilter.FromDatePicker,this.oReportDialog.ToDate=this.oReportDialog.ParentReportDateFilter.ToDatePicker;else if(null!=this.ParentReport&&null!=this.ParentReport.oReportDialog){var t=this.Filter.Fields.find(m=>m.Temp&&"STATIC DATE FILTER"==C.J0.String(m.Temp));if(t){if(this.ParentReport.oReportDialog.FromDate.Visible)t.FromDatePicker=this.ParentReport.oReportDialog.FromDate;else{if("MMM-yyyy"==this.ParentReport.oReportDialog.ToDate.CustomFormat)return t.FromDatePicker.Date=new Date(this.ParentReport.oReportDialog.ToDate.Date.getFullYear(),this.ParentReport.oReportDialog.ToDate.Date.getMonth(),1),void(t.ToDatePicker.Date=t.FromDatePicker.Date.AddMonths(1).AddDays(-1));t.FromDatePicker=this.ParentReport.oReportDialog.ToDate,t.Condition.SelectedValue="LessthanOrEqual",t.Condition.SetSelectedItem("LessthanOrEqual")}this.ParentReport.oReportDialog.ToDate.Visible&&(t.ToDatePicker=this.ParentReport.oReportDialog.ToDate)}}for(let m=0;m<this.Filter.CostCenterFilters.length;m++){let o=this.Filter.CostCenterFilters[m];if(o.ParentReportFilterCostCenterID>0){var e=this.ParentReport.Filter.CostCenterFilters.find(r=>r.CostCenterID==o.ParentReportFilterCostCenterID);!e&&null!=this.ParentReport.oReportDialog&&(e=this.ParentReport.oReportDialog.CostCenterFilters.find(r=>r.CostCenterID==o.ParentReportFilterCostCenterID)),e&&(o.SelectedNodes=e.SelectedNodes,null!=this.oReportDialog&&this.oReportDialog.TreeCCID==o.CostCenterID&&(this.oReportDialog.DefaultTreeSelectedNodes=o.SelectedNodes))}}}SetActualColumn(t,e,m=null){let o=!1,r=t.Column,M=t.CategoryText;if(null!=t.ParentCDGDO&&(M+=t.Table),"Shipping_Address"==t.Table||"Billing_Address"==t.Table){let D="Shipping_Address"==t.Table?"3":"2";return void(C.J0.IsEmptySpace(t.ParentTableAlias)?(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(A=>A.FeatureID==t.CategoryValue),t.ActualColumn="(select "+this.GetAddressColumn(t.Column.substr(5))+" from COM_ADDRESS A with(nolock) where A.AddressID=(select TOP 1 AD.AddressID from COM_ADDRESS AD with(nolock) "+(400==t.CategoryValue||t.CategoryValue>=40001&&t.CategoryValue<=49999?"LEFT JOIN COM_DocAddressData DAD WITH(NOLOCK) ON DAD.AddressID=AD.AddressID AND DAD.DocID="+this.Entities[t.CategoryText]+".DocID":"")+" where AD.AddressTypeID="+D+" and AD.FeatureID="+t.CategoryValue+" AND "+this.Entities[t.CategoryText]+"."+this.drrCCTbl[0].PK+"=AD.FeaturePK  ORDER BY "+(400==t.CategoryValue||t.CategoryValue>=40001&&t.CategoryValue<=49999?"DAD.AddressID DESC,":"")+"AD.AddressID))"):t.ActualColumn="(select "+this.GetAddressColumn(t.Column.substr(5))+" from COM_ADDRESS A with(nolock) where A.AddressID=(select TOP 1 AD.AddressID from COM_ADDRESS AD with(nolock) "+(400==t.CategoryValue||t.CategoryValue>=40001&&t.CategoryValue<=49999?"JOIN COM_DocAddressData DAD WITH(NOLOCK) ON DAD.AddressID=AD.AddressID AND DAD.DocID="+this.Entities[t.ParentTableAlias]+".DocID":"")+" where AD.AddressTypeID="+D+" and AD.FeatureID="+t.ParentCostCenterID+" ORDER BY "+(400==t.CategoryValue||t.CategoryValue>=40001&&t.CategoryValue<=49999?"DAD.AddressID DESC,":"")+"AD.AddressID))")}if("Permanent_Address"==t.Table||"Contact_Address"==t.Table){let D="Permanent_Address"==t.Table?"5":"6";return void(C.J0.IsEmptySpace(t.ParentTableAlias)?(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(A=>A.FeatureID==t.CategoryValue),t.ActualColumn="(select "+this.GetAddressColumn(t.Column.substr(5))+" from COM_ADDRESS A with(nolock) where A.AddressID=(select min(AddressID) from COM_ADDRESS with(nolock) where AddressTypeID="+D+" and FeatureID="+t.CategoryValue+" AND "+this.Entities[t.CategoryText]+"."+this.drrCCTbl[0].PK+"=FeaturePK))"):t.ActualColumn="(select "+this.GetAddressColumn(t.Column.substr(5))+" from COM_ADDRESS A with(nolock) where A.AddressID=(select min(AddressID) from COM_ADDRESS with(nolock) where AddressTypeID="+D+" and FeatureID="+t.ParentCostCenterID+" AND "+this.Entities[t.ParentTableAlias]+"."+t.ParentColumn+"=FeaturePK))")}(64==t.ParentCCDefaultColID||65==t.ParentCCDefaultColID)&&(M+="_MAXMIN");let T=!1;if(Math.abs(t.CategoryValue)>4e4&&Math.abs(t.CategoryValue)<5e4)if(t.CategoryValue>0)t.CategoryValue!=Math.abs(e.DocID)&&(T=!0);else if(t.CategoryValue!=e.ParentDocID)T=!0;else if(t.CategoryValue!=e.DocID&&(t.Column.startsWith("dcNum")||t.Column.startsWith("dcCalcNum")||t.Column.startsWith("dcAlpha")))if(C.J0.IsEmpty(e.dvCommonTable)||(e.dvCommon=e.dvCommonTable.filter(D=>D.CostCenterID==e.DocID&&D.CostCenterColID==t.FieldValue)),!C.J0.IsEmpty(e.dvCommonTable)&&e.dvCommon.length>0){let D;r=e.dvCommon[0].SysColumnName.toString(),D&&(!C.J0.IsEmpty(t.ALLOtherDocuments)&&t.ALLOtherDocuments.Contains((-e.DocID).toString())?!t.Column.startsWith("dcAlpha")&&t.ALLOtherDocuments.Contains(-e.DocID+"~1")&&(o=!0):(r="",T=!0))}else T=!0;if(T||400!=t.CategoryValue)if(!T&&C.J0.StringValue(t.Column).startsWith("dcAlpha")&&(402==t.CategoryValue||Math.abs(t.CategoryValue)>4e4&&Math.abs(t.CategoryValue)<5e4)){if(0!=t.ColumnCostCenterID&&44!=t.ColumnCostCenterID){let D,A,n;if(t.ActualTable=this.Entities[M],C.J0.IsEmpty(t.ParentCostCenterSysName)){let h=N.d.report.GetTableColumns(t.ColumnCostCenterID);D=h.TableName,A=h.PrimaryKey,n=h.ColumnName}else D=t.ParentCostCenterSysName,A=t.ParentCostCenterColSysName,n=t.ParentColumn;return void(t.ActualColumn="(select "+n+" from "+D+" with(nolock) where "+A+"="+this.Entities[M]+"."+t.Column+")")}if(44==t.ColumnCostCenterID)return void(t.ActualColumn="(select TOP 1 Name from COM_Lookup L with(nolock) where convert(nvarchar(20),L.NodeID)="+this.Entities[M]+"."+t.Column+")");if(null!=m&&"5"==m.LinkType.SelectedValue)return this.sbQuery+="(select [GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+(this.IsInventory?"INV":"ACC")+".CostCenterID AND FeaturePK="+(this.IsInventory?"INV":"ACC")+".DocID and (IsDefaultImage=100 or (IsDefaultImage=0 and "+(this.IsInventory?"INV":"ACC")+".DocSeqNo =RowSeqNo)) and ColName='"+t.Column+"')"+m.ID+"_ID,",void(t.ActualColumn="(select ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+(this.IsInventory?"INV":"ACC")+".CostCenterID AND FeaturePK="+(this.IsInventory?"INV":"ACC")+".DocID and (IsDefaultImage=100 or (IsDefaultImage=0 and "+(this.IsInventory?"INV":"ACC")+".DocSeqNo =RowSeqNo)) and ColName='"+t.Column+"')")}else{if(!T&&null!=m&&"5"==m.LinkType.SelectedValue&&t.Column.Contains("Alpha")&&(Math.abs(t.CategoryValue)<4e4||Math.abs(t.CategoryValue)>5e4))return this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(D=>D.FeatureID==t.CategoryValue),this.sbQuery+="(select [GUID]+'.'+FileExtension from COM_Files WITH(NOLOCK) WHERE FeatureID="+t.CategoryValue+" AND FeaturePK="+this.Entities[t.CategoryText.split(".")[0]]+"."+this.drrCCTbl[0].PK.toString()+" and IsDefaultImage=100 and ColName='"+t.Column+"')"+m.ID+"_ID,",void(t.ActualColumn="(select ActualFileName from COM_Files WITH(NOLOCK) WHERE FeatureID="+t.CategoryValue+" AND FeaturePK="+this.Entities[t.CategoryText.split(".")[0]]+"."+this.drrCCTbl[0].PK.toString()+" and IsDefaultImage=100 and ColName='"+t.Column+"')");if(144==t.CategoryValue&&(t.Column.startsWith("Alpha")||null!=t.ParentColumn&&t.ParentColumn.startsWith("CCNID"))){if(0==t.LocalReference){let A=N.d.report.GetDataTable("RPT036",t.FieldValue.toString());A.length>0&&A[0].LocalReference&&(t.LocalReference=parseInt(A[0].LocalReference))}let D=this.GetKeyWordColumn(t,e);return t.ActualTable=this.Entities[M],t.ActualColumn=null!=t.ParentColumn&&t.ParentColumn.startsWith("CCNID")?0==t.LocalReference?"(CASE WHEN "+this.Entities[t.ParentTableAlias]+"."+t.ParentColumn+"> 0  THEN ":"(CASE WHEN "+this.Entities[t.ParentTableAlias]+".CostCenterID="+t.LocalReference+" THEN ":"(CASE WHEN "+t.ActualTable+".CostCenterID="+t.LocalReference+" THEN ",C.J0.IsEmpty(D)?t.ActualColumn+="DATE"==t.DataType?"CONVERT(DATETIME,"+this.Entities[M]+"."+r+")":this.Entities[M]+"."+r:t.ActualColumn+="("+D+")",void(t.ActualColumn+=" ELSE NULL END)")}if(144==t.CategoryValue&&65==t.ParentCostCenterID||144==t.ParentCostCenterID&&null!=t.ChildCDGDO&&65==t.ChildCDGDO.ParentCostCenterID)return void(t.ActualColumn=144==t.ParentCostCenterID&&null!=t.ChildCDGDO&&65==t.ChildCDGDO.ParentCostCenterID?"(CASE WHEN "+this.Entities[t.CategoryText]+".contactid is null then null else (select "+t.ChildCDGDO.Column+" from com_contacts with(nolock) where contactid="+this.Entities[t.CategoryText]+".contactid) END)":"(CASE WHEN "+this.Entities[t.ParentTableAlias]+".contactid is null then null else (select "+t.Column+" from com_contacts with(nolock) where contactid="+this.Entities[t.ParentTableAlias]+".contactid) END)");if(144==t.CategoryValue&&(27295==t.FieldValue||27296==t.FieldValue))return void(27295==t.FieldValue?t.ActualColumn="(CASE WHEN ("+this.Entities[M]+".InviteRefActID=0 OR "+this.Entities[M]+".InviteRefActID IS NULL) then "+this.Entities[M]+".CreatedBy    END)":27296==t.FieldValue&&(t.ActualColumn="U.UserName"));if(C.J0.StringValue(t.Column).startsWith("dcPOSRemarks"))return void(t.ActualColumn="STUFF((SELECT ', '+C.Symbol+' '+convert(nvarchar,P.AmountFC)+' @ '+convert(nvarchar,P.ExchangeRate) \nFROM COM_PosPayModes P with(nolock) \nleft join COM_Currency C with(nolock) on C.CurrencyID=P.Currency\nwhere P.DocID=INV.DocID and P.DBColumnName='"+t.Column.Replace("POSRemarks","")+"' FOR XML PATH('')),1,1,'')")}else this.IsInventory&&this.AccDocumentFields.Contains(t.FieldValue)?(!this.ShowOnlyAccountingData||!e.ShowAccountingData)&&(T=!0):(!this.IsInventory&&this.InvDocumentFields.Contains(t.FieldValue)||207==t.FieldValue&&!e.ShowAccountingData)&&(T=!0);if(t.ActualTable="",T)t.ActualColumn="NULL";else if(null!=t.ChildCDGDO)r=t.ChildCDGDO.Column,M=t.ChildCDGDO.CategoryText,t.ChildCDGDO.ActualColumn=this.GetKeyWordColumn(t.ChildCDGDO,e),0==t.ChildCDGDO.ActualColumn.length&&this.Entities.ContainsKey(M)&&(t.ActualTable=this.Entities[M],t.ChildCDGDO.ActualColumn="DATE"==t.ChildCDGDO.DataType?"CONVERT(DATETIME,"+this.Entities[M]+"."+r+")":this.Entities[M]+"."+r),t.ActualColumn=t.ChildCDGDO.ActualColumn;else if(t.ActualColumn=this.GetKeyWordColumn(t,e),t.ColumnCostCenterID>5e4&&t.ColumnCostCenterID<59999&&"H"==t.Formula){let D="NodeID";2==t.CategoryValue&&(D="AccountID"),3==t.CategoryValue&&(D="ProductID"),72==t.CategoryValue?D="AssetID":73==t.CategoryValue?D="CaseID":83==t.CategoryValue?D="CustomerID":86==t.CategoryValue?D="LeadID":88==t.CategoryValue?D="CampaignID":89==t.CategoryValue?D="OpportunityID":93==t.CategoryValue?D="UnitID":94==t.CategoryValue?D="TenantID":(95==t.CategoryValue||104==t.CategoryValue)&&(D="ContractID"),t.ActualTable=this.Entities[M],t.ActualColumn="CASE WHEN (SELECT COUNT(NodeID) FROM COM_HistoryDetails H WITH(NOLOCK) WHERE H.CostCenterID="+t.CategoryValue+" AND HistoryCCID="+t.ColumnCostCenterID+" AND H.NodeID="+this.Entities.values[0]+"."+D+")>0 THEN \n                       STUFF((SELECT ','+"+t.ActualTable+"."+t.Column+"+'~'+CONVERT(varchar(11),CONVERT(DATETIME,H.FromDate),103)+'-'+CONVERT(varchar(11),CONVERT(DATETIME,ISNULL(H.ToDate,'')),103) FROM COM_HistoryDetails H WITH(NOLOCK) JOIN "+t.Table+" "+t.ActualTable+" WITH(NOLOCK) ON H.HistoryNodeID="+t.ActualTable+".NodeID AND H.CostCenterID="+t.CategoryValue+" AND HistoryCCID="+t.ColumnCostCenterID+" WHERE H.NodeID="+this.Entities.values[0]+"."+D+" ORDER BY H.HistoryID DESC FOR XML PATH('')),1,1,'') ELSE "+t.ActualTable+"."+r+" END"}else 0==t.ActualColumn.length&&this.Entities.ContainsKey(M)&&(t.ActualTable=this.IsInventory&&this.ShowOnlyAccountingData&&e.ShowAccountingData&&this.AccDocumentFields.Contains(t.FieldValue)?"ACC":this.Entities[M],"DATE"==t.DataType?t.ActualColumn=r.startsWith("dcAlpha")?"case when isdate("+t.ActualTable+"."+r+")=1 and isNumeric("+t.ActualTable+"."+r+")=0 then CONVERT(DATETIME,"+t.ActualTable+"."+r+") else null end":95==t.CategoryValue&&25784==t.FieldValue?"case when "+t.ActualTable+".FitmentDate is not null THEN CONVERT(DATETIME,"+t.ActualTable+".FitmentDate) ELSE CONVERT(DATETIME,"+t.ActualTable+"."+r+") END":95==t.CategoryValue&&25785==t.FieldValue?"case when "+t.ActualTable+".ExpectedEndDate is not null and "+t.ActualTable+".graceperiod is not null and "+t.ActualTable+".graceperiod>0 THEN convert(Datetime,"+t.ActualTable+".ExpectedEndDate) ELSE convert(Datetime,"+t.ActualTable+"."+r+") END":"CONVERT(DATETIME,"+t.ActualTable+"."+r+")":this.ShowDebitCreditAmount&&e.ShowAccountingData&&206==t.FieldValue&&e.IsDebit||this.ShowDebitCreditAmount&&e.ShowAccountingData&&205==t.FieldValue&&!e.IsDebit?t.ActualColumn="NULL":this.ShowDebitCreditAmount&&e.ShowAccountingData&&23825==t.FieldValue?t.ActualColumn=e.IsDebit?t.ActualTable+"."+r:"-"+t.ActualTable+"."+r:t.CategoryValue>=405&&t.CategoryValue<=408?e.IsInventory?405==t.CategoryValue?t.ActualColumn=r.startsWith("xEarningType")?"(select Name from "+t.ActualTable+".Remarks.nodes('/XML/Component[@ComponentID=''"+r.Replace("xEarningType","")+"'']') as Data(X) join com_lookup L with(nolock) on X.value('EarDedType[1]','nvarchar(max)')=L.NodeID)":"case when INV.VoucherType=11 then "+t.ActualTable+"."+r+" else null end":406==t.CategoryValue?t.ActualColumn=r.startsWith("xDeductionType")?"(select Name from "+t.ActualTable+".Remarks.nodes('/XML/Component[@ComponentID=''"+r.Replace("xDeductionType","")+"'']') as Data(X) join com_lookup L with(nolock) on X.value('EarDedType[1]','nvarchar(max)')=L.NodeID)":"case when INV.VoucherType=12 then "+t.ActualTable+"."+r+" else null end":407==t.CategoryValue?t.ActualColumn="case when INV.VoucherType=13 then "+t.ActualTable+"."+r+" else null end":408==t.CategoryValue&&(t.ActualColumn="case when INV.VoucherType=14 then "+t.ActualTable+"."+r+" else null end"):t.ActualColumn="NULL":2==t.ParentCostCenterID&&("CreditLimit"==r||"DebitLimit"==r||"CreditDays"==r||"DebitDays"==r)&&this.Entities.values.Contains("TDCC")&&N.d.SessionManager.Preferences.DimWiseCreditDebit.length>0&&parseInt(N.d.SessionManager.Preferences.DimWiseCreditDebit)>5e4?t.ActualColumn="isnull((select "+r.Replace("Limit","Amount")+" from Acc_CreditDebitAmount with(nolock) where AccountID="+t.ActualTable+".AccountID and DimensionID=TDCC.dcCCNID"+(parseInt(N.d.SessionManager.Preferences.DimWiseCreditDebit)-5e4)+"),"+t.ActualTable+"."+r+")":166==t.CategoryValue&&"PolicyType"==r?t.ActualColumn="case "+t.ActualTable+"."+r+" when 1 then 'Dispose Full' when 2 then 'Sale Partial' when 3 then 'Sale Full' else 'Dispose Partial' end":this.StaticReportType>0&&113==t.ParentCostCenterID&&"Status"==t.Column&&this.Report.Preferences.ContainsKey("ReplaceStatus")?t.ActualColumn="case when "+t.ActualTable+".StatusID=429 then case when "+this.Entities.Documents+".BillDate=1 then 'Replace' when "+this.Entities.Documents+".BillDate=2 then 'Partial Replace' else 'Bounced' end else "+t.ActualTable+"."+r+" end":40054==t.CategoryValue&&r.toUpperCase().startsWith("DCALPHA")?(t.ActualColumn="case when INV.VoucherType=11 then "+t.ActualTable+"."+r+" else null end",o&&(t.ActualColumn="-"+t.ActualColumn),this.Filter.Fields.forEach(D=>{D.CDGDO.Column.toUpperCase()==r.toUpperCase()&&(t.ActualColumn=t.ActualTable+"."+r,o&&(t.ActualColumn="-"+t.ActualColumn))})):(t.ActualColumn=C.J0.IntTryParse(N.d.SessionManager.LangID)>1&&this.StaticReportType>0&&113==t.ParentCostCenterID?"LR"+t.ActualTable+".ResourceData":3==t.ColumnCostCenterID&&t.Table.toLowerCase().Contains("extended")&&t.Column.toLowerCase().Contains("alpha")&&t.CategoryValue<400?this.Entities[t.CategoryText+"INV_Product"]+".ProductName":t.ActualTable+"."+r,o&&(t.ActualColumn="-"+t.ActualColumn)))}SetActualColumn_1(t){let e=t.CategoryText;if(null!=t.ParentCDGDO&&(e+=t.Table),t.ActualTable=this.Entities[e],t.CategoryValue>=40001&&t.CategoryValue<5e4){if(t.ActualColumn="CASE WHEN ",t.IsForeignKey){if(C.J0.IsEmpty(this.Entities[t.ParentTableAlias.Replace("_CCMAP","")]))return;t.ActualColumn+=this.Entities[t.ParentTableAlias.Replace("_CCMAP","")]}else t.ActualColumn+=this.Entities[t.CategoryText];if(t.ActualColumn+=".CostCenterID="+t.CategoryValue,"DATE"==t.DataType&&t.Column.startsWith("dcAlpha")&&(t.ActualColumn+=" and isdate("+this.Entities[e]+"."+t.Column+")=1"),t.ActualColumn+=" THEN ","DATE"==t.DataType)t.ActualColumn+="CONVERT(DATETIME,"+this.Entities[e]+"."+t.Column+")";else if(t.Column.startsWith("dcAlpha"))if(0!=t.ColumnCostCenterID&&44!=t.ColumnCostCenterID){let m,o,r;if(t.ActualTable=this.Entities[e],C.J0.IsEmpty(t.ParentCostCenterSysName)){let M=N.d.report.GetTableColumns(t.ColumnCostCenterID);m=M.TableName,o=M.PrimaryKey,r=M.ColumnName}else m=t.ParentCostCenterSysName,o=t.ParentCostCenterColSysName,r=t.ParentColumn;t.ActualColumn+="(select "+r+" from "+m+" with(nolock) where "+o+"="+this.Entities[e]+"."+t.Column+")"}else t.ActualColumn+=44==t.ColumnCostCenterID?"(select TOP 1 Name from COM_Lookup L with(nolock) where convert(nvarchar(20),L.NodeID)="+this.Entities[e]+"."+t.Column+")":this.Entities[e]+"."+t.Column;else t.ActualColumn+=this.Entities[e]+"."+t.Column;t.ActualColumn+=" ELSE NULL END"}else t.ActualColumn="DATE"==t.DataType?"CONVERT(DATETIME,"+this.Entities[e]+"."+t.Column+")":this.Entities[e]+"."+t.Column}GetKeyWordColumn(t,e){let m="ACC";if(e.IsInventory&&(m="INV"),!this.Entities.values.Contains(m)&&this.Entities.ContainsKey("Documents")&&(m=this.Entities.Documents),e.IsInventory)if(11361==t.FieldValue||11415==t.FieldValue||27266==t.FieldValue||182==t.FieldValue){if(0==this.StaticReportType&&!C.J0.IsEmpty(t.ALLOtherDocuments)&&!t.ALLOtherDocuments.Contains(e.AbsDocID.toString()))return"null";let n=t.ExecutedDocument,h="",c=null,u=null,F=!1,L=!1;if("ReportViewModel"==this.ClassName){let R=this;null!=R.ToDatePicker&&(R.ToDatePicker.Visible||R.FromDatePicker.Dependantinuse)&&(c=R.ToDatePicker.Date),null!=R.FromDatePicker&&(R.FromDatePicker.Visible||R.FromDatePicker.Dependantinuse)&&(u=R.FromDatePicker.Date),R.Preferences.ContainsKey("ExeQty_ConsiderDocDate")?h=null!=c&&c?",null,'"+c.ToString("dd MMM yyyy")+"'":",null,null":"FOR_PERIOD"==t.Formula?(h=null!=u&&u?",'"+u.ToString("dd MMM yyyy")+"'":",null",h+=null!=c&&c?",'"+c.ToString("dd MMM yyyy")+"'":",null"):"AFTER_PERIOD"==t.Formula?null!=c&&c?(u=c.AddDays(1),c=null,h=",'"+u.ToString("dd MMM yyyy")+"',null"):(u=null,h=",null,null"):h=",null,null",R.Preferences.ContainsKey("ExeQty_DontShowUnApproved")?(F=!0,h+=",1"):(F=!1,h+=",0"),R.Preferences.ContainsKey("ExeQty_ConsiderRejected")?(L=!0,h+=",1"):(L=!1,h+=",0"),!C.J0.IsEmptySpace(t.ExecutedDocument)&&n.Contains(",")&&(n="",k.dtExDocs.ContainsKey(Math.abs(e.DocID))||k.dtExDocs.push(Math.abs(e.DocID),N.d.report.GetReportDetails(4,Math.abs(e.DocID)).Tables[0]),k.dtExDocs[Math.abs(e.DocID)].forEach(g=>{t.ExecutedDocument.Contains(g.CostCenterID.toString())&&(n.length>0&&(n+=","),n+=g.CostCenterID.toString())}),0==n.length&&(n="-123"))}if(11361==t.FieldValue){if(this.IsNewFromClause&&this.Filter.IsReportViewScreen&&this.Report.Preferences.ContainsKey("ExeQty_TblFunCall")&&(h+=null!=u&&u?",'"+u.ToString("dd MMM yyyy")+"'":",null",h+=null!=c&&c?",'"+c.ToString("dd MMM yyyy")+"'":",null"),C.J0.IsEmptySpace(n)){let R="";return Math.abs(e.DocID)>4e4&&Math.abs(e.DocID)<5e4&&e.IsInventory&&(R=N.d.report.GetExecutedQtyQuery(0,Math.abs(e.DocID).toString(),u,c,F,L),R.Contains("NUM.")&&0==this.StaticReportType)&&null!=(o=this.Entities.keys.find(g=>g.endsWith("COM_DocNumData")))&&(R=R.Replace("NUM.",this.Entities[o]+".")),C.J0.IsEmpty(R)?"0":R}return n.Contains(",")?this.IsNewFromClause&&this.Filter.IsReportViewScreen&&this.Report.Preferences.ContainsKey("ExeQty_TblFunCall")?(++this.ExQCnt,this.FromTagExtra+=" left join dbo.fnRPT_ExeQtyByDocsNewAll("+Math.abs(e.DocID)+",'"+n+"'"+h+") ExQ"+this.ExQCnt+" on ExQ"+this.ExQCnt+".InvDocDetailsID=INV.InvDocDetailsID",t.ActualTable="ExQ"+this.ExQCnt+".ExQty","isnull(ExQ"+this.ExQCnt+".ExQty,0)"):"dbo.fnRPT_ExeQtyByDocsNew(INV.CostCenterID,INV.InvDocDetailsID,'"+n+"'"+h+")":this.IsNewFromClause&&this.Filter.IsReportViewScreen&&this.Report.Preferences.ContainsKey("ExeQty_TblFunCall")?(++this.ExQCnt,this.FromTagExtra+=" left join dbo.fnRPT_ExeQtyByDocNewAll("+Math.abs(e.DocID)+","+n+h+") ExQ"+this.ExQCnt+" on ExQ"+this.ExQCnt+".InvDocDetailsID=INV.InvDocDetailsID",t.ActualTable="ExQ"+this.ExQCnt+".ExQty","isnull(ExQ"+this.ExQCnt+".ExQty,0)"):"dbo.fnRPT_ExeQtyByDocNew(INV.CostCenterID,INV.InvDocDetailsID,"+n+h+")"}if(11415==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_ExeDocNosByDocNew(D.CostCenterID,D.InvDocDetailsID,'"+n+"'"+h+")":"dbo.fnRPT_ExeDocNosByDocNew(INV.CostCenterID,INV.InvDocDetailsID,'"+n+"'"+h+")";if(27266==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_ExeDocDateByDocNew(D.CostCenterID,D.InvDocDetailsID,'"+n+"'"+h+")":"dbo.fnRPT_ExeDocDateByDocNew(INV.CostCenterID,INV.InvDocDetailsID,'"+n+"'"+h+")";if(182==t.FieldValue){let R=this.StaticReportType>0?"D":"INV",g="",S="",I=" FROM INV_DocDetails EINV with(nolock) ",l=n;if(e.AbsDocID>4e4&&e.AbsDocID<5e4&&!C.J0.IsEmpty(l)&&l.Contains(e.AbsDocID.toString())){l=l.Replace(e.AbsDocID.toString(),"");let b=l.split(",");l="";for(let P=0;P<b.length;P++){let w=b[P];0!=w.length&&(l.length>0&&(l+=","),l+=w)}if(0==l.length)return"null"}if("FLOAT"==t.DataType)t.Column.startsWith("dcNum")||t.Column.startsWith("dcCalcNum")?(g="sum(ENUM."+t.Column+")",I+=" INNER JOIN COM_DocNumData ENUM WITH(NOLOCK) ON ENUM.InvDocDetailsID=EINV.InvDocDetailsID"):g="sum(EINV."+t.Column+")";else if("DATE"==t.DataType)if("ApprovalDate"==t.Column)if(null!=t.Formula&&t.Formula.startsWith("LEVEL")){let b=0;b=C.J0.Int(t.Formula.substr(5)),g=" top 1 (select convert(datetime,CreatedDate) from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and (StatusID=441 or StatusID=369"+(1==b?" or StatusID=371":"")+") and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) and WorkFlowLevel="+b+" order by ApprovalID desc))"}else g=" top 1 (select convert(datetime,CreatedDate) from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and StatusID=369 and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) order by ApprovalID desc))";else g="max(EINV."+t.Column+")";else if(t.Column.startsWith("dcAlpha"))g="ETXT."+t.Column,I+=" INNER JOIN COM_DocTextData ETXT WITH(NOLOCK) ON ETXT.InvDocDetailsID=EINV.InvDocDetailsID";else if(t.Column.startsWith("CreditAccount"))g="EA.AccountName",I+=" INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EINV.CreditAccount";else if(t.Column.startsWith("DebitAccount"))g="EA.AccountName",I+=" INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EINV.DebitAccount";else if(t.Column.startsWith("Posting"))g="EA."+t.Column.substr(t.Column.length-11,11),C.J0.IsEmptySpace(l)?I+=" JOIN ACC_DocDetails EACC with(nolock) on EACC.InvDocDetailsID=EINV.InvDocDetailsID INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EACC."+t.Column.substr(7,t.Column.length-11):I=" FROM ACC_DocDetails EINV with(nolock) INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EINV."+t.Column.substr(7,t.Column.length-11);else if(t.Column.startsWith("UOM"))g="U.UnitName",I+=" INNER JOIN COM_UOM U WITH(NOLOCK) ON U.UOMID=EINV.Unit";else if("ApprovalBy"==t.Column)if(null!=t.Formula&&t.Formula.startsWith("LEVEL")){let b=C.J0.Int(t.Formula.substr(5));g=" top 1 (select CreatedBy from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and (StatusID=441 or StatusID=369"+(1==b?" or StatusID=371":"")+") and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) and WorkFlowLevel="+b+" order by ApprovalID desc))"}else g=" top 1 (select CreatedBy from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and StatusID=369 and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) order by ApprovalID desc))";else g="EINV."+t.Column;return C.J0.IsEmptySpace(l)?(S=" WHERE EINV.LinkedInvDocDetailsID="+R+".InvDocDetailsID",S+=F?" and EINV.StatusID=369":" and EINV.StatusID!=376"):(I+=" INNER JOIN dbo.fnRPT_ExeDetailsIDByDoc(INV.CostCenterID,INV.InvDocDetailsID",l.Contains(",")?I+=",'"+l+"'":I+=","+l,I+=h+") AS ED  ON EINV.InvDocDetailsID=ED.DetailsID"),"FLOAT"==t.DataType||"DATE"==t.DataType||"ApprovalBy"==t.Column?g="(SELECT "+g+I+S+")":(0==S.length?S=" WHERE ":S+=" AND ",S+=g+" is not null and "+g+"!=''",g="STUFF((SELECT distinct ', '+"+g+I+S+" FOR XML PATH('')),1,2,'')"),g}}else{if(209==t.FieldValue){let n=this.StaticReportType>0?"D":"INV",h="",c="",u=" FROM INV_DocDetails EINV with(nolock) ";if("DATE"==t.DataType)h="ApprovalDate"==t.Column?"(select convert(datetime,CreatedDate) from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and StatusID=369 and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) order by ApprovalID desc))":"EINV."+t.Column;else if(t.Column.startsWith("dcCalcNum"))h="ENUM."+t.Column,u+=" INNER JOIN COM_DocNumData ENUM WITH(NOLOCK) ON ENUM.InvDocDetailsID=EINV.InvDocDetailsID";else if(t.Column.startsWith("dcAlpha"))h="ETXT."+t.Column,u+=" INNER JOIN COM_DocTextData ETXT WITH(NOLOCK) ON ETXT.InvDocDetailsID=EINV.InvDocDetailsID";else if(t.Column.startsWith("CreditAccount"))h="EA.AccountName",u+=" INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EINV.CreditAccount";else if(t.Column.startsWith("DebitAccount"))h="EA.AccountName",u+=" INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EINV.DebitAccount";else if(t.Column.startsWith("Product"))h="PR."+t.Column,u+=" INNER JOIN INV_Product PR WITH(NOLOCK) ON PR.ProductID=EINV.ProductID";else if(t.Column.startsWith("Currency"))h="CUR.Symbol",u+=" INNER JOIN COM_Currency CUR WITH(NOLOCK) ON CUR.CurrencyID=EINV.CurrencyID";else if(t.Column.startsWith("Posting"))h="EA."+t.Column.substr(t.Column.length-11,11),u+=" JOIN ACC_DocDetails EACC with(nolock) on EACC.InvDocDetailsID=EINV.InvDocDetailsID INNER JOIN ACC_Accounts EA WITH(NOLOCK) ON EA.AccountID=EACC."+t.Column.substr(7,t.Column.length-11);else if(t.Column.startsWith("UOM"))h="U.UnitName",u+=" INNER JOIN COM_UOM U WITH(NOLOCK) ON U.UOMID=EINV.Unit";else if("ApprovalBy"==t.Column)if(null!=t.Formula&&t.Formula.startsWith("LEVEL")){let F=0;F=C.J0.Int(t.Formula.substr(5)),h=" top 1 (select CreatedBy from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and (StatusID=441 or StatusID=369"+(1==F?" or StatusID=371":"")+") and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) and WorkFlowLevel="+F+" order by ApprovalID desc))"}else h=" top 1 (select CreatedBy from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and StatusID=369 and ccid=EINV.costcenterid and ccnodeid=EINV.DocID AND (DocDetID=0 OR DocDetID=EINV.InvDocDetailsID) order by ApprovalID desc))";else h="EINV."+t.Column;return c=" WHERE EINV.InvDocDetailsID="+n+".LinkedInvDocDetailsID",h="case when "+n+".LinkedInvDocDetailsID>0 then (SELECT "+h+u+c+") else null end",h}if(13964==t.FieldValue){let n=C.J0.IsEmptySpace(t.ExecutedDocument)?"":t.ExecutedDocument;return this.StaticReportType>0?"dbo.fnRPT_RefDocQty(D.CostCenterID,D.InvDocDetailsID,'"+n+"')":"dbo.fnRPT_RefDocQty(INV.CostCenterID,INV.InvDocDetailsID,'"+n+"')"}if(11484==t.FieldValue){let n=C.J0.IsEmptySpace(t.ExecutedDocument)?"":t.ExecutedDocument;return this.StaticReportType>0?"dbo.fnRPT_RefDocNos(D.CostCenterID,D.InvDocDetailsID,'"+n+"')":"dbo.fnRPT_RefDocNos(INV.CostCenterID,INV.InvDocDetailsID,'"+n+"')"}if(11514==t.FieldValue){if(C.J0.IsEmptySpace(t.ExecutedDocument))return this.StaticReportType>0?"(SELECT convert(datetime,DocDate) FROM INV_DocDetails with(nolock)\tWHERE InvDocDetailsID IN \n(select LinkedInvDocDetailsID from INV_DocDetails with(nolock) WHERE InvDocDetailsID=D.InvDocDetailsID and LinkedInvDocDetailsID>0))":"(SELECT convert(datetime,DocDate) FROM INV_DocDetails with(nolock)\tWHERE InvDocDetailsID IN \n(select LinkedInvDocDetailsID from INV_DocDetails with(nolock) WHERE InvDocDetailsID=INV.InvDocDetailsID and LinkedInvDocDetailsID>0))";{let n=C.J0.IsEmptySpace(t.ExecutedDocument)?"":t.ExecutedDocument;return this.StaticReportType>0?"dbo.fnRPT_RefDocDate(D.CostCenterID,D.InvDocDetailsID,'"+n+"')":"dbo.fnRPT_RefDocDate(INV.CostCenterID,INV.InvDocDetailsID,'"+n+"')"}}if(11362==t.FieldValue){if(this.IsInventory){let n="",h="",c=" and A.StatusID!=376";if(this.Entities.values.Contains("TDCC"))if(C.J0.IsEmpty(t.DimensionsFilter)){h=" AND A.ProductID=INV.ProductID";let u=0;N.d.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(u=C.J0.Int(N.d.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==u&&"True"==N.d.SessionManager.Preferences.EnableLocationWise.toString()&&("True"==N.d.SessionManager.Preferences["LW Reports"]||!C.J0.IsEmpty(this.Report)&&this.Report.ShowLocationFilter)&&(u=50002),0==u&&"True"==N.d.SessionManager.Preferences.EnableDivisionWise.toString()&&"True"==N.d.SessionManager.Preferences["DW Reports"]&&(u=50001),u>0&&(n=" AND DCC.dcCCNID"+(u-5e4)+"=TDCC.dcCCNID"+(u-5e4))}else{let u=t.DimensionsFilter.split("~");u.length>1&&""!=u[1]&&u[1].split(",").forEach(L=>{c+=" and A.StatusID!="+L}),(""==u[0]?[]:u[0].split(",")).forEach(L=>{"3"==L?h=" AND A.ProductID=INV.ProductID":n+=" AND DCC.dcCCNID"+(parseInt(L)-5e4)+"=TDCC.dcCCNID"+(parseInt(L)-5e4)})}else h=" AND A.ProductID=INV.ProductID";return n.length>0&&(h+=n,n=" INNER JOIN COM_DOCCCDATA DCC with(nolock) ON DCC.InvDocDetailsID=A.InvDocDetailsID"),"(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0)\tFROM INV_DocDetails A WITH(NOLOCK)"+n+"\nWHERE (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0"+c+h+")"}return"0"}if(11363==t.FieldValue)return this.IsInventory?"(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0)\tFROM INV_DocDetails A WITH(NOLOCK)\nWHERE A.ProductID=INV.ProductID AND (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0 AND A.StatusID<>376)":"0";if(148==t.FieldValue)return this.IsInventory?"(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0)\tFROM INV_DocDetails A WITH(NOLOCK)\nWHERE A.ProductID=INV.ProductID AND A.BatchID>1 AND A.BatchID=INV.BatchID AND (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0 AND A.StatusID<>376)":"NULL";if(11693==t.FieldValue){if(this.IsInventory){let n=this.Entities.ContainsKey("Documents")?this.Entities.Documents:"INV";return"(select convert(datetime,max(LD.DocDate)) from INV_DocDetails LD with(nolock) where LD.RefInvDocDetailsID="+n+".InvDocDetailsID and LD.BatchID="+n+".BatchID and LD.VoucherType=-1 AND LD.IsQtyIgnored=0 AND LD.ProductID="+n+".ProductID AND LD.DocDate<=@To AND LD.StatusID<>376)"}return"NULL"}if(26428==t.FieldValue)return 0==e.DocID&&this.Entities.ContainsKey("Product")?"(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0)\tFROM INV_DocDetails A WITH(NOLOCK)\nWHERE A.ProductID="+this.Entities.Product+".ProductID AND (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0 AND A.StatusID<>376)":"0";if(208==t.FieldValue)return 0==e.DocID&&this.Entities.ContainsKey("Product")?"case when exists(select ProductID from ADM_SchemesDiscounts with(nolock) where ProductID="+this.Entities.Product+".ProductID) then 'Y' else 'N' end":this.StaticReportType>0||this.IsInventory?"case when exists(select ProductID from ADM_SchemesDiscounts with(nolock) where ProductID=D.ProductID) then 'Y' else 'N' end":"";if(170==t.FieldValue){if(0==e.DocID&&this.Entities.ContainsKey("Product")){let c,n="",h="",u=0;N.d.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(u=C.J0.Int(N.d.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==u&&"True"==N.d.SessionManager.Preferences.EnableLocationWise.toString()&&("True"==N.d.SessionManager.Preferences["LW Reports"]||!C.J0.IsEmpty(this.Report)&&this.Report.ShowLocationFilter)&&(u=50002),50002==u&&N.d.SessionManager.LocationID>0&&(h=" INNER JOIN COM_DOCCCDATA DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=A.InvDocDetailsID AND DCC.dcCCNID2="+N.d.SessionManager.LocationID);let F="LATEST"==t.Formula;"DATE"==t.DataType?(F=!0,c=F?"top 1 convert(datetime,A."+t.Column+")":"max(convert(datetime,A."+t.Column+"))"):"FLOAT"==t.DataType?(t.Column.startsWith("dcCalcNum")?(n+=" INNER JOIN COM_DocNumData NUM WITH(NOLOCK) ON NUM.InvDocDetailsID=A.InvDocDetailsID",c="NUM."+t.Column):("Rate"==t.Column&&(F=!0),c="A."+t.Column),c=F?"top 1 "+c:"ISNULL(SUM("+c+"),0)"):t.Column.startsWith("dcAlpha")?(n+=" INNER JOIN COM_DocTextData TXT WITH(NOLOCK) ON TXT.InvDocDetailsID=A.InvDocDetailsID",c="TXT."+t.Column,c="top 1 "+c,F=!0):(F=!0,c="top 1 A."+t.Column);let L="(SELECT "+c+" FROM INV_DocDetails A WITH(NOLOCK)"+n+h;return L+=" WHERE A.ProductID="+this.Entities.Product+".ProductID AND A.StatusID<>376",C.J0.IsEmptySpace(t.ExecutedDocument)||(t.ExecutedDocument.Contains(",")?L+=" AND A.CostCenterID IN ("+t.ExecutedDocument+")":L+=" AND A.CostCenterID="+t.ExecutedDocument),F&&(L+=" order by A.DocDate desc"),L+=")",L}return"NULL"}if(25900==t.FieldValue){if(this.Entities.ContainsKey("Product")||this.Entities.values.Contains("INV")){let n="",h="",c=0;if(N.d.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(c=C.J0.Int(N.d.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==c&&"True"==N.d.SessionManager.Preferences.EnableLocationWise.toString()&&("True"==N.d.SessionManager.Preferences["LW Reports"]||!C.J0.IsEmpty(this.Report)&&this.Report.ShowLocationFilter)&&(c=50002),50002==c&&N.d.SessionManager.LocationID>0&&(n=" AND DCC.dcCCNID2="+N.d.SessionManager.LocationID),t.ParentCCDefaultColID>5e4){var r=this.Filter.CostCenterFilters.find(u=>u.CostCenterID==t.ParentCCDefaultColID);if(r&&(r.SelectedNodes.length>0||!r.DeleteButtonVisibility)){n.length>0&&(n+=" AND "),n+=" AND DCC.dcCCNID"+(t.ParentCCDefaultColID-5e4)+" IN (";for(let u=0;u<r.SelectedNodes.length;u++)u>0&&(n+=","),n+=r.SelectedNodes[u].Id;0==r.SelectedNodes.length&&(n+="-12912"),n+=")"}}return n.length>0&&(h=" INNER JOIN COM_DOCCCDATA DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=A.InvDocDetailsID"),h="(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0)\tFROM INV_DocDetails A WITH(NOLOCK)"+h+" WHERE A.ProductID=",this.Entities.ContainsKey("Product")?h+=this.Entities.Product:h+="INV",h+=".ProductID AND (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0 AND A.StatusID<>376"+n+")",h}return"0"}if(11420==t.FieldValue){if(this.IsInventory){let n="",h="",c="",u=" and A.StatusID!=376";if(this.Entities.values.Contains("TDCC"))if(C.J0.IsEmpty(t.DimensionsFilter)){c=" AND A.ProductID=INV.ProductID";let F=0;N.d.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(F=C.J0.Int(N.d.SessionManager.Preferences["Maintain Dimensionwise stock"])),0==F&&"True"==N.d.SessionManager.Preferences.EnableLocationWise.toString()&&("True"==N.d.SessionManager.Preferences["LW Reports"]||!C.J0.IsEmpty(this.Report)&&this.Report.ShowLocationFilter)&&(F=50002),0==F&&"True"==N.d.SessionManager.Preferences.EnableDivisionWise.toString()&&"True"==N.d.SessionManager.Preferences["DW Reports"]&&(F=50001),F>0&&(h=" AND DCC.dcCCNID"+(F-5e4)+"=TDCC.dcCCNID"+(F-5e4))}else{let F=t.DimensionsFilter.split("~");F.length>1&&""!=F[1]&&F[1].split(",").forEach(R=>{u+=" and A.StatusID!="+R}),(""==F[0]?[]:F[0].split(",")).forEach(R=>{"3"==R?c=" AND A.ProductID=INV.ProductID":h+=" AND DCC.dcCCNID"+(parseInt(R)-5e4)+"=TDCC.dcCCNID"+(parseInt(R)-5e4)})}else c=" AND A.ProductID=INV.ProductID";return h.length>0&&(c+=h,h=" INNER JOIN COM_DOCCCDATA DCC with(nolock) ON DCC.InvDocDetailsID=A.InvDocDetailsID"),n="(SELECT ISNULL(SUM(A.UOMConvertedQty*A.VoucherType),0)\tFROM INV_DocDetails A WITH(NOLOCK)"+h+" WHERE A.StatusID!=376 AND A.ProductID=INV.ProductID AND (A.VoucherType=1 OR A.VoucherType=-1) AND A.IsQtyIgnored=0"+u+c,null!=this.Report&&!C.J0.IsEmpty(t.DimensionsFilter)&&t.DimensionsFilter.Contains("FROMDATE$1")?n+=" AND (A.DocumentType=3 OR A.DocDate<convert(float,convert(datetime,'"+this.Report.FromDatePicker.Date.ToString("dd MMM yyyy")+"')))":n+=" AND (A.DocumentType=3 OR A.DocDate<INV.DocDate)",n+=")",n}return"NULL"}if("HoldQuantity"==t.Column){let n="(select INV.HoldQuantity-(case when release>INV.HoldQuantity then INV.HoldQuantity else release end) Executed\nfrom  (\nSELECT isnull(sum(case when ";return C.J0.IsEmpty(N.d.SessionManager.Preferences.HoldResCancelledDocs)?n+="l.IsQtyIgnored=0":n+="(l.IsQtyIgnored=0 or l.Costcenterid in("+N.d.SessionManager.Preferences.HoldResCancelledDocs+"))",n+="then l.Quantity else l.ReserveQuantity end),0) release \nFROM INV_DocDetails l WITH(NOLOCK) WHERE INV.InvDocDetailsID=l.LinkedInvDocDetailsID) as t)",n}if(26419==t.FieldValue||26420==t.FieldValue||50453==t.FieldValue||26419==t.ParentCCDefaultColID||26420==t.ParentCCDefaultColID||50453==t.ParentCCDefaultColID||26426==t.FieldValue||26426==t.ParentCCDefaultColID){let n="",h="",c="";c=C.J0.IsEmpty(this.UnPostedDocsInclude)?" AND l.StatusID<>376 and l.StatusID<>372 ":" AND l.StatusID=369 ";let u=this.GetDimensionFilterForStock("DCCX.dcCCNID"),F="";u.length>0&&(h=" INNER JOIN COM_DocCCData DCCX WITH(NOLOCK)  ON DCCX.InvDocDetailsID=DX.InvDocDetailsID");let L="";this.StaticReportType>0?L="P.ProductID":this.Entities.ContainsKey("Product")?L=this.Entities.Product+".ProductID":(L="INV.ProductID",C.J0.IsEmpty(t.DimensionsFilter)||(h=" INNER JOIN COM_DocCCData DCCX WITH(NOLOCK)  ON DCCX.InvDocDetailsID=DX.InvDocDetailsID",u="",t.DimensionsFilter.split(",").forEach(g=>{u+=" AND DCCX.dcCCNID"+(parseInt(g)-5e4)+"="+this.Entities.Documents_CCMAP+".dcCCNID"+(parseInt(g)-5e4)})));let R="sum(case when l.IsQtyIgnored=0 then l.UOMConvertedQty else l.ReserveQuantity end)";if(C.J0.IsEmpty(N.d.SessionManager.Preferences.HoldResCancelledDocs)||(R="sum(case when (l.IsQtyIgnored=0 or l.Costcenterid in("+N.d.SessionManager.Preferences.HoldResCancelledDocs+")) then l.UOMConvertedQty else l.ReserveQuantity end)"),u.length>0){let g=0;N.d.SessionManager.Preferences.ContainsKey("Maintain Dimensionwise stock")&&(g=C.J0.Int(N.d.SessionManager.Preferences["Maintain Dimensionwise stock"])),g>0&&(F=" left JOIN COM_DocCCData DCCXL WITH(NOLOCK)  ON DCCXL.InvDocDetailsID=l.InvDocDetailsID AND  DCCXL.dcCCNID"+(g-5e4)+"=DCCX.dcCCNID"+(g-5e4),R=C.J0.StringIsNullOrEmpty(N.d.SessionManager.Preferences.HoldResCancelledDocs)?"sum(case when DCCXL.InvDocDetailsID is not null and l.IsQtyIgnored=0 then l.UOMConvertedQty when DCCXL.InvDocDetailsID is not null THEN l.ReserveQuantity else 0 end)":"sum(case when DCCXL.InvDocDetailsID is not null and (l.IsQtyIgnored=0 or l.Costcenterid in("+N.d.SessionManager.Preferences.HoldResCancelledDocs+")) then l.UOMConvertedQty when DCCXL.InvDocDetailsID is not null THEN l.ReserveQuantity else 0 end)")}if(26419==t.FieldValue||26419==t.ParentCCDefaultColID){n="(select isnull(sum(HoldQuantity-rel),0) from (select HoldQuantity,case when release>HoldQuantity then HoldQuantity else release end rel from \n                        (SELECT DX.HoldQuantity\n,isnull((select "+R+" from INV_DocDetails l WITH(NOLOCK)"+F+" where DX.InvDocDetailsID=l.LinkedInvDocDetailsID "+c+" ),0) release\nFROM INV_DocDetails DX WITH(NOLOCK)"+h+"\nWHERE DX.ProductID="+L+" AND DX.IsQtyIgnored=1 and DX.StatusID";let g=this;!C.J0.IsEmpty(N.d.SessionManager.Preferences.ConsiderUnAppInHold)&&(0,Z.yG0)(N.d.SessionManager.Preferences.ConsiderUnAppInHold)?"ReportViewModel"==this.ClassName&&g.Preferences.ContainsKey("IncludeUnPostedDocsHoldQty")&&"1"==g.Preferences.IncludeUnPostedDocsHoldQty||"AddEditReportViewModel"==this.ClassName&&null!=g.Options.GLIncludeUnPostedDocsHoldQty&&g.Options.GLIncludeUnPostedDocsHoldQty.Visible&&g.Options.GLIncludeUnPostedDocsHoldQty.IsChecked?n+=" not in (372,376)":n+=" in (371,441,369)":"ReportViewModel"==this.ClassName&&g.Preferences.ContainsKey("IncludeUnPostedDocsHoldQty")&&"1"==g.Preferences.IncludeUnPostedDocsHoldQty||"AddEditReportViewModel"==this.ClassName&&null!=g.Options.GLIncludeUnPostedDocsHoldQty&&g.Options.GLIncludeUnPostedDocsHoldQty.Visible&&g.Options.GLIncludeUnPostedDocsHoldQty.IsChecked?n+=" not in (372,376)":n+="=369",n+=" and DX.DocumentType in (7,9,11,12,24) and DX.VoucherType=-1 "+u+" \n                ) as t)as temp) "}else if(26426==t.FieldValue||26426==t.ParentCCDefaultColID){var M="";16==this.StaticReportType&&null!=this.oReportDialog&&(M=" and DX.DocDate<=convert(float,convert(datetime,'"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))"),u+=M,n="(SELECT SUM(QUANTITY)-SUM(Executed) PendingOrders FROM \n                   \t\t\t\t(select QUANTITY,case when Executed>QUANTITY then QUANTITY else Executed end Executed from\n\t\t\t\t                    (SELECT DX.QUANTITY*DX.UOMConversion QUANTITY,(case when DX.LinkStatusID=445 then DX.Quantity else \n                                    (SELECT ISNULL(SUM(Qty),0) FROM \n                                   --(SELECT 0 Qty)\n                                   (select (select "+R.Replace("l.ReserveQuantity","0")+" from INV_DocDetails l WITH(NOLOCK) "+F+" where DX.InvDocDetailsID=l.LinkedInvDocDetailsID "+c+M+" )  Qty)\n                                   AS T) END)*DX.UOMConversion Executed FROM INV_DocDetails DX with(nolock) "+h+" WHERE DX.ProductID ="+L+M,n+=" and DX.StatusID<>376",n+=" and DX.DocumentType in (2) and DX.VoucherType=1 "+u+") as t)as temp) "}else if(26420==t.FieldValue||26420==t.ParentCCDefaultColID){let g="";16==this.StaticReportType&&null!=this.oReportDialog&&(g=" and DX.DocDate<=convert(float,convert(datetime,'"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))"),u+=g,n="(select isnull(sum(HoldQuantity-rel),0) from (select HoldQuantity,case when release>HoldQuantity then HoldQuantity else release end rel from\n                    (SELECT DX.ReserveQuantity HoldQuantity\n,isnull((select "+R+" from INV_DocDetails l WITH(NOLOCK)"+F+" where DX.InvDocDetailsID=l.LinkedInvDocDetailsID"+c+g.replace("DX.DocDate","l.DocDate")+"),0) release\nFROM INV_DocDetails DX WITH(NOLOCK)"+h+"\nWHERE DX.ProductID="+L+" AND DX.IsQtyIgnored=1 and DX.StatusID";let S=this;!C.J0.IsEmpty(N.d.SessionManager.Preferences.ConsiderUnAppInHold)&&(0,Z.yG0)(N.d.SessionManager.Preferences.ConsiderUnAppInHold)?"ReportViewModel"==this.ClassName&&S.Preferences.ContainsKey("IncludeUnPostedDocsReserveQty")&&"1"==S.Preferences.IncludeUnPostedDocsReserveQty.ToString()||"AddEditReportViewModel"==this.ClassName&&null!=S.Options.GLIncludeUnPostedDocsReserveQty&&S.Options.GLIncludeUnPostedDocsReserveQty.Visible&&S.Options.GLIncludeUnPostedDocsReserveQty.IsChecked?n+=" not in (372,376)":n+=" in (371,441,369)":"ReportViewModel"==this.ClassName&&S.Preferences.ContainsKey("IncludeUnPostedDocsReserveQty")&&"1"==S.Preferences.IncludeUnPostedDocsReserveQty.ToString()||"AddEditReportViewModel"==this.ClassName&&null!=S.Options.GLIncludeUnPostedDocsReserveQty&&S.Options.GLIncludeUnPostedDocsReserveQty.Visible&&S.Options.GLIncludeUnPostedDocsReserveQty.IsChecked?n+=" not in (372,376)":n+="=369",n+=" and DX.DocumentType in (7,9,11,12,24) and DX.VoucherType=-1 "+u+" \n) as t)as temp) "}else(50453==t.FieldValue||50453==t.ParentCCDefaultColID)&&(n="(select isnull(sum(HoldQuantity-rel),0) from (select HoldQuantity,case when release>HoldQuantity then HoldQuantity else release end rel from\n                    (SELECT DX.ReserveQuantity HoldQuantity\n,isnull((select "+R+" from INV_DocDetails l WITH(NOLOCK)"+F+" where DX.InvDocDetailsID=l.LinkedInvDocDetailsID),0) release\nFROM INV_DocDetails DX WITH(NOLOCK)"+h+"\nWHERE DX.ProductID="+L+" AND DX.IsQtyIgnored=1 and DX.StatusID=369  and DX.DocumentType in (1,2,4,10,25,26,27) and DX.VoucherType=1 "+u+"\n) as t)as temp) ");return n}if(11383==t.FieldValue||11384==t.FieldValue){let n="dcCCNID2";return t.ParentCCDefaultColID>5e4&&t.ParentCCDefaultColID<51e3&&(n="dcCCNID"+(t.ParentCCDefaultColID-5e4)),"(SELECT TOP 1 "+(11383==t.FieldValue?"TOLOC.Code":"TOLOC.Name")+" FROM Inv_DocDetails ToINV WITH(NOLOCK) INNER JOIN COM_DocCCData TOCC WITH(NOLOCK) ON TOCC.InvDocDetailsID=ToINV.InvDocDetailsID INNER JOIN COM_Location TOLOC WITH(NOLOCK) ON TOCC."+n+"=TOLOC.NodeID WHERE ToINV.voucherno=INV.voucherno AND ToINV.DocSeqNo=INV.DocSeqNo AND ToINV.VoucherType!=INV.VoucherType)"}if(11424==t.FieldValue)return"(SELECT TOP 1 S.ProfileName FROM ADM_SchemesDiscounts S WITH(NOLOCK) WHERE S.SchemeID=INV.IsQtyFreeOffer)";if(11425==t.FieldValue)return this.StaticReportType>0?"(CASE WHEN D.IsQtyFreeOffer=1 OR (D.ParentSchemeID!='' and D.ParentSchemeID is not null) THEN D.Quantity ELSE 0.0 END)":"(CASE WHEN INV.IsQtyFreeOffer=1 OR (INV.ParentSchemeID!='' and INV.ParentSchemeID is not null) THEN INV.Quantity ELSE 0.0 END)";if(189==t.FieldValue)return"(select top 1 Rate from INV_DocDetails with(nolock) where  ProductID="+(this.StaticReportType>0?"D":"INV")+".ProductID and UOMConvertedQty>0"+(C.J0.IsEmptySpace(t.ExecutedDocument)?" and IsQtyIgnored=0":" and CostCenterID IN ("+t.ExecutedDocument+")")+" order by docdate desc)";if(11509==t.FieldValue)return"(select top 1 StockValue/UOMConvertedQty from INV_DocDetails with(nolock) where  ProductID="+(this.StaticReportType>0?"D":"INV")+".ProductID and VoucherType=1 and UOMConvertedQty>0"+(C.J0.IsEmptySpace(t.ExecutedDocument)?" and IsQtyIgnored=0":" and CostCenterID IN ("+t.ExecutedDocument+")")+" order by docdate desc)";if(11510==t.FieldValue){let n=C.J0.IsEmptySpace(t.ExecutedDocument)?" and IsQtyIgnored=0":" and CostCenterID IN ("+t.ExecutedDocument+")";return this.StaticReportType>0?"(select top 1 StockValue/UOMConvertedQty from INV_DocDetails with(nolock) where  ProductID=D.ProductID and VoucherType=1 and UOMConvertedQty>0"+n+" order by docdate desc)":0==e.DocID&&this.Entities.ContainsKey("Product")?"(select top 1 StockValue/UOMConvertedQty from INV_DocDetails with(nolock) where  ProductID="+this.Entities.Product+".ProductID and VoucherType=1 and UOMConvertedQty>0"+n+" order by docdate desc)":"0"}if(11511==t.FieldValue||11512==t.FieldValue||11513==t.FieldValue)return this.IsAvgRateExists=!0,this.StaticReportType>0?"NULL":0==e.DocID&&this.Entities.ContainsKey("Product")||this.Entities.values.Contains("INV")?"0.0":"null";if(188==t.FieldValue){if(this.StaticReportType>0)return"NULL";var o;if(o=this.Entities.keys.find(h=>h.endsWith("COM_DocNumData"))){let h=C.J0.Int(t.Formula);return"(select X.value('@Remarks','nvarchar(max)') from "+this.Entities[o]+".Remarks.nodes('/XML/Row') as Data(X) where X.value('@Columnname','nvarchar(50)')='dcNum"+h+"')"}return"NULL"}if(t.FieldValue>=164&&t.FieldValue<=167||t.FieldValue>=11657&&t.FieldValue<=11658){let n="STUFF( (select";return 164==t.FieldValue?n+="', '+SA1.AccountName from acc_docdetails S1 with(nolock)  inner join acc_accounts SA1 with(nolock) on SA1.AccountID=S1.DebitAccount\nwhere S1.InvDocDetailsID=INV.InvDocDetailsID  group by SA1.AccountName":165==t.FieldValue?n+="', '+SA1.AccountName from acc_docdetails S1 with(nolock)  inner join acc_accounts SA1 with(nolock) on SA1.AccountID=S1.CreditAccount\nwhere S1.InvDocDetailsID=INV.InvDocDetailsID  group by SA1.AccountName":166==t.FieldValue?n+="', '+convert(nvarchar,sum(S1.Amount)) from acc_docdetails S1 with(nolock)  inner join acc_accounts SA1 with(nolock) on SA1.AccountID=S1.DebitAccount\nwhere S1.InvDocDetailsID=INV.InvDocDetailsID  group by SA1.AccountName":167==t.FieldValue?n+="', '+convert(nvarchar,sum(S1.Amount)) from acc_docdetails S1 with(nolock)  inner join acc_accounts SA1 with(nolock) on SA1.AccountID=S1.CreditAccount\nwhere S1.InvDocDetailsID=INV.InvDocDetailsID  group by SA1.AccountName":11657==t.FieldValue?n+="', '+convert(nvarchar,sum(S1.AmountFC)) from acc_docdetails S1 with(nolock)  inner join acc_accounts SA1 with(nolock) on SA1.AccountID=S1.DebitAccount\nwhere S1.InvDocDetailsID=INV.InvDocDetailsID  group by SA1.AccountName":11658==t.FieldValue&&(n+="', '+convert(nvarchar,sum(S1.AmountFC)) from acc_docdetails S1 with(nolock)  inner join acc_accounts SA1 with(nolock) on SA1.AccountID=S1.CreditAccount\nwhere S1.InvDocDetailsID=INV.InvDocDetailsID  group by SA1.AccountName"),n+=" FOR XML PATH(''),type).value('.','nvarchar(max)'),1,2,'')",n}if(204==t.FieldValue)return"STUFF((SELECT ', '+SerialNumber from INV_SerialStockProduct with(nolock) where InvDocDetailsID="+(0==this.StaticReportType?"INV":"D")+".InvDocDetailsID FOR XML PATH('')),1,2,'')";if(181==t.FieldValue){let n="",h="Code"==t.Column?"Code":"Name",c=this.StaticReportType>0?"D":m;if(16==this.StaticReportType)return n;if(13==this.StaticReportType||81==this.StaticReportType||82==this.StaticReportType||83==this.StaticReportType||158==this.StaticReportType){if(this.Filter.IsReportViewScreen){let u=this;if(this.ReportParams.ContainsKey("BinDetail")&&this.ReportParams.Remove("BinDetail"),u.Preferences.ContainsKey("BinDetail")&&"1"==u.Preferences.BinDetail)return this.GroupFromTag.Contains("BIN.NodeID")||(this.GroupFromTag+=" left join INV_BinDetails BD with(nolock) on BD.InvDocDetailsID="+c+".InvDocDetailsID left join "+t.ParentCostCenterSysName+" BIN with(nolock) ON BIN.NodeID=BD.BinID"),this.ReportParams.ContainsKey("BinInfo")&&this.ReportParams.Remove("BinInfo"),this.ReportParams.ContainsKey("BinDetail")||this.ReportParams.push("BinDetail",""),"BIN."+h}n="STUFF((SELECT distinct ', '+B."+h,(81!=this.StaticReportType&&"2"!=t.Formula||82==this.StaticReportType||83==this.StaticReportType)&&(n+="+'-'+convert(nvarchar,Quantity)"),n+=" FROM INV_BinDetails BD with(nolock) inner join "+t.ParentCostCenterSysName+" B with(nolock) ON B.NodeID=BD.BinID WHERE BD.InvDocDetailsID="+c+".InvDocDetailsID\n                FOR XML PATH('')),1,2,'')",this.ReportParams.ContainsKey("BinInfo")||this.ReportParams.push("BinInfo",""),this.ReportParams.BinInfo=n}else n=0==this.StaticReportType?"STUFF((SELECT distinct ', '+B."+h+"+'-'+convert(nvarchar,Quantity) FROM INV_BinDetails BD with(nolock) inner join "+t.ParentCostCenterSysName+" B with(nolock) ON B.NodeID=BD.BinID WHERE BD.InvDocDetailsID="+c+".InvDocDetailsID FOR XML PATH('')),1,2,'')":"NULL";return n}if(26648==t.FieldValue){if(this.IsInventory&&("TRUE"==N.d.SessionManager.Preferences["LW Bins"].toUpperCase()||"TRUE"==N.d.SessionManager.Preferences["DW Bins"].toUpperCase())){let n=N.d.common.GetDataTable("RPT037","");if(n.Columns[0].Contains("TableName")&&n.Table[0].length>0){let h="dcCCNID1",c="Division";"TRUE"==N.d.SessionManager.Preferences["LW Bins"].toUpperCase()&&(h="dcCCNID2",c="Location");let u="";for(let F=0;F<this.Objects.length;F++)if(this.Entities.keys[F].endsWith("_CCMAP")&&"COM_DOCCCDATA"==this.Objects[F].Table.toUpperCase()){u=this.Entities.keys[F];break}if(!C.J0.IsEmpty(u))return"(select TOP 1 D.Name from INV_ProductBins B with(nolock)\ninner join "+n.Table[0].TableName.toString()+" D with(nolock) on B.BinNodeID=D.NodeID\nwhere B."+c+"="+this.Entities[u]+"."+h+" AND B.NodeID=INV.ProductID AND B.CostCenterID=3)"}}return"NULL"}}else{if(11366==t.FieldValue)return this.StaticReportType>0?"(SELECT top 1 CPDC.VoucherNo FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=D.AccDocDetailsID and CPDC.CostCenterID=(select TOP 1ConvertAS from ADM_DocumentTypes DTP with(nolock) where DTP.CostCenterID=D.CostCenterID ))":"(SELECT top 1 CPDC.VoucherNo FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=ACC.AccDocDetailsID and CPDC.CostCenterID=(select ConvertAS from ADM_DocumentTypes D with(nolock) where d.CostCenterID=ACC.CostCenterID ))";if(11367==t.FieldValue)return this.StaticReportType>0?"(SELECT top 1 CPDC.VoucherNo FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=D.AccDocDetailsID and CPDC.CostCenterID=(select TOP 1 ConvertAS from ADM_DocumentTypes DTP with(nolock) where DTP.CostCenterID=D.CostCenterID ))":"(SELECT top 1 CONVERT(DATETIME,CPDC.DocDate) FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=ACC.AccDocDetailsID and CPDC.CostCenterID=(select ConvertAS from ADM_DocumentTypes D with(nolock) where d.CostCenterID=ACC.CostCenterID ))";if(11410==t.FieldValue)return"(SELECT top 1 CONVERT(DATETIME,CPDC.DocDate) FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=ACC.AccDocDetailsID and CPDC.CostCenterID=(select IntermediateConvertion from ADM_DocumentTypes D with(nolock) where d.CostCenterID=ACC.CostCenterID ))";if(11411==t.FieldValue)return this.StaticReportType>0?"(SELECT top 1 CPDC.VoucherNo FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=D.AccDocDetailsID and CPDC.CostCenterID=(select IntermediateConvertion from ADM_DocumentTypes DT with(nolock) where dT.CostCenterID=D.CostCenterID ))":"(SELECT top 1 CPDC.VoucherNo FROM ACC_DocDetails CPDC with(nolock) WHERE CPDC.RefCCID=400 AND CPDC.refnodeid=ACC.AccDocDetailsID and CPDC.CostCenterID=(select IntermediateConvertion from ADM_DocumentTypes D with(nolock) where d.CostCenterID=ACC.CostCenterID ))";if("DebitAmount"==t.Column)return"(CASE WHEN ACC.DebitAccount>0 THEN ACC.Amount ELSE 0 END)";if("CreditAmount"==t.Column)return"(CASE WHEN ACC.CreditAccount>0 THEN ACC.Amount ELSE 0 END)";if("HoldTillDate"==t.Column)return"CONVERT(DATETIME,ACC.HoldTillDate)";if("HoldStatus"==t.Column)return"ACC.HoldStatus";if(210==t.FieldValue)return"NULL"}if(214==t.FieldValue){let n="";(1==this.StaticReportType||-2==this.StaticReportType)&&(m="D");let h=C.J0.IsEmpty(t.DimensionsFilter)?[]:t.DimensionsFilter.split("~");if(h.length>2&&h[1].length>0&&h[2].length>0){let c=!1,u=!1,F=h[2].split(",");for(let L=0;L<F.length;L++)if(L>0&&(n+=","),F[L].startsWith("EFPD_"))"EFPD_AccDocDetailsID"==F[L]?u=!0:("EFPD_InvDocDetailsID"==F[L]||"EFPD_ProductID"==F[L])&&(c=!0),n+=u&&e.IsInventory||c&&!e.IsInventory?"null":"EFPD_AccountID"==F[L]?e.IsDebit?m+".DebitAccount":m+".CreditAccount":m+"."+F[L].Replace("EFPD_","");else if(F[L].startsWith("EF_"))n=this.SetExtFunctionParams(F[L],n);else if(F[L].startsWith("COL_")&&"ReportViewModel"==this.ClassName){var T=this.BaseReportColumns.find(R=>R.ID==F[L].substr(4));if(T){let R=T.CDGDO.IsForeignKey?T.CDGDO.ParentCostCenterID:T.CDGDO.CategoryValue;400!=R&&(R<4e4||R>5e4)&&("NULL"!=T.CDGDO.ActualColumn?(this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(g=>g.FeatureID==R),n+=T.CDGDO.ActualTable+"."+this.drrCCTbl[0].PK.toString()):n+="NULL")}}return n.length>0?n="dbo."+h[1]+"("+n+")":"null"}return"null"}if(11364==t.FieldValue)return"CASE WHEN (SELECT COUNT(*) FROM COM_Files WITH(NOLOCK) WHERE FeatureID="+m+".CostCenterID AND FeaturePK="+m+".DocID)>0 THEN 'YES' ELSE 'NO' END";if(11516==t.FieldValue)return"stuff((select ','+REPLACE(ISNULL(Note,''),CHAR(13),'') from COM_Notes WITH(NOLOCK) WHERE FeatureID="+m+".CostCenterID AND FeaturePK="+m+".DocID FOR XML PATH('')),1,1,'')";if("NoteCreatedDate"==t.Column)return"stuff((select ','+convert(nvarchar, convert(datetime,createddate),106) +' '+convert(nvarchar, convert(datetime,createddate),108) from COM_Notes WITH(NOLOCK) WHERE FeatureID="+m+".CostCenterID AND FeaturePK="+m+".DocID FOR XML PATH('')),1,1,'')";if("NoteModifiedDate"==t.Column)return"stuff((select ','+convert(nvarchar, convert(datetime,ModifiedDate),106) +' '+convert(nvarchar, convert(datetime,ModifiedDate),108) from COM_Notes WITH(NOLOCK) WHERE FeatureID="+m+".CostCenterID AND FeaturePK="+m+".DocID FOR XML PATH('')),1,1,'')";if(11690==t.FieldValue)return"stuff((select distinct ','+Note from COM_Notes WITH(NOLOCK) WHERE FeatureID="+m+".RefCCID AND FeaturePK="+m+".RefNodeid),1,1,'')";if("ProductImage"==t.Column)return"(select top 1 F.GUID+'.'+F.FileExtension from COM_Files F WITH(NOLOCK) where F.FeatureID=3 and F.IsProductImage=1 and F.FeaturePK="+this.Entities[t.CategoryText]+".ProductID and F.IsDefaultImage=1)";if("DimensionImage"==t.Column)return"(select top 1 F.GUID+'.'+F.FileExtension from COM_Files F WITH(NOLOCK) where F.FeatureID="+(t.ParentCostCenterID>0?t.ParentCostCenterID:t.CategoryValue)+" and F.IsProductImage=1 and F.FeaturePK="+this.Entities[t.CategoryText]+".NodeID and F.IsDefaultImage=1)";if("IMAGE"==t.DataType&&t.Column.startsWith("IMG_"))return"(select top 1 F.GUID+'.'+F.FileExtension from COM_Files F WITH(NOLOCK) where F.FeatureID="+(t.ParentCostCenterID>0?t.ParentCostCenterID:t.CategoryValue)+" and F.IsProductImage=1 and F.FeaturePK="+this.Entities[t.CategoryText]+".NodeID and F.IsDefaultImage="+t.Column.Replace("IMG_","")+")";if(11368==t.FieldValue)return" (SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.IsNewReference=0 AND (CB.RefDocNo="+m+".VoucherNo OR CB.DocNo="+m+".VoucherNo) "+(!C.J0.IsEmpty(t.Formula)&&t.Formula.Contains("Account")?" AND "+m+"."+t.Formula.Replace("$","")+"=CB.AccountID":"")+")";if(11409==t.FieldValue){let n=this,h=!C.J0.IsEmpty(t.Formula)&&t.Formula.Contains("Account")?" AND "+m+"."+t.Formula.Replace("$","")+"=CB.AccountID":"";return"INV"==m?"AddEditReportViewModel"==this.ClassName&&n.Options.ExcludePDCAdjust.IsChecked||"ReportViewModel"==this.ClassName&&n.Preferences.ContainsKey("ExcludePDCsAdjust")&&"1"==n.Preferences.ExcludePDCsAdjust?" (SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.StatusID Not in (370) AND CB.IsNewReference=0 and DynamicInvDocDetailsID is null AND ((CB.RefDocNo="+m+".VoucherNo and "+m+".DocSeqNo=CB.RefDocSeqNo) OR (CB.DocNo="+m+".VoucherNo AND "+m+".DocSeqNo=CB.DocSeqNo))"+h+")":" (SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.IsNewReference=0 and DynamicInvDocDetailsID is null AND ((CB.RefDocNo="+m+".VoucherNo and "+m+".DocSeqNo=CB.RefDocSeqNo) OR (CB.DocNo="+m+".VoucherNo AND "+m+".DocSeqNo=CB.DocSeqNo))"+h+")":"AddEditReportViewModel"==this.ClassName&&n.Options.ExcludePDCAdjust.IsChecked||"ReportViewModel"==this.ClassName&&n.Preferences.ContainsKey("ExcludePDCsAdjust")&&"1"==n.Preferences.ExcludePDCsAdjust?" (SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.StatusID Not in (370) AND CB.IsNewReference=0 AND ((CB.RefDocNo="+m+".VoucherNo and "+m+".DocSeqNo=CB.RefDocSeqNo) OR (CB.DocNo="+m+".VoucherNo AND "+m+".DocSeqNo=CB.DocSeqNo))"+h+")":" (SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.IsNewReference=0 AND ((CB.RefDocNo="+m+".VoucherNo and "+m+".DocSeqNo=CB.RefDocSeqNo) OR (CB.DocNo="+m+".VoucherNo AND "+m+".DocSeqNo=CB.DocSeqNo))"+h+")"}if(213==t.FieldValue){let n=!C.J0.IsEmpty(t.Formula)&&t.Formula.Contains("Account")?" AND "+m+"."+t.Formula.Replace("$","")+"=CB.AccountID":"";return`stuff(\n(select ','+convert(nvarchar, convert(datetime,LastDate),106) from\n(SELECT DocNo, DocDate LastDate FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.IsNewReference=0 AND CB.RefDocNo = ${m}.VoucherNo ${n} \nUNION ALL\nSELECT RefDocNo,RefDocDate LastDate FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.IsNewReference=0 AND CB.DocNo =${m}.VoucherNo ${n}\n) as T\ngroup by DocNo,LastDate FOR XML PATH('')), 1,1,'')`}if(11369==t.FieldValue)return"(SELECT TOP 1 CONVERT(DATETIME,LastDate) FROM (\nSELECT DocDate LastDate FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND (CB.RefDocNo="+m+".VoucherNo)\nUNION\nSELECT RefDocDate LastDate FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND (CB.DocNo="+m+".VoucherNo) ) AS T ORDER BY LastDate DESC)";if(11370==t.FieldValue)return"(SELECT TOP 1 DocNo FROM (\nSELECT DocDate LastDate,CB.DocNo DocNo FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND (CB.RefDocNo="+m+".VoucherNo)\nUNION\nSELECT RefDocDate LastDate,CB.RefDocNo DocNo FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND (CB.DocNo="+m+".VoucherNo) ) AS T ORDER BY LastDate DESC)";if(11414==t.FieldValue){let n=this.StaticReportType>0?"D":m;return n=","+(!C.J0.IsEmpty(t.Formula)&&t.Formula.Contains("Account")?n+"."+t.Formula.Replace("$",""):"0"),this.StaticReportType>0?"dbo.fnRPT_GetAdjustedDocNos(D.VoucherNo"+n+")":"dbo.fnRPT_GetAdjustedDocNos("+m+".VoucherNo "+n+")"}if(527==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_GetAdjustedDocChequeDate(D.VoucherNo)":"dbo.fnRPT_GetAdjustedDocChequeDate("+m+".VoucherNo)";if(528==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_GetAdjustedDocMaturityDate(D.VoucherNo)":"dbo.fnRPT_GetAdjustedDocMaturityDate("+m+".VoucherNo)";if(180==t.FieldValue){let n=this.StaticReportType>0?"D":m;return!C.J0.IsEmpty(t.Formula)&&t.Formula.Contains("Account")&&t.Formula.Replace("$",""),"STUFF((SELECT distinct ', '+B.BillNo FROM (\nSELECT CB.DocNo DocNo FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.IsNewReference=0 AND CB.RefDocNo="+n+".VoucherNo + formulaFilter + \nUNION\nSELECT CB.RefDocNo DocNo FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.IsNewReference=0 AND CB.DocNo="+n+".VoucherNo + formulaFilter + \n)AS T inner join inv_docdetails B with(nolock) on B.VoucherNo=T.DocNo\nwhere B.BillNo is not null and B.BillNo!=''\nFOR XML PATH('')),1,2,'')"}if(11506==t.FieldValue)return" (SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_ChequeReturn CB WITH(NOLOCK) WHERE IsNewReference=0 AND ((CB.RefDocNo="+m+".VoucherNo and "+m+".DocSeqNo=CB.RefDocSeqNo)))";if(11507==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_GetChequeRetunAdjustedDocNos(D.VoucherNo)":"dbo.fnRPT_GetChequeRetunAdjustedDocNos("+m+".VoucherNo)";if(11659==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_GetChequeRetunAdjustedDocDate(D.VoucherNo)":"dbo.fnRPT_GetChequeRetunAdjustedDocDate("+m+".VoucherNo)";if(202==t.FieldValue)return this.StaticReportType>0?"dbo.fnRPT_GetAdjustedDocInfo(D.VoucherNo)":"dbo.fnRPT_GetAdjustedDocInfo("+m+".VoucherNo)";if(11371==t.FieldValue||11372==t.FieldValue)return this.IsOpeningStockExists=!0,"0.0";if(11373==t.FieldValue||11374==t.FieldValue)return this.IsClosingStockExists=!0,"0.0";if(11377==t.FieldValue||11378==t.FieldValue||11379==t.FieldValue||11380==t.FieldValue){let n=m+".docid";var D=this.BaseReportColumns.find(c=>95==c.CDGDO.CategoryValue||103==c.CDGDO.CategoryValue||104==c.CDGDO.CategoryValue||129==c.CDGDO.CategoryValue);D&&95==D.CDGDO.CategoryValue?(m=this.Entities.Contract,n=this.Entities.Contract+".ContractID"):D&&129==D.CDGDO.CategoryValue&&(m=this.Entities["Unit Reservation"],n=this.Entities["Unit Reservation"]+".QuotationID");let h=0;if(null!=t.Formula&&t.Formula.startsWith("LEVEL")&&(h=C.J0.Int(t.Formula.substr(5)),this.IsNewFromClause&&(this.FromTagExtra.Contains("COM_ApprovalSummary")||(this.FromTagExtra+=" left join COM_ApprovalSummary WFT on WFT.DocID="+n,0!=e.DocID&&-1!=e.DocID&&-2!=e.DocID&&(this.FromTagExtra+=" and WFT.CCID="+Math.abs(e.DocID)),400==t.CategoryValue&&(this.FromTagExtra+=this.IsInventory?" and (WFT.InvDocDetailsID=0 OR WFT.InvDocDetailsID="+m+".InvDocDetailsID)":" and (WFT.InvDocDetailsID=0 OR WFT.InvDocDetailsID="+m+".AccDocDetailsID)")),11378==t.FieldValue&&!this.FromTagExtra.Contains("WFTU"+h+" ")&&(this.FromTagExtra+=" left join ADM_Users WFTU"+h+" with(nolock) on WFT.L"+h+"UserID=WFTU"+h+".UserID "))),11377==t.FieldValue)return null!=t.Formula&&t.Formula.startsWith("LEVEL")?this.IsNewFromClause?"convert(datetime,floor(WFT.L"+h+"CreatedDate))":"(select convert(DATETIME,CreatedDate) from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID from COM_Approvals with(nolock) \nwhere (StatusID=441 or StatusID=369"+(1==h?" or StatusID=371":"")+") and RowType=1 and ccid="+m+".costcenterid and ccnodeid="+n+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+m+".InvDocDetailsID)":"")+" and WorkFlowLevel="+h+" order by ApprovalID desc))":"(select convert(datetime,CreatedDate) from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and ccid="+m+".costcenterid and ccnodeid="+n+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+m+".InvDocDetailsID)":"")+" order by ApprovalID desc))";if(11378==t.FieldValue)return null!=t.Formula&&t.Formula.startsWith("LEVEL")?this.IsNewFromClause?"WFTU"+h+"."+t.Column:"(select U."+t.Column+" from COM_Approvals A with(nolock) \ninner join ADM_Users U with(nolock) on A.UserID=U.UserID \nwhere A.ApprovalID IN (select top 1 ApprovalID from COM_Approvals with(nolock) \nwhere (StatusID=441 or StatusID=369"+(1==h?" or StatusID=371":"")+") and RowType=1 and ccid="+m+".costcenterid and ccnodeid="+n+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+m+".InvDocDetailsID)":"")+" and WorkFlowLevel="+h+" order by ApprovalID desc))":"(select CreatedBy from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and ccid="+m+".costcenterid and ccnodeid="+n+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+m+".InvDocDetailsID)":"")+" order by ApprovalID desc))";if(11379==t.FieldValue)return null!=t.Formula&&t.Formula.startsWith("LEVEL")?this.IsNewFromClause?"WFT.L"+h+"Remarks":"(select Remarks from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID from COM_Approvals with(nolock) \nwhere (StatusID=441 or StatusID=369"+(1==h?" or StatusID=371":"")+") and RowType=1 and ccid="+m+".costcenterid and ccnodeid="+n+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+m+".InvDocDetailsID)":"")+" and WorkFlowLevel="+h+" order by ApprovalID desc))":"(select Remarks from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and ccid="+m+".costcenterid and ccnodeid="+n+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+m+".InvDocDetailsID)":"")+" order by ApprovalID desc))";if(11380==t.FieldValue)return null!=t.Formula&&t.Formula.startsWith("LEVEL")?this.IsNewFromClause?"WFT.L"+h+"Status":"(select S.Status from COM_Approvals A with(nolock) \ninner join COM_Status S with(nolock) on A.StatusID=S.StatusID \nwhere A.ApprovalID IN (select top 1 ApprovalID from COM_Approvals with(nolock) \nwhere (StatusID=441 or StatusID=369"+(1==h?" or StatusID=371":"")+") and RowType=1 and ccid="+m+".costcenterid and ccnodeid="+n+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+m+".InvDocDetailsID)":"")+" and WorkFlowLevel="+h+" order by ApprovalID desc))":"(SELECT Status FROM COM_Status with(nolock) WHERE StatusID IN (select statusid from COM_Approvals with(nolock) where ApprovalID IN (select top 1 ApprovalID\nfrom COM_Approvals with(nolock) where RowType=1 and ccid="+m+".costcenterid and ccnodeid="+n+(400==t.CategoryValue?" AND (DocDetID=0 OR DocDetID="+m+".InvDocDetailsID)":"")+" order by ApprovalID desc)))"}else{if(11666==t.FieldValue)return"(select top 1 ReviseReason from "+(this.IsInventory?"INV_DocDetails":"ACC_DocDetails")+"_History with(nolock) where VoucherNo="+m+".VoucherNo and ReviseReason is not null)";if(11381==t.FieldValue)return"CASE WHEN (SELECT COUNT(*) FROM COM_CCSchedules WITH(NOLOCK) WHERE CostCenterID="+m+".CostCenterID AND NodeID="+m+".DocID)>0 THEN 'YES' ELSE 'NO' END";if(11692==t.FieldValue)return"(select Status from CRM_Activities ACT with(nolock) join COM_Status S on S.StatusID=ACT.StatusID and ActivityID=(select max(ActivityID) from CRM_Activities ACT with(nolock) where ACT.CostCenterID="+m+".CostCenterID and ACT.NodeID="+m+".DocID))";if(!(95!=t.CategoryValue&&103!=t.CategoryValue&&104!=t.CategoryValue&&129!=t.CategoryValue||"RentAmount"!=t.Column&&"DiscountAmount"!=t.Column&&"Discount"!=t.Column))return 103==t.CategoryValue||129==t.CategoryValue?"isnull((select "+t.Column+" from "+t.Table+" with(nolock) where QuotationID=T0.QuotationID and Sno=1),0)":"isnull((select "+t.Column+" from "+t.Table+" with(nolock) where CONTRACTID=T0.CONTRACTID and Sno=1),0)";if(101==t.CategoryValue){if(""==t.Column)return this.IsBudgetFound=!0,"0.0"}else if("RefNO"==t.Column){if(Math.abs(e.DocID)>4e4&&Math.abs(e.DocID)<5e4&&e.IsInventory)return"(SELECT TOP 1 VoucherNo FROM INV_DocDetails Ref WITH(NOLOCK) WHERE Ref.InvDocDetailsID=INV.LinkedInvDocDetailsID)"}else if("HistoryStatus"==t.Column||-606==t.FieldValue)this.strHistorySepChar=11375==t.FieldValue||11490==t.FieldValue||50051==t.CategoryValue||409==t.CategoryValue||95==t.CategoryValue||t.CategoryValue>=251&&t.CategoryValue<=255||-606==t.FieldValue?"_":"",this.IsHistory=!0,this.iHistoryStatusID=t.FieldValue,!C.J0.IsEmpty(k.HistoryTables)&&k.HistoryTables.keys.Contains(this.iHistoryStatusID)&&t.CategoryValue>=50009&&k.HistoryTables.push(this.iHistoryStatusID,["COM_CC"+t.CategoryValue,"COM_CCCCDATA"]),11490==t.FieldValue&&(this.IsRevision=!0);else{if(11406==t.FieldValue)return"0.0";if(11408==t.FieldValue||t.FieldValue>=11485&&t.FieldValue<=11489)return"0.0";if("LATEST"==t.Formula){if(e.DocID>4e4&&e.DocID<5e4&&e.IsInventory&&0==t.IsForeignKey)return"DocDate"==t.Column?"(select TOP 1 CONVERT(DATETIME,A.DocDate) from inv_docdetails A with(nolock) where A.productid=INV.productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc)":"(select TOP 1 "+t.Column+" from inv_docdetails A with(nolock) where A.productid=INV.productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc)"}else if("OLDEST"==t.Formula){if(e.DocID>4e4&&e.DocID<5e4&&e.IsInventory&&0==t.IsForeignKey)return"DocDate"==t.Column?"(select TOP 1 CONVERT(DATETIME,A.DocDate) from inv_docdetails A with(nolock) where A.productid=INV.productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc)":"(select TOP 1 "+t.Column+" from inv_docdetails A with(nolock) where A.productid=INV.productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc)"}else{if("H"==t.Formula){if((A=this.Filter.Fields.find(n=>"DATE"==n.CDGDO.DataType))&&t.IsForeignKey){let n=t.CategoryText.split(".")[0];if(this.Entities.ContainsKey(n)){let h=t.ColumnCostCenterID;return 25472==t.FieldValue?h=1:25467==t.FieldValue&&(h=2),this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(c=>c.FeatureID==t.CategoryValue),"(select top 1 HDD."+t.Column+" from COM_HistoryDetails HD left join "+t.ParentCostCenterSysName+" HDD with(nolock) on HD.HistoryNodeID=HDD.NodeID\nwhere HD.costcenterid="+t.CategoryValue+" and HD.NodeID="+this.Entities[n]+"."+this.drrCCTbl[0].PK.toString()+" and HD.HistoryCCID="+h+"\nand FromDate<=convert(float,convert(datetime,'"+A.ToDatePicker.Date.ToString("dd MMM yyyy")+"')) order by FromDate desc)"}}return"#"}if(44==t.ColumnCostCenterID||44==t.LocalReference){let n;if(0==e.DocID?n="CRM_CONTACTS"==t.Table.toUpperCase()||t.Table.endsWith("Extended")?t.CategoryText+t.Table:t.CategoryText:(n=t.CategoryText+t.Table,this.Entities.ContainsKey(n)||(n=t.CategoryText)),this.Entities.ContainsKey(n)){t.ActualTable=this.Entities[n]+"."+t.Column;let h=this.Entities[n]+"."+t.Column;return"case when "+h+" is not null and isnumeric("+h+")=1 then (select TOP 1 Name from COM_Lookup L with(nolock) where L.NodeID="+h+") else '' end"}}else{if(t.FieldValue>=93&&t.FieldValue<=99||169==t.FieldValue||11649==t.FieldValue||11650==t.FieldValue||11651==t.FieldValue||11665==t.FieldValue){var A=this.Filter.Fields.find(h=>169==h.CDGDO.FieldValue);if(this.Entities.ContainsKey("Asset Management")){if(94==t.FieldValue)return"(select sum(convert(float,ChangeValue)) from ACC_AssetChanges DP with(nolock) where DP.ChangeType=0 and DP.AssetID="+this.Entities["Asset Management"]+".AssetID)";if(93==t.FieldValue)return"(select sum(convert(float,Amount)) from ACC_AssetsHistory DP with(nolock) where DP.AssetManagementID="+this.Entities["Asset Management"]+".AssetID)";if(11649==t.FieldValue)return"stuff((select ','+convert(nvarchar, convert(datetime,Date),106) from ACC_AssetsHistory with(nolock) where AssetManagementID="+this.Entities["Asset Management"]+".AssetID order by HistoryID FOR XML PATH('')), 1,1,'')";if(11650==t.FieldValue)return"stuff((select ','+VoucherNo from ACC_AssetsHistory with(nolock) where AssetManagementID="+this.Entities["Asset Management"]+".AssetID order by HistoryID FOR XML PATH('')), 1,1,'')";if(11651==t.FieldValue)return"stuff((select ','+(case PolicyType when 1 then 'Dispose Full' when 2 then 'Sale Partial' when 3 then 'Sale Full' else 'Dispose Partial' end) from ACC_AssetsHistory with(nolock) where AssetManagementID="+this.Entities["Asset Management"]+".AssetID order by HistoryID FOR XML PATH('')), 1,1,'')";if(11665==t.FieldValue)return null!=A?"(select top 1 case when PolicyType=1 then 'Dispose Full' when PolicyType=2 then 'Sale Partial' when PolicyType=3 then 'Sale Full' when PolicyType IS NULL THEN '' else 'Dispose Partial' end from ACC_AssetsHistory with(nolock) where AssetManagementID="+this.Entities["Asset Management"]+".AssetID and [Date]<=convert(float,convert(datetime,'"+A.ToDatePicker.Date.ToString("dd MMM yyyy")+"')) order by Date desc)":"(select top 1 case when PolicyType=1 then 'Dispose Full' when PolicyType=2 then 'Sale Partial' when PolicyType=3 then 'Sale Full' when PolicyType IS NULL THEN '' else 'Dispose Partial' end from ACC_AssetsHistory with(nolock) where AssetManagementID="+this.Entities["Asset Management"]+".AssetID order by Date desc)";if(null!=A)if(99==t.FieldValue||98==t.FieldValue||97==t.FieldValue){let h="";if(C.J0.IsEmpty(t.DimensionsFilter)){if(99==t.FieldValue)return"(select sum(DepAmount) from ACC_AssetDepSchedule DP with(nolock) where DP.AssetID="+this.Entities["Asset Management"]+".AssetID and DP.DeprEndDate<=convert(float,convert(datetime,'"+A.ToDatePicker.Date.ToString("dd MMM yyyy")+"')))";if(98==t.FieldValue)return"(select sum(DepAmount) from ACC_AssetDepSchedule DP with(nolock) where DP.AssetID="+this.Entities["Asset Management"]+".AssetID and DP.DeprEndDate<convert(float,convert(datetime,'"+A.FromDatePicker.Date.ToString("dd MMM yyyy")+"')))";if(97==t.FieldValue)return"(select sum(DepAmount) from ACC_AssetDepSchedule DP with(nolock) where DP.AssetID="+this.Entities["Asset Management"]+".AssetID  and DP.DeprEndDate>=convert(float,convert(datetime,'"+A.FromDatePicker.Date.ToString("dd MMM yyyy")+"'))  and DP.DeprEndDate<=convert(float,convert(datetime,'"+A.ToDatePicker.Date.ToString("dd MMM yyyy")+"')))"}else{let c;if(t.DimensionsFilter.split(",").forEach(F=>{c=this.GetDimensionFilter(parseInt(F)),c.length>0&&(h+=" AND DCC.dcCCNID"+(parseInt(F)-5e4)+" in ("+c+")")}),c=" join ACC_DocDetails D with(nolock) on D.DocID=DP.DocID join COM_DocCCDATA DCC with(nolock) on D.AccDocDetailsID=DCC.AccDocDetailsID",h=" and D.DebitAccount>0"+h,99==t.FieldValue)return"(select sum(D.Amount) from ACC_AssetDepSchedule DP with(nolock)"+c+" where DP.AssetID="+this.Entities["Asset Management"]+".AssetID"+h+" and DP.DeprEndDate<=convert(float,convert(datetime,'"+A.ToDatePicker.Date.ToString("dd MMM yyyy")+"')))";if(98==t.FieldValue)return"(select sum(D.Amount) from ACC_AssetDepSchedule DP with(nolock)"+c+" where DP.AssetID="+this.Entities["Asset Management"]+".AssetID"+h+" and DP.DeprEndDate<convert(float,convert(datetime,'"+A.FromDatePicker.Date.ToString("dd MMM yyyy")+"')))";if(97==t.FieldValue)return"(select sum(D.Amount) from ACC_AssetDepSchedule DP with(nolock)"+c+" where DP.AssetID="+this.Entities["Asset Management"]+".AssetID"+h+"  and DP.DeprEndDate>=convert(float,convert(datetime,'"+A.FromDatePicker.Date.ToString("dd MMM yyyy")+"'))  and DP.DeprEndDate<=convert(float,convert(datetime,'"+A.ToDatePicker.Date.ToString("dd MMM yyyy")+"')))"}}else{if(96==t.FieldValue)return"(select sum(convert(float,ChangeValue)) from ACC_AssetChanges DP with(nolock) where DP.ChangeType=0 and DP.AssetID="+this.Entities["Asset Management"]+".AssetID and DP.ChangeDate>=convert(float,convert(datetime,'"+A.FromDatePicker.Date.ToString("dd MMM yyyy")+"'))  and DP.ChangeDate<=convert(float,convert(datetime,'"+A.ToDatePicker.Date.ToString("dd MMM yyyy")+"')))";if(95==t.FieldValue)return"(select sum(convert(float,ChangeValue)) from ACC_AssetChanges DP with(nolock) where DP.ChangeType=5 and DP.AssetID="+this.Entities["Asset Management"]+".AssetID and DP.ChangeDate>=convert(float,convert(datetime,'"+A.FromDatePicker.Date.ToString("dd MMM yyyy")+"'))  and DP.ChangeDate<=convert(float,convert(datetime,'"+A.ToDatePicker.Date.ToString("dd MMM yyyy")+"')))"}}return"NULL"}if(11396==t.FieldValue||11396==t.ParentCCDefaultColID||11689==t.FieldValue||11689==t.ParentCCDefaultColID){let n="";if(12==this.StaticReportType)n="Account";else if(this.Entities.ContainsKey(t.CategoryText))n=t.CategoryText;else for(let h=0;h<this.Objects.length;h++)if("acc_accounts"==C.J0.LowerCase(this.Objects[h].Table)){n=this.Entities.keys[h];break}if(C.J0.IsEmpty(n))return"0";{let u,L,h=!1,c="",F="";if(u=this.GetDimensionFilterForStock("DCC.dcCCNID"),u.length>0&&(F=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK)  ON DCC.AccDocDetailsID=ACC.AccDocDetailsID"),11689==t.FieldValue||11689==t.ParentCCDefaultColID?(h=!0,u+=" AND (ACC.StatusID=370 or ACC.StatusID=439)"):(0==this.UnPostedDocsList.length?c=" AND (ACC.StatusID=369 or ACC.StatusID=429)":c+=" AND ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")",u+=this.PDCInclude?" AND (ACC.StatusID=370 OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+c+"))":" AND ACC.DocumentType<>14 AND ACC.DocumentType<>19"+c),L=this.Filter.Fields.find(11396==t.FieldValue||11396==t.ParentCCDefaultColID?g=>101==g.CDGDO.FieldValue:g=>101==g.CDGDO.FieldValue||23145==g.CDGDO.FieldValue),L)if(u+=" AND CONVERT(DATETIME,ACC.DocDate)","Between"==L.Condition.SelectedValue||"NotBetween"==L.Condition.SelectedValue)u+=L.Condition.SelectedItem.Parent,u+="'"+L.FromDatePicker.Date.ToString("dd MMM yyyy")+"' AND ",u+="'"+L.ToDatePicker.Date.ToString("dd MMM yyyy")+"'";else if("FUTURE"==L.Condition.SelectedValue||"PAST"==L.Condition.SelectedValue){let g=C.J0.Int(L.FromValue.TextBox.Text);0==g&&(g=1),u+=" BETWEEN ","FUTURE"==L.Condition.SelectedValue?(u+="'"+Date.Today().ToString("dd MMM yyyy")+"' AND ",u+="'"+Date.Today().AddDays(g).ToString("dd MMM yyyy")+"'"):(u+="'"+Date.Today().AddDays(-g).ToString("dd MMM yyyy")+"' AND ",u+="'"+Date.Today().ToString("dd MMM yyyy")+"'")}else u+=L.Condition.SelectedItem.Parent,u+="'"+L.FromDatePicker.Date.ToString("dd MMM yyyy")+"'";else null!=this.oReportDialog&&(this.oReportDialog.FromDate.Visible||this.oReportDialog.ToDate.Visible)&&(u+=" AND ACC.DocDate",this.oReportDialog.FromDate.Visible&&(u+=">=CONVERT(float,CONVERT(DATETIME,'"+this.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))"),this.oReportDialog.ToDate.Visible&&(u+="<=CONVERT(float,CONVERT(DATETIME,'"+this.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))"));let R="(ISNULL((select SUM(Amount) FROM ACC_DocDetails ACC with(nolock)"+F+" WHERE ACC.DebitAccount="+this.Entities[n]+".AccountID"+u+"),0)";return F.length>0&&!h&&(R+="+ISNULL((select SUM(Amount) FROM ACC_DocDetails ACC with(nolock) INNER JOIN COM_DocCCData DCC WITH(NOLOCK)  ON DCC.InvDocDetailsID=ACC.InvDocDetailsID WHERE ACC.DebitAccount="+this.Entities[n]+".AccountID"+u+"),0)"),R+="-( ISNULL((select SUM(Amount) FROM ACC_DocDetails ACC with(nolock)"+F+"\nWHERE ACC.CreditAccount="+this.Entities[n]+".AccountID"+u+"),0)",F.length>0&&!h&&(R+="+ISNULL((select SUM(Amount) FROM ACC_DocDetails ACC with(nolock) INNER JOIN COM_DocCCData DCC WITH(NOLOCK)  ON DCC.InvDocDetailsID=ACC.InvDocDetailsID\nWHERE ACC.CreditAccount="+this.Entities[n]+".AccountID"+u+"),0)"),R+=")",R+=")",R}}if(101==t.FieldValue)return"NULL";if(8==t.ParentCostCenterID)try{let h,n=t.CategoryValue;this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(u=>u.FeatureID==n),h=t.AssignedDimID>0&&this.Entities.ContainsKey("Documents_CCMAP")?this.Entities.Documents_CCMAP+".dcCCNID"+(t.CategoryValue-5e4):this.Entities[t.CategoryText.substr(0,t.CategoryText.lastIndexOf("."))]+"."+this.drrCCTbl[0].PK.toString();let c=t.AssignedDimID>0?t.AssignedDimID:t.ParentCCDefaultColID;return this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(u=>u.FeatureID==c),"dbo.fnRPT_AssignedData("+n+","+h+","+c+",'"+this.drrCCTbl[0].TableName.toString()+"')"}catch(n){return Logger.ErrorLog("Assigned: "+n.stack),"#"}else if(25144==t.FieldValue||25144==t.ParentCCDefaultColID)try{return"dbo. fnGet_GetAssignedListForActivity("+this.Entities[t.CategoryText]+".ActivityID,0)"}catch{return"#"}else if(24246==t.FieldValue||25534==t.FieldValue||27252==t.FieldValue||27292==t.FieldValue)try{return this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(n=>n.FeatureID==t.CategoryValue),"dbo.fnGet_GetAssignedListForFeatures("+t.CategoryValue+","+this.Entities[t.CategoryText]+"."+this.drrCCTbl[0].PK.toString()+")  "}catch{return"#"}else if(24246==t.ParentCCDefaultColID||25534==t.ParentCCDefaultColID||27252==t.ParentCCDefaultColID||27292==t.ParentCCDefaultColID)try{return this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(n=>n.FeatureID==t.ColumnCostCenterID),"dbo.fnGet_GetAssignedListForFeatures("+t.ColumnCostCenterID+","+this.Entities[t.CategoryText]+"."+this.drrCCTbl[0].PK.toString()+")  "}catch{return"#"}}}}}return""}IgnoreObject(t,e){return!(!(this.IgnoreObjectsForFields.Contains(e.FieldValue)||this.IgnoreObjectsForFields.Contains(e.ParentCCDefaultColID)||8==e.ParentCostCenterID||null!=e.ChildCDGDO&&8==e.ChildCDGDO.ParentCostCenterID||0==e.CategoryValue&&0==e.FieldValue)&&(205!=e.FieldValue&&206!=e.FieldValue&&207!=e.FieldValue||t.ShowAccountingData)&&(95!=e.CategoryValue&&103!=e.CategoryValue&&104!=e.CategoryValue&&129!=e.CategoryValue||"RentAmount"!=e.Column&&"DiscountAmount"!=e.Column&&"Discount"!=e.Column))}GetSpecialChar(t){return t.length>0&&(t.Contains("&amp;")&&(t=t.Replace("&amp;","&")),t.Contains("&gt;")&&(t=t.Replace("&gt;",">")),t.Contains("&lt;")&&(t=t.Replace("&lt;","<")),t.Contains("&quot;")&&(t=t.Replace("&quot;",'"')),t.Contains("&apos;")&&(t=t.Replace("&apos;","'"))),t}ParseFormula(t,e){let m;if(t.FormulaErrorMessage="",188==t.CDGDO.FieldValue)return void(t.FormulaExpression="");let o=new U.PE;o.SetKeyWords("REPORT");let r=[];if(e){if(m=t.Formula.Text,k.IgnoreFormulas.Contains(m))return void(t.FormulaExpression="")}else m=t.Expression.Text;m=this.GetSpecialChar(m),o.ParseFormula(m,r);let D,M="",T=!1,A=null;for(let n=r.length-1;n>=0;n--){let h=r[n];D=h.getTokenValue().toString(),h.getTokenClass()!=U.C3.OPERAND||null==A||A.getTokenClass()!=U.C3.OPERAND?A=h:(A.SetAll("USERDEF",A.getTokenID(),U.C3.OPERAND,U.Wz.REFERENCE,h.tokenValue.toString()+A.tokenValue.toString()),r.RemoveAt(n))}for(let n=0;n<r.length;n++){T=!1;let c=r[n];if(D=c.getTokenValue().toString(),c.getTokenClass()==U.C3.OPERAND&&c.getTokenType()==U.Wz.REFERENCE){for(let u=0;u<this.BaseReportColumns.length;u++){let F=this.BaseReportColumns[u];if((!e||F!=t)&&0==C.J0.stringCompare(F.Caption.Text.Replace(" ",""),D,!0)){T=!0,D=F.ID;break}}if(!T){for(let u=0;u<this.ReportGroups.length;u++){let F=this.ReportGroups[u];if(!C.J0.IsEmpty(F.Prefix.Text)&&(F!=t||t.ID.length<33)&&0==C.J0.stringCompare(F.Prefix.Text.Replace(" ",""),D,!0)){T=!0,D=F.ID;break}}if(!T&&this.FieldsViewColumns.Contains("FormulaColumn")&&(this.FieldsDialog.RefreshFieldsData_2(this.FieldsViewTbl,t.CDGDO.CategoryValue),this.FieldsView=this.FieldsViewTbl.filter(u=>u.CostCenterID==t.CDGDO.CategoryValue&&u.FormulaColumn==D),this.FieldsView.length>0)){let F,u=new te.ir;for(this.FieldsDialog.SetCDGDO_3(u,this.FieldsView[0],C.J0.String(this.FieldsView[0].ParentCCDefaultColID)),F=0;F<this.FormulaObjects.length&&(this.FormulaObjects[F].CategoryValue!=u.CategoryValue||this.FormulaObjects[F].FieldValue!=u.FieldValue);F++);F==this.FormulaObjects.length&&this.FormulaObjects.push(u),D="F"+F}}}"45"==c.getTokenName()||"STRING"===c.getTokenName()?M+='"'+D+'"':(c.getTokenType()==U.Wz.KEYWORD&&(M+=" "),M+=D,c.getTokenType()==U.Wz.KEYWORD&&(M+=" "))}if(e){if(t.FormulaExpression=M,t.FormulaExpression.startsWith("LEVEL")&&(t.CDGDO.FieldValue>=11377&&t.CDGDO.FieldValue<=11380||182==t.CDGDO.FieldValue))return void(t.FormulaExpression="");this.IsAuthLevelReport||(t.FormulaExpression.startsWith("LEVEL")?C.J0.IsNum(t.FormulaExpression.substr(5))&&(this.IsAuthLevelReport=!0):this.CheckFormula(M,t.Formula.Text,t))}else t.ColumnFilterExpression=M,this.CheckFormula(M,this.GetSpecialChar(t.Expression.Text),t)}CheckFormula(t,e,m){if("AddEditReportViewModel"!=this.ClassName||0==C.J0.stringCompare(t,"SNO",!0)||0==C.J0.stringCompare(t,"LATEST",!0)||0==C.J0.stringCompare(t,"OLDEST",!0)||0==C.J0.stringCompare(t,"$TOTALHOURS$",!0)||"H"==t||t.startsWith("$")&&t.endsWith("$"))return;let o;null==this.evalCheck&&(this.evalCheck=new U.PE,this.evalCheck.SetKeyWords("REPORT")),null==this.fldCheck&&(this.fldCheck=new q.bT,this.BaseReportColumns.forEach(r=>{this.fldCheck.ContainsKey(r.ID)||(o=new U.Nl(r.ID,""),this.fldCheck.push(r.ID,o))}),this.ReportGroups.forEach(r=>{this.fldCheck.ContainsKey(r.ID)||(o=new U.Nl(r.ID,""),this.fldCheck.push(r.ID,o))}),o=new U.Nl("FROMDATE",""),this.fldCheck.push("FROMDATE",o),o=new U.Nl("TODATE",""),this.fldCheck.push("TODATE",o),o=new U.Nl("SYSTEMDATE",""),this.fldCheck.push("SYSTEMDATE",o),o=new U.Nl("SYSTEMDATETIME",""),this.fldCheck.push("SYSTEMDATETIME",o),o=new U.Nl("CURRENT_YEARSTART",""),this.fldCheck.push("CURRENT_YEARSTART",o),o=new U.Nl("PRV_YEARSTART",""),this.fldCheck.push("PRV_YEARSTART",o),o=new U.Nl("PRV_YEARFROMDATE",""),this.fldCheck.push("PRV_YEARFROMDATE",o),o=new U.Nl("PRV_YEARTODATE",""),this.fldCheck.push("PRV_YEARTODATE",o),this.fldCheck.push("CURRENT_MONTHSTART",new U.Nl("CURRENT_MONTHSTART","")),this.fldCheck.push("PRV_MONTHSTART",new U.Nl("PRV_MONTHSTART","")),this.fldCheck.push("PRV_MONTHEND",new U.Nl("PRV_MONTHEND","")),o=new U.Nl("LOGIN_USER",""),this.fldCheck.push("LOGIN_USER",o),97==this.StaticReportType?this.fldCheck.ContainsKey("BudgetBalance")||(o=new U.Nl("BudgetBalance","0"),this.fldCheck.push("BudgetBalance",o)):9==this.StaticReportType||10==this.StaticReportType?this.fldCheck.ContainsKey("Adjusted")||(o=new U.Nl("Adjusted","0"),this.fldCheck.push("Adjusted",o)):(112==this.StaticReportType||165==this.StaticReportType)&&(this.fldCheck.ContainsKey("SalesQty1")||(o=new U.Nl("SalesQty1","0"),this.fldCheck.push("SalesQty1",o)),this.fldCheck.ContainsKey("SalesQty2")||(o=new U.Nl("SalesQty2","0"),this.fldCheck.push("SalesQty2",o)),this.fldCheck.ContainsKey("SalesQty3")||(o=new U.Nl("SalesQty3","0"),this.fldCheck.push("SalesQty3",o)),this.fldCheck.ContainsKey("BEx0")||(o=new U.Nl("BEx0","0"),this.fldCheck.push("BEx0",o)),this.fldCheck.ContainsKey("BEx1")||(o=new U.Nl("BEx1","0"),this.fldCheck.push("BEx1",o)),this.fldCheck.ContainsKey("BEx2")||(o=new U.Nl("BEx2","0"),this.fldCheck.push("BEx2",o))));for(let r=0;r<this.FormulaObjects.length;r++)this.fldCheck.ContainsKey("F"+r)||(o=new U.Nl("F"+r,""),this.fldCheck.push("F"+r,o));this.fldCheck.keys.forEach(r=>{var M_Key=r,T=this.BaseReportColumns.find(D=>D.ID==M_Key);if(null==!T&&this.ReportGroups.find(D=>D.ID==M_Key),T)switch(T.CDGDO.DataType){case"INT":case"FLOAT":this.fldCheck[M_Key].setFieldValue(1);break;case"DATE":case"DATETIME":this.fldCheck[M_Key].setFieldValue(Date.Today());break;default:this.fldCheck[M_Key].setFieldValue("")}}),this.fldCheck.FROMDATE.setFieldValue(Date.Today().AddDays(-1)),this.fldCheck.TODATE.setFieldValue(Date.Today()),this.fldCheck.SYSTEMDATE.setFieldValue(Date.Today().AddDays(1)),this.fldCheck.SYSTEMDATETIME.setFieldValue(Date.Today()),this.fldCheck.CURRENT_YEARSTART.setFieldValue(Date.Today()),this.fldCheck.PRV_YEARSTART.setFieldValue(Date.Today()),this.fldCheck.PRV_YEARFROMDATE.setFieldValue(Date.Today()),this.fldCheck.PRV_YEARTODATE.setFieldValue(Date.Today()),this.fldCheck.LOGIN_USER.setFieldValue(N.d.SessionManager.UserName);try{N.d.eval.EvaluateExpression(t,this.fldCheck)}catch{m.FormulaErrorMessage=C.J0.IsEmpty(m.Caption.Text)?'Invalid Formula "'+e+'". ':'Invalid formula "'+e+'" at "'+m.Caption.Text+'".'}}static IsGroupTree(t){return(2==t.CostCenterID||3==t.CostCenterID||t.CostCenterID>5e4)&&(t.SelectedNodes.filter(e=>e.IsGroup).length>0||!(""==N.d.SessionManager.Preferences.DynamicTrees||!N.d.SessionManager.Preferences.DynamicTrees.split(",").Contains(t.CostCenterID.toString())))}GetVoucherNoHideBiddingPrice(){this.strHideBiddingPriceVoucher="";let t=N.d.report.DataSet("RPT061","");if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)for(let e=0;e<t.Tables[0].length;e++)this.strHideBiddingPriceVoucher=this.strHideBiddingPriceVoucher.length>0?this.strHideBiddingPriceVoucher+",'"+C.J0.String(t.Tables[0][e].VoucherNo)+"'":"'"+C.J0.String(t.Tables[0][e].VoucherNo)+"'"}GetTextField_AllDocuments(t,e){return N.d.report.DataSet("RPT035",Math.abs(t).toString(),e)}GetLatestOldestQuery(t,e,m){if(0==C.J0.stringCompare(t.Formula,"LATEST",!0)){if(0==t.IsForeignKey)return 0==C.J0.stringCompare(t.DataType,"DATE",!0)?"(select TOP 1 CONVERT(DATETIME,A."+t.Column+" ) from inv_docdetails A with(nolock) @CCWHERE@ where A.productid="+e+".productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc)":t.Column.startsWith("dcCalcNum")||t.Column.startsWith("dcNum")?"(select TOP 1 N."+t.Column+" from inv_docdetails A with(nolock) inner join COM_DocNumData N with(nolock) on N.invdocdetailsid=A.invdocdetailsid @CCWHERE@ where A.productid="+e+".productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc)":"(select TOP 1 A."+t.Column+" from inv_docdetails A with(nolock) @CCWHERE@ where A.productid="+e+".productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc)";if(2==t.ParentCostCenterID)return"(select top 1 "+t.Column+" from ACC_Accounts with(nolock) where AccountID=(select TOP 1 A."+t.ParentColumn+" from inv_docdetails A with(nolock) @CCWHERE@\nwhere A.productid="+e+".productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate desc,A.CreatedDate desc))"}else if(0==C.J0.stringCompare(t.Formula,"OLDEST",!0)){if(0==t.IsForeignKey)return 0==C.J0.stringCompare(t.DataType,"DATE",!0)?"(select TOP 1 CONVERT(DATETIME,A."+t.Column+" ) from inv_docdetails A with(nolock) @CCWHERE@ where A.productid="+e+".productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc)":t.Column.startsWith("dcCalcNum")||t.Column.startsWith("dcNum")?"(select TOP 1 N."+t.Column+" from inv_docdetails A with(nolock) inner join COM_DocNumData N with(nolock) on N.invdocdetailsid=A.invdocdetailsid @CCWHERE@ where A.productid="+e+".productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc)":"(select TOP 1 A."+t.Column+" from inv_docdetails A with(nolock) @CCWHERE@ where A.productid="+e+".productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc)";if(2==t.ParentCostCenterID)return"(select top 1 "+t.Column+" from ACC_Accounts with(nolock) where AccountID=(select TOP 1 A."+t.ParentColumn+" from inv_docdetails A with(nolock) @CCWHERE@\nwhere A.productid="+e+".productID AND A.costcenterid="+t.CategoryValue+" order by A.DocDate asc,A.CreatedDate asc))"}return"NULL"}GetDimensionFilterForStock(t){let e="",m=0;null!=this.oReportDialog&&(m=this.oReportDialog.StockDimensionID);let o="";return null!=this.oReportDialog&&this.oReportDialog.Locations.Visible&&null!=this.oReportDialog.LocationWhere&&(o=C.J0.IsEmpty(this.oReportDialog.LocationWhere)?"-1":this.oReportDialog.LocationWhere,e+=" AND "+t+(this.oReportDialog.StockDimensionID-5e4)+" IN ("+o+") "),(null!=this.oReportDialog?this.oReportDialog.CostCenterFilters:this.Filter.CostCenterFilters).forEach(M=>{if(M.CostCenterID>5e4&&(M.SelectedNodes.length>0||!M.DeleteButtonVisibility))if(M.SelectedNodes.length>0&&M.CostCenterID!=m)if(e+=" AND ",1==M.SelectedNodes.Count)e+=t+(M.CostCenterID-5e4)+"="+M.SelectedNodes[0].Id;else{e+=t+(M.CostCenterID-5e4)+" IN (";for(let T=0;T<M.SelectedNodes.length;T++)T>0&&(e+=","),e+=M.SelectedNodes[T].Id;e+=")"}else M.DeleteButtonVisibility||(e+=" AND "+t+(M.CostCenterID-5e4)+"=-12912")}),e}GetDimensionFilter(t){let e="";var o=(null!=this.oReportDialog?this.oReportDialog.CostCenterFilters:this.Filter.CostCenterFilters).find(r=>r.CostCenterID==t);if(!o)return"";if(o.SelectedNodes.length>0||!o.DeleteButtonVisibility)if(o.CostCenterID>5e4&&o.SelectedNodes.length>0)if(1==o.SelectedNodes.length)e+=o.SelectedNodes[0].Id;else for(let r=0;r<o.SelectedNodes.length;r++)r>0&&(e+=","),e+=o.SelectedNodes[r].Id;else o.DeleteButtonVisibility||(e+="-12912");return e}GetLink_IDColumn(t,e){if("3"==e.LinkType.SelectedValue||"4"==e.LinkType.SelectedValue){let m=e.CDGDO.IsForeignKey?e.CDGDO.ParentCostCenterID:e.CDGDO.CategoryValue;if(400!=m&&(m<4e4||m>5e4)&&"NULL"!=e.CDGDO.ActualColumn)return this.drrCCTbl=this.FieldsDialog.CostCenterTables.filter(o=>o.FeatureID==m),","+t+"."+this.drrCCTbl[0].PK.toString()+" AS ["+e.ID+"_ID]"}return""}SetExtFunctionParams(t,e){if("EF_FROMDATE"==t)if("ReportViewModel"==this.ClassName){let m=this;m.SetDatePickers(),e+="'"+m.FromDatePicker.Date.ToString("dd MMM yyyy")+"'"}else(112==this.StaticReportType||165==this.StaticReportType)&&(e+="'EF_FROMDATE'");else if("EF_TODATE"==t)if("ReportViewModel"==this.ClassName){let m=this;m.SetDatePickers(),e+="'"+m.ToDatePicker.Date.ToString("dd MMM yyyy")+"'"}else(112==this.StaticReportType||165==this.StaticReportType)&&(e+="'EF_TODATE'");else"EF_ASONDATE"==t?(112==this.StaticReportType||165==this.StaticReportType)&&(e+="'EF_ASONDATE'"):"EF_LoginLocationID"==t&&"ReportViewModel"==this.ClassName?e+=N.d.SessionManager.LocationID:"EF_LoginDivisionID"==t&&"ReportViewModel"==this.ClassName?e+=N.d.SessionManager.DivisionID:"EF_USERID"==t?e+=N.d.SessionManager.UserID:"EF_USERNAME"==t&&(e+="'"+N.d.SessionManager.UserName+"'");return e}GetAddressColumn(t){return t.startsWith("CCNID")&&(t="(select Name from "+C.J0.GetTagTableName(5e4+parseInt(t.substring(5)))+" with(nolock) where NodeID=A."+t+")"),t}}}}]);