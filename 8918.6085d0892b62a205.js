"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[8918],{88918:(R,u,o)=>{o.r(u),o.d(u,{QuickAddPropertyViewModel:()=>m});var l=o(32040),r=o(43767),d=o(54581),c=o(98580),h=o(84151),n=o(27730),_=o(85985),T=o(65922),D=o(20552),S=o(58170),p=o(82503),E=o(23458),P=o(13054),f=o(41264),g=o(41820);class m extends c.g{constructor(t,i,a,C,M){if(super(),this.PRT={},this.propertyid=0,this.parentid=0,this.selectedNode=0,this.group=!1,this.ds=null,this.Name=new h.Dw(25543),this.Code=new h.Dw(25542),this.Status=new n.y$(25544),this.Group=new n.y$(26394),this.RetValue=0,this.lstEventCtrls=[],this.oScreen=new _.ControlGenerator,this.parent=t,this.propertyid=i,this.parentid=a,this.selectedNode=M,this.group=C,this.oScreen.LoadScreen_2(this,92),null!=this.oScreen.QuickAddFields&&(this.oScreen.QuickAddFields=this.oScreen.QuickAddFields.filter(s=>s instanceof S.MI&&s.Visible).sort((s,y)=>s.Row-y.Row)),this.ds=l.d.rental.GetProperty(this.propertyid,0),this.oScreen.Data.Tables[3].forEach(s=>{this.Status.Items.push(n._p.ComboBoxItems_2(s.Status.toString(),s.StatusID.toString())),this.Status.SelectedValue="422"}),this.ds.Tables[0].length>0)for(let s=0;s<this.ds.Tables[0].length;s++)this.Group.Items.push(n._p.ComboBoxItems_2(this.ds.Tables[0][s].Name.toString(),this.ds.Tables[0][s].NodeID.toString()));let e;this.Group.SelectedValue=a.toString(),this.MessageVisibility=!1,0==this.group?0==this.propertyid?(this.Title=l.d.GetResource("RENTALSProperty_AddProperty"),this.AutoGenerateCode(),this.PRT.GUID="GUID"):(this.Title=l.d.GetResource("RENTALSProperty_EditProperty"),this.PRT.GUID=this.ds.Tables[2][0].GUID.toString(),this.Code.Text=r.J0.String(this.ds.Tables[2][0].Code),this.Name.Text=r.J0.String(this.ds.Tables[2][0].Name),this.Status.SelectedValue=r.J0.String(this.ds.Tables[2][0].StatusID),this.Group.SelectedValue=r.J0.String(this.ds.Tables[2][0].ParentID)):(this.Title=l.d.GetResource("CRMLead_AddGroup"),this.AutoGenerateCode(),this.PRT.GUID="GUID"),null!=this.parent&&this.parent.Refresh(),null!=this.Group&&this.lstEventCtrls.push(this.Group.DBColumnID);for(let s=0;s<this.oScreen.StaticFields.length;s++)e=this.oScreen.StaticFields[s],e&&null!=e.ToolTipFooterTitle&&null!=e.KeyTip&&!this.lstEventCtrls.Contains(e.DBColumnID)?this.SetControlEvent(e):this.propertyid>0&&e&&null!=e.ToolTipFooterTitle&&null!=e.KeyTip&&19==e.Mode&&this.OnGetExtFunctionData(e);if(null!=this.oScreen.HeaderFields)for(let s=0;s<this.oScreen.HeaderFields.length;s++)e=this.oScreen.HeaderFields[s],e&&null!=e.ToolTipFooterTitle&&null!=e.KeyTip&&!this.lstEventCtrls.Contains(e.DBColumnID)?this.SetControlEvent(e):this.propertyid>0&&e&&null!=e.ToolTipFooterTitle&&null!=e.KeyTip&&19==e.Mode&&this.OnGetExtFunctionData(e)}SetControlEvent(t){try{t instanceof h.Dw?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof n.y$?t.SelectionChangedCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof P.I||t instanceof h.L6?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof E.y$?t.OnPactListBoxValueChanged.Subscribe(this,"OnGetExtFunctionData"):(t instanceof p.Lc||t instanceof p.P6||t instanceof p.C_)&&t.SelectedDateChanged.Subscribe(this,"OnGetExtFunctionData"),this.propertyid>0&&19==t.Mode&&this.OnGetExtFunctionData(t)}catch{}}OnGetExtFunctionData(t){null!=t.ToolTipFooterTitle&&!r.J0.IsEmpty(t.KeyTip)&&"lostfocus"==t.KeyTip.toLowerCase()&&this.oScreen.ValidateExtData(t,null,!0)&&this.oScreen.GetExternalFuncData(t.Mode,this.propertyid,t.ToolTipFooterTitle,t.ToolTipFooterDescription,t.ToolTipDescription,null,null)}AutoGenerateCode(){let t=l.d.common.GetAutoSequence(92,"",92,l.d.SessionManager.CompanyIndex.toString()),i=this.oScreen.Data.Tables[4].filter(a=>"CodeAutoGen"==a.Name);i.length>0&&((0,d.yG0)(i[0].Value)?(this.Code.Enable=!1,this.Code.Mandatory=!1,0==this.PRT.PropertyID&&(this.Code.Text=t)):this.Code.Enable=!0),i=this.oScreen.Data.Tables[4].filter(a=>"CapsLock"==a.Name),i.length>0&&(0,d.yG0)(i[0].Value)&&(this.Name.IsAllCaps=!0),i=this.oScreen.Data.Tables[4].filter(a=>"CapsToFirstLetter"==a.Name),i.length>0&&(0,d.yG0)(i[0].Value)&&(this.Name.IsFirstLetterCaps=!0)}OnSave(t){if("Cancel"==t)this.parent.DetailsVisibility=!0,l.d.page.HideDialog(this.PopUpGUID);else if("ApproveMaster"==t.toString()){let i=new f.i(92,this.PRT.PropertyID,this.oScreen,this);l.d.page.ShowDialog(i,g.R,{ShowCenter:!0,Title:l.d.GetResource("ApproveReject")})}else if("Save"==t){Logger.InfoLog("SavePropertyViewModel:: OnSave");try{if(this.PRT.PropertyID=this.propertyid,null==this.Code.Text||""==this.Code.Text)return this.MessageVisibility=!0,void(this.DisplayMessage="Enter Code");if(this.PRT.Code=this.Code.Text,null==this.Name.Text||""==this.Name.Text)return this.MessageVisibility=!0,void(this.DisplayMessage="Enter Name");this.PRT.Name=this.Name.Text,this.PRT.StatusID=parseInt(this.Status.SelectedValue),this.PRT.SelectedNodeID=this.selectedNode,this.PRT.DetailsXML="",this.PRT.IsGroup=this.group,l.d.rental.SaveProperty(this.PRT,"SaveProperty").subscribe(a=>{this.DisplayMessage=a.Message,this.MessageVisibility=!0,this.RetValue=a.RetValue,this.RetValue>0&&(this.Name.Text="",this.Status.SelectedValue="1",null!=this.parent&&this.parent.Refresh(),this.AutoGenerateCode(),Logger.InfoLog("SavePropertyViewModel:: OnSave"))},a=>{console.log(" Unit Save : "+JSON.stringify(a))})}catch(i){Logger.ErrorLog("SavePropertyViewModel:: OnSave"+i.stack)}}else{l.d.page.HideDialog(this.PopUpGUID);let i=new T.AddEditPropertyViewModel(this.propertyid,this.parentid,this.group);l.d.page.addNewTab({title:i.Title,component:D.AddEditPropertyComponent,params:{obj:i}})}}}}}]);