"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[8208],{35827:(st,Q,_)=>{_.r(Q),_.d(Q,{ACC_TradingReports:()=>q,eTradingReportFormat:()=>A});var T=_(32040),o=_(43767),L=_(54581),X=_(76260),w=_(61488),k=_(26336),Z=_(39026),J=_(33784);class ${constructor(){this.Lft=0,this.Rgt=0}}var A=function(M){return M[M.Vertical=0]="Vertical",M[M.Horizontal=1]="Horizontal",M[M.Plain=2]="Plain",M}(A||{}),d=function(M){return M[M.None=0]="None",M[M.MonthWise=1]="MonthWise",M[M.QtrWise=4]="QtrWise",M[M.HalfYearWise=5]="HalfYearWise",M[M.YearWise=3]="YearWise",M[M.TagWise=2]="TagWise",M[M.CurrWise=6]="CurrWise",M[M.CompWise=7]="CompWise",M[M.DayWise=8]="DayWise",M}(d||{});class j{}class q extends X.A{constructor(e){super(e),this.Show=d.None,this.subShow=d.None,this.k=0,this.BalIndex=0,this.LevelNo=0,this.ReportTotalIndex=0,this.CountMonths=0,this.ForeignCurrencyID=0,this.CurrencyType=0,this.CellStartPos=0,this.GroupTotalIndex=0,this.YTDIndex=0,this.YTD_LYIndex=0,this.BAL_LYIndex=0,this.BAL_CLIndex=0,this.TotalBudgetIndex=1,this.StockLevelNo=0,this.VariancePercentIndex=1,this.SalesPercentIndex=1,this.NegNumber=4,this.ColumnSize=0,this.AccNameIndex=0,this.FirstTypeEndIndex=0,this.GrossCellIndex=0,this.ReportRowStartIndex=0,this.TagID=0,this.CADimension=0,this.Olddbl=0,this.dbl=0,this.dblTemp=0,this.dblCLTemp=0,this.exchRate=0,this.dblTotalSales=0,this.OldReportTotalMonthWise=null,this.lstTotal=null,this.lstParents=new Array,this.STACKROWS=new Array,this.lstParentCell=new Array,this.IsIncome=!1,this.IsIncomeNegative=!1,this.IncludeOpeningStock=!1,this.IncludeClosingStock=!1,this.ShowPrevMonthData=!1,this.ShowPrevMonthDiffData=!1,this.ShowPrevMonthVarPer=!1,this.ShowdetailsofControlGroups=!1,this.GroupTotalsAtEnd=!1,this.GroupTotalsSeperate=!1,this.DontShowSummaryGroupTotals=!1,this.ShowCarryForward=!1,this.ShowForecast=!1,this.ShowNetProfitBeforeAndAfter=!1,this.ClubIncomeExpenseInPlainReport=!1,this.ShowTotalBudget=!1,this.ShowBudget=!1,this.ShowBudgetVariance=!1,this.ShowBudgetVariancePercent=!1,this.HideZeroBudgetAccounts=!1,this.ShowGrossInIncome=!1,this.ShowIncomeFirst=!1,this.IsFirstCall=!1,this.ShowAllAccounts=!1,this.IsAccountWise=!1,this.AddGrossToVariance=!1,this.IgnoreGrossRowsForBS=!1,this.ShowSalesPercentage=!1,this.ShowSalesPerMonthly=!1,this.GrossAtEnd=!1,this.NetAtEnd=!1,this.ShowCorporateLaw=!1,this.SubShowPerc=!1,this.lstTagSalesTotal=new k.bT,this.dvYTD=null,this.dvBAL_LY=null,this.dvYTD_LY=null,this.dvYTDTable=null,this.dvBAL_LYTable=null,this.dvYTD_LYTable=null,this.sbSpaces="",this.GrossRows=new Array(2),this.ReportFormat=A.Vertical,this.IncomeExpenseHeader=new w.bA,this.GroupRowAppearance=new w.bA,this.AccountID=0,this.RetainedEarningAccount=0,this.CurrentBudgetID=0,this.PreviousBudgetID=0,this.LastAccountID=0,this.FirstAccountID=0,this.LocationWhere="",this.TagTableName=null,this.dsNew=null,this.dsOpenCompany=null,this.dsOpeningStock=null,this.dsClosingStock=null,this.dsOpenStock=null,this.dsCloseStock=null,this.dsList=new Array,this.dv1=null,this.dv2=null,this.dvCurrentBudget=null,this.dvPrevBudget=null,this.dv1Table=null,this.dv2Table=null,this.dvCurrentBudgetTable=null,this.dvPrevBudgetTable=null,this.dv1Columns=null,this.dv2Columns=null,this.IncomeAccounts=new Array,this.lstTags=new Array,this.lstPMTags=new Array,this.dblMonBal=0,this.dblActBudget=0,this.dblClosingStock=0,this.dblOpeningStock=0,this.YearSlots=new k.bT,this.QtrSlot=new k.bT,this.HideTagWiseBudget=!1,this.HideEmptyDimensions=!1,this.lstTagColumns=new Array,this.lstTagVisibleColumns=new Array,this.TextFields=new k.bT,this.TempData=new Array,this.strM1="",this.strM2="",this.strM3="",this.strM4="",this.strM5="",this.strBSM2="",this.IsAddRow=0,this.dblAccountsDrOpBalDiff=0,this.dblAccountsCrOpBalDiff=0,this.dblDrOpBalDiff=0,this.dblCrOpBalDiff=0,this.dblOpeningBalanceDifference=0,this.lstTagsOpeningBalance=new k.bT,this.IncomeExpenseHeader.IsBold=!0,this.IncomeExpenseHeader.FontSize=14,this.IncomeExpenseHeader.ForeColor="#FF00465A",this.IncomeExpenseHeader.BackColor="White",this.GroupRowAppearance.IsBold=!1,this.GroupRowAppearance.FontSize=12,this.GroupRowAppearance.ForeColor="#FF00465A",this.GroupRowAppearance.BackColor="White"}LoadReport(){if("True"==T.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==T.d.SessionManager.Preferences["LW Reports"]&&"True"==T.d.SessionManager.Preferences.LWAccPeriod&&(this.CheckLWAccountingDate(),!o.J0.IsEmpty(this.ViewModel.DisplayMessage)))return;if(this.GrdRow=-1,this.CountMonths=0,this.Show=d.None,this.subShow=d.None,this.SubShowPerc=!1,this.ReportTotal=new Array(2).fill(0),this.lstTotal=new Array,this.LevelNo=o.J0.Int(this.ViewModel.Preferences.Level),this.ShowIncomeFirst="Income"==this.ViewModel.Preferences.ShowFirst,this.ViewModel.IsReportCollapsable=!0,"Vertical"==this.ViewModel.Preferences.ReportFormat?this.ReportFormat=A.Vertical:"Horizontal"==this.ViewModel.Preferences.ReportFormat?(this.ViewModel.IsReportCollapsable=!1,this.ReportFormat=A.Horizontal):this.ReportFormat=A.Plain,this.ViewModel.Preferences.ContainsKey("IncludeStock")&&(this.IncludeOpeningStock=this.ViewModel.Preferences.IncludeStock.Contains("<OpeningStock/>"),this.IncludeClosingStock=this.ViewModel.Preferences.IncludeStock.Contains("<ClosingStock/>"),this.ViewModel.Preferences.ContainsKey("StockLevel")&&(this.StockLevelNo=o.J0.Int(this.ViewModel.Preferences.StockLevel))),this.PDCInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludePDCs")||"1"!=this.ViewModel.Preferences.IncludePDCs),this.IncludeUnApprovedPDC=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnApprovedPDC")||"1"!=this.ViewModel.Preferences.IncludeUnApprovedPDC),this.IncludeTerminatedPDC=!(this.ViewModel.Preferences.ContainsKey("IncludeTerminatedPDC")&&"0"==this.ViewModel.Preferences.IncludeTerminatedPDC),this.UnPostedDocsInclude=!(!this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocs")||"1"!=this.ViewModel.Preferences.IncludeUnPostedDocs),this.UnPostedDocsList=this.UnPostedDocsInclude&&this.ViewModel.Preferences.ContainsKey("IncludeUnPostedDocsList")?this.ViewModel.Preferences.IncludeUnPostedDocsList:"",this.ShowdetailsofControlGroups=!(!this.ViewModel.Preferences.ContainsKey("ShowdetailsofControlGroups")||"1"!=this.ViewModel.Preferences.ShowdetailsofControlGroups),5==this.ViewModel.StaticReportType&&(this.ShowdetailsofControlGroups=!0),this.ForeignCurrencyID=0,this.ViewModel.Preferences.ContainsKey("ForeignCurrency")){let n=new o.VB;n.LoadXml("<XML>"+this.ViewModel.Preferences.ForeignCurrency+"</XML>");let s=o.VB.SelectSingleNode(n.DocumentElement,"IsChecked");null!=s&&"1"==s.innerHTML&&(s=o.VB.SelectSingleNode(n.DocumentElement,"Value"),this.ForeignCurrencyID=o.J0.Int(s.innerHTML))}else if(this.ViewModel.Preferences.ContainsKey("Currency")){let n=new o.VB;n.LoadXml("<XML>"+this.ViewModel.Preferences.Currency+"</XML>"),this.CurrencyType=o.J0.Int(o.VB.SelectSingleNode(n.DocumentElement,"Type").innerHTML),1==this.CurrencyType?(o.J0.IsEmpty(T.d.SessionManager.Preferences.DimensionwiseCurrency)||0==o.J0.Int(T.d.SessionManager.Preferences.DimensionwiseCurrency))&&(this.CurrencyType=0):2==this.CurrencyType&&(this.ForeignCurrencyID=o.J0.Int(o.VB.SelectSingleNode(n.DocumentElement,"Value").innerHTML))}if(this.GroupTotalsAtEnd=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsAtEnd")||"1"!=this.ViewModel.Preferences.GroupTotalsAtEnd),this.GroupTotalsSeperate=!(!this.ViewModel.Preferences.ContainsKey("GroupTotalsSeperate")||"1"!=this.ViewModel.Preferences.GroupTotalsSeperate),this.DontShowSummaryGroupTotals=!(!this.ViewModel.Preferences.ContainsKey("DontShowSummaryGroupTotals")||"1"!=this.ViewModel.Preferences.DontShowSummaryGroupTotals),this.ClubIncomeExpenseInPlainReport=!(!this.ViewModel.Preferences.ContainsKey("ClubIncomeExpenseInPlainReport")||"1"!=this.ViewModel.Preferences.ClubIncomeExpenseInPlainReport),this.ShowCarryForward=!(!this.ViewModel.Preferences.ContainsKey("ShowCarryForward")||"1"!=this.ViewModel.Preferences.ShowCarryForward),this.ShowNetProfitBeforeAndAfter=!(!this.ViewModel.Preferences.ContainsKey("ShowNetProfit")||"BeforeAndAfter"!=this.ViewModel.Preferences.ShowNetProfit),this.ShowAllAccounts=!(!this.ViewModel.Preferences.ContainsKey("ShowAllAccounts")||"1"!=this.ViewModel.Preferences.ShowAllAccounts),this.HideZeroBudgetAccounts=!(!this.ViewModel.Preferences.ContainsKey("HideZeroBudgetAccounts")||"1"!=this.ViewModel.Preferences.HideZeroBudgetAccounts),this.IsAccountWise=!(!this.ViewModel.Preferences.ContainsKey("AccountWise")||"1"!=this.ViewModel.Preferences.AccountWise),this.DontApplyLocationWiseAccountsFilter=!(!this.ViewModel.Preferences.ContainsKey("DontApplyLocationWiseAccountsFilter")||"1"!=this.ViewModel.Preferences.DontApplyLocationWiseAccountsFilter),this.DontApplyLocationWiseAccountsFilter||(this.ApplyLWAccountLFilterWhenIgnoreLoc=!(!this.ViewModel.Preferences.ContainsKey("ApplyLWAccountLFilterWhenIgnoreLoc")||"1"!=this.ViewModel.Preferences.ApplyLWAccountLFilterWhenIgnoreLoc)),this.RetainedEarningAccount=this.ViewModel.Preferences.ContainsKey("RetainedEarningAccount")?o.J0.Int(this.ViewModel.Preferences.RetainedEarningAccount):0,this.ClosingStockAccount=this.ViewModel.Preferences.ContainsKey("ClosingStockAccount")?o.J0.Int(this.ViewModel.Preferences.ClosingStockAccount):0,this.AddGrossToVariance=!(!this.ViewModel.Preferences.ContainsKey("AddGrossToVariance")||"1"!=this.ViewModel.Preferences.AddGrossToVariance),this.NegNumber=this.ViewModel.Preferences.ContainsKey("NegNumber")?o.J0.Int(this.ViewModel.Preferences.NegNumber):4,this.GrossAtEnd=!(!this.ViewModel.Preferences.ContainsKey("GrossAtEnd")||"1"!=this.ViewModel.Preferences.GrossAtEnd),this.NetAtEnd=!(!this.ViewModel.Preferences.ContainsKey("NetAtEnd")||"1"!=this.ViewModel.Preferences.NetAtEnd),this.ShowCorporateLaw=!(!this.ViewModel.Preferences.ContainsKey("ShowCorporateLaw")||"1"!=this.ViewModel.Preferences.ShowCorporateLaw),this.ShowBudget=!1,this.ShowBudgetVariance=!1,this.CurrentBudgetID=0,this.PreviousBudgetID=0,this.CurrentBudgetWhere="",this.PreviousBudgetWhere="",this.ReportFormat==A.Vertical){let n="0",s="0";if(this.ViewModel.Preferences.ContainsKey("ShowSalesPercentage")){let a=new o.VB;a.LoadXml("<XML>"+this.ViewModel.Preferences.ShowSalesPercentage+"</XML>"),"1"==o.VB.SelectSingleNode(a.DocumentElement,"IsChecked").innerHTML&&(this.ShowSalesPercentage=!0,"Repeat Tag Wise"==o.VB.SelectSingleNode(a.DocumentElement,"Value").innerHTML&&(this.ShowSalesPerMonthly=!0))}this.ViewModel.Preferences.ContainsKey("FinalReportsShow")&&(n=this.ViewModel.Preferences.FinalReportsShow),this.ViewModel.Preferences.ContainsKey("FinalReportsSubShow")&&(s=this.ViewModel.Preferences.FinalReportsSubShow),this.ViewModel.Preferences.ContainsKey("HideTagWiseBudget")&&"1"==this.ViewModel.Preferences.HideTagWiseBudget&&(this.HideTagWiseBudget=!0),"1"==n?(this.Show=d.MonthWise,this.ViewModel.oReportDialog.FromDate.Date.iMonth()==this.ViewModel.oReportDialog.ToDate.Date.iMonth()&&this.ViewModel.oReportDialog.FromDate.Date.getFullYear()==this.ViewModel.oReportDialog.ToDate.Date.getFullYear()&&(this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")||(this.Show=d.None))):"8"==n?this.Show=d.DayWise:"4"==n?this.Show=d.QtrWise:"5"==n?this.Show=d.HalfYearWise:"3"==n?(this.Show=d.YearWise,this.ViewModel.oReportDialog.FromDate.Date.getFullYear()==this.ViewModel.oReportDialog.ToDate.Date.getFullYear()&&(this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference")||this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer")||(this.Show=d.None))):"2"==n?(this.Show=d.TagWise,this.TagID=o.J0.Int(this.ViewModel.Preferences.FinalReportsShowTag),this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagHideColumns")&&(this.HideEmptyDimensions=!0),this.TagColumnName="Name",this.ViewModel.Preferences.ContainsKey("FinalReportsShowTagColumn")&&("0"==this.ViewModel.Preferences.FinalReportsShowTagColumn?this.TagColumnName="Code":"2"==this.ViewModel.Preferences.FinalReportsShowTagColumn&&(this.TagColumnName="Code+'-'+Name")),this.ViewModel.Preferences.ContainsKey("FinalReportsSubShowPerc")&&(this.SubShowPerc=!0),"3"==s&&(this.subShow=d.YearWise)):"6"==n?(this.Show=d.CurrWise,this.ViewModel.Preferences.ContainsKey("FinalReportsShowCurrHideColumns")&&(this.HideEmptyDimensions=!0)):"7"==n&&(this.Show=d.CompWise,this.TagID=parseInt(this.ViewModel.Preferences.FinalReportsShowComp),this.TagTableName=this.ViewModel.Preferences.FinalReportsShowCompWhere,this.TagID>0&&!this.TagTableName.split(",").Contains(this.TagID.toString())&&(this.TagTableName=this.TagTableName.length>0?this.TagID+","+this.TagTableName:this.TagID.toString()),this.TagColumnName="Name",this.ViewModel.Preferences.ContainsKey("FinalReportsShowCompColumn")&&("0"==this.ViewModel.Preferences.FinalReportsShowCompColumn?this.TagColumnName="Code":"2"==this.ViewModel.Preferences.FinalReportsShowCompColumn&&(this.TagColumnName="Code+'-'+Name"))),8==this.ViewModel.StaticReportType&&(this.ViewModel.Preferences.ContainsKey("CurrentBudget")&&(this.CurrentBudgetID=o.J0.Int(this.ViewModel.Preferences.CurrentBudget)),this.ViewModel.Preferences.ContainsKey("PreviousBudget")&&(this.PreviousBudgetID=o.J0.Int(this.ViewModel.Preferences.PreviousBudget)),this.CurrentBudgetWhere=this.ViewModel.Preferences.ContainsKey("CurrentBudgetWhere")&&!o.J0.IsEmpty(this.ViewModel.Preferences.CurrentBudgetWhere)?this.ViewModel.Preferences.CurrentBudgetWhere:"",this.PreviousBudgetWhere=this.ViewModel.Preferences.ContainsKey("PreviousBudgetWhere")&&!o.J0.IsEmpty(this.ViewModel.Preferences.PreviousBudgetWhere)?this.ViewModel.Preferences.PreviousBudgetWhere:"",this.ViewModel.Preferences.ContainsKey("ShowActualBudget")&&"1"==this.ViewModel.Preferences.ShowActualBudget&&(this.CurrentBudgetID>0||this.PreviousBudgetID>0||!o.J0.IsEmpty(this.CurrentBudgetWhere)||!o.J0.IsEmpty(this.PreviousBudgetWhere))&&(this.ShowBudget=!0),this.ViewModel.Preferences.ContainsKey("ShowVariance")&&"1"==this.ViewModel.Preferences.ShowVariance&&(this.CurrentBudgetID>0||this.PreviousBudgetID>0)&&(this.ShowBudgetVariance=!0),this.ViewModel.Preferences.ContainsKey("ShowVariancePercent")&&"1"==this.ViewModel.Preferences.ShowVariancePercent&&(this.VariancePercentIndex=1==this.ShowBudgetVariance?2:1,(this.CurrentBudgetID>0||this.PreviousBudgetID>0||!o.J0.IsEmpty(this.CurrentBudgetWhere)||!o.J0.IsEmpty(this.PreviousBudgetWhere))&&(this.ShowBudgetVariancePercent=!0)),this.ViewModel.Preferences.ContainsKey("ShowTotalBudget")&&"1"==this.ViewModel.Preferences.ShowTotalBudget&&(this.TotalBudgetIndex=1==this.ShowBudget?2:1,(this.CurrentBudgetID>0||this.PreviousBudgetID>0||!o.J0.IsEmpty(this.CurrentBudgetWhere)||!o.J0.IsEmpty(this.PreviousBudgetWhere))&&(this.ShowTotalBudget=!0))),(this.Show==d.DayWise||this.Show==d.MonthWise||this.Show==d.QtrWise||this.Show==d.HalfYearWise||this.Show==d.YearWise)&&this.ViewModel.oReportDialog.ToDate.Date.Subtract(this.ViewModel.oReportDialog.FromDate.Date).TotalDays<=366&&(this.ShowPrevMonthData=this.ViewModel.Preferences.ContainsKey("FinalReportsShowPrevMn"),this.ShowPrevMonthDiffData=this.ViewModel.Preferences.ContainsKey("FinalReportsShowDifference"),this.ShowPrevMonthVarPer=this.ViewModel.Preferences.ContainsKey("FinalReportsShowVarPer"))}this.CellStartPos=0,this.dtYearStartMonth=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.AccountingFromMonth-1,1),this.dtYearStartMonth>this.ViewModel.oReportDialog.FromDate.Date&&(this.dtYearStartMonth=this.dtYearStartMonth.AddYears(-1)),this.YTDIndex=this.YTD_LYIndex=this.BAL_LYIndex=this.BAL_CLIndex=-1;let e=null,l=null,t=null,i=null;for(let n=0;n<this.ViewModel.ColumnSourceALL.length;n++)"Bud_Budget"==this.ViewModel.ColumnSourceALL[n].ID?(t=this.ViewModel.ColumnSourceALL[n].Clone(),t.HeaderAppearance.IsVisible=t.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[n].HeaderAppearance.IsVisible=!1):"Bud_TotalBudget"==this.ViewModel.ColumnSourceALL[n].ID?(i=this.ViewModel.ColumnSourceALL[n].Clone(),i.HeaderAppearance.IsVisible=i.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[n].HeaderAppearance.IsVisible=!1):"Bud_Variance"==this.ViewModel.ColumnSourceALL[n].ID?(e=this.ViewModel.ColumnSourceALL[n].Clone(),e.HeaderAppearance.IsVisible=e.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[n].HeaderAppearance.IsVisible=!1):"Bud_VariancePerc"==this.ViewModel.ColumnSourceALL[n].ID&&(l=this.ViewModel.ColumnSourceALL[n].Clone(),l.HeaderAppearance.IsVisible=l.DataAppearance.IsVisible=!0,this.ViewModel.ColumnSourceALL[n].HeaderAppearance.IsVisible=!1);let h=new Array;for(let n=0;n<this.ViewModel.ColumnSource.length;n++)if((33==this.ViewModel.ColumnSource[n].ID.length||"AccountCode"==this.ViewModel.ColumnSource[n].ID||"AccountName"==this.ViewModel.ColumnSource[n].ID)&&this.TextFields.push(this.ViewModel.ColumnSource[n].ID,n),h.push(this.ViewModel.ColumnSource[n].Clone()),"Balance"==this.ViewModel.ColumnSource[n].ID){if(h[h.length-1].DataFormat.NegativeNumber=4!=this.NegNumber?this.NegNumber:0,this.ShowTotalBudget){let s=null!=i?i.Clone():h[h.length-1].Clone();s.HeaderText=null!=i?s.HeaderText:"Total Budget",s.ID="TotalBudget",s.DataFormat.NegativeNumber=0,h.InsertAt(s,h.length-1),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(s.ID)||this.ViewModel.GrpReportTotal.TotalCols.push(s.ID,this.BalIndex-1),this.BalIndex=this.BalIndex+1}if(this.ShowBudget){let s=null!=t?t.Clone():h[h.length-1].Clone();s.HeaderText=null!=t?s.HeaderText:"Budget",s.ID="BudgetBalance",s.DataFormat.NegativeNumber=0,h.InsertAt(s,h.length-1),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(s.ID)||this.ViewModel.GrpReportTotal.TotalCols.push(s.ID,this.BalIndex-1)}if(this.BalIndex=h.length-1,this.ShowBudgetVariance){let s=null!=e?e.Clone():h[this.BalIndex].Clone();s.HeaderText=null!=e?s.HeaderText:"Variance",s.ID="VarianceBalance",s.DataFormat.NegativeNumber=0,h.push(s)}if(this.ShowBudgetVariancePercent){let s=null!=l?l.Clone():h[this.BalIndex].Clone();s.HeaderText=null!=l?s.HeaderText:"Variance %",s.DataFormat.PercentageOn="BudgetBalance",s.ID="PercentVarianceBalance",s.DataFormat.NegativeNumber=0,h.push(s)}if(this.ShowSalesPercentage){let s=h[this.BalIndex].Clone();s.HeaderText="Percentage",s.width>85&&(s.width=85),s.DataFormat.PercentageOn="Balance",s.ID="SalesPercentage",s.DataFormat.NegativeNumber=0,this.SalesPercentIndex=h.length-this.BalIndex,h.push(s)}if(this.ShowCorporateLaw){let s=h[this.BalIndex].Clone();s.HeaderText=s.HeaderText+" CL",s.ID="BalanceCL",h.Insert(this.BalIndex+1,s),this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(s.ID)||this.ViewModel.GrpReportTotal.TotalCols.push(s.ID,h.length-1),this.BAL_CLIndex=h.length-1}}else if("YTD"==this.ViewModel.ColumnSource[n].ID){if(4!=this.NegNumber&&(h[h.length-1].DataFormat.NegativeNumber=this.NegNumber),this.ShowBudget){let s=null!=t?t.Clone():h[h.length-1].Clone();s.HeaderText=null!=t?"YTD "+s.HeaderText:"YTD Budget",s.ID="BudgetYTD",s.DataFormat.NegativeNumber=0,h.InsertAt(s,h.length-1)}if(this.YTDIndex=h.length-1,this.ShowBudgetVariance){let s=null!=e?e.Clone():h[this.YTDIndex].Clone();s.HeaderText=null!=e?"YTD "+s.HeaderText:"YTD Variance",s.ID="VarianceYTD",s.DataFormat.NegativeNumber=0,h.push(s)}if(this.ShowBudgetVariancePercent){let s=null!=l?l.Clone():h[this.YTDIndex].Clone();s.HeaderText=null!=l?"YTD "+s.HeaderText:"YTD Variance %",s.DataFormat.PercentageOn="BudgetYTD",s.ID="PercentVarianceYTD",s.DataFormat.NegativeNumber=0,h.push(s)}}else if("LastYearBalance"==this.ViewModel.ColumnSource[n].ID){if(4!=this.NegNumber&&(h[h.length-1].DataFormat.NegativeNumber=this.NegNumber),this.ShowBudget){let s=null!=t?t.Clone():h[h.length-1].Clone();s.HeaderText=null!=t?"LastYear "+s.HeaderText:"LastYear Budget",s.ID="BudgetLastYearBalance",s.DataFormat.NegativeNumber=0,h.InsertAt(s,h.length-1)}if(this.BAL_LYIndex=h.length-1,this.ShowBudgetVariance){let s=null!=e?e.Clone():h[this.BAL_LYIndex].Clone();s.HeaderText=null!=e?"LastYear "+s.HeaderText:"LastYear Variance",s.ID="VarianceLastYearBalance",s.DataFormat.NegativeNumber=0,h.push(s)}if(this.ShowBudgetVariancePercent){let s=null!=l?l.Clone():h[this.BAL_LYIndex].Clone();s.HeaderText=null!=l?"LastYear "+s.HeaderText:"LastYear Variance %",s.DataFormat.PercentageOn="BudgetLastYearBalance",s.ID="PercentVarianceLastYearBalance",s.DataFormat.NegativeNumber=0,h.push(s)}}else if("LastYearYTD"==this.ViewModel.ColumnSource[n].ID){if(4!=this.NegNumber&&(h[h.length-1].DataFormat.NegativeNumber=this.NegNumber),this.ShowBudget){let s=null!=t?t.Clone():h[h.length-1].Clone();s.HeaderText=null!=t?"LastYear YTD "+s.HeaderText:"LastYear YTD Budget",s.ID="BudgetLastYearYTD",s.DataFormat.NegativeNumber=0,h.InsertAt(s,h.length-1)}if(this.YTD_LYIndex=h.length-1,this.ShowBudgetVariance){let s=null!=e?e.Clone():h[this.YTD_LYIndex].Clone();s.HeaderText=null!=e?"LastYear YTD "+s.HeaderText:"LastYear YTD Variance",s.ID="VarianceLastYearYTD",s.DataFormat.NegativeNumber=0,h.push(s)}if(this.ShowBudgetVariancePercent){let s=null!=l?l.Clone():h[this.YTD_LYIndex].Clone();s.HeaderText=null!=l?"LastYear YTD "+s.HeaderText:"LastYear YTD Variance %",s.DataFormat.PercentageOn="BudgetLastYearYTD",s.ID="PercentVarianceLastYearYTD",s.DataFormat.NegativeNumber=0,h.push(s)}}if(this.frmBalance=h[this.BalIndex].DataFormat.Clone(),this.frmBalance.NegativeNumber=0,this.frmBudget=h[this.BalIndex].DataFormat.Clone(),this.frmBalance.NegativeNumber=0,this.AccNameIndex=this.BalIndex-1,this.ShowBudget&&this.AccNameIndex--,this.ShowTotalBudget&&this.AccNameIndex--,this.ReportFormat==A.Plain&&(this.ClubIncomeExpenseInPlainReport?this.GroupTotalIndex=this.ViewModel.ColumnSource.length:(this.GroupTotalIndex=this.ViewModel.ColumnSource.length+1,h.push(this.ViewModel.ColumnSource[this.BalIndex].Clone()))),this.GroupTotalsSeperate){let n=this.ViewModel.ColumnSource[this.BalIndex].Clone();n.HeaderText="TOTAL",h.InsertAt(n,this.BalIndex+1),-1!=this.BAL_CLIndex&&this.BAL_CLIndex++,-1!=this.YTDIndex&&this.YTDIndex++,-1!=this.BAL_LYIndex&&this.BAL_LYIndex++,-1!=this.YTD_LYIndex&&this.YTD_LYIndex++}if(this.ColumnSize=h.length,this.ReportFormat==A.Horizontal){let n=h.length;for(let s=0;s<n;s++)h.push(h[s].Clone())}if(this.ReportFormat==A.Plain&&!this.ClubIncomeExpenseInPlainReport){let n=h[this.BalIndex],s=h[this.BalIndex+1];this.ShowIncomeFirst?7==this.ViewModel.StaticReportType?(n.HeaderText=T.d.GetResource("Reports_LblAssets").toUpperCase(),s.HeaderText=T.d.GetResource("Reports_LblLiabilities").toUpperCase()):(n.HeaderText=T.d.GetResource("Reports_LblIncome").toUpperCase(),s.HeaderText=T.d.GetResource("Reports_LblExpneses").toUpperCase()):7==this.ViewModel.StaticReportType?(n.HeaderText=T.d.GetResource("Reports_LblLiabilities").toUpperCase(),s.HeaderText=T.d.GetResource("Reports_LblAssets").toUpperCase()):(n.HeaderText=T.d.GetResource("Reports_LblExpneses").toUpperCase(),s.HeaderText=T.d.GetResource("Reports_LblIncome").toUpperCase())}if((this.Show==d.YearWise||this.subShow==d.YearWise)&&(this.HideTagWiseBudget=!0),this.Show==d.DayWise||this.Show==d.MonthWise||this.Show==d.YearWise||this.Show==d.QtrWise||this.Show==d.HalfYearWise)this.RenderColums(h,e,l,t,i,"","");else if(this.Show==d.TagWise||this.Show==d.CompWise||this.Show==d.CurrWise){let n=h[h.length-1];-1!=this.BalIndex&&(n=h[this.BalIndex]);let s="";s=this.Show==d.CompWise?"USE PACT2C SELECT DBIndex NodeID,Name FROM ADM_Company WITH(NOLOCK) WHERE DBIndex="+T.d.SessionManager.CompanyIndex+" OR DBIndex IN ("+this.TagTableName+") ORDER BY DBIndex":this.Show==d.CurrWise?"SELECT CurrencyID NodeID,Name FROM COM_Currency WITH(NOLOCK) ORDER BY CurrencyID":this.GetTagWiseQuery(this.TagID,this.TagColumnName,"Name"),T.d.report.DataSet("RPT022",s).Tables[0].forEach(r=>{if(this.subShow==d.DayWise||this.subShow==d.MonthWise||this.subShow==d.YearWise||this.subShow==d.QtrWise||this.subShow==d.HalfYearWise)this.RenderColums(h,e,l,t,i,r.Name.ToString(),"T"+r.NodeID.ToString());else{let I=new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1),S=n.Clone();if(S.HeaderText=r.Name.toString(),S.ID=r.NodeID.toString(),this.lstTagColumns.push(S.ID),h.push(S),++this.CountMonths,this.ShowBudget&&!this.HideTagWiseBudget){let m=null!=t?t.Clone():n.Clone();m.HeaderText="Budget-"+S.HeaderText,m.ID="Budget"+S.ID,this.ShowForecast&&I<=this.ViewModel.oReportDialog.ToDate.Date&&(m.HeaderAppearance.IsVisible=!1),h.Insert(h.length-1,m),++this.CountMonths}if(this.ShowBudgetVariance&&!this.HideTagWiseBudget){let m=null!=e?e.Clone():n.Clone();m.HeaderText="Variance-"+S.HeaderText,m.ID="Variance"+S.ID,h.push(m),++this.CountMonths}if(this.ShowBudgetVariancePercent&&!this.HideTagWiseBudget){let m=null!=l?l.Clone():n.Clone();m.DataFormat.PercentageOn=S.ID,m.HeaderText="Variance %-"+S.HeaderText,m.ID="PercentVariance"+S.ID,h.push(m),++this.CountMonths}if(this.ShowSalesPerMonthly){let m=S.Clone();m.HeaderText="Percentage-"+S.HeaderText,m.DataFormat.PercentageOn="Balance",m.width>85&&(m.width=85),m.ID="SalesPercentage_"+S.ID,m.DataFormat.NegativeNumber=0,h.push(m),++this.CountMonths}S.HeaderText=n.HeaderText+"-"+S.HeaderText,this.lstTags.push(S.ID)}})}if(this.ViewModel.ReportColumns=h,this.oColumns=this.ViewModel.ReportColumns,this.IsIncomeNegative=7!=this.ViewModel.StaticReportType,this.LocationWhere="",this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere&&(this.LocationWhere=o.J0.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?" AND 1<>1 ":"True"==T.d.SessionManager.Preferences.EnableLocationWise&&this.ViewModel.ShowLocationFilter&&this.ViewModel.oReportDialog.Locations.Items.length>0&&"all"==this.ViewModel.oReportDialog.Locations.Items[0].Value.toLowerCase()&&(0,L.yG0)(this.ViewModel.oReportDialog.Locations.Items[0].IsChecked)?"":" AND DCC.dcCCNID2 IN ("+this.ViewModel.oReportDialog.LocationWhere+") "),this.dsList.Clear(),this.dsBudget=null,7!=this.ViewModel.StaticReportType||!(0,L.yG0)(T.d.SessionManager.Preferences.OpenCompany))if(this.Show==d.TagWise&&(this.IncludeOpeningStock||this.IncludeClosingStock))this.IncludeOpeningStock&&this.SetStockBalance(!0),this.IncludeClosingStock&&this.SetStockBalance(!1);else{let n={Balance:0};this.IncludeOpeningStock&&(this.dsOpenStock=T.d.report.GetStockBalance_Async(1,this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID"),this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.StockLevelNo,this.exchRate,this.ViewModel.IsReportDB,n)),this.dblOpeningStock=n.Balance,this.IncludeClosingStock&&(this.dsCloseStock=T.d.report.GetStockBalance_Async(0,this.LocationWhere+this.GetDimensionFilter("DCC.dcCCNID"),this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.StockLevelNo,this.exchRate,this.ViewModel.IsReportDB,n),this.dblClosingStock=n.Balance)}8!=this.ViewModel.StaticReportType?(this.ReportRowStartIndex=-1,this.SetDataSet(this.ViewModel.StaticReportType).then(n=>{this.ReportFormat==A.Plain?this.LoadPlainReport():this.LoadHorizontalVerticalReports(),this.LoadReportComplete()})):(this.ReportRowStartIndex=-1,this.SetDataSet(5).then(n=>{this.LoadHorizontalVerticalReports(),this.Olddbl=this.dbl,this.OldReportTotalMonthWise=this.ReportTotalMonthWise,this.CellStartPos=0,this.ReportRowStartIndex=this.GrdRow,this.ReportTotal[0]=this.ReportTotal[1]=0,this.GrossRows[0]=null,this.GrossRows[1]=null,this.ShowIncomeFirst=!(!this.ViewModel.Preferences.ContainsKey("ShowFirst2")||"Income"!=this.ViewModel.Preferences.ShowFirst2),this.SetDataSet(8).then(s=>{this.LoadHorizontalVerticalReports(),this.LoadReportComplete()})}))}LoadReportComplete(){for(let e=0;e<this.TempData.length;e++){let l=this.TempData[e];l.Visible&&(this.ReportFormat==A.Horizontal&&(l.Parent=null),this.ViewModel.addRow(l))}this.ViewModel.process_RunWorkerCompleted(null,null)}SetColumns(e,l){e==d.DayWise?(this.strM1+=",Mn",this.strM2+=",CONVERT(DATETIME,ACC.DocDate) DocDate",this.strBSM2+=",Day(ACC.DocDate) DocDate",this.strM3+=7==this.ViewModel.StaticReportType?",'Y'+CONVERT(NVARCHAR,YEAR(DocDate))+'M'+(case when Month(DocDate)<10 then '0' else '' end)+ CONVERT(NVARCHAR,Month(DocDate))+'D'+ CONVERT(NVARCHAR,Day(DocDate)) Mn":",'Y'+CONVERT(NVARCHAR,YEAR(DocDate))+'M'+ CONVERT(NVARCHAR,Month(DocDate))+'D'+ CONVERT(NVARCHAR,Day(DocDate)) Mn",this.strM4+=",YEAR(DocDate), MONTH(DocDate), Day(DocDate)",this.strM5+=",DocDate"):e==d.MonthWise?(this.strM1+=",Mn",this.strM2+=",CONVERT(DATETIME,ACC.DocDate) DocDate",this.strBSM2+=",1 DocDate",this.strM3+=7==this.ViewModel.StaticReportType?",'Y'+CONVERT(NVARCHAR,YEAR(DocDate))+'M'+(case when Month(DocDate)<10 then '0' else '' end)+ CONVERT(NVARCHAR,Month(DocDate)) Mn":",'Y'+CONVERT(NVARCHAR,YEAR(DocDate))+'M'+ CONVERT(NVARCHAR,Month(DocDate)) Mn",this.strM4+=",YEAR(DocDate), MONTH(DocDate)",this.strM5+=",DocDate"):e==d.QtrWise||e==d.HalfYearWise?(this.strM1+=",Mn",this.strM2+=",CONVERT(DATETIME,ACC.DocDate) DocDate",this.strBSM2+=",1 DocDate",this.strM3+=",CONVERT(NVARCHAR,YEAR(DocDate))+'-'+ CONVERT(NVARCHAR,Month(DocDate)) Mn",this.strM4+=",YEAR(DocDate), MONTH(DocDate)",this.strM5+=",DocDate"):e==d.YearWise&&(1==this.AccountingFromMonth?(this.strM1+=",Mn",this.strM2+=",CONVERT(DATETIME,ACC.DocDate) DocDate",this.strBSM2+=",1 DocDate",this.strM3+=",'Y'+CONVERT(NVARCHAR,YEAR(DocDate)) Mn",this.strM4+=",YEAR(DocDate)",this.strM5+=",DocDate"):(this.strM1+=",Mn",this.strM2+=",CONVERT(DATETIME,ACC.DocDate) DocDate",this.strBSM2+=",1 DocDate",this.strM3+=7==l?",case when MONTH(DocDate)<4 and YEAR(DocDate)!=1900 then YEAR(DocDate)-1 else YEAR(DocDate) end Mn":",case when MONTH(DocDate)<4 then YEAR(DocDate)-1 else YEAR(DocDate) end Mn",this.strM4+=",YEAR(DocDate),MONTH(DocDate)",this.strM5+=",DocDate")),this.strM1=this.strM1.replace("TagID Mn,","Mn TagMn,TagID+Mn "),this.strM3=this.strM3.replace(",TagID",",'T'+CONVERT(NVARCHAR,TagID) TagID")}SetDataSet(e){let i,h,l="",t="",n="",s="",a="",r="",I="",m=new Array;if(5==e?(s="4,8",a="5,9",this.IncomeAccounts.push(4),this.IncomeAccounts.push(8),m.push(5),m.push(9)):6==e?(s="4,8,11",a="5,9,12",l=",A.PL IsSummary",t=",A.PL",this.IncomeAccounts.push(4),this.IncomeAccounts.push(8),this.IncomeAccounts.push(11),m.push(5),m.push(9),m.push(12)):7==e?(s="1,2,7,10,13,15",a="3,6,14,16",l=",A.BS IsSummary",t=",A.BS",this.IncomeAccounts.push(15),this.IncomeAccounts.push(13),this.IncomeAccounts.push(1),this.IncomeAccounts.push(2),this.IncomeAccounts.push(7),m.push(3),m.push(6),m.push(14),m.push(16)):8==e&&(s="11",a="12",this.IncomeAccounts.push(11),m.push(12)),this.ViewModel.Preferences.ContainsKey("AccountTypesFilter")&&this.ViewModel.Preferences.AccountTypesFilter.length>0){let x=this.ViewModel.Preferences.AccountTypesFilter.split(",");for(let g=this.IncomeAccounts.length-1;g>=0;g--)x.Contains(this.IncomeAccounts[g].toString())||this.IncomeAccounts.RemoveAt(g);for(let g=m.length-1;g>=0;g--)x.Contains(m[g].toString())||m.RemoveAt(g);this.IncomeAccounts.forEach(g=>{n.length>0&&(n+=","),n+=g.toString()}),m.forEach(g=>{n.length>0&&(n+=","),n+=g.toString()})}else n=s+","+a;if(8==this.ViewModel.StaticReportType&&(l=",A.PLT IsSummary",t=",A.PLT"),this.exchRate=0,this.ForeignCurrencyID>0)i="AmountFC",h=" AND ACC.CurrencyID="+this.ForeignCurrencyID;else if(i=1==this.CurrencyType?"AmountBC":"Amount",h="",this.ViewModel.Preferences.ContainsKey("FCWithExchRate")){let x=new o.VB;x.LoadXml("<XML>"+this.ViewModel.Preferences.FCWithExchRate+"</XML>");let g=o.VB.SelectSingleNode(x.DocumentElement,"IsChecked");null!=g&&"1"==g.innerHTML&&(this.exchRate=o.J0.Double(o.VB.SelectSingleNodeText(x.DocumentElement,"TextValue")),this.exchRate<=0&&(this.exchRate=1),i="Amount/"+this.exchRate.toString())}let R=!1,P="",N="",E=this.ViewModel.oReportDialog.GetSeqNosListWithRoots();!this.ViewModel.oReportDialog.IsZeroSelected&&!this.ViewModel.oReportDialog.IsOneSelected&&(this.ViewModel.oReportDialog.IsGroupExists?(N="A.AccountID=GTP.GTID",P=E.Contains(",")?",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID IN ("+E+") group by T.AccountID\nunion select T.AccountID GTID from ACC_Accounts T with(nolock) where T.IsGroup=1) AS GTP ":",(select T.AccountID GTID from ACC_Accounts T with(nolock),ACC_Accounts GT1 with(nolock) where T.lft BETWEEN GT1.lft AND GT1.rgt AND GT1.AccountID="+E+" group by T.AccountID\nunion select T.AccountID GTID from ACC_Accounts T with(nolock) where T.IsGroup=1) AS GTP ",R=!0):N=E.Contains(",")?"A.AccountID IN ("+E+")":"A.AccountID="+E),7==e&&T.d.SessionManager.Preferences.ContainsKey("ControlAccDimension")&&T.d.SessionManager.Preferences.ContainsKey("IsControlAccounts")&&"TRUE"==T.d.SessionManager.Preferences.IsControlAccounts.toUpperCase()&&(this.CADimension=o.J0.Int(T.d.SessionManager.Preferences.ControlAccDimension));let C="",p="",B="",y="",W="",z="",K="",G=this.GetDimensionFilter("DCC.dcCCNID");(this.LocationWhere.length>0||this.Show==d.TagWise||G.length>0||this.CADimension>0)&&(p=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.AccDocDetailsID=ACC.AccDocDetailsID "+this.LocationWhere+G,B=" INNER JOIN COM_DocCCData DCC WITH(NOLOCK) ON DCC.InvDocDetailsID=ACC.InvDocDetailsID "+this.LocationWhere+G),this.ShowCorporateLaw&&(z=K=" LEFT JOIN ACC_CorporateDetails CL WITH(NOLOCK) ON CL.AccDocDetailsID=ACC.AccDocDetailsID AND CL.AccountID=ACC.",z+="DebitAccount ",K+="CreditAccount"),this.Show==d.DayWise||this.Show==d.MonthWise||this.Show==d.QtrWise||this.Show==d.HalfYearWise||this.Show==d.YearWise?this.SetColumns(this.Show,e):(this.Show==d.TagWise||this.Show==d.CurrWise)&&(this.strM1=",TagID Mn",this.strM2=this.Show==d.CurrWise?",ACC.CurrencyID TagID":",DCC.dcCCNID"+(this.TagID-5e4)+" TagID",this.strBSM2=this.strM2,this.strM3=",TagID",this.strM4=",TagID",this.strM5=",TagID"),(this.subShow==d.DayWise||this.subShow==d.MonthWise||this.subShow==d.QtrWise||this.subShow==d.HalfYearWise||this.subShow==d.YearWise)&&this.SetColumns(this.subShow,e),this.CADimension>0&&(this.strM1+=",CADID,A1CC.CCNID"+(this.CADimension-5e4)+" CAD",this.strM2+=",DCC.dcCCNID"+(this.CADimension-5e4)+" CADID",this.strBSM2+=",DCC.dcCCNID"+(this.CADimension-5e4)+" CADID",this.strM3+=",CADID",this.strM4+=",CADID",this.strM5+=",CADID"),I="";let Y="";0==this.UnPostedDocsList.length?Y=" AND (ACC.StatusID=369 or ACC.StatusID=429)":Y+=" AND ACC.StatusID IN (369,429,"+this.UnPostedDocsList+")";let U="(ACC.StatusID=370 OR ACC.StatusID=439"+(this.IncludeTerminatedPDC?" OR ACC.StatusID=452":"")+(this.IncludeUnApprovedPDC?" OR ACC.StatusID=371 OR ACC.StatusID=441":"")+")";if(this.PDCInclude?(r=" AND ACC.DocumentType<>16 AND ("+U+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+Y+"))",I+=" AND ("+U+" OR (ACC.DocumentType<>14 AND ACC.DocumentType<>19"+Y+"))"):(r=" AND ACC.DocumentType NOT IN (16,14,19)"+Y,I+=" AND ACC.DocumentType<>14 AND ACC.DocumentType<>19"+Y),7==e)C+="\nSELECT A.AccountCode,A.AccountName,ACC.Balance"+this.strM1+",ACC.OpDocBalance"+(this.Show==d.CurrWise?",ACC.BalanceFC,ACC.OpDocBalanceFC":"")+",A.AccountID,A.IsGroup,A.lft,A.rgt,A.AccountTypeID,A.Depth,A.BS IsSummary"+this.ViewModel.SelectTag,this.IsAccountWise&&(C+=",A.ParentID"),C+="\nFROM (",this.Show==d.YearWise&&1!=this.AccountingFromMonth&&(C+="select AccountID,'Y'+convert(nvarchar,Mn) Mn"+(this.CADimension>0?",CADID":"")+",sum(Balance) Balance,sum(OpDocBalance) OpDocBalance from ("),C+="\nSELECT T1.AccountID"+this.strM3.Replace(",CADID",",case when CA.AccountTypeID=6 or CA.AccountTypeID=7 then CADID else 1 end CADID")+",SUM(OP_Dr)+SUM(TR_Dr)-(SUM(OP_Cr)+SUM(TR_Cr)) Balance,SUM(OpDocDr)-SUM(OpDocCr) OpDocBalance"+(this.Show==d.CurrWise?",SUM(FCOP_Dr)+SUM(FCTR_Dr)-(SUM(FCOP_Cr)+SUM(FCTR_Cr)) BalanceFC,SUM(FCOpDocDr)-SUM(FCOpDocCr) OpDocBalanceFC":"")+"\n\nFROM (",this.RoundOff.length>0&&(C+="SELECT T2.AccountID"+this.strM5+",round(convert(decimal(18,5),SUM(OP_Dr)),"+this.RoundOff+") OP_Dr,\nround(convert(decimal(18,5),SUM(TR_Dr)),"+this.RoundOff+") TR_Dr,\nround(convert(decimal(18,5),SUM(OP_Cr)),"+this.RoundOff+") OP_Cr,\nround(convert(decimal(18,5),SUM(TR_Cr)),"+this.RoundOff+") TR_Cr,\nround(convert(decimal(18,5),SUM(OpDocDr)),"+this.RoundOff+") OpDocDr,\nround(convert(decimal(18,5),SUM(OpDocCr)),"+this.RoundOff+") OpDocCr"+(this.Show==d.CurrWise?",round(convert(decimal(18,5),SUM(FCOP_Dr)),"+this.RoundOff+") FCOP_Dr,\nround(convert(decimal(18,5),SUM(FCTR_Dr)),"+this.RoundOff+") FCTR_Dr,\nround(convert(decimal(18,5),SUM(FCOP_Cr)),"+this.RoundOff+") FCOP_Cr,\nround(convert(decimal(18,5),SUM(FCTR_Cr)),"+this.RoundOff+") FCTR_Cr,\nround(convert(decimal(18,5),SUM(FCOpDocDr)),"+this.RoundOff+") FCOpDocDr,\nround(convert(decimal(18,5),SUM(FCOpDocCr)),"+this.RoundOff+") FCOpDocCr":"")+"\nFROM ("),C+="\n--Opening Dr\nSELECT ACC.DebitAccount AccountID,ACC.VoucherNo"+this.strBSM2+",ACC."+i+" OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr,case when ACC.DocumentType=16 then ACC."+i+" else 0 end OpDocDr,0 OpDocCr"+(this.Show==d.CurrWise?",ACC.AmountFC FCOP_Dr,0 FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,case when ACC.DocumentType=16 then ACC.AmountFC else 0 end FCOpDocDr,0 FCOpDocCr":"")+"\n\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+p+"\nWHERE (ACC.DocDate<@From OR (ACC.DocumentType=16"+Y+")) "+I+h+"\nUNION ALL--Opening Cr\nSELECT ACC.CreditAccount AccountID,ACC.VoucherNo"+this.strBSM2+",0 OP_Dr,ACC."+i+" OP_Cr,0 TR_Dr, 0 TR_Cr,0 OpDocDr,case when ACC.DocumentType=16 then ACC."+i+" else 0 end OpDocCr "+(this.Show==d.CurrWise?",0 FCOP_Dr,ACC.AmountFC FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,0 FCOpDocDr,case when ACC.DocumentType=16 then ACC.AmountFC else 0 end FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+p+"\nWHERE (ACC.DocDate<@From OR (ACC.DocumentType=16"+Y+"))  "+I+h+"\nUNION ALL--Transaction Dr\nSELECT ACC.DebitAccount AccountID,ACC.VoucherNo"+this.strM2+",0 OP_Dr,0 OP_Cr,ACC."+i+" TR_Dr,0 TR_Cr,0 OpDocDr,0 OpDocCr"+(this.Show==d.CurrWise?",0 FCOP_Dr,0 FCOP_Cr,ACC.AmountFC FCTR_Dr,0 FCTR_Cr,0 FCOpDocDr,0 FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+p+"\nWHERE (ACC.DocDate BETWEEN @From AND @To)"+r+h+"\nUNION ALL--Transaction Cr\nSELECT ACC.CreditAccount AccountID,ACC.VoucherNo"+this.strM2+",0 OP_Dr,0 OP_Cr,0 TR_Dr,ACC."+i+" TR_Cr,0 OpDocDr,0 OpDocCr"+(this.Show==d.CurrWise?",0 FCOP_Dr,0 FCOP_Cr,0 FCTR_Dr,ACC.AmountFC FCTR_Cr,0 FCOpDocDr,0 FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+p+"\nWHERE (ACC.DocDate BETWEEN @From AND @To)"+r+h,B.length>0&&(C+="\n--INEVENTORY DATA\nUNION ALL--Opening Dr\nSELECT ACC.DebitAccount AccountID,ACC.VoucherNo"+this.strBSM2+",ACC."+i+" OP_Dr,0 OP_Cr,0 TR_Dr,0 TR_Cr,0 OpDocDr,0 OpDocCr"+(this.Show==d.CurrWise?",ACC.AmountFC FCOP_Dr,0 FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,0 FCOpDocDr,0 FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+B+"\nWHERE (DocDate<@From OR (ACC.DocumentType=16"+Y+")) "+I+h+"\nUNION ALL--Opening Cr\nSELECT ACC.CreditAccount AccountID,ACC.VoucherNo"+this.strBSM2+",0 OP_Dr,ACC."+i+" OP_Cr,0 TR_Dr, 0 TR_Cr,0 OpDocDr,0 OpDocCr"+(this.Show==d.CurrWise?",0 FCOP_Dr,ACC.AmountFC FCOP_Cr,0 FCTR_Dr,0 FCTR_Cr,0 FCOpDocDr,0 FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+B+"\nWHERE (DocDate<@From OR (ACC.DocumentType=16"+Y+")) "+I+h+"\nUNION ALL--Transaction Dr\nSELECT ACC.DebitAccount AccountID,ACC.VoucherNo"+this.strM2+",0 OP_Dr,0 OP_Cr,"+i+" TR_Dr,0 TR_Cr,0 OpDocDr,0 OpDocCr"+(this.Show==d.CurrWise?",0 FCOP_Dr,0 FCOP_Cr,ACC.AmountFC FCTR_Dr,0 FCTR_Cr,0 FCOpDocDr,0 FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+B+"\nWHERE (DocDate BETWEEN @From AND @To)"+r+h+"\nUNION ALL--Transaction Cr\nSELECT ACC.CreditAccount AccountID,ACC.VoucherNo"+this.strM2+",0 OP_Dr,0 OP_Cr,0 TR_Dr,"+i+" TR_Cr,0 OpDocDr,0 OpDocCr"+(this.Show==d.CurrWise?",0 FCOP_Dr,0 FCOP_Cr,0 FCTR_Dr,ACC.AmountFC FCTR_Cr,0 FCOpDocDr,0 FCOpDocCr":"")+"\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+B+"\nWHERE (DocDate BETWEEN @From AND @To)"+r+h);else{let x="";this.PDCInclude&&(x=" OR (ACC.DocDate<=@To AND (ACC.DocumentType=14 OR ACC.DocumentType=19) AND "+U+")",r=" AND ACC.DocumentType NOT IN (16,14,19) "+Y),C+="\n            SELECT distinct A.AccountCode,A.AccountName,ACC.Balance"+this.strM1,this.Show==d.CurrWise&&(C+=",ACC.BalanceFC"),this.ShowCorporateLaw&&(C+=",ACC.BalanceCL"),C+=",A.AccountID,A.IsGroup,A.lft,A.rgt,A.AccountTypeID,A.Depth"+l+this.ViewModel.SelectTag,this.IsAccountWise&&(C+=",A.ParentID"),C+="\nFROM (",(this.Show==d.YearWise||this.subShow==d.YearWise)&&1!=this.AccountingFromMonth&&(C+="select AccountID,'Y'+convert(nvarchar,Mn) Mn"+(this.CADimension>0?",CADID":"")+",sum(Balance) Balance",this.Show==d.TagWise&&(C+=",TagID"),C+=" from ("),C+="SELECT AccountID"+this.strM3+",SUM(TR_Dr)-SUM(TR_Cr) Balance",this.Show==d.CurrWise&&(C+=",SUM(FCTR_Dr)-SUM(FCTR_Cr) BalanceFC",y=",ACC.AmountFC FCTR_Dr,0 FCTR_Cr",W=",0 FCTR_Dr,ACC.AmountFC FCTR_Cr"),this.ShowCorporateLaw&&(C+=",SUM(CLTR_Dr)-SUM(CLTR_Cr) BalanceCL",y=y+",ISNULL(CL."+i+",ACC."+i+") CLTR_Dr,0 CLTR_Cr",W=W+",0 CLTR_Dr,ISNULL(CL."+i+",ACC."+i+") CLTR_Cr"),C+=" FROM (",this.RoundOff.length>0&&(C+="SELECT T2.AccountID"+this.strM5+",round(convert(decimal(18,5),SUM(TR_Dr)),"+this.RoundOff+") TR_Dr,\nround(convert(decimal(18,5),SUM(TR_Cr)),"+this.RoundOff+") TR_Cr",this.Show==d.CurrWise&&(C+=",round(convert(decimal(18,5),SUM(FCTR_Dr)),"+this.RoundOff+") FCTR_Dr,\nround(convert(decimal(18,5),SUM(FCTR_Cr)),"+this.RoundOff+") FCTR_Cr"),this.ShowCorporateLaw&&(C+=",round(convert(decimal(18,5),SUM(CLTR_Dr)),"+this.RoundOff+") CLTR_Dr,\nround(convert(decimal(18,5),SUM(CLTR_Cr)),"+this.RoundOff+") CLTR_Cr"),C+="\nFROM ("),C+="\n--Transaction Dr\nSELECT ACC.DebitAccount AccountID,ACC.VoucherNo"+this.strM2+",ACC."+i+" TR_Dr,0 TR_Cr"+y+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+p+"\nWHERE (((ACC.DocDate BETWEEN @From AND @To)"+r+")"+x+")"+h+"\nUNION ALL--Transaction Cr\nSELECT ACC.CreditAccount AccountID,ACC.VoucherNo"+this.strM2+",0 TR_Dr,ACC."+i+" TR_Cr"+W+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+p+"\nWHERE (((ACC.DocDate BETWEEN @From AND @To)"+r+")"+x+")"+h,B.length>0&&(C+="\n--INEVENTORY DATA\nUNION ALL--Transaction Dr\nSELECT ACC.DebitAccount AccountID,ACC.VoucherNo"+this.strM2+",ACC."+i+" TR_Dr,0 TR_Cr"+y+"\nFROM ACC_DocDetails ACC WITH(NOLOCK)"+B+"\nWHERE (ACC.DocDate BETWEEN @From AND @To)"+r+h+"\nUNION ALL--Transaction Cr\nSELECT ACC.CreditAccount AccountID,ACC.VoucherNo"+this.strM2+",0 TR_Dr,ACC."+i+" TR_Cr"+W+"\nFROM ACC_DocDetails ACC  WITH(NOLOCK)"+B+"\nWHERE (ACC.DocDate BETWEEN @From AND @To)"+r+h)}this.RoundOff.length>0&&(C+=") AS T2  GROUP BY T2.AccountID,T2.VoucherNo"+this.strM5),C+=") AS T1 ",this.CADimension>0&&(C+=" JOIN ACC_Accounts CA WITH(NOLOCK) ON CA.AccountID=T1.AccountID "),C+=" GROUP BY T1.AccountID"+this.strM4.Replace(",CADID",",case when CA.AccountTypeID=6 or CA.AccountTypeID=7 then CADID else 1 end"),this.CADimension>0&&(C+=",CA.AccountTypeID"),(this.Show==d.YearWise||this.subShow==d.YearWise)&&1!=this.AccountingFromMonth&&(C+=") AS T3 GROUP BY T3.AccountID,T3.Mn"+(this.CADimension>0?",T3.CADID":""),this.Show==d.TagWise&&(C+=",T3.TagID")),C+="\n) AS ACC RIGHT JOIN ACC_Accounts A WITH(NOLOCK) ON A.AccountID=ACC.AccountID",this.HideZeroBudgetAccounts&&(this.CurrentBudgetID>0||!o.J0.IsEmpty(this.CurrentBudgetWhere))&&(this.ShowBudget||this.ShowBudgetVariance)&&(C+=" inner join (SELECT AccountID FROM COM_BudgetAlloc with(nolock) WHERE BudgetDefID in ("+(o.J0.IsEmpty(this.CurrentBudgetWhere)?this.CurrentBudgetID.toString():this.CurrentBudgetWhere)+") GROUP BY AccountID) as T on T.AccountID=A.AccountID"),C+=this.ViewModel.FromTag,C+=P,this.CADimension>0&&(C+=" left JOIN COM_CCCCDATA A1CC WITH(NOLOCK) ON A1CC.CostCenterID=2 and A1CC.NodeID=A.AccountID"),C+="\nWHERE A.AccountID>1",C+=this.GetAccountWiseLocationWhere("A"),C+=this.ViewModel.HideCostCenterTree?" AND A.AccountTypeID IN ("+n+")":N.length>0?this.IsAccountWise||R?" AND ("+N+(this.CADimension>0?" or A1CC.CCNID"+(this.CADimension-5e4)+">1":"")+")":" AND (A.IsGroup=1 or ("+N+")"+(this.CADimension>0?" or A1CC.CCNID"+(this.CADimension-5e4)+">1":"")+")":" AND A.AccountTypeID IN ("+n+")",this.IsAccountWise?(C+=" AND A.IsGroup=0",C+="Code"==this.ViewModel.Preferences.TreeSortOn?" Order By AccountCode":"TreeOrder"==this.ViewModel.Preferences.TreeSortOn?" Order By lft":" Order By AccountName"):C+=" Order By lft",(7==this.ViewModel.StaticReportType&&(this.Show==d.YearWise||this.Show==d.MonthWise)||this.subShow!=d.None)&&(C+=",Mn");let H="";H+="DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n",H+=C,this.IsAccountWise&&(H+=" select AccountID,AccountCode,AccountName,AccountTypeID"+l+",lft,Depth,ParentID from acc_accounts A with(nolock) where IsGroup=1 Order By Depth");let F=new k.bT,tt=T.d.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,H);if(F.push("dsNew",tt),(this.ShowPrevMonthData||this.ShowPrevMonthDiffData||this.ShowPrevMonthVarPer)&&F.push("dtPrevMonth",T.d.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,"DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\n"+C)),-1!=this.YTDIndex&&F.push("dvYTDTable",T.d.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,"DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtYearStartMonth.ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.ToString("dd MMM yyyy")+"'))\n"+C)),-1!=this.BAL_LYIndex&&F.push("dvBAL_LYTable",T.d.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,"DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.FromDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\n"+C)),-1!=this.YTD_LYIndex&&F.push("dvYTD_LYTable",T.d.report.ReportDataSetAsync("RPT022",this.ViewModel.IsReportDB,"DECLARE @From FLOAT,@To FLOAT\nSET @From=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtYearStartMonth.AddYears(-1).ToString("dd MMM yyyy")+"'))\nSET @To=CONVERT(FLOAT,CONVERT(DATETIME,'"+this.ViewModel.oReportDialog.ToDate.Date.AddYears(-1).ToString("dd MMM yyyy")+"'))\n"+C)),this.dsOpenCompany=null,this.dblDrOpBalDiff=0,7==e&&(0,L.yG0)(T.d.SessionManager.Preferences.OpenCompany)){let x="";this.YearSlots.length>0&&(x+="<XML>",this.YearSlots.keys.forEach(g=>{x+='<Row ID="'+g+'" EndDate="'+this.YearSlots[g].ToString("dd MMM yyyy")+'" />'}),x+="</XML>"),F.push("dsOpenCompany",T.d.report.GetOpenCompanyData(7,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.TagID,this.LocationWhere+G,!1,this.UnPostedDocsList,this.PDCInclude,this.IncludeTerminatedPDC,x.toString(),this.CurrencyType,this.ForeignCurrencyID,this.exchRate,this.ViewModel.IsReportDB))}return Promise.all(F.values).then(x=>{let g;if(this.dsNew=x[0],this.dsList.push(this.dsNew),this.dv=this.dsNew.Tables[0],this.dvTable=this.dsNew.Tables[0],this.dvColumns=this.dsNew.Columns[0],this.CADimension>0&&this.RefreshCAD(this.dsNew.Tables[0]),this.ShowSalesPercentage&&(5==e||6==e)){let f,u;u=this.dsNew.Tables[0].filter(5==e?c=>4==c.AccountTypeID||8==c.AccountTypeID:c=>4==c.AccountTypeID||8==c.AccountTypeID||11==c.AccountTypeID),f=u.Compute("sum","Balance"),null!=f&&(this.dblTotalSales=-o.J0.Double(f)),this.ShowSalesPerMonthly&&this.lstTags.forEach(c=>{if(this.Show==d.QtrWise){let D=new Date(o.J0.Int(c.substr(1,4)),o.J0.Int(c.substr(6))-1,1),b=[D.ToString("yyyy-M"),D.AddMonths(1).ToString("yyyy-M"),D.AddMonths(2).ToString("yyyy-M")];f=u.filter(V=>b.Contains(V.Mn)).Compute("sum","Balance")}else if(this.Show==d.HalfYearWise){let D=new Date(o.J0.Int(c.substr(1,4)),o.J0.Int(c.substr(6))-1,1),b=[D.ToString("yyyy-M"),D.AddMonths(1).ToString("yyyy-M"),D.AddMonths(2).ToString("yyyy-M"),D.AddMonths(3).ToString("yyyy-M"),D.AddMonths(4).ToString("yyyy-M"),D.AddMonths(5).ToString("yyyy-M")];f=u.filter(V=>b.Contains(V.Mn)).Compute("sum","Balance")}else f=u.filter(D=>D.Mn==c).Compute("sum","Balance");if(null!=f){let D=-o.J0.Double(f);D>0&&this.lstTagSalesTotal.push(c,D)}})}if(F.ContainsKey("dtPrevMonth")){g=F.keys.indexOf("dtPrevMonth");let f=x[g].Tables[0];for(let u=0;u<f.length;u++){let c=f[u];if(null==c.Mn)continue;let D={};for(let V=0;V<x[g].Columns[0].length;V++)D[x[g].Columns[0][V]]=c[x[g].Columns[0][V]];let b=this.dsNew.Tables[0].filter(V=>V.AccountID==c.AccountID);b.length>0?this.dsNew.Tables[0].InsertAt(D,this.dsNew.Tables[0].indexOf(b[0])):(this.dsNew.Tables[0].push(D),f.Columns.Contains("lft"))}}if(F.ContainsKey("dvYTDTable")&&(g=F.keys.indexOf("dvYTDTable"),this.dvYTDTable=x[g].Tables[0],this.dsNew.Columns[0].push("YTD")),F.ContainsKey("dvBAL_LYTable")&&(g=F.keys.indexOf("dvBAL_LYTable"),this.dvBAL_LYTable=x[g].Tables[0],this.dsNew.Columns[0].push("LastYearBalance")),F.ContainsKey("dvYTD_LYTable")&&(g=F.keys.indexOf("dvYTD_LYTable"),this.dvYTD_LYTable=x[g].Tables[0],this.dsNew.Columns[0].push("LastYearYTD")),this.SetBudgetDataSet(P,N),7==this.ViewModel.StaticReportType){this.dblOpeningBalanceDifference=0;let u=this.dsNew.Tables[0].Compute("sum","OpDocBalance");null!=u&&(this.dblOpeningBalanceDifference=-o.J0.Double(u)),this.lstTagsOpeningBalance.Clear(),(this.Show==d.TagWise||this.Show==d.CurrWise)&&this.lstTagColumns.forEach(c=>{this.dblTemp=0,u=this.Show==d.CurrWise&&this.dsNew.Columns[0].Contains("OpDocBalanceFC")?this.dsNew.Tables[0].filter(D=>D.Mn==c).Compute("sum","OpDocBalanceFC"):this.dsNew.Tables[0].filter(D=>D.Mn==c).Compute("sum","OpDocBalance"),null!=u&&(this.dblTemp=-o.J0.Double(u)),0!=this.dblTemp&&this.lstTagsOpeningBalance.push(c,this.dblTemp)})}if(F.ContainsKey("dsOpenCompany")){if(g=F.keys.indexOf("dsOpenCompany"),this.dsOpenCompany=x[g],this.dsOpenCompany.Tables[0].forEach(u=>{u.Dr=-o.J0.Double(u.Dr),u.Cr=-o.J0.Double(u.Cr)}),this.dsOpenCompany.Tables[1].length>0&&(this.FirstAccountID=null!=this.dsOpenCompany.Tables[1][0].FirstAccount?o.J0.Int(this.dsOpenCompany.Tables[1][0].FirstAccount):0,null!=this.dsOpenCompany.Tables[1][0].PreviousYearEndDate&&o.J0.ParseDate(this.dsOpenCompany.Tables[1][0].PreviousYearEndDate)>=this.ViewModel.oReportDialog.ToDate.Date&&(this.LastAccountID=o.J0.Int(this.dsOpenCompany.Tables[1][0].LastAccount))),this.IncludeOpeningStock||this.IncludeClosingStock){let u={Balance:0};if(this.Show==d.TagWise)this.IncludeOpeningStock&&this.SetStockBalance(!0),this.IncludeClosingStock&&this.SetStockBalance(!1);else if(o.J0.IsEmpty(this.dsOpenCompany)||0!=this.dsOpenCompany.Tables[2].length){this.dblTemp=0,this.dsOpenCompany.Tables[2].Columns.push("OpStock"),this.dsOpenCompany.Tables[2].Columns.push("ClStock"),this.dsOpenCompany.Tables[2].Columns.push("DiffStock");for(let c=0;c<this.dsOpenCompany.Tables[2].length;c++)0==c?((this.IncludeOpeningStock||"3"==T.d.SessionManager.Preferences.StockBasedON)&&(T.d.report.GetStockBalance_Async(1,this.LocationWhere+G,o.J0.ParseDate(this.dsOpenCompany.Tables[2][c].FromDate),o.J0.ParseDate(this.dsOpenCompany.Tables[2][c].ToDate),this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,0,this.exchRate,this.ViewModel.IsReportDB,u),this.dblOpeningStock=u.Balance),this.dsOpenCompany.Tables[2][c].OpStock=this.dblOpeningStock,this.dblTemp=this.dblOpeningStock,T.d.report.GetStockBalance_Async(0,this.LocationWhere+G,o.J0.ParseDate(this.dsOpenCompany.Tables[2][c].FromDate),o.J0.ParseDate(this.dsOpenCompany.Tables[2][c].ToDate),this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,0,this.exchRate,this.ViewModel.IsReportDB,u),this.dsOpenCompany.Tables[2][c].ClStock=this.dblClosingStock,this.dsOpenCompany.Tables[2][c].DiffStock=this.dblClosingStock-this.dblOpeningStock):(this.dblOpeningStock=this.dblClosingStock,this.dsOpenCompany.Tables[2][c].OpStock=this.dblOpeningStock,T.d.report.GetStockBalance_Async(0,this.LocationWhere+G,o.J0.ParseDate(this.dsOpenCompany.Tables[2][c].FromDate),o.J0.ParseDate(this.dsOpenCompany.Tables[2][c].ToDate),this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,0,this.exchRate,this.ViewModel.IsReportDB,u),this.dblClosingStock=u.Balance,this.dsOpenCompany.Tables[2][c].ClStock=this.dblClosingStock,this.dsOpenCompany.Tables[2][c].DiffStock=this.dblClosingStock-this.dblOpeningStock);this.dblOpeningStock=this.dblTemp,"3"==T.d.SessionManager.Preferences.StockBasedON&&(this.dblOpeningBalanceDifference-=this.dblOpeningStock),this.IncludeClosingStock&&o.J0.ParseDate(this.dsOpenCompany.Tables[2][this.dsOpenCompany.Tables[2].length-1].ToDate)<this.ViewModel.oReportDialog.ToDate.Date&&(T.d.report.GetStockBalance_Async(0,this.LocationWhere+G,o.J0.ParseDate(this.dsOpenCompany.Tables[2][this.dsOpenCompany.Tables[2].length-1].ToDate).AddDays(1),this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.StockLevelNo,this.exchRate,this.ViewModel.IsReportDB,u),this.dblClosingStock=u.Balance)}else this.IncludeOpeningStock&&(T.d.report.GetStockBalance_Async(1,this.LocationWhere+G,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,0,this.exchRate,this.ViewModel.IsReportDB,u),this.dblOpeningStock=u.Balance),"3"==T.d.SessionManager.Preferences.StockBasedON&&(this.dblOpeningBalanceDifference-=this.dblOpeningStock),this.IncludeClosingStock&&(T.d.report.GetStockBalance_Async(0,this.LocationWhere+G,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,this.UnPostedDocsInclude,this.CurrencyType,this.ForeignCurrencyID,this.StockLevelNo,this.exchRate,this.ViewModel.IsReportDB,u),this.dblClosingStock=u.Balance)}this.dblAccountsDrOpBalDiff=0,this.dblAccountsCrOpBalDiff=0;let f=new Array;if(this.YearSlots.length>0){for(let u=this.dsOpenCompany.Tables[0].length-1;u>0;u--)this.dsOpenCompany.Tables[0][u].Dr=o.J0.Double(this.dsOpenCompany.Tables[0][u].Dr)-o.J0.Double(this.dsOpenCompany.Tables[0][u-1].Dr),this.dsOpenCompany.Tables[0][u].Cr=o.J0.Double(this.dsOpenCompany.Tables[0][u].Cr)-o.J0.Double(this.dsOpenCompany.Tables[0][u-1].Cr);for(let u=0;u<this.dsOpenCompany.Tables[0].length;u++){let c=this.dsOpenCompany.Tables[0][u];if(this.dv=this.dvTable.filter(D=>D.AccountID==c.AccountID),this.dv.length>0){let D=0,b=null;for(D=0;D<this.dv.length;D++){if(null==this.dv[D].Mn||o.J0.String(c.Mn)==o.J0.String(this.dv[D].Mn)){b=this.dv[D];break}if(this.Show==d.MonthWise){let V=o.J0.String(c.Mn).split("M"),v=new Date(o.J0.Int(V[0].substr(1,4)),o.J0.Int(V[1])-1,1);if(V=o.J0.String(this.dv[D].Mn).split("M"),v<new Date(o.J0.Int(V[0].substr(1,4)),o.J0.Int(V[1])-1,1)){b=this.dv[D];break}}else if(this.Show==d.YearWise&&o.J0.Double(c.Mn.toString().substr(1,4))<o.J0.Double(this.dv[D].Mn.toString().substr(1,4))){b=this.dv[D];break}}if(null==b||o.J0.String(c.Mn)!=o.J0.String(b.Mn)){let V={};for(let v=0;v<this.dvColumns.length;v++)V[this.dvColumns[v]]=this.dv[0][this.dvColumns[v]];if(V.Mn=o.J0.String(c.Mn),V.Balance=0,null!=b){let v=this.dvTable.indexOf(b);this.dvTable.InsertAt(V,v),null==b.Mn&&this.dvTable.Remove(b)}else{let v=this.dvTable.indexOf(this.dv[this.dv.length-1]);this.dvTable.InsertAt(V,v+1)}b=V}this.dbl=o.J0.Double(b.Balance),o.J0.String(c.Mn)==this.oColumns[this.CellStartPos+this.ColumnSize].ID&&(this.dblAccountsDrOpBalDiff=o.J0.Double(c.Dr),this.dblAccountsCrOpBalDiff=o.J0.Double(c.Cr)),this.dbl=this.dbl+o.J0.Double(c.Dr)-o.J0.Double(c.Cr),b.Balance=this.dbl,f.Contains(b)||f.push(b)}}}else this.dsOpenCompany.Tables[0].forEach(u=>{if(this.Show==d.TagWise){if(this.dv=this.dvTable.filter(c=>c.AccountID==u.AccountID&&c.Mn==u.TagID),0==this.dv.length){if(this.dv=this.dvTable.filter(c=>c.AccountID==u.AccountID&&o.J0.IsEmpty(c.Mn)),this.dv.length>0)this.dv[0].Mn=u.TagID;else if(this.dv=this.dvTable.filter(c=>c.AccountID==u.AccountID),this.dv.length>0){let c={};for(let D=0;D<this.dvColumns.length;D++)c[this.dvColumns[D]]=this.dv[0][this.dvColumns[D]];c.Mn=u.TagID,c.Balance=null,this.dvTable.InsertAt(c,this.dvTable.indexOf(this.dv[0]))}this.dv=this.dvTable.filter(c=>c.AccountID==u.AccountID&&c.Mn==u.TagID)}}else this.dv=this.dvTable.filter(c=>c.AccountID==u.AccountID);if(this.dv.length>0){if(this.dbl=o.J0.Double(this.dv[0].Balance),this.dblAccountsDrOpBalDiff+=o.J0.Double(u.Dr),this.dblAccountsCrOpBalDiff+=o.J0.Double(u.Cr),this.dbl=this.dbl+o.J0.Double(u.Dr)-o.J0.Double(u.Cr),this.IncludeClosingStock||this.IncludeOpeningStock){let c=this.dsOpenCompany.Tables[2].filter(D=>D.AccountID==u.AccountID).Compute("sum","DiffStock");null!=c&&(this.dbl-=o.J0.Double(c))}this.dv[0].Balance=this.dbl}});this.dblDrOpBalDiff>0&&(this.dblDrOpBalDiff=Math.abs(this.dblDrOpBalDiff-this.dblAccountsDrOpBalDiff)),this.dblCrOpBalDiff>0&&(this.dblCrOpBalDiff=Math.abs(this.dblCrOpBalDiff-this.dblAccountsCrOpBalDiff)),this.dblDrOpBalDiff=this.dblDrOpBalDiff-this.dblCrOpBalDiff,this.dv=this.dvTable,0!=this.LastAccountID&&(this.IgnoreGrossRowsForBS=!0)}for(let f=0;f<this.CountMonths;f++)this.dsNew.Columns[0].push(this.oColumns[this.ColumnSize+f].ID);this.ReportFormat!=A.Plain&&(this.dv1=this.dv1Table=this.dsNew.Tables[0],this.dv2=this.dv2Table=this.dsNew.Tables[0],this.dv1=this.dv1Table,this.dv2=this.dv2Table,this.dv1Columns=this.dsNew.Columns[0],this.dv2Columns=this.dsNew.Columns[0],this.dv1=this.dv1.filter(f=>s.split(",").Contains(o.J0.String(f.AccountTypeID))),this.dv2=this.dv2.filter(f=>a.split(",").Contains(o.J0.String(f.AccountTypeID))));let O=this.dsNew.Tables[0].filter(f=>f.AccountID==this.RetainedEarningAccount);if(O.length>0){let c,f=0,u=0;for(let D=0;D<this.CountMonths;D++)O=this.dsNew.Tables[0].filter(b=>b.AccountID==this.RetainedEarningAccount&&b.Mn==this.oColumns[this.ColumnSize+D].ID),f=u=0,c=this.dsNew.Tables[0].filter(b=>s.split(",").Contains(b.AccountTypeID.toString())&&b.Mn==this.oColumns[this.ColumnSize+D].ID).Compute("sum","Balance"),null!=c&&(u=o.J0.Double(c.toString()),f=u),c=this.dsNew.Tables[0].filter(b=>a.split(",").Contains(b.AccountTypeID.toString())&&b.Mn==this.oColumns[this.ColumnSize+D].ID).Compute("sum","Balance"),null!=c&&(u=o.J0.Double(c.toString()),f+=u),O.length>0?(u=o.J0.Double(O[0].Balance.toString()),f=u-f,O.Table.Remove(O[0])):f=-f,O=this.dsNew.Tables[0].filter(b=>b.AccountID==this.RetainedEarningAccount),O.length>0&&(u=o.J0.Double(O[0].Balance.toString()),u+=f,O[0][this.oColumns[this.ColumnSize+D].ID]=u)}if(O=this.dsNew.Tables[0].filter(f=>f.AccountID==this.RetainedEarningAccount),O.length>0){let u,f=0,c=this.dsNew.Tables[0].filter(D=>s.split(",").Contains(D.AccountTypeID.toString())).Compute("sum","Balance");null!=c&&(u=o.J0.Double(c),f=u),c=this.dsNew.Tables[0].filter(D=>a.split(",").Contains(D.AccountTypeID.toString())).Compute("sum","Balance"),null!=c&&(u=o.J0.Double(c),f+=u),f+=this.dblOpeningBalanceDifference,this.IsIncome=this.IncomeAccounts.Contains(o.J0.Int(O[0].AccountTypeID)),u=o.J0.Double(O[0].Balance),u-=f,u-=this.dblClosingStock-this.dblOpeningStock,this.dblDrOpBalDiff>0?u-=this.dblDrOpBalDiff:u+=this.dblDrOpBalDiff,O[0].Balance=u,this.CountMonths>0&&(O[0][this.oColumns[this.ColumnSize+this.CountMonths-1].ID]=u),-1!=this.YTDIndex&&(this.dvYTD=this.dvYTDTable.filter(D=>D.AccountID==this.RetainedEarningAccount),this.dvYTD.length>0&&(c=this.dvYTD.filter(D=>s.split(",").Contains(D.AccountTypeID.toString())).Compute("sum","Balance"),null!=c&&(u=o.J0.Double(c),this.dblTemp=u),c=this.dvYTD.filter(D=>a.split(",").Contains(D.AccountTypeID.toString())).Compute("sum","Balance"),null!=c&&(u=o.J0.Double(c),this.dblTemp=this.dblTemp+u),u=o.J0.Double(this.dvYTD[0].Balance),this.dvYTD[0].Balance=u-this.dblTemp)),7==this.ViewModel.StaticReportType&&(0,L.yG0)(T.d.SessionManager.Preferences.OpenCompany)&&(this.IgnoreGrossRowsForBS=!0)}if(this.IsAccountWise&&this.UpdateDataTableWithGroups(),(this.Show==d.TagWise||this.Show==d.CurrWise)&&this.HideEmptyDimensions){let f=!1;if(this.lstTagColumns.forEach(u=>{var c=this.oColumns.find(D=>D.ID==u);c&&(0==this.dsNew.Tables[0].filter(D=>D.Mn==c.ID).length?this.lstTagVisibleColumns.Contains(u)||(c.HeaderAppearance.IsVisible=!1,null!=(c=this.oColumns.find(D=>D.ID=="Budget"+u))&&(c.HeaderAppearance.IsVisible=!1),null!=(c=this.oColumns.find(D=>D.ID=="Variance"+u))&&(c.HeaderAppearance.IsVisible=!1),null!=(c=this.oColumns.find(D=>D.ID=="PercentVariance"+u))&&(c.HeaderAppearance.IsVisible=!1),f=!0):(c.HeaderAppearance.IsVisible=!0,this.lstTagVisibleColumns.push(u)))}),this.subShow!=d.None&&this.lstTags.forEach(u=>{if(u.startsWith("T")){var c=this.oColumns.find(D=>D.ID==u);null!=c&&(0==this.dsNew.Tables[0].filter("Mn='"+c.ID+"'").length?this.lstTagVisibleColumns.Contains(u)||(c.HeaderAppearance.IsVisible=!1,null!=(c=this.oColumns.find(D=>D.Index==c.Index+1&&D.ID.startsWith("Perc_")))&&(c.HeaderAppearance.IsVisible=!1),null!=(c=this.oColumns.find(D=>D.ID=="Budget"+u))&&(c.HeaderAppearance.IsVisible=!1),null!=(c=this.oColumns.find(D=>D.ID=="Variance"+u))&&(c.HeaderAppearance.IsVisible=!1),null!=(c=this.oColumns.find(D=>D.ID=="PercentVariance"+u))&&(c.HeaderAppearance.IsVisible=!1),f=!0):(c.HeaderAppearance.IsVisible=!0,this.lstTagVisibleColumns.push(u)))}}),f){let u=new Array;this.oColumns.forEach(c=>{u.push(c)}),this.ViewModel.ReportColumns=u}}this.Show==d.CompWise&&this.SetConsolidateData(this.dsNew,H.toString())})}SetBudgetDataSet(e,l){if(this.dvPrevBudget=null,this.dvCurrentBudget=null,this.dvCurrentBudgetTable=null,this.ShowBudget||this.ShowBudgetVariance||this.ShowBudgetVariancePercent||this.ShowTotalBudget){if(null==this.dsBudget){let t,i="",h="",n="",s=this.ViewModel.oReportDialog.CostCenterFilters.find(I=>I.CostCenterID>5e4&&I.SelectedNodes.length>0)||null;if(!o.J0.IsEmpty(s)&&s.length>0||this.LocationWhere.length>0){let I="SELECT CostCenterID FROM COM_BudgetDefDims with(nolock) WHERE BudgetDefID in ("+(o.J0.IsEmpty(this.CurrentBudgetWhere)?this.CurrentBudgetID.toString():this.CurrentBudgetWhere)+") and CostCenterID>50000";(!o.J0.IsEmpty(this.PreviousBudgetWhere)||this.PreviousBudgetID>0)&&(-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex)&&(I+=" SELECT CostCenterID FROM COM_BudgetDefDims with(nolock) WHERE BudgetDefID in ("+(o.J0.IsEmpty(this.PreviousBudgetWhere)?this.PreviousBudgetID.toString():this.PreviousBudgetWhere)+") and CostCenterID>50000");let S=T.d.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,I);S.Tables[0].forEach(m=>{if(s.length>0&&s.find(R=>R.CostCenterID==o.J0.Int(m.CostCenterID))){let R=this.GetFilterByDimension_1(o.J0.Int(m.CostCenterID));R.length>0&&(h+=" AND CCNID"+(o.J0.Int(m.CostCenterID)-5e4)+" IN ("+R+")")}50002==o.J0.Int(m.CostCenterID)&&this.LocationWhere.length>0&&(h+=this.LocationWhere.Replace("DCC.dc",""))}),S.Tables.length>1&&S.Tables[1].forEach(m=>{if(s.length>0&&s.find(R=>R.CostCenterID==o.J0.Int(m.CostCenterID))){let R=this.GetFilterByDimension_1(o.J0.Int(m.CostCenterID));R.length>0&&(n+=" AND CCNID"+(o.J0.Int(m.CostCenterID)-5e4)+" IN ("+R+")")}50002==o.J0.Int(m.CostCenterID)&&this.LocationWhere.length>0&&(n+=this.LocationWhere.Replace("DCC.dc",""))})}let a=new Date(this.ViewModel.oReportDialog.ToDate.Date.getFullYear(),this.ViewModel.oReportDialog.ToDate.Date.getMonth(),1),r=0;if(t=this.dtYearStartMonth,i+="SELECT BA.AccountID",this.Show==d.TagWise){i+=",BA.CCNID"+(this.TagID-5e4)+" TagID",i+=",SUM(BA.AnnualAmount) AnnualAmount";for(let I=1;I<=12;I++)i+=",SUM(CASE WHEN BD.FinYearStartDate BETWEEN CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtYearStartMonth.AddYears(r).ToString("dd MMM yyyy")+"')) AND CONVERT(FLOAT,CONVERT(DATETIME,'"+t.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"')) THEN BA.Month"+I+"Amount ELSE 0 END) "+t.ToString("MMMyyyy"),t<a&&12==I&&(r++,I=0),t=t.AddMonths(1)}if(i+=' FROM COM_BudgetAlloc BA with(nolock) \n                JOIN COM_BudgetDef BD with(nolock) ON BD.BudgetDefID=BA.BudgetDefID\n                WHERE BA.BudgetDefID in (" + (!Util.IsEmpty(CurrentBudgetWhere) ? CurrentBudgetWhere : CurrentBudgetID.toString()) + ")',i+=h.toString(),i+=" GROUP BY BA.AccountID",this.Show==d.TagWise&&(i+=",BA.CCNID"+(this.TagID-5e4)),(!o.J0.IsEmpty(this.PreviousBudgetWhere)||this.PreviousBudgetID>0)&&(-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex)){let I=0;t=this.dtYearStartMonth,i+=" SELECT BA.AccountID",this.Show==d.TagWise&&(i+=",BA.CCNID"+(this.TagID-5e4)+" TagID"),i+=",SUM(BA.AnnualAmount) AnnualAmount";for(let S=1;S<=12;S++)i+=",SUM(CASE WHEN BD.FinYearStartDate BETWEEN CONVERT(FLOAT,CONVERT(DATETIME,'"+this.dtYearStartMonth.AddYears(I).ToString("dd MMM yyyy")+"')) AND CONVERT(FLOAT,CONVERT(DATETIME,'"+t.AddMonths(1).AddDays(-1).ToString("dd MMM yyyy")+"')) THEN BA.Month"+S+"Amount ELSE 0 END) "+t.ToString("MMMyyyy"),t<a&&12==S&&(I++,S=0),t=t.AddMonths(1);if(i+=" FROM COM_BudgetAlloc with(nolock) WHERE BudgetDefID in ("+(o.J0.IsEmpty(this.CurrentBudgetWhere)?this.CurrentBudgetID.toString():this.CurrentBudgetWhere)+")",i+=h.toString(),i+=" GROUP BY AccountID",(!o.J0.IsEmpty(this.PreviousBudgetWhere)||this.PreviousBudgetID>0)&&(-1!=this.BAL_LYIndex||-1!=this.YTD_LYIndex)){i+=" SELECT AccountID,SUM(AnnualAmount) AnnualAmount",t=this.dtYearStartMonth;for(let S=1;S<=12;S++)i+=",SUM(Month"+S+"Amount) "+t.ToString("MMMyyyy"),t=t.AddMonths(1);i+=" FROM COM_BudgetAlloc with(nolock) WHERE BudgetDefID in ("+(o.J0.IsEmpty(this.PreviousBudgetWhere)?this.PreviousBudgetID.toString():this.PreviousBudgetWhere)+")",i+=n.toString(),i+=" GROUP BY AccountID",this.Show==d.TagWise&&(i+=",BA.CCNID"+(this.TagID-5e4))}}this.dsBudget=T.d.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,i)}this.dvCurrentBudget=this.dvCurrentBudgetTable=this.dsBudget.Tables[0],this.dsBudget.Tables.length>1&&(this.dvPrevBudget=this.dvPrevBudgetTable=this.dsBudget.Tables[1]),this.dsNew.Columns[0].push("BudgetBalance"),this.dsNew.Columns[0].push("VarianceBalance"),this.dsNew.Columns[0].push("PercentVarianceBalance"),-1!=this.YTDIndex&&(this.dsNew.Columns[0].push("BudgetYTD"),this.dsNew.Columns[0].push("VarianceYTD"),this.dsNew.Columns[0].push("PercentVarianceYTD")),-1!=this.BAL_LYIndex&&(this.dsNew.Columns[0].push("BudgetLastYearBalance"),this.dsNew.Columns[0].push("VarianceLastYearBalance"),this.dsNew.Columns[0].push("PercentVarianceLastYearBalance")),-1!=this.YTD_LYIndex&&(this.dsNew.Columns[0].push("BudgetLastYearYTD"),this.dsNew.Columns[0].push("VarianceLastYearYTD"),this.dsNew.Columns[0].push("PercentVarianceLastYearYTD"))}}SetDataSetForPostFilters(e,l){let i="",h="",n="",s="";5==e?(n="4,8",s="5,9",this.IncomeAccounts.push(4),this.IncomeAccounts.push(8)):6==e?(n="4,8,11",s="5,9,12",i=",A.PL IsSummary",h=",A.PL",this.IncomeAccounts.push(4),this.IncomeAccounts.push(8),this.IncomeAccounts.push(11)):7==e?(n="13,15,1,2,7",s="14,16,6,3",i=",A.BS IsSummary",h=",A.BS",this.IncomeAccounts.push(15),this.IncomeAccounts.push(13),this.IncomeAccounts.push(1),this.IncomeAccounts.push(2),this.IncomeAccounts.push(7)):8==e&&(n="11",s="12",this.IncomeAccounts.push(11)),this.dv=this.dvTable=this.dsNew.Tables[0],this.dvColumns=this.dsNew.Columns[0],this.dsOpenCompany=null,this.dblDrOpBalDiff=0,7==e&&(0,L.yG0)(T.d.SessionManager.Preferences.OpenCompany)&&(this.dsOpenCompany=T.d.report.GetOpenCompanyData(7,this.ViewModel.oReportDialog.FromDate.Date,this.ViewModel.oReportDialog.ToDate.Date,0,this.LocationWhere,!1,this.UnPostedDocsList,this.PDCInclude,this.IncludeTerminatedPDC,"",this.CurrencyType,this.ForeignCurrencyID,this.exchRate,this.ViewModel.IsReportDB),this.dblAccountsDrOpBalDiff=0,this.dblAccountsCrOpBalDiff=0,this.dsOpenCompany.Tables[0].forEach(m=>{this.dv=this.dvTable.filter(R=>R.AccountID==m.AccountID),this.dv.length>0&&(this.dbl=o.J0.Double(this.dv[0].Balance),this.dblAccountsDrOpBalDiff+=o.J0.Double(m.Dr),this.dblAccountsCrOpBalDiff+=o.J0.Double(m.Cr),this.dbl=this.dbl+o.J0.Double(m.Dr)-o.J0.Double(m.Cr),this.dv[0].Balance=this.dbl)}),this.dblDrOpBalDiff>0&&(this.dblDrOpBalDiff=Math.abs(this.dblDrOpBalDiff-this.dblAccountsDrOpBalDiff)),this.dblCrOpBalDiff>0&&(this.dblCrOpBalDiff=Math.abs(this.dblCrOpBalDiff-this.dblAccountsCrOpBalDiff)),this.dblDrOpBalDiff=this.dblDrOpBalDiff-this.dblCrOpBalDiff,this.dv=this.dvTable),n="AccountTypeID IN ("+n+")",s="AccountTypeID IN ("+s+")",this.ReportFormat!=A.Plain?(this.dv1=this.dv1Table=this.dsNew.Tables[0],this.dv2=this.dv2Table=this.dsNew.Tables[0],this.dv1=this.dv1.filter(m=>n.split(",").Contains(m.AccountTypeID.toString())),this.dv2=this.dv2.filter(m=>s.split(",").Contains(m.AccountTypeID.toString())),this.dv1=J.d.FilterData(this.dv1,this.ViewModel.PostDataFetchFilterFields),this.dv2=J.d.FilterData(this.dv2,this.ViewModel.PostDataFetchFilterFields)):l.length>0&&(this.dv=J.d.FilterData(this.dv,this.ViewModel.PostDataFetchFilterFields));let S=this.dsNew.Tables[0].filter(m=>m.AccountID==this.RetainedEarningAccount);if(S.length>0){let m=0,R=0,P=this.dv1Table.filter(N=>n.split(",").Contains(N.AccountTypeID.toString())).Compute("sum","Balance");null!=P&&(R=o.J0.Double(P),m=R),P=this.dv1Table.filter(N=>s.split(",").Contains(N.AccountTypeID.toString())).Compute("sum","Balance"),null!=P&&(R=o.J0.Double(P),m+=R),this.IsIncome=this.IncomeAccounts.Contains(o.J0.Int(S[0].AccountTypeID)),R=o.J0.Double(S[0].Balance),R-=m,this.dblDrOpBalDiff>0?R-=this.dblDrOpBalDiff:R+=this.dblDrOpBalDiff,S[0].Balance=R}}RefreshCAD(e){let l=new k.G9;for(let t=e.length-1;t>=0;t--)if(null!=e[t].CADID&&o.J0.Int(e[t].CADID)>1){let i=o.J0.Int(e[t].CADID);if(!l.ContainsKey(i)){let h=e.filter(n=>n.CAD==i);h.length>0&&l.push(i,h[0])}l.ContainsKey(i)&&(null!=e[t].Balance&&(l[i].Balance=null==l[i].Balance?e[t].Balance:o.J0.Double(l[i].Balance)+o.J0.Double(e[t].Balance)),null!=e[t].OpDocBalance&&(l[i].OpDocBalance=null==l[i].OpDocBalance?e[t].OpDocBalance:o.J0.Double(l[i].OpDocBalance)+o.J0.Double(e[t].OpDocBalance)),l.values.Contains(e[t])||e.RemoveAt(t))}}LoadReportWithPostFilters(e){this.GrdRow=-1,this.CellStartPos=0,this.ReportRowStartIndex=-1,this.FirstTypeEndIndex=0,this.ReportTotal=new Array(2).fill(0),this.lstTotal=new Array,this.GrossRows[0]=null,this.GrossRows[1]=null,this.ShowIncomeFirst="Income"==this.ViewModel.Preferences.ShowFirst,this.ViewModel.ClearRows(),this.TempData.Clear(),8!=this.ViewModel.StaticReportType?(this.dsNew=this.dsList[0],this.SetDataSetForPostFilters(this.ViewModel.StaticReportType,e),this.ReportFormat==A.Plain?this.LoadPlainReport():this.LoadHorizontalVerticalReports()):(this.OldReportTotalMonthWise=null,this.dsNew=this.dsList[0],this.SetDataSetForPostFilters(5,e),this.LoadHorizontalVerticalReports(),this.Olddbl=this.dbl,this.CellStartPos=0,this.ReportRowStartIndex=this.GrdRow,this.ReportTotal[0]=this.ReportTotal[1]=0,this.ShowIncomeFirst=!(!this.ViewModel.Preferences.ContainsKey("ShowFirst2")||"Income"!=this.ViewModel.Preferences.ShowFirst2),this.dsNew=this.dsList[1],this.SetDataSetForPostFilters(8,e),this.LoadHorizontalVerticalReports()),this.LoadReportComplete()}GetQuarterID(e){for(let l=0;l<this.QtrSlot.keys.length;l++)if(this.QtrSlot.values[l].dtStart<=e&&this.QtrSlot.values[l].dtEnd>=e)return this.QtrSlot.keys[l];return""}LoadHorizontalVerticalReports(){this.ReportTotalMonthWise=o.J0.NumArray(2,this.CountMonths+4),this.ReportTotalYTD=o.J0.NumArray(2,3),this.ReportTotalALL=o.J0.NumArray(2,this.oColumns.length),this.strIncomeLabel=7==this.ViewModel.StaticReportType?T.d.GetResource("Reports_LblAssets").toUpperCase():T.d.GetResource("Reports_LblIncome").toUpperCase(),this.strExpenseLabel=7==this.ViewModel.StaticReportType?T.d.GetResource("Reports_LblLiabilities").toUpperCase():T.d.GetResource("Reports_LblExpneses").toUpperCase(),8!=this.ViewModel.StaticReportType?(this.ViewModel.Preferences.ContainsKey("Income1Label")&&(this.strIncomeLabel=this.ViewModel.Preferences.Income1Label),this.ViewModel.Preferences.ContainsKey("Expneses1Label")&&(this.strExpenseLabel=this.ViewModel.Preferences.Expneses1Label)):-1==this.ReportRowStartIndex?this.ViewModel.Preferences.ContainsKey("Income1Label")&&(this.strIncomeLabel=this.ViewModel.Preferences.Income1Label,this.strExpenseLabel=this.ViewModel.Preferences.Expneses1Label):this.ViewModel.Preferences.ContainsKey("Income2Label")&&(this.strIncomeLabel=this.ViewModel.Preferences.Income2Label,this.strExpenseLabel=this.ViewModel.Preferences.Expneses2Label),this.AddSection(this.ShowIncomeFirst,!0),this.AddSection(!this.ShowIncomeFirst,!1),this.AddOpenBalanceDifference(),7==this.ViewModel.StaticReportType?(this.AddOpenBalanceDifferenceForBS(),this.dbl=this.ReportTotal[0]+this.ReportTotal[1],this.ShowGrossInIncome=!(this.dbl>=0),Math.abs(this.ReportTotal[0])>Math.abs(this.ReportTotal[1])?this.ReportTotal[1]=this.ReportTotal[1]-this.dbl:this.ReportTotal[0]=this.ReportTotal[0]-this.dbl,this.dbl<0&&(this.dbl=-this.dbl)):(this.dbl=this.ReportTotal[0]+this.ReportTotal[1],this.ShowGrossInIncome=this.dbl>=0,this.GrossAtEnd&&-1==this.ReportRowStartIndex||this.NetAtEnd&&-1!=this.ReportRowStartIndex||(Math.abs(this.ReportTotal[0])>Math.abs(this.ReportTotal[1])?(this.ReportTotal[1]=this.ReportTotal[1]-this.dbl,this.AddGrossToVariance&&(this.ShowBudgetVariance&&(this.ReportTotalALL[1][this.BalIndex+1]=this.ReportTotalALL[1][this.BalIndex+1]+this.dbl),this.ShowBudgetVariancePercent&&(this.ReportTotalALL[1][this.BalIndex+this.VariancePercentIndex]=this.ReportTotalALL[1][this.BalIndex+this.VariancePercentIndex]+this.dbl))):Math.abs(this.ReportTotal[0])>0&&(this.ReportTotal[0]=this.ReportTotal[0]-this.dbl,this.AddGrossToVariance&&(this.ShowBudgetVariance&&(this.ReportTotalALL[0][this.BalIndex+1]=this.ReportTotalALL[0][this.BalIndex+1]+this.dbl),this.ShowBudgetVariancePercent&&(this.ReportTotalALL[0][this.BalIndex+this.VariancePercentIndex]=this.ReportTotalALL[0][this.BalIndex+this.VariancePercentIndex]+this.dbl)))),this.dbl<0&&(this.dbl=-this.dbl)),this.AddReportTotal(this.ShowIncomeFirst,!0),this.AddReportTotal(!this.ShowIncomeFirst,!1)}AddSection(e,l){let t,i,h;this.IsIncome=e,this.IsFirstCall=l,this.lstParents.Clear(),this.lstTotal.Clear(),l||(this.FirstTypeEndIndex=this.GrdRow,this.ReportFormat==A.Horizontal&&(this.GrdRow=this.ReportRowStartIndex,this.CellStartPos=this.CellStartPos+this.ColumnSize)),e?(this.dv=this.dv1,this.dvTable=this.dv1Table,this.dvColumns=this.dv1Columns,this.ReportTotalIndex=0,this.AddGroup(this.strIncomeLabel)):(this.dv=this.dv2,this.dvTable=this.dv2Table,this.dvColumns=this.dv2Columns,this.ReportTotalIndex=1,this.AddGroup(this.strExpenseLabel)),-1!=this.ReportRowStartIndex?this.AddRow_BF():e||this.AddOpeningStock();for(let n=0;n<this.dv.length;n++)if(this.drAccount=this.dv[n],e=this.IncomeAccounts.Contains(o.J0.Int(this.drAccount.AccountTypeID)),this.strAccountID=this.drAccount.AccountID.toString(),i=!1,(0,L.yG0)(this.drAccount.IsGroup))this.dbl=0,this.AddRow();else{if(this.Show!=d.None){if(this.dblTemp=0,this.dblCLTemp=0,this.AccountID=o.J0.Int(this.drAccount.AccountID),this.strTemp=o.J0.String(this.drAccount.Mn),this.strTemp2=this.strTagMn="",7!=this.ViewModel.StaticReportType||this.Show!=d.MonthWise&&this.Show!=d.YearWise||this.AccountID==this.RetainedEarningAccount){if(this.strTemp.length>0&&((this.Show==d.QtrWise||this.Show==d.HalfYearWise)&&(this.strTemp=this.GetQuarterID(new Date(o.J0.Int(this.strTemp.split("-")[0]),o.J0.Int(this.strTemp.split("-")[1]),1))),o.J0.IsEmpty(this.strTemp)||(this.lstPMTags.Contains(this.strTemp)||o.J0.IsEmpty(this.drAccount.Balance)?this.dblTemp=0:(this.dblTemp=o.J0.Double(this.drAccount.Balance),this.ShowCorporateLaw&&(this.dblCLTemp=parseFloat(this.drAccount.BalanceCL))),this.dblCLTemp=0,i=this.Show!=d.TagWise||Math.abs(this.dblTemp)>1e-4,this.dvColumns.Contains(this.strTemp)&&(this.drAccount[this.strTemp]=this.Show==d.CurrWise&&this.dvColumns.Contains("BalanceFC")?this.drAccount.BalanceFC:this.drAccount.Balance),this.ShowSalesPerMonthly&&this.lstTagSalesTotal.ContainsKey(this.strTemp)&&(this.drAccount["SalesPercentage_"+this.strTemp]=100*o.J0.Double(this.drAccount[this.strTemp])/this.lstTagSalesTotal[this.strTemp])),this.strTemp2=this.strTemp,this.dvColumns.Contains("TagMn")&&(this.strTagMn=this.drAccount.TagMn.toString(),this.strTagMn.length>0&&this.dvColumns.Contains(this.strTagMn)&&null==this.drAccount[this.strTagMn]))){let s=this.dsNew.Tables[0].Compute("sum(Balance)","AccountID='"+this.AccountID+"' AND TagMn='"+this.strTagMn+"'");null!=s&&(this.drAccount[this.strTagMn]=parseFloat(s))}for(;n+1<this.dv.length&&this.AccountID==o.J0.Int(this.dv[n+1].AccountID);){if(this.strTemp=o.J0.String(this.dv[n+1].Mn),this.strTemp.length>0&&(this.Show==d.QtrWise||this.Show==d.HalfYearWise?(this.strTemp=this.GetQuarterID(new Date(o.J0.Int(this.strTemp.split("-")[0]),o.J0.Int(this.strTemp.split("-")[1])-1,1)),!this.lstPMTags.Contains(this.strTemp)&&!o.J0.IsEmpty(this.dv[n+1].Balance)&&(this.dblTemp=this.dblTemp+o.J0.Double(this.dv[n+1].Balance),this.ShowCorporateLaw&&(this.dblCLTemp=this.dblCLTemp+parseFloat(this.dv[n+1].BalanceCL))),this.dvColumns.Contains(this.strTemp)&&(this.drAccount[this.strTemp]=null==this.drAccount[this.strTemp]?this.dv[n+1].Balance:o.J0.Double(this.drAccount[this.strTemp])+o.J0.Double(this.dv[n+1].Balance),this.ShowSalesPerMonthly&&this.lstTagSalesTotal.ContainsKey(this.strTemp)&&null!=this.drAccount[this.strTemp]&&(this.drAccount["SalesPercentage_"+this.strTemp]=100*o.J0.Double(this.drAccount[this.strTemp])/this.lstTagSalesTotal[this.strTemp]))):(!this.lstPMTags.Contains(this.strTemp)&&!o.J0.IsEmpty(this.dv[n+1].Balance)&&(this.dblTemp=this.dblTemp+o.J0.Double(this.dv[n+1].Balance),this.ShowCorporateLaw&&(this.dblCLTemp=this.dblCLTemp+parseFloat(this.dv[n+1].BalanceCL)),!i&&this.Show==d.TagWise&&(i=Math.abs(o.J0.Double(this.dv[n+1].Balance))>1e-4)),this.dvColumns.Contains(this.strTemp)&&(this.drAccount[this.strTemp]=this.Show==d.CurrWise&&this.drAccount.Contains("BalanceFC")?this.dv[n+1].BalanceFC:this.dv[n+1].Balance,this.ShowSalesPerMonthly&&this.lstTagSalesTotal.ContainsKey(this.strTemp)&&null!=this.drAccount[this.strTemp]&&(this.drAccount["SalesPercentage_"+this.strTemp]=100*o.J0.Double(this.drAccount[this.strTemp])/this.lstTagSalesTotal[this.strTemp]))),this.subShow!=d.None&&this.dvColumns.Contains("Perc_"+this.strTemp)&&this.dvColumns.Contains(this.strTemp2)&&this.dvColumns.Contains(this.strTemp)&&(this.drAccount["Perc_"+this.strTemp]=(o.J0.Double(this.drAccount[this.strTemp2])-o.J0.Double(this.drAccount[this.strTemp]))/o.J0.Double(this.drAccount[this.strTemp])*100),this.strTemp2=this.strTemp,this.dvColumns.Contains("TagMn")&&this.strTagMn!=this.dv[n+1].TagMn.toString()&&(this.strTagMn=this.dv[n+1].TagMn.toString(),this.strTagMn.length>0&&this.dvColumns.Contains(this.strTagMn)&&null==this.drAccount[this.strTagMn]))){let s=this.dsNew.Tables[0].Compute("sum(Balance)","AccountID='"+this.AccountID+"' AND TagMn='"+this.strTagMn+"'");null!=s&&(this.drAccount[this.strTagMn]=parseFloat(s))}this.dv.Remove(this.dv[n+1])}if(this.ShowPrevMonthDiffData)for(let s=0;s<this.lstTags.length;s++)this.dvColumns.Contains(this.lstTags[s])&&this.dvColumns.Contains(this.lstPMTags[s])&&(this.drAccount["DIFF_"+this.lstTags[s]]=(null==this.drAccount[this.lstTags[s]]?0:o.J0.Double(this.drAccount[this.lstTags[s]]))-(null==this.drAccount[this.lstPMTags[s]]?0:o.J0.Double(this.drAccount[this.lstPMTags[s]])));if(this.ShowPrevMonthVarPer)for(let s=0;s<this.lstTags.length;s++)if(this.dvColumns.Contains(this.lstTags[s])&&this.dvColumns.Contains(this.lstPMTags[s])){let a=(null==this.drAccount[this.lstTags[s]]?0:o.J0.Double(this.drAccount[this.lstTags[s]]))-(null==this.drAccount[this.lstPMTags[s]]?0:o.J0.Double(this.drAccount[this.lstPMTags[s]])),r=null==this.drAccount[this.lstPMTags[s]]?0:o.J0.Double(this.drAccount[this.lstPMTags[s]]);0!=r&&(a=100*a/r),this.drAccount["VARPER_"+this.lstTags[s]]=a}}else if(this.strTemp.length>0)if(i=!0,this.dblTemp=o.J0.Double(this.drAccount.Balance),this.dvColumns.Contains(this.strTemp)){let s=!1;for(let a=0;a<this.CountMonths;a++)s?(n+1<this.dv.length&&this.AccountID==o.J0.Int(this.dv[n+1].AccountID)&&(this.strTemp=o.J0.String(this.dv[n+1].Mn),this.strTemp.length>0&&this.oColumns[this.CellStartPos+this.ColumnSize+a].ID==this.strTemp&&(this.dblTemp=this.dblTemp+o.J0.Double(this.dv[n+1].Balance),this.dvTable.Remove(this.dv[n+1]),this.dv.Remove(this.dv[n+1]))),this.drAccount[this.oColumns[this.CellStartPos+this.ColumnSize+a].ID]=this.dblTemp):this.oColumns[this.CellStartPos+this.ColumnSize+a].ID==this.strTemp&&(s=!0,this.drAccount[this.strTemp]=this.dblTemp)}else for(let s=0;s<this.CountMonths;s++)n+1<this.dv.length&&this.AccountID==o.J0.Int(this.dv[n+1].AccountID)&&(this.strTemp=o.J0.String(this.dv[n+1].Mn),this.strTemp.length>0&&this.oColumns[this.CellStartPos+this.ColumnSize+s].ID==this.strTemp&&(this.dblTemp=this.dblTemp+o.J0.Double(this.dv[n+1].Balance),this.dvTable.Remove(this.dv[n+1]),this.dv.Remove(this.dv[n+1]))),this.drAccount[this.oColumns[this.CellStartPos+this.ColumnSize+s].ID]=this.dblTemp;this.drAccount.Balance=this.dblTemp,this.ShowCorporateLaw&&(this.drAccount.BalanceCL=this.dblCLTemp)}if(this.dbl=o.J0.Double(this.drAccount.Balance),t=!1,null!=this.dvCurrentBudget&&(this.dvCurrentBudget=this.dvCurrentBudgetTable.filter(s=>s.AccountID==this.strAccountID),this.dvCurrentBudget.length>0&&(t=!0)),h=!1,(Math.abs(this.dbl)>.01||this.ShowAllAccounts||t||i)&&(h=!0),!h&&null!=this.dvYTD){let s=this.dvYTD.filter(a=>a.AccountID==o.J0.Int(this.strAccountID));s.length>0&&o.J0.Double(s[0].Balance)>.01&&(h=!0)}if(!h&&null!=this.dvYTD_LY){let s=this.dvYTD_LY.filter(a=>a.AccountID==o.J0.Int(this.strAccountID));s.length>0&&o.J0.Double(s[0].Balance)>.01&&(h=!0)}if(!h&&null!=this.dvBAL_LY){let s=this.dvBAL_LY.filter(a=>a.AccountID==o.J0.Int(this.strAccountID));s.length>0&&o.J0.Double(s[0].Balance)>.01&&(h=!0)}if(h){if(this.Show==d.DayWise){if(null!=this.dvCurrentBudget&&!this.HideTagWiseBudget){let s=this.ViewModel.FromDatePicker.Date;if(this.dvCurrentBudget.length>0)for(;s<=this.ViewModel.ToDatePicker.Date;)this.strTemp=s.ToString("ddMMMyyyy"),o.J0.IsEmpty(this.dvCurrentBudget[0][this.strTemp])||(this.dblActBudget=o.J0.Double(this.dvCurrentBudget[0][this.strTemp]),this.ShowBudget&&(this.drAccount["Budget"+this.strTemp]=this.dblActBudget),this.ShowBudgetVariance&&(this.dblMonBal=o.J0.Double(this.drAccount["Y"+s.getFullYear()+"M"+s.iMonth()+"D"+s.getDay()]),this.drAccount["Variance"+this.strTemp]=this.dblActBudget-Math.abs(this.dblMonBal)),this.ShowBudgetVariancePercent&&(this.dblMonBal=o.J0.Double(this.drAccount["Y"+s.getFullYear()+"M"+s.iMonth()+"D"+s.getDay()]),this.drAccount["PercentVariance"+this.strTemp]=0!=this.dblActBudget?100*(this.dblActBudget-Math.abs(this.dblMonBal))/this.dblActBudget:0)),s=s.AddDays(1)}}else if(this.Show==d.MonthWise){if(null!=this.dvCurrentBudget&&!this.HideTagWiseBudget){let s=this.ViewModel.FromDatePicker.Date;if(this.dvCurrentBudget.length>0)for(;s<=this.ViewModel.ToDatePicker.Date;)this.strTemp=s.ToString("MMMyyyy"),o.J0.IsEmpty(this.dvCurrentBudget[0][this.strTemp])||(this.dblActBudget=o.J0.Double(this.dvCurrentBudget[0][this.strTemp]),this.ShowBudget&&(this.drAccount["Budget"+this.strTemp]=this.dblActBudget),this.ShowBudgetVariance&&(this.dblMonBal=o.J0.Double(this.drAccount["Y"+s.getFullYear()+"M"+s.iMonth()]),this.drAccount["Variance"+this.strTemp]=this.dblActBudget-Math.abs(this.dblMonBal)),this.ShowBudgetVariancePercent&&(this.dblMonBal=o.J0.Double(this.drAccount["Y"+s.getFullYear()+"M"+s.iMonth()]),this.drAccount["PercentVariance"+this.strTemp]=0!=this.dblActBudget?100*(this.dblActBudget-Math.abs(this.dblMonBal))/this.dblActBudget:0)),s=s.AddMonths(1)}}else if(this.Show==d.QtrWise||this.Show==d.HalfYearWise){if(null!=this.dvCurrentBudget&&!this.HideTagWiseBudget){let s=null,a=this.ViewModel.FromDatePicker.Date;if(this.dvCurrentBudget.length>0)for(;a<=this.ViewModel.ToDatePicker.Date;)this.strTemp=a.ToString("MMMyyyy"),o.J0.IsEmpty(this.dvCurrentBudget[0][this.strTemp])||(this.dbl=o.J0.Double(this.dvCurrentBudget[0][this.strTemp]),this.strTemp=this.GetQuarterID(a),s!=this.strTemp?this.dblActBudget=this.dbl:this.dblActBudget+=this.dbl,s=this.strTemp,this.ShowBudget&&(this.drAccount["Budget"+this.strTemp]=this.dblActBudget),this.ShowBudgetVariance&&(this.dblMonBal=o.J0.Double(this.drAccount[this.strTemp]),this.drAccount["Variance"+this.strTemp]=this.dblActBudget-Math.abs(this.dblMonBal)),this.ShowBudgetVariancePercent&&(this.dblMonBal=o.J0.Double(this.drAccount[this.strTemp]),this.drAccount["PercentVariance"+this.strTemp]=0!=this.dblActBudget?100*(this.dblActBudget-Math.abs(this.dblMonBal))/this.dblActBudget:0)),a=a.AddMonths(1)}}else this.Show!=d.TagWise||null==this.dvCurrentBudget||this.HideTagWiseBudget||this.lstTags.forEach(a=>{this.dvCurrentBudget=this.dvCurrentBudgetTable.filter(r=>r.AccountID==this.strAccountID&&r.TagID==a),this.dblActBudget=this.GetBudgetAmount(this.dvCurrentBudget,this.ViewModel.FromDatePicker.Date,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.drAccount["Budget"+a]=this.dblActBudget),this.ShowBudgetVariance&&(this.dblMonBal=o.J0.Double(this.drAccount[a]),this.drAccount["Variance"+a]=this.dblActBudget-Math.abs(this.dblMonBal)),this.ShowBudgetVariancePercent&&(this.dblMonBal=o.J0.Double(this.drAccount[a]),this.drAccount["PercentVariance"+a]=0!=this.dblActBudget?100*(this.dblActBudget-Math.abs(this.dblMonBal))/this.dblActBudget:0)});this.AddRow()}}!l&&this.GrdRow+1<this.TempData.length&&(this.TempData[this.GrdRow+1].Cells[this.CellStartPos].Text="",this.TempData[this.GrdRow+1].Cells[this.CellStartPos+1].Text="",this.ViewModel.ColumnSource.length>2&&(this.TempData[this.GrdRow+1].Cells[this.CellStartPos+2].Text="")),this.UpdateTreeTotals(0),-1==this.ReportRowStartIndex&&e&&this.AddClosingStock(),this.AddNetProfitBeforeOtherIncome()}AddRow(){if(this.IsAddRow=0,this.oRow=this.NewReportRow(),this.oRow.LevelNo=o.J0.Int(this.drAccount.Depth)-1,this.IsAccountWise||this.UpdateTreeTotals(this.oRow.LevelNo),this.oRow.NodeID=o.J0.Int(this.drAccount.AccountID),this.oRow.DataRow=this.drAccount,this.oRow.LevelNo<=this.LevelNo&&(this.GrdRow++,this.ReportFormat==A.Horizontal?this.IsFirstCall||this.GrdRow>this.FirstTypeEndIndex?this.IsAddRow=1:(this.IsAddRow=2,this.oRow=this.TempData[this.GrdRow]):this.IsAddRow=1),this.ReportFormat==A.Horizontal&&!this.IsFirstCall&&(this.oRow.Tag=o.J0.Int(this.drAccount.AccountID)),this.oRow.IsGroup=(0,L.yG0)(this.drAccount.IsGroup),this.IsAccountWise||(this.oRow.Cells[this.CellStartPos+this.AccNameIndex].level=o.J0.Int(this.drAccount.Depth)-1),(0,L.yG0)(this.drAccount.IsGroup)){this.lstParents.push(this.oRow),this.lstTotal.push(new Array(this.oColumns.length).fill(0));for(let e=this.CellStartPos;e<this.oRow.Cells.length;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.BalanceBFAppearance.Clone(),this.oRow.Cells[e].CellAppearance.Alignment=this.ViewModel.ReportColumns[e].DataAppearance.Alignment;this.oRow.Type=w.QS.BalanceBF}else{this.ReportTotal[this.ReportTotalIndex]+=this.dbl;for(let e=this.CellStartPos;e<this.oRow.Cells.length;e++)this.oRow.Cells[e].IsNormal=!0,this.oRow.Cells[e].CellAppearance=null}if(this.TextFields.keys.forEach(e=>{let l={Key:e,Value:this.TextFields[e]};this.dvColumns.Contains(l.Key)&&(this.oRow.Cells[this.CellStartPos+l.Value].Text=this.drAccount[l.Key].toString(),this.oRow.Cells[this.CellStartPos+l.Value].Value=this.oRow.Cells[this.CellStartPos+l.Value].Text)}),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].IsNormal=!1,!this.oRow.IsGroup){let e=0,l=0;if(this.FormatData(this.oRow.Cells[this.CellStartPos+this.BalIndex],this.dbl,this.oColumns[this.BalIndex]),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex]+=this.dbl),-1!=this.BAL_CLIndex&&(this.dblTemp=o.J0.Double(this.drAccount.BalanceCL),this.ReportTotalALL[this.ReportTotalIndex][this.BAL_CLIndex]+=this.dblTemp,this.FormatData(this.oRow.Cells[this.CellStartPos+this.BAL_CLIndex],this.dblTemp,this.oColumns[this.BAL_CLIndex]),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BAL_CLIndex]+=this.dblTemp)),-1!=this.YTDIndex&&(l=0,this.dvYTD=this.dvYTDTable.filter(t=>t.AccountID==this.strAccountID),this.dvYTD.length>0&&(this.dblTemp=o.J0.Double(this.dvYTD[0].Balance),l=this.dblTemp,this.drAccount.YTD=this.dblTemp,this.ReportTotalYTD[this.ReportTotalIndex][0]+=this.dblTemp,this.FormatData(this.oRow.Cells[this.CellStartPos+this.YTDIndex],this.dblTemp,this.oColumns[this.YTDIndex]),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTDIndex]+=this.dblTemp))),-1!=this.BAL_LYIndex&&(this.dvBAL_LY=this.dvBAL_LYTable.filter(t=>t.AccountID==this.strAccountID),this.dvBAL_LY.length>0&&(this.dblTemp=o.J0.Double(this.dvBAL_LY[0].Balance),this.drAccount.LastYearBalance=this.dblTemp,this.ReportTotalYTD[this.ReportTotalIndex][1]+=this.dblTemp,this.FormatData(this.oRow.Cells[this.CellStartPos+this.BAL_LYIndex],this.dblTemp,this.oColumns[this.BAL_LYIndex]),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BAL_LYIndex]+=this.dblTemp),null!=this.dvPrevBudgetTable&&(this.dvPrevBudget=this.dvPrevBudgetTable.filter(t=>t.AccountID==this.strAccountID),this.dblActBudget=this.GetBudgetAmount(this.dvPrevBudget,this.ViewModel.FromDatePicker.Date,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.ViewModel.SetCellValue(this.dblActBudget,this.oColumns[this.BAL_LYIndex-1].DataFormat,"FLOAT",this.oRow.Cells[this.BAL_LYIndex-1]),this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex-1]+=this.dblActBudget,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BAL_LYIndex-1]+=this.dblActBudget)),(this.ShowBudgetVariance||this.ShowBudgetVariancePercent)&&(e=this.IsIncome?-this.dblTemp-this.dblActBudget:this.dblActBudget-this.dblTemp,this.ShowBudgetVariance&&(this.ViewModel.SetCellValue(e,this.oColumns[this.BAL_LYIndex+1].DataFormat,"FLOAT",this.oRow.Cells[this.BAL_LYIndex+1]),this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex+1]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BAL_LYIndex+1]+=e)),this.ShowBudgetVariancePercent&&(this.dblTemp=0!=this.dblActBudget?100*e/this.dblActBudget:0,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BAL_LYIndex+this.VariancePercentIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BAL_LYIndex+this.VariancePercentIndex]),this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex+this.VariancePercentIndex]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BAL_LYIndex+this.VariancePercentIndex]+=e)))))),-1!=this.YTD_LYIndex&&(this.dvYTD_LY=this.dvYTD_LYTable.filter(t=>t.AccountID==this.strAccountID),this.dvYTD_LY.length>0&&(this.dblTemp=o.J0.Double(this.dvYTD_LY[0].Balance),this.drAccount.LastYearYTD=this.dblTemp,this.ReportTotalYTD[this.ReportTotalIndex][2]+=this.dblTemp,this.FormatData(this.oRow.Cells[this.CellStartPos+this.YTD_LYIndex],this.dblTemp,this.oColumns[this.YTD_LYIndex]),this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTD_LYIndex]+=this.dblTemp),null!=this.dvPrevBudget&&(this.dvPrevBudget=this.dvPrevBudgetTable.filter(t=>t.AccountID==this.strAccountID),this.dblActBudget=this.GetBudgetAmount(this.dvPrevBudget,this.dtYearStartMonth,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.ViewModel.SetCellValue(this.dblActBudget,this.oColumns[this.YTD_LYIndex-1].DataFormat,"FLOAT",this.oRow.Cells[this.YTD_LYIndex-1]),this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex-1]+=this.dblActBudget,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTD_LYIndex-1]+=this.dblActBudget)),(this.ShowBudgetVariance||this.ShowBudgetVariancePercent)&&(e=this.IsIncome?-this.dblTemp-this.dblActBudget:this.dblActBudget-this.dblTemp,this.ShowBudgetVariance&&(this.ViewModel.SetCellValue(e,this.oColumns[this.YTD_LYIndex+1].DataFormat,"FLOAT",this.oRow.Cells[this.YTD_LYIndex+1]),this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex+1]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTD_LYIndex+1]+=e)),this.ShowBudgetVariancePercent&&(this.dblTemp=0!=this.dblActBudget?100*e/this.dblActBudget:0,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.YTD_LYIndex+this.VariancePercentIndex].DataFormat,"FLOAT",this.oRow.Cells[this.YTD_LYIndex+this.VariancePercentIndex]),this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex+this.VariancePercentIndex]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTD_LYIndex+this.VariancePercentIndex]+=e)))))),null!=this.dvCurrentBudget){this.dvCurrentBudget=this.dvCurrentBudget.filter(i=>i.AccountID==this.strAccountID);let t=this.GetBudgetAmount(this.dvCurrentBudget,this.ViewModel.FromDatePicker.Date,this.ViewModel.ToDatePicker.Date);this.ShowBudget&&(this.ViewModel.SetCellValue(t,this.oColumns[this.BalIndex-1].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex-1]),this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex-1]+=t,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex-1]+=t)),this.ShowTotalBudget&&(this.dblTemp=this.GetBudgetAmount(this.dvCurrentBudget),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex-this.TotalBudgetIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex-this.TotalBudgetIndex]),this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex-this.TotalBudgetIndex]+=this.dblTemp,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex-this.TotalBudgetIndex]+=this.dblTemp)),(this.ShowBudgetVariance||this.ShowBudgetVariancePercent)&&(e=this.IsIncome?-this.dbl-t:t-this.dbl,this.ShowBudgetVariance&&(this.ViewModel.SetCellValue(e,this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex+1]),this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex+1]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex+1]+=e)),this.ShowBudgetVariancePercent&&(this.dblTemp=0!=t?100*e/t:0,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.VariancePercentIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex+this.VariancePercentIndex]),this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex+this.VariancePercentIndex]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex+this.VariancePercentIndex]+=e))),-1!=this.YTDIndex&&(t=this.GetBudgetAmount(this.dvCurrentBudget,this.dtYearStartMonth,this.ViewModel.ToDatePicker.Date),this.ShowBudget&&(this.ViewModel.SetCellValue(t,this.oColumns[this.YTDIndex-1].DataFormat,"FLOAT",this.oRow.Cells[this.YTDIndex-1]),this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex-1]+=t,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTDIndex-1]+=t)),(this.ShowBudgetVariance||this.ShowBudgetVariancePercent)&&(e=this.IsIncome?-l-t:t-l,this.ShowBudgetVariance&&(this.ViewModel.SetCellValue(e,this.oColumns[this.YTDIndex+1].DataFormat,"FLOAT",this.oRow.Cells[this.YTDIndex+1]),this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex+1]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTDIndex+1]+=e)),this.ShowBudgetVariancePercent&&(this.dblTemp=0!=t?100*e/t:0,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.YTDIndex+this.VariancePercentIndex].DataFormat,"FLOAT",this.oRow.Cells[this.YTDIndex+this.VariancePercentIndex]),this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex+this.VariancePercentIndex]+=e,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.YTDIndex+this.VariancePercentIndex]+=e))))}this.ShowSalesPercentage&&this.dblTotalSales>0&&(this.dblTemp=this.IsIncome?100*-this.dbl/this.dblTotalSales:100*this.dbl/this.dblTotalSales,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.SalesPercentIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex+this.SalesPercentIndex]),this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex+this.SalesPercentIndex]+=this.dblTemp,this.lstTotal.length>0&&(this.lstTotal[this.lstTotal.length-1][this.BalIndex+this.SalesPercentIndex]+=this.dblTemp));for(let t=0;t<this.CountMonths;t++)this.dblTemp=o.J0.Double(this.drAccount[this.oColumns[this.ColumnSize+t].ID]),this.ReportTotalMonthWise[this.ReportTotalIndex][t]+=this.dblTemp,this.oColumns[this.ColumnSize+t].ID.startsWith("Budget")||this.oColumns[this.ColumnSize+t].ID.startsWith("Variance")||this.oColumns[this.ColumnSize+t].ID.startsWith("VARPER_")?this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.ColumnSize+t].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.ColumnSize+t]):this.FormatData(this.oRow.Cells[this.CellStartPos+this.ColumnSize+t],this.dblTemp,this.oColumns[this.ColumnSize+t]),this.lstTotal.length>0&&!this.oColumns[this.ColumnSize+t].ID.startsWith("VARPER_")&&(this.lstTotal[this.lstTotal.length-1][this.CellStartPos+this.ColumnSize+t]+=this.dblTemp);this.ViewModel.ApplyKPI(this.oRow)}if(1==this.IsAddRow){if(!(this.ShowdetailsofControlGroups||(this.oRow.IsExpanded=!(0,L.yG0)(this.drAccount.IsSummary),(0,L.yG0)(this.drAccount.IsSummary)&&(this.oRow.Type=w.QS.Detail),this.oRow.IsGroup?this.lstParents.length>1&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.lstParents.length>0&&(this.oRow.Parent=this.lstParents[this.lstParents.length-1]),null==this.oRow.Parent||this.oRow.Parent.IsExpanded&&this.oRow.Parent.Visible||(this.oRow.Visible=!1,this.ReportFormat!=A.Horizontal))))return void this.GrdRow--;if(this.TempData.push(this.oRow),null!=this.dsOpenStock&&this.dsOpenStock.Columns.length>1&&this.dsOpenStock.Columns.length>2)for(let e=0;e<this.dsOpenStock.Tables[1].length;e++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=this.dsOpenStock.Tables[1][e].ProductName.toString()+" "+T.d.GetResource("Reports_LblOpeningStock"),this.dbl=o.J0.Double(this.dsOpenStock.Tables[1][e].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.ShowIncomeFirst?this.oRow.Cells[this.CellStartPos+this.BalIndex+1]:this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)}else if(2==this.IsAddRow){if(!this.ShowdetailsofControlGroups){this.oRow.IsExpanded=!(0,L.yG0)(this.drAccount.IsSummary),this.oRow.IsGroup?this.lstParents.length>1&&(this.oRow.Parent=this.lstParents[this.lstParents.length-2]):this.lstParents.length>0&&(this.oRow.Parent=this.lstParents[this.lstParents.length-1]);for(let e=0;e<this.lstParents.length;e++){let l=this.lstParents[e];if(null!=l&&!l.IsExpanded&&l!=this.oRow)return void this.GrdRow--}}this.TempData.Remove(this.oRow),this.TempData.InsertAt(this.oRow,this.GrdRow)}}AddReportTotal(e,l){let t=null,i=null;this.IsIncome=e;let h=-1,n=!1;if(n=6==this.ViewModel.StaticReportType?this.NetAtEnd:this.GrossAtEnd&&-1==this.ReportRowStartIndex||this.NetAtEnd&&-1!=this.ReportRowStartIndex,this.ReportTotalIndex=e?0:1,this.ReportFormat==A.Vertical){let a;this.GrdRow++,a=l?this.FirstTypeEndIndex+1:this.GrdRow,h=a,t=this.NewReportRow_2(w.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.ViewModel.GrpReportTotal.Height>0&&(t.Height=this.ViewModel.GrpReportTotal.Height),t.LevelNo=0;for(let r=0;r<this.CountMonths;r++)this.oColumns[this.CellStartPos+this.ColumnSize+r].ID.startsWith("VARPER_")||this.oColumns[this.CellStartPos+this.ColumnSize+r].ID.startsWith("SalesPercentage_")||this.oColumns[this.CellStartPos+this.ColumnSize+r].ID.startsWith("Perc_")||(t.Cells[this.CellStartPos+this.ColumnSize+r].IsNormal=!1,this.FormatData(t.Cells[this.CellStartPos+this.ColumnSize+r],this.ReportTotalMonthWise[this.ReportTotalIndex][r],this.oColumns[this.ColumnSize+r]));this.GrdRow++,i=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),i.Height=i.Height+2,i.LevelNo=0,this.GrossRows[this.ReportTotalIndex]=i,this.GrossCellIndex=this.CellStartPos}else this.ReportFormat==A.Horizontal&&(l?(this.FirstTypeEndIndex<this.GrdRow?this.FirstTypeEndIndex=this.GrdRow:this.GrdRow=this.FirstTypeEndIndex,this.GrdRow+=2,this.CellStartPos=0,h=this.FirstTypeEndIndex+1,i=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),i.Height=i.Height+2,i.LevelNo=0,t=this.NewReportRow_2(w.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance_Data),this.ViewModel.GrpReportTotal.Height>0&&(t.Height=this.ViewModel.GrpReportTotal.Height),t.LevelNo=0):(this.CellStartPos+=this.ColumnSize,n?(i=this.TempData[this.GrdRow],t=this.TempData[this.GrdRow-1]):(i=this.TempData[this.GrdRow-1],t=this.TempData[this.GrdRow])),this.GrossRows[this.ReportTotalIndex]=i);if(!l){let r,a="";if(1==this.ShowGrossInIncome){if(r=this.GrossRows[0],this.ReportFormat==A.Horizontal&&(this.GrossCellIndex=this.ShowIncomeFirst?0:this.ColumnSize),this.ShowNetProfitBeforeAndAfter&&-1!=this.ReportRowStartIndex){let I=this.TempData.indexOf(this.GrossRows[0]);this.TempData.indexOf(this.GrossRows[1]),r=-1==I?this.GrossRows[0]:this.GrossRows[1]}n&&(r=i),this.dbl>=0?(a=8!=this.ViewModel.StaticReportType?"Reports_LblNetLossForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossLossForPeriod":this.ShowNetProfitBeforeAndAfter?"Reports_LblNetLossAfter":"Reports_LblNetLossForPeriod",this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",r.Cells[this.GrossCellIndex+this.BalIndex]),this.AddGrossToVariance&&this.ShowBudgetVariance&&this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",r.Cells[this.GrossCellIndex+this.BalIndex+1])):(a=8!=this.ViewModel.StaticReportType?"Reports_LblNetProfitForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossProfitForPeriod":this.ShowNetProfitBeforeAndAfter?"Reports_LblNetProfitAfter":"Reports_LblNetProfitForPeriod",this.ViewModel.SetCellValue(-this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",r.Cells[this.GrossCellIndex+this.BalIndex]),r.Cells[this.GrossCellIndex+this.BalIndex].Text+="Dr",this.AddGrossToVariance&&this.ShowBudgetVariance&&this.ViewModel.SetCellValue(-this.dbl,this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",r.Cells[this.GrossCellIndex+this.BalIndex+1])),this.ShowSalesPercentage&&this.dblTotalSales>0&&(this.dblTemp=100*this.dbl/this.dblTotalSales,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.SalesPercentIndex].DataFormat,"FLOAT",r.Cells[this.BalIndex+this.SalesPercentIndex]))}else{if(r=this.GrossRows[1],this.ReportFormat==A.Horizontal&&(this.GrossCellIndex=this.ShowIncomeFirst?this.ColumnSize:0,this.ShowNetProfitBeforeAndAfter&&-1!=this.ReportRowStartIndex&&(this.GrossCellIndex=this.ShowIncomeFirst?0:this.ColumnSize)),this.ShowNetProfitBeforeAndAfter&&-1!=this.ReportRowStartIndex){let I=this.TempData.indexOf(this.GrossRows[0]);this.TempData.indexOf(this.GrossRows[1]),r=-1==I?this.GrossRows[0]:this.GrossRows[1]}n&&(r=i),this.dbl>=0?(a=8!=this.ViewModel.StaticReportType?"Reports_LblNetProfitForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossProfitForPeriod":this.ShowNetProfitBeforeAndAfter?"Reports_LblNetProfitAfter":"Reports_LblNetProfitForPeriod",this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",r.Cells[this.GrossCellIndex+this.BalIndex]),this.AddGrossToVariance&&this.ShowBudgetVariance&&this.ViewModel.SetCellValue(-this.dbl,this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",r.Cells[this.GrossCellIndex+this.BalIndex+1])):(a=8!=this.ViewModel.StaticReportType?"Reports_LblNetLossForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossLossForPeriod":this.ShowNetProfitBeforeAndAfter?"Reports_LblNetLossAfter":"Reports_LblNetLossForPeriod",this.ViewModel.SetCellValue(-this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",r.Cells[this.GrossCellIndex+this.BalIndex]),r.Cells[this.GrossCellIndex+this.BalIndex].Text+="Cr",this.AddGrossToVariance&&this.ShowBudgetVariance&&this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",r.Cells[this.GrossCellIndex+this.BalIndex+1])),this.ShowSalesPercentage&&this.dblTotalSales>0&&(this.dblTemp=100*this.dbl/this.dblTotalSales,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.SalesPercentIndex].DataFormat,"FLOAT",r.Cells[this.BalIndex+this.SalesPercentIndex]))}this.SetPLText(r.Cells[this.GrossCellIndex+this.AccNameIndex],a),this.SetPLTextColor(r.Cells[this.GrossCellIndex+this.BalIndex],a),this.AddGrossToVariance&&this.ShowBudgetVariance&&this.SetPLTextColor(r.Cells[this.GrossCellIndex+this.BalIndex+1],a),this.ShowSalesPercentage&&this.dblTotalSales>0&&this.SetPLTextColor(r.Cells[this.BalIndex+this.SalesPercentIndex],a),this.Show==d.None&&(this.ReportFormat==A.Vertical?r==this.GrossRows[0]?(this.GrossRows[1].Visible=!1,(0!=this.RetainedEarningAccount||Math.abs(this.dbl)<.01)&&(this.GrossRows[0].Visible=!0)):(this.GrossRows[0].Visible=!1,(0!=this.RetainedEarningAccount||Math.abs(this.dbl)<.01)&&(this.GrossRows[1].Visible=!0)):this.ReportFormat==A.Horizontal&&(0!=this.RetainedEarningAccount||Math.abs(this.dbl)<.01)&&(r.Visible=!1))}8!=this.ViewModel.StaticReportType&&n&&!this.ShowCarryForward&&(this.ReportFormat==A.Vertical?this.ShowGrossInIncome&&!e&&1==this.ReportTotalIndex?this.ReportTotal[1]-=this.Olddbl:!this.ShowGrossInIncome&&e&&0==this.ReportTotalIndex&&(this.ReportTotal[0]+=this.Olddbl):this.ShowGrossInIncome||0!=this.ReportTotalIndex?1==this.ReportTotalIndex&&(this.ReportTotal[1]-=this.Olddbl):this.ReportTotal[0]+=this.Olddbl);let s=-1;for(this.k=0;this.k<this.oColumns.length;this.k++)this.ViewModel.GrpReportTotal.TotalCols.ContainsKey(this.oColumns[this.k].ID)&&(-1==s&&(s=this.k),this.ViewModel.SetCellValue(Math.abs(this.ReportTotal[this.ReportTotalIndex]),this.oColumns[this.BalIndex].DataFormat,"FLOAT",t.Cells[this.CellStartPos+this.BalIndex]));if(t.Cells[this.CellStartPos].CellAppearance=this.ViewModel.GrpReportTotal.SubTotalAppearance,t.Cells[this.CellStartPos].Text=T.d.GetResource("Reports_ReportTotal"),8==this.ViewModel.StaticReportType&&(this.GrossAtEnd||this.NetAtEnd)){let a;e?(a=T.d.GetResource("Reports_LblIncome"),-1==this.ReportRowStartIndex?this.ViewModel.Preferences.ContainsKey("Income1Label")&&(a=this.ViewModel.Preferences.Income1Label):this.ViewModel.Preferences.ContainsKey("Income2Label")&&(a=this.ViewModel.Preferences.Income2Label)):(a=T.d.GetResource("Reports_LblExpneses"),-1==this.ReportRowStartIndex?this.ViewModel.Preferences.ContainsKey("Expneses1Label")&&(a=this.ViewModel.Preferences.Expneses1Label):this.ViewModel.Preferences.ContainsKey("Expneses2Label")&&(a=this.ViewModel.Preferences.Expneses2Label)),t.Cells[this.CellStartPos].Text=a+" Total"}if(s>0&&(t.Cells[this.CellStartPos].ColSpan=s),-1!=this.BAL_CLIndex&&this.FormatData(t.Cells[this.CellStartPos+this.BAL_CLIndex],this.ReportTotalALL[this.ReportTotalIndex][this.BAL_CLIndex],this.oColumns[this.BAL_CLIndex]),-1!=this.YTDIndex&&(this.FormatData(t.Cells[this.CellStartPos+this.YTDIndex],this.ReportTotalYTD[this.ReportTotalIndex][0],this.oColumns[this.YTDIndex]),this.ShowBudget&&this.FormatData(t.Cells[this.CellStartPos+this.YTDIndex-1],this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex-1],this.oColumns[this.YTDIndex-1]),this.ShowBudgetVariance&&this.FormatData(t.Cells[this.CellStartPos+this.YTDIndex+1],this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex+1],this.oColumns[this.YTDIndex+1]),this.ShowBudgetVariancePercent)){let a=0;this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex-1]>0&&(a=100*this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex+this.VariancePercentIndex]/this.ReportTotalALL[this.ReportTotalIndex][this.YTDIndex-1]),this.FormatData(t.Cells[this.CellStartPos+this.YTDIndex+this.VariancePercentIndex],a,this.oColumns[this.YTDIndex+this.VariancePercentIndex])}if(-1!=this.BAL_LYIndex&&(this.FormatData(t.Cells[this.CellStartPos+this.BAL_LYIndex],this.ReportTotalYTD[this.ReportTotalIndex][1],this.oColumns[this.BAL_LYIndex]),this.ShowBudget&&this.FormatData(t.Cells[this.CellStartPos+this.BAL_LYIndex-1],this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex-1],this.oColumns[this.BAL_LYIndex-1]),this.ShowBudgetVariance&&this.FormatData(t.Cells[this.CellStartPos+this.BAL_LYIndex+1],this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex+1],this.oColumns[this.BAL_LYIndex+1]),this.ShowBudgetVariancePercent)){let a=0;this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex-1]>0&&(a=100*this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex+this.VariancePercentIndex]/this.ReportTotalALL[this.ReportTotalIndex][this.BAL_LYIndex-1]),this.FormatData(t.Cells[this.CellStartPos+this.BAL_LYIndex+this.VariancePercentIndex],a,this.oColumns[this.BAL_LYIndex+this.VariancePercentIndex])}if(-1!=this.YTD_LYIndex&&(this.FormatData(t.Cells[this.CellStartPos+this.YTD_LYIndex],this.ReportTotalYTD[this.ReportTotalIndex][2],this.oColumns[this.YTD_LYIndex]),this.ShowBudget&&this.FormatData(t.Cells[this.CellStartPos+this.YTD_LYIndex-1],this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex-1],this.oColumns[this.YTD_LYIndex-1]),this.ShowBudgetVariance&&this.FormatData(t.Cells[this.CellStartPos+this.YTD_LYIndex+1],this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex+1],this.oColumns[this.YTD_LYIndex+1]),this.ShowBudgetVariancePercent)){let a=0;this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex-1]>0&&(a=100*this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex+this.VariancePercentIndex]/this.ReportTotalALL[this.ReportTotalIndex][this.YTD_LYIndex-1]),this.FormatData(t.Cells[this.CellStartPos+this.YTD_LYIndex+this.VariancePercentIndex],a,this.oColumns[this.YTD_LYIndex+this.VariancePercentIndex])}if(-1!=this.BalIndex&&(this.ShowTotalBudget&&this.FormatData(t.Cells[this.CellStartPos+this.BalIndex-this.TotalBudgetIndex],this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex-this.TotalBudgetIndex],this.oColumns[this.BalIndex-this.TotalBudgetIndex]),this.ShowBudget&&this.FormatData(t.Cells[this.CellStartPos+this.BalIndex-1],this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex-1],this.oColumns[this.BalIndex-1]),this.ShowBudgetVariance&&this.FormatData(t.Cells[this.CellStartPos+this.BalIndex+1],this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex+1],this.oColumns[this.BalIndex+1]),this.ShowBudgetVariancePercent)){let a=0;this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex-1]>0&&(a=100*this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex+this.VariancePercentIndex]/this.ReportTotalALL[this.ReportTotalIndex][this.BalIndex-1]),this.FormatData(t.Cells[this.CellStartPos+this.BalIndex+this.VariancePercentIndex],a,this.oColumns[this.BalIndex+this.VariancePercentIndex])}n?-1==h?(h=this.TempData.indexOf(i),this.TempData.RemoveAt(h),this.TempData.InsertAt(i,h),this.ViewModel.GrpReportTotal.GroupAppearance.IsVisible||(t.Visible=!1),h=this.TempData.indexOf(t),this.TempData.RemoveAt(h),this.TempData.InsertAt(t,h)):(this.ViewModel.GrpReportTotal.GroupAppearance.IsVisible||(t.Visible=!1),this.TempData.InsertAt(t,h),this.TempData.InsertAt(i,h+1)):-1==h?(h=this.TempData.indexOf(i),this.TempData.RemoveAt(h),this.TempData.InsertAt(i,h),this.ViewModel.GrpReportTotal.GroupAppearance.IsVisible||(t.Visible=!1),h=this.TempData.indexOf(t),this.TempData.RemoveAt(h),this.TempData.InsertAt(t,h)):(this.TempData.InsertAt(i,h),this.ViewModel.GrpReportTotal.GroupAppearance.IsVisible||(t.Visible=!1),this.TempData.InsertAt(t,h+1)),l||(this.ShowCorporateLaw&&this.ShowProfitAndLoss(this.BAL_CLIndex),this.Show!=d.None&&this.ShowMonthWiseProfitAndLoss()),t.Cells[this.CellStartPos+this.BalIndex].CellAppearance.Alignment=i.Cells[this.CellStartPos+this.BalIndex].CellAppearance.Alignment="Right",l||(this.IgnoreGrossRowsForBS?(h=this.TempData.indexOf(this.GrossRows[0]),-1!=h&&this.TempData.RemoveAt(h),h=this.TempData.indexOf(this.GrossRows[1]),-1!=h&&this.TempData.RemoveAt(h)):(h=this.TempData.indexOf(this.GrossRows[0]),this.TempData.RemoveAt(h),this.TempData.InsertAt(this.GrossRows[0],h),h=this.TempData.indexOf(this.GrossRows[1]),this.TempData.RemoveAt(h),this.TempData.InsertAt(this.GrossRows[1],h)))}ShowProfitAndLoss(e){let t,l=!1,i=0,h=0;i=this.TempData.indexOf(this.GrossRows[0]),h=this.TempData.indexOf(this.GrossRows[1]);let n=this.GrossAtEnd&&-1==this.ReportRowStartIndex||this.NetAtEnd&&-1!=this.ReportRowStartIndex;this.dblTemp=this.ReportTotal[0]+this.ReportTotal[1],this.dblTemp=8==this.ViewModel.StaticReportType?this.ReportTotal[0]+this.ReportTotal[1]:this.ReportTotalALL[0][e]+this.ReportTotalALL[1][e],this.dblTemp>=0?(n||(this.TempData[i].Cells[this.CellStartPos+e].Value=this.TempData[h].Cells[this.CellStartPos+e].Value,this.TempData[i].Cells[this.CellStartPos+e].Text=this.TempData[h].Cells[this.CellStartPos+e].Text),l=!0):(n||(this.TempData[h].Cells[this.CellStartPos+e].Value=this.TempData[i].Cells[this.CellStartPos+e].Value,this.TempData[h].Cells[this.CellStartPos+e].Text=this.TempData[i].Cells[this.CellStartPos+e].Text),l=!1),this.dblTemp<0&&(this.dblTemp=-this.dblTemp);let s=null;n?(t=i>h?this.TempData[i].Cells[this.CellStartPos+e]:this.TempData[h].Cells[this.CellStartPos+e],this.ViewModel.SetCellValue(7!=this.ViewModel.StaticReportType&&l?-this.dblTemp:this.dblTemp,this.oColumns[this.CellStartPos+e].DataFormat,"FLOAT",t)):(l?(t=this.GrossRows[0].Cells[this.CellStartPos+e],s=this.dblTemp>=0?8!=this.ViewModel.StaticReportType?"Reports_LblNetLossForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossLossForPeriod":"Reports_LblNetLossForPeriod":8!=this.ViewModel.StaticReportType?"Reports_LblNetProfitForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossProfitForPeriod":"Reports_LblNetProfitForPeriod"):(t=this.GrossRows[1].Cells[this.CellStartPos+e],s=this.dblTemp>=0?8!=this.ViewModel.StaticReportType?"Reports_LblNetProfitForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossProfitForPeriod":"Reports_LblNetProfitForPeriod":8!=this.ViewModel.StaticReportType?"Reports_LblNetLossForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossLossForPeriod":"Reports_LblNetLossForPeriod"),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+e].DataFormat,"FLOAT",t)),null!=s&&this.SetPLTextColor(t,s);let a=this.TempData[i],r=this.TempData[h];this.TempData.RemoveAt(i),this.TempData.Insert(i,a),this.TempData.RemoveAt(h),this.TempData.InsertAt(r,h)}ShowMonthWiseProfitAndLoss(){let l,t,i,h,e=!1;i=this.TempData.indexOf(this.GrossRows[0]),h=this.TempData.indexOf(this.GrossRows[1]);let n=!1;n=6==this.ViewModel.StaticReportType?this.NetAtEnd:this.GrossAtEnd&&-1==this.ReportRowStartIndex||this.NetAtEnd&&-1!=this.ReportRowStartIndex;for(let r=0;r<this.CountMonths;r++){if(this.oColumns[this.CellStartPos+this.ColumnSize+r].ID.startsWith("DIFF_")||this.oColumns[this.CellStartPos+this.ColumnSize+r].ID.startsWith("VARPER_")||this.oColumns[this.CellStartPos+this.ColumnSize+r].ID.startsWith("Perc_")||(7==this.ViewModel.StaticReportType?(this.dblTemp=this.ReportTotalMonthWise[0][r]+this.ReportTotalMonthWise[1][r],this.dblTemp>=0?(this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Value=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Value,this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Text=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Text,e=!1):(this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Value=this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Value,this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Text=this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Text,e=!0),this.dblTemp<0&&(this.dblTemp=-this.dblTemp)):null!=this.OldReportTotalMonthWise?(this.dblTemp=this.OldReportTotalMonthWise[0][r]+this.OldReportTotalMonthWise[1][r]+this.ReportTotalMonthWise[0][r]+this.ReportTotalMonthWise[1][r],this.ShowNetProfitBeforeAndAfter?(n||(this.dblTemp>=0?(this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Value=this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Value,this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Text=this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Text):(this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Value=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Value,this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Text=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Text)),this.dblTemp=-this.dblTemp,e=!0):(this.dblTemp>=0?(n||(this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Value=this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Value,this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Text=this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Text),e=!0):(n||(this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Value=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Value,this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Text=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Text),e=!1),this.dblTemp<0&&(this.dblTemp=-this.dblTemp))):(this.dblTemp=this.ReportTotalMonthWise[0][r]+this.ReportTotalMonthWise[1][r],this.dblTemp>=0?(n||(this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Value=this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Value,this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Text=this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Text),e=!0):(n||(this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Value=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Value,this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r].Text=this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r].Text),e=!1),this.dblTemp<0&&(this.dblTemp=-this.dblTemp)),0==this.dblTemp))continue;if(n){l=i>h?this.TempData[i].Cells[this.CellStartPos+this.ColumnSize+r]:this.TempData[h].Cells[this.CellStartPos+this.ColumnSize+r],this.ViewModel.SetCellValue(7!=this.ViewModel.StaticReportType&&e?-this.dblTemp:this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+r].DataFormat,"FLOAT",l);continue}let I=null;e?(l=this.GrossRows[0].Cells[this.CellStartPos+this.ColumnSize+r],t=this.GrossRows[0].Cells[this.GrossCellIndex+this.AccNameIndex],this.dblTemp>=0?(I=8!=this.ViewModel.StaticReportType?"Reports_LblNetLossForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossLossForPeriod":"Reports_LblNetLossForPeriod",this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+r].DataFormat,"FLOAT",l)):(I=8!=this.ViewModel.StaticReportType?"Reports_LblNetProfitForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossProfitForPeriod":"Reports_LblNetProfitForPeriod",this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+r].DataFormat,"FLOAT",l))):(l=this.GrossRows[1].Cells[this.CellStartPos+this.ColumnSize+r],t=this.GrossRows[1].Cells[this.GrossCellIndex+this.AccNameIndex],this.dblTemp>=0?(I=8!=this.ViewModel.StaticReportType?"Reports_LblNetProfitForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossProfitForPeriod":"Reports_LblNetProfitForPeriod",this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+r].DataFormat,"FLOAT",l)):(I=8!=this.ViewModel.StaticReportType?"Reports_LblNetLossForPeriod":-1==this.ReportRowStartIndex?"Reports_LblGrossLossForPeriod":"Reports_LblNetLossForPeriod",this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+r].DataFormat,"FLOAT",l))),null!=I&&(this.SetPLText(t,I),this.SetPLTextColor(l,I))}let s=this.TempData[i],a=this.TempData[h];this.TempData.RemoveAt(i),this.TempData.InsertAt(s,i),this.TempData.RemoveAt(h),this.TempData.InsertAt(a,h)}UpdateTreeTotals(e){if(e>this.lstTotal.length)for(let t=0;t<e-this.lstTotal.length;t++)this.lstParents.push(null),this.lstTotal.push(new Array(this.oColumns.length).fill(0));for(let t=this.lstTotal.length-1;t>=e;t--){if(t>0)for(let i=0;i<this.lstTotal[t].length;i++)this.lstTotal[t-1][i]+=this.lstTotal[t][i];if(0!=this.lstParents.length){if(null==this.lstParents[t]){this.lstParents.RemoveAt(t),this.lstTotal.RemoveAt(t);continue}if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.lstParents[t].IsExpanded){if(this.GroupTotalsSeperate)this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BalIndex+1],this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex]);else{if(this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BalIndex],this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex]),this.ShowBudget&&(this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex-1],this.oColumns[this.BalIndex-1].DataFormat,"FLOAT",this.lstParents[t].Cells[this.CellStartPos+this.BalIndex-1]),-1!=this.YTDIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTDIndex-1],this.lstTotal[t][this.YTDIndex-1],this.oColumns[this.YTDIndex-1]),-1!=this.BAL_LYIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BAL_LYIndex-1],this.lstTotal[t][this.BAL_LYIndex-1],this.oColumns[this.BAL_LYIndex-1]),-1!=this.YTD_LYIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTD_LYIndex-1],this.lstTotal[t][this.YTD_LYIndex-1],this.oColumns[this.YTD_LYIndex-1])),this.ShowTotalBudget&&this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex-this.TotalBudgetIndex],this.oColumns[this.BalIndex-this.TotalBudgetIndex].DataFormat,"FLOAT",this.lstParents[t].Cells[this.CellStartPos+this.BalIndex-this.TotalBudgetIndex]),this.ShowBudgetVariance&&(this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex+1],this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",this.lstParents[t].Cells[this.CellStartPos+this.BalIndex+1]),-1!=this.YTDIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTDIndex+1],this.lstTotal[t][this.YTDIndex+1],this.oColumns[this.YTDIndex+1]),-1!=this.BAL_LYIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BAL_LYIndex+1],this.lstTotal[t][this.BAL_LYIndex+1],this.oColumns[this.BAL_LYIndex+1]),-1!=this.YTD_LYIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTD_LYIndex+1],this.lstTotal[t][this.YTD_LYIndex+1],this.oColumns[this.YTD_LYIndex+1])),this.ShowBudgetVariancePercent){let i=0;this.lstTotal[t][this.BalIndex-1]>0&&(i=100*this.lstTotal[t][this.BalIndex+this.VariancePercentIndex]/this.lstTotal[t][this.BalIndex-1]),this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BalIndex+this.VariancePercentIndex],i,this.oColumns[this.BalIndex+this.VariancePercentIndex]),-1!=this.YTDIndex&&(i=0,this.lstTotal[t][this.YTDIndex-1]>0&&(i=100*this.lstTotal[t][this.YTDIndex+this.VariancePercentIndex]/this.lstTotal[t][this.YTDIndex-1]),this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTDIndex+this.VariancePercentIndex],i,this.oColumns[this.YTDIndex+this.VariancePercentIndex])),-1!=this.BAL_LYIndex&&(i=0,this.lstTotal[t][this.BAL_LYIndex-1]>0&&(i=100*this.lstTotal[t][this.BAL_LYIndex+this.VariancePercentIndex]/this.lstTotal[t][this.BAL_LYIndex-1]),this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BAL_LYIndex+this.VariancePercentIndex],i,this.oColumns[this.BAL_LYIndex+this.VariancePercentIndex])),-1!=this.YTD_LYIndex&&(i=0,this.lstTotal[t][this.YTD_LYIndex-1]>0&&(i=100*this.lstTotal[t][this.YTD_LYIndex+this.VariancePercentIndex]/this.lstTotal[t][this.YTD_LYIndex-1]),this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTD_LYIndex+this.VariancePercentIndex],i,this.oColumns[this.YTD_LYIndex+this.VariancePercentIndex]))}this.ShowSalesPercentage&&this.dblTotalSales>0&&this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex+this.SalesPercentIndex],this.oColumns[this.BalIndex+this.SalesPercentIndex].DataFormat,"FLOAT",this.lstParents[t].Cells[this.CellStartPos+this.BalIndex+this.SalesPercentIndex])}-1!=this.YTDIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTDIndex],this.lstTotal[t][this.YTDIndex],this.oColumns[this.YTDIndex]),-1!=this.BAL_LYIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.BAL_LYIndex],this.lstTotal[t][this.BAL_LYIndex],this.oColumns[this.BAL_LYIndex]),-1!=this.YTD_LYIndex&&this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.YTD_LYIndex],this.lstTotal[t][this.YTD_LYIndex],this.oColumns[this.YTD_LYIndex]);for(let i=0;i<this.CountMonths;i++)this.oColumns[this.ColumnSize+i].ID.startsWith("Perc_")?(this.dbl=0,0!=this.lstTotal[t][this.ColumnSize+i-1]&&0!=this.lstTotal[t][this.ColumnSize+i+1]&&(this.dbl=(this.lstTotal[t][this.ColumnSize+i-1]-this.lstTotal[t][this.ColumnSize+i+1])/this.lstTotal[t][this.ColumnSize+i+1]*100),this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.ColumnSize+i],this.dbl,this.oColumns[this.ColumnSize+i])):this.FormatData(this.lstParents[t].Cells[this.CellStartPos+this.ColumnSize+i],this.lstTotal[t][this.ColumnSize+i],this.oColumns[this.ColumnSize+i])}if(e<=this.LevelNo){let i=this.TempData.indexOf(this.lstParents[t]);if(i>=0){var l=this.TempData.find(h=>h.Parent==this.TempData[i]);if(this.TempData.RemoveAt(i),!this.IsValueExists(this.lstTotal[t])&&null==l)if(this.ReportFormat==A.Horizontal)if(0==this.CellStartPos)i=-1;else if(this.FirstTypeEndIndex<i)i=-1;else{for(let h=this.CellStartPos;h<this.oRow.Cells.length;h++)this.lstParents[t].Cells[h].Text="",this.lstParents[t].Cells[h].Value="";this.GrdRow--}else i=-1;if(-1!=i){if(this.TempData.InsertAt(this.lstParents[t],i),this.IsValueExists(this.lstTotal[t])&&this.GroupTotalsAtEnd&&(!this.DontShowSummaryGroupTotals||this.lstParents[t].IsExpanded)){if(this.GrdRow++,this.oSubTotal=this.TempData.length<=this.GrdRow?this.NewReportRow():this.TempData[this.GrdRow],this.oSubTotal.Type=w.QS.BalanceBF,this.oSubTotal.Parent=this.lstParents[t].Parent,this.oSubTotal.LevelNo=this.lstParents[t].LevelNo,this.oSubTotal.IsGroup=!0,this.oSubTotal.Visible=this.lstParents[t].Visible,this.oSubTotal.Cells[this.CellStartPos].Text="",this.cell=this.oSubTotal.Cells[this.CellStartPos+this.AccNameIndex],this.cell.IsNormal=!1,this.cell.level=this.lstParents[t].LevelNo,this.cell.Text=this.lstParents[t].Cells[this.CellStartPos+this.AccNameIndex].Text+" - TOTAL",this.cell.CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.cell.CellAppearance.Alignment=this.oColumns[this.AccNameIndex].DataAppearance.Alignment,this.GroupTotalsSeperate?(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].CellAppearance.Alignment=this.oColumns[this.BalIndex].DataAppearance.Alignment,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1],this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex])):(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance.Alignment=this.oColumns[this.BalIndex].DataAppearance.Alignment,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex],this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex])),this.ShowBudget&&(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-1].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-1].CellAppearance=this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-1],this.lstTotal[t][this.BalIndex-1],this.oColumns[this.BalIndex-1])),this.ShowTotalBudget&&(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-this.TotalBudgetIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-this.TotalBudgetIndex].CellAppearance=this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-this.TotalBudgetIndex],this.lstTotal[t][this.BalIndex-this.TotalBudgetIndex],this.oColumns[this.BalIndex-this.TotalBudgetIndex])),this.ShowBudgetVariance&&(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1].CellAppearance=this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+1],this.lstTotal[t][this.BalIndex+1],this.oColumns[this.BalIndex+1])),this.ShowBudgetVariancePercent){let h=0;this.lstTotal[t][this.BalIndex-1]>0&&(h=100*this.lstTotal[t][this.BalIndex+this.VariancePercentIndex]/this.lstTotal[t][this.BalIndex-1]),this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+this.VariancePercentIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+this.VariancePercentIndex].CellAppearance=this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+this.VariancePercentIndex],h,this.oColumns[this.BalIndex+this.VariancePercentIndex])}this.ShowSalesPercentage&&this.dblTotalSales>0&&(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+this.SalesPercentIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+this.SalesPercentIndex].CellAppearance=this.oSubTotal.Cells[this.CellStartPos+this.BalIndex].CellAppearance,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BalIndex+this.SalesPercentIndex],this.lstTotal[t][this.BalIndex+this.SalesPercentIndex],this.oColumns[this.BalIndex+this.SalesPercentIndex])),-1!=this.YTDIndex&&(this.oSubTotal.Cells[this.CellStartPos+this.YTDIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.YTDIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.YTDIndex].CellAppearance.Alignment=this.oColumns[this.YTDIndex].DataAppearance.Alignment,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.YTDIndex],this.lstTotal[t][this.YTDIndex],this.oColumns[this.YTDIndex])),-1!=this.BAL_LYIndex&&(this.oSubTotal.Cells[this.CellStartPos+this.BAL_LYIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.BAL_LYIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.BAL_LYIndex].CellAppearance.Alignment=this.oColumns[this.BAL_LYIndex].DataAppearance.Alignment,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.BAL_LYIndex],this.lstTotal[t][this.BAL_LYIndex],this.oColumns[this.BAL_LYIndex])),-1!=this.YTD_LYIndex&&(this.oSubTotal.Cells[this.CellStartPos+this.YTD_LYIndex].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.YTD_LYIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.YTD_LYIndex].CellAppearance.Alignment=this.oColumns[this.YTD_LYIndex].DataAppearance.Alignment,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.YTD_LYIndex],this.lstTotal[t][this.YTD_LYIndex],this.oColumns[this.YTD_LYIndex]));for(let h=0;h<this.CountMonths;h++)this.oSubTotal.Cells[this.CellStartPos+this.ColumnSize+h].IsNormal=!1,this.oSubTotal.Cells[this.CellStartPos+this.ColumnSize+h].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.CellStartPos+this.ColumnSize+h].CellAppearance.Alignment=this.oColumns[this.ColumnSize+h].DataAppearance.Alignment,this.FormatData(this.oSubTotal.Cells[this.CellStartPos+this.ColumnSize+h],this.lstTotal[t][this.ColumnSize+h],this.oColumns[this.ColumnSize+h]);this.TempData.length<=this.GrdRow?this.TempData.push(this.oSubTotal):(this.TempData.RemoveAt(this.GrdRow),this.TempData.InsertAt(this.oSubTotal,this.GrdRow))}}else this.GrdRow--}}this.lstParents.RemoveAt(t),this.lstTotal.RemoveAt(t)}}}GetBudgetAmount(e,l=null,t=null){let i=0;if(null!=l){let h,n=l;e.forEach(s=>{for(n=l;n<=t;)h=n.ToString("MMMyyyy"),i+=o.J0.Double(s[h]),n=n.AddMonths(1)})}else e.forEach(h=>{i+=o.J0.Double(h.AnnualAmount)});return i}IsValueExists(e){return!!e.find(l=>0!=l)}LoadPlainReport(){this.STACKROWS.Clear(),this.lstTotal.Clear(),this.AddOpeningStock();for(let e=0;e<this.dv.length;e++)this.drAccount=this.dv[e],this.IsIncome=this.IncomeAccounts.Contains(o.J0.Int(this.drAccount.AccountTypeID)),this.ReportTotalIndex=this.IsIncome?0:1,(0,L.yG0)(this.drAccount.IsGroup)?(this.dbl=0,this.AddRow_Plain()):(this.dbl=o.J0.Double(this.drAccount.Balance),(Math.abs(this.dbl)>.01||this.ShowAllAccounts)&&this.AddRow_Plain());this.AddClosingStock(),this.UpdateTreeTotals_Plain(999999999999,0),this.AddOpenBalanceDifference(),this.AddOpenBalanceDifferenceForBS(),7==this.ViewModel.StaticReportType?(this.dbl=this.ReportTotal[0]+this.ReportTotal[1],this.ShowGrossInIncome=!(this.dbl>=0),Math.abs(this.ReportTotal[0])>Math.abs(this.ReportTotal[1])?this.ReportTotal[1]=this.ReportTotal[1]-this.dbl:this.ReportTotal[0]=this.ReportTotal[0]-this.dbl,this.dbl<0&&(this.dbl=-this.dbl)):(this.dbl=this.ReportTotal[0]+this.ReportTotal[1],this.ReportTotal[0]=-this.ReportTotal[0],this.ReportTotal[0]>this.ReportTotal[1]?this.ReportTotal[1]=this.ReportTotal[0]>0?this.ReportTotal[0]:this.ReportTotal[0]=0:this.ReportTotal[0]=this.ReportTotal[1]>0?this.ReportTotal[1]:this.ReportTotal[1]=0,this.ShowGrossInIncome=!(Math.abs(this.ReportTotal[0])>=Math.abs(this.ReportTotal[1])&&this.dbl<0),this.dbl<0&&(this.dbl=-this.dbl)),this.AddReportTotal_Plain()}AddRow_Plain(){if(this.IsAddRow=0,this.oRow=this.NewReportRow(),this.oRow.IsGroup=(0,L.yG0)(this.drAccount.IsGroup),this.oRow.NodeID=o.J0.Int(this.drAccount.AccountID),this.oRow.LevelNo=o.J0.Int(this.drAccount.Depth)-1,this.oRow.DataRow=this.drAccount,this.IsAccountWise||(this.oRow.Cells[this.CellStartPos+this.BalIndex-1].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.BalIndex-1].level=this.oRow.LevelNo,this.UpdateTreeTotals_Plain(o.J0.Int(this.drAccount.lft),this.oRow.LevelNo)),(0,L.yG0)(this.drAccount.IsGroup)){this.oRow.Type=w.QS.BalanceBF;for(let e=this.CellStartPos;e<this.oRow.Cells.length;e++)this.oRow.Cells[e].IsNormal=!1,this.oRow.Cells[e].CellAppearance=this.BalanceBFAppearance.Clone(),this.oRow.Cells[e].CellAppearance.Alignment=this.ViewModel.ReportColumns[e].DataAppearance.Alignment}if(this.oRow.LevelNo<=this.LevelNo&&(this.GrdRow++,this.IsAddRow=1),(0,L.yG0)(this.drAccount.IsGroup)){let e=new $;e.Row=this.oRow,e.Lft=o.J0.Int(this.drAccount.lft),e.Rgt=o.J0.Int(this.drAccount.rgt),this.STACKROWS.push(e),this.lstTotal.push(new Array(this.oColumns.length+1).fill(0))}else this.ReportTotal[this.ReportTotalIndex]+=this.dbl;this.TextFields.keys.forEach(e=>{let l_Value=this.TextFields[e];this.oRow.Cells[this.CellStartPos+l_Value].Text=this.drAccount[e].toString(),this.oRow.Cells[this.CellStartPos+l_Value].Value=this.oRow.Cells[this.CellStartPos+l_Value].Text}),this.oRow.IsGroup||(this.FormatData(this.ClubIncomeExpenseInPlainReport?this.oRow.Cells[this.CellStartPos+this.BalIndex]:this.IsIncome&&!this.ShowIncomeFirst||!this.IsIncome&&this.ShowIncomeFirst?this.oRow.Cells[this.CellStartPos+this.BalIndex+1]:this.oRow.Cells[this.CellStartPos+this.BalIndex],this.dbl,this.oColumns[this.BalIndex]),this.ViewModel.ApplyKPI(this.oRow)),this.lstTotal.length>0&&(this.IsIncome?this.lstTotal[this.lstTotal.length-1][this.BalIndex]+=this.dbl:this.lstTotal[this.lstTotal.length-1][this.BalIndex+1]+=this.dbl),1==this.IsAddRow&&(this.ShowdetailsofControlGroups||(this.oRow.IsExpanded=!(0,L.yG0)(this.drAccount.IsSummary),(0,L.yG0)(this.drAccount.IsSummary)&&(this.oRow.Type=w.QS.Detail),this.oRow.IsGroup?this.STACKROWS.length>1&&(this.oRow.Parent=this.STACKROWS[this.STACKROWS.length-2].Row):this.STACKROWS.length>0&&(this.oRow.Parent=this.STACKROWS[this.STACKROWS.length-1].Row),null!=this.oRow.Parent&&(!this.oRow.Parent.IsExpanded||!this.oRow.Parent.Visible)&&(this.oRow.Visible=!1)),this.TempData.push(this.oRow))}UpdateTreeTotals_Plain(e,l){for(let t=this.lstTotal.length-1;t>=0&&e>this.STACKROWS[t].Rgt;t--){if(t>0)for(let i=0;i<this.lstTotal[t].length;i++)this.lstTotal[t-1][i]+=this.lstTotal[t][i];if(l<=this.LevelNo){let i=this.TempData.indexOf(this.STACKROWS[t].Row);if(i>=0)if(0==this.lstTotal[t][this.BalIndex]&&0==this.lstTotal[t][this.BalIndex+1])this.TempData.RemoveAt(i);else{if(!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.STACKROWS[t].Row.IsExpanded?this.oTempRow=this.STACKROWS[t].Row:(this.oSubTotal=this.NewReportRow(),this.oTempRow=this.oSubTotal,this.oSubTotal.Type=w.QS.BalanceBF,this.oSubTotal.Parent=this.STACKROWS[t].Row.Parent,this.oSubTotal.LevelNo=this.STACKROWS[t].Row.LevelNo,this.oSubTotal.IsGroup=!0,this.oSubTotal.Visible=this.STACKROWS[t].Row.Visible,this.cell=this.oSubTotal.Cells[this.CellStartPos+this.BalIndex-1],this.cell.IsNormal=!1,this.cell.level=this.STACKROWS[t].Row.LevelNo,this.cell.Text=this.STACKROWS[t].Row.Cells[this.BalIndex-1].Text+" - TOTAL",this.cell.CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.cell.CellAppearance.Alignment=this.oColumns[this.BalIndex-1].DataAppearance.Alignment,this.GroupTotalsSeperate?(this.oSubTotal.Cells[this.GroupTotalIndex].IsNormal=!1,this.oSubTotal.Cells[this.GroupTotalIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.GroupTotalIndex].CellAppearance.Alignment=this.oColumns[this.BalIndex].DataAppearance.Alignment):(this.oSubTotal.Cells[this.BalIndex].IsNormal=!1,this.oSubTotal.Cells[this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.BalIndex].CellAppearance.Alignment=this.oColumns[this.BalIndex].DataAppearance.Alignment,this.ClubIncomeExpenseInPlainReport||(this.oSubTotal.Cells[this.BalIndex+1].IsNormal=!1,this.oSubTotal.Cells[this.BalIndex+1].CellAppearance=this.GrossTotalAppearance_Data.Clone(),this.oSubTotal.Cells[this.BalIndex+1].CellAppearance.Alignment=this.oColumns[this.BalIndex+1].DataAppearance.Alignment))),this.GroupTotalsSeperate)7!=this.ViewModel.StaticReportType?(this.dblTemp=-(this.lstTotal[t][this.BalIndex]+this.lstTotal[t][this.BalIndex+1]),this.dblTemp=Math.abs(this.dblTemp),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oTempRow.Cells[this.GroupTotalIndex])):(this.dblTemp=this.lstTotal[t][this.BalIndex]+this.lstTotal[t][this.BalIndex+1],this.dblTemp=Math.abs(this.dblTemp),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oTempRow.Cells[this.GroupTotalIndex]));else if(this.ClubIncomeExpenseInPlainReport)7!=this.ViewModel.StaticReportType?(this.dblTemp=-(this.lstTotal[t][this.BalIndex]+this.lstTotal[t][this.BalIndex+1]),this.dblTemp=Math.abs(this.dblTemp),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oTempRow.Cells[this.CellStartPos+this.BalIndex])):(this.dblTemp=this.lstTotal[t][this.BalIndex]+this.lstTotal[t][this.BalIndex+1],this.dblTemp=Math.abs(this.dblTemp),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oTempRow.Cells[this.CellStartPos+this.BalIndex]));else{let h,n;this.ShowIncomeFirst?(h=this.oTempRow.Cells[this.CellStartPos+this.BalIndex],n=this.oTempRow.Cells[this.CellStartPos+this.BalIndex+1]):(h=this.oTempRow.Cells[this.CellStartPos+this.BalIndex+1],n=this.oTempRow.Cells[this.CellStartPos+this.BalIndex]),7!=this.ViewModel.StaticReportType?(this.lstTotal[t][this.BalIndex]<=0?this.ViewModel.SetCellValue(-this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex].DataFormat,"FLOAT",h):(this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex].DataFormat,"FLOAT",h),h.Text+="Dr"),this.lstTotal[t][this.BalIndex+1]>=0?this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex+1],this.oColumns[this.BalIndex].DataFormat,"FLOAT",n):(this.ViewModel.SetCellValue(-this.lstTotal[t][this.BalIndex+1],this.oColumns[this.BalIndex].DataFormat,"FLOAT",n),n.Text+="Cr")):(this.lstTotal[t][this.BalIndex]>=0?this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex].DataFormat,"FLOAT",h):(this.ViewModel.SetCellValue(-this.lstTotal[t][this.BalIndex],this.oColumns[this.BalIndex].DataFormat,"FLOAT",h),h.Text+="Cr"),this.lstTotal[t][this.BalIndex+1]<=0?this.ViewModel.SetCellValue(-this.lstTotal[t][this.BalIndex+1],this.oColumns[this.BalIndex].DataFormat,"FLOAT",n):(this.ViewModel.SetCellValue(this.lstTotal[t][this.BalIndex+1],this.oColumns[this.BalIndex].DataFormat,"FLOAT",n),n.Text+="Dr"))}!this.GroupTotalsAtEnd||this.DontShowSummaryGroupTotals&&!this.STACKROWS[t].Row.IsExpanded?(this.TempData.RemoveAt(i),this.TempData.InsertAt(this.STACKROWS[t].Row,i)):(this.GrdRow++,this.TempData.push(this.oSubTotal))}}this.STACKROWS.RemoveAt(t),this.lstTotal.RemoveAt(t)}}AddReportTotal_Plain(){let e=null,l=null;if(this.GrdRow++,l=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),l.LevelNo=0,this.GrdRow++,e=this.NewReportRow_2(w.QS.ReportTotal,this.ViewModel.GrpReportTotal.SubTotalAppearance),this.ViewModel.GrpReportTotal.Height>0&&(e.Height=this.ViewModel.GrpReportTotal.Height),e.Cells[this.CellStartPos].Text=T.d.GetResource("Reports_ReportTotal"),e.LevelNo=0,this.GrossCellIndex=this.CellStartPos+this.BalIndex,l.Cells[this.CellStartPos+this.BalIndex-1].CellAppearance=this.GrossTotalAppearance,1==this.ShowGrossInIncome?(!this.ClubIncomeExpenseInPlainReport&&!this.ShowIncomeFirst&&this.GrossCellIndex++,this.dbl>=0?this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",l.Cells[this.GrossCellIndex]):(this.ViewModel.SetCellValue(-this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",l.Cells[this.GrossCellIndex]),l.Cells[this.GrossCellIndex].Text+="Dr"),this.SetPLText(l.Cells[this.CellStartPos+this.BalIndex-1],"Reports_LblNetLossForPeriod"),this.SetPLTextColor(l.Cells[this.GrossCellIndex],"Reports_LblNetLossForPeriod")):(!this.ClubIncomeExpenseInPlainReport&&this.ShowIncomeFirst&&this.GrossCellIndex++,this.dbl>=0?this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",l.Cells[this.GrossCellIndex]):(this.ViewModel.SetCellValue(-this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",l.Cells[this.GrossCellIndex]),l.Cells[this.GrossCellIndex].Text+="Cr"),this.SetPLText(l.Cells[this.CellStartPos+this.BalIndex-1],"Reports_LblNetProfitForPeriod"),this.SetPLTextColor(l.Cells[this.GrossCellIndex],"Reports_LblNetProfitForPeriod")),this.ClubIncomeExpenseInPlainReport)this.ViewModel.SetCellValue(Math.abs(this.ReportTotal[0])-Math.abs(this.ReportTotal[1]),this.oColumns[this.BalIndex].DataFormat,"FLOAT",e.Cells[this.CellStartPos+this.BalIndex]),e.Cells[this.CellStartPos+this.BalIndex].CellAppearance.Alignment="Right";else{let t=e.Cells[this.CellStartPos+this.BalIndex],i=e.Cells[this.CellStartPos+this.BalIndex+1];this.ShowIncomeFirst||(t=e.Cells[this.CellStartPos+this.BalIndex+1],i=e.Cells[this.CellStartPos+this.BalIndex]),this.ViewModel.SetCellValue(Math.abs(this.ReportTotal[0]),this.oColumns[this.BalIndex].DataFormat,"FLOAT",t),this.ViewModel.SetCellValue(Math.abs(this.ReportTotal[1]),this.oColumns[this.BalIndex].DataFormat,"FLOAT",i),t.CellAppearance.Alignment=i.CellAppearance.Alignment="Right"}e.Cells[this.CellStartPos].ColSpan=this.CellStartPos+this.BalIndex,this.IgnoreGrossRowsForBS||(0==this.RetainedEarningAccount||Math.abs(this.dbl)>.01)&&this.TempData.push(l),this.ViewModel.GrpReportTotal.GroupAppearance.IsVisible&&this.TempData.push(e)}AddNetProfitBeforeOtherIncome(){if(-1!=this.ReportRowStartIndex&&this.ShowNetProfitBeforeAndAfter&&(this.oRow=null,this.ReportFormat==A.Vertical?this.IsFirstCall&&(this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.LevelNo=0,this.TempData.push(this.oRow)):this.ReportFormat==A.Horizontal&&(this.IsFirstCall&&(this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.LevelNo=0,this.TempData.InsertAt(this.oRow,this.GrdRow)),this.IsIncome&&(this.oRow=null)),null!=this.oRow)){let e=this.Olddbl-this.ReportTotal[1];this.ShowGrossInIncome&&!this.IsIncome&&(e=-this.ReportTotal[1]),e>0?(this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=T.d.GetResource("Reports_LblNetProfitBefore").toUpperCase(),this.ViewModel.Preferences.ContainsKey("Reports_LblNetProfitForPeriodClr")&&(this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance.ForeColor=this.ViewModel.Preferences.Reports_LblNetProfitForPeriodClr,this.oRow.Cells[this.CellStartPos+this.BalIndex].CellAppearance.ForeColor=this.ViewModel.Preferences.Reports_LblNetProfitForPeriodClr)):(e=-e,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=T.d.GetResource("Reports_LblNetLossBefore").toUpperCase(),this.ViewModel.Preferences.ContainsKey("Reports_LblNetLossForPeriodClr")&&(this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance.ForeColor=this.ViewModel.Preferences.Reports_LblNetLossForPeriodClr,this.oRow.Cells[this.CellStartPos+this.BalIndex].CellAppearance.ForeColor=this.ViewModel.Preferences.Reports_LblNetLossForPeriodClr)),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance.Alignment="Left",this.ViewModel.SetCellValue(e,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.ShowSalesPercentage&&this.dblTotalSales>0&&(this.dblTemp=100*e/this.dblTotalSales,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.SalesPercentIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex+this.SalesPercentIndex]));for(let l=0;l<this.CountMonths;l++)this.dblTemp=this.OldReportTotalMonthWise[0][l]+this.OldReportTotalMonthWise[1][l]+(this.ReportTotalMonthWise[0][l]+this.ReportTotalMonthWise[1][l]),e>0&&(this.dblTemp=-this.dblTemp),this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+l].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.ColumnSize+l]);this.TempData.RemoveAt(this.GrdRow),this.TempData.InsertAt(this.oRow,this.GrdRow)}}AddRow_BF(){this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.LevelNo=0,this.ReportFormat==A.Vertical?this.ShowGrossInIncome&&!this.IsIncome?(this.ReportTotal[1]=this.Olddbl,this.AddGrossToVariance&&(this.ShowBudgetVariance&&(this.ReportTotalALL[1][this.BalIndex+1]=-this.Olddbl),this.ShowBudgetVariancePercent&&(this.ReportTotalALL[1][this.BalIndex+this.VariancePercentIndex]=-this.Olddbl)),this.ShowCarryForward&&(this.GrdRow++,this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_BalanceBF"),this.ViewModel.SetCellValue(this.Olddbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex]),this.AddGrossToVariance&&this.ShowBudgetVariance&&this.ViewModel.SetCellValue(this.ReportTotalALL[1][this.BalIndex+1],this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex+1]),this.TempData.push(this.oRow))):!this.ShowGrossInIncome&&this.IsIncome&&(this.ReportTotal[0]=-this.Olddbl,this.AddGrossToVariance&&(this.ShowBudgetVariance&&(this.ReportTotalALL[0][this.BalIndex+1]=this.Olddbl),this.ShowBudgetVariancePercent&&(this.ReportTotalALL[0][this.BalIndex+this.VariancePercentIndex]=this.Olddbl)),this.ShowCarryForward&&(this.GrdRow++,this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_BalanceBF"),this.ViewModel.SetCellValue(this.Olddbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex]),this.AddGrossToVariance&&this.ShowBudgetVariance&&this.ViewModel.SetCellValue(this.ReportTotalALL[0][this.BalIndex+1],this.oColumns[this.BalIndex+1].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex+1]),this.TempData.push(this.oRow))):(this.ShowCarryForward&&this.GrdRow++,this.IsFirstCall&&(this.ShowCarryForward&&(this.ShowIncomeFirst&&!this.ShowGrossInIncome||!this.ShowIncomeFirst&&this.ShowGrossInIncome?(this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_BalanceBF"),this.ViewModel.SetCellValue(this.Olddbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.BalIndex]),this.TempData.push(this.oRow)):(this.oRow.Cells[this.ColumnSize+this.AccNameIndex].Text=T.d.GetResource("Reports_BalanceBF"),this.ViewModel.SetCellValue(this.Olddbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.ColumnSize+this.BalIndex]),this.TempData.push(this.oRow))),this.ShowGrossInIncome?this.ReportTotal[1]=this.Olddbl:this.ReportTotal[0]=-this.Olddbl))}AddOpeningStock(){if(!this.IncludeOpeningStock&&0==this.ClosingStockAccount)return;let e;if(0!=this.ClosingStockAccount?(this.dblOpeningStock=0,e=this.dsNew.Tables[0].filter(l=>l.AccountID==this.ClosingStockAccount),e.forEach(l=>{this.dblOpeningStock+=o.J0.Double(l.Balance)})):e=[],this.ReportFormat==A.Plain){if(this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_LblOpeningStock"),this.ViewModel.SetCellValue(this.dblOpeningStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.ShowIncomeFirst?this.oRow.Cells[this.CellStartPos+this.BalIndex+1]:this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow),null!=this.dsOpenStock&&this.dsOpenStock.Tables.length>1&&this.dsOpenStock.Columns[1].length>2)for(let l=0;l<this.dsOpenStock.Tables[1].length;l++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=this.dsOpenStock.Tables[1][l].ProductName.toString()+" "+T.d.GetResource("Reports_LblOpeningStock"),this.dbl=o.J0.Double(this.dsOpenStock.Tables[1][l].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.ShowIncomeFirst?this.oRow.Cells[this.CellStartPos+this.BalIndex+1]:this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)}else if(this.ReportFormat==A.Vertical){if(this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_LblOpeningStock"),this.ViewModel.SetCellValue(this.dblOpeningStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),null!=this.dsOpeningStock){let l;for(let t=0;t<this.CountMonths;t++)if(o.J0.IsNum(this.oColumns[this.CellStartPos+this.ColumnSize+t].ID)){l=o.J0.Int(this.oColumns[this.CellStartPos+this.ColumnSize+t].ID),this.dblTemp=0;let i=[];this.dsOpeningStock.Tables.length>0&&(i=this.dsOpeningStock.Tables[0].filter(h=>h.TagID==l)),i.length>0&&(this.dblTemp=o.J0.Double(i[0].BalValue)),this.ReportTotalMonthWise[1][t]=this.IsIncomeNegative?this.dblTemp:-this.dblTemp,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+t].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.ColumnSize+t])}}if(this.TempData.push(this.oRow),null!=this.dsOpenStock&&this.dsOpenStock.Tables.length>1&&this.dsOpenStock.Columns[1].length>2)for(let l=0;l<this.dsOpenStock.Tables[1].length;l++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=this.dsOpenStock.Tables[1][l].ProductName.toString()+" "+T.d.GetResource("Reports_LblOpeningStock"),this.dbl=o.J0.Double(this.dsOpenStock.Tables[1][l].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)}else if(this.ReportFormat==A.Horizontal)if(this.GrdRow++,this.IsFirstCall||this.GrdRow>this.FirstTypeEndIndex){if(this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=T.d.GetResource("Reports_LblOpeningStock"),this.ViewModel.SetCellValue(this.dblOpeningStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow),null!=this.dsOpenStock&&this.dsOpenStock.Tables.length>1&&this.dsOpenStock.Columns[1].length>2)for(let l=0;l<this.dsOpenStock.Tables[1].length;l++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=this.dsOpenStock.Tables[1][l].ProductName.toString()+" "+T.d.GetResource("Reports_LblOpeningStock"),this.dbl=o.J0.Double(this.dsOpenStock.Tables[1][l].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)}else if(this.oRow=this.TempData[this.GrdRow],this.oRow.Cells[this.CellStartPos+this.AccNameIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=T.d.GetResource("Reports_LblOpeningStock"),this.oRow.Cells[this.CellStartPos+this.BalIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data,this.ViewModel.SetCellValue(this.dblOpeningStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.Remove(this.oRow),this.TempData.InsertAt(this.oRow,this.GrdRow),null!=this.dsOpenStock&&this.dsOpenStock.Tables.length>1&&this.dsOpenStock.Columns[1].length>2)for(let l=0;l<this.dsOpenStock.Tables[1].length;l++)this.GrdRow++,this.GrdRow>this.FirstTypeEndIndex?(this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=this.dsOpenStock.Tables[1][l].ProductName.toString()+" "+T.d.GetResource("Reports_LblOpeningStock"),this.dbl=o.J0.Double(this.dsOpenStock.Tables[1][l].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)):(this.oRow=this.TempData[this.GrdRow],this.oRow.Cells[this.CellStartPos+this.AccNameIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=this.dsOpenStock.Tables[1][l].ProductName.toString()+" "+T.d.GetResource("Reports_LblOpeningStock"),this.oRow.Cells[this.CellStartPos+this.BalIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data,this.dbl=o.J0.Double(this.dsOpenStock.Tables[1][l].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.Remove(this.oRow),this.TempData.Insert(this.GrdRow,this.oRow));this.ReportTotal[1]=this.IsIncomeNegative?this.dblOpeningStock:-this.dblOpeningStock}AddClosingStock(){if(this.IncludeClosingStock){if(this.ReportFormat==A.Plain){if(this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_LblClosingStock"),this.ViewModel.SetCellValue(this.dblClosingStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.ShowIncomeFirst?this.oRow.Cells[this.CellStartPos+this.BalIndex]:this.oRow.Cells[this.CellStartPos+this.BalIndex+1]),this.TempData.push(this.oRow),null!=this.dsCloseStock&&this.dsCloseStock.Tables.length>1&&this.dsCloseStock.Columns[1].length>2)for(let e=0;e<this.dsCloseStock.Tables[1].length;e++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=this.dsCloseStock.Tables[1][e].ProductName.toString()+" "+T.d.GetResource("Reports_LblClosingStock"),this.dbl=o.J0.Double(this.dsCloseStock.Tables[1][e].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.ShowIncomeFirst?this.oRow.Cells[this.CellStartPos+this.BalIndex]:this.oRow.Cells[this.CellStartPos+this.BalIndex+1]),this.TempData.push(this.oRow)}else if(this.ReportFormat==A.Vertical){if(this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_LblClosingStock"),this.ViewModel.SetCellValue(this.dblClosingStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),null!=this.dsClosingStock){let e;for(let l=0;l<this.CountMonths;l++)if(o.J0.IsNum(this.oColumns[this.CellStartPos+this.ColumnSize+l].ID)){e=o.J0.Int(this.oColumns[this.CellStartPos+this.ColumnSize+l].ID),this.dblTemp=0;let t=[];this.dsClosingStock.Tables.length>0&&(t=this.dsClosingStock.Tables[0].filter(i=>i.TagID==e)),t.length>0&&(this.dblTemp=o.J0.Double(t[0].BalValue)),this.ReportTotalMonthWise[0][l]=this.IsIncomeNegative?this.ReportTotalMonthWise[0][l]-this.dblTemp:this.ReportTotalMonthWise[0][l]+this.dblTemp,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+l].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.ColumnSize+l])}}if(this.TempData.push(this.oRow),null!=this.dsCloseStock&&this.dsCloseStock.Tables.length>1&&this.dsCloseStock.Columns[1].length>2)for(let e=0;e<this.dsCloseStock.Tables[1].length;e++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.AccNameIndex].Text=this.dsCloseStock.Tables[1][e].ProductName.toString()+" "+T.d.GetResource("Reports_LblClosingStock"),this.dbl=o.J0.Double(this.dsCloseStock.Tables[1][e].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)}else if(this.ReportFormat==A.Horizontal)if(this.GrdRow++,this.IsFirstCall||this.GrdRow>this.FirstTypeEndIndex){if(this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=T.d.GetResource("Reports_LblClosingStock"),this.ViewModel.SetCellValue(this.dblClosingStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow),null!=this.dsCloseStock&&this.dsCloseStock.Tables.length>1&&this.dsCloseStock.Columns[1].length>2)for(let e=0;e<this.dsCloseStock.Tables[1].length;e++)this.GrdRow++,this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=this.dsCloseStock.Tables[1][e].ProductName.toString()+" "+T.d.GetResource("Reports_LblClosingStock"),this.dbl=o.J0.Double(this.dsCloseStock.Tables[1][e].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)}else if(this.oRow=this.TempData[this.GrdRow],this.oRow.Cells[this.CellStartPos+this.AccNameIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=T.d.GetResource("Reports_LblClosingStock"),this.oRow.Cells[this.CellStartPos+this.BalIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data,this.ViewModel.SetCellValue(this.dblClosingStock,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.Remove(this.oRow),this.TempData.InsertAt(this.oRow,this.GrdRow),null!=this.dsCloseStock&&this.dsCloseStock.Tables.length>1&&this.dsCloseStock.Columns[1].length>2)for(let e=0;e<this.dsCloseStock.Tables[1].length;e++)this.GrdRow++,this.GrdRow>this.FirstTypeEndIndex?(this.oRow=this.NewReportRow_2(w.QS.GrossTotal,this.GrossTotalAppearance_Data),this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=this.dsCloseStock.Tables[1][e].ProductName.toString()+" "+T.d.GetResource("Reports_LblClosingStock"),this.dbl=o.J0.Double(this.dsCloseStock.Tables[1][e].Balance.toString()),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.push(this.oRow)):(this.oRow=this.TempData[this.GrdRow],this.oRow.Cells[this.CellStartPos+this.AccNameIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.oRow.Cells[this.CellStartPos+this.AccNameIndex].Text=this.dsCloseStock.Tables[1][e].ProductName.toString()+" "+T.d.GetResource("Reports_LblClosingStock"),this.oRow.Cells[this.CellStartPos+this.BalIndex].IsNormal=!1,this.oRow.Cells[this.CellStartPos+this.BalIndex].CellAppearance=this.GrossTotalAppearance_Data,this.dbl=this.dsCloseStock.Tables[1][e].Balance.toString(),this.ViewModel.SetCellValue(this.dbl,this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.oRow.Cells[this.CellStartPos+this.BalIndex]),this.TempData.Remove(this.oRow),this.TempData.Insert(this.GrdRow,this.oRow));this.ReportTotal[0]=this.IsIncomeNegative?this.ReportTotal[0]-this.dblClosingStock:this.ReportTotal[0]+this.dblClosingStock}}AddGroup(e){this.ReportFormat==A.Vertical?(this.GrdRow++,this.row=this.NewReportRow_2(w.QS.Header,this.IncomeExpenseHeader),this.row.Height=this.row.Height+3,this.row.LevelNo=0):this.ReportFormat==A.Horizontal&&(this.GrdRow++,this.IsFirstCall?(this.row=this.NewReportRow_2(w.QS.Header,this.IncomeExpenseHeader),this.row.Height=this.row.Height+2,this.row.LevelNo=0):this.row=this.TempData[this.GrdRow]),this.row.Cells[this.CellStartPos].Text=e,null!=this.row.Cells[this.CellStartPos].CellAppearance&&(this.row.Cells[this.CellStartPos].CellAppearance.Alignment="Center"),this.row.Cells[this.CellStartPos].ColSpan=this.ColumnSize,o.J0.IsEmpty(e)&&(this.row.Visible=!1),-1==this.TempData.indexOf(this.row)?this.TempData.push(this.row):(this.TempData.RemoveAt(this.GrdRow),this.TempData.InsertAt(this.row,this.GrdRow))}FormatData(e,l,t){if(4==this.NegNumber)this.IsIncomeNegative&&this.IsIncome||!this.IsIncomeNegative&&!this.IsIncome?l<=0&&!t.ID.startsWith("Perc_")?this.ViewModel.SetCellValue(-l,t.DataFormat,"FLOAT",e):(this.ViewModel.SetCellValue(l,t.DataFormat,"FLOAT",e),t.DataFormat.NumberFormat.length>0&&(e.Text+=" "),!t.ID.startsWith("Budget")&&!t.ID.startsWith("Perc_")&&(e.Text+="Dr")):l>=0?this.ViewModel.SetCellValue(l,t.DataFormat,"FLOAT",e):(this.ViewModel.SetCellValue(-l,t.DataFormat,"FLOAT",e),t.DataFormat.NumberFormat.length>0&&(e.Text+=" "),!t.ID.startsWith("Budget")&&!t.ID.startsWith("Perc_")&&(e.Text+="Cr"));else{let h="",n="";if(this.IsIncomeNegative&&this.IsIncome||!this.IsIncomeNegative&&!this.IsIncome){if(l<=0)this.SetCellValue(-l,t.DataFormat,h,n,e);else if(0==t.DataFormat.NegativeNumber?h="-":n="Dr",this.SetCellValue(l,t.DataFormat,h,n,e),0==t.DataFormat.NegativeNumber&&(e.Value=-l),9==this.ViewModel.ReportID&&parseFloat(e.Value)<0){let s=parseFloat(e.Value);if(null!=(i=this.ViewModel.ColumnSource.find(a=>a.ID==t.ID))){let a="",r="";switch(r=i.DataFormat.DecimalsPoints>0?"N"+i.DataFormat.DecimalsPoints.toString():"N0",i.DataFormat.NegativeNumber){case 1:e.IsNegativeRed=!0,a=s.Commas(r,i.DataFormat.Commas).Replace("-","");break;case 2:a="("+s.Commas(r,i.DataFormat.Commas).Replace("-","")+")";break;case 3:e.IsNegativeRed=!0,a="("+s.Commas(r,i.DataFormat.Commas).Replace("-","")+")";break;case 4:case 7:a=(-s).Commas(r,i.DataFormat.Commas)+"Cr";break;case 5:a=(-s).Commas(r,i.DataFormat.Commas)+"Dr";break;case 8:a="+"+(-s).Commas(r,i.DataFormat.Commas);break;case 12:a=(-s).Commas(r,i.DataFormat.Commas)}o.J0.IsEmpty(a)&&(a=s.Commas(r,i.DataFormat.Commas)),e.Text=a}}}else if(l>=0)this.SetCellValue(l,t.DataFormat,h,n,e);else if(0==t.DataFormat.NegativeNumber?h="-":n="Cr",this.SetCellValue(-l,t.DataFormat,h,n,e),0==t.DataFormat.NegativeNumber&&(e.Value=l),9==this.ViewModel.ReportID&&parseFloat(e.Value)<0){let s=parseFloat(e.Value);var i;if(null!=(i=this.ViewModel.ColumnSource.find(r=>r.ID==t.ID))){let r="",I="";switch(I=i.DataFormat.DecimalsPoints>0?"N"+i.DataFormat.DecimalsPoints.toString():"N0",i.DataFormat.NegativeNumber){case 1:e.IsNegativeRed=!0,r=s.Commas(I,i.DataFormat.Commas).Replace("-","");break;case 2:r="("+s.Commas(I,i.DataFormat.Commas).Replace("-","")+")";break;case 3:e.IsNegativeRed=!0,r="("+s.Commas(I,i.DataFormat.Commas).Replace("-","")+")";break;case 4:case 7:r=(-s).Commas(I,i.DataFormat.Commas)+"Cr";break;case 5:r=(-s).Commas(I,i.DataFormat.Commas)+"Dr";break;case 8:r="+"+(-s).Commas(I,i.DataFormat.Commas);break;case 12:r=(-s).Commas(I,i.DataFormat.Commas)}o.J0.IsEmpty(r)&&(r=s.Commas(I,i.DataFormat.Commas)),e.Text=r}}}}SetCellValue(e,l,t,i,h){h.IsNegativeRed=!1;let s,n="";if(n=l.DecimalsPoints>0?"N"+l.DecimalsPoints.toString():"N0",l.RoundOff>0){let a=e%l.RoundOff;a<l.RoundOff/2?e-=a:e=e+l.RoundOff-a}h.Value=e,s=l.NumberFormat.length>0?Z.ReportViewModel.NumbetFormatted(e,l):e.Commas(n,l.Commas),t.length>0&&(s=t+s),i.length>0&&(s+=i),o.J0.IsEmpty(l.PercentageOn)||(s+="%"),h.Text=s}AddOpenBalanceDifference(){}AddOpenBalanceDifferenceForBS(){if(7==this.ViewModel.StaticReportType&&(this.dblTemp=this.dblOpeningBalanceDifference,o.J0.Double(Math.abs(this.dblTemp).ToString("N1"))>.1))if(this.row=this.NewReportRow_2(w.QS.BalanceBF,this.GrossTotalAppearance_Data),this.row.LevelNo=0,this.ReportFormat==A.Plain)this.row.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.row.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_OpeningBalanceDifference"),this.dblTemp>0?(this.ReportTotalIndex=this.ShowIncomeFirst?0:1,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.ReportTotalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex+this.ReportTotalIndex]),this.ReportTotal[0]+=this.dblTemp):(this.ReportTotalIndex=this.ShowIncomeFirst?1:0,this.ViewModel.SetCellValue(-this.dblTemp,this.oColumns[this.BalIndex+this.ReportTotalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex+this.ReportTotalIndex]),this.ReportTotal[1]+=this.dblTemp),this.GrdRow++,this.TempData.push(this.row);else if(this.ReportFormat==A.Horizontal)this.dblTemp>0?(this.ReportTotalIndex=this.ShowIncomeFirst?0:this.ColumnSize,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.BalIndex+this.ReportTotalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex+this.ReportTotalIndex]),this.ReportTotal[0]+=this.dblTemp):(this.ReportTotalIndex=this.ShowIncomeFirst?this.ColumnSize:0,this.ViewModel.SetCellValue(-this.dblTemp,this.oColumns[this.BalIndex+this.ReportTotalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex+this.ReportTotalIndex]),this.ReportTotal[1]+=this.dblTemp),this.row.Cells[this.ReportTotalIndex+this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.row.Cells[this.ReportTotalIndex+this.AccNameIndex].Text=T.d.GetResource("Reports_OpeningBalanceDifference"),this.FirstTypeEndIndex<this.GrdRow?this.GrdRow++:this.FirstTypeEndIndex++,this.TempData.push(this.row);else if(this.ReportFormat==A.Vertical){this.GrdRow++,this.row.Cells[this.AccNameIndex].CellAppearance=this.GrossTotalAppearance,this.row.Cells[this.AccNameIndex].Text=T.d.GetResource("Reports_OpeningBalanceDifference");let e=0;if(this.dblTemp<0&&(e=1),this.ViewModel.SetCellValue(Math.abs(this.dblTemp),this.oColumns[this.BalIndex].DataFormat,"FLOAT",this.row.Cells[this.BalIndex]),this.ReportTotal[e]+=this.dblTemp,this.Show==d.TagWise)for(let l=0;l<this.CountMonths;l++)this.lstTagsOpeningBalance.ContainsKey(this.oColumns[this.CellStartPos+this.ColumnSize+l].ID)&&(this.dblTemp=this.lstTagsOpeningBalance[this.oColumns[this.CellStartPos+this.ColumnSize+l].ID],e=0,this.dblTemp<0&&(e=1),this.ReportTotalMonthWise[e][l]+=this.dblTemp,this.ViewModel.SetCellValue(this.dblTemp,this.oColumns[this.CellStartPos+this.ColumnSize+l].DataFormat,"FLOAT",this.row.Cells[this.CellStartPos+this.ColumnSize+l]));else if(this.Show!=d.TagWise)for(let l=0;l<this.CountMonths;l++)this.ReportTotalMonthWise[e][l]+=this.dblTemp,this.ViewModel.SetCellValue(Math.abs(this.dblTemp),this.oColumns[this.CellStartPos+this.ColumnSize+l].DataFormat,"FLOAT",this.row.Cells[this.CellStartPos+this.ColumnSize+l]);this.dblTemp>0?this.ShowIncomeFirst?(this.FirstTypeEndIndex++,this.TempData.InsertAt(this.row,this.FirstTypeEndIndex)):this.TempData.push(this.row):this.ShowIncomeFirst?this.TempData.push(this.row):(this.FirstTypeEndIndex++,this.TempData.InsertAt(this.row,this.FirstTypeEndIndex))}}UpdateDataTableWithGroups(){}SetStockBalance(e){let l,t="";this.lstTagColumns.forEach(s=>{t.length>0&&(t+=","),t+=s});let i=[];i.push(e?1:0),i.push(""),i.push(this.TagID),i.push(" inner join com_docccdata DCC with(nolock) on DCC.InvDocDetailsID=D.InvDocDetailsID");let h="";var n=this.ViewModel.oReportDialog.CostCenterFilters.find(s=>s.CostCenterID==this.TagID);if(null!=n){let s="";n.SelectedNodes.forEach(a=>{s+=a.Id+","}),s.length>0&&(s=s.Remove(s.length-1,1),h+=" AND DCC.DCCCNID"+(n.CostCenterID-5e4)+" IN ("+s+")")}if(h+=this.LocationWhere,i.push(h),i.push(this.ViewModel.oReportDialog.FromDate.Date),i.push(this.ViewModel.oReportDialog.ToDate.Date),i.push(this.UnPostedDocsInclude),i.push(T.d.SessionManager.UserName),l=T.d.report.SetAvgRateTempTable(i,this.ViewModel.IsReportDB),0!=l.length)try{let s=o.J0.Int(T.d.SessionManager.Preferences["Maintain Dimensionwise stock"]);if(i=[],i.push(l),i.push(this.TagID),i.push(t),i.push(s),this.ViewModel.oReportDialog.Locations.Visible&&null!=this.ViewModel.oReportDialog.LocationWhere?o.J0.IsEmpty(this.ViewModel.oReportDialog.LocationWhere)?i.push(-1):"True"==T.d.SessionManager.Preferences.EnableLocationWise&&this.ViewModel.ShowLocationFilter&&this.ViewModel.oReportDialog.Locations.Items.length>0&&"all"==this.ViewModel.oReportDialog.Locations.Items[0].Value.toLowerCase()&&(0,L.yG0)(this.ViewModel.oReportDialog.Locations.Items[0].IsChecked)?i.push(null):i.push(this.ViewModel.oReportDialog.LocationWhere):i.push(null),i.push(this.ViewModel.oReportDialog.ToDate.Date),i.push(0),i.push(T.d.SessionManager.LanguageID),e){if(this.dsOpeningStock=T.d.report.GetStockBalancesTagWise(i,this.ViewModel.IsReportDB),this.dsOpeningStock.Tables[0].length>0){let a=this.dsOpeningStock.Tables[0].Compute("sum","BalValue");null!=a&&(this.dblOpeningStock=o.J0.Double(a))}}else if(this.dsClosingStock=T.d.report.GetStockBalancesTagWise(i,this.ViewModel.IsReportDB),this.dsClosingStock.Tables[0].length>0){let a=this.dsClosingStock.Tables[0].Compute("sum","BalValue");null!=a&&(this.dblClosingStock=o.J0.Double(a))}}catch{}finally{l.length>0&&T.d.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"USE PACT2C\n                IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].["+l+"]') AND type in (N'U'))\nDROP TABLE "+l+"\nDELETE FROM RPT_TempTables WHERE TempTableName='"+l+"'")}else this.ViewModel.DisplayMessage="Setting Temporary Table Error."}SetPLText(e,l){this.SetPLTextColor(e,l),l=this.ViewModel.Preferences.ContainsKey(l)?this.ViewModel.Preferences[l]:T.d.GetResource(l).toUpperCase(),e.Text=l}SetPLTextColor(e,l){this.ViewModel.Preferences.ContainsKey(l+"Clr")?e.CellAppearance.ForeColor=this.ViewModel.Preferences[l+"Clr"]:"Reports_LblNetLossAfter"==l&&this.ViewModel.Preferences.ContainsKey("Reports_LblNetLossForPeriodClr")?e.CellAppearance.ForeColor=this.ViewModel.Preferences.Reports_LblNetLossForPeriodClr:"Reports_LblNetProfitAfter"==l&&this.ViewModel.Preferences.ContainsKey("Reports_LblNetProfitForPeriodClr")&&(e.CellAppearance.ForeColor=this.ViewModel.Preferences.Reports_LblNetProfitForPeriodClr)}RenderColums(e,l,t,i,h,n,s){let a,r=this.dtYearStartMonth;a=this.Show==d.YearWise?r:this.Show==d.DayWise?this.ViewModel.oReportDialog.FromDate.Date:new Date(this.ViewModel.oReportDialog.FromDate.Date.getFullYear(),this.ViewModel.oReportDialog.FromDate.Date.getMonth(),1);let I=0,S=1,m=1,R=this.Show==d.HalfYearWise?6:3,P="",N=!0,E=e[e.length-1];for(-1!=this.BalIndex&&(E=e[this.BalIndex]);a<=this.ViewModel.oReportDialog.ToDate.Date;){let C=E.Clone();if(this.SubShowPerc&&!o.J0.IsEmpty(n)&&(I>0&&(this.Show==d.DayWise?(C.HeaderText=n+"\r\n"+r.AddDays(-1).ToString("dd MMM yy")+"-"+a.ToString("dd MMM yy"),C.ID=7==this.ViewModel.StaticReportType?"Perc_"+s+"Y"+a.getFullYear()+"M"+a.getMonth().ToString("00")+"D"+a.Day:"Perc_"+s+"Y"+a.getFullYear()+"M"+a.getMonth()+"D"+a.Day):this.Show==d.MonthWise?(C.HeaderText=n+"\r\n"+r.AddMonths(-1).ToString("MMM yy")+"-"+r.ToString("MMM yy"),C.ID=7==this.ViewModel.StaticReportType?"Perc_"+s+"Y"+a.getFullYear()+"M"+a.getMonth().ToString("00"):"Perc_"+s+"Y"+a.getFullYear()+"M"+a.getMonth()):this.Show==d.QtrWise||this.Show==d.HalfYearWise?(m=S,m++,(this.Show==d.QtrWise&&5==m||this.Show==d.HalfYearWise&&3==m)&&(m=1),P=1==this.AccountingFromMonth?a.getFullYear().toString():a.Month>=this.AccountingFromMonth?a.getFullYear().toString()+"-"+((a.getFullYear()+1)%100).toString():(a.getFullYear()-1).toString()+"-"+(a.getFullYear()%100).toString(),C.HeaderText=n+"\r\n"+(this.Show==d.HalfYearWise?"H":"Q")+m+" "+P,C.ID="Perc_"+s+"Y"+a.getFullYear()+"M"+a.getMonth()):(C.HeaderText=n+"\r\n"+r.AddYears(-1).getFullYear().toString()+"-"+r.getFullYear().toString(),C.ID="Perc_"+s+"Y"+a.getFullYear()),C.HeaderText=C.HeaderText+" %",C.DataFormat.PercentageOn="-",C.DataFormat.ShowDefaultSign=0,C.DataFormat.NegativeNumber=1,e.push(C),++this.CountMonths),I++),C=E.Clone(),this.Show==d.DayWise)C.HeaderText=C.HeaderText+"-"+(o.J0.IsEmpty(n)?"":n+"\r\n")+a.Date.ToString("dd MMM yy"),C.ID=7==this.ViewModel.StaticReportType?s+"Y"+a.Date.getFullYear()+"M"+a.Date.getMonth().ToString("00")+"D"+a.Date.Day:s+"Y"+a.Date.getFullYear()+"M"+a.Date.getMonth()+"D"+a.Date.Day,this.YearSlots.push(C.ID,a.Date);else if(this.Show==d.MonthWise)C.HeaderText=C.HeaderText+"-"+(o.J0.IsEmpty(n)?"":n+"\r\n")+a.Date.ToString("MMM yy"),C.ID=7==this.ViewModel.StaticReportType?s+"Y"+a.Date.getFullYear()+"M"+a.Date.getMonth().ToString("00"):s+"Y"+a.Date.getFullYear()+"M"+a.Date.getMonth(),this.YearSlots.push(C.ID,a.Date);else if(this.Show==d.QtrWise||this.Show==d.HalfYearWise){if(N){for(a=new Date(this.ViewModel.FromDatePicker.Date.getFullYear(),this.AccountingFromMonth,1),a>this.ViewModel.FromDatePicker.Date&&(a=a.AddYears(-1)),S=1;a.AddMonths(R)<=this.ViewModel.FromDatePicker.Date;)S++,a=a.AddMonths(R);P=1==this.AccountingFromMonth?a.Year.toString():a.Month>=this.AccountingFromMonth?a.Year.toString()+"-"+((a.Year+1)%100).toString():(a.Year-1).toString()+"-"+(a.Year%100).toString()}else S++,(this.Show==d.QtrWise&&5==S||this.Show==d.HalfYearWise&&3==S)&&(S=1),P=1==this.AccountingFromMonth?a.Year.toString():a.Month>=this.AccountingFromMonth?a.Year.toString()+"-"+((a.Year+1)%100).toString():(a.Year-1).toString()+"-"+(a.Year%100).toString();C.HeaderText=C.HeaderText+"-"+(o.J0.IsEmpty(n)?"":n+"\r\n")+(this.Show==d.HalfYearWise?"H":"Q")+S+" "+P,C.ID=s+"Y"+a.Date.getFullYear()+"M"+a.Date.getMonth(),this.YearSlots.push(C.ID,a.Date),N=!1;let p=new j;p.dtStart=a,p.dtEnd=a.AddMonths(R).AddDays(-1),this.QtrSlot.push(C.ID,p)}else C.HeaderText=1!=r.iMonth()?C.HeaderText+"-"+(o.J0.IsEmpty(n)?"":n+"\r\n")+r.getFullYear().toString()+"-"+(r.getFullYear()+1).toString():C.HeaderText+"-"+(o.J0.IsEmpty(n)?"":n+"\r\n")+r.getFullYear().toString(),C.ID=s+"Y"+a.getFullYear(),this.YearSlots.push(C.ID,r),r=r.AddYears(1);if(this.lstTags.push(C.ID),e.push(C),++this.CountMonths,this.ShowBudget&&!this.HideTagWiseBudget){let p=null!=i?i.Clone():C.Clone();p.HeaderText=(null!=i?p.HeaderText:"Budget")+"-"+C.HeaderText,p.ID=this.Show==d.DayWise?"Budget"+a.Date.ToString("ddMMMyyyy"):this.Show==d.MonthWise?"Budget"+a.Date.ToString("MMMyyyy"):this.Show==d.QtrWise||this.Show==d.HalfYearWise?"Budget"+C.ID:"Budget"+a.Date.ToString("yyyy"),p.DataFormat.NegativeNumber=0,e.Insert(e.length-1,p),++this.CountMonths}if(this.ShowBudgetVariance&&!this.HideTagWiseBudget){let p=null!=l?l.Clone():C.Clone();p.HeaderText=(null!=l?p.HeaderText:"Variance")+"-"+C.HeaderText,p.ID=this.Show==d.DayWise?"Variance"+a.Date.ToString("ddMMMyyyy"):this.Show==d.MonthWise?"Variance"+a.Date.ToString("MMMyyyy"):this.Show==d.QtrWise||this.Show==d.HalfYearWise?"Variance"+C.ID:"Variance"+a.Date.ToString("yyyy"),p.DataFormat.NegativeNumber=0,e.push(p),++this.CountMonths}if(this.ShowBudgetVariancePercent&&!this.HideTagWiseBudget){let p=null!=t?t.Clone():C.Clone();p.HeaderText=(null!=t?p.HeaderText:"Variance %")+"-"+C.HeaderText,p.ID=this.Show==d.DayWise?"PercentVariance"+a.Date.ToString("ddMMMyyyy"):this.Show==d.MonthWise?"PercentVariance"+a.Date.ToString("MMMyyyy"):this.Show==d.QtrWise||this.Show==d.HalfYearWise?"PercentVariance"+C.ID:"PercentVariance"+a.Date.ToString("yyyy"),p.DataFormat.NegativeNumber=0,e.push(p),++this.CountMonths}if(this.ShowPrevMonthData||this.ShowPrevMonthDiffData||this.ShowPrevMonthVarPer){let p=C.Clone(),B=a.AddYears(-1);if(this.Show==d.DayWise)p.HeaderText=B.Date.ToString("MMM yy"),p.ID=7==this.ViewModel.StaticReportType?"Y"+B.Date.getFullYear()+"M"+B.Date.getMonth().ToString("00")+"D"+B.Date.Day:"Y"+B.Date.getFullYear()+"M"+B.Date.getMonth()+"D"+B.Date.Day;else if(this.Show==d.MonthWise)p.HeaderText=B.Date.ToString("MMM yy"),p.ID=7==this.ViewModel.StaticReportType?"Y"+B.Date.getFullYear()+"M"+B.Date.getMonth().ToString("00"):"Y"+B.Date.getFullYear()+"M"+B.Date.getMonth();else if(this.Show==d.QtrWise||this.Show==d.HalfYearWise){let y=a.AddYears(-1);P=1==this.AccountingFromMonth?y.Year.toString():y.Month>=this.AccountingFromMonth?y.Year.toString()+"-"+((y.Year+1)%100).toString():(y.Year-1).toString()+"-"+(y.Year%100).toString(),p.HeaderText=(this.Show==d.HalfYearWise?"H":"Q")+S+" "+P,p.ID="Y"+y.Year+"M"+y.Month;let W=new j;W.dtStart=a,W.dtEnd=a.AddMonths(R).AddDays(-1),this.QtrSlot.push(C.ID,W)}else this.Show==d.YearWise&&(p.HeaderText=B.Date.ToString("yyyy"),p.ID="Y"+B.Date.getFullYear());this.lstPMTags.push(p.ID),p.HeaderAppearance.IsVisible=this.ShowPrevMonthData,e.push(p),++this.CountMonths}if(this.ShowPrevMonthDiffData){let p=C.Clone();a.AddYears(-1),p.HeaderText="Diff",this.Show==d.DayWise?p.ID=7==this.ViewModel.StaticReportType?"DIFF_Y"+a.getFullYear()+"M"+a.getMonth().ToString("00")+"D"+a.Date.Day:"DIFF_Y"+a.getFullYear()+"M"+a.getMonth()+"D"+a.Date.Day:this.Show==d.MonthWise?p.ID=7==this.ViewModel.StaticReportType?"DIFF_Y"+a.getFullYear()+"M"+a.getMonth().ToString("00"):"DIFF_Y"+a.getFullYear()+"M"+a.getMonth():this.Show==d.QtrWise||this.Show==d.HalfYearWise?p.ID="DIFF_Y"+a.getFullYear()+"M"+a.getMonth():this.Show==d.YearWise&&(p.ID="DIFF_Y"+a.getFullYear()),e.push(p),++this.CountMonths}if(this.ShowPrevMonthVarPer){let p=C.Clone();a.AddYears(-1),p.HeaderText="Variance %",p.DataFormat.PercentageOn="DIFF",this.Show==d.DayWise?p.ID=7==this.ViewModel.StaticReportType?"VARPER_Y"+a.getFullYear()+"M"+a.getMonth().ToString("00")+"D"+a.Day:"VARPER_Y"+a.getFullYear()+"M"+a.getMonth()+"D"+a.Day:this.Show==d.MonthWise?p.ID=7==this.ViewModel.StaticReportType?"VARPER_Y"+a.getFullYear()+"M"+a.getMonth().ToString("00"):"VARPER_Y"+a.getFullYear()+"M"+a.getMonth():this.Show==d.QtrWise||this.Show==d.HalfYearWise?p.ID="VARPER_Y"+a.getFullYear()+"M"+a.getMonth():this.Show==d.YearWise&&(p.ID="VARPER_Y"+a.getFullYear()),e.push(p),++this.CountMonths}if(this.ShowSalesPerMonthly){let p=C.Clone();p.HeaderText="Percentage",p.DataFormat.PercentageOn="Balance",p.width>85&&(p.width=85),p.ID=this.Show==d.DayWise?"SalesPercentage_Y"+a.getFullYear()+"M"+a.getMonth()+"D"+a.Day:this.Show==d.MonthWise?"SalesPercentage_Y"+a.getFullYear()+"M"+a.getMonth():this.Show==d.QtrWise||this.Show==d.HalfYearWise?"SalesPercentage_"+C.ID:"SalesPercentage_Y"+a.Date.ToString("yyyy"),p.DataFormat.NegativeNumber=0,e.push(p),++this.CountMonths}a=this.Show==d.DayWise?a.AddDays(1):this.Show==d.MonthWise?a.AddMonths(1):this.Show==d.QtrWise||this.Show==d.HalfYearWise?a.AddMonths(R):a.AddYears(1)}!o.J0.IsEmpty(n)&&e[0].HeaderHeight<40&&e[0].HeaderHeight<40&&e.forEach(C=>C.HeaderHeight=45)}SetConsolidateData(e,l){let t=null;e.Columns[0].Contains("Mn")||e.Columns.push("Mn"),e.Columns[0].Contains("ActualAccountID")||e.Columns.push("ActualAccountID");for(let s=0;s<e.Tables[0].length;s++)e.Tables[0][s].Mn=T.d.SessionManager.CompanyIndex,e.Tables[0][s].ActualAccountID=e.Tables[0][s].AccountID;let h=this.TagTableName.split(","),n=parseInt(e.Tables[0].Compute("max","AccountID"));for(let s=0;s<h.length;s++)if(t=T.d.report.ReportDataSet("RPT022",this.ViewModel.IsReportDB,"USE PACT2C"+h[s]+" "+l),!t.Columns[0].Contains("ErrorMessage")){t.Columns[0].Contains("Mn")||t.Columns.push("Mn"),t.Columns[0].Contains("ActualAccountID")||t.Columns.push("ActualAccountID");for(let r=0;r<t.Tables[0].length;r++){let I;t.Tables[0][r].Mn=h[s],t.Tables[0][r].ActualAccountID=t.Tables[0][r].AccountID,I=t.Tables[0].filter("Code+'-'+Name"==this.TagColumnName?S=>S.AccountCode==o.J0.String(t.Tables[0][r].AccountCode)&&S.AccountName==o.J0.String(t.Tables[0][r].AccountName)&&S.IsGroup==t.Tables[0][r].IsGroup&&S.AccountTypeID==t.Tables[0][r].AccountTypeID:S=>S[S.Account+this.TagColumnName]==o.J0.String(t.Tables[0][r]["Account"+this.TagColumnName])&&S.IsGroup==t.Tables[0][r].IsGroup&&S.AccountTypeID==t.Tables[0][r].AccountTypeID),I.length>0?(t.Tables[0][r].AccountID=I[0].AccountID,t.Tables[0][r].AccountCode=I[0].AccountCode,t.Tables[0][r].AccountName=I[0].AccountName,t.Tables[0][r].lft=I[0].lft,t.Tables[0][r].rgt=I[0].rgt,t.Tables[0][r].Depth=I[0].Depth,t.Columns[0].Contains("ParentID")&&(t.Tables[0][r].ParentID=I[0].ParentID)):(n++,t.Tables[0][r].AccountID=n),t.Columns[0].Contains("ParentID")&&(I=t.Tables[0].filter(S=>S.ParentID==t.Tables[0][r].ActualAccountID),I.forEach(S=>{S.ParentID=t.Tables[0][r].AccountID}))}e.Tables[0].AddRange(t.Tables[0])}}}}}]);