"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[3259],{13259:(T,U,o)=>{o.r(U),o.d(U,{AddUOMViewModel:()=>m,DeletedRecords:()=>u});var a=o(9659),l=o(66148),b=o(76199),M=o(81322),h=o(5349),d=o(35789),O=o(88852),S=o(29702),g=o(99393),c=o(6532);class u{constructor(e){this.iSeqno=0,this.iSeqno=e}}class m extends b.g{get dtTable(){return this.GridUnitsObj.Table}get BaseVisibility(){return this._BaseVisibility}set BaseVisibility(e){this._BaseVisibility=e,e&&(this._DetailsVisibility=!1)}get DetailsVisibility(){return this._DetailsVisibility}set DetailsVisibility(e){this._DetailsVisibility=e,e&&(this._BaseVisibility=!1)}get angularGrid(){return this.GridUnitsObj.angularGrid}get GridUnits(){return this.GridUnitsObj.Table}get Columns(){return this.GridUnitsObj.Columns}set Columns(e){this.GridUnitsObj.Columns=e}get GridUnitsColumns(){return this.GridUnitsObj.TableColumns}get GridUnitsColumnSource(){return this.GridUnitsObj.Columns}get BaseText(){return this.BaseTextObj.Text}set BaseText(e){e!=this.BaseTextObj.Text&&(this.BaseTextObj.Text=e)}OnCmnItem_Click(e){if(Logger.InfoLog("AddUOMViewModel::Entering OnCmnItem_Click"),this.SelectedNode<0)this.DisplayMessage="Please Select Particular cell to remove",this.MessageVisibility=!0;else if("DELETE"===(this.SelectedNode<this.dtTable.length&&(this.res=""),e)){let s=0;for(let t=0;t<this.dtTable.length;t++)if(s=parseInt(this.dtTable[t].SNO),this.SelectedNode==s-1&&!l.J0.IsEmpty(this.dtTable[t].UnitID)&&!l.J0.IsEmpty(this.dtTable[t].PrimayColumn)){if("1"!=this.dtTable[t].UnitID.toString()){confirm("Are you Sure You Want To Delete this Unit ? ")?(this.lstDeletedRecords.push(new u(parseInt(this.dtTable[t].PrimayColumn.toString()))),this.res="Yes"):this.res="No";break}confirm("This Unit will delete Base name:Are you sure ? ")?(this.onDeleteBase(this.dtTable[t].BaseID.toString()),this.res="Yes"):this.res="No";break}this.dtTable.length>0&&"Yes"==this.res&&(this.dtTable.RemoveAt(this.SelectedNode),this.UpdateSequence())}Logger.InfoLog("AddUOMViewModel::Exiting OnCmnItem_Click")}OnMessageCallBack(){this.res="Yes"}onCanCmnItem_Click(e){return!0}NewBase_Click(e){Logger.InfoLog("AddUOMViewModel::Entering NewBase_Click");try{this.SelectedType="0",this.Units1.Items.Clear(),this.SelectedText="",this.GridUnitsObj.Clear(),this.BaseText=""}catch(s){Logger.ErrorLog("AddUOMViewModel:: NewBase_Click"+s.stack)}}constructor(){super(),this.SaveUOM=new d.Yk,this.SelectionChangedCommand=new d.Yk,this.DeleteBase=new d.Yk,this.NewBase=new d.Yk,this.cmnItem_Click=new d.Yk,this.ButtonSave=new M.v,this.lstDeletedRecords=[],this.textChangedUnit=new d.Yk,this.Units1=new h.y$(0),this.PACTControlData=[],this.GridUnitsObj=new S.vv,this.BaseTextObj=new c.Dw(0),this.res="",this.SNO=1,this.RetValue=0,this.Flag=!1,this.textChangedUnit.Subscribe(this,"ontextChangedUnit"),Logger.InfoLog("AddUOMViewModel::Entering AddUOMViewModel"),this.DisplayName=a.d.GetResource("UOM_ScreenName"),a.d.SessionManager.HideUnathorizedAccess?this.ButtonSave.Visible=a.d.SessionManager.IsActionAssigned(11,"Create"):this.ButtonSave.Enable=a.d.SessionManager.IsActionAssigned(11,"Create"),a.d.SessionManager.HideUnathorizedAccess&&!this.ButtonSave.Visible?this.ButtonSave.Visible=a.d.SessionManager.IsActionAssigned(11,"Update"):this.ButtonSave.Enable||(this.ButtonSave.Enable=a.d.SessionManager.IsActionAssigned(11,"Update")),this.MessageVisibility=!1,this.SaveUOM.Subscribe(this,"onSaveUOM"),this.NewBase.Subscribe(this,"NewBase_Click"),this.SelectionChangedCommand.Subscribe(this,"onSelectionChanged"),this.DeleteBase.Subscribe(this,"onDeleteBase"),this.cmnItem_Click.Subscribe(this,"OnCmnItem_Click"),new O.D(0),this.ScreenID="1002",this.PactScreenID="1002",this.ScreenName="Create UOM",this.DetailsVisibility=!0,this.BindBase(),this.BindGridUnits(),Logger.InfoLog("AddUOMViewModel::Exiting AddUOMViewModel")}GridUnits_TableNewRow(e,s){this.UpdateSequence(),s.Row.SNO=this.SNO}UpdateSequence(){this.SNO=1,this.dtTable.forEach(e=>{e.SNO=this.SNO++,this.GridUnitsObj.updateRow(e)})}GetGridHeader(){this.GridUnitsObj.TableColumns.push("PrimayColumn"),this.GridUnitsObj.TableColumns.push("SNO"),this.GridUnitsObj.TableColumns.push("Unit Name"),this.GridUnitsObj.TableColumns.push("Conversion Rate"),this.GridUnitsObj.TableColumns.push("UnitID"),this.GridUnitsObj.TableColumns.push("BaseID");for(let s=this.dtTable.length;s<10;s++){let t=this.GridUnitsObj.NewRow();t.SNO=s+1,this.GridUnitsObj.addRow(t)}this.Columns=[];let e=new g.O7;e.Header="SNO",e.DisplayMember="SNO",e.Width=50,e.ReadOnly=!0,this.Columns.push(e),e=new g.O7,e.Header=a.d.GetResource("UOM_UnitName"),e.DisplayMember="Unit Name",e.Width=200,this.Columns.push(e),e=new g.O7,e.Header="Conv. Rate",e.DisplayMember="Conversion Rate",e.DataType="FLOAT",e.Width=150,this.Columns.push(e)}BindGridUnits(){return this.GridUnitsObj.Clear(),this.GetGridHeader(),this.dtTable}onDeleteBase(e){if(null!=this.SelectedType&&"-100"!=this.SelectedType.toString()){Logger.InfoLog("AddUOMViewModel::Entering onDeleteBase");let s=[];s.push(this.SelectedType),s.push(0),s.push(a.d.SessionManager.RoleID),s.push(a.d.SessionManager.LanguageID);let t,n=a.d.inventory.RemoveUOM(this.SelectedType,0),r=n.RetValue;t=n.Message,this.RetValue=r,r>0?(this.SelectedType="0",this.Units1.Items.Clear(),this.SelectedText="",this.GridUnitsObj.Clear(),this.BaseText="",this.BindBase(),this.DisplayMessage=a.d.GetResource("UOM_Del"),this.MessageVisibility=!0,this.BaseVisibility=!1):(this.DisplayMessage=t,this.MessageVisibility=!0),Logger.InfoLog("AddUOMViewModel::Exiting onDeleteBase")}}onCanDeleteBase(e){return!0}onSaveUOM(e){Logger.InfoLog("AddUOMViewModel::Entering onSaveUOM");try{this.MessageVisibility=!1;let t={},n="";if(l.J0.IsEmpty(this.BaseText))return this.DisplayMessage=a.d.GetResource("CannotSaveBlankUOM"),void(this.MessageVisibility=!0);{if(n+="<XML>",null!=this.GridUnits&&this.GridUnits.length>0){for(let i=0;i<this.GridUnits.length;i++)l.J0.IsEmpty(this.GridUnits[i]["Unit Name"])?l.J0.IsEmpty(this.GridUnits[i].PrimayColumn)?n+="<Row RowNo='"+(i+1)+"' PrimaryKey='0' UName='"+l.J0.String(this.GridUnits[i]["Unit Name"])+"'  ConversionRate='"+l.J0.String(this.GridUnits[i]["Conversion Rate"])+"' MapAction='DELETE' />":n+="<Row RowNo='"+(i+1)+"' PrimaryKey='"+this.GridUnits[i].PrimayColumn.toString()+"' UName='"+l.J0.String(this.GridUnits[i]["Unit Name"])+"'  ConversionRate='"+l.J0.String(this.GridUnits[i]["Conversion Rate"])+"' MapAction='DELETE' />":l.J0.IsEmpty(this.GridUnits[i].PrimayColumn)?n+="<Row RowNo='"+(i+1)+"' PrimaryKey='0' UName='"+this.GridUnits[i]["Unit Name"].toString()+"'  ConversionRate='"+l.J0.String(this.GridUnits[i]["Conversion Rate"])+"' MapAction='NEW' />":n+="<Row RowNo='"+(i+1)+"' PrimaryKey='"+this.GridUnits[i].PrimayColumn.toString()+"' UName='"+this.GridUnits[i]["Unit Name"].toString()+"'  ConversionRate='"+l.J0.String(this.GridUnits[i]["Conversion Rate"])+"' MapAction='UPDATE' />";for(let i=0;i<this.lstDeletedRecords.length;i++)n+='<Row MapAction="DELETE"',n+=' PrimaryKey="'+this.lstDeletedRecords[i].iSeqno+'"/>'}else n+="<Row RowNo='1' PrimaryKey='0' UName=''  ConversionRate='' MapAction='NEW' />";n+="</XML>";let r=0;t.Address1=this.BaseText,t.Address2=l.J0.StringIsNullOrEmpty(this.SelectedType)?0:this.SelectedType,t.Address3=n.toString(),t.IsGroup=!1,a.d.inventory.AddUOM(t,"AddUOM").subscribe(i=>{this.DisplayMessage=i.Message,this.RetValue=i.RetValue,this.MessageVisibility=!0,r=this.RetValue,r>0?(this.GridUnitsObj.Clear(),this.BindBase(),this.DisplayMessage=a.d.GetResource("UOM_Saved"),this.MessageVisibility=!0,this.BaseVisibility=!1):(this.DisplayMessage=i.Message,this.MessageVisibility=!0)},i=>{alert(JSON.stringify(i)),console.log("AddUOMViewModel::Exiting OnSaveUOM"+JSON.stringify(i))}),Logger.InfoLog("AddUOMViewModel::Exiting OnSaveUOM")}}catch(s){Logger.ErrorLog("AddUOMViewModel:: OnSaveUOM"+s.stack)}}onCanSaveUOM(e){return!0}onSelectionChanged(e){let s=null;this.DisplayMessage="",this.MessageVisibility=!1,Logger.InfoLog("AddUOMViewModel::Entering SelectionChanged event");try{"-100"==e?(this.GridUnitsObj.Clear(),this.lstDeletedRecords.Clear(),this.BaseText="",this.BaseVisibility=!0):this.BaseVisibility=!0;let t=[];if(t.push(this.SelectedType),t.push(a.d.SessionManager.UserID),t.push(a.d.SessionManager.LanguageID),null!=this.SelectedType&&(s=a.d.inventory.getUOM2(this.ScreenID,t)),this.GridUnitsObj.Clear(),null!=s&&s.Tables.length>0&&s.Tables[0].length>0){this.BaseText=s.Tables[0][0].BaseName.toString();for(let n=0;n<s.Tables[0].length;n++){let r=this.GridUnitsObj.NewRow();r.SNO=n+1,r.PrimayColumn=s.Tables[0][n].UOMID.toString(),r["Unit Name"]=s.Tables[0][n].UnitName.toString(),r["Conversion Rate"]=s.Tables[0][n].Conversion.toString(),r.UnitID=s.Tables[0][n].UNITID.toString(),r.BaseID=null,this.GridUnitsObj.addRow(r)}}for(let n=this.GridUnits.length;n<10;n++){let r=this.GridUnitsObj.NewRow();r.SNO=n+1,this.GridUnitsObj.addRow(r)}}catch(t){Logger.ErrorLog("AddUOMViewModel:: onSelectionChanged"+t.stack)}Logger.InfoLog("AddUOMViewModel::Exiting onSelectionChanged")}onCanSelectionChanged(e){return!0}BindBase(){this.Units1.Items.Clear(),this.ScreenData=this.BuildControls(),null!=this.ScreenData&&this.ScreenData.Tables[0].forEach(e=>{this.Units1.Items.push(h._p.ComboBoxItems_2(e[Object.keys(e)[1]].toString(),e[Object.keys(e)[0]].toString()))}),this.Units1.Items.push(h._p.ComboBoxItems_2("New","-100"))}BuildControls(){Logger.InfoLog("AddUOMViewModel::Entering BuildControls");try{let e=[];e.push(0),e.push(a.d.SessionManager.UserID),e.push(a.d.SessionManager.LanguageID);let s=a.d.inventory.getUOM2(this.ScreenID,e);return null!=s&&s.Tables[0].length>0&&s.Tables.length>0?s:null}catch(e){return Logger.ErrorLog("AddUOMViewModel:: BuildControls"+e.stack),null}}ontextChangedUnit(e){}BindGrid(){let e=[],s=[];if(s.push(this.SelectedType),s.push(a.d.SessionManager.UserID),s.push(a.d.SessionManager.LanguageID),null!=this.SelectedType&&(e=a.d.inventory.getUOM2(this.ScreenID,s)),this.dtTable.Clear(),null!=e&&e.Tables.length>0&&e.Tables[0].length>0){this.BaseText=e.Tables[0][0].BaseName.toString();for(let t=0;t<e.Tables[0].length;t++)this.dtTable.push([e.Tables[0][t].UOMID.toString(),t+1,e.Tables[0][t].UnitName.toString(),e.Tables[0][t].Conversion.toString(),e.Tables[0][t].UnitID.toString(),e.Tables[0][t].BaseID.toString()])}for(let t=this.GridUnits.length;t<10;t++){let n=this.GridUnitsObj.NewRow();n.SNO=t+1,this.GridUnitsObj.addRow(n)}}}}}]);