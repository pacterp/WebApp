"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[1618],{51618:(y,r,h)=>{h.r(r),h.d(r,{VacationDefineDaysViewModel:()=>M});var n=h(32040),t=h(43767),g=h(98580),D=h(7321),l=h(21774),d=h(27730);class M extends g.g{constructor(e,s,i){if(super(),this.strCustomEmpFilter="",this.dtVacDefineDays=null,this.dtVacDefineDaysColumns=[],this.DocID=0,this.BasedOn=1,Logger.InfoLog("VacationDefineDaysViewModel::Entering VacationDefineDaysViewModel()"),this.DocID=e,this.dtVacDefineDays=s,this.BasedOn=i,this.DisplayMessage="",this.LoadGrid(),null==this.dtVacDefineDays&&(this.dtVacDefineDays=[],this.dtVacDefineDaysColumns.push("SNo"),this.dtVacDefineDaysColumns.push("FromMonth"),this.dtVacDefineDaysColumns.push("ToMonth"),this.dtVacDefineDaysColumns.push("DaysPerMonth"),this.dtVacDefineDaysColumns.push("ApplyToPrevMonths"),this.dtVacDefineDaysColumns.push("WEF")),this.dtVacDefineDays.length>0){let o;this.dgv.Table.Clear();for(let a=0;a<this.dtVacDefineDays.length;a++)o=this.dgv.NewRow(),o.SNo=(a+1).toString(),o.FromMonth=t.J0.String(this.dtVacDefineDays[a].FromMonth),o.ToMonth=t.J0.String(this.dtVacDefineDays[a].ToMonth),o.DaysPerMonth=t.J0.String(this.dtVacDefineDays[a].DaysPerMonth),o.ApplyToPrevMonths=t.J0.String(this.dtVacDefineDays[a].ApplyToPrevMonths),t.J0.IsEmpty(this.dtVacDefineDays[a].WEF)||(o.WEF=new Date(this.dtVacDefineDays[a].WEF).ToString(n.d.SessionManager.Preferences["Date Format"]),o.WEF_Key=new Date(this.dtVacDefineDays[a].WEF)),this.dgv.addRow(o);this.dgv.AddExtraEmptyRows(3)}Logger.InfoLog("VacationDefineDaysViewModel::Exiting VacationDefineDaysViewModel()")}FilterEmployees(){let e="";try{Logger.InfoLog("VacationDefineDaysViewModel::Entering FilterEmployees()"),e=" ( a.StatusID=250 AND ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')>='"+n.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,a.DOJ)<='"+n.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' ) ",n.d.SessionManager.LocationID>0&&n.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&n.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(e=e+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+n.d.SessionManager.LocationID+")"),Logger.InfoLog("MonthlyPayrollViewModel::Exiting FilterEmployees()")}catch(s){Logger.ErrorLog("VacationDefineDaysViewModel::EXCEPTION FilterEmployees()"+s.stack)}return e}LoadGrid(){Logger.InfoLog("VacationDefineDaysViewModel::Entering LoadGrid()"),this.dgv=new D.vv,this.dgv.CanUserAddRows=!0,this.dgv.CanUserDeleteRows=!0,this.dgv.HeaderHeight=40,this.dgv.CanUserSortColumns=!1,this.dgv.Columns=[],this.dgv.Width="360";let s,e=new l.O7;e.Header="#",e.DisplayMember="sno",e.ID="sno",e.Width=40,e.ReadOnly=!0,e.TextAlign="Center",this.dgv.Columns.push(e),e=new l.O7,e.Header="WEF",e.DisplayMember="WEF",e.DataType="DATE",e.Width=85,e.IsVisible=2==this.BasedOn,this.dgv.Columns.push(e),e=new l.O7,e=new l.O7,e.Header="From Month",e.DisplayMember="FromMonth",e.DataType="TextBlock",e.Width=70,e.TextAlign="Right",e.IsVisible=1==this.BasedOn,this.dgv.Columns.push(e),e=new l.O7,e.Header="To Month",e.DisplayMember="ToMonth",e.DataType="TextBlock",e.Width=70,e.TextAlign="Right",e.IsVisible=1==this.BasedOn,this.dgv.Columns.push(e),e=new l.O7,e.Header="Days per Month",e.DisplayMember="DaysPerMonth",e.DataType="TextBlock",e.Width=80,e.TextAlign="Right",this.dgv.Columns.push(e),e=new l.O7,e.Header="Apply to Prev. Months",e.ValueBinding="ApplyToPrevMonths",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=90,s=[],s.push(d._p.ComboBoxItems_2("Yes","Yes")),s.push(d._p.ComboBoxItems_2("No","No")),e.ComboData=s,e.DefaultValue="Yes",e.IsVisible=1==this.BasedOn,this.dgv.Columns.push(e),this.dgv.Table=[],this.dgv.TableColumns.push("sno"),this.dgv.TableColumns.push("FromMonth"),this.dgv.TableColumns.push("ToMonth"),this.dgv.TableColumns.push("DaysPerMonth"),this.dgv.TableColumns.push("ApplyToPrevMonths"),this.dgv.TableColumns.push("WEF"),this.dgv.TableColumns.push("WEF_Key"),this.dgv.AddExtraEmptyRows(5),this.dgv.TableNewRow.Subscribe(this,"dgv_RowAdded"),this.dgv.BeforeRowDeleting.Subscribe(this,"dgv_BeforeRowDeleting"),Logger.InfoLog("VacationDefineDaysViewModel::Exiting LoadGrid()")}dgv_BeforeRowDeleting(e){if(this.dgv.SelectedRows.length>0)try{if(!confirm("Are you sure want to delete the selected row.?"))return!1;this.dgv.removeRow(this.dgv.SelectedRows[0]),this.dgv.RefreshSno("SNO"),this.dgv.refreshDatawithIDs()}catch{}return!1}dgv_RowAdded(e,s){this.dgv.RefreshSno()}ValidateSave(){if(0==this.dgv.Table.length)return this.DisplayMessage="Enter atleast one Row.",this.MessageVisibility=!0,!1;for(let e=0;e<this.dgv.Table.length;e++)if(1==this.BasedOn){if(!t.J0.IsEmpty(this.dgv.Table[e].FromMonth)){if(t.J0.IsEmpty(this.dgv.Table[e].ToMonth))return this.DisplayMessage="Enter [To Month] at Row No. "+(e+1),this.MessageVisibility=!0,!1;if(!t.J0.IsEmpty(this.dgv.Table[e].ToMonth)&&parseInt(this.dgv.Table[e].ToMonth)<parseInt(this.dgv.Table[e].FromMonth))return this.DisplayMessage="[From Month] should be less than to [To Month] at Row No. "+(e+1),this.MessageVisibility=!0,!1;if(t.J0.IsEmpty(this.dgv.Table[e].DaysPerMonth))return this.DisplayMessage="Enter [Days per Month] at Row No. "+(e+1),this.MessageVisibility=!0,!1;if(!t.J0.IsEmpty(this.dgv.Table[e].DaysPerMonth)&&parseFloat(this.dgv.Table[e].DaysPerMonth)<0)return this.DisplayMessage="Enter valid [Days per Month] at Row No. "+(e+1),this.MessageVisibility=!0,!1;let s=0,i=0;s=parseInt(this.dgv.Table[e].FromMonth),i=parseInt(this.dgv.Table[e].ToMonth);for(let o=0;o<this.dgv.Table.length;o++)if(!t.J0.IsEmpty(this.dgv.Table[o].FromMonth)&&e!=o){if(s>=parseInt(this.dgv.Table[o].FromMonth)&&s<=parseInt(this.dgv.Table[o].ToMonth))return this.DisplayMessage="[From Month] value -"+s+"  repeated at Row No. "+(o+1),this.MessageVisibility=!0,!1;if(i>=parseInt(this.dgv.Table[o].FromMonth)&&i<=parseInt(this.dgv.Table[o].ToMonth))return this.DisplayMessage="[To Month] value -"+i+"  repeated at Row No. "+(o+1),this.MessageVisibility=!0,!1}}}else if(!t.J0.IsEmpty(this.dgv.Table[e].WEF_Key)&&t.J0.IsEmpty(this.dgv.Table[e].DaysPerMonth))return this.DisplayMessage="Enter [Days per Month] at Row No. "+(e+1),this.MessageVisibility=!0,!1;return!0}Button_Click(e){try{Logger.InfoLog("VacationDefineDaysViewModel::Entering Button_Click()"),"Ok"==e.toString()?this.Save_Click():"Cancel"==e.toString()&&(n.d.page.HideDialog(this.PopUpGUID),this.DialogResult=!1),Logger.InfoLog("VacationDefineDaysViewModel::Exiting Button_Click()")}catch(s){Logger.ErrorLog("VacationDefineDaysViewModel::EXCEPTION Button_Click()"+s.stack)}}Save_Click(){if(this.ValidateSave()){this.dtVacDefineDays=[];let e,s=0;for(let i=0;i<this.dgv.Table.length;i++)1==this.BasedOn?!t.J0.IsEmpty(this.dgv.Table[i].FromMonth)&&!t.J0.IsEmpty(this.dgv.Table[i].ToMonth)&&(s++,e={},e.SNo=s.toString(),e.FromMonth=t.J0.String(this.dgv.Table[i].FromMonth),e.ToMonth=t.J0.String(this.dgv.Table[i].ToMonth),e.DaysPerMonth=t.J0.String(this.dgv.Table[i].DaysPerMonth),e.ApplyToPrevMonths=null!=this.dgv.Table[i].ApplyToPrevMonths&&null!=this.dgv.Table[i].ApplyToPrevMonths&&""!=this.dgv.Table[i].ApplyToPrevMonths.toString()?t.J0.String(this.dgv.Table[i].ApplyToPrevMonths):"",this.dtVacDefineDays.push(e)):t.J0.IsEmpty(this.dgv.Table[i].WEF_Key)||(s++,e={},e.SNo=s.toString(),e.FromMonth="0",e.ToMonth="0",e.DaysPerMonth=t.J0.String(this.dgv.Table[i].DaysPerMonth),e.ApplyToPrevMonths="",e.WEF=new Date(this.dgv.Table[i].WEF_Key).ToString("dd MMM yyyy"),this.dtVacDefineDays.push(e));this.DialogResult=!0,n.d.page.HideDialog(this.PopUpGUID)}}}}}]);