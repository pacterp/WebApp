"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[7575],{77575:(I,T,p)=>{p.r(T),p.d(T,{REN_FloorWiseExpiry:()=>D});var C=p(9659),o=p(66148),m=p(3955),S=p(53879),c=p(39107);class D extends S.A{constructor(n){super(n),this.colors=new m.bT,this.colorNames=new m.bT}LoadReport(){let n=0,u=0,h="";this.ViewModel.Preferences.ContainsKey("Property")&&""!=this.ViewModel.Preferences.Property&&(n=parseInt(this.ViewModel.Preferences.Property)),this.ViewModel.Preferences.ContainsKey("Status")&&""!=this.ViewModel.Preferences.Status&&(u=parseInt(this.ViewModel.Preferences.Status)),this.ViewModel.Preferences.ContainsKey("UnitType")&&""!=this.ViewModel.Preferences.UnitType&&parseInt(this.ViewModel.Preferences.ExpiryType)>0&&(h=" UNTTYPE.NodeID="+parseInt(this.ViewModel.Preferences.UnitType));let E=this.ViewModel.Preferences.ContainsKey("StatusDimension")?parseInt(this.ViewModel.Preferences.StatusDimension):0,a=[];a.push(n),a.push(this.ViewModel.ToDatePicker.Date.ToString("dd/MMM/yyyy")),a.push(u),a.push(E),a.push(this.ViewModel.SelectTag),a.push(this.ViewModel.FromTag),a.push(o.J0.IsEmpty(h)?"":h),a.push(C.d.SessionManager.UserID),a.push(C.d.SessionManager.LanguageID),C.d.report.GetFloorWiseExpiry(a,this.ViewModel.IsReportDB).then(y=>{let s=y;this.FillColors(),null!=s&&s.Tables.length>2&&this.colors.keys.forEach(e=>{let t={Key:e,Value:this.colors[e]},r=s.Tables[2].filter(R=>R.NodeID==t.Key);r.length>0?this.colorNames.push(r[0].Name.toString(),t.Value):"0"==t.Key&&this.colorNames.push(C.d.GetResource("nearingexpiry"),t.Value)});let P=1;s.Tables[1].length>0&&o.J0.IsNum(s.Tables[1][0][s.Columns[1][0]])&&(P=parseInt(s.Tables[1][0][s.Columns[1][0]]));let d=new Array,f=new Array,w=this.ViewModel.ReportColumns[0].Clone();w.HeaderText="Floor",f.push(w);for(let e=1;e<this.ViewModel.ColumnSource.length;e++)this.ViewModel.ColumnSource[e].HeaderAppearance.IsVisible&&d.push(this.ViewModel.ColumnSource[e]);for(let e=0;e<P;e++)w=this.ViewModel.ReportColumns[0].Clone(),w.HeaderText="Unit",f.push(w);this.ViewModel.ReportColumns=f;let l=new Array,i=1,V=null,g="",M=!1;for(let e=0;e<s.Tables[0].length;e++,i++){if(g!=s.Tables[0][e].Property.toString()&&(M=!0),V!=o.J0.String(s.Tables[0][e].FloorName)||M){if(e>0&&l.forEach(t=>{this.ViewModel.addRow(t)}),M){let t=new c.Ji(this.ViewModel.ReportColumns.length,this.ViewModel.RowHeight);t.Cells[0].Text=s.Tables[0][e].Property.toString(),t.Cells[0].ColSpan=this.ViewModel.ReportColumns.length-1,V=null,this.ViewModel.addRow(t),M=!1}l.Clear(),l.push(new c.Ji(this.ViewModel.ReportColumns.length,this.ViewModel.RowHeight)),l.push(new c.Ji(this.ViewModel.ReportColumns.length,this.ViewModel.RowHeight)),l.push(new c.Ji(this.ViewModel.ReportColumns.length,this.ViewModel.RowHeight)),d.forEach(t=>{l.push(new c.Ji(this.ViewModel.ReportColumns.length,this.ViewModel.RowHeight))}),l[0].Cells[0].Text=o.J0.String(s.Tables[0][e].FloorName),i=1}if(V=o.J0.String(s.Tables[0][e].FloorName),g=o.J0.String(s.Tables[0][e].Property),l[0].Cells[i].Text=o.J0.String(s.Tables[0][e].Unit),l[1].Cells[i].Text=o.J0.String(s.Tables[0][e].UnitTypeName),l[2].Cells[i].Text=o.J0.IsEmpty(s.Tables[0][e].ContractExpiryDate)?"":o.J0.ParseDate(s.Tables[0][e].ContractExpiryDate).ToString(C.d.SessionManager.Preferences["Date Format"]),this.colors.ContainsKey(o.J0.String(s.Tables[0][e].UnitStatus))&&!o.J0.IsEmpty(this.colors[o.J0.String(s.Tables[0][e].UnitStatus)]))for(let t=0;t<l.length;t++)l[t].Cells[i].IsNormal=!1,l[t].Cells[i].CellAppearance=this.ViewModel.ReportColumns[i].DataAppearance.Clone(),l[t].Cells[i].CellAppearance.BackColor=this.colors[o.J0.String(s.Tables[0][e].UnitStatus)];if(this.ViewModel.Preferences.ContainsKey("ExpiryIn")&&""!=this.ViewModel.Preferences.ExpiryIn){let t=0;if(t=o.J0.Int(this.ViewModel.Preferences.ExpiryIn),t>0&&!o.J0.IsEmpty(s.Tables[0][e].ContractExpiryDate)&&o.J0.ParseDate(s.Tables[0][e].ContractExpiryDate.toString())<=this.ViewModel.ToDatePicker.Date.AddDays(t)&&""!=this.colors[0])for(let r=0;r<3;r++)l[r].Cells[i].IsNormal=!1,l[r].Cells[i].CellAppearance=r<3?this.ViewModel.ReportColumns[i].DataAppearance.Clone():d[r-3].DataAppearance.Clone(),l[r].Cells[i].CellAppearance.BackColor=this.colors[0]}for(let t=0;t<d.length;t++){let r=s.Tables[0][e][d[t].ID].toString();r.length>0&&this.ViewModel.SetCellValue(r,d[t].DataFormat,d[t].ColumnType,l[3+t].Cells[i])}}s.Tables[0].length>0&&l.forEach(e=>{this.ViewModel.addRow(e)})}).then(y=>{this.ViewModel.process_RunWorkerCompleted()})}FillColors(){if(this.ViewModel.Preferences.ContainsKey("StatusColors")&&""!=this.ViewModel.Preferences.StatusColors){let n=new o.VB;n.LoadXml("<xml>"+this.ViewModel.Preferences.StatusColors+"</xml>");let u=n.SelectNodes("xml/Color");null!=u&&u.length>0&&u.forEach(h=>{null!=h.attributes.ID&&null!=h.attributes.Value&&this.colors.push(h.attributes.ID.value,h.attributes.Value.value)})}}LoadReportWithPostFilters(n){}}}}]);