"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[5801],{88182:(F,E,r)=>{r.r(E),r.d(E,{DocumentsListViewModel:()=>v});var b=r(74523),L=r(76199),l=r(9659),P=r(16645),N=r(76428),y=r(29702),m=r(99393),c=r(66148),T=r(83682),S=r(81322),O=r(76962),p=r(5349),R=r(27490),A=r(89417),o=r(41360),G=r(32881),j=r(47030),V=r(73955);function x(f,e){1&f&&(o.j41(0,"span"),o.EFF(1,"Loading..."),o.k0s())}function w(f,e){if(1&f&&o.nrm(0,"app-PactGridView",9),2&f){const t=o.XpG();o.Y8G("obj",t.obj.GridObj)("group",t.form)}}let M=(()=>{class f{constructor(){this.form=new A.gE({})}ngOnInit(){this.params&&(this.obj=this.params.obj)}static{this.\u0275fac=function(s){return new(s||f)}}static{this.\u0275cmp=o.VBU({type:f,selectors:[["app-documents-list-detail"]],inputs:{obj:"obj"},standalone:!1,decls:26,vars:8,consts:[[1,"master-screen",2,"padding-bottom","4px"],[1,"PACTHeaderFields","dialogSubBody","section","documentgrid",2,"padding-top","0px"],[4,"ngIf"],["style","height:135px",3,"obj","group",4,"ngIf"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"fa-light","fa-circle-check"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],[2,"height","135px",3,"obj","group"]],template:function(s,n){1&s&&(o.j41(0,"div",0),o.EFF(1,"\n    "),o.j41(2,"div",1),o.EFF(3,"\n        "),o.DNE(4,x,2,0,"span",2),o.EFF(5,"\n        "),o.DNE(6,w,1,2,"app-PactGridView",3),o.EFF(7,"  \n    "),o.k0s(),o.EFF(8,"\n    "),o.j41(9,"div",4),o.EFF(10,"\n      "),o.j41(11,"div"),o.EFF(12,"\n        "),o.j41(13,"button",5),o.bIt("click",function(){return n.obj.OnButtonClick("Save")}),o.nrm(14,"i",6),o.EFF(15),o.nI1(16,"translate"),o.k0s(),o.EFF(17,"\n        "),o.j41(18,"button",7),o.bIt("click",function(){return n.obj.OnButtonClick("Cancel")}),o.nrm(19,"i",8),o.EFF(20),o.nI1(21,"translate"),o.k0s(),o.EFF(22,"\n      "),o.k0s(),o.EFF(23,"\n  "),o.k0s(),o.EFF(24,"\n"),o.k0s(),o.EFF(25,"\n\n")),2&s&&(o.R7$(4),o.Y8G("ngIf",!n.obj.GridObj.Visible),o.R7$(2),o.Y8G("ngIf",n.obj.GridObj.Visible),o.R7$(9),o.JRh(o.bMT(16,4,"Com_OK")),o.R7$(5),o.SpI(" ",o.bMT(21,6,"Close"),""))},dependencies:[G.bT,j.X,V.D9],encapsulation:2})}}return f})();class k extends L.g{constructor(e,t){super(),this.GridObj=new y.vv,this.IsSelective=!1,this.Parent=e,this.item=t,this.InitGrid()}InitGrid(){if(this.GridObj=new y.vv,this.GridObj.MaxHeight=280,this.GridObj.SelectAll.Visible=!1,this.GridObj.SelectAll.DBColumnName="select",this.GridObj.Width="",this.GridObj.Table=[],this.GridObj.Columns=[],this.GridObj.Visible=!1,this.lstDateCols=[],this.Parent.IsInventory){let e;"True"==this.Parent.GetPrefValue("Selective")&&(this.IsSelective=!0,this.GridObj.SelectAll.Visible=!0,e=new m.O7,e.DisplayMember="select",e.Header="Select",e.Width=50,e.IsFrozen=!0,e.ReadOnly=!0,e.TextAlign="Center",e.DataType="CheckBox",this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember)),e=new m.O7,e.DisplayMember="DocSeqNo",e.Header="#",e.Width=45,e.ReadOnly=!0,e.IsFrozen=!0,this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember),e=new m.O7,e.DisplayMember="ProductCode",e.Header="Product Code",e.Width=110,e.ReadOnly=!0,this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember),e=new m.O7,e.DisplayMember="ProductName",e.Header="Product Name",e.Width=180,e.ReadOnly=!0,this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember),e=new m.O7,e.DisplayMember="Quantity",e.Header="Qty",e.Width=80,e.ReadOnly=!0,e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinQty,e.DataType="FLOAT",this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember),e=new m.O7,e.DisplayMember="Rate",e.Header="Rate",e.Width=80,e.ReadOnly=!0,e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinRate,e.DataType="FLOAT",this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember),e=new m.O7,e.DisplayMember="Gross",e.Header="Gross",e.Width=100,e.ReadOnly=!0,e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinAmount,e.DataType="FLOAT",this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember)}else{let e=new m.O7;e.DisplayMember="DocSeqNo",e.Header="#",e.Width=45,e.ReadOnly=!0,e.IsFrozen=!0,this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember),e=new m.O7,e.DisplayMember="DrName",e.Header="Debit Account",e.Width=180,e.ReadOnly=!0,this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember),e=new m.O7,e.DisplayMember="CrName",e.Header="Credit Account",e.Width=180,e.ReadOnly=!0,this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember),e=new m.O7,e.DisplayMember="Amount",e.Header="Amount",e.Width=100,e.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinAmount,e.DataType="FLOAT",e.ReadOnly=!0,this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember)}this.LoadData()}LoadData(){let e;e=this.Parent.IsInventory?"select INV.InvDocDetailsID,INV.DocSeqNo,P.ProductCode,P.ProductName,INV.Quantity,INV.Rate,INV.Gross\n    from INV_DocDetails INV with(nolock)\n    join INV_Product P with(nolock) on P.ProductID=INV.ProductID\n    where INV.VoucherNo='"+this.item.DocNo+"' and INV.DynamicInvDocDetailsID is null\n    order by INV.DocSeqNo\n":"select ACC.AccDocDetailsID,ACC.DocSeqNo,A1.AccountName DrName,A2.AccountName CrName,ACC.Amount\n      from ACC_DocDetails ACC with(nolock)\n      join ACC_Accounts A1 with(nolock) on A1.AccountID=ACC.DebitAccount\n      join ACC_Accounts A2 with(nolock) on A2.AccountID=ACC.CreditAccount\n      where ACC.VoucherNo='"+this.item.DocNo+"'\n      order by ACC.DocSeqNo\n",this.GridObj.Visible=!1,l.d.report.DataSetAsyn("RPT022",e).then(t=>{t.Tables[0].length>0&&(t.Tables[0][0].AccDocDetailsID||t.Tables[0][0].InvDocDetailsID)&&this.GridObj.addRows(t.Tables[0])}).finally(()=>{this.GridObj.Visible=!0})}RefreshData(e){e.forEach(t=>{this.GridObj.Columns.forEach(s=>{})})}OnButtonClick(e){if("Cancel"==e)l.d.page.HideDialog(this.PopUpGUID);else{let t=[];this.IsSelective&&(this.GridObj.Table.forEach(s=>{s.select&&t.push({InvDocDetailsID:s.InvDocDetailsID})}),t.length>0?(this.item._LinkedIDs=t,this.item.select=!0,this.Parent.SelectedLinkedDocs.Contains(this.item)||this.Parent.SelectedLinkedDocs.push(this.item)):(this.item._LinkedIDs=[],this.item.select=!1,this.Parent.SelectedLinkedDocs.Contains(this.item)&&this.Parent.SelectedLinkedDocs.Remove(this.item)),this.Parent.GridObj.updateRow(this.item)),l.d.page.HideDialog(this.PopUpGUID)}}}var g=r(98060);class v extends L.g{get RoleType(){return l.d.SessionManager.RoleType}constructor(e,t,s="",n="",u=null){if(super(),this.Documents=new p.y$,this.lstDateCols=[],this.Buttons=[],this.CreateNew=[],this.colVoucherID="",this.colStatusID="",this.colAccStatusID="",this.PageNo=1,this.PageSize=20,this.CurrentRecords="",this.TotalRows=0,this.OverallTotalRows="",this.TotalPages=0,this.ExtWhere="",this.ExtWhereLinkStatus=!1,this.ExecutedQty="",this.ExecutedQuery="",this.ExecutedQueryJoin="",this.StatusList=[],this.LinkStatusList=[],this.DocJV=[],this.DocJVDr=[],this.DocJVCr=[],this.DocInfo=[],this.VoucherNo="",this.IsInventory=!1,this.DocumentType=0,this.ProfileLID=0,this.HideGrid=!0,this.IsFirstCall=!0,this.SelectedLinkedDocs=[],this.ShowPostFilter=!1,this.SelectedStatus=null,this.CostCenterID=e,this.ExtWhere=s,this.objParams=u,this.objParams?.DocsList?(this.dsRpt=l.d.common.GetDataSet3("DOC062",this.objParams.DocsList,""),this.CostCenterID=e=this.dsRpt.Tables[0][0].CostCenterID,t=this.dsRpt.Tables[0][0].DocumentName,("-1"==this.ExtWhere||"-2"==this.ExtWhere||"-3"==this.ExtWhere)&&(this.ExtWhereLinkStatus=!0)):this.dsRpt=l.d.common.GetDataSet3("DOC062",this.CostCenterID.toString(),n),this.Title=t,this.ReportID=g.uI.GetLandingReport(e),this.IsInventory=this.dsRpt.Tables[0][0].IsInventory,this.DocumentType=this.dsRpt.Tables[0][0].DocumentType,this.Documents.Items.push(p._p.ComboBoxItems_4(t,e.toString(),this.ReportID.toString(),this.dsRpt.Tables[0][0].IsInventory.toString())),0==this.ReportID&&(this.ReportID=(0,O.yG0)(this.dsRpt.Tables[0][0].IsInventory)?this.DocumentType>=51&&this.DocumentType<=199&&64!=this.DocumentType?219:217:218),this.Documents.LblWidth="0",this.Documents.SelectedValue=e.toString(),this.Documents.SelectionChangedCommand.Subscribe(this,"OnDocumentChanged"),this.objParams?.DocsList)for(let a=1;a<this.dsRpt.Tables[0].length;a++)this.Documents.Items.push(p._p.ComboBoxItems_4(this.dsRpt.Tables[0][a].DocumentName,this.dsRpt.Tables[0][a].CostCenterID.toString(),g.uI.GetLandingReport(this.dsRpt.Tables[0][a].CostCenterID),this.dsRpt.Tables[0][a].IsInventory.toString()));n&&this.IsInventory&&this.dsRpt.Tables[1].forEach(a=>{this.Documents.Items.push(p._p.ComboBoxItems_4(a.DocumentName,a.CostCenterID.toString(),g.uI.GetLandingReport(a.CostCenterID),this.dsRpt.Tables[0][0].IsInventory.toString()))}),1==this.Documents.Items.length&&(this.Documents.Visible=!1),this.rpt=new P.ReportViewModel,this.rpt.DocsLanding=this,this.GridObj=new y.vv,this.GridObj.Height=0,this.GridObj.Width="",this.GridObj.Table=[],this.GridObj.Columns=[],this.GridObj.OnLinkClick.Subscribe(this,"OnLinkClickEvent"),this.InitButtons(),this.GridObj.OnRowSelection.Subscribe(this,"OnRowChange")}OnDocumentChanged(){let e=this.Documents.GetselectedItem(),t=c.J0.Int(e.Parent);if(this.CreateNew.Clear(),this.SelectedLinkedDocs.Clear(),this.DocsList&&(this.DisplayName=e.Name,this.Title=e.Name),this.dsRpt.Tables[2].length>0&&this.dsRpt.Tables[2].filter(n=>n.CCID==parseInt(e.Value)).forEach(n=>{this.CreateNew.push(n)}),"0"==e.Parent&&(t=(0,O.yG0)(e.Aliasname)?this.DocumentType>=51&&this.DocumentType<=199&&64!=this.DocumentType?219:217:218),t!=this.ReportID||this.IsFirstCall)this.IsFirstCall=!1,this.ReportID=t,this.OnReportChange();else{this.SetExecutedQtyQuery();let s=this.GetQuery(1);this.LoadData(s)}}OnReportChange(){this.SetExecutedQtyQuery(),this.rpt.ReportViewModel_2(this.ReportID,N.Zv.LandingPage,null,null,this.objParams?.ReportFilterXML?this.objParams.ReportFilterXML:""),this.rpt.ShowFilter=!1,this.rpt.PostDataFetchFilterFields.forEach(t=>{let s=this.rpt.BaseReportColumns.find(n=>n.ID==t.ColumnName);s?.CDGDO.IsForeignKey&&(t.FromList.CCID=s.CDGDO.ColumnCostCenterID,t.FromList.TypeID=2==t.FromList.CCID?100:3==t.FromList.CCID?10:1)}),this.InitGrid(),this.HideGrid=!1,this.SelectedLinkedDocs.Clear(),this.rpt.SetQueryXMLTags();let e=this.GetQuery(1);this.LoadData(e)}SetExecutedQtyQuery(){this.ExecutedQty="",this.ExecutedQuery="",this.ExecutedQueryJoin="",this.ProfileLID=0,l.d.page.QuickDocumentData.Profiles.values.forEach(e=>{e.DocData.forEach(t=>{t.Docs.forEach(s=>{s.CCID!=this.Documents.SelectedValue||(this.ProfileLID=t.LID)})})}),this.IsInventory&&(this.ExtWhereLinkStatus||70!=this.ProfileLID&&80!=this.ProfileLID&&270!=this.ProfileLID&&280!=this.ProfileLID)&&(this.ExecutedQty=l.d.report.GetExecutedQtyQuery(0,this.Documents.SelectedValue,null,null,!1,!1),this.ExecutedQty.length<=120?this.ExecutedQty="":this.ExecutedQty.Contains("NUM")&&(this.ExecutedQueryJoin=" join COM_DocNumData NUM with(nolock) on NUM.InvDocdetailsID=INV.InvDocdetailsID"))}InitGrid(){this.GridObj.Table.Clear(),this.GridObj.Columns.Clear(),this.GridObj.TableColumns.Clear(),this.lstDateCols=[];let e=new m.O7;e.DisplayMember="select",e.Header="Select",e.Width=50,e.ReadOnly=!0,e.DataType="CheckBox",e.IsFrozen=!0,e.TextAlign="Center",e.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember),e=new m.O7,e.DisplayMember="_DocView",e.Header="View",e.Width=42,e.ReadOnly=!0,e.DataType="",e.DataType="LINK",e.TextAlign="Center",e.ValueBinding="fa-light fa-list",e.IsFrozen=!0,this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember),this.colVoucherID="",this.colStatusID="",this.rpt.ReportColumns.forEach(s=>{let n=this.rpt.BaseReportColumns.find(u=>u.ID==s.ID);e=new m.O7,e.DisplayMember=s.ID,e.Header=s.HeaderText,e.Width=s.width,e.ReadOnly=!0,e.DataType=s.DataAppearance.ColumnType,e.TextAlign=s.DataAppearance.Alignment,"FLOAT"==e.DataType?e.DecimalPoints="2":"DATE"==e.DataType?this.lstDateCols.push(s):n&&"VoucherNo"==n.CDGDO.Column?(e.DataType="LINK",0==this.colVoucherID.length&&(this.colVoucherID=s.ID)):113==n.CDGDO.ColumnCostCenterID&&(this.colStatusID=s.ID),this.GridObj.Columns.push(e),this.GridObj.TableColumns.push(e.DisplayMember)}),this.LinkStatusCol=this.GridObj.Columns.find(s=>"_LinkStatus"==s.DisplayMember),this.LinkStatusCol&&0==this.ExecutedQty.length&&this.GridObj.Columns.Remove(this.LinkStatusCol),this.colAccStatusID="";let t=this.GridObj.Columns.find(s=>"_AccStatus"==s.DisplayMember);t&&("True"==this.GetPrefValue("DonotupdateAccounts")?this.GridObj.Columns.Remove(t):this.colAccStatusID="_AccStatus"),this.GridObj.RefreshColumns()}InitButtons(){let e=new S.v;e.Expression="fa-light fa-plus-square",e.Label=l.d.GetResource("New"),e.DBColumnName="New",this.Buttons.push(e),e=new S.v,e.Expression="fa-light fa-file-edit",e.Label=l.d.GetResource("Edit"),e.DBColumnName="Edit",this.Buttons.push(e),e=new S.v,e.Expression="fa-light fa-arrows-rotate",e.Label=l.d.GetResource("Refresh"),e.DBColumnName="Refresh",this.Buttons.push(e),e=new S.v,e.Expression="fa-light fa-gears",e.Label=l.d.GetResource("Regenerate"),e.DBColumnName="Regenerate",this.Buttons.push(e)}OnRowChange(e){this.colVoucherID&&(this.DocJVDr.Clear(),this.DocJVCr.Clear(),this.DocInfo.Clear(),this.VoucherNo="",e&&e[this.colVoucherID]&&(this.colAccStatusID&&(this.DocInfo.push({Name:"Bill Amount",Value:c.J0.Int(e._BillAmt).Commas(l.d.SessionManager.Preferences.DecimalsinAmount)}),this.DocInfo.push({Name:"Ajusted Amount",Value:c.J0.Int(e._AdjAmt).Commas(l.d.SessionManager.Preferences.DecimalsinAmount)})),this.LinkStatusCol&&this.ExecutedQty.length>0&&(this.DocInfo.push({Name:"Total Quantity",Value:c.J0.Int(e.DQty).Commas(l.d.SessionManager.Preferences.DecimalsinQty)}),this.DocInfo.push({Name:"Executed Qty",Value:c.J0.Int(e.DExQty).Commas(l.d.SessionManager.Preferences.DecimalsinQty)})),this.VoucherNo=e[this.colVoucherID],l.d.report.DataSetAsyn("RPT052",this.IsInventory?"1":"0",this.VoucherNo).then(t=>{t.Tables[2].forEach(s=>{0!=c.J0.Int(s.Dr)&&(s.DrText=s.Dr.Commas("N2"),this.DocJVDr.push(s)),0!=c.J0.Int(s.Cr)&&(s.CrText=s.Cr.Commas("N2"),this.DocJVCr.push(s))}),this.DocJV=t.Tables[2]})))}OnLinkClickEvent(e,t){"_DocView"==t?(e._DetailsObj||(e._DetailsObj=new k(this,e)),l.d.page.ShowDialog(e._DetailsObj,M,{ShowCenter:!0,Title:"Details",VarWidth:!0})):c.J0.IsEmpty(e[t])||(2==l.d.SessionManager.RoleType?T.RibbonExtViewModel.LoadDocument_VoucherNoBidding(e[t].toString(),this):T.RibbonExtViewModel.LoadDocument_VoucherNo(e[t].toString()))}dgColSelect_CheckedChanged(e,t){t?this.SelectedLinkedDocs.Contains(e.item)||(this.SelectedLinkedDocs.push(e.item),e.item._LinkedIDs=null):this.SelectedLinkedDocs.Contains(e.item)&&(this.SelectedLinkedDocs.Remove(e.item),e.item._LinkedIDs=null)}OnButtonClick(e){var t=this;return(0,b.A)(function*(){if(t.DisplayMessage="","NEXT"==e){if(t.PageNo>=t.TotalPages)return void(t.DisplayMessage="No more records.");let s=t.GetQuery(t.PageNo+1);t.LoadData(s)}else if("PREVIOUS"==e){if(t.PageNo<=1)return void(t.DisplayMessage="No more records.");let s=t.GetQuery(t.PageNo-1);t.LoadData(s)}else if("FIRST"==e){if(1!=t.PageNo){let s=t.GetQuery(1);t.LoadData(s)}}else if("LAST"==e){if(t.PageNo!=t.TotalPages&&t.TotalPages>0){let s=t.GetQuery(t.TotalPages);t.LoadData(s)}}else if("New"==e)t.NewDocument(t.Documents.SelectedValue,t.Documents.GetText());else if("Edit"==e)t.GridObj.SelectedItem&&t.colVoucherID&&!c.J0.IsEmpty(t.GridObj.SelectedItem[t.colVoucherID])&&T.RibbonExtViewModel.LoadDocument_VoucherNo(t.GridObj.SelectedItem[t.colVoucherID].toString());else if("Refresh"==e){t.SelectedStatus=null,t.SelectedLinkedDocs.Clear();let s=t.GetQuery(1);t.LoadData(s)}else"RemoveExtWhere"==e?(t.ExtWhere="",t.ExtWhereLinkStatus=!1,t.OnButtonClick("Refresh")):"Regenerate"==e&&(t.rpt.Filter.Title="Filter",t.rpt.OnButtonClick("Regenerate"))})()}OnCreateNew(e){this.NewDocument(e.CCID,e.Title)}OnGenerate(e){var t=this;return(0,b.A)(function*(){if(0==t.SelectedLinkedDocs.length)return void(t.DisplayMessage="Please Select Documents.");let s={};const{AddEditDocumentComponent:n}=yield Promise.resolve().then(r.bind(r,8405)),{AddEditDocumentViewModel:u}=yield Promise.resolve().then(r.bind(r,27490));let a="";t.SelectedLinkedDocs.forEach(h=>{h._LinkedIDs&&h._LinkedIDs.forEach(i=>{a.length>0&&(a+=","),a+=i.InvDocDetailsID.toString()})});let D=null;a.length>0?(D=l.d.report.ReportDataTable("RPT022",!1,"select top 1 D.DebitAccount,D.CreditAccount,dcc.* from INV_DocDetails D with(Nolock) join com_docccdata dcc with(nolock) on D.invdocdetailsid=dcc.invdocdetailsid where D.invdocdetailsid in ("+a+")"),0==D.length&&(D=null)):(t.SelectedLinkedDocs.forEach(h=>{a.length>0&&(a+=","),a+="'"+h[t.colVoucherID].toString()+"'"}),D=l.d.report.ReportDataTable("RPT022",!1,"select top 1 D.DebitAccount,D.CreditAccount,dcc.* from INV_DocDetails D with(Nolock) join com_docccdata dcc with(nolock) on D.invdocdetailsid=dcc.invdocdetailsid where D.VoucherNo in ("+a+")"));let d=new u(parseInt(e.CostCenterID),e.DocumentName,null==D,D);Object.assign(s,{component:n,params:{obj:d}}),D.length>0&&("True"==d.ScreenObject.Preferences["Debit Account"]?d.ScreenObject.DebitAccount.SelectedValue=D[0].DebitAccount:"True"==d.ScreenObject.Preferences["Credit Account"]&&(d.ScreenObject.DebitAccount.SelectedValue=D[0].CreditAccount)),d.ScreenObject.Preferences.length>0&&d.ScreenObject.Preferences.ContainsKey("Debit Account")&&(0,O.yG0)(d.ScreenObject.Preferences["Debit Account"])?t.DisplayMessage="Vendor Wise Linking Enabled On Destination Document Please Check.":(t.SelectedLinkedDocs.forEach(h=>{d.FillLink(h[t.colVoucherID],e.DocumentLinkDefID,h._LinkedIDs,new Array)}),l.d.page.addNewTab(s))})()}NewDocument(e,t){return(0,b.A)(function*(){let s={};const{AddEditDocumentComponent:n}=yield Promise.resolve().then(r.bind(r,8405)),{AddEditDocumentViewModel:u}=yield Promise.resolve().then(r.bind(r,27490));let a=new u(parseInt(e),t,!1);Object.assign(s,{component:n,params:{obj:a}}),l.d.page.addNewTab(s)})()}OnStatusClick(e){this.ExtWhereLinkStatus&&(this.ExtWhere="",this.ExtWhereLinkStatus=!1),this.SelectedLinkedDocs.Clear(),this.StatusList.map(s=>s.IsSelected=!1),this.LinkStatusList.map(s=>s.IsSelected=!1),e.IsSelected=!0,this.SelectedStatus=e;let t=this.GetQuery(1);this.LoadData(t)}LoadData(e){this.DisplayName="Loading...",this.OnRowChange(null),l.d.report.DataSetAsyn("RPT022",e).then(t=>{let u,a,D,d,s=this.SelectedStatus?this.SelectedStatus.StatusID:0,n=t;if(this.GridObj.Clear(),n.Tables[0].forEach(i=>{i.id=this.GridObj.rowid,i.select=!1,this.colStatusID.length>0&&(i[this.colStatusID+"_CLR"]=R.AddEditDocumentViewModel.getStatusColor(i._StatusID)),u=this.SelectedLinkedDocs.find(C=>C[this.colVoucherID]==i[this.colVoucherID]),u&&(a=this.SelectedLinkedDocs.indexOf(u),-1!=a&&(i._LinkedIDs=u._LinkedIDs,i.select=!0,this.SelectedLinkedDocs[a]=i)),this.lstDateCols.forEach(C=>{c.J0.IsEmpty(i[C.ID])||(i[C.ID+"_Key"]=c.J0.ParseDate(i[C.ID]),i[C.ID]=i[C.ID+"_Key"].ToString(C.DataFormat.DateType))}),this.colAccStatusID.length>0&&(D=c.J0.Int(i._BillAmt),d=c.J0.Int(i._AdjAmt),0!=D&&(0==d?(i._AccStatus="Unpaid",i._AccStatus_CLR="#017EFA"):D-d==0?(i._AccStatus="Paid",i._AccStatus_CLR="#21bf74"):(i._AccStatus="Partially-Paid",i._AccStatus_CLR="#FF9700")))}),this.ExecutedQty.length>0){let i,C;n.Tables[0].forEach(I=>{i=c.J0.Int(I.DQty),C=c.J0.Int(I.DExQty),0==C?(I._LinkStatus="Pending",I._LinkStatus_CLR="#017EFA"):0!=C&&i-C>0?(I._LinkStatus="Partially-Executed",I._LinkStatus_CLR="#FF9700"):(I._LinkStatus="Executed",I._LinkStatus_CLR="#21bf74")})}this.GridObj.addRows(n.Tables[0]),n.Tables.length>1?(s<0?(this.TotalRows=n.Tables[2].filter(i=>i.StatusID==s).Compute("sum","CNT"),this.TotalPages=Math.floor(this.TotalRows/this.PageSize),this.TotalRows%this.PageSize>0&&this.TotalPages++):(this.TotalRows=n.Tables[1].Compute("sum","CNT"),this.TotalPages=Math.floor(this.TotalRows/this.PageSize),this.TotalRows%this.PageSize>0&&this.TotalPages++),0==s&&(this.OverallTotalRows=this.TotalRows.Commas("N0"),this.StatusList.Clear(),n.Tables[1].forEach(i=>{i.Clr=R.AddEditDocumentViewModel.getStatusColor(i.StatusID),i.CNTText=c.J0.Int(i.CNT).Commas("N0"),i.Per=this.TotalRows>0?100*c.J0.Int(i.CNT)/this.TotalRows:c.J0.Int(i.CNT)>0?100:0,i.PerText=i.Per-Math.floor(i.Per)!=0?i.Per.Commas("N1")+"%":i.Per.Commas("N0")+"%",i.SOrder=371==i.StatusID?1:441==i.StatusID?2:372==i.StatusID?3:369==i.StatusID?4:376==i.StatusID?5:443==i.StatusID?6:445==i.StatusID?7:1e3}),n.Tables[1].SortBy(["SOrder"]),this.StatusList=n.Tables[1]),this.LoadDocLinkStatus()):null!=this.SelectedStatus&&this.CalculatePages(this.SelectedStatus.CNT);let h=(this.PageNo-1)*this.PageSize;this.CurrentRecords=(h+1).toString()+" - "+(h+n.Tables[0].length).toString()}).finally(()=>{this.DisplayName=this.Title})}LoadDocLinkStatus(){this.LinkStatusList.Clear(),0!=this.ExecutedQuery.length&&l.d.report.DataSetAsyn("RPT022",this.ExecutedQuery).then(e=>{if(0!=e.Tables.length){if(e.Tables[0].forEach(t=>{-2==t.StatusID?(t.Clr="#21bf74",t.Status="Excuted"):-3==t.StatusID?(t.Clr="#FF9700",t.Status="Partially-Excuted"):(t.Clr="#017EFA",t.Status="Open"),t.CNTText=c.J0.Int(t.CNT).Commas("N0"),t.Per=this.TotalRows>0?100*c.J0.Int(t.CNT)/this.TotalRows:c.J0.Int(t.CNT)>0?100:0,t.PerText=t.Per-Math.floor(t.Per)!=0?t.Per.Commas("N1")+"%":t.Per.Commas("N0")+"%"}),this.ExtWhereLinkStatus){let t=e.Tables[0].find(s=>s.StatusID==parseInt(this.ExtWhere));t&&this.CalculatePages(t.CNT)}this.LinkStatusList=e.Tables[0]}})}CalculatePages(e){this.TotalRows=e,this.TotalPages=Math.floor(this.TotalRows/this.PageSize),this.TotalRows%this.PageSize>0&&this.TotalPages++}GetQuery(e){let n,t=this.SelectedStatus?this.SelectedStatus.StatusID:0,s="",u="",a="",D="",d=!1;return n=this.rpt.FromTag.Contains("INV")?"INV":"ACC",this.ExtWhereLinkStatus&&(t=parseInt(this.ExtWhere)),this.rpt.BaseReportColumns.forEach(h=>{h.CDGDO.ActualColumn&&(h.CDGDO.ActualColumn.Contains("(SELECT")||("FLOAT"==h.CDGDO.DataType?u+=",sum(convert(float,"+h.CDGDO.ActualColumn+")) "+h.ID:h.CDGDO.ActualColumn.startsWith("stuff(")||h.CDGDO.ActualColumn.startsWith("STUFF(")?(d=!0,u+=","+h.CDGDO.ActualColumn+" "+h.ID):(u+=",max("+h.CDGDO.ActualColumn+") "+h.ID,this.colStatusID==h.ID&&(u+=",max("+h.CDGDO.ActualColumn+"ID) _StatusID"))))}),this.colAccStatusID.length>0&&(u+=",(SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_Billwise CB WITH(NOLOCK) WHERE CB.DocNo=INV.VoucherNo) _BillAmt\n            ,(SELECT ISNULL(SUM(abs(AdjAmount)),0) FROM COM_Billwise CB WITH(NOLOCK) WHERE IsNewReference=0 AND (CB.RefDocNo=INV.VoucherNo OR CB.DocNo=INV.VoucherNo)) _AdjAmt"),this.LinkStatusCol&&this.ExecutedQty.length>0||t<0?(s="with rows as ( SELECT row_number() over (order by DDocID desc) rowno,* from (SELECT ",s+="(select sum(DExQty) from (select  ("+this.ExecutedQty.split("INV.").join("D.")+") DExQty\nfrom INV_DocDetails D with(nolock)"+this.ExecutedQueryJoin.replace("INV.","D.")+" where D.DocID=INV.DocID\n) AS T)\nDExQty\n, sum(INV.Quantity) DQty\n,INV.DocID DDocID\n",s+=u):s="with rows as ( SELECT row_number() over (order by "+n+".DocID desc) rowno"+u,s+="\nFROM "+this.rpt.FromTag,this.ExecutedQueryJoin.length>0&&-1!=s.indexOf("sum(DExQty)")&&(s+=this.ExecutedQueryJoin),a=this.rpt.WhereTag,""==this.rpt.WhereTag?a=n+".CostCenterID="+this.Documents.SelectedValue:a+=" and "+n+".CostCenterID="+this.Documents.SelectedValue,(2==l.d.SessionManager.RoleType||3==l.d.SessionManager.RoleType)&&(a+=" and ("+n+".DebitAccount="+l.d.SessionManager.ESSID+" or "+n+".CreditAccount="+l.d.SessionManager.ESSID+")"),this.ExtWhereLinkStatus||(a+=this.ExtWhere),t>0&&(a+=" and "+n+".StatusID="+t),s+="\nWHERE "+a,D=n+".DocID,"+n+".VoucherNo",d&&(D=n+".CostCenterID,"+D),s+="\nGROUP BY "+D,this.LinkStatusCol&&this.ExecutedQty.length>0||t<0?(s+=") AS T",t<0&&(s+=-2==t?" where DQty-DExQty<=0":-3==t?" where DExQty!=0 and  DQty-DExQty>0":" where DExQty=0"),s+=") select * from rows WHERE rowno>"+(e-1)*this.PageSize+" and rowno<="+e*this.PageSize+" order by rowno"):s+=") select * from rows WHERE rowno>"+(e-1)*this.PageSize+" and rowno<="+e*this.PageSize+" order by rowno",1==e&&(0==t||this.ExtWhereLinkStatus)&&(s+="\nselect S.StatusID,S.Status,count(*) CNT from (\nSELECT "+n+".StatusID,"+n+".DocID\nFROM "+this.rpt.FromTag+"\nWHERE "+a+"\nGROUP BY "+n+".StatusID,"+D+") AS T\njoin COM_Status S with(nolock) on S.StatusID=T.StatusID\ngroup by S.StatusID,S.Status",this.ExecutedQty.length>0&&(this.ExecutedQuery="\n        select StatusID,count(*) CNT from(\n        select DocID,case when sum(DExQty)=0 then -1 when sum(Quantity)>sum(DExQty) then -3 else -2 end StatusID from (\n        SELECT "+n+".DocID,"+n+".Quantity,"+this.ExecutedQty+" DExQty\n        FROM "+this.rpt.FromTag+this.ExecutedQueryJoin+"\n        WHERE "+a+"\n        ) AS T GROUP BY DocID) AS T group by StatusID order by StatusID desc")),this.PageNo=e,s}GetPrefValue(e){let t=this.dsRpt.Tables[3].find(s=>s.PrefName==e&&s.CostCenterID==parseInt(this.Documents.SelectedValue));return t?c.J0.String(t.PrefValue):""}}}}]);