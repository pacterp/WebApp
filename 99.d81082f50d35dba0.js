"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[99],{90099:(L,E,l)=>{l.r(E),l.d(E,{AddCurrencyViewModel:()=>f,DeletedRecords:()=>x});var s=l(32040),n=l(43767),u=l(58170),h=l(21774),D=l(58941),p=l(23458),o=l(27730),C=l(98580),g=l(83809),S=l(7321),I=l(1157),m=l(82503);class d extends C.g{constructor(e){super(),this.SaveNote=new u.Yk,this.Enable=!1,this.NoteID=0,this.NoteText="",this.CurrencyTypes=[],this.Index=0,this.ClassName="AddExchViewModel",Logger.InfoLog("AddExchViewModel::Entering AddExchViewModel with Parent="+e),this.Parent=e,this.CurrencyTypes=[],this.SaveNote.Subscribe(this,"OnSaveExchRate","onCanSaveOnSaveExchRate"),this.ExchDate=new m.Lc(0),this.ExchDate.Date=Date.Today(),this.ExchDate.Label="Date",this.ExchDate.DBColumnName="ExchDate",Logger.InfoLog("AddExchViewModel::Exiting AddExchViewModel")}OnSaveExchRate(e){if(null==e||"Cancel"!=e.toString()){if(Logger.InfoLog("AddExchViewModel::Entering OnSaveExchRate"),null==this.SelectedItem)return void alert("Please set Daily exchange rate for this currency");if(0==this.ExchRate.Trim().length||null==this.SelectedItem.Name||""==this.SelectedItem.Name)return;if(!this.Parent.ViewExhangeRates.ExchList.Contains(this)){let t=0;for(let i=0;i<this.Parent.ViewExhangeRates.ExchList.length;i++)if(!n.J0.IsEmpty(this.Parent.ViewExhangeRates.ExchList[i].SelectedItem)&&!n.J0.IsEmpty(this.Parent.ViewExhangeRates.ExchList[i].ExchDate)&&this.Parent.ViewExhangeRates.ExchList[i].SelectedItem.Name==this.SelectedItem.Name&&this.Parent.ViewExhangeRates.ExchList[i].ExchDate.Date==this.ExchDate.Date&&(t++,this.Index=i,!confirm("Exchange rate already exists for this date, do you want to overwrite?")))return;if(0==t){this.Parent.ViewExhangeRates.ExchList.push(this),this.Parent.ViewExhangeRates.ExchListDataTable.addEmptyRow();let i=this.Parent.ViewExhangeRates.ExchListDataTable.Table.length-1;this.Parent.ViewExhangeRates.ExchListDataTable.Table[i].Sno=i+1,this.Parent.ViewExhangeRates.ExchListDataTable.Table[i].SelectedCurrencyType=this.SelectedCurrencyType,this.Parent.ViewExhangeRates.ExchListDataTable.Table[i].Name=this.SelectedItem.Name,this.Parent.ViewExhangeRates.ExchListDataTable.Table[i].Text=this.ExchDate.Date,this.Parent.ViewExhangeRates.ExchListDataTable.Table[i].ExchDate=this.ExchDate.Date.ToString(s.d.SessionManager.Preferences["Date Format"]),this.Parent.ViewExhangeRates.ExchListDataTable.Table[i].ExchRate=this.ExchRate,this.Parent.ViewExhangeRates.ExchListDataTable.updateRow(this.Parent.ViewExhangeRates.ExchListDataTable.Table[i])}let a=this.Parent.Exch.SelectedCurrencyType;this.Parent.OnAddExchangeRate(),this.Parent.Exch.SelectedCurrencyType=a,Logger.InfoLog("AddExchViewModel::Exiting OnSaveExchRate")}}}onCanSaveOnSaveExchRate(e){return!0}OnDeleteCallBack(){this.Parent.ViewExhangeRates.ExchList.RemoveAt(this.Index),this.Parent.ViewExhangeRates.ExchList.push(this),this.Parent.ViewExhangeRates.ExchListDataTable.Table.RemoveAt(this.Index),this.Parent.ViewExhangeRates.ExchListDataTable.addEmptyRow();let e=this.Parent.ViewExhangeRates.ExchListDataTable.Table.length-1;this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].SelectedCurrencyType=this.SelectedCurrencyType,this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].Name=this.SelectedItem.Name,this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].Text=n.J0.ParseDate(this.ExchDate.Date),this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].ExchDate=n.J0.ParseDate(this.ExchDate.Date).ToString(s.d.SessionManager.Preferences["Date Format"]),this.Parent.ViewExhangeRates.ExchListDataTable.Table[e].ExchRate=this.ExchRate}}var T=l(84151);class w extends C.g{get angularGrid(){return this.ExchListDataTable.angularGrid}constructor(e){let t;super(),this.ColumnSpan="4",this.SelectionChangedCommandAssign=new u.Yk,this.Currency=[],this.FromDate=new m.Lc(0),this.Todate=new m.Lc(0),this.contextVisible=!0,this.ShowNewExchange=new u.Yk,this.ButtonClick=new u.Yk,this.ExchListDataTable=new S.vv,this.TempExchListDataTable=[],this.ExchList=[],this.ColumnSource=new Array,this.DeletedNotes=[],this.ButtonAdd=new D.v,this.ButtonUpdate=new D.v,this.ButtonDelete=new D.v,this.Module="ACC",this.cmnItem_Click=new u.Yk,this.ClassName="ViewExchangeRateViewModel",Logger.InfoLog("ViewExchangeRateViewModel::Entering ViewExchangeRateViewModel with Parent="+e),this.Parent=e,this.FromDate.Label=s.d.GetResource("Calender_FromDate"),this.Todate.Label=s.d.GetResource("Calender_ToDate"),this.SelectionChangedCommandAssign.Subscribe(this,"onSelectionChangedAssign"),this.Currency=[],!this.ButtonUpdate.Visible&&!this.ButtonDelete.Visible&&(this.contextVisible=!1),this.cmnItem_Click.Subscribe(this,"OnCmnItem_Click","onCanCmnItem_Click"),this.ShowNewExchange.Subscribe(this,"OnShowNewExchange"),this.ButtonClick.Subscribe(this,"OnButtonClick"),this.ExchListDataTable.Table=[],this.ExchListDataTable.TableColumns.push("Sno"),this.ExchListDataTable.TableColumns.push("SelectedCurrencyType"),this.ExchListDataTable.TableColumns.push("Name"),this.ExchListDataTable.TableColumns.push("Text"),this.ExchListDataTable.DataTypes.Date.push("Text"),this.ExchListDataTable.TableColumns.push("ExchDate"),this.ExchListDataTable.TableColumns.push("ExchRate"),t=new h.O7,t.Header=s.d.GetResource("Currency_CurrencyName"),t.DisplayMember="Name",t.DataType="TextBlock",t.ReadOnly=!0,t.Width=250,this.ColumnSource.push(t),t=new h.O7,t.Header=s.d.GetResource("Exch_Date"),t.DisplayMember="ExchDate",t.ReadOnly=!0,t.DataType="TextBlock",t.Width=250,this.ColumnSource.push(t),t=new h.O7,t.Header=s.d.GetResource("Currency_ExchangeRate"),t.DisplayMember="ExchRate",t.DataType="TextBlock",t.Width=250,t.ReadOnly=!0,this.ColumnSource.push(t),this.ExchListDataTable.Columns=this.ColumnSource,this.ExchListDataTable.ContextMenuClickSubject.subscribe(i=>{this.OnCmnItem_Click(i.item.Tag)}),this.ExchListDataTable.ContextMenu.Items=[];let a=new h.Dr;a.Header="EDIT",a.Tag="EDIT",a.Visibility=!0,this.ExchListDataTable.ContextMenu.Items.push(a),a=new h.Dr,a.Header="DELETE",a.Tag="DELETE",a.Visibility=!0,this.ExchListDataTable.ContextMenu.Items.push(a),Logger.InfoLog("ViewExchangeRateViewModel::Exiting ViewExchangeRateViewModel ")}onSelectionChangedAssign(e){for(let t=0;t<this.ExchList.length;t++)this.ExchListDataTable.addEmptyRow(),this.ExchListDataTable.Table[t].SelectedCurrencyType=this.ExchList[t].SelectedCurrencyType,this.ExchListDataTable.Table[t].Name=this.ExchList[t].SelectedItem.Name,this.ExchListDataTable.Table[t].Text=this.ExchList[t].ExchDate.Date,this.ExchListDataTable.Table[t].ExchDate=this.ExchList[t].ExchDate.Date.ToString(s.d.SessionManager.Preferences["Date Format"]),this.ExchListDataTable.Table[t].ExchRate=this.ExchList[t].ExchRate}OnCmnItem_Click(e){Logger.InfoLog("ViewExchangeRateViewModel::Entering OnCmnItem_Click with Command="+e),this.SelectedNote=null;let t=this.angularGrid.slickGrid.getSelectedRows();if(t.length>0){switch(this.SelectedNote=this.ExchListDataTable.Table[t[0]],e){case"EDIT":null!=this.SelectedNote&&(this.Parent.ExchangeVisibility=!0,this.Parent.Exch.SelectedCurrencyType=this.SelectedNote[this.ExchListDataTable.TableColumns[1]],n.J0.isValidDate(this.SelectedNote[this.ExchListDataTable.TableColumns[3]])&&(this.Parent.Exch.ExchDate.Date=n.J0.ParseDate(this.SelectedNote[this.ExchListDataTable.TableColumns[3]])),this.Parent.Exch.ExchRate=this.SelectedNote[this.ExchListDataTable.TableColumns[5]]);break;case"DELETE":null!=this.SelectedNote&&this.ExchListDataTable.removeRow(this.SelectedNote)}Logger.InfoLog("ViewExchangeRateViewModel::Exiting OnCmnItem_Click")}}onCanCmnItem_Click(e){return!0}GetXML(){Logger.InfoLog("ViewExchangeRateViewModel::Entering GetXML");let e="";for(let t=0;t<this.ExchList.length;t++)null!=this.ExchList[t].SelectedItem&&(e+='<Row Action="NEW"',e+=' CurrencyID="'+this.ExchList[t].SelectedCurrencyType+'"',e+=' Currency="'+T.Dw.GetValidXml(this.ExchList[t].SelectedItem.Name)+'"',e+=' ExchDate="'+n.J0.ParseDate(T.Dw.GetValidXml(this.ExchList[t].ExchDate.Date.toString())).ToString("dd/MMM/yyyy")+'"',e+=' ExchRate="'+T.Dw.GetValidXml(this.ExchList[t].ExchRate)+'"',e+="/>");for(let t=0;t<this.DeletedNotes.length;t++)e+='<Row Action="DELETE"',e+=' CurrencyID="'+this.DeletedNotes[t].SelectedCurrencyType+'"/>';return e.length>0&&(e="<ExchXML>"+e+"</ExchXML>"),Logger.InfoLog("ViewExchangeRateViewModel::Exiting GetXML which returns XML="+e),e.Replace("&","&amp;"),e.toString()}OnShowNewExchange(e){Logger.InfoLog("ViewExhangeRateViewModel::Entering OnShowNewExchange");try{this.ButtonAdd.Enable&&this.ButtonAdd.Visible&&(this.Parent.Exch=new d(this.Parent),this.Parent.ExchangeVisibility=!0,this.Parent.OnShowExchangeRate()),Logger.InfoLog("ViewExhangeRateViewModel::Exiting OnShowNewExchange")}catch(t){Logger.ErrorLog("AddProductViewModel:: OnShowNewExchange"+t.stack)}}OnButtonClick(e){"Refresh"==e&&(this.ExchListDataTable.Table=this.Parent.DataTable.length>this.Parent.SelectedNode?this.TempExchListDataTable.filter(t=>t.SelectedCurrencyType==this.Parent.DataTable[this.Parent.SelectedNode].CurrencyID.toString()&&t.Text>=this.FromDate.Date&&t.Text<=this.Todate.Date):this.TempExchListDataTable)}Animate(){}LoadExchRates(e){Logger.InfoLog("ViewExchangeRateViewModel::Entering LoadExchRates with TableData="+e),this.ExchListDataTable.Clear(),this.ExchList.Clear();for(let a=0;a<e.length;a++){if("0"==n.J0.StringValue(e[a].ED))continue;let i=new d(this.Parent);var t=this.Parent.Exch.CurrencyTypes.find(c=>c.Name==e[a].Name.toString());null!=t&&(i.SelectedItem=t),i.NoteID=a+1,i.SelectedCurrencyType=e[a].CurrencyID.toString(),i.ExchDate.Date=n.J0.ParseDate(e[a].ExchangeDate.toString().split(" ")[0]),i.ExchDate.Text=n.J0.ParseDate(e[a].ExchangeDate).ToString(s.d.SessionManager.Preferences["Date Format"]),i.ExchRate=e[a].ExchangeRate.toString(),this.ExchList.push(i);let r=this.ExchListDataTable.NewRow();r.Sno=a+1,r.SelectedCurrencyType=e[a].CurrencyID.toString(),r.Name=e[a].Name.toString(),r.Text=n.J0.ParseDate(e[a].ExchangeDate),r.ExchDate=n.J0.ParseDate(e[a].ExchangeDate).ToString(s.d.SessionManager.Preferences["Date Format"]),r.ExchRate=e[a].ExchangeRate.toString(),this.ExchListDataTable.addRow(r)}this.TempExchListDataTable=this.ExchListDataTable.Table.Copy(),Logger.InfoLog("ViewExchangeRateViewModel::Exiting LoadExchRates")}OnDeleteCallBack(){null!=this.SelectedNote&&null!=this.SelectedNote[0]&&""!=this.SelectedNote[0].toString()&&parseInt(this.SelectedNote[0].toString())>0&&(this.id=parseInt(this.SelectedNote[0].toString()),this.DeletedNotes.push(this.ExchList[this.id-1])),this.ExchList.length>=this.id&&(this.ExchList.RemoveAt(this.id-1),this.ExchListDataTable.Table.RemoveAt(this.id-1))}}var R=l(85985);class x{constructor(e){this.iSeqno=0,this.iSeqno=e}}class f extends C.g{OnCmnItem_Click(e){Logger.InfoLog("AddCurrencyViewModel::Entering OnCmnItem_Click"),this.DataTable.length<1&&(this.DisplayMessage=s.d.GetResource("Cur_NO"),this.MessageVisibility=!0);let t=null,a=this.angularGrid.slickGrid.getSelectedRows();a.length>0&&(t=this.DataTable[a[0]],this.SelectedNode<this.DataTable.length&&"DELETE"===e&&this.DataTableObj.removeRow(t),Logger.InfoLog("AddCurrencyViewModel::Exiting OnCmnItem_Click"))}onCanCmnItem_Click(e){return!0}get SelectedNode(){return this._SelectedNode}set SelectedNode(e){e!=this._SelectedNode&&(this._SelectedNode=e,this.ViewExhangeRates.SelectedCurrencyText=this._SelectedNode>=0&&this.DataTable.length>this._SelectedNode?this.DataTable[this._SelectedNode].Name.toString():"")}get CurrencyName(){return this._CurrencyName}set CurrencyName(e){e!=this._CurrencyName&&(this.CurrencyCombo.SelectedValue=e,this._CurrencyName=e)}get angularGrid(){return this.DataTableObj.angularGrid}get DataTable(){return this.DataTableObj.Table}get DataTableColumns(){return this.DataTableObj.TableColumns}get NumericColumnSource(){return this._NumericColumnSource}get NumericdDt(){return this._NumericdDt}constructor(){super(),this.CustomTab=new g.Z,this.TabIndex=new g.O,this.SelectedItem=new u.Yk,this.lstDeletedRecords=[],this.CurrencyTypes=[],this.Currency=[],this.CurrencyCombo=new o.y$,this.Dim=new p.y$(0),this._GUID="",this.DataTableObj=new S.vv,this.ButtonAdd=new D.v,this.ButtonUpdate=new D.v,this.ButtonDelete=new D.v,this._NumericColumnSource=[],this.DynamicCommand=new u.Yk,this.SaveCurrency=new u.Yk,this.RowDelete=new u.Yk,this.cmnItem_Click=new u.Yk,this.ExTable=[],this.CurrLookup=null,this.Module="ACC",this.selectedCurrencyID="",this.SNO=1,this.PACTControlData=[],this.ClassName="AddCurrencyViewModel",this.lblExchangeRate=s.d.GetResource("Currency_ExchangeRate"),this.lblDecimals=s.d.GetResource("Currency_Decimals"),this.lblIsBaseCurrency=s.d.GetResource("Currency_IsBaseCurrency"),this.lblTitle=s.d.GetResource("Currency_Title"),this.lblHeader=s.d.GetResource("Currency_GroupHeader"),Logger.InfoLog("AddCurrencyViewModel::Entering AddCurrencyViewModel"),this.DataTableObj.CellEditEnding.Subscribe(this,"OnCellEditEnding"),this.DataTableObj.BeginEdit.Subscribe(this,"onBeginEdit"),this.DataTableObj.RowSelectionChange.Subscribe(this,"OnSelectedItem"),this.ViewExhangeRates=new w(this),this.Exch=new d(this),s.d.SessionManager.HideUnathorizedAccess?this.ButtonAdd.Visible=s.d.SessionManager.IsActionAssigned(12,"Create"):this.ButtonAdd.Enable=s.d.SessionManager.IsActionAssigned(12,"Create"),s.d.SessionManager.HideUnathorizedAccess?this.ButtonUpdate.Visible=s.d.SessionManager.IsActionAssigned(12,"Update"):this.ButtonUpdate.Enable=s.d.SessionManager.IsActionAssigned(12,"Update"),s.d.SessionManager.HideUnathorizedAccess?this.ButtonDelete.Visible=s.d.SessionManager.IsActionAssigned(12,"Delete"):this.ButtonDelete.Enable=s.d.SessionManager.IsActionAssigned(12,"Delete"),this._ScreenID="12",this.PactScreenID="12",this.worker_DoWork(null,null),this.worker_RunWorkerCompleted(null,null),this.BuildGridData(),this.BindCurrencies(1),this.MessageVisibility=!1,this.DisplayMessage="Currency",this._ScreenID="12",this.PactScreenID="12",this.DataTableObj.TableNewRow.Subscribe(this,"onAddRow"),this.DataTableObj.RowDeleted.Subscribe(this,"onDeleteRow"),this.cmnItem_Click.Subscribe(this,"OnCmnItem_Click"),this.SaveCurrency.Subscribe(this,"OnSaveCurrency, onCanSaveCurrency"),this.AddTabDetails(),this.CurrencyTypes=this.Exch.CurrencyTypes,this.Currency=this.ViewExhangeRates.Currency,this.ExchangeVisibility=!0,this.DataTable.length>0&&""!=this.DataTable[0].CurrencyID.toString()&&(this.SelectedNode=0,this.ViewExhangeRates.SelectedCurrencyText=this.DataTable[0].Name.toString(),this.ViewExhangeRates.ExchListDataTable.Table=this.ViewExhangeRates.TempExchListDataTable.filter(t=>t.SelectedCurrencyType==this.DataTable[0].CurrencyID.toString()&&t.Text>=this.ViewExhangeRates.FromDate.Date.ToString("dd MMM yyyy")&&t.Text<=this.ViewExhangeRates.Todate.Date.ToString("dd MMM yyyy")));let e=0;e=n.J0.IntTryParse(s.d.SessionManager.Preferences.DimensionwiseCurrency),e>5e4?(this.Dim.Visible=!0,this.Dim.CCID=e,this.Dim.TypeID=1,this.Dim.OnPactListBoxValueChanged.Subscribe(this,"OnvalueChanged")):this.Dim.Visible=!1,this.CurrencyCombo.SelectionChangedCommand.Subscribe(this,"OnCurrencyComboChange"),Logger.InfoLog("AddCurrencyViewModel::Exiting AddCurrencyViewModel")}OnCurrencyComboChange(e){if(null!=this.CurrLookup)if(n.J0.IsEmpty(e))this.Symbol="",this.Change="";else{let t=this.CurrLookup.filter(a=>a.Name==e.SelectedValue);t.length>0?(this.Symbol=t[0].Code.toString(),this.Change=t[0].Change.toString()):(this.Symbol="",this.Change="")}}OnvalueChanged(e){this.DisplayMessage="",this.MessageVisibility=!1,this.Dim.SelectedValue>0?this.BindCurrencies(this.Dim.SelectedValue):(this.DataTableObj.Clear(),this._CurrencyID=0,this.BaseCurr=0,this.CurrencyName="",this.Symbol="",this.Change="",this.ExTable.Rows.Clear())}AddCurrencyDetails(){this.ViewExhangeRates.Currency.Clear(),this.ViewExhangeRates.Currency.push(o._p.ComboBoxItems_2("All","-100")),this.Exch.CurrencyTypes.Clear();for(let e=0;e<this.DataTable.length;e++)null!=this.DataTable[e].IsDailyRates&&""!=this.DataTable[e].IsDailyRates.toString()&&"true"==this.DataTable[e].IsDailyRates.toString().toLowerCase()&&(this.Exch.CurrencyTypes.push(o._p.ComboBoxItems_2(this.DataTable[e].Name.toString(),this.DataTable[e].CurrencyID.toString())),this.ViewExhangeRates.Currency.push(o._p.ComboBoxItems_2(this.DataTable[e].Name.toString(),this.DataTable[e].CurrencyID.toString())))}OnSelectedItem(e){try{let a=e.Row;if(this.SelectedNode=e.RowIndex,"DataGridComboBoxColumn"==e.column.className)return;if(null!=a){this.Exch.SelectedCurrencyType=a.CurrencyID.toString(),this.selectedCurrencyID=this.Exch.SelectedCurrencyType;var t=this.Exch.CurrencyTypes.find(i=>i.Name==a.Name.toString());null!=t&&(this.Exch.SelectedItem=t),n.J0.IsEmpty(a.CurrencyID)||(this.ViewExhangeRates.ExchListDataTable.Table=this.ViewExhangeRates.TempExchListDataTable.filter(i=>i.SelectedCurrencyType==a.CurrencyID&&i.Text>=this.ViewExhangeRates.FromDate.Date&&i.Text<=this.ViewExhangeRates.Todate.Date))}}catch{}}OnCellEditEnding(e){let t=e.item;if(null!=t&&"StatusID"==e.column.field)null!=t.IsDailyRates&&""!=t.IsDailyRates.toString()&&"true"==t.IsDailyRates.toString().toLowerCase()&&(0==this.Exch.CurrencyTypes.filter(a=>a.Name==t.Name.toString()).length&&(""!=t.CurrencyID.toString()?(this.Exch.CurrencyTypes=[],this.Exch.CurrencyTypes.push(o._p.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString())),this.Exch.SelectedCurrencyType=t.CurrencyID.toString(),this.Exch.SelectedItem=this.Exch.CurrencyTypes.find(a=>a.Value==t.CurrencyID)):(t.CurrencyID=0==this.Exch.CurrencyTypes.length?-1:parseInt(2)-1,this.Exch.CurrencyTypes=[],this.Exch.CurrencyTypes.push(o._p.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString())),this.Exch.SelectedCurrencyType=t.CurrencyID.toString(),this.Exch.SelectedItem=this.Exch.CurrencyTypes.find(a=>a.Value==t.CurrencyID))),0==this.ViewExhangeRates.Currency.filter(a=>a.Name==t.Name.toString()).length&&this.ViewExhangeRates.Currency.push(o._p.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString())));else if(null!=t&&"Symbol"==e.column.field){let a=0;for(let i=0;i<this.DataTable.length;i++)n.J0.IsEmpty(this.DataTable[i].Name)||this.DataTable[i].Name.toString().toLowerCase()==t.Name.toString().toLowerCase()&&a++;if(a>1&&(this.DisplayMessage="Duplicate Currency Name",t.Name=""),""!=t.Name.toString()){t.StatusID="true";let i=this.DataTable.Compute("max","CurrencyID");null!=i&&null!=i&&(t.CurrencyID=parseInt(i)+1)}else t.IsDailyRates="",t.StatusID="";if(this.CurrencyCombo.Visible)if(""!=n.J0.String(t.Name)){let i=this.CurrLookup.filter(r=>r.Name==t.Name.toString());i.length>0?(t.Symbol=n.J0.String(i[0].Code),t.Change=n.J0.String(i[0].Change)):(t.Symbol="",t.Change="")}else t.Symbol="",t.Change="";this.DataTableObj.updateRow(t)}else if(null!=t&&"Change"==e.column.field){let a=0;for(let i=0;i<this.DataTable.length;i++)n.J0.IsEmpty(this.DataTable[i].Symbol)||this.DataTable[i].Symbol.toString().toLowerCase()==t.Symbol.toString().toLowerCase()&&a++;a>1&&(this.DisplayMessage="Duplicate Currency Symbol",t.Symbol="")}else if(null!=t&&"Decimals"==e.column.field){let a=0;a=n.J0.DoubleTryParse(t.ExchangeRate.toString()),a<=0&&(this.DisplayMessage="Invalid Exchange Rate")}else if(null!=t&&"IsDailyRates"==e.column.field){let a=0;a=n.J0.DoubleTryParse(t.Decimals.toString()),a<=0&&(this.DisplayMessage="Invalid Decimals"),""!=t.CurrencyID.toString()&&(this.Exch.CurrencyTypes=[],this.Exch.CurrencyTypes.push(o._p.ComboBoxItems_2(t.Name.toString(),t.CurrencyID.toString())),this.Exch.SelectedCurrencyType=t.CurrencyID.toString(),this.Exch.SelectedItem=this.Exch.CurrencyTypes.find(i=>i.Value==t.CurrencyID))}}onBeginEdit(e){let i=this.DataTableObj.Table.indexOf(e.args.item);if(i=-1==i||1==this.DataTableObj.Table.length||0==this.DataTableObj.Table.length||this.DataTableObj.Table.length-i<=1?1:0,this.DataTableObj.CanUserAddRows)for(let r=0;r<i;r++){let c=this.DataTableObj.NewRow();this.DataTableObj.addRow(c)}}AddTabDetails(){let e;e=new g.O,e.Name="Exchange Rate",e.Header=s.d.GetResource("Currency_ExchangeRate"),this.CustomTab.Pages.push(e),this.CustomTab.SelectedTab=e,this.CustomTab.Pages[0].Fields.push(this.ViewExhangeRates),e=new g.O,e.Name="Denomination",e.Header=e.Header=s.d.GetResource("Denomination"),this.CustomTab.Pages.push(e);let a=new I.AddDenominationViewModel(this);this.CustomTab.Pages[1].Fields.push(a)}BuildGridData(){this._NumericColumnSource=[];let e=new h.O7;e.Header=s.d.GetResource("UOM_Sno"),e.DisplayMember="SNO",e.DataType="TextBlock",e.ReadOnly=!0,e.Width=50,e.IsFrozen=!0,this.NumericColumnSource.push(e),e=new h.O7,e.Header=s.d.GetResource("Currency_GridName"),e.DisplayMember="Name",null==this.CurrLookup?e.DataType="TextBlock":(e.ValueBinding="Name",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Name",e.ComboData=this.CurrLookup),e.Width=200,this.NumericColumnSource.push(e),e=new h.O7,e.Header=s.d.GetResource("Currency_GridSymbol"),e.DisplayMember="Symbol",e.DataType="TextBlock",e.ReadOnly=null!=this.CurrLookup,e.Width=80,e.IsFrozen=!0,this.NumericColumnSource.push(e),e=new h.O7,e.Header=s.d.GetResource("Currency_GridChange"),e.DisplayMember="Change",e.DataType="TextBlock",e.ReadOnly=null!=this.CurrLookup,e.Width=150,e.IsFrozen=!0,this.NumericColumnSource.push(e),e=new h.O7,e.Header=s.d.GetResource("Currency_GridExchangeRate"),e.DisplayMember="ExchangeRate",e.DataType="FLOAT",e.Width=100,e.IsFrozen=!0,this.NumericColumnSource.push(e),e=new h.O7,e.Header=s.d.GetResource("Currency_GridDecimals"),e.DisplayMember="Decimals",e.DataType="TextBlock",e.Width=100,e.IsFrozen=!0,this.NumericColumnSource.push(e),e=new h.O7,e.Header=s.d.GetResource("Reports_LblDaily"),e.ValueBinding="IsDailyRates",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100;let t=[];t.push(o._p.ComboBoxItems_2(s.d.GetResource("Vehicle_Yes"),"true")),t.push(o._p.ComboBoxItems_2(s.d.GetResource("Vehicle_No"),"false")),e.ComboData=t,this.NumericColumnSource.push(e),e=new h.O7,e.Header=s.d.GetResource("Document_Status"),e.ValueBinding="StatusID",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100;let a=[];a.push(o._p.ComboBoxItems_2(s.d.GetResource("RevenUReport_Active"),"true")),a.push(o._p.ComboBoxItems_2(s.d.GetResource("Attributes_Inactive"),"false")),e.ComboData=a,this.NumericColumnSource.push(e),e=new h.O7,e.Header="IsDivide",e.ValueBinding="IsDivide",e.DataType="ComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=100,a=[],a.push(o._p.ComboBoxItems_2("Yes","True")),a.push(o._p.ComboBoxItems_2("No","False")),e.ComboData=a,e.IsVisible=!(!s.d.SessionManager.Preferences.ContainsKey("DivideCurrency")||"true"!=s.d.SessionManager.Preferences.DivideCurrency.toLowerCase()),this.NumericColumnSource.push(e),this.DataTableObj.Table=[],this.DataTableObj.CanUserAddRows=!0,this.DataTableColumns.push("CurrencyID"),this.DataTableColumns.push("SNO"),this.DataTableColumns.push("Name"),this.DataTableColumns.push("Symbol"),this.DataTableColumns.push("Change"),this.DataTableColumns.push("ExchangeRate"),this.DataTableObj.DataTypes.Double.push("ExchangeRate"),this.DataTableColumns.push("Decimals"),this.DataTableColumns.push("IsDailyRates"),this.DataTableColumns.push("StatusID"),this.DataTableColumns.push("GUID"),this.DataTableColumns.push("IsDivide"),this.DataTableObj.Columns=this.NumericColumnSource,this.DataTableObj.ContextMenuClickSubject.subscribe(r=>{this.OnCmnItem_Click(r.item.Tag)}),this.DataTableObj.ContextMenu.Items=[];let i=new h.Dr;i.Header="DELETE",i.Tag="DELETE",i.Visibility=!0,this.DataTableObj.ContextMenu.Items.push(i)}onAddRow(e,t){this.UpdateSequence()}onDeleteRow(e,t){this.UpdateSequence()}UpdateSequence(){this.SNO=1,this.DataTableObj.Table.forEach(e=>{e.SNO=this.SNO++})}GetCurrencyXMl(){let e="";if(null!=this.DataTable&&this.DataTable.length>0){e+="<XML>";for(let t=0;t<this.DataTable.length;t++)!n.J0.IsEmpty(this.DataTable[t].Name)&&!n.J0.IsEmpty(this.DataTable[t].ExchangeRate)&&(n.J0.IsEmpty(this.DataTable[t][this.DataTableColumns[0]])?e+="<Row CurrencyID='0' Name='"+this.DataTable[t][this.DataTableColumns[2]].toString()+"' Symbol='"+this.DataTable[t][this.DataTableColumns[3]].toString()+"' Change='"+this.DataTable[t][this.DataTableColumns[4]].toString()+"' ExchangeRate='"+this.DataTable[t][this.DataTableColumns[5]].toString()+"' Decimals='"+this.DataTable[t][this.DataTableColumns[6]].toString()+"' Daily='"+this.DataTable[t][this.DataTableColumns[7]].toString()+"'  StatusID='"+this.DataTable[t][this.DataTableColumns[8]].toString()+"' IsDivide='"+this.DataTable[t].IsDivide.toString()+"' GUID='"+this.DataTable[t].GUID.toString()+"' Action='Insert'/>":parseInt(this.DataTable[t][this.DataTableColumns[0]])>0?parseInt(this.DataTable[t][this.DataTableColumns[0]])==this.BaseCurr?(e+="<Row CurrencyID='"+this.DataTable[t][this.DataTableColumns[0]].toString()+"' Name='"+this.DataTable[t][this.DataTableColumns[2]].toString()+"' Symbol='"+this.DataTable[t][this.DataTableColumns[3]].toString()+"' Change='"+this.DataTable[t][this.DataTableColumns[4]].toString()+"' ExchangeRate='"+this.DataTable[t][this.DataTableColumns[5]].toString()+"' Decimals='"+this.DataTable[t][this.DataTableColumns[6]].toString()+"' Daily='"+this.DataTable[t][this.DataTableColumns[7]].toString()+"'  StatusID='"+this.DataTable[t][this.DataTableColumns[8]].toString()+"' IsDivide='"+this.DataTable[t].IsDivide.toString()+"'  GUID='"+this.DataTable[t].GUID.toString()+"'   Action='Update'/>",e+="<Row CurrencyID='"+this._CurrencyID+"' Name='"+this.CurrencyName+"' Symbol='"+Symbol+"' Change='"+this.Change+"' ExchangeRate='1'   Action='Update'/>"):e+="<Row CurrencyID='"+this.DataTable[t][this.DataTableColumns[0]].toString()+"' Name='"+this.DataTable[t][this.DataTableColumns[2]].toString()+"' Symbol='"+this.DataTable[t][this.DataTableColumns[3]].toString()+"' Change='"+this.DataTable[t][this.DataTableColumns[4]].toString()+"' ExchangeRate='"+this.DataTable[t][this.DataTableColumns[5]].toString()+"' Decimals='"+this.DataTable[t][this.DataTableColumns[6]].toString()+"' Daily='"+this.DataTable[t][this.DataTableColumns[7]].toString()+"'  StatusID='"+this.DataTable[t][this.DataTableColumns[8]].toString()+"'  IsDivide='"+this.DataTable[t].IsDivide.toString()+"' GUID='"+this.DataTable[t].GUID.toString()+"'   Action='Update'/>":parseInt(this.DataTable[t][0])<=0&&(e+="<Row CurrencyID='0' Name='"+this.DataTable[t][this.DataTableColumns[2]].toString()+"' Symbol='"+this.DataTable[t][this.DataTableColumns[3]].toString()+"' Change='"+this.DataTable[t][this.DataTableColumns[4]].toString()+"' ExchangeRate='"+this.DataTable[t][this.DataTableColumns[5]].toString()+"' Decimals='"+this.DataTable[t][this.DataTableColumns[6]].toString()+"' Daily='"+this.DataTable[t][this.DataTableColumns[7]].toString()+"'  StatusID='"+this.DataTable[t][this.DataTableColumns[8]].toString()+"' IsDivide='"+this.DataTable[t].IsDivide.toString()+"' GUID='"+this.DataTable[t].GUID.toString()+"' Action='Insert'/>"));this.BaseCurr==this._CurrencyID&&(e+="<Row CurrencyID='"+this._CurrencyID+"' Name='"+this.CurrencyName+"' Symbol='"+this.Symbol+"' Change='"+this.Change+"' ExchangeRate='1'  GUID='"+this._GUID+"'   Action='Update'/>")}else e+="<XML>";for(let t=0;t<this.lstDeletedRecords.length;t++)e+='<Row Action="Delete"',e+=' CurrencyID="'+this.lstDeletedRecords[t].iSeqno+'"/>';return e+="</XML>",e=e.Replace("&","&amp;"),e.toString()}BindCurrencies(e){let t=[];t.push(0),t.push(e),t.push(s.d.SessionManager.UserID),t.push(s.d.SessionManager.LanguageID);let a=s.d.admin.GetCurrencies(t);if(null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&(this._CurrencyID=parseInt(a.Tables[0][0].CurrencyID),this.BaseCurr=this._CurrencyID,this.CurrencyName=a.Tables[0][0].Name.toString(),this.Symbol=n.J0.String(a.Tables[0][0].Symbol),this.Change=n.J0.String(a.Tables[0][0].Change),this._GUID=n.J0.String(a.Tables[0][0].GUID)),null!=a&&a.Tables.length>1){this.DataTableObj.Clear();for(let i=0;i<a.Tables[1].length;i++){let r=this.DataTableObj.NewRow();for(let c=0;c<a.Columns[1].length;c++){const b=a.Columns[1][c];r[b]=n.J0.String(a.Tables[1][i][b])}this.DataTableObj.addRow(r)}}if(a.Tables.length>2&&(this.ExTable=a.Tables[2]),a.Tables.length>3&&!a.Columns[3].Contains("NoDimCurrency")&&a.Tables[3].length>0){if(this.Dim.Label=a.Tables[3][0].Name.toString(),this.Dim.SelectedValue=e,""!=a.Tables[3][0].CurrencyID.toString()&&parseInt(a.Tables[3][0].CurrencyID.toString())!=this.BaseCurr){let i=this.DataTable.filter(r=>r.CurrencyID==a.Tables[3][0].CurrencyID.toString());i.length>0&&(this._CurrencyID=parseInt(i[0].CurrencyID.toString()),this.CurrencyName=i[0].Name.toString(),Symbol=i[0].Symbol.toString(),this.Change=i[0].Change.toString(),i[0].CurrencyID=this.BaseCurr,i[0].Change=a.Tables[0][0].Change.toString(),i[0].Name=a.Tables[0][0].Name.toString(),i[0].Symbol=a.Tables[0][0].Symbol.toString())}for(let i=0;i<this.DataTable.length;i++){let r=a.Tables[2].filter(c=>0==c.ED&&c.CurrencyID==this.DataTable[i].CurrencyID.toString());this.DataTable[i].ExchangeRate=r.length>0?r[0].ExchangeRate.toString():0,this.DataTableObj.updateRow(this.DataTable)}}this.AddCurrencyDetails(),this.ViewExhangeRates.LoadExchRates(this.ExTable),this.DataTableObj.addEmptyRow(),this.DataTable[a.Tables[1].length-1].SNO=a.Tables[1].length,n.J0.IsEmpty(this.selectedCurrencyID)||(this.ViewExhangeRates.ExchListDataTable.Table=this.ViewExhangeRates.TempExchListDataTable.filter(i=>i.SelectedCurrencyType==this.selectedCurrencyID&&i.Text>=this.ViewExhangeRates.FromDate.Date&&i.Text<=this.ViewExhangeRates.Todate.Date))}Validate(){if(this.Dim.Visible&&0==this.Dim.SelectedValue)return this.DisplayMessage=" select "+this.Dim.Label,this.MessageVisibility=!0,!1;if(null==this.CurrencyName.Trim()||""==this.CurrencyName.Trim())return this.DisplayMessage=" Please Enter Base Currency",this.MessageVisibility=!0,!1;if(null==this.Symbol.Trim()||""==this.Symbol.Trim())return this.DisplayMessage=" Please Enter Base Symbol",this.MessageVisibility=!0,!1;if(null==this.Change.Trim()||""==this.Change.Trim())return this.DisplayMessage=" Please Enter Base Currency Change",this.MessageVisibility=!0,!1;for(let e=0;e<this.DataTable.length;e++)if(!n.J0.IsEmpty(this.DataTable[e].Name)||!n.J0.IsEmpty(this.DataTable[e].Symbol)||!n.J0.IsEmpty(this.DataTable[e].ExchangeRate)){if(n.J0.IsEmpty(this.DataTable[e].Name))return this.DisplayMessage=s.d.GetResource("Curr_Name")+(e+1).toString(),this.MessageVisibility=!0,!1;if(n.J0.IsEmpty(this.DataTable[e].Symbol))return this.DisplayMessage=s.d.GetResource("Curr_Symbol")+(e+1).toString(),this.MessageVisibility=!0,!1;if(n.J0.IsEmpty(this.DataTable[e].Change))return this.DisplayMessage=s.d.GetResource("Curr_Change")+(e+1).toString(),this.MessageVisibility=!0,!1;if(n.J0.IsEmpty(this.DataTable[e].ExchangeRate)||parseFloat(this.DataTable[e].ExchangeRate)<=0)return this.DisplayMessage=s.d.GetResource("Curr_Exch")+(e+1).toString(),this.MessageVisibility=!0,!1;if(n.J0.IsEmpty(this.DataTable[e].Decimals)||parseFloat(this.DataTable[e].Decimals)<=0)return this.DisplayMessage=s.d.GetResource("Curr_Decimals")+(e+1).toString(),this.MessageVisibility=!0,!1}return!0}OnSaveCurrency(e){this.MessageVisibility=!1,Logger.InfoLog("AddCurrencyViewModel::Entering OnSaveCurrency");try{if(this.Validate()){let t=[];if(this.BaseCurr!=this._CurrencyID){t.push(this.BaseCurr);let c=this.DataTable.filter(b=>b.CurrencyID==this.BaseCurr.toString());if(!(c.length>0))return this.DisplayMessage="Base currency deleted.please refresh data",void(this.MessageVisibility=!0);t.push(c[0].Name.toString()),t.push(c[0].Symbol.toString()),t.push(c[0].Change.toString())}else t.push(this._CurrencyID),t.push(this.CurrencyName),t.push(this.Symbol),t.push(this.Change);t.push(this.GetCurrencyXMl()),t.push(this.ViewExhangeRates.GetXML()),t.push(this.Dim.Visible?this.Dim.SelectedValue:1),t.push(s.d.SessionManager.CompanyGUID),t.push(this._GUID),t.push(s.d.SessionManager.UserName),t.push(s.d.SessionManager.RoleID),t.push(s.d.SessionManager.LanguageID);let a,i=s.d.admin.SetCurrencies(t);this.MessageVisibility=!0,a=i.Message;let r=i.ret;this.DisplayMessage=a,r>0&&this.BindCurrencies(this.Dim.Visible?this.Dim.SelectedValue:1),Logger.InfoLog("AddCurrencyViewModel::Entering OnSaveCurrency")}}catch(t){Logger.ErrorLog("AddCurrencyViewModel:: OnSaveCurrency"+t.stack)}}onCanSaveCurrency(e){return!0}UpdateUIIndicators(e){this.PACTControlData=e,this.DisplayName="Currency"}CallBackBuildControls(e){}worker_DoWork(e,t){Logger.InfoLog("AddCurrencyViewModel::Entering worker_DoWork"),this._ScreenData=this.BuildControls(),Logger.InfoLog("AddCurrencyViewModel::BuildControls Success"),this.CurrencyNameEnabled=!0,this.SymbolEnabled=!0,this.ChangeEnabled=!0,this.ApplyResources(this._ScreenData.Tables[0]),this.CurrencyCombo.Visible=!1;for(let a=0;a<this._ScreenData.Tables.length;a++)if(this._ScreenData.Columns[a].Contains("CurrLookupID")){this.CurrLookup=this._ScreenData.Tables[a],this.CurrencyCombo.Visible=!0,this.CurrencyCombo.Label=s.d.GetResource("Currency_BaseCurrency"),this.CurrLookup.forEach(i=>{this.CurrencyCombo.Items.push(o._p.ComboBoxItems_2(i.Name,i.Name))});break}}worker_RunWorkerCompleted(e,t){this.DisplayName=s.d.GetResource("Currency_ScreenName")}BuildControls(){Logger.InfoLog("AddCurrencyViewModel::Entering BuildControls");try{return(new R.ControlGenerator).GetControls(this._ScreenID,s.d.SessionManager.CompanyIndex)}catch(e){return Logger.ErrorLog("AddCurrencyViewModel:: BuildControls"+e.stack),null}}ApplyFieldSecurity(e){Logger.InfoLog("AddCurrencyViewModel::Entering ApplyFieldSecurity");let t=e;t=t.filter(a=>172==a.ColID),this.CurrencyNameEnabled=t.length>0,t=t.filter(a=>173==a.ColID),this.SymbolEnabled=t.length>0,t=t.filer(a=>174==a.ColID),this.ChangeEnabled=t.length>0,Logger.InfoLog("AddCurrencyViewModel::Exiting ApplyFieldSecurity")}ApplyResources(e){Logger.InfoLog("AddCurrencyViewModel::Entering ApplyResources");let t=e;t=t.filter(a=>172==a.CostCenterColID),this.lblCurrencyName=t.length>0?t[0].ResourceData.toString():"",t=t.filter(a=>173==a.CostCenterColID),this.lblSymbol=t.length>0?t[0].ResourceData.toString():"",t.RowFilter="CostCenterColID=174",this.lblChange=t.length>0?t[0].ResourceData.toString():"",Logger.InfoLog("AddCurrencyViewModel::Exiting ApplyResources")}OnShowExchangeRate(){this.AddCurrencyDetails()}OnAddExchangeRate(){this.Exch=new d(this),this.AddCurrencyDetails()}OnDeleteCallBack(){let e=0;for(let t=0;t<this.DataTable.length;t++)if(e=parseInt(this.DataTable[t].SNO),this.SelectedNode==e-1&&!n.J0.IsEmpty(this.DataTable[t][0])){this.lstDeletedRecords.push(new x(parseInt(this.DataTable[t][0])));break}this.SelectedNode<this.DataTable.length&&this.DataTableObj.Table.RemoveAt(this.SelectedNode),this.UpdateSequence()}}}}]);