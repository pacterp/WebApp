"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[5862],{23481:(M,U,s)=>{s.r(U),s.d(U,{QuickAddUnitViewModel:()=>C});var a=s(32040),h=s(43767),S=s(54581),_=s(98580),r=s(84151),d=s(27730),c=s(23458),p=s(58941),T=s(85985),E=s(21943),O=s(34587),I=s(58170),f=s(13054),u=s(82503),m=s(41264),b=s(41820);class C extends _.g{constructor(t,n,l,o,g){if(super(),this.Unitsmodel={},this.UnitID=0,this.parentid=0,this.selectedNode=0,this.group=!1,this.DetailButtonVisibility=!0,this.UnitCode=new r.Dw(25624),this.UnitType=new r.Dw(25625),this.Status=new d.y$(25626),this.Property=new c.y$(25623),this.Group=new c.y$(25721),this.RetValue=0,this.lstEventCtrls=[],this.ScreenObject=new T.ControlGenerator,this.ScreenObject.LoadScreen_1(this,93,o),null!=this.ScreenObject.QuickAddFields&&(this.ScreenObject.QuickAddFields=this.ScreenObject.QuickAddFields.filter(e=>e instanceof I.MI&&e.Visible).sort((e,D)=>e.Row-D.Row)),this.UnitID=n,this.parent=t,this.parentid=l,this.Group.CCID=93,this.Group.TypeID=1,this.Property.CCID=92,this.Property.TypeID=2,this.selectedNode=g,this.group=o,null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>0&&this.ScreenObject.Data.Tables[0].length>0){let e=this.ScreenObject.Data.Tables[0].filter(D=>54205==D.CostCenterColID);e.length>0&&(this.Unitsmodel.BasedOn=h.J0.String(e[0].UserDefaultValue))}if(0==this.group?this.Title=a.d.GetResource(0==this.UnitID?"REN_UnitsAdd":"REN_UnitsEdit"):(this.Title=a.d.GetResource("CRMLead_AddGroup"),this.DetailButtonVisibility=!1,this.Unitsmodel.GUID="GUID"),this.Unitsmodel.UnitID=this.UnitID,this.ButtonSave=new p.v,0==this.UnitID)this.Group.SelectedValue=l,this.AutoGenerateCode(),this.Unitsmodel.GUID="GUID";else{let e=a.d.rental.GetUnitDetails(this.UnitID);e.Tables.length>0&&e.Tables[0].length>0&&(this.Unitsmodel.GUID=e.Tables[0][0].GUID.toString(),this.UnitCode.Text=e.Tables[0][0].Code.toString(),this.UnitType.Text=e.Tables[0][0].Name.toString(),this.Status.SelectedValue=e.Tables[0][0].Status.toString(),this.Group.SelectedValue=parseInt(e.Tables[0][0].ParentID),this.Property.SelectedValue=parseInt(e.Tables[0][0].PropertyID),this.ScreenObject.CanApprove(e.Tables[0][0],e.Tables[8][0],this.ButtonSave))}let i;this.MessageVisibility=!1,null!=this.Property&&this.lstEventCtrls.push(this.Property.DBColumnID);for(let e=0;e<this.ScreenObject.StaticFields.length;e++)i=this.ScreenObject.StaticFields[e],i&&null!=i.ToolTipFooterTitle&&null!=i.KeyTip&&!this.lstEventCtrls.Contains(i.DBColumnID)?this.SetControlEvent(i):this.UnitID>0&&i&&null!=i.ToolTipFooterTitle&&null!=i.KeyTip&&19==i.Mode&&this.OnGetExtFunctionData(i);if(null!=this.ScreenObject.HeaderFields)for(let e=0;e<this.ScreenObject.HeaderFields.length;e++)i=this.ScreenObject.HeaderFields[e],i&&null!=i.ToolTipFooterTitle&&null!=i.KeyTip&&!this.lstEventCtrls.Contains(i.DBColumnID)?this.SetControlEvent(i):this.UnitID>0&&i&&null!=i.ToolTipFooterTitle&&null!=i.KeyTip&&19==i.Mode&&this.OnGetExtFunctionData(i)}SetControlEvent(t){try{t instanceof r.Dw?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof d.y$?t.SelectionChangedCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof f.I||t instanceof r.L6?t.LostFocusCommand.Subscribe(this,"OnGetExtFunctionData"):t instanceof c.y$?t.OnPactListBoxValueChanged.Subscribe(this,"OnGetExtFunctionData"):(t instanceof u.Lc||t instanceof u.P6||t instanceof u.C_)&&t.SelectedDateChanged.Subscribe(this,"OnGetExtFunctionData"),this.UnitID>0&&19==t.Mode&&this.OnGetExtFunctionData(t)}catch{}}OnGetExtFunctionData(t){null!=t.ToolTipFooterTitle&&!h.J0.IsEmpty(t.KeyTip)&&"lostfocus"==t.KeyTip.toLowerCase()&&this.ScreenObject.ValidateExtData(t,null,!0)&&this.ScreenObject.GetExternalFuncData(t.Mode,this.UnitID,t.ToolTipFooterTitle,t.ToolTipFooterDescription,t.ToolTipDescription,null,null)}AutoGenerateCode(){let t=a.d.common.GetAutoSequence(93,"","93",a.d.SessionManager.CompanyIndex.toString());if(null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>4){let n=this.ScreenObject.Data.Tables[4].filter(l=>"CodeAutoGen"==l.Name);n.length>0&&((0,S.yG0)(n[0].Value)?(this.UnitCode.Enable=!1,this.UnitCode.Mandatory=!1,0==this.Unitsmodel.UnitID&&(this.UnitCode.Text=t)):this.UnitCode.Enable=!0)}null!=this.ScreenObject.Data&&this.ScreenObject.Data.Tables.length>3&&(this.Status.Items.Clear(),this.ScreenObject.Data.Tables[3].forEach(n=>{this.Status.Items.push(d._p.ComboBoxItems_2(n.Status.toString(),n.StatusID.toString()))}),this.Status.SelectedValue="424")}OnSave(t){if("Cancel"==t)this.parent.DetailsVisibility=!0,a.d.page.HideDialog(this.PopUpGUID);else if("Save"==t){Logger.InfoLog("SaveUnitViewModel:: OnSave");try{let l=this.ScreenObject.ValidateData();if(!h.J0.IsEmpty(l))return this.DisplayMessage=l,void(this.MessageVisibility=!0);this.Unitsmodel.Code=this.UnitCode.Text,this.Unitsmodel.StatusID=h.J0.IsEmpty(this.Status.SelectedValue)?0:parseInt(this.Status.SelectedValue),this.Unitsmodel.Name=this.UnitType.Text,this.Unitsmodel.IsGroup=this.group,this.Unitsmodel.Property=0!=this.Property.SelectedValue?this.Property.SelectedValue:0,this.Unitsmodel.SelectedNodeID=this.selectedNode,this.Unitsmodel.WID=this.ScreenObject.CheckWorkFlow(),0==this.Unitsmodel.UnitID?a.d.rental.SaveUnits(this.Unitsmodel,"SaveUnits").subscribe(o=>{this.DisplayMessage=o.Message,this.MessageVisibility=!0,this.RetValue=o.RetValue,this.RetValue>0&&(this.UnitCode.Text="",this.Status.SelectedValue="424",this.UnitID=0,this.UnitType.Text="",this.Unitsmodel.UnitID=0,null!=this.parent&&this.parent.Refresh(),this.AutoGenerateCode(),this.Group.SelectedValue=this.selectedNode)},o=>{console.log(" Unit Save : "+JSON.stringify(o))}):a.d.rental.SaveUnits(this.Unitsmodel,"QuickUpdateUnit").subscribe(o=>{this.DisplayMessage=o.Message,this.MessageVisibility=!0,this.RetValue=o.RetValue,this.RetValue>0&&(this.UnitCode.Text="",this.Status.SelectedValue="424",this.UnitID=0,this.UnitType.Text="",this.Unitsmodel.UnitID=0,null!=this.parent&&this.parent.Refresh(),this.AutoGenerateCode(),this.Group.SelectedValue=this.selectedNode)},o=>{console.log(" Quick Unit Save : "+JSON.stringify(o))}),Logger.InfoLog("SaveUnitViewModel:: OnSave")}catch(n){Logger.ErrorLog("SaveUnitViewModel:: OnSave"+n.stack)}}else if("Details"==t.toString()){a.d.page.HideDialog(this.PopUpGUID);let n=new E.AddEditUnitsViewModel(this.UnitID,this.group,this.parentid,this.selectedNode);a.d.page.addNewTab({title:n.Title,component:O.AddEditUnitsComponent,params:{obj:n}})}else if("ApproveMaster"==t.toString()){let n=new m.i(93,this.Unitsmodel.UnitID,this.ScreenObject,this);a.d.page.ShowDialog(n,b.R,{ShowCenter:!0,Title:a.d.GetResource("ApproveReject")})}}}}}]);