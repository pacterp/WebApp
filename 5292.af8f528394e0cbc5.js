"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[5292],{82911:(Pe,N,f)=>{f.r(N),f.d(N,{PostedDocumentViewModel:()=>ye});var V=f(74523),a=f(9659),r=f(66148),T=f(76962),W=f(76199),L=f(35789),x=f(4884),p=f(5349),_=f(89211),M=f(9503),B=f(1077),X=f(89710),R=f(43024),$=f(94628),U=f(92264),Y=f(11403),z=f(84480);class v extends Y.d{get TreeVisibility(){return!(!a.d.SessionManager.Preferences.ContainsKey("PDCTreeFilter")||"True"!=a.d.SessionManager.Preferences.PDCTreeFilter)}get ClearSelectedNodes(){return this._ClearSelectedNodes}set ClearSelectedNodes(h){this._ClearSelectedNodes=h,this.tree.length>0&&(this.tree[0].ClearAllSelectedNodes=!this.tree[0].ClearAllSelectedNodes)}get PostConversionDate(){return this._PostConversionDate}constructor(){super(),this.LocationCheckedChanged=new L.Yk,this.ButtonClick=new L.Yk,this.IsQuit=!0,this.IsOK=!1,this.FromDate=new x.Lc(0),this._ClearSelectedNodes=!1,this.Documents=new p.y$(0),this.ToDate=new x.Lc(0),this.DateRanges=new p.y$(0),this.Location=new p.v4,this.Division=new p.v4,this.DimensionWise=new p.v4,this.Dimension=0,this._PostConversionDate=new _.c(0),this.IsPDC=!0,this.BankAccounts=new B.y$(0),this.LockCheckedChanged=!1}PostedDocumentDialogViewModel(h){this.IsPDC=!1,this.Title="Trust Reciept",this.Trparent=h,this.Load(),this.TreeVisibility&&(this.CostCenters.Label=a.d.GetResource("Reports_SelectCostCenter"))}PostedDocumentDialogViewModel_1(h){this.parent=h,this.Title=a.d.GetResource("DocumentDesigner_PostedDocument"),this.Load(),this.TreeVisibility&&(this.CostCenters.Label=a.d.GetResource("Reports_SelectCostCenter"))}Load(){if(this.BankAccounts.Label=a.d.GetResource("Reports_BankName"),this.FromDate.Label=a.d.GetResource("DocumentDesigner_FromDate"),this.ToDate.Label=a.d.GetResource("DocumentDesigner_ToDate"),this.FromDate.Date=a.d.SessionManager.ReportsFromDate,this.DateRanges=R.w.getDateRanges(),this.DateRanges.SelectionChangedCommand.Subscribe(this,"OnDateRangesSelectionChanged"),this.PostConversionDate.Label=a.d.GetResource("PostonConversionDate"),this.ButtonClick.Subscribe(this,"OnButtonClick"),this.LocationCheckedChanged.Subscribe(this,"OnLocationCheckedChanged"),this.Location=new p.v4,this.Location.CheckedChangedCommand.Subscribe(this,"OnLocationCheckedChanged"),this.Location.Items.push(p.oN.CheckedListBoxItem_6("All","All",!1,50002)),this.Location.Visible="True"==a.d.SessionManager.Preferences.EnableLocationWise.toString(),this.tree=[],this.CostCenterFilters=[],this.CostCenters=new p.y$(0),this.CostCenters.SelectionChangedCommand.Subscribe(this,"OnCostCenterChange"),this.Division=new p.v4,this.Division.CheckedChangedCommand.Subscribe(this,"OnLocationCheckedChanged"),this.Division.Items.push(p.oN.CheckedListBoxItem_6("All","All",!1,50001)),this.Division.Visible="True"==a.d.SessionManager.Preferences.EnableDivisionWise.toString(),a.d.SessionManager.Preferences.ContainsKey("PDCFilterDimension")&&null!=a.d.SessionManager.Preferences.PDCFilterDimension&&""!=a.d.SessionManager.Preferences.PDCFilterDimension.toString()&&"0"!=a.d.SessionManager.Preferences.PDCFilterDimension.toString()&&(this.Dimension=parseInt(a.d.SessionManager.Preferences.PDCFilterDimension.toString())),this.DimensionWise=new p.v4,this.DimensionWise.CheckedChangedCommand.Subscribe(this,"OnLocationCheckedChanged"),this.DimensionWise.Items.push(p.oN.CheckedListBoxItem_6("All","All",!1,this.Dimension)),this.DimensionWise.Visible=this.Dimension>5e4&&!this.TreeVisibility,this.IsPDC){let h,s,i;this.PostConversionDate.Visible=a.d.SessionManager.IsActionAssigned(4e4,"Post on Conversion Date"),this.Documents.Label=a.d.GetResource("lblPDCDocument"),a.d.SessionManager.Preferences.ContainsKey("IntermediatePDCAccListview")&&null!=a.d.SessionManager.Preferences.IntermediatePDCAccListview&&""!=a.d.SessionManager.Preferences.IntermediatePDCAccListview.toString()&&"0"!=a.d.SessionManager.Preferences.IntermediatePDCAccListview.toString()?(this.BankAccounts.CCID=2,this.BankAccounts.TypeID=parseInt(a.d.SessionManager.Preferences.IntermediatePDCAccListview.toString()),this.BankAccounts.Refresh()):(this.BankAccounts.CCID=2,this.BankAccounts.TypeID=2,this.BankAccounts.Refresh()),null!=this.parent&&null!=this.parent.ForeignCurrency?this.ForeignCurrency=this.parent.ForeignCurrency:(this.ForeignCurrency=new X.NY,a.d.common.GetDataSet("PDDVM01","").Tables[0].forEach(n=>{this.ForeignCurrency.ComboBox.Items.push(p._p.ComboBoxItems_2(n.Name.toString(),n.CurrencyID.toString()))}),this.ForeignCurrency.ComboBox.Items.length>0&&(this.ForeignCurrency.ComboBox.SelectedValue=this.ForeignCurrency.ComboBox.Items[0].Value)),this.ForeignCurrency.CheckBox.width=40,this.Filter=new M.Q("Documents"),h=new M.u("All",0,"Filter"),h.Group=this.Filter,null!=parent&&0==this.parent.Filter&&(h.IsChecked=!0),h.Label=a.d.GetResource("ComLanguageAll"),this.Filter.Items.push(h),h=new M.u("PDR",1,"Filter"),h.Group=this.Filter,null!=parent&&1==this.parent.Filter&&(h.IsChecked=!0),h.Label=a.d.GetResource("PDR"),this.Filter.Items.push(h),h=new M.u("PDP",2,"Filter"),h.Group=this.Filter,null!=parent&&2==this.parent.Filter&&(h.IsChecked=!0),h.Label=a.d.GetResource("PDP"),this.Filter.Items.push(h),this.Stat=new p.y$(0),this.Stat.Label=a.d.GetResource("lblPDCStatus"),this.Stat.Items.push(p._p.ComboBoxItems_2(a.d.GetResource("ComLanguageAll"),"0")),this.Stat.Items.push(p._p.ComboBoxItems_2(a.d.GetResource("PDC"),"370")),this.Stat.Items.push(p._p.ComboBoxItems_2(a.d.GetResource("PDC_Posted"),"369")),this.Stat.Items.push(p._p.ComboBoxItems_2(a.d.GetResource("DocumentDesigner_Bounced"),"429")),this.Stat.Items.push(p._p.ComboBoxItems_2("Discounted","439")),this.Stat.Items.push(p._p.ComboBoxItems_2("Cancelled","376")),a.d.SessionManager.IsActionAssigned(4e4,"Replace")&&(this.Stat.Items.push(p._p.ComboBoxItems_2(a.d.GetResource("Replace"),"1")),this.Stat.Items.push(p._p.ComboBoxItems_2(a.d.GetResource("ReplacePartial"),"2"))),a.d.SessionManager.Preferences.ContainsKey("PDCHoldDimension")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences.PDCHoldDimension)&&a.d.SessionManager.Preferences.PDCHoldDimension.length>1&&a.d.common.GetDataSet("PDDVM02",a.d.SessionManager.Preferences.PDCHoldDimension).Tables[0].forEach(n=>this.Stat.Items.push(p._p.ComboBoxItems_2(n.Name.toString(),"HOLD_"+n.NodeID.toString()))),this.Stat.SelectedValue=this.parent.Status,this.FilterON=new M.Q(a.d.GetResource("Reports_LblFilterOn")),s=new M.u("Doc Date",0,"FilterON"),s.Group=this.FilterON,null!=parent&&0==this.parent.Filter&&(s.IsChecked=!0),s.Label=a.d.GetResource("Doc_Date"),this.FilterON.Items.push(s),s=new M.u("Maturity Date",1,"FilterON"),s.Group=this.FilterON,null!=this.parent&&1==this.parent.Filter&&(s.IsChecked=!0),s.Label=a.d.GetResource("Maturity_Date"),this.FilterON.Items.push(s),this.SortON=new M.Q(a.d.GetResource("Reports_LblSortOn")),i=new M.u("Doc Date",0,"SortON"),i.Group=this.SortON,null!=parent&&0==this.parent.Filter&&(i.IsChecked=!0),i.Label=a.d.GetResource("Doc_Date"),this.SortON.Items.push(i),i=new M.u("Maturity Date",1,"SortON"),i.Group=this.SortON,null!=parent&&1==this.parent.Filter&&(i.IsChecked=!0),i.Label=a.d.GetResource("Maturity_Date"),this.SortON.Items.push(i),this.Documents.Items.push(p._p.ComboBoxItems_2("",""));let e=a.d.admin.GetPDCDocs();if(null!=e&&e.Tables.length>0){for(let t=0;t<e.Tables[0].length;t++)this.Documents.Items.push(p._p.ComboBoxItems_2(e.Tables[0][t][e.Columns[0][0]].toString(),e.Tables[0][t][e.Columns[0][1]].toString()));if(this.TreeVisibility&&e.Tables.length>1)for(let t=0;t<e.Tables[1].length;t++)this.CostCenters.Items.push(p._p.ComboBoxItems_2(e.Tables[1][t][e.Columns[1][0]].toString(),e.Tables[1][t][e.Columns[1][1]].toString()))}if(this.Documents.SelectedValue=this.parent.DocumentPicked,null!=this.parent){if(this.Location.Visible){let t=a.d.admin.getLocationRoles(["50002",a.d.SessionManager.LangID]),n=a.d.SessionManager.LocationWhere.split(","),D=r.J0.IsEmpty(this.parent.Locations)?[{LocationID:a.d.SessionManager.LocationID.toString()}]:this.parent.Locations.split(",");if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)for(let d=0;d<t.Tables[0].length;d++)(0,T.yG0)(t.Tables[0][d].IsGroup.toString())||n.Contains(t.Tables[0][d][t.Columns[0][0]].toString())&&(D.Contains(t.Tables[0][d][t.Columns[0][0]].toString())?this.Location.Items.push(p.oN.CheckedListBoxItem_6(t.Tables[0][d][t.Columns[0][2]].toString(),t.Tables[0][d][t.Columns[0][0]].toString(),!0,50002)):this.Location.Items.push(p.oN.CheckedListBoxItem_6(t.Tables[0][d][t.Columns[0][2]].toString(),t.Tables[0][d][t.Columns[0][0]].toString(),!1,50002)))}if(this.Division.Visible){let t=a.d.admin.getLocationRoles([50001,a.d.SessionManager.LangID]),n=this.Location.Visible?a.d.SessionManager.DivisionWhere.split(","):a.d.SessionManager.LocationWhere.split(","),D=r.J0.IsEmpty(this.parent.Divisions)?this.Location.Visible?a.d.SessionManager.DivisionID.toString():a.d.SessionManager.LocationID.toString():this.parent.Divisions.split(",");if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0)for(let d=0;d<t.Tables[0].length;d++)(0,T.yG0)(t.Tables[0][d].IsGroup.toString())||n.Contains(t.Tables[0][d][t.Columns[0][0]].toString())&&(D.Contains(t.Tables[0][d][t.Columns[0][0]].toString())?this.Division.Items.push(p.oN.CheckedListBoxItem_6(t.Tables[0][d][t.Columns[0][2]].toString(),t.Tables[0][d][t.Columns[0][0]].toString(),!0,50001)):this.Division.Items.push(p.oN.CheckedListBoxItem_6(t.Tables[0][d][t.Columns[0][2]].toString(),t.Tables[0][d][t.Columns[0][0]].toString(),!1,50001)))}if(this.DimensionWise.Visible){let t=!1;t="1"!=a.d.SessionManager.UserID&&a.d.SessionManager.Preferences.ContainsKey("Dimension List")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences["Dimension List"])&&a.d.SessionManager.Preferences["Dimension List"].toString().Contains(this.Dimension.toString());let n=a.d.SessionManager.Preferences.ContainsKey("Dimension List")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences["Dimension List"])&&a.d.SessionManager.Preferences["Dimension List"].toString().Contains(this.Dimension.toString()),D=a.d.SessionManager.Preferences.ContainsKey("RoleDimension List")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences["RoleDimension List"])&&a.d.SessionManager.Preferences["RoleDimension List"].toString().Contains(this.Dimension.toString()),d=a.d.common.GetDataSet3("PDDVM03",this.Dimension.toString(),n+"~"+D,a.d.SessionManager.UserID+","+a.d.SessionManager.LanguageID),C=this.parent.Dimensions.split(",");if(null!=d&&d.Tables.length>0&&d.Tables[0].length>0){for(let c=0;c<d.Tables[0].length;c++)(0,T.yG0)(d.Tables[0][c].IsGroup.toString())||(C.Contains(d.Tables[0][c][d.Columns[0][0]].toString())?this.DimensionWise.Items.push(p.oN.CheckedListBoxItem_6(d.Tables[0][c].Name.toString(),d.Tables[0][c].NodeID.toString(),!0,this.Dimension)):this.DimensionWise.Items.push(p.oN.CheckedListBoxItem_6(d.Tables[0][c].Name.toString(),d.Tables[0][c].NodeID.toString(),!1,this.Dimension)));this.DimensionWise.Label=d.Tables.length>1&&d.Tables[1].length>0?d.Tables[1][0][d.Columns[1][0]].toString():"Dimension"}}this.ToDate.Date=this.parent.ToDate,this.BankAccounts.SelectedValue=this.parent.BankID,this.PostConversionDate.IsChecked=this.parent.PostonconversionDate}if(a.d.SessionManager.Preferences.ContainsKey("DefaultPostConversionDate")&&""!=a.d.SessionManager.Preferences.DefaultPostConversionDate&&(this.PostConversionDate.IsChecked=(0,T.yG0)(a.d.SessionManager.Preferences.DefaultPostConversionDate)),null!=this.parent){let t=a.d.admin.GetDefaultPDC(1),n=t.Tables.length>0?t.Tables[0]:null;if(null!=n&&n.length>0&&!r.J0.IsEmpty(n[0].UserProbableValues)){let D=new r.VB;D.LoadXml(n[0].UserProbableValues.toString()),D.SelectNodes("XML/Row").forEach(C=>{if(this.BankAccounts.SelectedValue=parseInt(C.attributes.Bank.value),this.FilterON.Items[parseInt(C.attributes.FilterOn.value)].IsChecked=!0,this.SortON.Items[parseInt(C.attributes.SortOn.value)].IsChecked=!0,this.Filter.Items[parseInt(C.attributes.Document.value)].IsChecked=!0,this.Stat.SelectedValue=C.attributes.Status.value.toString(),this.PostConversionDate.IsChecked=(0,T.yG0)(C.attributes.PostonconversionDate.value),null!=C.attributes.Documents&&""!=C.attributes.Documents.value&&(this.Documents.SelectedValue=C.attributes.Documents.value),(null==parent||null==this.parent.ForeignCurrency)&&null!=C.attributes.FCChecked&&(this.ForeignCurrency.CheckBox.IsChecked=(0,T.yG0)(C.attributes.FCChecked.value),this.ForeignCurrency.ComboBox.SelectedValue=C.attributes.FCID.value),this.Location.Visible){let l=C.attributes.Locations.value.toString().split(",");for(let u=0;u<this.Location.Items.length;u++)for(let m=0;m<l.length;m++)this.Location.Items[u].Value.toString()==l[m].toString()&&(this.Location.Items[u].IsChecked=!0)}if(this.Division.Visible&&null!=C.attributes.Divisions){let l=C.attributes.Divisions.value.toString().split(",");for(let u=0;u<this.Division.Items.length;u++)for(let m=0;m<l.length;m++)this.Division.Items[u].Value.toString()==l[m].toString()&&(this.Division.Items[u].IsChecked=!0)}if(this.DimensionWise.Visible&&null!=C.attributes.Dimensions&&this.Dimension.toString()==C.attributes.Dimension.value.toString()){let l=C.attributes.Dimensions.value.toString().split(",");for(let u=0;u<this.DimensionWise.Items.length;u++)for(let m=0;m<l.length;m++)this.DimensionWise.Items[u].Value.toString()==l[m].toString()&&(this.DimensionWise.Items[u].IsChecked=!0)}if(this.TreeVisibility&&null!=this.CostCenterFilters){let I,l="",u="",m="",b=[],P=0;for(let G=0;G<C.attributes.length;G++)if(C.attributes[G].name.startsWith("TreeFilterDimension_")){b=[],l=C.attributes[G].name.Replace("TreeFilterDimension_",""),u=C.attributes[G].value;let A=u.split(",");if(null!=A&&A.length>0)for(let F=0;F<A.length;F++)if(null!=A[F]&&""!=A[F].toString()){let H=new U.n;H.Id=parseInt(A[F]),b.push(H)}var c=this.CostCenters.Items.find(F=>F.Value==l);null!=c&&(m=c.Name),I=new z.x(parseInt(l),"",m,this),I.SelectedNodes=b,I.SelectedNodesTag="[FILTER]",this.CostCenterFilters.push(I),0==P&&(this.CostCenters.SelectedItem=c,this.CostCenters.SelectedValue=l,this.OnCostCenterChange(null)),P++}}})}}}else{this.BankAccounts.CCID=2,this.BankAccounts.TypeID=2,this.BankAccounts.Refresh(),this.Filter=new M.Q("Documents");let h=new M.u("All",0,"Filter");h.Group=this.Filter,null!=this.Trparent&&0==this.Trparent.Filter&&(h.IsChecked=!0),h.Label=a.d.GetResource("ComLanguageAll"),this.Filter.Items.push(h),h=new M.u("pending",1,"Filter"),h.Group=this.Filter,null!=this.Trparent&&1==this.Trparent.Filter&&(h.IsChecked=!0),h.Label=a.d.GetResource("PDR"),this.Filter.Items.push(h),this.FromDate.Date=this.Trparent.FromDate,this.ToDate.Date=this.Trparent.toDate,this.BankAccounts.SelectedValue=this.Trparent.BankAccounts.SelectedValue,this.Documents.Visible=!1}}OnCostCenterChange(h){if(!r.J0.IsEmpty(this.CostCenters.SelectedValue)&&(0==this.tree.length||this.tree[0].CostCenterID!=parseInt(this.CostCenters.SelectedValue))){let s=0;null!=this.CostCenters.SelectedItem&&!r.J0.IsEmpty(this.CostCenters.SelectedItem.Parent)&&(s=r.J0.Int(this.CostCenters.SelectedItem.Parent)),this.LoadCostCenterTree(parseInt(this.CostCenters.SelectedValue),s,0,null)}}LoadCostCenterTree(h,s,i,e){this.tree.Clear();let t="";50002==h&&"True"==a.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==a.d.SessionManager.Preferences["LW Reports"]&&(t=r.J0.IsEmpty(a.d.SessionManager.LocationWhere)?"a.NodeID IN (-1234)":"a.NodeID IN ("+a.d.SessionManager.LocationWhere+")");let n=new $.T;if(null==e)for(let D=0;D<this.CostCenterFilters.length;D++){const d=this.CostCenterFilters[D];if(d.CostCenterID==h&&d.LookupTypeID==s){e=d.SelectedNodes;break}}null==e?n.TreeViewModel_5(h,this,i,t,""):n.TreeViewModel_6(h,this,i,t,e,""),n.LookupTypeID=s,n.HeaderVisiblity=!1,n.OnNodeSelected||(n.OnNodeSelected=new L.Yk,n.OnNodeSelected.Subscribe(this,"OnNodeSelected")),this.tree.push(n)}GetLocation(h,s){let i="";if(h.Visible){for(let e=1;e<h.Items.length;e++)h.Items[e].IsChecked&&(i.length>0&&(i+=","),i+=h.Items[e].Value);s&&(0==i.length&&(i="-100"),h.Items[0].IsChecked&&"1"==a.d.SessionManager.RoleID&&(i=""))}return i}OnLocationCheckedChanged(h){if(!this.LockCheckedChanged&&h.item instanceof p.oN){let s=h.item,i=50001==s.Type||50002==s.Type?50001==s.Type?this.Division:this.Location:this.DimensionWise;if("All"==s.Value){this.LockCheckedChanged=!0;for(let e=1;e<i.Items.length;e++)i.Items[e].IsChecked=s.IsChecked;this.LockCheckedChanged=!1}else{if(this.LockCheckedChanged=!0,s.IsChecked){i.Items[0].IsChecked=!0;for(let e=1;e<i.Items.length;e++)if(!i.Items[e].IsChecked){i.Items[0].IsChecked=!1;break}}else i.Items[0].IsChecked=!1;this.LockCheckedChanged=!1}this.LockCheckedChanged=!1}}OnButtonClick(h){if("Cancel"==h.toString())a.d.page.HideDialog(this.PopUpGUID);else if("SetAsDefault"==h.toString()){let e="";if(e+="<XML>",e+="<Row ",e+='Bank="'+this.BankAccounts.SelectedValue+'" ',e+='FilterOn="'+this.FilterON.CheckedItem.FeatureID+'" ',e+='SortOn="'+this.SortON.CheckedItem.FeatureID+'" ',e+='Document="'+this.Filter.CheckedItem.FeatureID+'" ',e+='Status="'+this.Stat.SelectedValue+'" ',e+='Locations="'+this.GetLocation(this.Location,!1)+'" ',e+='Divisions="'+this.GetLocation(this.Division,!1)+'" ',e+='PostonconversionDate="'+this.PostConversionDate.IsChecked+'" ',e+='Documents="'+this.Documents.SelectedValue+'" ',this.DimensionWise.Visible&&(e+='Dimension="'+this.Dimension+'" ',e+='Dimensions="'+this.GetLocation(this.DimensionWise,!1)+'" '),null!=this.ForeignCurrency&&(e+='FCChecked="'+this.ForeignCurrency.CheckBox.IsChecked+'" ',e+='FCID="'+(""==this.ForeignCurrency.ComboBox.SelectedValue?"0":this.ForeignCurrency.ComboBox.SelectedValue)+'" '),this.TreeVisibility&&null!=this.CostCenterFilters&&this.CostCenterFilters.length>0){let n="";for(let D=0;D<this.CostCenterFilters.length;D++){n="";for(let d=0;d<this.CostCenterFilters[D].SelectedNodes.length;d++)d>0&&(n+=","),n+=this.CostCenterFilters[D].SelectedNodes[d].Id;n.length>0&&(e+="TreeFilterDimension_"+this.CostCenterFilters[D].CostCenterID+'="'+n+'" ')}}e+="/>",e+="</XML>",a.d.admin.SetDefaultPDC(e.toString(),!0,1,0)}else if("Reset"==h.toString())a.d.admin.SetDefaultPDC("",!1,1,0),this.BankAccounts.SelectedValue=0,this.Stat.SelectedValue="0",this.Documents.SelectedValue="",this.Location.Items.length>0&&this.Location.Items.forEach(t=>{t.IsChecked=!1});else if("LocationSearch"!=h&&"DivisionSearch"!=h&&"DimensionWiseSearch"!=h)try{if(this.IsPDC&&null!=parent){if(this.TreeVisibility&&this.Dimension>5e3){let e=!1;if(null!=this.CostCenterFilters&&this.CostCenterFilters.length>0){var s=this.CostCenterFilters.find(t=>t.CostCenterID==this.Dimension);null!=s&&s.SelectedNodes.length>0&&(e=!0)}if(!e){var i=this.CostCenters.Items.find(t=>t.Value==this.Dimension.toString());if(null!=i)return this.CostCenters.SelectedValue=this.Dimension.ToString(),this.DisplayMessage="select "+i.Name,void(this.MessageVisibility=!0)}}this.parent.DialogResult=!0,this.parent.FromDate=this.FromDate.Date,this.parent.ForeignCurrency=this.ForeignCurrency,this.parent.ToDate=this.ToDate.Date,this.parent.BankID=this.BankAccounts.SelectedValue,this.parent.Filter=this.Filter.CheckedItem.FeatureID,null!=this.Stat.SelectedValue&&this.Stat.SelectedValue.startsWith("HOLD_")?(this.parent.Status="0",this.parent.HoldDimFilter=parseInt(this.Stat.SelectedValue.replace("HOLD_",""))):(this.parent.Status=this.Stat.SelectedValue,this.parent.HoldDimFilter=0),this.parent.DocumentPicked=this.Documents.SelectedValue,this.parent.Locations=this.GetLocation(this.Location,!0),this.parent.Divisions=this.GetLocation(this.Division,!0),this.parent.Dimensions=this.GetLocation(this.DimensionWise,!0),this.parent.PostonconversionDate=this.PostConversionDate.IsChecked,this.parent.FilterOn=this.FilterON.Items[0].IsChecked?"DocDate":"ChequeMaturityDate",this.parent.SortOn=this.SortON.Items[0].IsChecked?"DocDate":"ChequeMaturityDate",this.parent.TreeWhere="",this.TreeVisibility&&null!=this.CostCenterFilters&&this.CostCenterFilters.length>0&&(this.parent.TreeWhere=this.GetDimensionFilter("L.dcCCNID")),this.parent.LoadData(),this.parent.PDCDialog=this,this.MessageVisibility=!1,a.d.page.HideDialog(this.PopUpGUID)}else null!=this.Trparent&&(this.Trparent.DialogResult=!0,this.Trparent.FromDate=this.FromDate.Date,this.Trparent.toDate=this.ToDate.Date,this.Trparent.BankAccounts.SelectedValue=this.BankAccounts.SelectedValue,this.Trparent.Filter=this.Filter.CheckedItem.FeatureID,this.Trparent.LoadData(),a.d.page.HideDialog(this.PopUpGUID))}catch(e){Logger.ErrorLog("PostedDocumentDialogViewModel","OnButtonClick",e.Message)}}GetDimensionFilter(h,s=null){let i="";return this.CostCenterFilters.forEach(e=>{if(e.CostCenterID>5e4&&(null==s||!s.Contains(e.CostCenterID)))if(e.SelectedNodes.length>0){let t="";for(let n=0;n<e.SelectedNodes.length;n++)e.SelectedNodes[n].IsGroup||(t+=e.SelectedNodes[n].Id+",");t.length>1&&(t=t.substr(0,t.length-1),i+=" AND "+h+(e.CostCenterID-5e4)+" in("+t+")")}else e.DeleteButtonVisibility||(i+=" AND ",i+=h+(e.CostCenterID-5e4)+"=-12912")}),i.toString()}GetTagTableName(h){return 2==h?"ACC_Accounts":3==h?"INV_Product":7==h?"ADM_Users":50001==h?"COM_Division":50002==h?"COM_Location":50003==h?"COM_Branch":50004==h?"COM_Department":50005==h?"COM_Salesman":50006==h?"COM_Category":50007==h?"COM_Area":50008==h?"COM_Teritory":"COM_CC"+h}OnDateRangesSelectionChanged(h){null!=this.DateRanges.SelectedValue&&R.w.SetDateRanges(this.DateRanges.SelectedValue,this.FromDate,this.ToDate)}}var k=f(89938),Q=f(29702),E=f(3955),w=f(12112),S=f(99393),q=f(2578),J=f(27490),j=f(6532),Z=f(50211),ee=f(89417),o=f(41360),K=f(32881),te=f(87716),ie=f(45319),se=f(18994),ne=f(73955);function oe(g,h){if(1&g&&(o.j41(0,"div",23),o.EFF(1,"\n                        "),o.eu8(2,8),o.EFF(3,"\n                        "),o.EFF(4,"\n                    "),o.k0s()),2&g){const s=o.XpG(2);o.R7$(2),o.Y8G("obj",s.obj.CostCenters)("group",s.form)}}function ae(g,h){if(1&g&&(o.j41(0,"div",23),o.EFF(1,"\n                                "),o.eu8(2,8),o.EFF(3,"\n                                "),o.EFF(4,"\n                            "),o.k0s()),2&g){const s=o.XpG(4);o.R7$(2),o.Y8G("obj",s.obj.CostCenters)("group",s.form)}}function re(g,h){if(1&g&&(o.j41(0,"app-pact-tree",26),o.EFF(1,"\n                            "),o.DNE(2,ae,5,2,"div",21),o.EFF(3,"\n                        "),o.k0s()),2&g){const s=h.$implicit,i=o.XpG(3);o.Y8G("obj",s),o.R7$(2),o.Y8G("ngIf",i.obj.CostCenters.Visible)}}function le(g,h){if(1&g&&(o.j41(0,"div",24),o.EFF(1,"\n                        "),o.DNE(2,re,4,2,"app-pact-tree",25),o.EFF(3,"\n                    "),o.k0s()),2&g){const s=o.XpG(2);o.R7$(2),o.Y8G("ngForOf",s.obj.tree)}}function ce(g,h){if(1&g&&(o.j41(0,"div",20),o.EFF(1,"\n                    "),o.DNE(2,oe,5,2,"div",21),o.EFF(3,"\n                    "),o.DNE(4,le,4,1,"div",22),o.EFF(5,"\n            "),o.k0s()),2&g){const s=o.XpG();o.R7$(2),o.Y8G("ngIf",s.obj.CostCenters.Visible&&0==s.obj.tree.length),o.R7$(2),o.Y8G("ngIf",s.obj.tree.length>0)}}function De(g,h){if(1&g&&(o.j41(0,"div",12),o.EFF(1,"\n                "),o.eu8(2,10),o.EFF(3,"\n            "),o.k0s()),2&g){const s=o.XpG();o.R7$(2),o.Y8G("obj",s.obj.rdo)}}function ue(g,h){if(1&g&&(o.j41(0,"div",12),o.EFF(1,"\n                    "),o.eu8(2,10),o.EFF(3,"\n                "),o.k0s()),2&g){const s=o.XpG();o.R7$(2),o.Y8G("obj",s.obj.BankAccounts)}}function de(g,h){if(1&g&&(o.j41(0,"div",12),o.EFF(1,"\n                    "),o.eu8(2,10),o.EFF(3,"\n                "),o.k0s()),2&g){const s=o.XpG();o.R7$(2),o.Y8G("obj",s.obj.Documents)}}function he(g,h){if(1&g&&(o.j41(0,"div",5),o.EFF(1,"\n                "),o.j41(2,"div",12),o.EFF(3,"\n                    "),o.eu8(4,10),o.EFF(5,"\n                "),o.k0s(),o.EFF(6,"\n                "),o.j41(7,"div",12),o.EFF(8,"\n                    "),o.eu8(9,10),o.EFF(10,"\n                "),o.k0s(),o.EFF(11,"\n            "),o.k0s()),2&g){const s=o.XpG();o.R7$(4),o.Y8G("obj",s.obj.FilterON),o.R7$(5),o.Y8G("obj",s.obj.SortON)}}function me(g,h){if(1&g&&(o.j41(0,"div",12),o.EFF(1,"\n                    "),o.j41(2,"fieldset"),o.EFF(3,"\n                        "),o.j41(4,"legend"),o.EFF(5),o.nI1(6,"translate"),o.k0s(),o.EFF(7,"\n                        "),o.eu8(8,10),o.EFF(9,"\n                    "),o.k0s(),o.EFF(10,"\n                "),o.k0s()),2&g){const s=o.XpG();o.R7$(5),o.JRh(o.bMT(6,2,s.obj.Stat.Label)),o.R7$(3),o.Y8G("obj",s.obj.Stat)}}function ge(g,h){if(1&g&&(o.j41(0,"div",12),o.EFF(1,"\n                    "),o.eu8(2,10),o.EFF(3,"\n                "),o.k0s()),2&g){const s=o.XpG();o.R7$(2),o.Y8G("obj",s.obj.Location)}}function Ce(g,h){if(1&g&&(o.j41(0,"div",12),o.EFF(1,"\n                    "),o.eu8(2,10),o.EFF(3,"\n                "),o.k0s()),2&g){const s=o.XpG();o.R7$(2),o.Y8G("obj",s.obj.Division)}}function fe(g,h){if(1&g&&(o.j41(0,"div",12),o.EFF(1,"\n                    "),o.eu8(2,10),o.EFF(3,"\n                "),o.k0s()),2&g){const s=o.XpG();o.R7$(2),o.Y8G("obj",s.obj.DimensionWise)}}function Ie(g,h){if(1&g&&o.eu8(0,30),2&g){const s=o.XpG().$implicit;o.Y8G("obj",s)}}function Se(g,h){if(1&g&&(o.qex(0),o.EFF(1,"\n                    "),o.DNE(2,Ie,1,1,"ng-container",29),o.EFF(3,"\n                "),o.bVm()),2&g){const s=h.$implicit;o.R7$(2),o.Y8G("ngIf",s.IsVisible)}}function pe(g,h){if(1&g&&(o.j41(0,"div",27),o.EFF(1,"\n                "),o.DNE(2,Se,4,1,"ng-container",28),o.EFF(3,"\n            "),o.k0s()),2&g){const s=o.XpG();o.R7$(2),o.Y8G("ngForOf",s.obj.CostCenterFilters)}}function be(g,h){if(1&g){const s=o.RV6();o.j41(0,"button",16),o.bIt("click",function(){o.eBV(s);const e=o.XpG();return o.Njj(e.obj.OnButtonClick("SetAsDefault"))}),o.EFF(1),o.nI1(2,"translate"),o.k0s()}2&g&&(o.R7$(),o.JRh(o.bMT(2,1,"Set As Default")))}let O=(()=>{class g{constructor(){}ngOnInit(){this.form=new ee.gE({})}ngAfterViewInit(){if(0==this.obj.TreeVisibility){let s=document.createDocumentFragment(),i=document.querySelector(".cPostedDoc");for(;i.firstChild;){let e=i.removeChild(i.firstChild);s.appendChild(e)}i.parentNode.replaceChild(s,i)}}static{this.\u0275fac=function(i){return new(i||g)}}static{this.\u0275cmp=o.VBU({type:g,selectors:[["app-posted-document-dialog"]],inputs:{obj:"obj"},standalone:!1,decls:103,vars:32,consts:[[1,"master-screen",2,"padding-bottom","4px","height","100%"],[1,"cPostedDoc",2,"display","flex","height","100%"],["class","rpttree_div","style","width: 50%;display: flex;flex-direction: column;height: calc(100% - 50px);",4,"ngIf"],[1,"PACTHeaderFields","PDCDialog",2,"display","block","overflow","auto","max-height","calc(100% - 44px)","padding","15px","padding-right","12px","width","50%"],["class","form-group row form-row col-xl-6 col-md-6 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"row"],["class","row",4,"ngIf"],[1,"form-group","row","form-row","col-xl-4","col-md-4","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"form-group","row","form-row","col-xl-4","col-md-4","col-sm-12","col-xs-12","select-no-border"],["FieldDirective","",3,"obj"],[1,"form-group","row","form-row","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],[1,"form-group","row","form-row","col-xl-6","col-md-6","col-sm-12","col-xs-12","PACTControl"],["style","display: flex;flex-wrap: wrap;",4,"ngIf"],[1,"Pactdailogfooter",2,"margin-top","-50px"],[2,"margin","auto"],[1,"primary-btn-wicon",3,"click"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"],["class","primary-btn-wicon",3,"click",4,"ngIf"],[1,"rpttree_div",2,"width","50%","display","flex","flex-direction","column","height","calc(100% - 50px)"],["class","CostCenters_select","style","margin: 5px;display: flex;align-items: center;",4,"ngIf"],["style","padding-right: 0px !important;height:  calc(100% - 50px);",4,"ngIf"],[1,"CostCenters_select",2,"margin","5px","display","flex","align-items","center"],[2,"padding-right","0px !important","height","calc(100% - 50px)"],[3,"obj",4,"ngFor","ngForOf"],[3,"obj"],[2,"display","flex","flex-wrap","wrap"],[4,"ngFor","ngForOf"],["ScreenDirective","",3,"obj",4,"ngIf"],["ScreenDirective","",3,"obj"]],template:function(i,e){1&i&&(o.j41(0,"div",0),o.EFF(1,"\n    "),o.j41(2,"div",1),o.EFF(3,"\n        "),o.EFF(4,"\n            "),o.DNE(5,ce,6,2,"div",2),o.EFF(6,"\n        "),o.EFF(7,"\n\n        "),o.j41(8,"div",3),o.EFF(9,"\n            "),o.DNE(10,De,4,1,"div",4),o.EFF(11,"\n            "),o.j41(12,"div",5),o.EFF(13,"\n                "),o.DNE(14,ue,4,1,"div",4),o.EFF(15,"\n                "),o.DNE(16,de,4,1,"div",4),o.EFF(17,"\n            "),o.k0s(),o.EFF(18,"\n            "),o.DNE(19,he,12,2,"div",6),o.EFF(20,"\n            "),o.j41(21,"div",5),o.EFF(22,"\n                "),o.j41(23,"div",7),o.EFF(24,"\n                    "),o.eu8(25,8),o.EFF(26,"\n                "),o.k0s(),o.EFF(27,"\n                "),o.j41(28,"div",7),o.EFF(29,"\n                    "),o.eu8(30,8),o.EFF(31,"\n                "),o.k0s(),o.EFF(32,"\n                "),o.j41(33,"div",9),o.EFF(34,"\n                    "),o.eu8(35,10),o.EFF(36,"\n                "),o.k0s(),o.EFF(37,"\n            "),o.k0s(),o.EFF(38,"\n            "),o.j41(39,"div",5),o.EFF(40,"\n                "),o.j41(41,"div",11),o.EFF(42,"\n                    "),o.eu8(43,10),o.EFF(44,"\n                "),o.k0s(),o.EFF(45,"\n                "),o.EFF(46,"\n            "),o.k0s(),o.EFF(47,"\n            "),o.j41(48,"div",5),o.EFF(49,"\n                "),o.j41(50,"div",12),o.EFF(51,"\n                    "),o.eu8(52,10),o.EFF(53,"\n                "),o.k0s(),o.EFF(54,"\n                "),o.DNE(55,me,11,4,"div",4),o.EFF(56,"\n            "),o.k0s(),o.EFF(57,"\n            "),o.j41(58,"div",5),o.EFF(59,"\n                "),o.DNE(60,ge,4,1,"div",4),o.EFF(61,"\n                "),o.DNE(62,Ce,4,1,"div",4),o.EFF(63,"\n            "),o.k0s(),o.EFF(64,"\n            "),o.j41(65,"div",5),o.EFF(66,"\n                "),o.DNE(67,fe,4,1,"div",4),o.EFF(68,"\n            "),o.k0s(),o.EFF(69,"\n            "),o.j41(70,"div",5),o.EFF(71,"\n                "),o.j41(72,"div",12),o.EFF(73,"\n                    "),o.eu8(74,10),o.EFF(75,"\n                "),o.k0s(),o.EFF(76,"\n            "),o.k0s(),o.EFF(77,"\n            "),o.DNE(78,pe,4,1,"div",13),o.EFF(79,"\n\n        "),o.k0s(),o.EFF(80,"\n    "),o.k0s(),o.EFF(81,"\n    "),o.j41(82,"div",14),o.EFF(83,"\n        "),o.j41(84,"div",15),o.EFF(85,"\n            "),o.j41(86,"button",16),o.bIt("click",function(){return e.obj.OnButtonClick("OK")}),o.EFF(87),o.nI1(88,"translate"),o.k0s(),o.EFF(89,"\n            "),o.j41(90,"button",17),o.bIt("click",function(){return e.obj.OnButtonClick("Cancel")}),o.nrm(91,"i",18),o.EFF(92),o.nI1(93,"translate"),o.k0s(),o.EFF(94,"\n            "),o.DNE(95,be,3,3,"button",19),o.EFF(96,"\n            "),o.j41(97,"button",16),o.bIt("click",function(){return e.obj.OnButtonClick("Reset")}),o.EFF(98),o.nI1(99,"translate"),o.k0s(),o.EFF(100,"\n        "),o.k0s(),o.EFF(101,"\n    "),o.k0s(),o.EFF(102,"\n"),o.k0s()),2&i&&(o.xc7("width",e.obj.IsMobile?"100%":e.obj.TreeVisibility?"1050px":"550px"),o.R7$(5),o.Y8G("ngIf",e.obj.TreeVisibility),o.R7$(3),o.xc7("width",e.obj.TreeVisibility?"50%":"100%"),o.R7$(2),o.Y8G("ngIf",e.obj.rdo),o.R7$(4),o.Y8G("ngIf",e.obj.BankAccounts&&e.obj.BankAccounts.Visible),o.R7$(2),o.Y8G("ngIf",e.obj.Documents.Visible),o.R7$(3),o.Y8G("ngIf",e.obj.IsPDC),o.R7$(6),o.Y8G("obj",e.obj.FromDate)("group",e.form),o.R7$(5),o.Y8G("obj",e.obj.ToDate)("group",e.form),o.R7$(5),o.Y8G("obj",e.obj.DateRanges),o.R7$(8),o.Y8G("obj",e.obj.ForeignCurrency),o.R7$(9),o.Y8G("obj",e.obj.Filter),o.R7$(3),o.Y8G("ngIf",e.obj.IsPDC),o.R7$(5),o.Y8G("ngIf",e.obj.Location.Visible),o.R7$(2),o.Y8G("ngIf",e.obj.IsPDC&&e.obj.Division.Visible),o.R7$(5),o.Y8G("ngIf",e.obj.DimensionWise.Visible),o.R7$(7),o.Y8G("obj",e.obj.PostConversionDate),o.R7$(4),o.Y8G("ngIf",e.obj.TreeVisibility),o.R7$(9),o.JRh(o.bMT(88,26,"Com_OK")),o.R7$(5),o.JRh(o.bMT(93,28,"Cancel")),o.R7$(3),o.Y8G("ngIf",e.obj.IsPDC),o.R7$(3),o.JRh(o.bMT(99,30,"Reset")))},dependencies:[K.Sq,K.bT,te.G,ie._,se.o,ne.D9],encapsulation:2})}}return g})(),ye=(()=>{class g extends W.g{get ScreenObject(){return this._ScreenObject}get ViewFilterVisibility(){return this._ViewFilterVisibility}set ViewFilterVisibility(s){this._ViewFilterVisibility!=s&&(this._ViewFilterVisibility=s)}get SelectMaturityDate(){return this._SelectMaturityDate}set SelectMaturityDate(s){s!=this._SelectMaturityDate&&(this._SelectMaturityDate=s,this.selectConvert(!0))}get SelectLessThanMaturityDate(){return this._SelectLessThanMaturityDate}set SelectLessThanMaturityDate(s){s!=this._SelectLessThanMaturityDate&&(this._SelectLessThanMaturityDate=s,this.selectConvert(!1))}constructor(){super(),this.SavePostedDocument=new L.Yk,this.ConvertMatDateequaltosysdate=!1,this.ConvertMatDatelessthanequaltosysdate=!1,this.CustomizeVisibility=!0,this.ActFiltercol=[],this._ViewFilterVisibility=!0,this._SelectMaturityDate=!1,this._SelectLessThanMaturityDate=!1,this.DialogResult=!1,this.FromDate=new Date,this.ToDate=new Date,this.BankID=0,this.Filter=0,this.HoldDimFilter=0,this.Locations="",this.Divisions="",this.Status="0",this.DocumentPicked="",this.Dimensions="",this.TreeWhere="",this.PostonconversionDate=!1,this.IsPDCHoldDimension=!1,this.dtTmp=null,this.dtActions=null,this.ActionSummary="",this._ScreenObject=new k.a(4e4,0),this.onLoad(),this.SetLockDims(),this.DialogResult=!1;let s=new v;s.PostedDocumentDialogViewModel_1(this),a.d.page.ShowDialog(s,O),this.PstDocGrid.Height=500}static{this.strSelect=""}static{this.strJoin=""}PostedDocumentViewModel_1(s){this.ActionSummary="",Logger.InfoLog("PostedDocumentViewModel:: Inside PostedDocumentViewModel main "),this._ScreenObject=new k.a(4e4,0),g.SetDimensionQuery(),this.onLoad(),this.LoadDashData(s),Logger.InfoLog("PostedDocumentViewModel:: Exiting PostedDocumentViewModel ")}static SetDimensionQuery(){Logger.InfoLog("PostedDocumentViewModel:: Inside SetDimensionQuery  "),this.strSelect=",ChequeBankName",this.strJoin="";let s=!1;try{let i=new r.VB;i.LoadXml(a.d.SessionManager.Preferences["PDC Customize Screen"]);for(let e=0;e<i.DocumentElement.children.length;e++){let t=i.DocumentElement.children[e];if("DIM"==t.attributes.Type.value){a.d.SessionManager.Preferences.ContainsKey("PDCBounceResonDim")&&a.d.SessionManager.Preferences.PDCBounceResonDim==t.attributes.ID.value&&(s=!0);let n=(parseInt(t.attributes.ID.value)-5e4).toString();this.strSelect+=",L.dcCCNID"+n+",D"+n+".Name AS DIM"+t.attributes.ID.value,this.strJoin+=" LEFT JOIN "+r.J0.GetTagTableName(parseInt(t.attributes.ID.value))+" AS D"+n+" ON L.dcCCNID"+n+"=D"+n+".NodeID"}else"FLD"==t.attributes.Type.value&&("CommonNarration"==t.attributes.ID.value||"LineNarration"==t.attributes.ID.value)&&(this.strSelect+=","+t.attributes.ID.value)}if(!s&&a.d.SessionManager.Preferences.ContainsKey("PDCBounceResonDim")&&""!=a.d.SessionManager.Preferences.PDCBounceResonDim&&parseInt(a.d.SessionManager.Preferences.PDCBounceResonDim)>5e4){let e=(parseInt(a.d.SessionManager.Preferences.PDCBounceResonDim)-5e4).ToString();this.strSelect+=",L.dcCCNID"+e+",D"+e+".Name AS DIM"+a.d.SessionManager.Preferences.PDCBounceResonDim,this.strJoin+=" LEFT JOIN "+r.J0.GetTagTableName(parseInt(a.d.SessionManager.Preferences.PDCBounceResonDim))+" AS D"+e+" ON L.dcCCNID"+e+"=D"+e+".NodeID"}}catch(i){Logger.ErrorLog("PDC Dimension Query Error..",i)}Logger.InfoLog("PostedDocumentViewModel:: Exiting SetDimensionQuery  ")}onLoad(){Logger.InfoLog("PostedDocumentViewModel:: Inside onLoad  "),this.DisplayName=a.d.GetResource("DocumentDesigner_PostedDocument"),this.InitColumns(),this.ConvertMatDatelessthanequaltosysdate=a.d.SessionManager.IsActionAssigned(4e4,"Convert maturity date lessthan or equalto sysdate"),this.ConvertMatDateequaltosysdate=a.d.SessionManager.IsActionAssigned(4e4,"Convert maturity date equal to system date"),this.CustomizeVisibility=a.d.SessionManager.IsActionAssigned(4e4,"Customize"),this.SavePostedDocument.Subscribe(this,"ButtonSave"),this.PstDocGrid.BeginEdit.Subscribe(this,"OnBeginEdit"),this.PstDocGrid.CellEditEnding.Subscribe(this,"OnEditend"),this.PstDocGrid.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown"),Logger.InfoLog("PostedDocumentViewModel:: Exiting onLoad  ")}OnPreviewKeyDown(s,i){let e="",t=s.grid.getData().items[s.row];if(s.grid.getCellEditor()&&s.grid.getCellEditor().args.column.name&&(e=s.grid.getCellEditor().args.column.name),117==i.which&&("Action"==e||"clrDate"==e)){if("YES"!=(confirm("Do you want to override all.?")?"Yes":"No").toUpperCase())return;s.grid.commitCurrentEdit();let D=this.PstDocGrid.Table;for(let d=0;d<D.length;d++)"Action"==e&&!this.isActionExists(D[d],t[e].toString())||(D[d][e]=t[e].toString(),this.PstDocGrid.TableColumns.Contains(e+"_Key")&&(D[d][e+"_Key"]=t[e+"_Key"].toString()),this.UpdateAction(D[d]),this.PstDocGrid.updateRow(D[d]))}}isActionExists(s,i){let e=this.dtActions;e.RowFilter=r.J0.IsEmpty(s.StatusID)||370!=parseInt(s.StatusID.toString())?r.J0.IsEmpty(s.StatusID)||439!=parseInt(s.StatusID.toString())?r.J0.IsEmpty(s.StatusID)||369!=parseInt(s.StatusID.toString())?"Value=2 or Value=100":"Value=2 or Value=0  or Value=4 or Value=5 or Value=100":"Value=1 or Value=0 or Value=100":"Value=1 or Value=0 or Value=4 or Value=5 or Value=3 or Value=100";for(let t=0;t<e.length;t++)if(e[t].Value.toString()==i)return!0;return!1}SetLockDims(){if("true"==a.d.SessionManager.Preferences.UseDimWiseLock.toLowerCase()&&""!=a.d.SessionManager.Preferences["DimensionWiseLockData Customize Screen"]&&"<XML></XML>"!=a.d.SessionManager.Preferences["DimensionWiseLockData Customize Screen"]){this.ScreenObject.LockWhere="";let s="",i="",e=new E.bT,t=0,n=0,D=a.d.common.GetDataSet("PDVM01",""),d=new r.VB;d.LoadXml(a.d.SessionManager.Preferences["DimensionWiseLockData Customize Screen"]),d.SelectNodes("XML/Row").forEach(C=>{if(null!=C.attributes.ID&&!r.J0.IsEmpty(C.attributes.ID.value)){n++;let c=!1;t=parseInt(C.attributes.ID.value),null!=D&&D.Tables.length>0&&D.Tables[0].length>0&&D.Tables[0].filter(l=>l.CostCenterID==t).length>0&&(c=!0),e.push(t.toString(),c),c?(i+=" left join "+r.J0.GetTagTableName(t)+" CC"+n+" with(nolock) on C."+r.J0.GetPrimarkyKey(t,!0)+"=CC"+n+"."+r.J0.GetPrimarkyKey(t)+"\n\t\t\t\t\t\t\tleft join "+r.J0.GetTagTableName(t)+" CJ"+n+" with(nolock) on CJ"+n+".lft between CC"+n+".lft and CC"+n+".rgt",t>5e4?s+=" and (b.dcCCNID"+(t-5e4)+"=CJ"+n+".NodeID or c.CCNID"+(t-5e4)+"=0)":3==t?s+=" and (a.ProductID=CJ"+n+".ProductID or c.ProductID=0)":2==t&&(s+=" and (a.DebitAccount=CJ"+n+".AccountID or a.CreditAccount=CJ"+n+".AccountID or c.AccountID=0)")):t>5e4?s+=" and (b.dcCCNID"+(t-5e4)+"=c.CCNID"+(t-5e4)+" or c.CCNID"+(t-5e4)+"=0)":3==t?s+=" and (a.ProductID=c.ProductID or c.ProductID=0)":2==t?s+=" and (a.DebitAccount=c.AccountID or a.CreditAccount=c.AccountID or c.AccountID=0)":400==t&&(s+=" and (a.CostCenterID=c.DocumentID or c.DocumentID=1)")}}),this.ScreenObject.LockWhere=""!=i?'<XML where="'+s+'" join="'+i+'"></XML>':s}}UpdateActionSummary(){if(Logger.InfoLog("PostedDocumentViewModel:: Inside UpdateActionSummary()  "),this.dtTmp=[],this.dtTmp=this.PstDocGrid.Table,this.ActionSummary="",Logger.InfoLog("PDC Rows Count :: "+this.dtTmp.length+" Actions Count :: "+this.dtActions.length),null!=this.dtActions&&this.dtActions.length>0){let s=0,i="",e=1,t=null;for(let n=0;n<this.dtActions.length;n++)s=0,i="Action_Key='"+this.dtActions[n].Name.toString()+"'",s=r.J0.DTComputeSUM(this.dtTmp.filter(D=>D.Action_Key==this.dtActions[n].Name.toString()),"Amount",!1),t=this.dtTmp.filter(D=>D.Action_Key==this.dtActions[n].Name.toString()),Logger.InfoLog("Expression :: "+i+" Length : "+t.length),0!=s&&(this.ActionSummary+=this.dtActions[n].Name.toString()+" ( "+t.length+" )  : "+s.ToString("N"+a.d.SessionManager.Preferences.DecimalsinAmount)+"\t",e++);Logger.InfoLog("Action Summary :: "+this.ActionSummary)}Logger.InfoLog("PostedDocumentViewModel:: End UpdateActionSummary()  ")}OnEditend(s){if(this.PstDocGrid.TableColumns.Contains("Penalty")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences.PenaltyFormula.Trim())&&"DataGridPactComboBoxColumn"==s.column.className&&"Action"==s.column.DataGridColumn.SelectedValueBinding&&this.UpdateAction(s.item),"DataGridPactComboBoxColumn"==s.column.className&&"Action"==s.column.DataGridColumn.SelectedValueBinding){this.UpdateActionSummary();let e=s.item;if("4"==r.J0.String(e.Action)&&this.PstDocGrid.TableColumns.Contains("ReplaceAccountID")&&null!=e.ReplaceAccountID&&r.J0.String(e.ReplaceAccountID)&&parseInt(e.ReplaceAccountID.toString())>1){e.BankAccountID_Key=e.ReplaceAccountID.toString();let t=a.d.document.GetCCValues(e.ReplaceAccountID.toString(),2,2);null!=t&&t.Tables.length>0&&t.Tables[0].length&&t.Columns[0].Contains("name")&&e.Table.Columns.Contains("BankAccountID")&&(e.BankAccountID=t.Tables[0].name.toString())}}}UpdateAction(s){if(r.J0.IsEmpty(s.Action)||"0"!=s.Action.toString())Object.keys(s).Contains("Penalty")&&(s.Penalty=null);else{let t,e=new E.bT,n=new w.Nl;n.setFieldDetails("Amount",1,1,"",1,!1,!1),e.push("Amount",n);let D=e;e.Amount.setFieldValue(s.Amount.toString());var i=a.d.eval.EvaluateExpression(a.d.SessionManager.Preferences.PenaltyFormula,D).toString();t=r.J0.DoubleTryParse(i.toString()),null!=i&&"Infinity"!=i.toString()&&"-Infinity"!=i.toString()&&"NaN"!=i.toString()&&r.J0.DoubleTryParse(i.toString())&&(s.Penalty=i.toString())}this.UpdateActionSummary()}OnBeginEdit(s){let i=s.args;if(Logger.InfoLog("PostedDocumentViewModel:: Inside OnBeginEdit"),"DataGridPactComboBoxColumn"==i.column.className){if("Action"==i.model.SelectedValueBinding){let t=i.item;if(""!=t.StatusID.toString()&&452==parseInt(t.StatusID.toString()))return void(i.Cancel=!0);if(a.d.SessionManager.Preferences.ContainsKey("ExcludePDCTerminatedContracts")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences.ExcludePDCTerminatedContracts)&&(0,T.yG0)(a.d.SessionManager.Preferences.ExcludePDCTerminatedContracts)&&a.d.SessionManager.Preferences.ContainsKey("PDCStatusList")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences.PDCStatusList)&&this.PstDocGrid.TableColumns.Contains("ContractStatus")&&!r.J0.IsEmpty(t.ContractStatus)&&parseInt(t.ContractStatus.toString())>0){let n=a.d.SessionManager.Preferences.PDCStatusList.toString().split(",");for(let D=0;D<n.length;D++)if(""!=t.StatusID.toString()&&428==parseInt(t.ContractStatus.toString())&&parseInt(t.StatusID.toString())==parseInt(n[D]))return void(i.Cancel=!0)}if(a.d.SessionManager.Preferences.ContainsKey("LockBRSClearedPDCs")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences.LockBRSClearedPDCs)&&(0,T.yG0)(a.d.SessionManager.Preferences.LockBRSClearedPDCs)&&""!=t.BRS_Status.toString()&&1==parseInt(t.BRS_Status.toString()))return this.DisplayMessage="Cannot perform the action for BRS cleared document",this.MessageVisibility=!0,void(i.Cancel=!0);i.column.editor.collection.ItemsSource=i.column.DgCol.ComboData,i.column.editor.collection.ItemsSource=r.J0.IsEmpty(t.StatusID)||370!=parseInt(t.StatusID.toString())?r.J0.IsEmpty(t.StatusID)||439!=parseInt(t.StatusID.toString())?r.J0.IsEmpty(t.StatusID)||369!=parseInt(t.StatusID.toString())?!r.J0.IsEmpty(t.StatusID)&&429==parseInt(t.StatusID.toString())&&r.J0.hasprop(t,"AdjCnt")&&!r.J0.IsEmpty(t.AdjCnt)&&parseInt(t.AdjCnt.toString())>0?i.column.DgCol.ComboData.filter(n=>"false"==n):r.J0.IsEmpty(t.StatusID)||376!=parseInt(t.StatusID.toString())?i.column.DgCol.ComboData.filter(n=>2==n.Value||100==n.Value):i.column.DgCol.ComboData.filter(n=>"false"==n):i.column.DgCol.ComboData.filter(n=>2==n.Value||0==n.Value||4==n.Value||5==n.Value||100==n.Value):i.column.DgCol.ComboData.filter(n=>1==n.Value||0==n.Value||100==n.Value):i.column.DgCol.ComboData.filter(n=>1==n.Value||0==n.Value||4==n.Value||5==n.Value||3==n.Value||100==n.Value||6==n.Value)}}else if("DataGridDateColumn"==i.column.className){let e=i.column.editor.collection.SelectedValueBinding,t=i.Item;if(""!=t.StatusID.toString()&&452==parseInt(t.StatusID.toString()))return void(i.Cancel=!0);if("clrDate_Key"==e){if(r.J0.IsEmpty(t.Action)||1!=parseInt(t.Action.toString())&&0!=parseInt(t.Action.toString())&&4!=parseInt(t.Action.toString())&&5!=parseInt(t.Action.toString()))return void(i.Cancel=!0)}else if("HoldDate_Key"==e&&"370"!=i.item.StatusID.toString())return void(i.Cancel=!0)}else if("DataGridPactListBoxColumn"==i.column.className){let e=i.column.editor.collection,t=e.SelectedValueBinding,n=i.Item;if(!r.J0.IsEmpty(n.StatusID)&&452==parseInt(n.StatusID.toString()))return void(i.Cancel=!0);if(!r.J0.IsEmpty(n.BankIDs))return void(i.Cancel=!0);if(!r.J0.IsEmpty(n.StatusID)&&439==parseInt(n.StatusID.toString()))return void(i.Cancel=!0);if("19"!=n.DocumentType.toString()&&!a.d.SessionManager.IsActionAssigned(43,"PDPBankChange"))return void(i.Cancel=!0);if("HoldDimension_Key"==t&&"370"!=n.StatusID.toString())return void(i.Cancel=!0);2==e.CostCenterID&&(this.PstDocGrid.TableColumns.Contains("dcCCNID1")&&!r.J0.IsEmpty(n.dcCCNID1)&&parseInt(n.dcCCNID1.toString())>0&&(e.DivisionID=parseInt(n.dcCCNID1.toString())),this.PstDocGrid.TableColumns.Contains("dcCCNID2")&&!r.J0.IsEmpty(n.dcCCNID2)&&parseInt(n.dcCCNID2.toString())>0&&(e.LocationID=parseInt(n.dcCCNID2.toString())))}Logger.InfoLog("PostedDocumentViewModel:: Exiting OnBeginEdit")}InitColumns(){Logger.InfoLog("PostedDocumentViewModel:: Inside InitColumns");let s=[];s.Columns=[],s.Columns.push("Name"),s.Columns.push("Value"),s.Columns.push("Status");let i=[];i.Name="",i.Value=100,s.push(i),a.d.SessionManager.IsActionAssigned(4e4,"Convert")&&(i=[],i.Name=a.d.GetResource("Pdc_Convert"),i.Value=1,s.push(i)),a.d.SessionManager.IsActionAssigned(4e4,"UnConvert")&&(i=[],i.Name=a.d.GetResource("Pdc_unConvert"),i.Value=2,s.push(i)),a.d.SessionManager.IsActionAssigned(4e4,"Bounce")&&(i=[],i.Name=a.d.GetResource("DocumentDesigner_Bounce"),i.Value=0,s.push(i)),a.d.SessionManager.IsActionAssigned(4e4,"Replace")&&(i=[],i.Name=a.d.GetResource("Replace"),i.Value=4,s.push(i),i=[],i.Name=a.d.GetResource("ReplacePartial"),i.Value=5,s.push(i)),a.d.SessionManager.IsActionAssigned(4e4,"Cancel")&&(i=[],i.Name=a.d.GetResource("Cancel"),i.Value=3,s.push(i)),a.d.SessionManager.Preferences.ContainsKey("Enablechequehold")&&(0,T.yG0)(a.d.SessionManager.Preferences.Enablechequehold)&&a.d.SessionManager.IsActionAssigned(4e4,"Hold")&&(i=[],i.Name=a.d.GetResource("Hold"),i.Value=6,s.push(i)),this.dtActions=[],this.dtActions=s.filter(u=>""!=u.Name),this.IsPDCHoldDimension=!1,a.d.SessionManager.Preferences.ContainsKey("PDCHoldDimension")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences.PDCHoldDimension)&&a.d.SessionManager.Preferences.PDCHoldDimension.length>1&&(this.IsPDCHoldDimension=!0),this.PstDocGrid=new Q.vv,this.PstDocGrid.CanUserSortColumns=!0,this.PstDocGrid.Columns=[],this.PstDocGrid.Width="",this.PstDocGrid.CalcTotalsOnDataView=!0;let e,D,t=[],n=[];if(a.d.SessionManager.Preferences.ContainsKey("PDC Screen Widths")&&""!=a.d.SessionManager.Preferences["PDC Screen Widths"]){let u=new r.VB;u.LoadXml(a.d.SessionManager.Preferences["PDC Screen Widths"]);for(let m=0;m<u.DocumentElement.childNodes.length;m++){let I=u.DocumentElement.children[m];e=new S.O7,e.Header=I.attributes.Header.value,e.DisplayMember=I.attributes.Name.value,e.DisplayIndex=parseInt(I.attributes.index.value),e.Width=parseInt(I.attributes.WIDTH.value),t.push(e)}}if(e=new S.O7,e.Header=a.d.GetResource("DocumentDesigner_Sno"),e.DisplayMember="Sno",e.ReadOnly=!0,e.IsFrozen=!0,e.Width=45,null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header=a.d.GetResource("DocumentDesigner_VoucherNo"),e.DisplayMember="VoucherNo",e.DataType="LINK",e.Click.Subscribe(this,"onClick"),e.ReadOnly=!0,e.IsFrozen=!0,e.Width=100,null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header=a.d.GetResource("DocumentDesigner_VoucherDate"),e.DisplayMember="DocDateFormat",e.ValueMember="DocDateFormat_Key",e.ReadOnly=!0,e.DataType="DATESORT",e.Width=80,null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header=a.d.GetResource("DocumentDesigner_Account"),e.DisplayMember="AccountID",e.ValueMember="AccountID_Key",e.ReadOnly=!0,e.Width=150,null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header=a.d.GetResource("DocumentDesigner_ChequeNo"),e.DisplayMember="ChequeNumber",e.ReadOnly=!0,e.Width=100,null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header=a.d.GetResource("Service_ChequeDate"),e.DisplayMember="ChequeDateFormat",e.ValueMember="ChequeDateFormat_Key",e.ReadOnly=!0,e.DataType="DATESORT",e.Width=80,null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),null!=(c=t.find(u=>"HoldTill"==u.DisplayMember))){e=new S.O7,e.Header="Hold Status",e.DisplayMember="Name",e.ValueMember="Value",e.ValueBinding="HoldStatus",e.ReadOnly=!0,e.DataType="ComboBox";let u=[];u.push(p._p.ComboBoxItems_2("Hold","1")),e.ComboData=u,e.DisplayIndex=c.DisplayIndex,e.Width=c.Width,n.push(e),e=new S.O7,e.Header="Hold Till",e.DisplayMember="HoldTill",e.ValueMember="HoldTill_Key",e.ReadOnly=!0,e.DataType="DATE",e.DisplayIndex=c.DisplayIndex,e.Width=c.Width,n.push(e)}e=new S.O7,e.Header=a.d.GetResource("DocumentDesigner_Amount"),e.DisplayMember="Amount",e.ReadOnly=!0,e.DataType="FLOAT",e.DecimalPoints=a.d.SessionManager.Preferences.DecimalsinAmount,e.Width=100,e.IsCalculated=1,e.ShowTotal=!0,null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header=a.d.GetResource("DocumentDesigner_MaturityDate"),e.DisplayMember="MaturityDateFormat",e.ValueMember="MaturityDateFormat_Key",e.ReadOnly=!0,e.DataType="DATESORT",e.Width=80,null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header=a.d.GetResource("DocumentDesigner_Bank"),e.DisplayMember="BankAccountID",e.ValueMember="BankAccountID_Key",e.DataType="LISTBOX",e.CostCenterID=2,D=r.J0.IntTryParse(a.d.SessionManager.Preferences.PDCAccountListView),e.TypeID=a.d.SessionManager.Preferences.ContainsKey("PDCAccountListView")&&r.J0.IntTryParse(a.d.SessionManager.Preferences.PDCAccountListView)?parseInt(a.d.SessionManager.Preferences.PDCAccountListView):51,e.Width=150,null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header=a.d.GetResource("Ren_CntrctPayee"),e.DisplayMember="ChequeBankName",e.ReadOnly=!0,e.Width=100,null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e);let d=new r.VB;d.LoadXml(a.d.SessionManager.Preferences["PDC Customize Screen"]);for(let u=0;u<d.DocumentElement.children.length;u++){let m=d.DocumentElement.children[u];"DIM"==m.attributes.Type.value?(e=new S.O7,e.Header=m.attributes.Header.value,e.DisplayMember="DIM"+m.attributes.ID.value,a.d.SessionManager.Preferences.ContainsKey("PDCBounceResonDim")&&a.d.SessionManager.Preferences.PDCBounceResonDim==m.attributes.ID.value?(e.ValueMember="dcCCNID"+(parseInt(a.d.SessionManager.Preferences.PDCBounceResonDim)-5e4),e.CostCenterID=parseInt(m.attributes.ID.value),e.TypeID=1,e.DataType="LISTBOX"):e.ReadOnly=!0,e.Width=100,null!=(c=t.find(I=>I.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e)):"FLD"==m.attributes.Type.value&&(e=new S.O7,e.Header=m.attributes.Header.value,e.DisplayMember=m.attributes.ID.value,e.ReadOnly=!0,e.Width=150,null!=(c=t.find(I=>I.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e))}var c;if(a.d.SessionManager.Preferences.ContainsKey("PDCBounceResonDim")&&""!=a.d.SessionManager.Preferences.PDCBounceResonDim&&parseInt(a.d.SessionManager.Preferences.PDCBounceResonDim)>5e4&&null==n.find(u=>u.CostCenterID==parseInt(a.d.SessionManager.Preferences.PDCBounceResonDim))&&(e=new S.O7,e.Header="Bounce Reason",e.DisplayMember="DIM"+a.d.SessionManager.Preferences.PDCBounceResonDim,e.ValueMember="dcCCNID"+(parseInt(a.d.SessionManager.Preferences.PDCBounceResonDim)-5e4),e.CostCenterID=parseInt(a.d.SessionManager.Preferences.PDCBounceResonDim),e.DisplayIndex=n.length,e.TypeID=1,e.DataType="LISTBOX",e.Width=150,n.push(e)),e=new S.O7,e.Header=a.d.GetResource("DocumentDesigner_Action"),e.ValueBinding="Action",e.DataType="PactComboBox",e.DisplayMember="Name",e.ValueMember="Value",e.Width=70,e.ComboData=s,null!=(c=t.find(u=>u.DisplayMember==e.ValueBinding))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),a.d.SessionManager.Preferences.ContainsKey("PostPenalty")&&"true"==a.d.SessionManager.Preferences.PostPenalty.toLowerCase()){let u=e.DisplayIndex;e=new S.O7,e.Header="Penalty",e.DisplayMember="Penalty",a.d.SessionManager.IsActionAssigned(4e4,"EditPenalty")||(e.ReadOnly=!0),e.DataType="FLOAT",e.DecimalPoints=a.d.SessionManager.Preferences.DecimalsinAmount,e.Width=100,e.IsCalculated=1,e.ShowTotal=!0,null!=(c=t.find(m=>m.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):e.DisplayIndex=u+1,n.push(e)}e=new S.O7,e.Header=a.d.SessionManager.IsActionAssigned(4e4,"Hold")?a.d.SessionManager.IsActionAssigned(4e4,"Convert")?a.d.GetResource("DocumentDesigner_ConvertOn")+"/"+a.d.GetResource("HoldTill"):a.d.GetResource("HoldTill"):a.d.GetResource("DocumentDesigner_ConvertOn"),e.DisplayMember="clrDate",e.ValueMember="clrDate_Key",e.DataType="DATESORT",e.ReadOnly=!1,e.Width=90,null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header=a.d.GetResource("DocumentDesigner_Status"),e.DisplayMember="Status",e.ReadOnly=!0,e.Width=100,null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header=a.d.GetResource("PDC_DocNo"),e.DisplayMember="ConvertedDocNo",e.ReadOnly=!0,e.Width=120,e.DataType="LINK",e.Click.Subscribe(this,"OnDocLink"),null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header="User",e.DisplayMember="ConvertedDocUser",e.ReadOnly=!0,e.Width=120,e.DataType="LINK",e.Click.Subscribe(this,"OnDocLink"),null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header="Date",e.DisplayMember="ConvertdDocDate",e.ValueMember="ConvertdDocDate_Key",e.ReadOnly=!0,e.Width=120,e.DataType="DATESORT",null!=(c=t.find(u=>"ConvertedDocDate"==u.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header=a.d.GetResource("PDC_InterDocNo"),e.DisplayMember="InterMediateVoucherNO",e.ReadOnly=!0,e.Width=120,e.DataType="LINK",e.Click.Subscribe(this,"OnInterDocLink"),null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header="User",e.DisplayMember="InterMediateDocUser",e.ReadOnly=!0,e.Width=120,e.DataType="LINK",e.Click.Subscribe(this,"OnDocLink"),null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header="Date",e.DisplayMember="InterMediatDocDate",e.ValueMember="InterMediatDocDate_Key",e.ReadOnly=!0,e.Width=120,e.DataType="DATESORT",null!=(c=t.find(u=>"InterMediateDocDate"==u.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header="Bounced Doc No",e.DisplayMember="BouncedVoucher",e.ReadOnly=!0,e.Width=110,e.DataType="LINK",e.Click.Subscribe(this,"OnBouncedDocLink"),null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header="User",e.DisplayMember="BouncedDocUser",e.ReadOnly=!0,e.Width=120,e.DataType="LINK",e.Click.Subscribe(this,"OnDocLink"),null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),e=new S.O7,e.Header="Date",e.DisplayMember="BouncdDocDate",e.ValueMember="BouncdDocDate_Key",e.ReadOnly=!0,e.Width=120,e.DataType="DATESORT",null!=(c=t.find(u=>"BouncedDocDate"==u.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):t.length>0&&(e.IsVisible=!1),n.push(e),this.IsPDCHoldDimension&&(e=new S.O7,e.DataType="LISTBOX",e.Header="Hold Dimension",e.ValueMember="HoldDimension_Key",e.DisplayMember="HoldDimension",e.CostCenterID=parseInt(a.d.SessionManager.Preferences.PDCHoldDimension),null!=(c=t.find(u=>"HoldDimension"==u.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):(e.DisplayIndex=n.length,e.Width=120),n.push(e),a.d.SessionManager.Preferences.PDCHoldDate.length>0&&(e=new S.O7,e.Header="Hold Date",e.DisplayMember="HoldDate",e.ValueMember="HoldDate_Key",e.DataType="DATESORT",e.ReadOnly=!1,null!=(c=t.find(u=>"HoldDate"==u.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):(e.DisplayIndex=n.length,e.Width=90),n.push(e)),a.d.SessionManager.Preferences.PDCHoldRemarks.length>0&&(e=new S.O7,e.Header="Hold Remarks",e.DisplayMember="HoldRemarks",e.ReadOnly=!1,null!=(c=t.find(u=>"HoldRemarks"==u.DisplayMember))?(e.DisplayIndex=c.DisplayIndex,e.Width=c.Width):(e.DisplayIndex=n.length,e.Width=140),n.push(e))),a.d.SessionManager.Preferences.ContainsKey("Enablechequehold")&&(0,T.yG0)(a.d.SessionManager.Preferences.Enablechequehold)&&a.d.SessionManager.IsActionAssigned(4e4,"Hold")&&(e=new S.O7,e.Header="PDC Hold Status",e.DisplayMember="PDCHoldStatus",e.ReadOnly=!0,e.Width=120,e.DisplayIndex=n.length,n.push(e)),e=new S.O7,e.Header=a.d.GetResource("BRS_Status"),e.DisplayMember="BRS_Status",e.ReadOnly=!0,e.Width=0,null!=(c=t.find(u=>u.DisplayMember==e.DisplayMember))&&(e.DisplayIndex=c.DisplayIndex),e.IsVisible=!1,n.push(e),a.d.SessionManager.Preferences.ContainsKey("ExcludePDCTerminatedContracts")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences.ExcludePDCTerminatedContracts)&&(0,T.yG0)(a.d.SessionManager.Preferences.ExcludePDCTerminatedContracts)&&(e=new S.O7,e.Header=a.d.GetResource("Contract Status"),e.DisplayMember="ContractStatus",e.ReadOnly=!0,e.Width=0,null!=(c=t.find(m=>m.DisplayMember==e.DisplayMember))&&(e.DisplayIndex=c.DisplayIndex),e.IsVisible=!1,n.push(e)),n.sort((u,m)=>u.DisplayIndex-m.DisplayIndex).forEach(u=>{this.PstDocGrid.Columns.push(u)}),this.PstDocGrid.SearchVisible=!0,this.PstDocGrid.FilterVisible=!0,this.PstDocGrid.SearchColStartIndex=1,this.PstDocGrid.AddSearchCols(),g.SetDimensionQuery(),n.length>0&&(this.ActFiltercol=n),Logger.InfoLog("PostedDocumentViewModel:: Exiting InitColumns")}onClick(){var s=this;return(0,V.A)(function*(){const{AddEditDocumentViewModel:i}=yield Promise.resolve().then(f.bind(f,27490)),{AddEditDocumentComponent:e}=yield Promise.resolve().then(f.bind(f,8405));if(Logger.InfoLog("PostedDocumentViewModel:: Inside onClick"),null!=s.PstDocGrid.SelectedItem&&!r.J0.IsEmpty(s.PstDocGrid.SelectedItem.CostCenterID)){let t=new i(parseInt(s.PstDocGrid.SelectedItem.CostCenterID),"",!0),n={};Object.assign(n,{component:e,params:{obj:t}}),n.title=t.ScreenName,a.d.page.addNewTab(n),a.d.page.setActiveTab(a.d.page.indexOf(t)),t.ScreenObject.DocPrefix.ComboBox.SelectedValue=s.PstDocGrid.SelectedItem.DocPrefix.toString(),t.ScreenObject.DocPrefix.TextBox.Text=s.PstDocGrid.SelectedItem.DocNumber.toString(),t.OnDocPrefixChanged("lostFocus"),t.ScreenObject.FillDocumentPrefix(!0)}Logger.InfoLog("PostedDocumentViewModel:: Exiting onClick")})()}OnDocLink(s){var i=this;return(0,V.A)(function*(){const{AddEditDocumentViewModel:e}=yield Promise.resolve().then(f.bind(f,27490)),{AddEditDocumentComponent:t}=yield Promise.resolve().then(f.bind(f,8405));if(Logger.InfoLog("PostedDocumentViewModel:: Inside OnDocLink"),null!=i.PstDocGrid.SelectedItem&&!r.J0.IsEmpty(i.PstDocGrid.SelectedItem.ConvertedDocNo))try{let n=i.ScreenObject.GetDocDetailsByAccID(parseInt(i.PstDocGrid.SelectedItem.ConvertedAccDocID.toString()));if(null!=n&&n.Tables.length>0&&n.Tables[0].length>0){let D=new e(parseInt(n.Tables[0][0].CCID),n.Tables[0][0].ResourceData.toString(),!0),d={};Object.assign(d,{component:t,params:{obj:D}}),d.title=D.ScreenName,a.d.page.addNewTab(d),a.d.page.setActiveTab(a.d.page.indexOf(D)),D.ScreenObject.DocPrefix.ComboBox.SelectedValue=n.Tables[0][0].Prefix.toString(),D.ScreenObject.DocPrefix.TextBox.Text=n.Tables[0][0].DocNumber.toString(),D.OnDocPrefixChanged("lostFocus"),D.ScreenObject.FillDocumentPrefix(!0)}}catch(n){Logger.ErrorLog("PostedDocumentViewModel","OnLinkClickEvent",n.Message)}Logger.InfoLog("PostedDocumentViewModel:: Exiting OnDocLink")})()}OnInterDocLink(s){var i=this;return(0,V.A)(function*(){const{AddEditDocumentViewModel:e}=yield Promise.resolve().then(f.bind(f,27490)),{AddEditDocumentComponent:t}=yield Promise.resolve().then(f.bind(f,8405));if(Logger.InfoLog("PostedDocumentViewModel:: Inside OnInterDocLink"),null!=i.PstDocGrid.SelectedItem&&!r.J0.IsEmpty(i.PstDocGrid.SelectedItem.InterMediateVoucherNO))try{let n=i.ScreenObject.GetDocDetailsByAccID(parseInt(i.PstDocGrid.SelectedItem.InterMediateDocID.toString()));if(null!=n&&n.Tables.length>0&&n.Tables[0].length>0){let D=new e(parseInt(n.Tables[0][0].CCID),n.Tables[0][0].ResourceData.toString(),!0),d={};Object.assign(d,{component:t,params:{obj:D}}),d.title=D.ScreenName,a.d.page.addNewTab(d),a.d.page.setActiveTab(a.d.page.indexOf(D)),D.ScreenObject.DocPrefix.ComboBox.SelectedValue=n.Tables[0][0].Prefix.toString(),D.ScreenObject.DocPrefix.TextBox.Text=n.Tables[0][0].DocNumber.toString(),D.OnDocPrefixChanged("lostFocus"),D.ScreenObject.FillDocumentPrefix(!0)}}catch(n){Logger.ErrorLog("PostedDocumentViewModel","OnLinkClickEvent",n.Message)}Logger.InfoLog("PostedDocumentViewModel:: Exiting OnInterDocLink")})()}OnBouncedDocLink(s){var i=this;return(0,V.A)(function*(){const{AddEditDocumentViewModel:e}=yield Promise.resolve().then(f.bind(f,27490)),{AddEditDocumentComponent:t}=yield Promise.resolve().then(f.bind(f,8405));if(Logger.InfoLog("PostedDocumentViewModel:: Inside OnBouncedDocLink"),null!=i.PstDocGrid.SelectedItem&&!r.J0.IsEmpty(i.PstDocGrid.SelectedItem.BouncedVoucher))try{let n=i.ScreenObject.GetDocDetailsByAccID(parseInt(i.PstDocGrid.SelectedItem.BouncedVoucherDocID.toString()));if(null!=n&&n.Tables.length>0&&n.Tables[0].length>0){let D=new e(parseInt(n.Tables[0][0].CCID),n.Tables[0][0].ResourceData.toString(),!0),d={};Object.assign(d,{component:t,params:{obj:D}}),d.title=D.ScreenName,a.d.page.addNewTab(d),a.d.page.setActiveTab(a.d.page.indexOf(D)),D.ScreenObject.DocPrefix.ComboBox.SelectedValue=n.Tables[0][0].Prefix.toString(),D.ScreenObject.DocPrefix.TextBox.Text=n.Tables[0][0].DocNumber.toString(),D.OnDocPrefixChanged("lostFocus"),D.ScreenObject.FillDocumentPrefix(!0)}}catch(n){Logger.ErrorLog("PostedDocumentViewModel","OnLinkClickEvent",n.Message)}Logger.InfoLog("PostedDocumentViewModel:: Exiing OnBouncedDocLink")})()}FillCC(s,i,e,t){t.forEach(n=>{let D=s.ScreenObject._CCFields.find(d=>d.CCID==parseInt(n.ColumnCostCenterID.toString()));D instanceof B.y$&&D.CCID>5e4&&e.Contains(D.DBColumnName)&&""!=r.J0.String(i[D.DBColumnName])&&(D.SelectedValue=parseInt(i[D.DBColumnName].toString()))})}GetPDCDocXML(s,i,e){let t={XMl:"",Ret:!1},n=new J.AddEditDocumentViewModel(s,"",!0),D=a.d.common.GetDataSet3("PDVM02",i.AccDocDetailsID,i.CostCenterID,a.d.SessionManager.LanguageID);n.GenratePrefix=!0,null!=D&&D.Tables.length>1&&D.Tables[1].length>0&&this.FillCC(n,D.Tables[0][0],D.Columns[0],D.Tables[1]);let d=n.GetEmptyRowPosition(n.ScreenObject.GridDataObj,"ProductID_Key"),C=n.ScreenObject.GridData[d];if(n.ScreenObject.GridDataColumns.Contains("ProductID_Key")){C.ProductID_Key=r.J0.String(e.ProductID),n.AddProductData(C,!1,!1);let u=null;var l,c=n.ScreenObject._numericFields.find(m=>m.DBColumnName.toLowerCase()==i.PDCAmtFld.toString().toLowerCase());null!=c&&c instanceof j.Dw?(u=this.PstDocGrid.Columns.find(m=>"Penalty"==m.DisplayMember),c.Text=r.J0.String(null!=u?i.Penalty:i.Amount)):null!=(l=n.ScreenObject.ColumnSource.find(m=>m.DisplayMember.toLowerCase()==i.PDCAmtFld.toString().toLowerCase()))?(u=this.PstDocGrid.Columns.find(m=>"Penalty"==m.DisplayMember),C[l.DisplayMember]=r.J0.String(null!=u?i.Penalty:i.Amount)):(t.Ret=!0,this.DisplayMessage="Inventory Document PDC Amount Field not Defined "+i.VoucherNo.toString(),this.MessageVisibility=!0),null!=(c=n.ScreenObject._numericFields.find(m=>m.DBColumnName.toLowerCase()==r.J0.String(i.PDCActionFld).toLowerCase()))&&c instanceof j.Dw?c.Text=i.Action.toString():null!=(l=n.ScreenObject.ColumnSource.find(I=>I.DisplayMember.toLowerCase()==r.J0.String(i.PDCActionFld).toLowerCase()))?C[l.DisplayMember]=i.Action:(t.Ret=!0,this.DisplayMessage="Inventory Document PDC Action Field not Defined "+r.J0.String(i.VoucherNo),this.MessageVisibility=!0),n.Celleditend(C,"Rate",0)}return this.PstDocGrid.TableColumns.Contains("AccountID_Key")&&!r.J0.IsEmpty(i.AccountID_Key)&&("19"==i.DocumentType.toString()?(null!=n.ScreenObject.DebitAccount?n.ScreenObject.DebitAccount.SelectedValue=parseInt(r.J0.String(i.AccountID_Key)):n.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&(n.ScreenObject.GridData[0].DebitAccount_Key=r.J0.String(i.AccountID_Key)),n.ScreenObject.OnGetReference(n.ScreenObject.DebitAccount.Name),null!=n.ScreenObject.CreditAccount?n.ScreenObject.CreditAccount.SelectedValue=parseInt(r.J0.String(e.AccountID)):n.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&(n.ScreenObject.GridData[0].CreditAccount_Key=r.J0.String(e.AccountID))):(null!=n.ScreenObject.CreditAccount?n.ScreenObject.CreditAccount.SelectedValue=parseInt(r.J0.String(i.AccountID_Key)):n.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&(n.ScreenObject.GridData[0].CreditAccount_Key=r.J0.String(i.AccountID_Key)),null!=n.ScreenObject.DebitAccount?n.ScreenObject.DebitAccount.SelectedValue=parseInt(e.AccountID):n.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&(n.ScreenObject.GridData[0].DebitAccount_Key=r.J0.String(e.AccountID)),n.ScreenObject.OnGetReference(n.ScreenObject.CreditAccount.Name))),n.CalculateTotals(C,!1),n.DisplayMessage="",n.isSaveXml=!0,n.SaveInventoryDocument("Save",!1),r.J0.IsEmpty(n.DisplayMessage)||(t.Ret=!0,this.DisplayMessage="PDC Amount Doc:"+n.DisplayMessage,this.MessageVisibility=!0),t.XMl=n.AutoPOstXML,t}GetDocXML(s,i){let e={Ret:!1},t=new J.AddEditDocumentViewModel(s,"",!0);var n=t.ScreenObject.ColumnSource.find(C=>null!=C.ValueMember&&"productid_key"==C.ValueMember.toLocaleLowerCase());let D;!r.J0.IsEmpty(n)&&null!=n.DefaultValue&&""!=n.DefaultValue&&null!=n.DefaultValueText||(D=parseInt(n.DefaultValue),e.Ret=!0,this.DisplayMessage="Bounce Doc:Define Default Product.",this.MessageVisibility=!0);let d=a.d.common.GetDataSet3("PDVM02",i.AccDocDetailsID,i.CostCenterID,a.d.SessionManager.LanguageID);return t.GenratePrefix=!0,null!=d&&d.Tables.length>1&&d.Tables[1].length>0&&this.FillCC(t,d.Tables[0][0],d.Columns[0],d.Tables[1]),t.ScreenObject.GridDataColumns.Contains("Rate")&&(t.ScreenObject.GridData[0].Rate=parseFloat(i.Penalty.toString()),t.FillDefaultProd(t.ScreenObject.GridData[0],"Rate"),t.Celleditend(t.ScreenObject.GridData[0],"Rate",0)),this.PstDocGrid.TableColumns.Contains("AccountID_Key")&&""!=i.AccountID_Key.toString()&&("19"==i.DocumentType.toString()?(null!=t.ScreenObject.DebitAccount?t.ScreenObject.DebitAccount.SelectedValue=parseInt(i.AccountID_Key.toString()):t.ScreenObject.GridDataColumns.Contains("DebitAccount_Key")&&(t.ScreenObject.GridData[0].DebitAccount_Key=i.AccountID_Key.toString()),t.ScreenObject.OnGetReference(t.ScreenObject.DebitAccount.Name)):(null!=t.ScreenObject.CreditAccount?t.ScreenObject.CreditAccount.SelectedValue=parseInt(i.AccountID_Key.toString()):t.ScreenObject.GridDataColumns.Contains("CreditAccount_Key")&&(t.ScreenObject.GridData[0].CreditAccount_Key=i.AccountID_Key.toString()),t.ScreenObject.OnGetReference(t.ScreenObject.CreditAccount.Name))),t.DisplayMessage="",t.isSaveXml=!0,t.SaveInventoryDocument("Save",!1),r.J0.IsEmpty(t.DisplayMessage)||(e.Ret=!0,this.DisplayMessage="Bounce Doc:"+t.DisplayMessage,this.MessageVisibility=!0),e.XMl=t.AutoPOstXML,e}LoadData(){this.ActionSummary="",Logger.InfoLog("PostedDocumentViewModel:: Inside LoadData");let s=0;this.ForeignCurrency.CheckBox.IsChecked&&(s=r.J0.IntTryParse(this.ForeignCurrency.ComboBox.SelectedValue));let i=[];i.push(this.FilterOn),i.push(this.SortOn),i.push(this.FromDate.ToString("dd/MMM/yyyy")),i.push(this.ToDate.ToString("dd/MMM/yyyy")),i.push(s),i.push(this.Locations),i.push(this.Divisions),i.push(this.Dimensions),i.push(this.BankID),i.push("1"==this.Status||"2"==this.Status?"429":this.Status),i.push(this.Filter),i.push(g.strSelect),i.push(g.strJoin),i.push(this.DocumentPicked);let e="";"1"==this.Status||"2"==this.Status?e=" and D.BillDate is not null and D.BillDate="+this.Status:"429"==this.Status&&(e=" and (D.BillDate is null or D.BillDate not in(1,2)) "),this.HoldDimFilter>0&&(e+=" and L.dcCCNID"+(parseInt(a.d.SessionManager.Preferences.PDCHoldDimension)-5e4)+"="+this.HoldDimFilter),this.TreeWhere.length>0&&(e+=this.TreeWhere),i.push(e);let t=a.d.document.GetPDCDocuments(i);this.LoadDashData(t),this.DateText=this.FromDate.ToString(a.d.SessionManager.Preferences["Date Format"])+"  -  "+this.ToDate.ToString(a.d.SessionManager.Preferences["Date Format"]),this.MessageVisibility=!1,Logger.InfoLog("PostedDocumentViewModel:: Exiting LoadData")}LoadDashData(s){let i=s.Tables[0];if(Logger.InfoLog("PostedDocumentViewModel:: Inside LoadDashData"),null!=i){s.Columns[0].Contains("Sno")||(s.Columns[0].push("Sno"),s.Columns[0].push("DocDateFormat"),s.Columns[0].push("DocDateFormat_Key"),s.Columns[0].push("MaturityDateFormat"),s.Columns[0].push("MaturityDateFormat_Key"),s.Columns[0].push("ChequeDateFormat"),s.Columns[0].push("ChequeDateFormat_Key"),s.Columns[0].push("HoldTill"),s.Columns[0].push("HoldTill_Key"),s.Columns[0].push("clrDate"),s.Columns[0].push("clrDate_Key"),s.Columns[0].push("Action"),s.Columns[0].push("Action_Key"),s.Columns[0].push("StatusForDisplay"),s.Columns[0].push("ConvertedDocNo"),s.Columns[0].push("ConvertedAccDocID"),s.Columns[0].Contains("InterMediateVoucherNO")||s.Columns[0].push("InterMediateVoucherNO"),s.Columns[0].Contains("InterMediateDocID")||s.Columns[0].push("InterMediateDocID"),s.Columns[0].push("AccIDs"),s.Columns[0].push("BankIDs"),s.Columns[0].push("GroupIDs"),s.Columns[0].Contains("ConvertedDocDate")||s.Columns[0].push("ConvertedDocDate"),s.Columns[0].Contains("InterMediateDocDate")||s.Columns[0].push("InterMediateDocDate"),s.Columns[0].Contains("BouncedDocDate")||s.Columns[0].push("BouncedDocDate"),s.Columns[0].push("ConvertdDocDate"),s.Columns[0].push("InterMediatDocDate"),s.Columns[0].push("BouncdDocDate"),s.Columns[0].push("ConvertdDocDate_Key"),s.Columns[0].push("InterMediatDocDate_Key"),s.Columns[0].push("BouncdDocDate_Key"),a.d.SessionManager.Preferences.ContainsKey("PostPenalty")&&"true"==a.d.SessionManager.Preferences.PostPenalty.toLowerCase()&&s.Columns[0].push("Penalty"),this.IsPDCHoldDimension&&!s.Columns[0].Contains("HoldDimension")&&(s.Columns[0].push("HoldDimension"),s.Columns[0].push("HoldDimension_Key"),s.Columns[0].push("HoldDate"),s.Columns[0].push("HoldDate_Key"),s.Columns[0].push("HoldRemarks")),a.d.SessionManager.Preferences.ContainsKey("Enablechequehold")&&(0,T.yG0)(a.d.SessionManager.Preferences.Enablechequehold)&&a.d.SessionManager.IsActionAssigned(4e4,"Hold")&&s.Columns[0].push("PDCHoldStatus"));for(let t=0;t<=i.length-1;t++){r.J0.IsEmpty(i[t].DocDate)||(i[t].DocDateFormat=a.d.SessionManager.Preferences.ContainsKey("Date Format")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences["Date Format"])?r.J0.ParseDate(i[t].DocDate.toString()).ToString(a.d.SessionManager.Preferences["Date Format"]):r.J0.ParseDate(i[t].DocDate.toString()).ToString("dd/MMM/yyyy")),i[t].DocDateFormat_Key=r.J0.ParseDate(i[t].DocDate),r.J0.IsEmpty(i[t].ChequeMaturityDate)||(i[t].MaturityDateFormat=a.d.SessionManager.Preferences.ContainsKey("Date Format")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences["Date Format"])?r.J0.ParseDate(i[t].ChequeMaturityDate.toString()).ToString(a.d.SessionManager.Preferences["Date Format"]):r.J0.ParseDate(i[t].ChequeMaturityDate.toString()).ToString("dd/MMM/yyyy")),i[t].MaturityDateFormat_Key=r.J0.ParseDate(i[t].ChequeMaturityDate),s.Columns[0].Contains("ChequeDate")&&!r.J0.IsEmpty(i[t].ChequeDate)&&(i[t].ChequeDateFormat=a.d.SessionManager.Preferences.ContainsKey("Date Format")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences["Date Format"])?r.J0.ParseDate(i[t].ChequeDate.toString()).ToString(a.d.SessionManager.Preferences["Date Format"]):r.J0.ParseDate(i[t].ChequeDate.toString()).ToString("dd/MMM/yyyy")),i[t].ChequeDateFormat_Key=r.J0.ParseDate(i[t].ChequeDate),s.Columns[0].Contains("HoldTillDate")&&!r.J0.IsEmpty(i[t].HoldTillDate)&&(i[t].HoldTill=a.d.SessionManager.Preferences.ContainsKey("Date Format")&&!r.J0.IsEmpty(a.d.SessionManager.Preferences["Date Format"])?r.J0.ParseDate(i[t].HoldTillDate.toString()).ToString(a.d.SessionManager.Preferences["Date Format"]):r.J0.ParseDate(i[t].HoldTillDate.toString()).ToString("dd/MMM/yyyy"),i[t].HoldTill_Key=r.J0.ParseDate(i[t].HoldTillDate)),this.IsPDCHoldDimension&&(s.Columns[0].Contains("HoldDate_Key")&&null!=i[t].HoldDate_Key&&(i[t].HoldDate=r.J0.ParseDate(i[t].HoldDate_Key).ToString(a.d.SessionManager.Preferences["Date Format"])),s.Columns[0].Contains("HoldDimension_Old")||s.Columns[0].push("HoldDimension_Old"),i[t].HoldDimension_Old=i[t].HoldDimension_Key),i[t].Sno=t+1,r.J0.IsEmpty(i[t].BillDate)||(i[t].clrDate_Key=this.PostonconversionDate?new Date:r.J0.ParseDate(i[t].BillDate)),"429"==i[t].StatusID.toString()&&(s.Columns[0].Contains("BillNo")&&"1"==i[t].BillNo.toString()?i[t].Status=a.d.GetResource("Replaced"):s.Columns[0].Contains("BillNo")&&"2"==i[t].BillNo.toString()&&(i[t].Status=a.d.GetResource("ReplacedPartial")));try{"PDC"==i[t].Status.toString()&&(this.PostonconversionDate?i[t].clrDate=a.d.SessionManager.Preferences.ContainsKey("Date Format")&&""!=a.d.SessionManager.Preferences["Date Format"]?(new Date).ToString(a.d.SessionManager.Preferences["Date Format"]):(new Date).ToString("dd/MMM/yyyy"):r.J0.IsEmpty(i[t].BillDate.toString())||(i[t].clrDate=a.d.SessionManager.Preferences.ContainsKey("Date Format")&&""!=a.d.SessionManager.Preferences["Date Format"]?r.J0.ParseDate(i[t].BillDate.toString()).ToString(a.d.SessionManager.Preferences["Date Format"]):r.J0.ParseDate(i[t].BillDate.toString()).ToString("dd/MMM/yyyy")))}catch(n){Logger.ErrorLog("PostedDocumentViewModel","LoadDashData",n.Message)}if("True"==i[t].IsNegative.toString()){let n=i[t].BankAccountID_Key.toString(),D=i[t].BankAccountID.toString();i[t].BankAccountID_Key=i[t].AccountID_Key.toString(),i[t].BankAccountID=i[t].AccountID.toString(),i[t].AccountID_Key=n,i[t].AccountID=D}s.Columns[0].Contains("DocumentType")&&!r.J0.IsEmpty(i[t].DocumentType)&&(16==parseInt(i[t].DocumentType.toString())||19==parseInt(i[t].DocumentType.toString())||14==parseInt(i[t].DocumentType.toString()))&&s.Columns[0].Contains("BankID")&&!r.J0.IsEmpty(i[t].BankID)&&parseInt(i[t].BankID.toString())>0&&(i[t].BankAccountID_Key=parseInt(i[t].BankID.toString()),i[t].BankAccountID=i[t].BankName.toString()),s.Columns[0].Contains("ConvertedVoucherNO")&&!r.J0.IsEmpty(i[t].ConvertedVoucherNO)?(i[t].ConvertedDocNo=i[t].ConvertedVoucherNO,r.J0.IsEmpty(i[t].ConvertedDocDate)||(i[t].ConvertdDocDate=r.J0.ParseDate(i[t].ConvertedDocDate.toString()).ToString(a.d.SessionManager.Preferences["Date Format"])),i[t].ConvertedDocDate_Key=r.J0.ParseDate(i[t].ConvertedDocDate)):i[t].ConvertdDocDate=null,i[t].ConvertedDocDate_Key=null,s.Columns[0].Contains("ConvertedDocID")&&!r.J0.IsEmpty(i[t].ConvertedDocID)&&(i[t].ConvertedAccDocID=i[t].ConvertedDocID),s.Columns[0].Contains("InterMediateVoucherNO")&&!r.J0.IsEmpty(i[t].InterMediateVoucherNO)?(i[t].InterMediateVoucherNO=i[t].InterMediateVoucherNO,r.J0.IsEmpty(i[t].InterMediateDocDate)||(i[t].InterMediateDocDate=r.J0.ParseDate(i[t].InterMediateDocDate.toString()).ToString(a.d.SessionManager.Preferences["Date Format"])),i[t].InterMediateDocDate_Key=r.J0.ParseDate(i[t].InterMediateDocDate)):(i[t].InterMediateDocDate=null,i[t].InterMediateDocDate_Key=null),s.Columns[0].Contains("BouncedDocDate")&&!r.J0.IsEmpty(i[t].BouncedDocDate)?(i[t].BouncedDocDate=r.J0.ParseDate(i[t].BouncedDocDate.toString()).ToString(a.d.SessionManager.Preferences["Date Format"]),i[t].BouncedDocDate_Key=r.J0.ParseDate(i[t].BouncedDocDate)):(i[t].BouncedDocDate=null,i[t].BouncedDocDate_Key=null),s.Columns[0].Contains("InterMediateDocID")&&!r.J0.IsEmpty(i[t].InterMediateDocID)&&(i[t].InterMediateDocID=i[t].InterMediateDocID),s.Columns[0].Contains("HoldStatus")&&s.Columns[0].Contains("PDCHoldStatus")&&!r.J0.IsEmpty(i[t].HoldStatus)&&s.Columns[0].Contains("ConvertedVoucherNO")&&r.J0.IsEmpty(i[t].ConvertedVoucherNO)&&"1"==i[t].HoldStatus.toString()&&(i[t].PDCHoldStatus="Hold")}let e=[];for(let t=0;t<i.length;t++)if(!e.Contains(i[t])){let c,n=0,D="",d="",C="";if(s.Columns[0].Contains("RefNodeID")&&(c=i.filter(l=>400==l.RefCCID&&l.RefNodeID==i[t].AccDocDetailsID),c.length>0)){D=d=C="";for(let l=0;l<c.length;l++)D+=c[l].AccDocDetailsID.toString()+",",C+=c[l].AccountID_Key.toString()+",",d+=c[l].BankAccountID_Key.toString()+",",e.push(c[l]);i[t].GroupIDs=D,i[t].AccIDs=C,i[t].BankIDs=d,c=i.filter(l=>l.AccDocDetailsID==i[t].AccDocDetailsID.toString()),c.length>1&&(i[t]!=c[1]&&"439"==c[1].StatusID.toString()?(i[t].StatusID=c[1].StatusID,i[t].Status=c[1].Status,e.push(c[1])):i[t]==c[1]&&"439"==c[0].StatusID.toString()&&(i[t].StatusID=c[0].StatusID,i[t].Status=c[0].Status,e.push(c[0])));continue}if(c=i.filter(l=>l.ChequeNumber==r.J0.StringValue(i[t].ChequeNumber).toString().replace("'","''")&&l.VoucherNo==r.J0.StringValue(i[t].VoucherNo).toString()&&l.BankAccountID_Key==r.J0.StringValue(i[t].BankAccountID_Key).toString()),c.length>1){let l=new Array;l.push(parseInt(r.J0.String(c[0].AccountID_Key)));for(let u=1;u<c.length;u++)r.J0.IsEmpty(c[u].Amount)||("True"==c[u].IsNegative.toString()?n-=parseFloat(c[u].Amount.toString()):n+=parseFloat(c[u].Amount.toString())),D+=c[u].AccDocDetailsID.toString()+",",C+=c[u].AccountID_Key.toString()+",",l.Contains(parseInt(c[u].AccountID_Key.toString()))||(d+=c[u].AccountID.toString()+","),l.push(parseInt(c[u].AccountID_Key.toString())),e.push(c[u]);c[0].GroupIDs=D,c[0].AccIDs=C,c[0].Amount=r.J0.IsEmpty(c[0].Amount)?n:parseFloat(c[0].Amount.toString())+n,c[0].AccountID=c[0].AccountID.toString()+d}}for(let t=0;t<e.length;t++)i.Remove(e[t]);this.PstDocGrid.Clear(),this.PstDocGrid.Table=i,this.PstDocGrid.TableColumns=s.Columns[0],this.PstDocGrid.setRowid(),this.PstDocGrid.angularGrid.dataView.setFilterArgs({}),this.PstDocGrid.UpdateTotals()}Logger.InfoLog("PostedDocumentViewModel:: Exiting LoadDashData")}ButtonSave(s){if(Logger.InfoLog("PostedDocumentViewModel:: Inside ButtonSave sender ="+s.toString()),this.DisplayMessage="","Save"==s){this.PstDocGrid.angularGrid?.slickGrid&&this.PstDocGrid.angularGrid?.slickGrid.getActiveCellNode()&&this.PstDocGrid.angularGrid.slickGrid.getEditorLock().commitCurrentEdit();let i=null;a.d.SessionManager.Preferences.ContainsKey("PDCBounceResonDim")&&""!=a.d.SessionManager.Preferences.PDCBounceResonDim&&parseInt(a.d.SessionManager.Preferences.PDCBounceResonDim)>5e4&&(i=this.PstDocGrid.Columns.find(l=>l.CostCenterID==parseInt(a.d.SessionManager.Preferences.PDCBounceResonDim)));let e=!1,t=null,n=null;a.d.SessionManager.Preferences.ContainsKey("DefaultPostOnPenaltyDocument")&&(0,T.yG0)(a.d.SessionManager.Preferences.DefaultPostOnPenaltyDocument)&&(e=!0,t=a.d.common.GetDataSet("PDVM03",""));let D="",d="",C=0,c=0;for(let l=0;l<=this.PstDocGrid.Table.length-1;l++)if(C=0,c=0,""!=r.J0.StringValue(this.PstDocGrid.Table[l].Action).toString()&&"100"!=this.PstDocGrid.Table[l].Action.toString()){let u,m;if("1"==this.PstDocGrid.Table[l].Action.toString()&&this.PstDocGrid.TableColumns.Contains("HoldDate_Key")&&!r.J0.IsEmpty(this.PstDocGrid.Table[l].HoldDate_Key)&&r.J0.isValidDate(r.J0.String(this.PstDocGrid.Table[l].HoldDate_Key))&&!r.J0.IsEmpty(this.PstDocGrid.Table[l].clrDate_Key)&&r.J0.isValidDate(r.J0.String(this.PstDocGrid.Table[l].clrDate_Key))&&r.J0.ParseDate(r.J0.String(this.PstDocGrid.Table[l].clrDate_Key))<r.J0.ParseDate(r.J0.String(this.PstDocGrid.Table[l].HoldDate_Key)))return m=this.PstDocGrid.Table[l].HoldDate_Key.toString(),m=this.PstDocGrid.Table[l].clrDate_Key.toString(),this.Setselectedrow(l),this.DisplayMessage="Converted date can not be less than hold date at row no:"+this.PstDocGrid.Table[l].Sno.toString(),void(this.MessageVisibility=!0);if(r.J0.isValidDate(r.J0.String(this.PstDocGrid.Table[l].clrDate_Key))&&r.J0.ParseDate(r.J0.String(this.PstDocGrid.Table[l].clrDate_Key))<a.d.SessionManager.AccountingDate)return this.Setselectedrow(l),this.DisplayMessage="Converted date can not be less than Accounting Date at row no:"+this.PstDocGrid.Table[l].Sno.toString(),void(this.MessageVisibility=!0);if(u=a.d.SessionManager.Preferences.ContainsKey("Lock Data Between"),"1"!=a.d.SessionManager.RoleID&&a.d.SessionManager.Preferences.ContainsKey("Lock Data Between")&&u&&(0,T.yG0)(a.d.SessionManager.Preferences["Lock Data Between"])&&r.J0.isValidDate(r.J0.String(this.PstDocGrid.Table[l].clrDate_Key))&&(m=r.J0.ParseDate(r.J0.String(this.PstDocGrid.Table[l].clrDate_Key)),m>=r.J0.ParseDate(a.d.SessionManager.Preferences.LockDataFromDate)&&m<=r.J0.ParseDate(a.d.SessionManager.Preferences.LockDataToDate)))return this.DisplayMessage="Document Date Locked",void(this.MessageVisibility=!0);if(a.d.SessionManager.Preferences.ContainsKey("DonotAllowMaturityDatebeforeDocumentDate")&&(0,T.yG0)(a.d.SessionManager.Preferences.DonotAllowMaturityDatebeforeDocumentDate)&&"2"!=this.PstDocGrid.Table[l].Action.toString()&&u&&!r.J0.IsEmpty(this.PstDocGrid.Table[l].clrDate_Key)){if(m=r.J0.ParseDate(r.J0.String(this.PstDocGrid.Table[l].clrDate_Key)),""!=this.PstDocGrid.Table[l].DocDate.toString()&&m<r.J0.ParseDate(this.PstDocGrid.Table[l].DocDate.toString()))return this.Setselectedrow(l),this.DisplayMessage="Converted date can not be less than Document Date at row no:"+this.PstDocGrid.Table[l].Sno.toString(),void(this.MessageVisibility=!0);if(""!=this.PstDocGrid.Table[l].ChequeMaturityDate.toString()&&("1"==this.PstDocGrid.Table[l].Action.toString()||"0"==this.PstDocGrid.Table[l].Action.toString())&&m<r.J0.ParseDate(this.PstDocGrid.Table[l].ChequeMaturityDate.toString()))return this.Setselectedrow(l),this.DisplayMessage="Converted date can not be less than Maturity Date at row no:"+this.PstDocGrid.Table[l].Sno.toString(),void(this.MessageVisibility=!0)}if(a.d.SessionManager.Preferences.ContainsKey("Enablechequehold")&&(0,T.yG0)(a.d.SessionManager.Preferences.Enablechequehold)&&"6"==r.J0.String(this.PstDocGrid.Table[l].Action)&&!r.J0.IsEmpty(this.PstDocGrid.Table[l].ChequeMaturityDate)&&!r.J0.IsEmpty(this.PstDocGrid.Table[l].clrDate_Key)){let I=r.J0.GetDateDifference(r.J0.ParseDate(this.PstDocGrid.Table[l].clrDate_Key),r.J0.ParseDate(this.PstDocGrid.Table[l].ChequeMaturityDate)),y=0;if(a.d.SessionManager.Preferences.ContainsKey("maxchequeholddays")&&r.J0.Int(a.d.SessionManager.Preferences.maxchequeholddays)>0&&I>y)return this.Setselectedrow(l),this.DisplayMessage="Hold till can not be more than '"+r.J0.ParseDate(this.PstDocGrid.Table[l].ChequeMaturityDate.toString()).AddDays(y).ToString(a.d.SessionManager.Preferences["Date Format"])+"' at row no:"+this.PstDocGrid.Table[l].Sno.toString(),void(this.MessageVisibility=!0);if(null==n||!n.ContainsKey(parseInt(this.PstDocGrid.Table[l].CostCenterID.toString()))){let b=a.d.common.GetDataSet3("PDVM04",r.J0.String(this.PstDocGrid.Table[l].CostCenterID),a.d.SessionManager.UserID,a.d.SessionManager.RoleID);null!=b&&b.Tables.length>0&&b.Tables[0].length>0&&(null==n&&(n=new E.bT),n.push(parseInt(this.PstDocGrid.Table[l].CostCenterID.toString()),b.Tables[0][0]))}if(null!=n&&n.ContainsKey(parseInt(this.PstDocGrid.Table[l].CostCenterID.toString()))){let b=n[parseInt(this.PstDocGrid.Table[l].CostCenterID.toString())];if(r.J0.IsEmpty(b.Expression))C=parseInt(b.WorkFlowID.toString()),c=parseInt(b.LevelID.toString());else{let P=new E.bT,G=new w.Nl;G.setFieldDetails("Holddays",1,1,"",0,!1,!1),P.push("Holddays",G),G.setFieldValue(I);let A=P,F=a.d.eval.EvaluateExpression(b.Expression.toString(),A).toString();null!=F&&"1"==F.toString()&&(C=parseInt(b.WorkFlowID.toString()),c=parseInt(b.LevelID.toString()))}}}if(""!=r.J0.StringValue(this.PstDocGrid.Table[l].BankIDs).toString()){let I=this.PstDocGrid.Table[l].GroupIDs.toString().split(","),y=this.PstDocGrid.Table[l].AccIDs.toString().split(","),b=this.PstDocGrid.Table[l].BankIDs.toString().split(",");for(let P=0;P<I.length-1;P++)D+='<Row ID="'+I[P]+'" ',D+=' StatusID="369" ',"4"==this.PstDocGrid.Table[l].Action.toString()?D+='ACTION="0"  IsReplace="1" ':"5"==this.PstDocGrid.Table[l].Action.toString()?D+='ACTION="0"  IsReplace="2" ':D+='ACTION="'+this.PstDocGrid.Table[l].Action.toString()+'" ',""!=r.J0.StringValue(this.PstDocGrid.Table[l].clrDate_Key).toString()&&(D+='PostedDate="'+r.J0.ParseDate(r.J0.String(this.PstDocGrid.Table[l].clrDate_Key)).ToString("dd/MMM/yyyy")+'" '),D+='CostCenterID="'+this.PstDocGrid.Table[l].CostCenterID.toString()+'" ',D+='VoucherNo="'+this.PstDocGrid.Table[l].VoucherNo.toString()+'" ',"19"==r.J0.StringValue(this.PstDocGrid.Table[l].DocumentType).toString()||"16"==r.J0.StringValue(this.PstDocGrid.Table[l].DocumentType).toString()?"1"==this.PstDocGrid.Table[l].Action.toString()?(D+='CreditAccountID="'+y[P]+'" ',D+='DebitAccountID="'+b[P]+'" '):(D+='CreditAccountID="'+b[P]+'" ',D+='DebitAccountID="'+y[P]+'" '):"1"==this.PstDocGrid.Table[l].Action.toString()?(D+='CreditAccountID="'+b[P]+'" ',D+='DebitAccountID="'+y[P]+'" '):(D+='DebitAccountID="'+b[P]+'" ',D+='CreditAccountID="'+y[P]+'" '),D+='ACTUAL="'+y[P]+'" ',D+="/>";continue}if(D+='<Row ID="'+this.PstDocGrid.Table[l].AccDocDetailsID.toString()+'" ',D+=' StatusID="369" ',C>0&&(D+=' WID="'+C+'" '),c>0&&(D+=' WLvl="'+c+'" '),"4"==this.PstDocGrid.Table[l].Action.toString()?D+='ACTION="0"  IsReplace="1" ':"5"==this.PstDocGrid.Table[l].Action.toString()?D+='ACTION="0"  IsReplace="2" ':D+='ACTION="'+this.PstDocGrid.Table[l].Action.toString()+'" ',""!=r.J0.StringValue(this.PstDocGrid.Table[l].clrDate_Key).toString()&&(D+='PostedDate="'+r.J0.ParseDate(this.PstDocGrid.Table[l].clrDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),D+='CostCenterID="'+this.PstDocGrid.Table[l].CostCenterID.toString()+'" ',D+='VoucherNo="'+this.PstDocGrid.Table[l].VoucherNo.toString()+'" ',"19"==r.J0.StringValue(this.PstDocGrid.Table[l].DocumentType).toString()?"1"==this.PstDocGrid.Table[l].Action.toString()?(D+='CreditAccountID="'+this.PstDocGrid.Table[l].AccountID_Key.toString()+'" ',D+='DebitAccountID="'+this.PstDocGrid.Table[l].BankAccountID_Key.toString()+'" '):(D+='CreditAccountID="'+this.PstDocGrid.Table[l].BankAccountID_Key.toString()+'" ',D+='DebitAccountID="'+this.PstDocGrid.Table[l].AccountID_Key.toString()+'" ',this.PstDocGrid.TableColumns.Contains("Penalty")&&!r.J0.IsEmpty(this.PstDocGrid.Table[l].Penalty)&&parseFloat(this.PstDocGrid.Table[l].Penalty.toString())>0&&(this.PstDocGrid.TableColumns.Contains("BounceInvDoc")&&!r.J0.IsEmpty(this.PstDocGrid.Table[l].BounceInvDoc)&&parseFloat(this.PstDocGrid.Table[l].BounceInvDoc.toString())>0||(D+='Penalty="'+this.PstDocGrid.Table[l].Penalty.toString()+'" '))):"1"==this.PstDocGrid.Table[l].Action.toString()?(D+='CreditAccountID="'+this.PstDocGrid.Table[l].BankAccountID_Key.toString()+'" ',D+='DebitAccountID="'+this.PstDocGrid.Table[l].AccountID_Key.toString()+'" '):(D+='DebitAccountID="'+this.PstDocGrid.Table[l].BankAccountID_Key.toString()+'" ',D+='CreditAccountID="'+this.PstDocGrid.Table[l].AccountID_Key.toString()+'" ',this.PstDocGrid.TableColumns.Contains("Penalty")&&!r.J0.IsEmpty(this.PstDocGrid.Table[l].Penalty)&&parseFloat(this.PstDocGrid.Table[l].Penalty.toString())>0&&(this.PstDocGrid.TableColumns.Contains("BounceInvDoc")&&!r.J0.IsEmpty(this.PstDocGrid.Table[l].BounceInvDoc)&&parseInt(this.PstDocGrid.Table[l].BounceInvDoc.toString())>0||(D+='Penalty="'+this.PstDocGrid.Table[l].Penalty.toString()+'" '))),D+='ACTUAL="'+this.PstDocGrid.Table[l].ActDr.toString()+'" ',null!=i&&!r.J0.IsEmpty(this.PstDocGrid.Table[l][i.ValueMember])&&(D+=' BRDim="dcCCNID'+(i.CostCenterID-5e4)+"="+this.PstDocGrid.Table[l][i.ValueMember].toString()+'" '),this.IsPDCHoldDimension&&this.PstDocGrid.TableColumns.Contains("HoldDimension_Key")&&null!=this.PstDocGrid.Table[l].HoldDimension_Key&&1!=parseInt(this.PstDocGrid.Table[l].HoldDimension_Key)&&(D+='IsHold="1" '),D+=">",e&&null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&("0"==r.J0.String(this.PstDocGrid.Table[l].Action)||"4"==r.J0.String(this.PstDocGrid.Table[l].Action)||"5"==r.J0.String(this.PstDocGrid.Table[l].Action))){let I=t.Tables[0].filter(y=>y.TypeID==r.J0.String(this.PstDocGrid.Table[l].Action));if(I.length>0){if(t.Columns[0].Contains("AccountID")&&t.Columns[0].Contains("ProductID")){if(r.J0.IsEmpty(I[0].AccountID)||0==parseInt(I[0].AccountID))return this.DisplayMessage=I[0].Type+" Account Not Mapped Correctly Please Check",void(this.MessageVisibility=!0);if(r.J0.IsEmpty(I[0].ProductID)&&0==parseInt(I[0].ProductID))return this.DisplayMessage=I[0].Type+" Product Not Mapped Correctly Please Check",void(this.MessageVisibility=!0)}let y;if(y=this.GetPDCDocXML(parseInt(this.PstDocGrid.Table[l].BounceInvDoc.toString()),this.PstDocGrid.Table[l],I[0]),y.Ret)return;D+=y.XMl}}else if("0"==r.J0.String(this.PstDocGrid.Table[l].Action)&&this.PstDocGrid.TableColumns.Contains("Penalty")&&!r.J0.IsEmpty(this.PstDocGrid.Table[l].Penalty)&&parseFloat(this.PstDocGrid.Table[l].Penalty.toString())>0&&this.PstDocGrid.TableColumns.Contains("BounceInvDoc")&&!r.J0.IsEmpty(this.PstDocGrid.Table[l].BounceInvDoc)){let I;if(I=this.GetDocXML(parseInt(this.PstDocGrid.Table[l].BounceInvDoc.toString()),this.PstDocGrid.Table[l]),I.Ret)return;D+=I.XMl}if(D+="</Row>",""!=r.J0.StringValue(this.PstDocGrid.Table[l].GroupIDs).toString()){let I=this.PstDocGrid.Table[l].GroupIDs.toString().split(","),y=this.PstDocGrid.Table[l].AccIDs.toString().split(",");for(let b=0;b<I.length-1;b++)D+='<Row ID="'+I[b]+'" ',D+=' StatusID="369" ',"4"==this.PstDocGrid.Table[l].Action.toString()?D+='ACTION="0"  IsReplace="1" ':"5"==this.PstDocGrid.Table[l].Action.toString()?D+='ACTION="0"  IsReplace="2" ':D+='ACTION="'+this.PstDocGrid.Table[l].Action.toString()+'" ',r.J0.IsEmpty(this.PstDocGrid.Table[l].clrDate_Key)||(D+='PostedDate="'+r.J0.ParseDate(this.PstDocGrid.Table[l].clrDate_Key.toString()).ToString("dd/MMM/yyyy")+'" '),D+='CostCenterID="'+this.PstDocGrid.Table[l].CostCenterID.toString()+'" ',D+='VoucherNo="'+this.PstDocGrid.Table[l].VoucherNo.toString()+'" ',"19"==r.J0.StringValue(this.PstDocGrid.Table[l].DocumentType).toString()?"1"==this.PstDocGrid.Table[l].Action.toString()?(D+='CreditAccountID="'+y[b]+'" ',D+='DebitAccountID="'+this.PstDocGrid.Table[l].BankAccountID_Key.toString()+'" '):(D+='CreditAccountID="'+this.PstDocGrid.Table[l].BankAccountID_Key.toString()+'" ',D+='DebitAccountID="'+y[b]+'" '):"1"==this.PstDocGrid.Table[l].Action.toString()?(D+='CreditAccountID="'+this.PstDocGrid.Table[l].BankAccountID_Key.toString()+'" ',D+='DebitAccountID="'+y[b]+'" '):(D+='DebitAccountID="'+this.PstDocGrid.Table[l].BankAccountID_Key.toString()+'" ',D+='CreditAccountID="'+y[b]+'" '),D+='ACTUAL="'+y[b]+'" ',D+=' Dupl="'+this.PstDocGrid.Table[l].AccDocDetailsID.toString()+'" ',this.IsPDCHoldDimension&&this.PstDocGrid.TableColumns.Contains("HoldDimension_Key")&&null!=this.PstDocGrid.Table[l].HoldDimension_Key&&1!=parseInt(this.PstDocGrid.Table[l].HoldDimension_Key)&&(D+='IsHold="1" '),D+="/>"}}else this.IsPDCHoldDimension&&this.PstDocGrid.TableColumns.Contains("HoldDimension_Key")&&null!=this.PstDocGrid.Table[l].HoldDimension_Key&&(1!=parseInt(this.PstDocGrid.Table[l].HoldDimension_Key)||parseInt(this.PstDocGrid.Table[l].HoldDimension_Old)!=parseInt(this.PstDocGrid.Table[l].HoldDimension_Key))&&(d+='<Row ID="'+this.PstDocGrid.Table[l].AccDocDetailsID.toString()+'" ',d+='HoldDimension="'+this.PstDocGrid.Table[l].HoldDimension_Key.toString()+'" ',1!=parseInt(this.PstDocGrid.Table[l].HoldDimension_Key)&&(this.PstDocGrid.TableColumns.Contains("HoldDate_Key")&&null!=this.PstDocGrid.Table[l].HoldDate_Key&&(d+='HoldDate="'+r.J0.ParseDate(this.PstDocGrid.Table[l].HoldDate_Key).ToString("dd-MMM-yyyy")+'" '),this.PstDocGrid.TableColumns.Contains("HoldRemarks")&&(d+='HoldRemarks="'+this.PstDocGrid.Table[l].HoldRemarks.toString()+'" ')),d+="/>");if(D.length>0||d.length>0){D="<XML>"+D,D+="</XML>",d.length>0&&(d="<XML>"+d,d+="</XML>");let l=a.d.document.SetPostDocuments(D.toString(),d.toString(),this.PostonconversionDate,this.ScreenObject.LockWhere);null!=l&&l.Tables.length>0&&l.Tables[l.Tables.length-1].length>0&&l.Columns[l.Tables.length-1].Contains("ErrorMessage")&&(this.DisplayMessage=l.Tables[l.Tables.length-1][0].ErrorMessage.toString(),l.Tables.length>2&&l.Tables[l.Tables.length-2].length>0&&(this.DisplayMessage=this.DisplayMessage+" :: ",l.Tables[l.Tables.length-2].forEach(u=>{this.DisplayMessage=this.DisplayMessage+u.VoucherNo.toString()+","}),this.DisplayMessage=this.DisplayMessage.TrimEnd(",")+" Documents Locked"),l.Tables.length>=3&&l.Tables[l.Tables.length-3].forEach(u=>{if(l.Columns[l.Tables.length-3].Contains("AccDocDetailsID")){let m=this.PstDocGrid.Table.filter(I=>I.AccDocDetailsID==u.AccDocDetailsID);m.length>0&&(m[0].ConvertedDocNo=r.J0.String(u.VoucherNo),m[0].ConvertedAccDocID=r.J0.String(u.ConvertedAccDocID),m[0].InterMediateVoucherNO=r.J0.String(u.InterMediateVoucherNO),m[0].InterMediateDocID=r.J0.String(u.InterMediateDocID),m[0].Action="",m[0].clrDate="",m[0].StatusID=u.StatusID,l.Columns[l.Tables.length-3].Contains("IsReplace")&&!r.J0.IsEmpty(u.IsReplace)?"1"==r.J0.String(u.IsReplace)?m[0].Status=a.d.GetResource("Replaced"):"2"==u.IsReplace.toString()&&(m[0].Status=a.d.GetResource("ReplacedPartial")):m[0].Status=r.J0.String(u.ConvertedStatus),this.PstDocGrid.updateRow(m[0]))}})),this.MessageVisibility=!0}}else if("Refresh"==s)if(null!=this.PDCDialog)this.PDCDialog.MessageVisibility=!1,a.d.page.ShowDialog(this.PDCDialog,O);else{let i=new v;i.PostedDocumentDialogViewModel_1(this),a.d.page.ShowDialog(i,O)}else{if("ViewFilter"==r.J0.StringValue(s))return this.ViewFilterVisibility=!0,this.ViewFilterDetails||(this.ViewFilterDetails=new Z.q),void this.ViewFilterDetails.ViewFilterViewModel2(this.ActFiltercol,this);if("Customize"!=s&&"CustomizePrint"!=s&&"Export"==s){this.MessageVisibility=!0,this.DisplayMessage="Exporting data please wait...";let i=this.GetExportHTML();const e=new Blob([i],{type:"text/plain;charser=utf-8"});q.saveAs(e,this.DisplayName+"_XlsExport_"+(new Date).getTime()+".xls")}}Logger.InfoLog("PostedDocumentViewModel:: exiting ButtonSave sender ="+s.toString())}Setselectedrow(s){this.PstDocGrid.SelectedItem=this.PstDocGrid.Table[s]}selectConvert(s){if(Logger.InfoLog("PostedDocumentViewModel:: inside selectConvert "),s)for(let i=0;i<=this.PstDocGrid.Table.length-1;i++)!r.J0.IsEmpty(this.PstDocGrid.Table[i].StatusID)&&370==parseInt(this.PstDocGrid.Table[i].StatusID.toString())&&!r.J0.IsEmpty(this.PstDocGrid.Table[i].ChequeMaturityDate)&&r.J0.ParseDate(this.PstDocGrid.Table[i].ChequeMaturityDate.toString()).Date==(new Date).Date&&(this.PstDocGrid.Table[i].Action=this.SelectMaturityDate?"1":"");else for(let i=0;i<=this.PstDocGrid.Table.length-1;i++)!r.J0.IsEmpty(this.PstDocGrid.Table[i].StatusID)&&370==parseInt(this.PstDocGrid.Table[i].StatusID.toString())&&!r.J0.IsEmpty(this.PstDocGrid.Table[i].ChequeMaturityDate)&&r.J0.ParseDate(this.PstDocGrid.Table[i].ChequeMaturityDate.toString()).Date<=(new Date).Date&&(this.PstDocGrid.Table[i].Action=this.SelectLessThanMaturityDate?"1":"");Logger.InfoLog("PostedDocumentViewModel:: exiting selectConvert ")}GetExportHTML(){Logger.InfoLog("PostedDocumentViewModel:: inside GetExportHTML ");let s="",i="";s+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",i+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",i+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",i+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",i+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",s+="<style>"+i.toString()+"</style>";let n,t=0;for(let D=0;D<this.PstDocGrid.Columns.length;D++)t+=this.PstDocGrid.Columns[D].Width;s+="<table>",s+="\r\n<tr><td align='center'><h2>",s+=a.d.SessionManager.CompanyName,s+="</h2></td></tr>",s+="\r\n<tr><td align='center'><h3 style='vertical-align:middl;'>",s+=this.DisplayName,s+="</h3></td></tr>",s+="\r\n<tr><td align='center'>",s+=" From :  "+this.FromDate.ToString(a.d.SessionManager.Preferences["Date Format"]),s+=" &nbs;&nbsp;&nbsp;To :  "+this.ToDate.ToString(a.d.SessionManager.Preferences["Date Format"]),s+="</td></tr>",s+="<tr><td style='padding-top:10p;'><table border=1 width='"+t+"' style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",s+="<COLGROUP>";for(let D=0;D<this.PstDocGrid.Columns.length;D++)r.J0.IsEmpty(this.PstDocGrid.Columns[D].DataType)||"FLOAT"!=this.PstDocGrid.Columns[D].DataType?s+="<COL style=''>":s+="<COL style='text-align:righ;'>";s+="</COLGROUP>",s+="<tr style=''>";for(let D=0;D<this.PstDocGrid.Columns.length;D++)s+="<th class='hdr' width='"+this.PstDocGrid.Columns[D].Width,s+="' >",s+=this.PstDocGrid.Columns[D].Header,s+="</th>";s+="</tr>";for(let D=0;D<this.PstDocGrid.Table.length;D++){s+="<tr",D%2==1&&(s+=" class=alt"),s+=">";for(let d=0;d<this.PstDocGrid.Columns.length;d++)s+="<td",r.J0.IsEmpty(this.PstDocGrid.Columns[d].DataType)||"FLOAT"!=this.PstDocGrid.Columns[d].DataType?s+=" align='left'":s+=" align='right'",s+=">",n=r.J0.IsEmpty(this.PstDocGrid.Columns[d].DataType)||"PactComboBox"!==this.PstDocGrid.Columns[d].DataType?this.PstDocGrid.Columns[d].DisplayMember:this.PstDocGrid.Columns[d].ValueBinding+"_Key",this.PstDocGrid.TableColumns.Contains(n)&&("ChequeNumber"==n&&!r.J0.IsEmpty(this.PstDocGrid.Table[D][n])&&this.PstDocGrid.Table[D][n].toString().startsWith("0")?s+="'"+this.PstDocGrid.Table[D][n].toString():s+=r.J0.String(this.PstDocGrid.Table[D][n])),s+="</td>";s+="</tr>"}return s+="</table>",s+="</td></tr></table>",s+="</body><html>",Logger.InfoLog("PostedDocumentViewModel:: exiting GetExportHTML "),s}ViewFilterData(s,i){if("ClearFilter"==s||"CancelFilter"==s)"CancelFilter"==s&&(this.ViewFilterVisibility=!1),this.LoadData();else{let e=this.PstDocGrid.Table;e=this.FilterCCData(e,i),this.PstDocGrid.Table=e,this.PstDocGrid.UpdateTotals()}}FilterCCData(s,i){for(let e=0;e<i.length;e++){let t=i[e];if("None"!=t.Condition.SelectedValue)if("DATE"==t.DataType||"DATESORT"==t.DataType)switch(t.Condition.SelectedItem.Parent){case" BETWEEN ":s=s.filter(n=>+n[t.ColumnName].ToServerDate()>=+t.FromDate.Date.OnlyDate()&&+n[t.ColumnName].ToServerDate()<=+t.ToDate.Date.OnlyDate());break;case" NOT BETWEEN ":s=s.filter(n=>n[t.ColumnName].ToServerDate()<+t.FromDate.Date.OnlyDate()&&n[t.ColumnName].ToServerDate()>t.ToDate.Date.OnlyDate());break;case"=":s=s.filter(n=>+n[t.ColumnName].ToServerDate()==+t.FromDate.Date.OnlyDate());break;case"<>":s=s.filter(n=>+n[t.ColumnName].ToServerDate()!=+t.FromDate.Date.OnlyDate());break;case"<":s=s.filter(n=>n[t.ColumnName].ToServerDate()<t.FromDate.Date.OnlyDate());break;case"<=":s=s.filter(n=>+n[t.ColumnName].ToServerDate()<=+t.FromDate.Date.OnlyDate());break;case">":s=s.filter(n=>n[t.ColumnName].ToServerDate()>t.FromDate.Date.OnlyDate());break;case">=":s=s.filter(n=>+n[t.ColumnName].ToServerDate()>=+t.FromDate.Date.OnlyDate())}else if(t.FromDropDown.Visible){if(!t.FromDropDown.Items[0].IsChecked){let n=[];t.FromDropDown.Items.forEach(D=>{D.IsChecked&&((""==D.Name||"[NULL]"==D.Name)&&n.push(null),n.push(D.Name))}),s=0==n.length?[]:s.filter("Equal"==t.Condition.SelectedValue?D=>n.Contains(D[t.ColumnName].toString()):D=>!n.Contains(D[t.ColumnName].toString()))}}else switch(t.Condition.SelectedItem.Parent){case" BETWEEN ":s=s.filter("FLOAT"==t.DataType?n=>parseFloat(n[t.ColumnName])>=parseFloat(t.FromValue.TextBox.Text)&&parseFloat(n[t.ColumnName])<=parseFloat(t.ToValue.Text):"INT"==t.DataType?n=>parseInt(n[t.ColumnName])>=parseInt(t.FromValue.TextBox.Text)&&parseInt(n[t.ColumnName])<=parseInt(t.ToValue.Text):n=>n[t.ColumnName]>=t.FromValue.TextBox.Text&&n[t.ColumnName]<=t.ToValue.Text);break;case" NOT BETWEEN ":s=s.filter("FLOAT"==t.DataType?n=>parseFloat(n[t.ColumnName])<parseFloat(t.FromValue.TextBox.Text)||parseFloat(n[t.ColumnName])>parseFloat(t.ToValue.Text):"INT"==t.DataType?n=>parseInt(n[t.ColumnName])<parseInt(t.FromValue.TextBox.Text)||parseInt(n[t.ColumnName])>parseInt(t.ToValue.Text):n=>n[t.ColumnName]<t.FromValue.TextBox.Text||n[t.ColumnName]>t.ToValue.Text);break;case" LIKE ":s=s.filter(n=>!r.J0.IsEmpty(n[t.ColumnName])&&-1!=n[t.ColumnName].toLowerCase().indexOf(t.FromValue.TextBox.Text.toLowerCase()));break;case" NOT LIKE ":s=s.filter(n=>!r.J0.IsEmpty(n[t.ColumnName])&&-1==n[t.ColumnName].toLowerCase().indexOf(t.FromValue.TextBox.Text.toLowerCase()));break;case"BeginsWith":s=s.filter(n=>!r.J0.IsEmpty(n[t.ColumnName])&&n[t.ColumnName].toLowerCase().startsWith(t.FromValue.TextBox.Text.toLowerCase()));break;case"EndsWith":s=s.filter(n=>!r.J0.IsEmpty(n[t.ColumnName])&&n[t.ColumnName].toLowerCase().endsWith(t.FromValue.TextBox.Text.toLowerCase()));break;case"=":s=s.filter("FLOAT"==t.DataType?n=>n[t.ColumnName]==parseFloat(t.FromValue.TextBox.Text):"INT"==t.DataType?n=>n[t.ColumnName]==parseInt(t.FromValue.TextBox.Text):n=>n[t.ColumnName]==t.FromValue.TextBox.Text);break;case"<>":s=s.filter("FLOAT"==t.DataType?n=>n[t.ColumnName]!=parseFloat(t.FromValue.TextBox.Text):"INT"==t.DataType?n=>n[t.ColumnName]!=parseInt(t.FromValue.TextBox.Text):n=>n[t.ColumnName]!=t.FromValue.TextBox.Text);break;case"<":"FLOAT"==t.DataType?s=s.filter(n=>n[t.ColumnName]<parseFloat(t.FromValue.TextBox.Text)):"INT"==t.DataType&&(s=s.filter(n=>n[t.ColumnName]<parseInt(t.FromValue.TextBox.Text)));break;case"<=":"FLOAT"==t.DataType?s=s.filter(n=>n[t.ColumnName]<=parseFloat(t.FromValue.TextBox.Text)):"INT"==t.DataType&&(s=s.filter(n=>n[t.ColumnName]<=parseInt(t.FromValue.TextBox.Text)));break;case">":"FLOAT"==t.DataType?s=s.filter(n=>n[t.ColumnName]>parseFloat(t.FromValue.TextBox.Text)):"INT"==t.DataType&&(s=s.filter(n=>n[t.ColumnName]>parseInt(t.FromValue.TextBox.Text)));break;case">=":"FLOAT"==t.DataType?s=s.filter(n=>n[t.ColumnName]>=parseFloat(t.FromValue.TextBox.Text)):"INT"==t.DataType&&(s=s.filter(n=>n[t.ColumnName]>=parseInt(t.FromValue.TextBox.Text)))}}return s}}return g})()}}]);