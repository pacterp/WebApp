"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[5001],{59763:(m,D,a)=>{a.r(D),a.d(D,{ReversBiddingViewModel:()=>P});var u=a(74523),g=a(29702),l=a(9659),h=a(99393),s=a(66148),B=a(76199);class P extends B.g{constructor(i){super(),this.iRow=0,this.bidStartPrice=0,this.strRank="",this.DocDetailsID=0,this.parentBiddingDocID=0,this.parentMRDocID=0,this.DocumentID=0,this.ProductID_Key=0,this.DocSeqNo=0,this.ParentRowId=0,this.result=[],this.BiddingHistoryGrid=new g.vv,this.oParent=i,this.iRow=this.oParent.ReversRowNo,this.parentBiddingDocID=this.oParent.parentBiddingDocID,this.parentMRDocID=this.oParent.parentMRDocID,this.DocumentID=this.oParent.ScreenObject.DocID,this.CostCenterID=this.oParent.ScreenObject.CostCenterID,this.DisplayName="Reverse Bidding";let e=this.oParent.ScreenObject.Data.Tables[0].filter(t=>null!=t.LocalReference&&79==t.LocalReference&&7807==t.LinkData);if(e.length>0&&this.oParent.GetBidRankSysColName(e),this.oParent.SelectedRow&&!s.J0.IsEmpty(this.oParent.SelectedRow.DocDetailsID)&&(this.DocDetailsID=s.J0.Int(this.oParent.SelectedRow.DocDetailsID),this.ProductID_Key=s.J0.Int(this.oParent.SelectedRow.ProductID_Key),this.DocSeqNo=s.J0.Int(this.oParent.SelectedRow.DocSeqNo),this.oParent.BidProductID_Key=this.ProductID_Key,this.oParent.BidDocSeqNo=this.DocSeqNo,this.oParent.BidPreviousRank=s.J0.String(this.oParent.SelectedRow[this.oParent.BidRankSysColName])),this.InitBiddingGrid(),null!=this.oParent.BiddingDefDS&&this.oParent.BiddingDefDS.Tables.length>1&&this.oParent.BiddingDefDS.Tables[1].length>0)for(let t=0;t<this.oParent.BiddingDefDS.Tables[1].length;t++)if("True"==this.oParent.BiddingDefDS.Tables[1][t].EnableBid&&s.J0.String(this.oParent.BiddingDefDS.Tables[1][t].DocSeqNo)==s.J0.String(this.DocSeqNo)){let n=0,d=0;n=s.J0.Double(this.BiddingGrid.Table[0].Rate),d=s.J0.Int(this.oParent.BiddingDefDS.Tables[1][t].PriceDef),this.bidStartPrice=s.J0.Int(this.oParent.BiddingDefDS.Tables[1][t].StartPrice)}this.intBiddingPriceHistory(),this.FillBiddingData()}OnBtnClick(i){if("Cancel"==i)l.d.page.HideDialog(this.PopUpGUID);else if("Refresh"==i)this.FillBidHistoryData(),this.FillBiddingData();else if("Submit"==i){this.BiddingGrid.angularGrid?.slickGrid&&this.BiddingGrid.angularGrid?.slickGrid.getActiveCellNode()&&(this.BiddingGrid.angularGrid.slickGrid.getActiveCell(),this.BiddingGrid.angularGrid.slickGrid.getEditorLock().commitCurrentEdit());let e=!1;if(null!=this.oParent.BiddingDefDS&&this.oParent.BiddingDefDS.Tables.length>1&&this.oParent.BiddingDefDS.Tables[1].length>0)for(let t=0;t<this.oParent.BiddingDefDS.Tables[1].length;t++){if("True"==this.oParent.BiddingDefDS.Tables[1][t].EnableBid&&s.J0.String(this.oParent.BiddingDefDS.Tables[1][t].ProductID)==s.J0.String(this.BiddingGrid.Table[0].ProductID_Key)){let n=0,d=0,o=0;if(n=s.J0.Double(this.BiddingGrid.Table[0].Rate),d=s.J0.Int(this.oParent.BiddingDefDS.Tables[1][t].PriceDef),o=s.J0.Int(this.oParent.BiddingDefDS.Tables[1][t].StartPrice),!(0===o||n<=o)){e=!0,this.DisplayMessage="Rate should be less than or equal to Start Price '"+o+"'";break}if(!(n>0)){e=!0,this.DisplayMessage="Rate should be multiples of "+d;break}if(d>0&&n%d!=0){e=!0,this.DisplayMessage="Rate should be multiples of "+d;break}}if(e)break}if(e)return;if(this.oParent.ScreenObject.DocID>0&&this.oParent.IsUserLock)return void(this.DisplayMessage="Document is Locked");this.oParent.ReviseReason="",3==this.oParent.BiddingType?(l.d.page.HideDialog(this.PopUpGUID),this.oParent.IsInventoryVoucher?this.oParent.SaveInventoryDocument_1("Revise"):this.oParent.SaveAccountingDocument("Revise")):4==this.oParent.BiddingType&&(this.oParent.IncreaseBidTime(),l.d.page.HideDialog(this.PopUpGUID),this.oParent.IsInventoryVoucher?this.oParent.SaveInventoryDocument_1("Save"):this.oParent.SaveAccountingDocument("Save"))}}InitBiddingGrid(){this.BiddingGrid=new g.vv,this.BiddingGrid.Columns=[],this.BiddingGrid.Width="",this.BiddingGrid.Table=[],this.BiddingGrid.BeginEdit.Subscribe(this,"onBeginEdit"),this.BiddingGrid.CellEditEnding.Subscribe(this,"OnCellEditCommit"),this.BiddingGrid.Columns=this.oParent.ScreenObject.ColumnSource,this.ParentRowId=this.oParent.SelectedRow.id,this.BiddingGrid.addRow(this.oParent.SelectedRow),this.BiddingGrid.ShowFooterTotals=1,this.BiddingGrid.Columns.filter(e=>"drViewBid"==e.DisplayMember).length>0&&null!=this.BiddingGrid.Columns.filter(e=>"drViewBid"==e.DisplayMember)[0]&&(this.BiddingGrid.Columns.filter(e=>"drViewBid"==e.DisplayMember)[0].IsVisible=!1);let i=l.d.common.GetDataSet3("DOC086","40220",this.CostCenterID.toString(),"");if(null!=i&&i.Tables.length>0&&i.Tables[0].length>0)for(let e=0;e<this.BiddingGrid.Columns.length;e++){this.BiddingGrid.Columns[e].IsVisible=!1;for(let t=0;t<i.Tables[0].length;t++){const n=i.Tables[0][t];("LISTBOX"==s.J0.String(n.ColumnDataType)&&this.BiddingGrid.Columns[e].ValueMember==n.SysColumnName+"_Key"||"DATE"==s.J0.String(n.ColumnDataType)&&this.BiddingGrid.Columns[e].ValueMember==n.SysColumnName+"_Key"||this.BiddingGrid.Columns[e].DisplayMember==n.SysColumnName)&&(this.BiddingGrid.Columns[e].IsVisible=!0)}}}onBeginEdit(i){var e=this;return(0,u.A)(function*(){e.oParent.onBeginEdit(i)})()}OnCellEditCommit(i){let e=i.item;this.oParent.ReverseBiddingDocDetailsID=i.item.DocDetailsID,this.oParent.ReverseBiddingRate=i.item.Rate,this.oParent.OnCellEditCommit(i),this.BiddingGrid.updateRow(i.item),e=i.item,e.id=this.ParentRowId,this.oParent.ScreenObject.GridDataObj.updateRow(i.item)}FillBiddingData(){let i=l.d.common.GetDataSet3("DOC083",this.parentBiddingDocID.toString(),this.ProductID_Key.toString(),"");if(null!=i&&i.Tables.length>0&&i.Tables[0].length>0){let e=1,t="",d=i.Tables[0].filter(r=>r.DocSeqNo==this.DocSeqNo);for(let r=0;r<d.length;r++){(""==t||t!=s.J0.String(d[r].Rate))&&(t=s.J0.String(d[r].Rate),0!==r&&e++);let c=d.filter(f=>f.Rate==s.J0.String(d[r].Rate));d[r].Rank=1==c.length?"L"+e:"L"+e+" ("+c.length+")"}let o=d.filter(r=>r.DocID==this.DocumentID.toString());o.length>0&&(this.strRank=o[0].Rank)}}OnCellEditEnding(i){let e=i.item,t=i.row,n=!1;if(null!=this.oParent.BiddingDefDS&&this.oParent.BiddingDefDS.Tables.length>1&&this.oParent.BiddingDefDS.Tables[1].length>0)for(let d=0;d<this.oParent.BiddingDefDS.Tables[1].length;d++)if("True"==this.oParent.BiddingDefDS.Tables[1][d].EnableBid&&s.J0.String(this.oParent.BiddingDefDS.Tables[1][d].ProductID)==s.J0.String(e.ProductID_Key)){let o=0,r=0;if(o=s.J0.Double(e.NewRate),r=s.J0.Int(this.oParent.BiddingDefDS.Tables[1][d].PriceDef),!(o>0)){n=!0;break}if(r>0&&o%r!=0){n=!0;break}}n&&(this.DisplayMessage="Price Defination miss match at row no "+t)}intBiddingPriceHistory(){this.BiddingHistoryGrid.Columns=[],this.BiddingHistoryGrid.Table=[],this.BiddingHistoryGrid.Height=200,this.BiddingHistoryGrid.Width="500",this.BiddingHistoryGrid.TableColumns.push("Sno"),this.BiddingHistoryGrid.TableColumns.push("InvDocDetailsID"),this.BiddingHistoryGrid.TableColumns.push("Price"),this.BiddingHistoryGrid.TableColumns.push("ModifiedBy"),this.BiddingHistoryGrid.TableColumns.push("ModifiedDate");let i=new h.O7;i.Header="Sno",i.Width=50,i.DisplayMember="Sno",i.ReadOnly=!0,this.BiddingHistoryGrid.Columns.push(i),i=new h.O7,i.Header="InvDocDetailsID",i.DataType="FLOAT",i.DisplayMember="InvDocDetailsID",i.Width=100,i.IsVisible=!1,i=new h.O7,i.Header="Price",i.DisplayMember="Price",i.ReadOnly=!0,i.DataType="FLOAT",i.Width=100,i.DecimalPoints=l.d.SessionManager.Preferences.DecimalsinAmount.toString(),i.ID="Rate",this.BiddingHistoryGrid.Columns.push(i),i=new h.O7,i.Header="Modified By",i.DataType="Text",i.DisplayMember="ModifiedBy",i.Width=150,i.ReadOnly=!0,this.BiddingHistoryGrid.Columns.push(i),i=new h.O7,i.Header="Date",i.DataType="Text",i.DisplayMember="ModifiedDate",i.Width=100,i.ReadOnly=!0,this.BiddingHistoryGrid.Columns.push(i),this.FillBidHistoryData()}FillBidHistoryData(){if(this.DocDetailsID>0){let i=l.d.common.GetDataSet3("DOC082",this.DocDetailsID.toString(),this.parentBiddingDocID.toString(),this.DocumentID.toString());if(null!=i&&i.Tables.length>0&&i.Tables[0].length>0){this.BiddingHistoryGrid.Clear();for(let e=0;e<i.Tables[0].length;e++){let t;t=this.BiddingHistoryGrid.NewRow(),t.Sno=e+1,t.DocDetailsID=s.J0.String(i.Tables[0][e].DocDetailsID),t.Price=s.J0.String(i.Tables[0][e].Price),t.ModifiedBy=s.J0.String(i.Tables[0][e].ModifiedBy),t.ModifiedDate=s.J0.String(i.Tables[0][e].ModifiedDateTime),this.BiddingHistoryGrid.addRow(t)}}else this.BiddingHistoryGrid.addEmptyRow(),this.BiddingHistoryGrid.addEmptyRow(),this.BiddingHistoryGrid.addEmptyRow(),this.BiddingHistoryGrid.addEmptyRow(),this.BiddingHistoryGrid.addEmptyRow()}}}}}]);