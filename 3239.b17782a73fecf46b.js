"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[3239],{63239:(z,V,m)=>{m.r(V),m.d(V,{DashBoardNotifViewModel:()=>K});var A=m(74523),r=m(9659),i=m(66148),W=m(76199),x=m(29702),J=m(80957),w=m(99393),U=m(83682),R=m(6532),G=m(82911),F=m(12752);class K extends W.g{constructor(o){super(),this.ProgressValue=0,this.ProgressMax=0,this.ShowProcessDialog=!1,this.LocationID="",this.dtColumns=[],this.EventsType=0,this.Enable=!0,this.ClubInvoice=!1,this.oDocument=null,this._BulkDr=null,this._Ddate=Date.Today();try{this.EventsType=o,this.Grid=new x.vv,this.Grid.Width="500",this.Grid.OnLinkClick.Subscribe(this,"OnLinkClickEvent"),this.InitColumns(),2==o&&this.RefreshData()}catch(u){Logger.ErrorLog("DashBoardNotifViewModel","Constructor",u)}Logger.InfoLog("DashBoardNotifViewModel:: Entering DashBoardNotifViewModel")}InitColumns(){2==this.EventsType?this.Grid.Columns=J.GeneralDashboardViewModel.InitColumns("Notification Events_DashBoardCustomize"):4==this.EventsType&&(this.Grid.Columns=J.GeneralDashboardViewModel.InitColumns("Post Dated Documents_DashBoardCustomize"),this.LocationID=r.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==r.d.SessionManager.Preferences.EnableLocationWise.toString()?r.d.SessionManager.LocationID>0?r.d.SessionManager.LocationID.toString():r.d.SessionManager.LocationWhere:"0",r.d.SessionManager.IsActionAssigned(4e4,"Read")&&(G.PostedDocumentViewModel.SetDimensionQuery(),r.d.document.GetDashPDCDocuments(this.LocationID,G.PostedDocumentViewModel.strSelect,G.PostedDocumentViewModel.strJoin).subscribe(o=>{this.dt=o.Tables[0],null!=this.dt&&this.dt.forEach(u=>{u.id=r.d.slick.rowid,u.Date_Text=i.J0.ParseDate(u.DocDate).ToString(r.d.SessionManager.Preferences["Date Format"]),null!=u.ChequeMaturityDate&&(u.MaturityDate=i.J0.ParseDate(u.ChequeMaturityDate).ToString(r.d.SessionManager.Preferences["Date Format"]))}),this.Grid.Table=this.dt})))}RefreshData(){if(2==this.EventsType){let o="";"True"==r.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==r.d.SessionManager.Preferences["LW Reports"]&&(r.d.SessionManager.LocationID>0?o=" and dcc.dcCCNID2="+r.d.SessionManager.LocationID:"1"!=r.d.SessionManager.RoleID&&!i.J0.IsEmpty(r.d.SessionManager.LocationWhere)&&(o=" and dcc.dcCCNID2 IN ("+r.d.SessionManager.LocationWhere+")")),F.$.GetScheduleEvents(o).subscribe(u=>{let e=u.Tables[0],t=!1;if(null!=e){let b,c=0;e.forEach(d=>{d.id=r.d.slick.rowid,b=i.J0.ParseDate(d.EventTime),(29==b.Minute||59==b.Minute)&&(b=b.AddMinutes(1)),d.EventTime_Text=b.ToString(r.d.SessionManager.Preferences["Date Format"]+" hh:mm a"),c=parseInt(d.FreqType),1==c?d.FreqType=r.d.GetResource("Com_Once"):4==c?d.FreqType=r.d.GetResource("Reports_LblDaily"):8==c?d.FreqType=r.d.GetResource("Com_Weekly"):16==c||32==c?d.FreqType=r.d.GetResource("Com_Monthly"):0==c&&(d.FreqType="Contract"),i.J0.Int(d.TrackingNO)>0&&(t=!0)})}if(t&&!this.Grid.Columns.find(c=>"TrackingNO"==c.DisplayMember)){let c=new w.O7;c.Header="TrackingNO",c.DisplayMember="TrackingNO",c.ReadOnly=!0,c.Width=80,this.Grid.Columns.push(c),this.Grid.RefreshColumns()}this.Grid.Table=e})}}OnButtonClick(o){"PostPDC"==o||"RefreshPDC"==o&&this.RefreshData()}OnLinkClickEvent(o,u,e){try{4==this.EventsType?U.RibbonExtViewModel.LoadDocument(o):2==this.EventsType&&this.LoadDocument(o,!1)}catch(t){Logger.ErrorLog("UnAppDocumentsViewModel","OnLinkClickEvent",t)}}AutoPost(){var o=this;return(0,A.A)(function*(){const{ProcessDialogViewModel:u}=yield m.e(4113).then(m.bind(m,26494)),{ProcessDialogComponent:e}=yield m.e(6610).then(m.bind(m,16610));o.ProgressMessage="Resaving documents.Please wait...";let t=new u(o);r.d.page.ShowDialog(t,e,{HideClose:!1,HideHeader:!0,ShowCenter:!0})})()}save(){this.ProgressMessage="Posting documents please wait..";let o=null;this.ClubInvoice?(o=this.dt.filter(t=>1==t.Select),o.sort((t,c)=>t.contractID-c.contractID)):o=this.dt.filter(t=>1==t.Select),this.ProgressMax=o.length,this.ProgressValue=0,this.ShowProcessDialog=!0;let u=new Array,e=0;for(let t=0;t<o.length;t++){if(null!=this.oDocument&&e>0&&this.ClubInvoice&&!i.J0.IsEmpty(o[t].contractID)&&e!=parseInt(o[t].contractID.toString())&&(this.oDocument.GenratePrefix=!0,this.oDocument.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")?this.oDocument.ScreenObject.Preferences.Alwaysnewreference="true":this.oDocument.ScreenObject.Preferences.push("Alwaysnewreference","true"),this.oDocument.SaveInventoryDocument("ReSave"),u.forEach(c=>{c.Remarks=this.oDocument.DisplayMessage,c.Postedvoucherno=this.oDocument.ScreenObject.VoucherNo}),u.Clear()),e=parseInt(o[t].contractID),""==i.J0.String(o[t].Postedvoucherno)&&(this.ClubInvoice?setTimeout(()=>{this.LoadDocument(o[t],!0,!1,u.length),u.push(o[t])},100):setTimeout(()=>{this.LoadDocument(o[t],!0)},100),null==this.oDocument))return void(o[t].Remarks="Define particulars dimension in body");o[t].Select=!1,this._BulkDr=o[t][t]}null!=this.oDocument&&u.length>0&&(this.oDocument.GenratePrefix=!0,this.oDocument.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")?this.oDocument.ScreenObject.Preferences.Alwaysnewreference="true":this.oDocument.ScreenObject.Preferences.push("Alwaysnewreference","true"),this.oDocument.SaveInventoryDocument("ReSave"),u.forEach(t=>{t.Remarks=this.oDocument.DisplayMessage,t.Postedvoucherno=this.oDocument.ScreenObject.VoucherNo})),this.ProgressMax==this.ProgressValue&&(this.ShowProcessDialog=!1)}GetNarr(o,u,e){let t="";if(null!=o&&o.Tables.length>0&&o.Tables[0].length>0&&!i.J0.IsEmpty(o.Tables[0][0].RentNodeid)){var c=o.Tables[1].filter(b=>b.PartID==o.Tables[0][0].RentNodeid.toString());c.length>0&&!i.J0.IsEmpty(c[0].cnt)&&(t+=this.GetStr(c[0].cnt.toString(),e)+"Installment")}return t+=" for the Period of (",r.d.SessionManager.Preferences.ContainsKey("RentalNarrFormat")&&""!=r.d.SessionManager.Preferences.RentalNarrFormat?t+=u.ToString(r.d.SessionManager.Preferences.RentalNarrFormat):t+=u.ToString("MMM/yyyy"),null!=o&&o.Tables.length>0&&o.Tables[0].length>0&&!i.J0.IsEmpty(o.Tables[0][0].nextDate)&&(r.d.SessionManager.Preferences.ContainsKey("RentalNarrFormat")&&""!=r.d.SessionManager.Preferences.RentalNarrFormat?t+="-"+i.J0.ParseDate(o.Tables[0][0].nextDate.toString()).AddDays(-1).ToString(r.d.SessionManager.Preferences.RentalNarrFormat):t+="-"+i.J0.ParseDate(o.Tables[0][0].nextDate.toString()).AddDays(-1).ToString("MMM/yyyy")),t+=")",t}LoadDocument(o,u){var e=this;return(0,A.A)(function*(t,c,b=!0,d=0){let M,k=i.J0.String(t.VoucherNo);if(e.ClubInvoice)M=""!=t.DocumentDate.ToString()?i.J0.ParseDate(t.DocumentDate):new Date;else{if(i.J0.IsEmpty(t.EventTime))return;M=i.J0.ParseDate(t.EventTime.toString())}let E=parseInt(t.SchEventID.toString()),L="";Object.keys(t).Contains("SchGUID")&&(L=i.J0.String(t.SchGUID));let v=r.d.report.GetDocumentDetailsByVoucherNo(k);if(i.J0.Int(v.obj)>0){let T;T=v.Tables[0].length>0?v.Tables[0][0]:v.Tables[1][0];const{AddEditDocumentViewModel:p}=yield Promise.resolve().then(m.bind(m,27490)),{AddEditDocumentComponent:H}=yield Promise.resolve().then(m.bind(m,8405));let a=null;null!=e.oDocument&&null==e.oDocument.ScreenObject&&(e.oDocument=null),parseInt(t.SubCostCenterID)>0&&t.SubCostCenterID.toString()!=t.CostCenterID.toString()?((null==e.oDocument||e.oDocument.CostCenterID!=parseInt(t.SubCostCenterID))&&(e.oDocument=new p(parseInt(t.SubCostCenterID.toString()),"",!!c)),a=e.oDocument.ScreenObject.GetEditDataByCCDOCID(t.CostCenterID.toString(),t.NodeID.toString())):((null==e.oDocument||e.oDocument.CostCenterID!=parseInt(T.CostCenterID))&&(e.oDocument=new p(parseInt(T.CostCenterID),T.DocumentName.toString(),!!c)),a=e.oDocument.ScreenObject.GetEditData(T.DocPrefix.toString(),T.DocNumber.toString(),0)),c||r.d.page.addNewTab({title:e.oDocument.ScreenName,component:H,params:{obj:e.oDocument}});let N="";null!=a&&a.Tables.length>0&&a.Tables[0].length>0&&a.Columns[0].Contains("VoucherNO")&&(N=a.Tables[0][0].VoucherNO.toString());let P,B=!1;"2"==i.J0.String(t.RecurMethod)&&!i.J0.IsEmpty(t.RecurMethod)&&"2"==i.J0.String(t.RecurMethod)&&(B=!0),e.ClubInvoice&&!e.oDocument.ScreenObject.GridDataColumns.Contains("ScheduleID")&&(e.oDocument.ScreenObject.GridDataColumns.push("ScheduleID"),e.oDocument.ScreenObject.GridDataColumns.push("SchGUID"));for(let s=0;s<a.Tables[0].length;s++)a.Tables[0][s].DocDetailsID="0",a.Tables[0][s].DocID="0",!i.J0.IsEmpty(t.AttachmentID)&&"0"==i.J0.String(t.AttachmentID)&&a.Columns[0].Contains("CanRecur")&&(a.Tables[0][s].CanRecur=null),B&&(P=a.Tables[0][s].CreditAccount,a.Tables[0][s].CreditAccount=a.Tables[0][s].DebitAccount,a.Tables[0][s].DebitAccount=P,P=a.Tables[0][s].CrAccountCode,a.Tables[0][s].CrAccountCode=a.Tables[0][s].DBAccountCode,a.Tables[0][s].DBAccountCode=P,P=a.Tables[0][s].CrAccountName,a.Tables[0][s].CrAccountName=a.Tables[0][s].DBAccountName,a.Tables[0][s].DBAccountName=P,P=a.Tables[0][s].CrIsBillWise,a.Tables[0][s].CrIsBillWise=a.Tables[0][s].DBIsBillWise,a.Tables[0][s].DBIsBillWise=P);for(let s=0;s<a.Tables[8].length;s++)a.Columns[8].Contains("CanEdit")&&(a.Tables[8][s].CanEdit=!0);if(a.Columns[0].Remove("DocDate"),a.Columns[0].Remove("DocNumber"),e.oDocument.ScreenObject.DocPrefix.ComboBox.SelectedValue=T.DocPrefix.toString(),e.oDocument._Ddate=M,e.oDocument.OnDocPrefixChanged_2(T.DocPrefix.toString(),!1),e.oDocument.ScreenObject.LoadEditData(a,!1,E),e.oDocument.ScheduleID=E,e.oDocument.RecurDocumentVoucherNo=N,e.oDocument.SchGUID=L,e.oDocument.objGeneralDashboard=e,a.Columns[0].Contains("RefCCID")&&"95"==a.Tables[0][0].RefCCID.toString()){a.Columns[0].Contains("RefNodeid")&&!i.J0.IsEmpty(a.Tables[0][0].RefNodeid)&&(e.oDocument.ScreenObject.RefNodeID=parseInt(a.Tables[0][0].RefNodeid.toString())),e.oDocument.ScreenObject.RefCCId=95;let s=null;if(r.d.SessionManager.Preferences.ContainsKey("DepositLinkDimension")&&!i.J0.IsEmpty(r.d.SessionManager.Preferences.DepositLinkDimension)&&(s=e.oDocument.ScreenObject.ColumnSource.find(D=>D.CostCenterID==parseInt(r.d.SessionManager.Preferences.DepositLinkDimension))),null==s)return void(e.oDocument=null);let n=e.oDocument.ScreenObject.GetScheduleDetails(e.oDocument.ScreenObject.RefNodeID,M,E),O=e.GetNarr(n,M,d);if(null!=(g=e.oDocument.ScreenObject._StaticFields.find(D=>"CommonNarration"==D.DBColumnName))&&g instanceof R.Dw&&0==d&&(g.Text=O),e.ClubInvoice){var j=e.oDocument.ScreenObject.GridData.filter(D=>D.ScheduleID==E);for(let D=0;D<j.length;D++)e.oDocument.ScreenObject.GridDataColumns.Contains("LineNarration")&&(j[D].LineNarration=O),j[D].SchGUID=L}if(null!=n&&n.Tables[0].length>0&&"1"==n.Tables[0][0].islastInv.toString()&&n.Tables.length>2&&n.Columns[2].Contains("CCID")&&n.Tables[2].length>0&&!i.J0.IsEmpty(n.Tables[2][0].CCID)){if(null!=s&&e.oDocument.ScreenObject.GridDataColumns.Contains(s.ValueMember))for(let D=0;D<n.Tables[2].length;D++)if((l=e.oDocument.ScreenObject.GridData.filter(f=>f[s.ValueMember]==i.J0.String(n.Tables[2][D].CCNodeID))).length>0){let f=i.J0.Double(n.Tables[2][D].Amount);if((C=n.Tables[1].filter(h=>h.PartID==n.Tables[2][D].CCNodeID.toString())).length>0&&!i.J0.IsEmpty(C[0].TotInv)&&(f-=i.J0.Double(C[0].TotInv)),f<=0&&(f=0),1==l.length)l[0].Rate=f,l[0].Gross=f,e.oDocument.CalculateTotals(l[0],!1),f=i.J0.Double(n.Tables[2][D].VatAmount),C.length>0&&""!=i.J0.String(C[0].TotVat)&&(f-=i.J0.Double(C[0].TotVat)),f>0&&null!=(I=e.oDocument.ScreenObject.ColumnSource.find(h=>!i.J0.IsEmpty(h.DisplayMember)&&"dcnum53"==h.DisplayMember.toLowerCase()))&&(l[0].dcNum53=f.ToString("N"+I.DecimalPoints),l[0].dcCalcdcNum53=f.ToString("N"+I.DecimalPoints),e.oDocument.ScreenObject.GridDataColumns.Contains("dcNum61")&&(l[0].dcNum61=f.ToString("N"+I.DecimalPoints),l[0].dcCalcdcNum61=f.ToString("N"+I.DecimalPoints)));else{let h=0,y=e.oDocument.ScreenObject.GridData.filter(S=>S[s.ValueMember]==n.Tables[2][D].CCNodeID).Compute("sum","Rate");var I;null!=y&&y.toString().length>0&&(h=f-i.J0.Double(y)),h>0&&!i.J0.IsEmpty(l[0].Rate)&&(l[0].Rate=i.J0.Double(l[0].Rate)+h,l[0].Gross=l[0].Rate,e.oDocument.CalculateTotals(l[0],!1)),f=i.J0.Double(n.Tables[2][D].VatAmount),C.length>0&&!i.J0.IsEmpty(C[0].TotVat)&&(f-=i.J0.Double(C[0].TotVat)),h=0,y=e.oDocument.ScreenObject.GridData.filter(S=>S[s.ValueMember]==n.Tables[2][D].CCNodeID).Compute("sum","dcNum53"),null!=y&&y.toString().length>0&&(h=f-i.J0.Double(y)),h>0&&null!=(I=e.oDocument.ScreenObject.ColumnSource.find(_=>!i.J0.IsEmpty(_.DisplayMember)&&"dcnum53"==_.DisplayMember.toLowerCase()))&&!i.J0.IsEmpty(l[0].dcNum53)&&(l[0].dcNum53=(i.J0.Double(l[0].dcNum53)+h).ToString("N"+I.DecimalPoints),l[0].dcCalcdcNum53=l[0].dcNum53,e.oDocument.ScreenObject.GridDataColumns.Contains("dcNum61")&&(l[0].dcNum61=l[0].dcNum53,l[0].dcCalcdcNum61=l[0].dcNum53))}}}else if(null!=n&&n.Tables[0].length>0&&n.Tables.length>2&&n.Columns[2].Contains("CCID")&&n.Tables[2].length>0&&""!=n.Tables[2][0].CCID.toString()&&null!=s&&e.oDocument.ScreenObject.GridDataColumns.Contains(s.ValueMember))for(let D=0;D<n.Tables[2].length;D++){var l;if((l=e.oDocument.ScreenObject.GridData.filter(h=>h[s.ValueMember]==n.Tables[2][D].CCNodeID.toString())).length>0){let h=parseFloat(n.Tables[2][D].Amount.toString());var C;if((C=n.Tables[1].filter(S=>S.PartID==n.Tables[2][D].CCNodeID.toString())).length>0&&!i.J0.IsEmpty(C[0].TotInv)&&(h-=parseFloat(C[0].TotInv.toString())),h<=0)for(let S=0;S<l.length;S++)l[S].Rate=0,l[S].Gross=0,e.oDocument.CalculateTotals(l[S],!1)}}}if(""!=N){let s=e.oDocument.ScreenObject.Data.Tables[0].filter(n=>79==n.LocalReference&&52627==n.LinkData);if(s.length>0)if(e.oDocument.ScreenObject.GridDataColumns.Contains(s[0].SysColumnName.toString()))if(e.oDocument.IsInventoryVoucher)for(let n=0;n<e.oDocument.ScreenObject.GridData.length;n++)i.J0.IsEmpty(e.oDocument.ScreenObject.GridData[n].ProductID_Key)||(e.oDocument.ScreenObject.GridData[n][s[0].SysColumnName.toString()]=N);else for(let n=0;n<a.Tables[0].length;n++)e.oDocument.ScreenObject.GridData[n][s[0].SysColumnName.toString()]=N;else(g=e.oDocument.ScreenObject._TextFields.find(O=>O.DBColumnName.toLowerCase()==s[0].SysColumnName.toString().toLowerCase()))&&g instanceof R.Dw&&(g.Text=N);if(s=e.oDocument.ScreenObject.Data.Tables[0].filter(n=>79==n.LocalReference&&55262==n.LinkData),s.length>0)if(e.oDocument.ScreenObject.GridDataColumns.Contains(s[0].SysColumnName.toString()))if(e.oDocument.IsInventoryVoucher)for(let n=0;n<e.oDocument.ScreenObject.GridData.length;n++)i.J0.IsEmpty(e.oDocument.ScreenObject.GridData[n].ProductID_Key)||(e.oDocument.ScreenObject.GridData[n][s[0].SysColumnName.toString()]="1");else for(let n=0;n<a.Tables[0].length;n++)e.oDocument.ScreenObject.GridData[n][s[0].SysColumnName.toString()]="1";else{var g;(g=e.oDocument.ScreenObject._TextFields.find(O=>O.DBColumnName.toLowerCase()==s[0].SysColumnName.toString().toLowerCase()))instanceof R.Dw&&(g.Text="1")}}e.oDocument.SetNewDocButtonVisibility(),c&&b&&(e.oDocument.GenratePrefix=!0,e.oDocument.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")?e.oDocument.ScreenObject.Preferences.Alwaysnewreference="true":e.oDocument.ScreenObject.Preferences.push("Alwaysnewreference","true"),e.oDocument.SaveCallBackMethod.Subscribe(e,"DocSaveCallBack"),e.oDocument.IsInventoryVoucher?e.oDocument.SaveInventoryDocument_1("ReSave"):e.oDocument.SaveAccountingDocument("ReSave"),e.oDocument.callbacksubject.subscribe(s=>{e.dtColumns.Contains("Remarks")&&(t.Remarks=e.oDocument.DisplayMessage,t.Postedvoucherno=e.oDocument.ScreenObject.VoucherNo),e.dtGrid.RefreshGridView()}))}}).apply(this,arguments)}DocSaveCallBack(){this.ProgressValue++,this.ProgressValue==this.ProgressMax&&(this.ShowProcessDialog=!1)}GetStr(o,u){let e;switch(e=i.J0.Int(o),e++,e+=u,e){case 1:return"1st ";case 2:return"2nd ";case 3:return"3rd ";default:return e+"th "}}}}}]);