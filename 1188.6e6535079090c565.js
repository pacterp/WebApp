"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[1188],{24517:(qt,ot,G)=>{G.r(ot),G.d(ot,{FinalSettlementViewModel:()=>Se});var de=G(74523),I=G(32040),Ae=G(43767),r=G(98580),_e=G(84151),at=G(82503),mt=G(66096),v=G(27730),s=G(58170),xe=G(12002),$e=G(48800),st=G(49600),qe=G(57528),yt=G(423),Re=G(2979),ee=G(23458),De=G(58941),Be=G(54581);class Se extends r.g{get ReportInfoVisibility(){return this._ReportInfoVisibility}set ReportInfoVisibility(h){h!=this._ReportInfoVisibility&&(this._ReportInfoVisibility=h)}constructor(h,le=""){super(),this.ApproveVisibility=!1,this.PostVisiblility=!0,this.UnPostVisiblility=!0,this.UnProcessedVisible=!0,this.WID=0,this.DocID=0,this.txtDocNo=new _e.Dw(0),this.dtpDocDate=new at.Lc(0),this.EmployeeList=new mt.G(0),this.dtpDateOfJoining=new at.Lc(0),this.dtpDateOfRelieving=new at.Lc(0),this.txtRemarks=new _e.Dw(0),this.txtNetAmount=new _e.Dw(0),this.DialogResult=!1,this.AttachmentVisibility=!1,this.CostCenterID=40095,this.cmbResignReason=new v.y$(0),this.CalculateClick=new s.Yk,this.EmpSelectionChanged=new s.Yk,this.strCustomEmpFilter="",this.sCmdParameter="",this.IsSaved=!1,this.sVNo="",this.dsRes1=null,this.drwRes=null,this.ReportsList=[],this.dsData=null,this._ReportInfoVisibility=!0,this.ButtonReport=new De.v,this.SelectedEmpID=0,this.StatusColor="#736F6F",this.StatusID=0,this.WFDocLevelList=new Array,this.ErrorMessage="Missing Report Parameter ' ",this.ClassName="FinalSettlementViewModel";try{this.CostCenterID=40095,this.dsRes1=I.d.common.GetDataSet("CRM030",I.d.SessionManager.LangID),this.txtDocNo.Label=this.GetResource("VoucherNo",40095),this.dtpDocDate.Label=this.GetResource("DocDate",40095),this.EmployeeList.Label=this.GetResource("Employee",40095),this.dtpDateOfJoining.Label=this.GetResource("Date of Joining",40095),this.dtpDateOfRelieving.Label=this.GetResource("Date of Relieving",40095),this.txtNetAmount.Label=this.GetResource("Net Amount",40095),I.d.SessionManager.Preferences.ContainsKey("FinalsettlementHideUnProcessedSalaryTab")&&"True"==I.d.SessionManager.Preferences.FinalsettlementHideUnProcessedSalaryTab.toString()&&(this.UnProcessedVisible=!1),this.DisplayName=h,this.Title=h,this.sVNo=le,this.DisplayMessage="",this.DocStatus="[UnPosted]",this.ViewAttachments=new xe.ViewAttachmentViewModel(this,I.d.SessionManager,I.d.admin),this.OnAddAttachment(),this.txtDocNo.LblWidth="",this.txtRemarks.Label=I.d.GetResource("Remarks"),this.txtNetAmount.IsReadOnly=!0,this.EmployeeList.Code.TypeID=4,this.EmployeeList.Name.TypeID=1,this.EmployeeList.Code.Visible=this.EmployeeList.Name.Visible=!1,this.EmployeeList.Code.Column=0,this.EmployeeList.Name.Column=1,this.EmployeeList.Code.Visible=!0,this.EmployeeList.Name.Visible=!0,this.EmployeeList.Code.CCID=this.EmployeeList.Name.CCID=50051,this.EmployeeList.Code.Visible&&(this.EmployeeList.Code.CCID=50051,this.EmployeeList.Code.TypeID=4),this.EmployeeList.Name.Visible&&(this.EmployeeList.Name.CCID=50051,this.EmployeeList.Name.TypeID=1),this.strCustomEmpFilter=this.FilterEmployees(),this.EmployeeList.Code.CustomWhere=this.EmployeeList.Name.CustomWhere=this.strCustomEmpFilter,this.EmployeeList.SelectionCallBack.Subscribe(this,"EmployeeList_SelectedValueChanged"),this.cmbResignType=new v.y$(0),this.cmbResignType.Items.push(v._p.ComboBoxItems_2("Resigned","Resigned")),this.cmbResignType.Items.push(v._p.ComboBoxItems_2("Terminated","Terminated")),this.cmbResignType.Items.push(v._p.ComboBoxItems_2("Terminated With Cause","Terminated With Cause")),this.cmbResignType.Items.push(v._p.ComboBoxItems_2("Terminated Without Cause","Terminated Without Cause")),this.cmbResignType.Items.push(v._p.ComboBoxItems_2("Expired","Expired")),this.cmbResignType.Label=this.GetResource("Resign Type",40095),null!=this.dsRes1&&this.dsRes1.Tables.length>1&&this.dsRes1.Tables[1].length>0&&v.y$.FillComboWithDefaultOption_3(this.dsRes1.Tables[1],this.cmbResignReason,!1),this.cmbSettlementType=new v.y$(0),this.cmbSettlementType.Items.push(v._p.ComboBoxItems_2("Final","Final")),this.cmbSettlementType.Items.push(v._p.ComboBoxItems_2("Partial","Partial")),this.cmbSettlementType.Label=this.GetResource("Settlement Type",40095),this.PostVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),I.d.SessionManager.Preferences.ContainsKey("DisableDateOfRelievingFieldInFinalSettlement")&&"True"==I.d.SessionManager.Preferences.DisableDateOfRelievingFieldInFinalSettlement.toString()&&(this.dtpDateOfRelieving.Enable=!1),I.d.SessionManager.Preferences.ContainsKey("DisableResignTypeFieldInFinalSettlement")&&"True"==I.d.SessionManager.Preferences.DisableResignTypeFieldInFinalSettlement.toString()&&(this.cmbResignType.Enable=!1),this.ReportView(),Logger.InfoLog("FinalSettlementViewModel::Exiting FinalSettlementViewModel()")}catch(q){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION FinalSettlementViewModel()",q)}}EmployeeList_SelectedValueChanged(h){try{this.DisplayMessage="",this.SelectedEmpID=this.EmployeeList.Code.SelectedValue,this.SelectedEmpID>0&&this.EmpSelectionChanged.Call(this.SelectedEmpID)}catch(le){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION EmployeeList_SelectedValueChanged()",le)}}get DocStatus(){return this._DocStatus}set DocStatus(h){h!=this._DocStatus&&(this._DocStatus=h,this.setStatusColor())}setStatusColor(){this.StatusColor=this.DocStatus.startsWith("["+I.d.GetResource("Doc_Draft")+"]")||this.DocStatus.startsWith("[UnPosted]")?I.d.SessionManager.Preferences.DraftColor:this.DocStatus.startsWith("[Partial]")?I.d.SessionManager.Preferences.partialColor:369==this.StatusID?I.d.SessionManager.Preferences.PostedColor:370==this.StatusID?I.d.SessionManager.Preferences.PDCColor:371==this.StatusID?I.d.SessionManager.Preferences.UnApprovedColor:372==this.StatusID?I.d.SessionManager.Preferences.RejectedColor:376==this.StatusID?I.d.SessionManager.Preferences.CancelledColor:429==this.StatusID?I.d.SessionManager.Preferences.BouncedColor:441==this.StatusID?I.d.SessionManager.Preferences.ApprovedColor:"#FF736F6F",9==this.StatusColor.length&&(this.StatusColor.startsWith("#FF")||this.StatusColor.startsWith("#ff"))&&(this.StatusColor="#"+this.StatusColor.substr(3))}Button_Click(h){try{if("Clear"==h.toString())this.EmployeeList.SelectedValue=0,this.SelectedEmpID=0,this.CalculateClick.Call(h);else if("EMail"==h.toString()){if(!(this.DocID>0))return void(this.DisplayMessage="Load document in Edit Mode");I.d.page.ShowDialog(new qe.SendEmailSMSViewModel(!0,50051,this.EmployeeList.SelectedValue,this),yt.SendEmailSMSComponent)}else"Attachments"==h.toString()?(this.AttachmentVisibility=!0,I.d.page.ShowDialog(this.Attachment,st.o,{Title:this.Attachment.Title})):"Report"==h.toString()?(this.ReportInfoVisibility=!0,I.d.page.ShowDialog(this,Re.L,{Title:"Reports"})):this.CalculateClick.Call(h)}catch(le){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION Button_Click()",le)}}SetDocStatus(h,le,q,n,He,ze,B){let te=[];return te.push(h),te.push(He??""),te.push(n.ToString("dd/MMM/yyyy")),te.push(!0),te.push(this.DocID),te.push(this.CostCenterID),te.push(le),te.push(q),te.push(ze),te.push(I.d.SessionManager.GetSysInfo()),te.push(I.d.SessionManager.GetAccessPoint()),te.push(B),te.push(I.d.SessionManager.CompanyGUID),te.push(I.d.SessionManager.UserName),te.push(I.d.SessionManager.UserID),te.push(I.d.SessionManager.RoleID),te.push(I.d.SessionManager.LanguageID),I.d.document.SetDocStatus(te)}FilterEmployees(){let h="";try{Logger.InfoLog("FinalSettlementViewModel::Entering FilterEmployees()"),I.d.SessionManager.LocationID>0&&I.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&I.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(h=h+" a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+I.d.SessionManager.LocationID+")"),Logger.InfoLog("FinalSettlementViewModel::Exiting FilterEmployees()")}catch(le){Logger.ErrorLog("FinalSettlementViewModel::EXCEPTION FilterEmployees()",le)}return h}SaveFinalSettlement(h){return I.d.document.SetTempInvDocument(h)}OnShowAttachment(){Logger.InfoLog("AddProductViewModel::Entering OnShowAttachment"),Logger.InfoLog("AddProductViewModel::Exiting OnShowAttachment")}OnAddAttachment(){Logger.InfoLog("AddProductViewModel::Entering AddAttachment");let h="";null!=this.Attachment&&(h=this.Attachment.ColID);let le=null;null!=this.Attachment&&(le=this.Attachment.RowID),this.Attachment=new $e.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),""==h?(this.Attachment.ColID="",this.Attachment.RowID=null):(this.Attachment.ColID=h,this.Attachment.RowID=le),Logger.InfoLog("AddProductViewModel::Entering AddAttachment")}GetResource(h,le){let q=h;return null!=this.dsRes1&&this.dsRes1.Tables.length>0&&this.dsRes1.Tables[0].length>0&&(this.drwRes=this.dsRes1.Tables[0].filter(n=>n.CCID==le&&n.Code==h)),null!=this.drwRes&&this.drwRes.length>0?1==I.d.SessionManager.LanguageID?this.drwRes[0].Name.toString():this.drwRes[0].AliasName.toString():q}PostApplyLeaves(h,le,q){return I.d.empService.ExecuteQuery_SP(le,q)}ReportView(){this.ReportDimension=new ee.y$(0),this.ReportDimension.CCID=this.CostCenterID,this.ReportDimension.TypeID=1,this.ReportsList=[],this.ReportDimension.OnPactListBoxValueChanged.Subscribe(this,"OnReportsLinkClick");let h=[];this.dsData=I.d.common.GetDataSetQuery(" declare @UserID int,@RoleID int        set @UserID="+I.d.SessionManager.UserID+" set @RoleID="+I.d.SessionManager.RoleID+"    \n                            SELECT R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel,Q.Width ,Q.Height,Q.mapxml,Q.MapType\n                            FROM ADM_RevenUReports R  with(nolock)\n                            inner join ADM_DocumentReports Q WITH(NOLOCK) on Q.DocumentReportID=R.ReportID\n                            left join ADM_CostCenterDef A WITH(NOLOCK) on A.CostCenterColID=Q.DocumentField \n                            left join [ADM_DocReportUserRoleMap] DR WITH(NOLOCK) on DR.DocumentViewID=Q.DocumentViewID and DR.CostCenterID=Q.CostCenterID\n                            where  Q.CostCenterID="+this.CostCenterID+" and (DR.UserID=@UserID OR DR.RoleID=@RoleID OR GroupID IN (SELECT GroupID FROM COM_Groups WITH(NOLOCK) WHERE UserID=@UserID OR RoleID=@RoleID))\n                            GROUP BY  Q.ReportID, R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel ,Q.Width,Q.Height,Q.mapxml,Q.MapType \n                            order by Q.ReportID "),null!=this.dsData&&this.dsData.Tables[0].length>0&&this.dsData.Tables[0].forEach(q=>{let n=new De.v;n.DBColumnID=parseInt(q.ReportID),n.Label=q.ReportName.toString(),this.dsData.Columns[0].Contains("Shortcut")&&(n.KeyTip=q.Shortcut.toString()),this.dsData.Columns[0].Contains("DisplayAsPopup")&&""!=q.DisplayAsPopup.toString()&&(n.Dependantinuse="1"==q.DisplayAsPopup.toString()),this.dsData.Columns[0].Contains("Width")&&""!=q.Width.toString()&&(n.Width=q.Width.toString()),this.dsData.Columns[0].Contains("Height")&&""!=q.Height.toString()&&(n.Length=q.Height.toString()),this.dsData.Columns[0].Contains("DocumentField")&&""!=q.DocumentField.toString()&&(n.Formula=q.DocumentField.toString()),this.dsData.Columns[0].Contains("mapxml")&&""!=q.mapxml.toString()&&(n.ToolTipDescription=q.mapxml.toString()),h.Contains(parseInt(q.ReportID))||(h.push(parseInt(q.ReportID)),this.ReportsList.push(n)),0==this.ReportsList.length&&(this.ButtonReport.Visible=!1)})}OnReportsLinkClick(h){var le=this;return(0,de.A)(function*(){const{ReportViewModel:q}=yield Promise.resolve().then(G.bind(G,39026)),{ReportViewComponent:n}=yield Promise.resolve().then(G.bind(G,31503));let B,He={strXML:""},ze=new q;if(le.DisplayMessage=le.GetReportFilterXML(h,He),B=He.strXML,0==le.DisplayMessage.length){var te=le.ReportsList.find(Ze=>Ze.DBColumnID==parseInt(h));if(null!=te&&te.Dependantinuse)ze.ReportViewModel_Document(le.CostCenterID,B,parseInt(h),!0,null,null),!Ae.J0.IsEmpty(te.Width)&&Ae.J0.Double(te.Width)>0&&(ze.RptWidth=Ae.J0.Double(te.Width)),!Ae.J0.IsEmpty(te.length)&&Ae.J0.Double(te.length)>0&&(ze.RptHeight=Ae.J0.Double(te.length)),ze.DocumentObject=le,I.d.page.HideDialog(le.PopUpGUID),I.d.page.ShowDialog(ze,n,{Title:"",HideClose:!0,ShowCenter:!0});else{let Ze=new q;Ze.ReportViewModel_Document(le.CostCenterID,B,parseInt(h),!1,null,null),Ze.DocumentObject=le,I.d.page.HideDialog(le.PopUpGUID),I.d.page.addNewTab({component:n,params:{obj:Ze}})}}})()}GetReportFilterXML(h,le){let q="";le.strXML="";let n=this.dsData.Tables[0];n=n.filter(B=>B.ReportID==h);let ze,He=!1;n.forEach(B=>{(0,Be.yG0)(B.GroupLevel)&&(He=!0)}),q+="<XML",He&&(q+=' GroupLevel="1"'),q+=" >";for(let B=0;B<n.length;B++){if(ze=n[B].ReportField.toString(),q+="<Row ",q+='ColID ="'+ze+'" ',!Ae.J0.IsEmpty(n[B].SysColumnName)&&"-1"==n[B].DocumentField.toString()){if(0==this.SelectedEmpID)return alert(this.ErrorMessage+"Employee '"),"Empty Value";q+='Value ="'+this.SelectedEmpID+'" '}q+=" />"}return q+="</XML>",le.strXML=q.toString(),""}GetVacationDays(h,le,q){Logger.InfoLog("FinalSettlementViewModel::  Entered into GetVacationDays");let n=[];return n.push(h.ToString("dd MMM yyyy")),n.push(le.ToString("dd MMM yyyy")),n.push(q),n.push(-200),n.push(0),n.push(0),n.push(0),n.push(I.d.SessionManager.UserID),n.push(I.d.SessionManager.LanguageID),I.d.empService.GetVacationDays(n)}}},43311:(qt,ot,G)=>{G.r(ot),G.d(ot,{FinalSettlementComponent:()=>Jt});var de=G(11798),I=G(32040),Ae=G(84151),r=G(23458),_e=G(7321),at=G(88310),mt=G(54581),v=G(43767),s=G(11592),xe=G(31051),$e=G(5879),st=G(58170),qe=G(17970),yt=G(30786),Re=G(5109),ee=G(21774),De=G(27730),Be=G(12002),Se=G(48800),lt=G(27864),h=G(15390),le=G(11417),q=G(66096),n=G(96598),He=G(43357),ze=G(67700),B=G(71923),te=G(24649),Ze=G(91435),It=G(96336);function rt(Q,ie){if(1&Q){const c=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(c);const M=n.XpG();return n.Njj(M.obj.Button_Click("Approve"))}),n.nrm(1,"i",44),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Q&&(n.R7$(2),n.JRh(n.bMT(3,1,"Approve")))}function it(Q,ie){if(1&Q){const c=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(c);const M=n.XpG();return n.Njj(M.obj.Button_Click("Save"))}),n.nrm(1,"i",45),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Q&&(n.R7$(2),n.JRh(n.bMT(3,1,"Post")))}function wt(Q,ie){if(1&Q){const c=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(c);const M=n.XpG();return n.Njj(M.obj.Button_Click("SaveAndPrint"))}),n.nrm(1,"i",46),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Q&&(n.R7$(2),n.JRh(n.bMT(3,1,"SaveAndPrint")))}function zt(Q,ie){if(1&Q){const c=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(c);const M=n.XpG();return n.Njj(M.obj.Button_Click("Delete"))}),n.nrm(1,"i",47),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Q&&(n.R7$(2),n.JRh(n.bMT(3,1,"Delete")))}function Zt(Q,ie){if(1&Q){const c=n.RV6();n.j41(0,"span",10),n.bIt("click",function(){n.eBV(c);const M=n.XpG();return n.Njj(M.obj.Button_Click("Report"))}),n.nrm(1,"i",48),n.EFF(2),n.nI1(3,"translate"),n.k0s()}2&Q&&(n.R7$(2),n.JRh(n.bMT(3,1,"Report")))}function St(Q,ie){if(1&Q){const c=n.RV6();n.j41(0,"div",27),n.EFF(1,"\n                "),n.j41(2,"div"),n.EFF(3,"\n                  "),n.j41(4,"div",49),n.EFF(5,"\n                    "),n.eu8(6,50),n.EFF(7,"\n                    "),n.j41(8,"div",51),n.EFF(9,"\n                      "),n.j41(10,"label",52),n.EFF(11),n.k0s(),n.EFF(12,"\n                      "),n.j41(13,"div",53),n.EFF(14,"\n                        "),n.j41(15,"span",54),n.bIt("click",function(){n.eBV(c);const M=n.XpG();return n.Njj(M.Calculate_Click("Previous"))}),n.nrm(16,"i",55),n.k0s(),n.EFF(17,"\n                        "),n.j41(18,"span",54),n.bIt("click",function(){n.eBV(c);const M=n.XpG();return n.Njj(M.Calculate_Click("Next"))}),n.nrm(19,"i",56),n.k0s(),n.EFF(20,"\n                      "),n.k0s(),n.EFF(21,"\n                    "),n.k0s(),n.EFF(22,"\n                  "),n.k0s(),n.EFF(23,"\n                  \n                  \n                "),n.k0s(),n.EFF(24,"\n              "),n.k0s()}if(2&Q){const c=n.XpG();n.R7$(6),n.Y8G("obj",c.obj.txtDocNo)("group",c.form),n.R7$(5),n.JRh(c.obj.lblDocNo)}}function xt(Q,ie){if(1&Q&&(n.j41(0,"div",27),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.obj.dtpDocDate)("group",c.form)}}function Mt(Q,ie){if(1&Q&&(n.j41(0,"div",57),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.obj.EmployeeList)("group",c.form)}}function Ye(Q,ie){if(1&Q&&(n.j41(0,"div",27),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.obj.cmbSettlementType)("group",c.form)}}function Gt(Q,ie){if(1&Q&&(n.j41(0,"div",27),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.obj.dtpDateOfJoining)("group",c.form)}}function ft(Q,ie){if(1&Q&&(n.j41(0,"div",27),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.obj.dtpDateOfRelieving)("group",c.form)}}function Et(Q,ie){if(1&Q&&(n.j41(0,"div",57),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.obj.txtRemarks)("group",c.form)}}function Pt(Q,ie){if(1&Q&&(n.j41(0,"div",27),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.obj.txtNetAmount)("group",c.form)}}function ea(Q,ie){if(1&Q&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.EFF(2,"\n              "),n.nrm(3,"app-PactGridView",59),n.EFF(4,"\n            "),n.k0s()),2&Q){const c=n.XpG();n.R7$(3),n.Y8G("obj",c.dgvGratuity)("group",c.form)}}function ta(Q,ie){if(1&Q&&(n.j41(0,"div",36),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.cmbResignType)("group",c.form)}}function aa(Q,ie){if(1&Q&&(n.j41(0,"div",36),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.cmbResignReason)("group",c.form)}}function sa(Q,ie){if(1&Q&&(n.j41(0,"div",36),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.txtGratuityAmount)("group",c.form)}}function Ft(Q,ie){if(1&Q&&(n.j41(0,"div",36),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.txtAvailedGratuityAmount)("group",c.form)}}function la(Q,ie){if(1&Q&&(n.j41(0,"div",36),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.txtPartialGratuityAmount)("group",c.form)}}function ia(Q,ie){if(1&Q&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.dgvLeaveEncash)("group",c.form)}}function kt(Q,ie){if(1&Q&&(n.j41(0,"div",36),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.txtCumLeaveSalBalAmt)("group",c.form)}}function _t(Q,ie){if(1&Q&&(n.j41(0,"div",36),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.txtLEAmount)("group",c.form)}}function na(Q,ie){if(1&Q&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&Q){const c=n.XpG(2);n.R7$(2),n.Y8G("obj",c.dgvUPS)("group",c.form)}}function oa(Q,ie){if(1&Q&&(n.j41(0,"div",36),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG(2);n.R7$(2),n.Y8G("obj",c.txtUPSAmount)("group",c.form)}}function bt(Q,ie){if(1&Q){const c=n.RV6();n.j41(0,"tab",31),n.bIt("selectTab",function(){n.eBV(c);const M=n.XpG();return n.Njj(M.onSelectTab("dgvUPS"))}),n.EFF(1,"\n          "),n.j41(2,"div",41),n.EFF(3,"\n            "),n.DNE(4,na,4,2,"div",33),n.EFF(5,"\n            "),n.j41(6,"div",42),n.EFF(7,"\n              "),n.j41(8,"div",36),n.EFF(9,"\n                "),n.eu8(10,37),n.EFF(11,"\n              "),n.k0s(),n.EFF(12,"\n              "),n.DNE(13,oa,4,2,"div",35),n.EFF(14,"\n            "),n.k0s(),n.EFF(15,"\n          "),n.k0s(),n.EFF(16,"\n        "),n.k0s()}if(2&Q){const c=n.XpG();n.FS9("heading",c.tpUnProcessedSalary),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",c.dgvUPS.Visible),n.R7$(6),n.Y8G("obj",c.UPSRemarks)("group",c.form),n.R7$(3),n.Y8G("ngIf",c.txtUPSAmount.Visible)}}function ct(Q,ie){if(1&Q&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.dgvNoticePay)("group",c.form)}}function jt(Q,ie){if(1&Q&&(n.j41(0,"div",36),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.txtNPAmount)("group",c.form)}}function Bt(Q,ie){if(1&Q&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.dgvOthAdd)("group",c.form)}}function Wt(Q,ie){if(1&Q&&(n.j41(0,"div",36),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.txtOthAddAmount)("group",c.form)}}function ra(Q,ie){if(1&Q&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.dgvOthDed)("group",c.form)}}function da(Q,ie){if(1&Q&&(n.j41(0,"div",36),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.txtOthDedAmount)("group",c.form)}}function ha(Q,ie){if(1&Q&&(n.j41(0,"div",58),n.EFF(1,"\n              "),n.nrm(2,"app-PactGridView",59),n.EFF(3,"\n            "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.dgvLoanBal)("group",c.form)}}function Nt(Q,ie){if(1&Q&&(n.j41(0,"div",36),n.EFF(1,"\n                "),n.eu8(2,37),n.EFF(3,"\n              "),n.k0s()),2&Q){const c=n.XpG();n.R7$(2),n.Y8G("obj",c.txtLoanBalAmount)("group",c.form)}}let Jt=(()=>{class Q{constructor(){this.form=new de.gE({}),this.IsAccordionOpen=!0,this.EmpSeqNo=0,this.GratuityGrade=0,this.EmpGrade=0,this.GratuityDocID=0,this.sDocNo="0",this.strFormula="",this.isLoaded=!1,this.dblAmount=0,this.drwRes=null,this.chkCalcBasedOnLastSal=new s.c,this.chkCalcBasedOnActDays=new s.c,this.chkLECalcBasedOnLastApprSerYearWise=new s.c,this.GratuityRemarks=new Ae.Dw(0),this.LeaveRemarks=new Ae.Dw(0),this.UPSRemarks=new Ae.Dw(0),this.NoticePayRemarks=new Ae.Dw(0),this.OAddRemarks=new Ae.Dw(0),this.ODedRemarks=new Ae.Dw(0),this.LoanRemarks=new Ae.Dw(0),this.txtGratuityAmount=new Ae.Dw(0),this.txtAvailedGratuityAmount=new Ae.Dw(0),this.txtPartialGratuityAmount=new Ae.Dw(0),this.txtCumLeaveSalBalAmt=new Ae.Dw(0),this.txtLEAmount=new Ae.Dw(0),this.txtUPSAmount=new Ae.Dw(0),this.txtOthAddAmount=new Ae.Dw(0),this.txtOthDedAmount=new Ae.Dw(0),this.txtNPAmount=new Ae.Dw(0),this.txtLoanBalAmount=new Ae.Dw(0),this.lblGratuityTotalDays="",this.lblGratuityServiceDays="",this.lblGratuityLOPDays="",this.lblGratuityBalDays="",this.lblGratuityTotalGrDays="",this.lblGratuityTaken="",this.lblActRelievingDate="",this.dgvGratuity=new _e.vv,this.dgvLeaveEncash=new _e.vv,this.dgvUPS=new _e.vv,this.dgvOthAdd=new _e.vv,this.dgvOthDed=new _e.vv,this.dgvNoticePay=new _e.vv,this.dgvLoanBal=new _e.vv,this.lblDocNo="",this.tpGratuity="",this.tpLeaveEncashment="",this.tpUnProcessedSalary="",this.tpNoticePay="",this.tpOtherAdditions="",this.tpOtherDeductions="",this.tpLoanBalances="",this.btnCalcGratuity="",this.lbl1GratuityTotalDays="",this.lbl1GratuityServiceDays="",this.lbl1GratuityLOPDays="",this.lbl1GratuityBalDays="",this.lbl1GratuityTotalGrDays="",this.lblGratuityAmount="",this.lblAvailedGratuityAmount="",this.lblPartialGratuityAmount="",this.lbl1GratuityTaken="",this.lblCumLeaveSalBalAmt="",this.btnCalcLE="",this.lblLEAmount="",this.lblUPSAmount="",this.lblNPAmount="",this.lblOthAddAmount="",this.lblOthDedAmount="",this.lblLoanBalAmount="",this.dtEdit=null,this.iCurDocNo=0,this.CostCenterID=40095,this.DefProdID=0,this.dblBasic=0,this.EOS_ROff=0,this.dServiceDaysFormulaAmount=0,this.dblGratuityAmount=0,this.dActServiceDays=0,this.dServiceDaysAfterLOP=0,this.dLOPDays=0,this.EOS_ROffYear=0,this.isLast=!1,this.isConsdExpiredupto=!1,this.sVacTypeSeqNo="-1",this.EOS_GratuityFormula="",this.EOS_AvailedFormula="",this.EOS_MaxDays=0,this.dEarnedGrDays=0,this.lst=new Array,this.dTotGratuityDays=0,this.dGratuityTaken=0,this.isMaxDaysExceded=!1,this.oEvalPayFormulas=null}ngOnInit(){this.obj=this.params?.obj,this.FinalSettlement_DataContextChanged(),this.FinalSettlement_Loaded(),console.log(this)}onSelectTab(c){console.log(c),console.log(this.dgvLeaveEncash.Table),console.log(this.dgvLeaveEncash.Columns),c.length>0&&setTimeout(()=>{this[c].refreshUI(),this[c].refreshDataView()},1e3)}get txtDocNo(){return this.ViewModel.txtDocNo}get txtRemarks(){return this.ViewModel.txtRemarks}get txtNetAmount(){return this.ViewModel.txtNetAmount}get EmployeeList(){return this.ViewModel.EmployeeList}get cmbResignType(){return this.ViewModel.cmbResignType}get cmbResignReason(){return this.ViewModel.cmbResignReason}get cmbSettlementType(){return this.ViewModel.cmbSettlementType}get dtpDocDate(){return this.ViewModel.dtpDocDate}get dtpDateOfJoining(){return this.ViewModel.dtpDateOfJoining}get dtpDateOfRelieving(){return this.ViewModel.dtpDateOfRelieving}FinalSettlement_DataContextChanged(){this.ViewModel=this.params?.obj,this.ViewModel.CalculateClick.Subscribe(this,"Calculate_Click"),this.ViewModel.EmpSelectionChanged.Subscribe(this,"Employee_SelectionChanged"),this.ViewModel.txtDocNo.LostFocusCommand.Subscribe(this,"txtDocNo_LostFocus"),this.dgvOthAdd.CellEditEnding.Subscribe(this,"dgvOthAdd_CellEndEdit"),this.dgvOthDed.CellEditEnding.Subscribe(this,"dgvOthDed_CellEndEdit"),this.dtpDateOfRelieving.SelectedDateChanged.Subscribe(this,"dtpDateOfRelieving_SelectedDateChanged")}FinalSettlement_Loaded(){this.isLoaded||(this.LoadGrids(),this.Clear_Click(),this.dsLookups=I.d.common.GetDataSet("CRM015",""),this.dgvOthAdd.Columns.find(c=>"dgColOthAddParticulars"==c.ValueBinding).ComboData=this.dsLookups.Tables[0],this.dgvOthDed.Columns.find(c=>"dgColOthDedParticulars"==c.ValueBinding).ComboData=this.dsLookups.Tables[1],this.dgvOthAdd.CanUserAddRows=!0,this.dgvOthAdd.CanUserDeleteRows=!0,this.dgvOthAdd.addEmptyRow(),this.dgvOthDed.CanUserAddRows=!0,this.dgvOthDed.CanUserDeleteRows=!0,this.dgvOthDed.addEmptyRow(),this.dgvOthAdd.refreshDataView(),this.lblDocNo=this.GetResource("VoucherNo",40095),this.tpGratuity=this.GetResource("Gratuity",40095),this.tpLeaveEncashment=this.GetResource("Leave Encashment",40095),this.tpUnProcessedSalary=this.GetResource("Un-Processed Salary",40095),this.tpNoticePay=this.GetResource("Notice Pay",40095),this.tpOtherAdditions=this.GetResource("Other Additions",40095),this.tpOtherDeductions=this.GetResource("Other Deductions",40095),this.tpLoanBalances=this.GetResource("Loan Balances",40095),this.chkCalcBasedOnLastSal.Label=this.GetResource("Calculate based on Last Salary",40095),this.chkCalcBasedOnActDays.Label=this.GetResource("Calculate Salary based on Actual Days",40095),this.btnCalcGratuity=this.GetResource("Calculate",40095),this.lbl1GratuityTotalDays=this.GetResource("Total Days",40095)+" : ",this.lbl1GratuityServiceDays=this.GetResource("Service Days",40095)+" : ",this.lbl1GratuityLOPDays=", "+this.GetResource("LOP",40095)+" : ",this.lbl1GratuityBalDays=", "+this.GetResource("Balance",40095)+" : ",this.lbl1GratuityTotalGrDays=this.GetResource("Total Gratuity Days",40095)+" : ",this.lbl1GratuityTaken=this.GetResource("Gratuity Taken",40095)+" : ",this.lblGratuityAmount=this.GetResource("Gratuity Amount",40095),this.lblAvailedGratuityAmount=this.GetResource("Availed Gratuity Amount",40095),this.lblPartialGratuityAmount=this.GetResource("Partial Gratuity Amount",40095),this.lblCumLeaveSalBalAmt=this.GetResource("Cumulative Leave Salary Balance Amount",40095),this.chkLECalcBasedOnLastApprSerYearWise.Label=this.GetResource("Calculate based on Last Appraisal - Service Year Wise",40095),this.btnCalcLE=this.GetResource("Calculate",40095),this.lblLEAmount=this.GetResource("Amount",40095),this.lblUPSAmount=this.GetResource("Amount",40095),this.lblNPAmount=this.GetResource("Amount",40095),this.lblOthAddAmount=this.GetResource("Amount",40095),this.lblOthDedAmount=this.GetResource("Amount",40095),this.lblLoanBalAmount=this.GetResource("Amount",40095),this.isLoaded=!0,""!=this.ViewModel.sVNo&&this.LoadDocument(parseInt(this.ViewModel.sVNo.Replace("FST-",""))))}txtDocNo_LostFocus(c){try{this.txtDocNo.Text.Trim().length>0&&this.LoadDocument(parseInt(this.txtDocNo.Text.Trim()))}catch{this.ViewModel.DisplayMessage="Enter Valid DocNo."}}LoadDocument(c){let D;this.ViewModel.DisplayMessage="",this.ViewModel.MessageVisibility=!0,this.sDocNo=c.toString();let M=I.d.common.GetDataTable("CRM016",c.toString());if(null!=M&&M.length>0){if(!v.J0.IsEmpty(I.d.SessionManager.sEmpFilteredEmpSeqNos)&&!I.d.SessionManager.sEmpFilteredEmpSeqNos.split(",").Contains(parseInt(M[0].EmpSeqNo).toString()))return this.ViewModel.DisplayMessage="You don't have permission to view this Document.",this.ViewModel.MessageVisibility=!0,this.Clear_Click(),this.txtDocNo.Text=c.toString(),void(this.EmployeeList.IsEnabled=!1);this.EmployeeList.IsEnabled=!0,this.EmployeeList.SelectedValue=parseInt(M[0].EmpSeqNo),this.EmployeeList.SelectedValue=parseInt(M[0].EmpSeqNo),this.ClearControlValues(),this.dtEdit=null,this.EmpSeqNo=parseInt(M[0].EmpSeqNo),this.dtEdit=I.d.common.GetDataTable("CRM018",this.EmpSeqNo.toString()+"~"+c),null!=this.dtEdit&&this.dtEdit.length>0&&(this.dtpDocDate.Date=v.J0.ParseDate(this.dtEdit[0].cDocDate));let P=new Date(this.dtpDocDate.Date.getFullYear(),this.dtpDocDate.Date.iMonth(),1),b=[];if(b.push(this.EmpSeqNo),b.push(0),b.push(this.dtpDocDate.Date.ToString("dd MMM yyyy")),b.push(P.ToString("dd/MMM/yyyy")),b.push(c),b.push(1),b.push(I.d.SessionManager.UserID),b.push(I.d.SessionManager.RoleID),b.push(I.d.SessionManager.LanguageID),this.dsD=I.d.common.GetDataSet_SP(b,"spPAY_GetEmpFinalSettlement"),null!=this.dsD&&this.dsD.Tables.length>0&&this.dsD.Tables[0].length>0){if(this.dtpDateOfJoining.Date=v.J0.ParseDate(this.dsD.Tables[0][0].DOJ),this.EmpGrade=parseInt(this.dsD.Tables[13][0].HistoryNodeID),this.cmbSettlementType.SelectedValue="Final",this.DOB=v.J0.ParseDate(this.dsD.Tables[0][0].DOB),9e3!=v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()?(this.dtpDateOfRelieving.Date=v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.dtActRelievingDate=v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.lblActRelievingDate=this.GetResource("Actual Relieving Date",40095)+" : "+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")):this.dtpDateOfRelieving.Date=new Date,this.cmbResignType.SelectedValue=v.J0.IsEmpty(this.dsD.Tables[0][0].ResignType)||!this.dsD.Tables[0][0].ResignType.toString().startsWith("Terminated")&&!this.dsD.Tables[0][0].ResignType.toString().startsWith("Expired")?"Resigned":this.dsD.Tables[0][0].ResignType.toString(),"Posted"==v.J0.String(this.dsD.Tables[0][0].ResignStatus)){let X=v.J0.ParseDate(this.dsD.Tables[0][0].DOResign),J=new Date(X.getFullYear(),X.iMonths(),1),Y=new Date,R=J;"Terminated With Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=I.d.SessionManager.Preferences.NPTerminatedWithCause&&parseInt(I.d.SessionManager.Preferences.NPTerminatedWithCause)>0&&(Y=J.AddMonths(parseInt(I.d.SessionManager.Preferences.NPTerminatedWithCause)-1)):"Terminated Without Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=I.d.SessionManager.Preferences.NPTerminatedWithOutCause&&parseInt(I.d.SessionManager.Preferences.NPTerminatedWithOutCause)>0&&(Y=J.AddMonths(parseInt(I.d.SessionManager.Preferences.NPTerminatedWithOutCause)-1)):"Resigned"==this.dsD.Tables[0][0].ResignType.toString()&&""!=I.d.SessionManager.Preferences.NPResignation&&parseInt(I.d.SessionManager.Preferences.NPResignation)>0&&(Y=J.AddMonths(parseInt(I.d.SessionManager.Preferences.NPResignation)-1));let H=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfRelieving.Date.iMonth(),1);if(Y<H)for(;Y<H;)Y=Y.AddMonths(1);let ge,Z=new Date,ce=new Date,ne=new Date;for(;R<=Y;){if(D=this.dsD.Tables[5].filter(Me=>Me.PayrollDate==R.ToString("dd/MMM/yyyy")),null==D||0==D.length){if(this.dgvNoticePay.addEmptyRow(),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPType="Add",this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPPayrollMonth=R.ToString("dd/MMM/yyyy"),"Actual Days"==I.d.SessionManager.Preferences.PayDays){let Me={PayrollMonth:Z,PayrollMonthStart:ce,PayrollMonthEnd:ne};if(v.J0.SetPayrollDate_1(R,Me),Z=Me.PayrollMonth,ce=Me.PayrollMonthStart,ne=Me.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let We=0;We=v.J0.GetEmployeeGrade(this.EmpSeqNo.toString(),Z,ce,ne),We>0&&(v.J0.SetPayrollDate_1(R,Me,this.EmpGrade),Z=Me.PayrollMonth,ce=Me.PayrollMonthStart,ne=Me.PayrollMonthEnd)}ge=ne.Subtract(ce).Days+1}else ge=parseInt(I.d.SessionManager.Preferences.PayDays);this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPMonthDays=ge,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPDaysAtt=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPLOP=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPNetSal=(0).ToString(I.d.SessionManager.sPayrollDecimals)}R=R.AddMonths(1)}}if(this.dsD.Tables[2].length>0&&(this.sVacTypeSeqNo=this.dsD.Tables[2][0].VacationField.toString()),this.ViewModel.WID=this.dsD.Tables[12].length>0?parseInt(this.dsD.Tables[12][0].WorkFlowID):0,this.dsD.Tables[1].length>0&&this.RefreshLeaveEncashDetails(),this.dsD.Tables[8].length>0&&I.d.SessionManager.Preferences.ContainsKey("DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement")&&"False"==I.d.SessionManager.Preferences.DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement.toString()){let X=0,J=0;for(let Y=0;Y<this.dsD.Columns[8].length;Y++)v.J0.IsEmpty(this.dsD.Tables[8][0][Y])||(X+=parseFloat(this.dsD.Tables[8][0][Y]));for(let Y=0;Y<this.dsD.Tables[9].length;Y++)v.J0.IsEmpty(this.dsD.Tables[9][Y].Amount)||(J+=parseFloat(this.dsD.Tables[9][Y].Amount));this.txtCumLeaveSalBalAmt.Text=(X-J).ToString(I.d.SessionManager.sPayrollDecimals)}else this.txtCumLeaveSalBalAmt.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals);if(this.txtLEAmount.Text=parseFloat(this.txtCumLeaveSalBalAmt.Text).ToString(I.d.SessionManager.sPayrollDecimals),this.AutoCalculateLeaveEncashment(),this.dsD.Tables[3].length>0&&(this.dblBasic=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly.toString())),this.dsD.Tables[4].length>0){let X;this.dgvUPS.addEmptyRows(this.dsD.Tables[4].length);for(let J=0;J<this.dsD.Tables[4].length;J++)X=v.J0.ParseDate(this.dsD.Tables[4][J].PayrollMonth),this.dgvUPS.Table[J].dgColUPSPayrollMonth=X.ToString("dd/MMM/yyyy"),this.dgvUPS.Table[J].dgColUPSMonthDays=X.DaysInMonth(),this.dgvUPS.Table[J].dgColUPSDaysAtt=0,this.dgvUPS.Table[J].dgColUPSLOP=0,this.dgvUPS.Table[J].dgColUPSNetSal=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvUPS.Table[J].dgColUPSCalc=this.GetResource("Calculate",40095),this.dgvUPS.updateRow(this.dgvUPS.Table[J])}let w=0;if(this.dsD.Tables[10].length>0){this.dgvLoanBal.addEmptyRows(this.dsD.Tables[10].length);for(let X=0;X<this.dsD.Tables[10].length;X++)this.dgvLoanBal.Table[X].dgColLoanBalSNo=(X+1).toString(),this.dgvLoanBal.Table[X].dgColLoanBalDocNo=this.dsD.Tables[10][X].DocNo.toString(),this.dgvLoanBal.Table[X].dgColLoanBalDocNo_Tag=this.dsD.Tables[10][X].DocID.toString(),this.dgvLoanBal.Table[X].dgColLoanBalLoanType=this.dsD.Tables[10][X].LoanType.toString(),this.dgvLoanBal.Table[X].dgColLoanBalLoanType_Tag=this.dsD.Tables[10][X].LoanCompID.toString(),this.dgvLoanBal.Table[X].dgColLoanBalApprAmount=parseFloat(this.dsD.Tables[10][X].ApprovedAmt).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[X].dgColLoanBalAmountPaid=parseFloat(this.dsD.Tables[10][X].Paid).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[X].dgColLoanBalBalAmount=parseFloat(this.dsD.Tables[10][X].Balance).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[X].dgColLoanBalCalc="Pay",w+=parseFloat(this.dsD.Tables[10][X].Balance),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[X])}this.txtLoanBalAmount.Text=w.ToString(I.d.SessionManager.sPayrollDecimals),this.ViewModel.ApproveVisibility=!1;let $=null;if(null!=this.dtEdit&&this.dtEdit.length>0){if(this.ViewModel.DocStatus="["+this.dtEdit[0].DocStatus.toString()+"]",this.ViewModel.DocID=parseInt(this.dtEdit[0].DocID),this.sDocNo=this.dtEdit[0].DocNumber.toString(),this.txtDocNo.Text=this.sDocNo,this.dtpDocDate.Date=v.J0.ParseDate(this.dtEdit[0].cDocDate),this.dtpDateOfRelieving.Date=v.J0.ParseDate(this.dtEdit[0].dcAlpha3),this.txtRemarks.Text=this.dtEdit[0].CommonNarration.toString(),this.ViewModel.StatusID=parseInt(this.dtEdit[0].StatusID),this.ViewModel.WID=parseInt(this.dtEdit[0].WorkflowID),this.cmbSettlementType.Text=v.J0.String(this.dtEdit[0].dcAlpha10),$=I.d.common.GetDataSet("CRM029",this.ViewModel.DocID.toString()),D=this.dtEdit.filter(R=>"1"==R.dcAlpha1),null!=D&&D.length>0&&(this.GratuityRemarks.Text=D[0].dcAlpha8.toString(),this.cmbResignType.Text=D[0].dcAlpha11.toString(),this.chkCalcBasedOnLastSal.IsChecked=(0,mt.yG0)(D[0].dcAlpha12),this.chkCalcBasedOnActDays.IsChecked=(0,mt.yG0)(D[0].dcAlpha13),this.cmbResignReason.SelectedValue=D[0].dcAlpha33.toString(),this.Calculate_Click("Gratuity"),this.txtPartialGratuityAmount.Text=parseFloat(D[0].dcCalcNum4).ToString(I.d.SessionManager.sPayrollDecimals)),D=this.dtEdit.filter(R=>"2"==R.dcAlpha1),null!=D&&D.length>0){this.LeaveRemarks.Text=D[0].dcAlpha8.toString(),this.chkLECalcBasedOnLastApprSerYearWise.IsChecked=!v.J0.IsEmpty(D[0].dcAlpha17)&&(0,mt.yG0)(D[0].dcAlpha17);for(let R=0;R<D.length;R++)for(let H=0;H<this.dgvLeaveEncash.Table.length;H++)if(D[R].dcAlpha11.toString()==this.dgvLeaveEncash.Table[H+"_Tag"].toString()){this.dgvLeaveEncash.Table[H].dgColLEAvailable=D[R].dcAlpha13.toString(),this.dgvLeaveEncash.Table[H].dgColLEMaxEncash=D[R].dcAlpha14.toString(),this.dgvLeaveEncash.Table[H].dgColLEApplied=D[R].dcAlpha15.toString();break}this.Calculate_Click("LeaveEncash")}if(D=this.dtEdit.filter(R=>"3"==R.dcAlpha1),null!=D&&D.length>0){this.UPSRemarks.Text=D[0].dcAlpha8.toString();for(let R=0;R<D.length;R++)for(let H=0;H<this.dgvUPS.Table.length;H++)if(v.J0.ParseDate(D[R].dcAlpha11)==v.J0.ParseDate(this.dgvUPS.Table[H].dgColUPSPayrollMonth)){this.dgvUPS.Table[H].dgColUPSDaysAtt=D[R].dcAlpha13.toString(),this.dgvUPS.Table[H].dgColUPSLOP=D[R].dcAlpha14.toString(),this.dgvUPS.Table[H].dgColUPSNetSal=D[R].dcAlpha15.toString();break}this.txtUPSAmount.Text=parseFloat(D[0].dcCalcNum1).ToString(I.d.SessionManager.sPayrollDecimals)}if(D=this.dtEdit.filter(R=>"4"==R.dcAlpha1),null!=D&&D.length>0){this.NoticePayRemarks.Text=D[0].dcAlpha8.toString();for(let R=0;R<D.length;R++)for(let H=0;H<this.dgvNoticePay.Table.length;H++)if(v.J0.ParseDate(D[R].dcAlpha11)==v.J0.ParseDate(this.dgvNoticePay.Table[H].dgColNPPayrollMonth)){this.dgvNoticePay.Table[H].dgColNPDaysAtt=D[R].dcAlpha13.toString(),this.dgvNoticePay.Table[H].dgColNPLOP=D[R].dcAlpha14.toString(),this.dgvNoticePay.Table[H].dgColNPNetSal=D[R].dcAlpha15.toString(),this.dgvNoticePay.Table[H].dgColNPType=D[R].dcAlpha16.toString(),this.dgvNoticePay.Table[H].dgColNPCalc=this.GetResource("Calculate",40095),this.dgvNoticePay.updateRow(this.dgvNoticePay.Table[H]);break}this.txtNPAmount.Text=parseFloat(D[0].dcCalcNum1).ToString(I.d.SessionManager.sPayrollDecimals)}if(D=this.dtEdit.filter(R=>"5"==R.dcAlpha1),null!=D&&D.length>0){this.OAddRemarks.Text=D[0].dcAlpha8.toString(),this.dgvOthAdd.addEmptyRows(D.length);for(let R=0;R<D.length;R++)this.dgvOthAdd.Table[R].dgColOthAddParticulars=parseInt(D[R].dcAlpha11.toString()),this.dgvOthAdd.Table[R].dgColOthAddAmount=D[R].dcAlpha12.toString(),v.J0.IsEmpty(D[R].dcAlpha13)||(this.dgvOthAdd.Table[R].dgColOthAddRemarks=D[R].dcAlpha13.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[R]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2)}if(D=this.dtEdit.filter(R=>"6"==R.dcAlpha1),null!=D&&D.length>0){this.ODedRemarks.Text=D[0].dcAlpha8.toString(),this.dgvOthDed.addEmptyRows(D.length);for(let R=0;R<D.length;R++)this.dgvOthDed.Table[R].dgColOthDedParticulars=parseInt(D[R].dcAlpha11.toString()),this.dgvOthDed.Table[R].dgColOthDedAmount=D[R].dcAlpha12.toString(),v.J0.IsEmpty(D[R].dcAlpha13)||(this.dgvOthDed.Table[R].dgColOthDedRemarks=D[R].dcAlpha13.toString()),this.dgvOthDed.updateRow(this.dgvOthDed.Table[R]),this.dgvOthDed_CellEndEdit(this.dgvOthDed,2)}if(D=this.dtEdit.filter(R=>"7"==R.dcAlpha1),null!=D&&D.length>0){this.LoanRemarks.Text=D[0].dcAlpha8.toString();for(let R=0;R<D.length;R++)for(let H=0;H<this.dgvLoanBal.Table.length;H++)if(D[R].dcAlpha12.toString()==this.dgvLoanBal.Table[H].dgColLoanBalDocNo_Tag.toString()){this.dgvLoanBal.Table[H].dgColLoanBalCalc_Tag="Paid",this.dgvLoanBal.Table[H].dgColLoanBalSNo_Tag=D[R].dcAlpha17.toString(),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[H]);break}}if(null!=$&&$.Tables.length>0&&$.Tables[0].length>0){let R=$.Tables[0];if(null!=R&&R.length>0)for(let H=0;H<R.length;H++){let ge=new Se.AddAttachmentViewModel;ge.AddAttachmentViewModel_2(this.ViewModel),ge.AttachmentID=parseInt(R[H].FileID),ge.ActualFileName=R[H].ActualFileName.toString(),ge.FileExtension=R[H].FileExtension.toString(),ge.FileDescription=R[H].FileDescription.toString(),ge.FilePath=v.J0.GetPath(R[H].GUID+"."+R[H].FileExtension),ge.RelativeFileName=R[H].RelativeFileName.toString(),ge.IsProductImage=!1,this.ViewModel.ViewAttachments.AttachmentsList.push(ge)}}if(this.ViewModel.WID>0){let R=I.d.common.GetDataTable("CRM020",this.dtEdit[0].InvDocDetailsID.toString()+",95,'"+I.d.SessionManager.UserName+"',40095,"+this.ViewModel.WID+","+this.dtEdit[0].WorkFlowLevel.toString()+","+this.dtEdit[0].StatusID.toString()+","+this.dtEdit[0].CreatedDate.toString()+","+I.d.SessionManager.UserID+","+I.d.SessionManager.RoleID);null!=R&&R.length>0&&(null!=R[0].CanApprove&&null!=R[0].CanApprove&&"TRUE"==R[0].CanApprove.toString().toUpperCase()?(this.ViewModel.ApproveVisibility=!0,this.ViewModel.PostVisiblility=!1):this.ViewModel.PostVisiblility=!(!I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")&&!I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")))}let X=I.d.common.GetDataSet3("CRM021",this.CostCenterID.toString(),this.ViewModel.DocID.toString());this.ViewModel.WFDocLevelList.Clear();let J=null,Y=null;if(J=X.Tables[1],Y=X.Tables[0],null!=J&&J.length>0&&!I.d.SessionManager.IsActionAssigned(this.CostCenterID,"HideWorkflowLevels")){let H,R=parseInt(this.dtEdit[0].WorkFlowLevel);Y.length>0&&(H=parseInt(Y[Y.length-1].StatusID));let ge=Y.length>0?parseInt(Y[0].WORKFLOWLEVEL)-1:0;for(let Z=0;Z<J.length;Z++){let ce=new at.O(parseInt(J[0].WID),parseInt(J[Z].LEVELID),J[Z].LEVELNAME.toString(),this.CostCenterID,this.ViewModel.DocID,v.J0.ParseDate(J[Z].DocDate));Z==ge&&(ce.IsPending=!0,ce.Label="C"),0==Z&&(ce.LeftLineBrush="#FFFFFFFF"),Z==J.length-1&&(ce.RightLineBrush="#FFFFFFFF"),this.ViewModel.WFDocLevelList.push(ce)}for(let Z=Y.length-1;Z>=0;Z--){let ce=parseInt(Y[Z].WORKFLOWLEVEL);if(ce<=R&&ce<=this.ViewModel.WFDocLevelList.length&&!this.ViewModel.WFDocLevelList[ce-1].IsSet){this.ViewModel.WFDocLevelList[ce-1].IsSet=!0,this.ViewModel.WFDocLevelList[ce-1].ModifiedBy=Y[Z].STATUS.toString()+" By "+Y[Z].CREATEDBY.toString(),Y[Z].FIRSTNAME.toString().length>0&&(this.ViewModel.WFDocLevelList[ce-1].ModifiedBy+="("+Y[Z].FIRSTNAME.toString()+")");let ne=v.J0.ParseDate(Y[Z].DATE);this.ViewModel.WFDocLevelList[ce-1].ModifiedBy+=" On "+ne.ToString(I.d.SessionManager.Preferences["Date Format"]);let Me=parseInt(Y[Z].STATUSID);372==Me?this.ViewModel.WFDocLevelList[ce-1].IsRejected=!0:441==Me?this.ViewModel.WFDocLevelList[ce-1].IsApproved=!0:369==Me&&(this.ViewModel.WFDocLevelList[ce-1].IsPending=!0,this.ViewModel.WFDocLevelList[ce-1].Label=" P")}}}}else this.ViewModel.DocStatus="[UnPosted]",this.ViewModel.DocID=0,this.sDocNo="0",this.ViewModel.StatusID=0,this.ViewModel.PostVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ViewModel.UnPostVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete");this.CalculateTotalAmount()}this.ViewModel.EmployeeList.Code.SelectedValue=parseInt(M[0].EmpSeqNo),this.ViewModel.EmployeeList.Name.SelectedValue=parseInt(M[0].EmpSeqNo),this.ViewModel.DocID=parseInt(M[0].DocID),this.ViewModel.sVoucherNo=M[0].VoucherNo.toString()}else this.Clear_Click(),this.txtDocNo.Text=c.toString(),this.dtpDocDate.SetFocus=!0}Clear_Click(){this.GetNextDocNo(),this.EmployeeList.IsEnabled=!0,this.EmployeeList.SelectedValue=0,this.EmpSeqNo=0,this.ViewModel.DocID=0,this.ClearControlValues(),this.ViewModel.sCmdParameter="",this.ViewModel.SelectedEmpID=0,this.dTotGratuityDays=0,null!=this.ViewModel&&null!=this.ViewModel.WFDocLevelList&&this.ViewModel.WFDocLevelList.Clear(),this.ViewModel.ApproveVisibility=!1,this.ViewModel.PostVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.ViewModel.UnPostVisiblility=I.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),null!=this.ViewModel.ViewAttachments&&this.ViewModel.ViewAttachments.AttachmentsList.Clear(),this.ViewModel.ViewAttachments=new Be.ViewAttachmentViewModel(this.ViewModel,I.d.SessionManager,I.d.admin),this.ViewModel.OnAddAttachment()}ClearControlValues(){this.dtEdit=null,this.lblGratuityTotalDays="",this.lblGratuityServiceDays="",this.lblGratuityLOPDays="",this.lblGratuityBalDays="",this.lblGratuityTotalGrDays="",this.lblGratuityTaken="0",this.chkCalcBasedOnLastSal.Label="Calculate based on Last Salary",this.chkCalcBasedOnActDays.Label="Calculate Salary based on Actual Days",this.txtRemarks.Label=I.d.GetResource("Remarks"),this.txtRemarks.Text="",this.GratuityRemarks.Label=I.d.GetResource("Remarks"),this.GratuityRemarks.Text="",this.LeaveRemarks.Label=I.d.GetResource("Remarks"),this.LeaveRemarks.Text="",this.UPSRemarks.Label=I.d.GetResource("Remarks"),this.UPSRemarks.Text="",this.NoticePayRemarks.Label=I.d.GetResource("Remarks"),this.NoticePayRemarks.Text="",this.OAddRemarks.Label=I.d.GetResource("Remarks"),this.OAddRemarks.Text="",this.ODedRemarks.Label=I.d.GetResource("Remarks"),this.ODedRemarks.Text="",this.cmbSettlementType.SelectedIndex=0,this.LoanRemarks.Label=I.d.GetResource("Remarks"),this.LoanRemarks.Text="",this.dtpDocDate.Date=(new Date).Date(),this.cmbResignType.Label=I.d.GetResource("Resign Type"),this.cmbResignType.SelectedValue="Resigned",this.cmbResignReason.SelectedValue="",this.cmbResignReason.Label="Resign Reason",this.dblBasic=0,this.sDocNo="0",this.ViewModel.DocStatus="[UnPosted]",this.dGratuityTaken=0,this.dgvGratuity.Clear(),this.dgvLeaveEncash.Clear(),this.dgvUPS.Clear(),this.dgvOthAdd.Clear(),this.dgvOthDed.Clear(),this.dgvNoticePay.Clear(),this.dgvLoanBal.Clear(),this.txtGratuityAmount.Label=this.GetResource("Gratuity Amount",40095),this.txtGratuityAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtGratuityAmount.Align="right",this.txtAvailedGratuityAmount.Label=this.GetResource("Availed Gratuity Amount",40095),this.txtAvailedGratuityAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Align="right",this.txtPartialGratuityAmount.Label=this.GetResource("Partial Gratuity Amount",40095),this.txtPartialGratuityAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtPartialGratuityAmount.Align="right",this.txtCumLeaveSalBalAmt.Label=this.GetResource("Cumulative Leave Salary Balance Amount",40095),this.txtCumLeaveSalBalAmt.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtCumLeaveSalBalAmt.Align="right",this.txtLEAmount.Label=this.GetResource("Amount",40095),this.txtLEAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtLEAmount.Align="right",this.txtUPSAmount.Label=this.GetResource("Amount",40095),this.txtUPSAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtUPSAmount.Align="right",this.txtOthAddAmount.Label=this.GetResource("Amount",40095),this.txtOthAddAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtOthAddAmount.Align="right",this.txtOthDedAmount.Label=this.GetResource("Amount",40095),this.txtOthDedAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtOthDedAmount.Align="right",this.txtNPAmount.Label=this.GetResource("Amount",40095),this.txtNPAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtNPAmount.Align="right",this.txtLoanBalAmount.Label=this.GetResource("Amount",40095),this.txtLoanBalAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtLoanBalAmount.Align="right",this.txtNetAmount.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtNetAmount.Align="right",this.lblActRelievingDate="",null!=this.ViewModel.ViewAttachments&&this.ViewModel.ViewAttachments.AttachmentsList.Clear(),this.ViewModel.ViewAttachments=new Be.ViewAttachmentViewModel(this.ViewModel,I.d.SessionManager,I.d.admin),this.ViewModel.OnAddAttachment(),this.setDefaultRows()}setDefaultRows(){this.dgvOthAdd.addEmptyRow(),this.GenerateSerialNos(this.dgvOthAdd,"dgvOthAdd"),this.dgvOthDed.addEmptyRow(),this.GenerateSerialNos(this.dgvOthDed,"dgvOthDed")}GetNextDocNo(){let c=I.d.common.GetDataTable("CRM017","");null!=c&&(this.txtDocNo.Text=c.length>0?v.J0.IsEmpty(c[0].CurrentCodeNumber)?"1":parseInt(c[0].CurrentCodeNumber).toString():"1")}Employee_SelectionChanged(c){if(this.EmpSeqNo==c)return;this.EmpSeqNo=c,this.ClearControlValues();let D,M=new Date(this.dtpDocDate.Date.getFullYear(),this.dtpDocDate.Date.getMonth(),1),P=[];if(P.push(this.EmpSeqNo),P.push(this.ViewModel.DocID),P.push(this.dtpDocDate.Date.ToString("dd MMM yyyy")),P.push(M.ToString("dd/MMM/yyyy")),P.push(0),P.push(0),P.push(I.d.SessionManager.UserID),P.push(I.d.SessionManager.RoleID),P.push(I.d.SessionManager.LanguageID),this.dsD=I.d.common.GetDataSet_SP(P,"spPAY_GetEmpFinalSettlement"),null!=this.dsD&&this.dsD.Tables.length>0)if(this.dsD.Tables.length>14&&this.dsD.Tables[14].length>0)this.ViewModel.DisplayMessage="Employee FinalSettlement is Already done @VoucherNo - "+this.dsD.Tables[14][0].VoucherNo.ToString(),this.ViewModel.MessageVisibility=!0;else if(this.dsD.Tables[0].length>0){if(this.dtpDateOfJoining.Date=v.J0.ParseDate(this.dsD.Tables[0][0].DOJ),this.EmpGrade=parseInt(this.dsD.Tables[13][0].HistoryNodeID),this.DOB=v.J0.ParseDate(this.dsD.Tables[0][0].DOB),this.cmbSettlementType.SelectedValue="Final",9e3!=v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()?(this.dtpDateOfRelieving.Date=v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.dtActRelievingDate=v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve),this.lblActRelievingDate=this.GetResource("Actual Relieving Date",40095)+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")):this.dtpDateOfRelieving.Date=Date.Today(),this.cmbResignType.SelectedValue=v.J0.IsEmpty(this.dsD.Tables[0][0].ResignType)||!this.dsD.Tables[0][0].ResignType.toString().startsWith("Terminated")&&!this.dsD.Tables[0][0].ResignType.toString().startsWith("Expired")?"Resigned":this.dsD.Tables[0][0].ResignType.toString(),"Posted"==this.dsD.Tables[0][0].ResignStatus.toString()){let w=v.J0.ParseDate(this.dsD.Tables[0][0].DOResign),$=new Date,X=new Date,J=new Date,Y={PayrollMonth:$,PayrollMonthStart:X,PayrollMonthEnd:J};v.J0.SetPayrollDate_1(w,Y),$=Y.PayrollMonth,X=Y.PayrollMonthStart,J=Y.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(w,Y,this.EmpGrade),$=Y.PayrollMonth,X=Y.PayrollMonthStart,J=Y.PayrollMonthEnd);let R=new Date($.getFullYear(),$.iMonth(),1),H=new Date,ge=R;"Terminated With Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=I.d.SessionManager.Preferences.NPTerminatedWithCause&&parseInt(I.d.SessionManager.Preferences.NPTerminatedWithCause)>0&&(H=R.AddMonths(parseInt(I.d.SessionManager.Preferences.NPTerminatedWithCause)-1)):"Terminated Without Cause"==this.dsD.Tables[0][0].ResignType.toString()?""!=I.d.SessionManager.Preferences.NPTerminatedWithOutCause&&parseInt(I.d.SessionManager.Preferences.NPTerminatedWithOutCause)>0&&(H=R.AddMonths(parseInt(I.d.SessionManager.Preferences.NPTerminatedWithOutCause)-1)):"Resigned"==this.dsD.Tables[0][0].ResignType.toString()&&""!=I.d.SessionManager.Preferences.NPResignation&&parseInt(I.d.SessionManager.Preferences.NPResignation)>0&&(H=R.AddMonths(parseInt(I.d.SessionManager.Preferences.NPResignation)-1)),$=new Date,X=new Date,J=new Date,Y={PayrollMonth:$,PayrollMonthStart:X,PayrollMonthEnd:J},v.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,Y),$=Y.PayrollMonth,X=Y.PayrollMonthStart,J=Y.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,Y,this.EmpGrade),$=Y.PayrollMonth,X=Y.PayrollMonthStart,J=Y.PayrollMonthEnd);let Z=new Date($.getFullYear(),$.iMonth(),1);if(H<Z)for(;H<Z;)H=H.AddMonths(1);let ce=0;for($=new Date,X=new Date,J=new Date;ge<=H;){if(D=this.dsD.Tables[5].filter(ne=>ne.PayrollDate==ge.ToString("dd/MMM/yyyy")),null==D||0==D.length){if(this.dgvNoticePay.addEmptyRow(),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPType="Add",this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPPayrollMonth=ge.ToString("dd/MMM/yyyy"),"Actual Days"==I.d.SessionManager.Preferences.PayDays){let ne={PayrollMonth:$,PayrollMonthStart:X,PayrollMonthEnd:J};if(v.J0.SetPayrollDate_1(ge,ne),$=ne.PayrollMonth,X=ne.PayrollMonthStart,J=ne.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let Me=0;Me=v.J0.GetEmployeeGrade(this.EmpSeqNo.toString(),$,X,J),Me>0&&(v.J0.SetPayrollDate_1(ge,ne,Me),$=ne.PayrollMonth,X=ne.PayrollMonthStart,J=ne.PayrollMonthEnd)}ce=J.Subtract(X).Days+1}else ce=parseInt(I.d.SessionManager.Preferences.PayDays);this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPMonthDays=ce,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPDaysAtt=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPLOP=0,this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPNetSal=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1].dgColNPCalc=this.GetResource("Calculate",40095),this.dgvNoticePay.updateRow(this.dgvNoticePay.Table[this.dgvNoticePay.Table.length-1])}ge=ge.AddMonths(1)}}if(this.dsD.Tables[2].length>0&&(this.sVacTypeSeqNo=this.dsD.Tables[2][0].VacationField.toString()),this.ViewModel.WID=this.dsD.Tables[12].length>0?parseInt(this.dsD.Tables[12][0].WorkFlowID):0,this.dsD.Tables[1].length>0&&this.RefreshLeaveEncashDetails(),this.dsD.Tables[8].length>0&&I.d.SessionManager.Preferences.ContainsKey("DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement")&&"False"==I.d.SessionManager.Preferences.DonotCalculateCumulativeLeaveSalaryBalanceinFinalSettlement.toString()){let w=0,$=0;for(let X=0;X<this.dsD.Columns[8].length;X++)v.J0.IsEmpty(this.dsD.Tables[8][0][this.dsD.Columns[8][X]])||(w+=parseFloat(this.dsD.Tables[8][0][this.dsD.Columns[8][X]]));for(let X=0;X<this.dsD.Tables[9].length;X++)v.J0.IsEmpty(this.dsD.Tables[9][X].Amount)||($+=parseFloat(this.dsD.Tables[9][X].Amount));this.txtCumLeaveSalBalAmt.Text=(w-$).ToString(I.d.SessionManager.sPayrollDecimals)}else this.txtCumLeaveSalBalAmt.Text=(0).ToString(I.d.SessionManager.sPayrollDecimals);if(this.txtLEAmount.Text=parseFloat(this.txtCumLeaveSalBalAmt.Text).ToString(I.d.SessionManager.sPayrollDecimals),this.AutoCalculateLeaveEncashment(),this.dsD.Tables[3].length>0&&(this.dblBasic=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly.toString())),this.dsD.Tables[4].length>0){let w;this.dgvUPS.addEmptyRows(this.dsD.Tables[4].length);for(let $=0;$<this.dsD.Tables[4].length;$++)w=v.J0.ParseDate(this.dsD.Tables[4][$].PayrollMonth),this.dgvUPS.Table[$].dgColUPSPayrollMonth=w.ToString("dd/MMM/yyyy"),this.dgvUPS.Table[$].dgColUPSMonthDays=w.DaysInMonth(),this.dgvUPS.Table[$].dgColUPSDaysAtt=0,this.dgvUPS.Table[$].dgColUPSLOP=0,this.dgvUPS.Table[$].dgColUPSNetSal=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvUPS.Table[$].dgColUPSCalc=this.GetResource("Calculate",40095),this.dgvUPS.updateRow(this.dgvUPS.Table[$])}let b=0;if(this.dsD.Tables[10].length>0){this.dgvLoanBal.addEmptyRows(this.dsD.Tables[10].length);for(let w=0;w<this.dsD.Tables[10].length;w++)this.dgvLoanBal.Table[w].dgColLoanBalSNo=(w+1).toString(),this.dgvLoanBal.Table[w].dgColLoanBalDocNo=this.dsD.Tables[10][w].DocNo.toString(),this.dgvLoanBal.Table[w].dgColLoanBalDocNo_Tag=this.dsD.Tables[10][w].DocID.toString(),this.dgvLoanBal.Table[w].dgColLoanBalLoanType=this.dsD.Tables[10][w].LoanType.toString(),this.dgvLoanBal.Table[w].dgColLoanBalLoanType_Tag=this.dsD.Tables[10][w].LoanCompID.toString(),this.dgvLoanBal.Table[w].dgColLoanBalApprAmount=parseFloat(this.dsD.Tables[10][w].ApprovedAmt).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[w].dgColLoanBalAmountPaid=parseFloat(this.dsD.Tables[10][w].Paid).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[w].dgColLoanBalBalAmount=parseFloat(this.dsD.Tables[10][w].Balance).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[w].dgColLoanBalCalc="Pay",b+=parseFloat(this.dsD.Tables[10][w].Balance),this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[w])}this.CalculateTotalAmount()}}AutoCalculateLeaveEncashment(){I.d.SessionManager.Preferences.ContainsKey("AutoCalcLeaveEncashmentInFinalSettlement")&&"True"==I.d.SessionManager.Preferences.AutoCalcLeaveEncashmentInFinalSettlement.toString()&&this.btnCalcLeaveEncash_Click()}RefreshLeaveEncashDetails(){if(this.EmpSeqNo>0&&(this.dgvLeaveEncash.Clear(),this.dsD.Tables[1].length>0)){this.dgvLeaveEncash.addEmptyRows(this.dsD.Tables[1].length);for(let c=0;c<this.dsD.Tables[1].length;c++){this.dgvLeaveEncash.Table[c+"_Tag"]=this.dsD.Tables[1][c].SNo.toString(),this.dgvLeaveEncash.Table[c].dgColLELeaveType=this.dsD.Tables[1][c].ComponentName.toString(),this.dgvLeaveEncash.Table[c].dgColLELeaveType_Tag=this.dsD.Tables[1][c].ComponentID.toString();let D=0,M=0;if(this.dsD.Tables[1][c].ComponentID.toString()==this.sVacTypeSeqNo)this.dgvLeaveEncash.Table[c].dgColLEAvailable=this.GetVacationAvailability(this.dtpDateOfRelieving.Date,parseInt(this.sVacTypeSeqNo));else{let P={dTaken:0,dAvail:0},b={dAvail:0};this.GetLeavesTaken1(this.dtpDateOfRelieving.Date,this.dtpDateOfJoining.Date,this.dsD.Tables[1][c].ComponentID.toString(),b),D=P.dTaken,M=P.dAvail,this.dgvLeaveEncash.Table[c].dgColLEAvailable=M}this.dgvLeaveEncash.Table[c].dgColLEMaxEncash=parseFloat(this.dgvLeaveEncash.Table[c].dgColLEAvailable)>parseFloat(this.dsD.Tables[1][c].MaxEncashDays)?this.dsD.Tables[1][c].MaxEncashDays.toString():this.dgvLeaveEncash.Table[c].dgColLEAvailable.toString(),this.dgvLeaveEncash.Table[c].dgColLEApplied=0,this.dgvLeaveEncash.Table[c].dgColLEAmount=(0).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLeaveEncash.Table[c].dgColLEAmount_Tag=this.dsD.Tables[1][c].EncashFormula.toString(),I.d.SessionManager.Preferences.ContainsKey("AutoCalcLeaveEncashmentInFinalSettlement")&&"True"==I.d.SessionManager.Preferences.AutoCalcLeaveEncashmentInFinalSettlement.toString()&&(this.dgvLeaveEncash.Table[c].dgColLEApplied=this.dgvLeaveEncash.Table[c].dgColLEMaxEncash)}this.dgvLeaveEncash.invalidate()}}GetAvailableLeavesToEncash(c){c.SNo.toString();let P=c.ComponentID.toString();if(this.sVacTypeSeqNo!=P){let b=I.d.common.GetDataSet3("CRM022",this.dtpDocDate.Date.ToString("dd MMM yyyy"),new Date(this.dtpDocDate.Date.getFullYear(),parseInt(I.d.SessionManager.Preferences.LeaveYear.toString()),1).ToString("dd MMM yyyy"),this.EmpSeqNo+"~"+P);if(null!=b&&b.Tables.length>0&&b.Tables[0].length>0){let w=0,$=0,X=0;return b.Tables[1].length>0&&($=parseFloat(b.Tables[1][0].NoOfDays.toString())),b.Tables[2].length>0&&(X=parseFloat(b.Tables[2][0].NoOfDays.toString())),w-$-X}return 0}try{return 0}catch(b){return this.ViewModel.DisplayMessage="Exception when Calculating Available leaves of Vacation Type",console.log(b),0}}GetVacationAvailability(c,D){Logger.InfoLog("CommonMonthlyPayroll::Entering GetVacationAvailability()");let M=0,P=[];P.push(c.ToString("dd/MMM/yyyy")),P.push(this.EmpSeqNo),P.push(2),P.push(I.d.SessionManager.UserID),P.push(I.d.SessionManager.LanguageID);let b=I.d.common.GetDataSet_SP(P,"spPAY_GetRemainingVacationDays");if(null!=b&&b.Tables.length>0&&b.Tables[0].length>0){let w=b.Tables[0].filter($=>$.LeaveType==D);null!=w&&w.length>0&&(M=parseFloat(w[0].AvlblDays))}return Logger.InfoLog("CommonMonthlyPayroll::Exiting GetVacationAvailability()"),M.toString()}GetLeavesTaken(c,D,M,P){P.dTaken=P.dAvail=0;let b=[];b.push(c.ToString("dd/MMM/yyyy")),b.push(D.ToString("dd/MMM/yyyy")),b.push(this.EmpSeqNo),b.push(M),b.push("Both"),b.push(I.d.SessionManager.UserID),b.push(I.d.SessionManager.LanguageID);let w=I.d.common.GetDataSet_SP(b,"spPAY_ExtGetAvlblNoofDays");null!=w&&w.Tables.length>0&&w.Tables[0].length>0&&(v.J0.IsEmpty(w.Tables[0][0].LeavesTaken)||(P.dTaken=parseFloat(w.Tables[0][0].LeavesTaken)),v.J0.IsEmpty(w.Tables[0][0].AvailableLeaves)||(P.dAvail=parseFloat(w.Tables[0][0].AvailableLeaves)))}GetLeavesTaken1(c,D,M,P){Logger.InfoLog("CommonMonthlyPayroll::Entering GetLeavesTaken1()"),P.dAvail=0;let b=[];b.push(this.EmpSeqNo),b.push(M),b.push(c.ToString("dd/MMM/yyyy")),b.push(0),b.push(I.d.SessionManager.UserID),b.push(I.d.SessionManager.LanguageID),b.push(0);let w=I.d.common.GetDataSet_SP(b,"spPAY_ExtGetAssignedLeaves");null!=w&&w.Tables.length>0&&w.Tables[0].length>0&&(v.J0.IsEmpty(null!=w.Tables[0][0].AvailableLeaves)||(P.dAvail=v.J0.DoubleTryParse(w.Tables[0][0].AvailableLeaves))),Logger.InfoLog("CommonMonthlyPayroll::Exiting GetLeavesTaken()")}CalculateTotalAmount(){let c=0;c+="Partial"==this.cmbSettlementType.SelectedValue?parseFloat(this.txtPartialGratuityAmount.Text):parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken,c+=parseFloat(this.txtLEAmount.Text),c+=parseFloat(this.txtUPSAmount.Text),c+=parseFloat(this.txtOthAddAmount.Text),c-=parseFloat(this.txtOthDedAmount.Text),c+=parseFloat(this.txtNPAmount.Text),c-=parseFloat(this.txtLoanBalAmount.Text),this.txtNetAmount.Text=c.ToString(I.d.SessionManager.sPayrollDecimals)}GenerateSerialNos(c,D=""){for(let M=0;M<c.Table.length;M++)"dgvOthAdd"==D?c.Table[M].dgColOthAddSNo=M+1:c.Table[M].dgColOthDedSNo=M+1;c.invalidate()}LoadGrids(){let c;this.SetGridProperties(this.dgvLeaveEncash),c=new ee.O7,c.DisplayMember="dgColLELeaveType",c.Header=this.GetResource("Leave Type",40095),c.ReadOnly=!0,this.dgvLeaveEncash.Columns.push(c),this.dgvLeaveEncash.TableColumns.push("dgColLELeaveType"),c=new ee.O7,c.DisplayMember="dgColLEAvailable",c.Header=this.GetResource("Available Days",40095),c.ReadOnly=!0,c.TextAlign="Center",this.dgvLeaveEncash.Columns.push(c),this.dgvLeaveEncash.TableColumns.push("dgColLEAvailable"),c=new ee.O7,c.DisplayMember="dgColLEMaxEncash",c.Header=this.GetResource("Max Encash Days",40095),c.ReadOnly=!0,c.TextAlign="Center",this.dgvLeaveEncash.Columns.push(c),this.dgvLeaveEncash.TableColumns.push("dgColLEMaxEncash"),c=new ee.O7,c.DisplayMember="dgColLEApplied",c.Header=this.GetResource("Applied Days",40095),c.TextAlign="Center",this.dgvLeaveEncash.Columns.push(c),this.dgvLeaveEncash.TableColumns.push("dgColLEApplied"),c=new ee.O7,c.DisplayMember="dgColLEAmount",c.Header=this.GetResource("Encash Amount",40095),c.ReadOnly=!0,c.TextAlign="Right",this.dgvLeaveEncash.Columns.push(c),this.dgvLeaveEncash.TableColumns.push("dgColLEAmount"),this.SetGridProperties(this.dgvUPS),c=new ee.O7,c.DisplayMember="dgColUPSPayrollMonth",c.Header=this.GetResource("Payroll Month",40095),c.ReadOnly=!0,c.TextAlign="Center",this.dgvUPS.Columns.push(c),this.dgvUPS.TableColumns.push("dgColUPSPayrollMonth"),c=new ee.O7,c.DisplayMember="dgColUPSMonthDays",c.Header=this.GetResource("Month Days",40095),c.ReadOnly=!0,c.TextAlign="Center",this.dgvUPS.Columns.push(c),this.dgvUPS.TableColumns.push("dgColUPSMonthDays"),c=new ee.O7,c.DisplayMember="dgColUPSDaysAtt",c.Header=this.GetResource("Days Attended",40095),c.ReadOnly=!0,c.TextAlign="Center",this.dgvUPS.Columns.push(c),this.dgvUPS.TableColumns.push("dgColUPSDaysAtt"),c=new ee.O7,c.DisplayMember="dgColUPSLOP",c.Header=this.GetResource("LOP Days",40095),c.ReadOnly=!0,c.TextAlign="Center",this.dgvUPS.Columns.push(c),this.dgvUPS.TableColumns.push("dgColUPSLOP"),c=new ee.O7,c.DisplayMember="dgColUPSNetSal",c.Header=this.GetResource("Net Salary",40095),c.ReadOnly=!0,c.TextAlign="Right",this.dgvUPS.Columns.push(c),this.dgvUPS.TableColumns.push("dgColUPSNetSal"),c=new ee.O7,c.DataType="LINK",c.DisplayMember="dgColUPSCalc",c.Header=this.GetResource("Calculate",40095),c.TextAlign="Center",c.Click.Subscribe(this,"dgvUPS_CellClick"),this.dgvUPS.Columns.push(c),this.dgvUPS.TableColumns.push("dgColUPSCalc"),this.SetGridProperties(this.dgvNoticePay),c=new ee.O7,c.DataType="ComboBox",c.ValueBinding="dgColNPType",c.DisplayMember="Name",c.ValueMember="Value",c.Header=this.GetResource("Type",40095);let D=new Array;D.push(De._p.ComboBoxItems_2("Add","Add")),D.push(De._p.ComboBoxItems_2("Subtract","Subtract")),D.push(De._p.ComboBoxItems_2("None","None")),c.ComboData=D,this.dgvNoticePay.Columns.push(c),this.dgvNoticePay.TableColumns.push("dgColNPType"),c=new ee.O7,c.DisplayMember="dgColNPPayrollMonth",c.Header=this.GetResource("Payroll Month",40095),c.ReadOnly=!0,c.TextAlign="Center",this.dgvNoticePay.Columns.push(c),this.dgvNoticePay.TableColumns.push("dgColNPPayrollMonth"),c=new ee.O7,c.DisplayMember="dgColNPMonthDays",c.Header=this.GetResource("Month Days",40095),c.ReadOnly=!0,c.TextAlign="Center",this.dgvNoticePay.Columns.push(c),this.dgvNoticePay.TableColumns.push("dgColNPMonthDays"),c=new ee.O7,c.DisplayMember="dgColNPDaysAtt",c.Header=this.GetResource("Days Attended",40095),c.ReadOnly=!0,c.TextAlign="Center",this.dgvNoticePay.Columns.push(c),this.dgvNoticePay.TableColumns.push("dgColNPDaysAtt"),c=new ee.O7,c.DisplayMember="dgColNPLOP",c.Header=this.GetResource("LOP Days",40095),c.ReadOnly=!0,c.TextAlign="Center",this.dgvNoticePay.Columns.push(c),this.dgvNoticePay.TableColumns.push("dgColNPLOP"),c=new ee.O7,c.DisplayMember="dgColNPNetSal",c.Header=this.GetResource("Net Salary",40095),c.ReadOnly=!0,c.TextAlign="Right",this.dgvNoticePay.Columns.push(c),this.dgvNoticePay.TableColumns.push("dgColNPNetSal"),c=new ee.O7,c.DataType="LINK",c.DisplayMember="dgColNPCalc",c.Header=this.GetResource("Calculate",40095),c.TextAlign="Center",c.Click.Subscribe(this,"dgvNoticePay_CellClick"),this.dgvNoticePay.Columns.push(c),this.dgvNoticePay.TableColumns.push("dgColNPCalc"),this.SetGridProperties(this.dgvOthAdd),c=new ee.O7,c.DisplayMember="dgColOthAddSNo",c.Header="#",c.ReadOnly=!0,c.TextAlign="Center",this.dgvOthAdd.Columns.push(c),this.dgvOthAdd.TableColumns.push("dgColOthAddSNo"),c=new ee.O7,c.DataType="ComboBox",c.ValueBinding="dgColOthAddParticulars",c.DisplayMember="Name",c.ValueMember="NodeID",c.Header=this.GetResource("Particulars",40095),this.dgvOthAdd.Columns.push(c),this.dgvOthAdd.TableColumns.push("dgColOthAddParticulars"),c=new ee.O7,c.DisplayMember="dgColOthAddAmount",c.Header=this.GetResource("Amount",40095),c.TextAlign="Right",this.dgvOthAdd.Columns.push(c),this.dgvOthAdd.TableColumns.push("dgColOthAddAmount"),c=new ee.O7,c.DisplayMember="dgColOthAddRemarks",c.Header=this.GetResource("LineNarration",40095),this.dgvOthAdd.Columns.push(c),this.dgvOthAdd.TableColumns.push("dgColOthAddRemarks"),this.SetGridProperties(this.dgvOthDed),c=new ee.O7,c.DisplayMember="dgColOthDedSNo",c.Header="#",c.ReadOnly=!0,c.TextAlign="Center",this.dgvOthDed.Columns.push(c),this.dgvOthDed.TableColumns.push("dgColOthDedSNo"),c=new ee.O7,c.DataType="ComboBox",c.ValueBinding="dgColOthDedParticulars",c.DisplayMember="Name",c.ValueMember="NodeID",c.Header=this.GetResource("Particulars",40095),this.dgvOthDed.Columns.push(c),this.dgvOthDed.TableColumns.push("dgColOthDedParticulars"),c=new ee.O7,c.DisplayMember="dgColOthDedAmount",c.Header=this.GetResource("Amount",40095),c.TextAlign="Right",this.dgvOthDed.Columns.push(c),this.dgvOthDed.TableColumns.push("dgColOthDedAmount"),c=new ee.O7,c.DisplayMember="dgColOthDedRemarks",c.Header=this.GetResource("LineNarration",40095),this.dgvOthDed.Columns.push(c),this.dgvOthDed.TableColumns.push("dgColOthDedRemarks"),this.SetGridProperties(this.dgvLoanBal),c=new ee.O7,c.DisplayMember="dgColLoanBalSNo",c.Header="#",c.ReadOnly=!0,c.TextAlign="Center",this.dgvLoanBal.Columns.push(c),this.dgvLoanBal.TableColumns.push("dgColLoanBalSNo"),c=new ee.O7,c.DisplayMember="dgColLoanBalDocNo",c.Header=this.GetResource("Loan Doc. No.",40095),c.ReadOnly=!0,this.dgvLoanBal.Columns.push(c),this.dgvLoanBal.TableColumns.push("dgColLoanBalDocNo"),c=new ee.O7,c.DisplayMember="dgColLoanBalLoanType",c.Header=this.GetResource("Loan Type",40095),c.ReadOnly=!0,this.dgvLoanBal.Columns.push(c),this.dgvLoanBal.TableColumns.push("dgColLoanBalLoanType"),c=new ee.O7,c.DisplayMember="dgColLoanBalApprAmount",c.Header=this.GetResource("Approved Amount",40095),c.ReadOnly=!0,c.TextAlign="Right",this.dgvLoanBal.Columns.push(c),this.dgvLoanBal.TableColumns.push("dgColLoanBalApprAmount"),c=new ee.O7,c.DisplayMember="dgColLoanBalAmountPaid",c.Header=this.GetResource("Amount Paid",40095),c.ReadOnly=!0,c.TextAlign="Right",this.dgvLoanBal.Columns.push(c),this.dgvLoanBal.TableColumns.push("dgColLoanBalAmountPaid"),c=new ee.O7,c.DisplayMember="dgColLoanBalBalAmount",c.Header=this.GetResource("Balance Amount",40095),c.ReadOnly=!0,c.TextAlign="Right",this.dgvLoanBal.Columns.push(c),this.dgvLoanBal.TableColumns.push("dgColLoanBalBalAmount"),c=new ee.O7,c.DisplayMember="dgColLoanBalRemarks",c.Header=this.GetResource("LineNarration",40095),this.dgvLoanBal.Columns.push(c),this.dgvLoanBal.TableColumns.push("dgColLoanBalRemarks"),c=new ee.O7,c.DataType="LINK",c.DisplayMember="dgColLoanBalCalc",c.Header=this.GetResource("Pay",40095),c.TextAlign="Center",c.Click.Subscribe(this,"dgvLoanBal_CellClick"),this.dgvLoanBal.Columns.push(c),this.dgvLoanBal.TableColumns.push("dgColLoanBalCalc")}SetGridProperties(c){c.Table=[],c.Columns=[]}Calculate_Click(c){switch(c){case"Gratuity":this.btnCalcGratuity_Click();break;case"LeaveEncash":this.btnCalcLeaveEncash_Click();break;case"Clear":this.Clear_Click();break;case"Save":this.Save_Click();break;case"Delete":this.Delete_Click();break;case"Previous":this.Previous_Click();break;case"Next":this.Next_Click();break;case"Approve":this.Approve_Click()}return""}Approve_Click(){let c=new lt.a(this.CostCenterID,this.ViewModel.DocID,null,this.ViewModel);I.d.page.ShowDialog(c,h.H,{ShowCenter:!0,Title:I.d.GetResource("ApproveReject")})}Next_Click(){this.iCurDocNo=parseInt(this.txtDocNo.Text.Trim()),this.LoadDocument(this.iCurDocNo+1)}Previous_Click(){this.iCurDocNo=parseInt(this.txtDocNo.Text.Trim()),this.iCurDocNo>1&&this.LoadDocument(this.iCurDocNo-1)}Delete_Click(){if(""!=this.sDocNo&&parseInt(this.sDocNo)>0){if(confirm("Are you sure want to Delete.?")){let c=0,D=[];D.push(40095),D.push(this.ViewModel.DocID),D.push(1);let M=I.d.document.DeleteSelectedRows(D,c);this.ViewModel.DisplayMessage=M.Message,c=M.RetValue,this.ViewModel.MessageVisibility=!0,this.Clear_Click()}}else this.ViewModel.DisplayMessage="Select any saved Document to Delete",this.ViewModel.MessageVisibility=!0}Save_Click(){if(this.ValidateSave()){let c=[];c.push(this.CostCenterID),c.push(this.ViewModel.DocID),c.push(""),c.push(this.txtDocNo.Text),c.push(this.dtpDocDate.Date.ToString("dd/MMM/yyyy")),c.push(this.dtpDocDate.Date.ToString("dd/MMM/yyyy")),c.push(""),c.push(this.GetDocumentXML()),c.push(""),c.push(""),c.push(this.ViewModel.ViewAttachments.GetXML()),c.push(this.GetActivityXML()),c.push("false"),I.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==I.d.SessionManager.Preferences.EnableLocationWise.toString()?c.push(I.d.SessionManager.LocationID>0?I.d.SessionManager.LocationID:1):c.push(0),I.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==I.d.SessionManager.Preferences.EnableDivisionWise.toString()?c.push(I.d.SessionManager.DivisionID>0?I.d.SessionManager.DivisionID:1):c.push(0),c.push(this.ViewModel.WID),c.push(I.d.SessionManager.RoleID),c.push(""),c.push(0),c.push(0),c.push(I.d.SessionManager.CompanyGUID),c.push(I.d.SessionManager.UserName),c.push(I.d.SessionManager.UserID),c.push(I.d.SessionManager.LanguageID),c.push(I.d.SessionManager.IsOffline);let D=0,M="";I.d.document.SetTempInvDocument(c).subscribe(P=>{D=P.obj;let b=P;if(M=null!=b&&b.Tables.length>0&&b.Tables[b.Tables.length-1].length>0&&b.Columns[b.Tables.length-1].Contains("ErrorMessage")?b.Tables[b.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",D>0){let w=[];w.push(D),w.push(I.d.SessionManager.UserID),w.push(I.d.SessionManager.LanguageID);let $=this.ViewModel.PostApplyLeaves(parseInt(I.d.SessionManager.CompanyIndex),w,"spPAY_PostApplyLeaves");null!=$&&$.Tables.length>0&&(M="Problem in processing your request,Please contact administrator."),this.ViewModel.SelectedEmpID=this.EmpSeqNo,this.Clear_Click()}else null!=b&&b.Tables.length>0&&b.Tables[b.Tables.length-1].length>0&&b.Columns[b.Tables.length-1].Contains("ServerMessage")&&(D="-407"==b.Tables[b.Tables.length-1][0].ServerMessage.toString()?-407:-12345);this.ViewModel.DisplayMessage=M,this.ViewModel.MessageVisibility=!0})}}GetActivityXML(){let c='<XML  SysInfo="'+I.d.SessionManager.GetSysInfo()+'" AP="Desktop" ';return"Approve"==this.ViewModel.sCmdParameter&&(c+=' AppRejDate="'+Date.Today().ToString("dd/MMM/yyyy")+'"'),c+=" >",c+=" </XML> ",c}GetDocumentXML(){let J,D="",M="",P="",b="",w="",$="";if(new Array,null!=I.d.SessionManager.dtDocDefAccs&&(J=I.d.SessionManager.dtDocDefAccs.filter(Y=>40095==Y.CostCenterID&&"CreditAccount"==Y.SysColumnName),null!=J&&J.length>0&&null!=J[0].UserDefaultValue&&""!=J[0].UserDefaultValue.toString().Trim()&&(w=J[0].UserDefaultValue.toString()),J=I.d.SessionManager.dtDocDefAccs.filter(Y=>40095==Y.CostCenterID&&"DebitAccount"==Y.SysColumnName),null!=J&&J.length>0&&null!=J[0].UserDefaultValue&&""!=J[0].UserDefaultValue.toString().Trim()&&($=J[0].UserDefaultValue.toString())),M+='" ProductID="'+this.DefProdID+'" Quantity="0" Unit="1" UOMConversion="1" UOMConvertedQty="0" Rate="0" Gross="'+parseFloat(this.txtNetAmount.Text)+'" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" RefNO="" BillDate="'+I.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" CurrencyID="1" ExchangeRate="1" DebitAccount="'+$+'" CreditAccount="'+w+'" CommonNarration="'+v.J0.EncodeXML(this.txtRemarks.Text),null!=this.dgvGratuity&&this.dgvGratuity.Table.length>0){let Y=1;for(let R=0;R<this.dgvGratuity.Table.length;R++)D+="\x11",D+="<Row>",D+="<AccountsXML></AccountsXML>",D+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Gratuity',b="",D+=b.length>0?'" DocDetailsID="'+b:'" DocDetailsID="',D+=M.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtGratuityAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtGratuityAmount.Text).toString().Replace(",","")+",",P+=" dcNum2="+parseFloat(this.txtAvailedGratuityAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum2="+parseFloat(this.txtAvailedGratuityAmount.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcNum4="+parseFloat(this.txtPartialGratuityAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum4="+parseFloat(this.txtPartialGratuityAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',D+=P,P='<Alpha Query="',P+=" dcAlpha1='1',",P+=" dcAlpha2='"+Y+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha4='"+this.lblGratuityServiceDays+"',",P+=" dcAlpha5='"+this.lblGratuityLOPDays+"',",P+=" dcAlpha6='"+this.lblGratuityBalDays+"',",P+=" dcAlpha7='"+this.lblGratuityTotalGrDays+"',",P+=" dcAlpha8='"+this.GratuityRemarks.Text+"',",P+=" dcAlpha9='"+this.GratuityGrade+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.cmbResignType.SelectedValue+"',",P+=" dcAlpha12='"+this.chkCalcBasedOnLastSal.IsChecked+"',",P+=" dcAlpha13='"+this.chkCalcBasedOnActDays.IsChecked+"',",P+=" dcAlpha14='"+this.lblGratuityTotalDays+"',",P+=" dcAlpha15='"+this.dgvGratuity.Table[R][this.dgvGratuity.TableColumns[1]]+"',",P+=" dcAlpha16='"+this.dgvGratuity.Table[R+1][this.dgvGratuity.TableColumns[2]]+"',",P+=" dcAlpha17='"+this.dgvGratuity.Table[R+1][this.dgvGratuity.TableColumns[4]]+"',",P+=" dcAlpha18='"+this.dgvGratuity.Table[R+2][this.dgvGratuity.TableColumns[1]]+"',",P+=" dcAlpha19='"+this.dgvGratuity.Table[R+3][this.dgvGratuity.TableColumns[1]]+"',",P+=" dcAlpha20='"+this.dgvGratuity.Table[R+3][this.dgvGratuity.TableColumns[4]]+"',",P+=" dcAlpha21='"+this.dgvGratuity.Table[R+5][this.dgvGratuity.TableColumns[1]]+"',",P+=" dcAlpha22='"+this.dgvGratuity.Table[R+5][this.dgvGratuity.TableColumns[2]]+"',",P+=" dcAlpha23='"+this.dgvGratuity.Table[R+5][this.dgvGratuity.TableColumns[3]]+"',",P+=" dcAlpha24='"+this.dgvGratuity.Table[R+6][this.dgvGratuity.TableColumns[1]]+"',",P+=" dcAlpha25='"+this.dgvGratuity.Table[R+6][this.dgvGratuity.TableColumns[2]]+"',",P+=" dcAlpha26='"+this.dgvGratuity.Table[R+6][this.dgvGratuity.TableColumns[3]]+"',",P+=" dcAlpha27='"+this.dgvGratuity.Table[R+6][this.dgvGratuity.TableColumns[5]]+"',",P+=" dcAlpha28='"+this.dgvGratuity.Table[R+6][this.dgvGratuity.TableColumns[7]]+"',",P+=" dcAlpha29='"+this.dgvGratuity.Table[R+7][this.dgvGratuity.TableColumns[5]]+"',",P+=" dcAlpha30='"+this.dgvGratuity.Table[R+3][this.dgvGratuity.TableColumns[6]]+"',",P+=" dcAlpha31='"+this.GratuityDocID+"',",P+=" dcAlpha32='"+this.lblGratuityTaken+"',",P+=" dcAlpha33='"+this.cmbResignReason.SelectedValue+"',",P+=" dcAlpha34='"+this.dgvGratuity.Table[R+1][this.dgvGratuity.TableColumns[6]]+"',",P+='" ></Alpha>',D+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',D+=P,D+="<EXTRAXML></EXTRAXML>",D+="</Row>",R+=8,Y++}if(null!=this.dgvLeaveEncash&&this.dgvLeaveEncash.Table.length>0){let Y=1;for(let R=0;R<this.dgvLeaveEncash.Table.length;R++)0!=v.J0.Double(this.dgvLeaveEncash.Table[R].dgColLEAmount)&&(D+="\x11",D+="<Row>",D+="<AccountsXML></AccountsXML>",D+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Leave Encashment',b="",D+=b.length>0?'" DocDetailsID="'+b:'" DocDetailsID="',D+=M.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtLEAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtLEAmount.Text).toString().Replace(",","")+",",P+=" dcNum2="+parseFloat(this.txtCumLeaveSalBalAmt.Text).toString().Replace(",","")+",",P+=" dcCalcNum2="+parseFloat(this.txtCumLeaveSalBalAmt.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',D+=P,P='<Alpha Query="',P+=" dcAlpha1='2',",P+=" dcAlpha2='"+Y+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha8='"+this.LeaveRemarks.Text+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.dgvLeaveEncash.Table[R+"_Tag"].toString()+"',",P+=" dcAlpha12='"+this.dgvLeaveEncash.Table[R].dgColLELeaveType+"',",P+=" dcAlpha13='"+this.dgvLeaveEncash.Table[R].dgColLEAvailable+"',",P+=" dcAlpha14='"+this.dgvLeaveEncash.Table[R].dgColLEMaxEncash+"',",P+=" dcAlpha15='"+this.dgvLeaveEncash.Table[R].dgColLEApplied+"',",P+=" dcAlpha16='"+this.dgvLeaveEncash.Table[R].dgColLEAmount.toString().Replace(",","")+"',",P+=" dcAlpha17='"+this.chkLECalcBasedOnLastApprSerYearWise.IsChecked+"',",P+='" ></Alpha>',D+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',D+=P,D+="<EXTRAXML></EXTRAXML>",D+="</Row>",Y++)}if(null!=this.dgvUPS&&this.dgvUPS.Table.length>0){let Y=1;for(let R=0;R<this.dgvUPS.Table.length;R++)v.J0.Double(this.dgvUPS.Table[R].dgColUPSNetSal)>0&&(D+="\x11",D+="<Row>",D+="<AccountsXML></AccountsXML>",D+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Un-Processed Salary',b="",D+=b.length>0?'" DocDetailsID="'+b:'" DocDetailsID="',D+=M.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtUPSAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtUPSAmount.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',D+=P,P='<Alpha Query="',P+=" dcAlpha1='3',",P+=" dcAlpha2='"+Y+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha8='"+this.UPSRemarks.Text+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.dgvUPS.Table[R].dgColUPSPayrollMonth+"',",P+=" dcAlpha12='"+this.dgvUPS.Table[R].dgColUPSMonthDays+"',",P+=" dcAlpha13='"+this.dgvUPS.Table[R].dgColUPSDaysAtt+"',",P+=" dcAlpha14='"+this.dgvUPS.Table[R].dgColUPSLOP+"',",P+=" dcAlpha15='"+this.dgvUPS.Table[R].dgColUPSNetSal.toString().Replace(",","")+"',",P+='" ></Alpha>',D+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',D+=P,D+="<EXTRAXML></EXTRAXML>",D+="</Row>",Y++)}if(null!=this.dgvNoticePay&&this.dgvNoticePay.Table.length>0){let Y=1;for(let R=0;R<this.dgvNoticePay.Table.length;R++)v.J0.Double(this.dgvNoticePay.Table[R].dgColNPNetSal)>0&&(D+="\x11",D+="<Row>",D+="<AccountsXML></AccountsXML>",D+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Notice Pay',b="",D+=b.length>0?'" DocDetailsID="'+b:'" DocDetailsID="',D+=M.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtNPAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtNPAmount.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',D+=P,P='<Alpha Query="',P+=" dcAlpha1='4',",P+=" dcAlpha2='"+Y+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha8='"+this.NoticePayRemarks.Text+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.dgvNoticePay.Table[R].dgColNPPayrollMonth+"',",P+=" dcAlpha12='"+this.dgvNoticePay.Table[R].dgColNPMonthDays+"',",P+=" dcAlpha13='"+this.dgvNoticePay.Table[R].dgColNPDaysAtt+"',",P+=" dcAlpha14='"+this.dgvNoticePay.Table[R].dgColNPLOP+"',",P+=" dcAlpha15='"+this.dgvNoticePay.Table[R].dgColNPNetSal.toString().Replace(",","")+"',",P+=" dcAlpha16='"+this.dgvNoticePay.Table[R].dgColNPType+"',",P+='" ></Alpha>',D+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',D+=P,D+="<EXTRAXML></EXTRAXML>",D+="</Row>",Y++)}if(null!=this.dgvOthAdd&&this.dgvOthAdd.Table.length>0){let Y=1;for(let R=0;R<this.dgvOthAdd.Table.length;R++)!v.J0.IsEmpty(this.dgvOthAdd.Table[R].dgColOthAddParticulars)&&v.J0.Double(this.dgvOthAdd.Table[R].dgColOthAddAmount)>0&&(D+="\x11",D+="<Row>",D+="<AccountsXML></AccountsXML>",D+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Other Additions',b="",D+=b.length>0?'" DocDetailsID="'+b:'" DocDetailsID="',D+=M.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtOthAddAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtOthAddAmount.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',D+=P,P='<Alpha Query="',P+=" dcAlpha1='5',",P+=" dcAlpha2='"+Y+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha8='"+this.OAddRemarks.Text+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.dgvOthAdd.Table[R].dgColOthAddParticulars+"',",P+=" dcAlpha12='"+this.dgvOthAdd.Table[R].dgColOthAddAmount.toString().Replace(",","")+"',",v.J0.IsEmpty(this.dgvOthAdd.Table[R].dgColOthAddRemarks)||(P+=" dcAlpha13='"+this.dgvOthAdd.Table[R].dgColOthAddRemarks+"',"),P+='" ></Alpha>',D+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',D+=P,D+="<EXTRAXML></EXTRAXML>",D+="</Row>",Y++)}if(null!=this.dgvOthDed&&this.dgvOthDed.Table.length>0){let Y=1;for(let R=0;R<this.dgvOthDed.Table.length;R++)!v.J0.IsEmpty(this.dgvOthDed.Table[R].dgColOthDedParticulars)&&v.J0.Double(this.dgvOthDed.Table[R].dgColOthDedAmount)>0&&(D+="\x11",D+="<Row>",D+="<AccountsXML></AccountsXML>",D+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Other Deductions',b="",D+=b.length>0?'" DocDetailsID="'+b:'" DocDetailsID="',D+=M.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtOthDedAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtOthDedAmount.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',D+=P,P='<Alpha Query="',P+=" dcAlpha1='6',",P+=" dcAlpha2='"+Y+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha8='"+this.ODedRemarks.Text+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.dgvOthDed.Table[R].dgColOthDedParticulars+"',",P+=" dcAlpha12='"+this.dgvOthDed.Table[R].dgColOthDedAmount.toString().Replace(",","")+"',",null!=this.dgvOthDed.Table[R].dgColOthDedRemarks&&""!=this.dgvOthDed.Table[R].dgColOthDedRemarks.toString().Trim()&&(P+=" dcAlpha13='"+this.dgvOthDed.Table[R].dgColOthDedRemarks+"',"),P+='" ></Alpha>',D+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',D+=P,D+="<EXTRAXML></EXTRAXML>",D+="</Row>",Y++)}if(null!=this.dgvLoanBal&&this.dgvLoanBal.Table.length>0){let Y=1;for(let R=0;R<this.dgvLoanBal.Table.length;R++)!v.J0.IsEmpty(this.dgvLoanBal.Table[R].dgColLoanBalDocNo_Tag)&&null!=this.dgvLoanBal.Table[R].dgColLoanBalCalc_Tag&&(D+="\x11",D+="<Row>",D+="<AccountsXML></AccountsXML>",D+='<Transactions DocSeqNo="1" VoucherType="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Loan Balances',b="",D+=b.length>0?'" DocDetailsID="'+b:'" DocDetailsID="',D+=M.toString()+'" ></Transactions>',P='<Numeric Query="',P+=" dcNum1="+parseFloat(this.txtLoanBalAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum1="+parseFloat(this.txtLoanBalAmount.Text).toString().Replace(",","")+",",P+=" dcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+=" dcCalcNum3="+parseFloat(this.txtNetAmount.Text).toString().Replace(",","")+",",P+='" ></Numeric>',D+=P,P='<Alpha Query="',P+=" dcAlpha1='7',",P+=" dcAlpha2='"+Y+"',",P+=" dcAlpha3='"+this.dtpDateOfRelieving.Date.ToString("dd/MMM/yyyy")+"',",P+=" dcAlpha8='"+this.LoanRemarks.Text+"',",P+=" dcAlpha10='"+this.cmbSettlementType.Text+"',",P+=" dcAlpha11='"+this.dgvLoanBal.Table[R].dgColLoanBalDocNo+"',",P+=" dcAlpha12='"+this.dgvLoanBal.Table[R].dgColLoanBalDocNo_Tag+"',",P+=" dcAlpha13='"+this.dgvLoanBal.Table[R].dgColLoanBalLoanType_Tag+"',",P+=" dcAlpha14='"+this.dgvLoanBal.Table[R].dgColLoanBalApprAmount.toString().Replace(",","")+"',",P+=" dcAlpha15='"+this.dgvLoanBal.Table[R].dgColLoanBalAmountPaid.toString().Replace(",","")+"',",P+=" dcAlpha16='"+this.dgvLoanBal.Table[R].dgColLoanBalBalAmount.toString().Replace(",","")+"',",P+=" dcAlpha17='"+this.dgvLoanBal.Table[R].dgColLoanBalSNo_Tag+"',",P+='" ></Alpha>',D+=P,P='<CostCenters Query="',P+=" dcCCNID51="+this.EmpSeqNo+",",P+=" dcCCNID53="+this.EmpGrade+",",P+='" ></CostCenters>',D+=P,D+="<EXTRAXML></EXTRAXML>",D+="</Row>",Y++)}return D.toString()}GetCalcXML(){let c="";if(c+="<Rows>",this.dgvGratuity.Table.length>0){let D=1;for(let M=0;M<this.dgvGratuity.Table.length;M++)c+='<Row DType="1" SubDType="'+D+'" Field1="'+this.cmbResignType.SelectedValue+'" Field2="'+this.chkCalcBasedOnLastSal.IsChecked+'" Field3="'+this.chkCalcBasedOnActDays.IsChecked+'" Field4="'+this.lblGratuityTotalDays+'" Field5="'+this.dgvGratuity.Table[M][this.dgvGratuity.TableColumns[1]]+'" Field6="'+this.dgvGratuity.Table[M+1][this.dgvGratuity.TableColumns[2]]+'" Field7="'+this.dgvGratuity.Table[M+1][this.dgvGratuity.TableColumns[4]]+'" Field8="'+this.dgvGratuity.Table[M+2][this.dgvGratuity.TableColumns[1]]+'" Field9="'+this.dgvGratuity.Table[M+3][this.dgvGratuity.TableColumns[1]]+'" Field10="'+this.dgvGratuity.Table[M+3][this.dgvGratuity.TableColumns[4]]+'" Field11="'+this.dgvGratuity.Table[M+5][this.dgvGratuity.TableColumns[1]]+'" Field12="'+this.dgvGratuity.Table[M+5][this.dgvGratuity.TableColumns[2]]+'" Field13="'+this.dgvGratuity.Table[M+5][this.dgvGratuity.TableColumns[3]]+'" Field14="'+this.dgvGratuity.Table[M+6][this.dgvGratuity.TableColumns[1]]+'" Field15="'+this.dgvGratuity.Table[M+6][this.dgvGratuity.TableColumns[2]]+'" Field16="'+this.dgvGratuity.Table[M+6][this.dgvGratuity.TableColumns[3]]+'" Field17="'+this.dgvGratuity.Table[M+6][this.dgvGratuity.TableColumns[5]]+'" Field18="'+this.dgvGratuity.Table[M+6][this.dgvGratuity.TableColumns[7]]+'" Field19="'+this.dgvGratuity.Table[M+7][this.dgvGratuity.TableColumns[5]]+'" Field20="'+this.dgvGratuity.Table[M+3][this.dgvGratuity.TableColumns[6]],c+='" />',M+=8,D++}if(this.dgvLeaveEncash.Table.length>0)for(let D=0;D<this.dgvLeaveEncash.Table.length;D++)0!=v.J0.Double(this.dgvLeaveEncash.Table[D].dgColLEAmount)&&(c+='<Row DType="2" SubDType="'+D+'1" Field1="'+this.dgvLeaveEncash.Table[D+"_Tag"].toString()+'" Field2="'+this.dgvLeaveEncash.Table[D].dgColLELeaveType+'" Field3="'+this.dgvLeaveEncash.Table[D].dgColLEAvailable+'" Field4="'+this.dgvLeaveEncash.Table[D].dgColLEMaxEncash+'" Field5="'+this.dgvLeaveEncash.Table[D].dgColLEApplied+'" Field6="'+this.dgvLeaveEncash.Table[D].dgColLEAmount,c+='" />');if(this.dgvUPS.Table.length>0)for(let D=0;D<this.dgvUPS.Table.length;D++)v.J0.Double(this.dgvUPS.Table[D].dgColUPSNetSal)>0&&(c+='<Row DType="3" SubDType="'+D+'1" Field1="'+this.dgvUPS.Table[D].dgColUPSPayrollMonth+'" Field2="'+this.dgvUPS.Table[D].dgColUPSMonthDays+'" Field3="'+this.dgvUPS.Table[D].dgColUPSDaysAtt+'" Field4="'+this.dgvUPS.Table[D].dgColUPSLOP+'" Field5="'+this.dgvUPS.Table[D].dgColUPSNetSal,c+='" />');if(this.dgvNoticePay.Table.length>0)for(let D=0;D<this.dgvNoticePay.Table.length;D++)v.J0.Double(this.dgvNoticePay.Table[D].dgColNPNetSal)>0&&(c+='<Row DType="4" SubDType="'+D+'1" Field1="'+this.dgvNoticePay.Table[D].dgColNPPayrollMonth+'" Field2="'+this.dgvNoticePay.Table[D].dgColNPMonthDays+'" Field3="'+this.dgvNoticePay.Table[D].dgColNPDaysAtt+'" Field4="'+this.dgvNoticePay.Table[D].dgColNPLOP+'" Field5="'+this.dgvNoticePay.Table[D].dgColNPNetSal+'" Field6="'+this.dgvNoticePay.Table[D].dgColNPType,c+='" />');if(this.dgvOthAdd.Table.length>0)for(let D=0;D<this.dgvOthAdd.Table.length;D++)!v.J0.IsEmpty(this.dgvOthAdd.Table[D].dgColOthAddParticulars)&&v.J0.Double(this.dgvOthAdd.Table[D].dgColOthAddAmount)>0&&(c+='<Row DType="5" SubDType="'+D+'1" Field1="'+this.dgvOthAdd.Table[D].dgColOthAddParticulars+'" Field2="'+this.dgvOthAdd.Table[D].dgColOthAddAmount,v.J0.IsEmpty(this.dgvOthAdd.Table[D].dgColOthAddRemarks)||(c+='" Field3="'+this.dgvOthAdd.Table[D].dgColOthAddRemarks),c+='" />');if(this.dgvOthDed.Table.length>0)for(let D=0;D<this.dgvOthDed.Table.length;D++)!v.J0.IsEmpty(this.dgvOthDed.Table[D].dgColOthDedParticulars)&&v.J0.Double(this.dgvOthDed.Table[D].dgColOthDedAmount)>0&&(c+='<Row DType="6" SubDType="'+D+'1" Field1="'+this.dgvOthDed.Table[D].dgColOthDedParticulars+'" Field2="'+this.dgvOthDed.Table[D].dgColOthDedAmount,v.J0.IsEmpty(this.dgvOthDed.Table[D].dgColOthDedRemarks)||(c+='" Field3="'+this.dgvOthDed.Table[D].dgColOthDedRemarks),c+='" />');if(this.dgvLoanBal.Table.length>0)for(let D=0;D<this.dgvLoanBal.Table.length;D++)v.J0.IsEmpty(this.dgvLoanBal.Table[D].dgColLoanBalDocNo_Tag)||(c+='<Row DType="7" SubDType="'+D+'1" Field1="'+this.dgvLoanBal.Table[D].dgColLoanBalDocNo+'" Field2="'+this.dgvLoanBal.Table[D].dgColLoanBalDocNo_Tag+'" Field3="'+this.dgvLoanBal.Table[D].dgColLoanBalLoanType_Tag+'" Field4="'+this.dgvLoanBal.Table[D].dgColLoanBalApprAmount+'" Field5="'+this.dgvLoanBal.Table[D].dgColLoanBalAmountPaid+'" Field6="'+this.dgvLoanBal.Table[D].dgColLoanBalBalAmount+'" Field7="'+this.dgvLoanBal.Table[D].dgColLoanBalSNo_Tag,c+='" />');return c+="</Rows>",c.toString()}ValidateSave(){if(0==this.EmpSeqNo)return this.ViewModel.DisplayMessage="Please Select Employee.",this.EmployeeList.SetFocus=!0,!1;if(null!=this.dsD&&this.dsD.Tables[0].length>0&&"Final"==this.cmbSettlementType.SelectedValue&&(9e3==v.J0.ParseDate(this.dsD.Tables[0][0].DORelieve).getFullYear()||null==this.dsD.Tables[0][0].DORelieve.toString()||""==this.dsD.Tables[0][0].DORelieve.toString()||null==this.dsD.Tables[0][0].DORelieve||""==v.J0.String(this.dsD.Tables[0][0].ResignStatus)||"Posted"!=v.J0.String(this.dsD.Tables[0][0].ResignStatus)))return this.ViewModel.DisplayMessage="Selected Employee not yet Resigned, Please check",!1;let c=I.d.report.GetDataTable("FS001",this.EmpSeqNo.toString(),this.ViewModel.DocID.toString());if(null!=c&&c.length>0)return this.ViewModel.DisplayMessage="Cannot save the record, Employee FinalSettlement is Already done",this.ViewModel.MessageVisibility=!0,!1;if(("Final"==this.cmbSettlementType.SelectedValue||"Partial"==this.cmbSettlementType.SelectedValue&&I.d.SessionManager.Preferences.ContainsKey("PartialFinalSettlementMandatoryRepaymentofloan")&&"True"==I.d.SessionManager.Preferences.PartialFinalSettlementMandatoryRepaymentofloan.toString())&&this.dgvLoanBal.Table.length>0)for(let D=0;D<this.dgvLoanBal.Table.length;D++)if(v.J0.IsEmpty(this.dgvLoanBal.Table[D].dgColLoanBalCalc_Tag))return this.ViewModel.DisplayMessage="Please pay pending Loan Balance amounts.",!1;return null!=I.d.SessionManager.Preferences.PayrollProduct&&""!=I.d.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(I.d.SessionManager.Preferences.PayrollProduct)),0!=this.DefProdID||(this.ViewModel.DisplayMessage="Select any Default Payroll Product at Global Preferences",!1)}btnCalcGratuity_Click(){this.dgvGratuity.Columns.Clear(),this.dgvGratuity.TableColumns.Clear(),this.dgvGratuity.Clear();let c={dTotGratuitySal:0};if(this.dEarnedGrDays=0,this.isMaxDaysExceded=!1,this.dTotGratuityDays=0,!(this.EmpSeqNo>0))return this.ViewModel.DisplayMessage="Select any Employee",void(this.EmployeeList.SetFocus=!0);{let b=I.d.common.GetDataSet3("CRM023",this.EmpSeqNo.toString(),this.dtpDateOfRelieving.Date.Date().ToString("dd MMM yyyy"));if(null!=b&&b.Tables.length>0){if(this.isConsdExpiredupto=!1,4==this.cmbResignType.SelectedIndex&&b.Tables[0].length>0){let w=0;w=v.J0.IntTryParse(b.Tables[0][0].ConsdExpiredupto),w>0&&(this.dtpDateOfRelieving.Date=this.DOB.AddYears(w),this.isConsdExpiredupto=!0)}if(this.dLOPDays=0,this.dLOPDays=parseFloat(this.dsD.Tables[0][0].OPLOPDays),b.Tables[2].length>0)if(null!=this.dtEdit&&this.dtEdit.length>0){let w=this.dtEdit.filter($=>"1"==$.dcAlpha1&&"1"==$.dcAlpha2);null!=w&&w.length>0&&(this.dGratuityTaken=parseFloat(""==v.J0.String(w[0].dcAlpha32)?"0":w[0].dcAlpha32))}else this.dGratuityTaken=parseFloat(b.Tables[2][0].GratuityTaken);if(!(b.Tables[0].length>0))return void(this.ViewModel.DisplayMessage="Gratuity settings not found for this Grade.");{this.EOS_ROffYear=v.J0.DoubleTryParse(b.Tables[0][0].ROffYear);let X,w=this.dtpDateOfJoining.Date.Date(),$=this.dtpDateOfRelieving.Date.Date();if(this.EOS_ROffYear>0){let re=0,Te=0;if(v.J0.GetYearsMonthsDays(w,$,{iY22:0,iM22:re,iD22:Te}),re>=this.EOS_ROffYear){let t=0;Te>0?(t=12-re,$=$.AddMonths(t).AddDays(-Te)):$=$.AddMonths(-re).AddDays(-Te)}else $=$.AddMonths(-re).AddDays(-Te)}if(this.LoadExperinceDaysData(this.lst,b.Tables[0],"Resigned"==this.cmbResignType.SelectedValue?0:"Expired"==this.cmbResignType.SelectedValue?2:1),this.GratuityDocID=parseInt(b.Tables[0][0].DocID),this.GratuityGrade=parseInt(b.Tables[0][0].GradeID),this.EOS_MaxDays=v.J0.Double(b.Tables[0][0].MaxDays),this.EOS_ExcludeLOP=b.Tables[0][0].ExcludeLOP.toString(),this.ActEOS_ExcludeLOP=b.Tables[0][0].ExcludeLOP.toString(),this.EOS_ROff=v.J0.Double(b.Tables[0][0].ROff),this.EOS_CalcBasedOn=b.Tables[0][0].CalcBasedOn.toString(),this.EOS_GratuityFormula=b.Tables[0][0].Formula.toString(),this.EOS_AvailedFormula=null!=b.Tables[0][0].AvailedFormula&&null!=b.Tables[0][0].AvailedFormula&&""!=b.Tables[0][0].AvailedFormula.toString().Trim()?b.Tables[0][0].AvailedFormula.toString():"GratuityAmount","Exclude at Last"==this.EOS_ExcludeLOP){this.EOS_ExcludeLOP="No";let U={PayrollMonth:D=new Date,PayrollMonthStart:new Date,PayrollMonthEnd:P=new Date};v.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,U),D=U.PayrollMonth,P=U.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,U,this.EmpGrade),D=U.PayrollMonth,P=U.PayrollMonthEnd);let re=new Date(this.dtpDateOfJoining.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),1),Te=D,L=0;if(I.d.SessionManager.Preferences.ContainsKey("FinalSettlementConsiderLopBasedOnLopLeave")&&"True"==I.d.SessionManager.Preferences.FinalSettlementConsiderLopBasedOnLopLeave.toString())L=this.GetLOPDaysFromDoc(re,P),this.dLOPDays+=L;else{L=this.GetPreviousLOPDays(re,Te),this.dLOPDays+=L;let t=I.d.common.GetDataSet3("CRM024",this.EmpSeqNo.toString(),re.ToString("dd/MMM/yyyy"),Te.ToString("dd/MMM/yyyy"));null!=t&&t.Tables.length>0&&(t.Tables[0].length>0&&(this.dLOPDays+=parseFloat(t.Tables[0][0].LOP.toString())),t.Tables[1].length>0&&(this.dLOPDays-=parseFloat(t.Tables[1][0].LOP.toString())))}$=$.AddDays(-this.dLOPDays)}for(let U=0;U<8;U++)X=new ee.O7,X.DisplayMember="Column"+U,X.ReadOnly=!0,X.Header="",X.Width=0==U?150:80,this.dgvGratuity.Columns.push(X),this.dgvGratuity.TableColumns.push(X.DisplayMember);if(this.dgvGratuity.RefreshColumns(),this.dActServiceDays=$.Subtract(w).Days+1,"Service Days"==this.EOS_CalcBasedOn){if(this.dServiceDaysAfterLOP=0,"No"!=this.EOS_ExcludeLOP){var D,P;let L={PayrollMonth:D=new Date,PayrollMonthStart:new Date,PayrollMonthEnd:P=new Date};v.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,L),D=L.PayrollMonth,P=L.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(this.dtpDateOfRelieving.Date,L,this.EmpGrade),D=L.PayrollMonth,P=L.PayrollMonthEnd);let t=new Date(this.dtpDateOfJoining.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),1),l=D,a=0;if(I.d.SessionManager.Preferences.ContainsKey("FinalSettlementConsiderLopBasedOnLopLeave")&&"True"==I.d.SessionManager.Preferences.FinalSettlementConsiderLopBasedOnLopLeave.toString())a=this.GetLOPDaysFromDoc(t,P),this.dLOPDays+=a;else{a=this.GetPreviousLOPDays(t,l),this.dLOPDays+=a;let i=I.d.common.GetDataSet3("CRM025",this.EmpSeqNo.toString(),t.ToString("dd/MMM/yyyy"),l.ToString("dd/MMM/yyyy"));null!=i&&i.Tables.length>0&&i.Tables[0].length>0&&(this.dLOPDays+=parseFloat(i.Tables[0][0].LOP.toString()))}}this.dServiceDaysAfterLOP=this.dActServiceDays-this.dLOPDays,this.EOS_GratuityFormula=this.EOS_GratuityFormula.Replace("ServiceDays",this.dActServiceDays.toString()),this.EOS_GratuityFormula=this.EOS_GratuityFormula.Replace("LOPDays",this.dLOPDays.toString()),this.EOS_AvailedFormula=this.EOS_AvailedFormula.Replace("ServiceDays",this.dActServiceDays.toString())}this.dblGratuityAmount=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly);let J=this.dtpDateOfJoining.Date.Date(),Y=this.dtpDateOfRelieving.Date.Date(),R=0,H=0,ge=0,Z={iY:R,iM:H,iD:ge};if(v.J0.GetYearsMonthsDays(J,Y,Z),R=Z.iY,H=Z.iM,ge=Z.iD,"Service Days"==this.EOS_CalcBasedOn){this.CalcGratuityBasedOnServiceDays(this.dblGratuityAmount,w,$,c);let U=0,re=0,Te=0,L={iY:U,iM:re,iD:Te};v.J0.GetYearsMonthsDays(w,$,L),U=L.iY,re=L.iM,Te=L.iD,this.lblGratuityTotalDays=U+" : "+this.GetResource("Years",40095)+", "+re+" : "+this.GetResource("Months",40095)+", "+Te+" : "+this.GetResource("Days",40095),this.txtGratuityAmount.Text=c.dTotGratuitySal.ToString(I.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount(),this.oEvalPayFormulas=new xe.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let t={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};if(v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),t),this.oEvalPayFormulas.PayrollMonth=t.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=t.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=t.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),L,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=t.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=t.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=t.PayrollMonthEnd),this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new xe.ph,this.oCPF.ComponentName="GratuityAvailedFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_AvailedFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),b.Tables[1].length>0){this.dgvOthAdd.addEmptyRows(b.Tables[1].length);for(let l=0;l<b.Tables[1].length;l++)this.oCPF=new xe.ph,this.oCPF.ComponentName="Lookup"+b.Tables[1][l].NodeID.toString(),this.oCPF.SNo=l+1,null!=b.Tables[0][0][b.Tables[1][l].SysColumnName.toString()]&&null!=b.Tables[0][0][b.Tables[1][l].SysColumnName.toString()]&&(this.oCPF.Formula=b.Tables[0][0][b.Tables[1][l].SysColumnName.toString()].toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.dgvOthAdd.Table[l].dgColOthAddParticulars=parseInt(b.Tables[1][l].NodeID.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[l])}this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.GratuityAmount=parseFloat(this.txtGratuityAmount.Text),this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=R,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let l=0;l<this.oEvalPayFormulas.arrLstCPFields[6].length;l++)if("GratuityAvailedFormula"==this.oEvalPayFormulas.arrLstCPFields[6][l].ComponentName)this.txtPartialGratuityAmount.Text="Partial"==this.cmbSettlementType.SelectedValue?(parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken).ToString(I.d.SessionManager.sPayrollDecimals):(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Text=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][l].dEarned).ToString(I.d.SessionManager.sPayrollDecimals);else for(let a=0;a<this.dgvOthAdd.Table.length;a++)if(this.oEvalPayFormulas.arrLstCPFields[6][l].ComponentName=="Lookup"+v.J0.String(this.dgvOthAdd.Table[a].dgColOthAddParticulars)){this.dgvOthAdd.Table[a].dgColOthAddAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][l].dEarned).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[a]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2);break}return}let ne,ce=w,Le=0,je=0,Fe=0,pe={iY:Le,iM:je,iD:Fe};v.J0.GetYearsMonthsDays(w,$,pe),Le=pe.iY,je=pe.iM,Fe=pe.iD;let ve=!!this.chkCalcBasedOnLastSal.IsChecked&&this.chkCalcBasedOnLastSal.IsChecked,dt=this.dblGratuityAmount,Ee=new Array,we=new Array,be=new Array;Ee.push(ce);for(let U=0;U<this.lst.length;U++){if(Le<parseInt(this.lst[U].Year.Replace("=",""))){we.push($),be.push(be.length>0?be[be.length-1]:0);break}if(this.lst[U].Days>0){if(this.lst[U].IsApplyToPrevYrs)for(let re=0;re<be.length;re++)be[re]=this.lst[U].Days;if(ne=ce.AddYears(parseInt(this.lst[U].Year.Replace("=",""))).AddDays(-1),ne>=$){ne=$,we.push(ne),be.push(this.lst[U].Days);break}be.Contains(this.lst[U].Days)?(we[we.length-1]=ne,Ee[Ee.length-1]=ne.AddDays(1)):(be.push(this.lst[U].Days),we.push(ne),Ee.push(ne.AddDays(1)))}}if(this.isLast=!1,Ee.length>0)for(let U=0;U<Ee.length;U++)if(U==Ee.length-1&&(this.isLast=!0),ve){if(Ee.length>U+1)if(be[U]!=be[U+1]){if(this.CalcGratuityDays(be[U],dt,Ee[U],we[U],c),this.isMaxDaysExceded)break}else we[U]=we[U+1],Ee.RemoveAt(U+1),we.RemoveAt(U+1),be.RemoveAt(U+1),U--;else if(this.isConsdExpiredupto){if(this.CalcGratuityDays(be[U],dt,Ee[U],this.dtActRelievingDate,c),this.isMaxDaysExceded||(this.CalcGratuityDays(be[U],dt,this.dtActRelievingDate.AddDays(1),we[U],c),this.isMaxDaysExceded))break}else if(this.CalcGratuityDays(be[U],dt,Ee[U],we[U],c),this.isMaxDaysExceded)break}else if(Ee.length>U+1)if(be[U]!=be[U+1]){let re=this.dsD.Tables[3].filter(L=>v.J0.ParseDate(L.dtEffectFrom)>=Ee[U].AddDays(1)&&v.J0.ParseDate(L.dtEffectFrom)<=we[U]),Te=this.dsD.Tables[3].filter(L=>v.J0.ParseDate(L.dtEffectFrom)<=Ee[U]);if(Te.SortBy([{name:"dtEffectFrom",desc:!0}]),null!=re&&re.length>0){let t,L=0;for(L=0;L<re.length;L++)if(0==L){if(this.CalcGratuityDays(be[U],parseFloat(Te[0].BasicMonthly),Ee[U],v.J0.ParseDate(re[L].dtEffectFrom).AddDays(-1),c),this.isMaxDaysExceded){t=!0;break}}else if(this.CalcGratuityDays(be[U],parseFloat(re[L-1].BasicMonthly),v.J0.ParseDate(re[L-1].dtEffectFrom),v.J0.ParseDate(re[L].dtEffectFrom).AddDays(-1),c),this.isMaxDaysExceded){t=!0;break}if(t||(this.CalcGratuityDays(be[U],parseFloat(re[L-1].BasicMonthly),v.J0.ParseDate(re[L-1].dtEffectFrom),we[U],c),this.isMaxDaysExceded))break}else if(this.CalcGratuityDays(be[U],parseFloat(Te[0].BasicMonthly),Ee[U],we[U],c),this.isMaxDaysExceded)break}else we[U]=we[U+1],Ee.RemoveAt(U+1),we.RemoveAt(U+1),be.RemoveAt(U+1),U--;else{let re=this.dsD.Tables[3].filter(L=>v.J0.ParseDate(L.dtEffectFrom)>=Ee[U].AddDays(1)&&v.J0.ParseDate(L.dtEffectFrom)<=we[U]),Te=this.dsD.Tables[3].filter(L=>v.J0.ParseDate(L.dtEffectFrom)<=Ee[U]);if(Te.SortBy([{name:"dtEffectFrom",desc:!0}]),null!=re&&re.length>0){let t,L=0;for(L=0;L<re.length;L++)if(0==L){if(this.CalcGratuityDays(be[U],parseFloat(Te[0].BasicMonthly),Ee[U],v.J0.ParseDate(re[L].dtEffectFrom).AddDays(-1),c),this.isMaxDaysExceded){t=!0;break}}else if(this.CalcGratuityDays(be[U],parseFloat(re[L-1].BasicMonthly),v.J0.ParseDate(re[L-1].dtEffectFrom),v.J0.ParseDate(re[L].dtEffectFrom).AddDays(-1),c),this.isMaxDaysExceded){t=!0;break}if(t||(this.CalcGratuityDays(be[U],parseFloat(re[L-1].BasicMonthly),v.J0.ParseDate(re[L-1].dtEffectFrom),we[U],c),this.isMaxDaysExceded))break}else if(this.CalcGratuityDays(be[U],parseFloat(Te[0].BasicMonthly),Ee[U],we[U],c),this.isMaxDaysExceded)break}let nt=0,ht=0,pt=0,tt={iY:nt,iM:ht,iD:pt};v.J0.GetYearsMonthsDays(w,$,tt),nt=tt.iY,ht=tt.iM,pt=tt.iD,this.lblGratuityTotalDays=nt+" : "+this.GetResource("Years",40095)+", "+ht+" : "+this.GetResource("Months",40095)+", "+pt+" : "+this.GetResource("Days",40095),this.txtGratuityAmount.Text=c.dTotGratuitySal.ToString(I.d.SessionManager.sPayrollDecimals);let Xe=this.dtpDateOfRelieving.Date.Date().Subtract(w.Date()).Days+1;if(this.lblGratuityServiceDays=Xe.toString(),this.lblGratuityLOPDays=this.dLOPDays.toString(),this.lblGratuityBalDays=(Xe-this.dLOPDays).toString(),this.lblGratuityTotalGrDays=this.dTotGratuityDays.toString(),this.lblGratuityTaken=this.dGratuityTaken.toString(),this.oEvalPayFormulas=new xe.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString(),Z={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd},v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),Z),this.oEvalPayFormulas.PayrollMonth=Z.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=Z.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=Z.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),Z,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=Z.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=Z.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=Z.PayrollMonthEnd),this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new xe.ph,this.oCPF.ComponentName="GratuityAvailedFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_AvailedFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),b.Tables[1].length>0){this.dgvOthAdd.addEmptyRows(b.Tables[1].length);for(let U=0;U<b.Tables[1].length;U++)this.oCPF=new xe.ph,this.oCPF.ComponentName="Lookup"+b.Tables[1][U].NodeID.toString(),this.oCPF.SNo=U+1,v.J0.IsEmpty(b.Tables[0][0][b.Tables[1][U].SysColumnName.toString()])||(this.oCPF.Formula=b.Tables[0][0][b.Tables[1][U].SysColumnName.toString()].toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.dgvOthAdd.Table[U].dgColOthAddParticulars=parseInt(b.Tables[1][U].NodeID.toString()),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[U])}this.oEvalPayFormulas.othMPField.IsFinalSettlement=!0,this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.GratuityAmount=parseFloat(this.txtGratuityAmount.Text),this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=R,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let U=0;U<this.oEvalPayFormulas.arrLstCPFields[6].length;U++)if("GratuityAvailedFormula"==this.oEvalPayFormulas.arrLstCPFields[6][U].ComponentName)this.txtPartialGratuityAmount.Text="Partial"==this.cmbSettlementType.SelectedValue?(parseFloat(this.txtAvailedGratuityAmount.Text)-this.dGratuityTaken).ToString(I.d.SessionManager.sPayrollDecimals):(0).ToString(I.d.SessionManager.sPayrollDecimals),this.txtAvailedGratuityAmount.Text=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][U].dEarned).ToString(I.d.SessionManager.sPayrollDecimals);else for(let re=0;re<this.dgvOthAdd.Table.length;re++)if(this.oEvalPayFormulas.arrLstCPFields[6][U].ComponentName=="Lookup"+v.J0.String(this.dgvOthAdd.Table[re].dgColOthAddParticulars)){this.dgvOthAdd.Table[re].dgColOthAddAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][U].dEarned).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvOthAdd.updateRow(this.dgvOthAdd.Table[re]),this.dgvOthAdd_CellEndEdit(this.dgvOthAdd,2);break}}}}this.CalculateTotalAmount()}LoadExperinceDaysData(c,D,M){c.Clear();let P="Res";1==M?P="Term":2==M&&(P="Expired");for(let b=0;b<D.length;b++)c.push(new Rt),c[b].Year=D[b][P+"Exp"].toString().Contains("+")?D[b][P+"Exp"].toString().Replace("[+]",""):"="+D[b][P+"Exp"].toString(),c[b].Days=parseFloat(D[b][P+"GrDays"]),c[b].IsApplyToPrevYrs="Yes"==D[b][P+"ApplyPrevYrs"].toString()}CalcGratuityDays(c,D,M,P,b){this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity/Year",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=c;let w=c,$="";this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Period",40095),$=this.GetResource("Start Date",40095)+M.ToString("dd/MMM/yyyy")+"          ",$+=this.GetResource("End Date",40095)+P.ToString("dd/MMM/yyyy");let J=0,Y=0,R=0,H=this.dtpDateOfJoining.Date.Date(),ge=this.dtpDateOfRelieving.Date.Date(),Z=0,ce=0,ne=0,Me={iY:Z,iM:ce,iD:ne};v.J0.GetYearsMonthsDays(H,P,Me),Z=Me.iY,ce=Me.iM,ne=Me.iD;let We=0,Le=0,je=0,Fe={iY:We,iM:Le,iD:je};v.J0.GetYearsMonthsDays(M,P,Fe),We=Fe.iY,Le=Fe.iM,je=Fe.iD;let pe=0;if("No"!=this.EOS_ExcludeLOP){var ve=new Date,Ct=new Date,dt=new Date,Ee={PayrollMonth:ve,PayrollMonthStart:Ct,PayrollMonthEnd:dt};if(v.J0.SetPayrollDate_1(P,Ee),ve=Ee.PayrollMonth,Ct=Ee.PayrollMonthStart,dt=Ee.PayrollMonthEnd,I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&(v.J0.SetPayrollDate_1(P,Ee,this.EmpGrade),ve=Ee.PayrollMonth,Ct=Ee.PayrollMonthStart,dt=Ee.PayrollMonthEnd),I.d.SessionManager.Preferences.ContainsKey("FinalSettlementConsiderLopBasedOnLopLeave")&&"True"==I.d.SessionManager.Preferences.FinalSettlementConsiderLopBasedOnLopLeave.toString())pe=this.GetLOPDaysFromDoc(M,P);else{pe=this.GetPreviousLOPDays(M,ve);let Te=I.d.common.GetDataSet3("CRM026",this.EmpSeqNo.toString(),M.ToString("dd/MMM/yyyy"),ve.ToString("dd/MMM/yyyy"));null!=Te&&Te.Tables.length>0&&Te.Tables[0].length>0&&(pe+=parseFloat(Te.Tables[0][0].LOP.toString()))}let U=P;U=M==this.dtpDateOfJoining.Date.Date()?U.AddDays(-(this.dLOPDays+pe)):U.AddDays(-pe);let re={iY:We,iM:Le,iD:je};v.J0.GetYearsMonthsDays(M,U,re),We=re.iY,Le=re.iM,je=re.iD,this.dLOPDays+=pe}J=We*w,Y=Le/12*w,R=je/365*w,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Start Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=M.ToString("dd/MMM/yyyy"),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=P.ToString("dd/MMM/yyyy"),"Exclude at Last"==this.ActEOS_ExcludeLOP&&P.ToString("dd MMM yyyy")==ge.AddDays(-this.dLOPDays).ToString("dd MMM yyyy")&&(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("Actual End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=ge.ToString("dd/MMM/yyyy"));let we=!!this.chkCalcBasedOnActDays.IsChecked&&this.chkCalcBasedOnActDays.IsChecked,be=0,nt=0,ht=0;if(we){let Te,U=M,re=P,L=0,t=0;for(;U<=re;){if(Te=new Date(U.getFullYear(),U.getMonth(),U.DaysInMonth()),!(Te<=re)){L=re.Subtract(U).Days+1,nt+=L,t=D*L/Te.getDate(),ht+=t;break}L=Te.Subtract(U).Days+1,nt+=L,t=D*L/Te.getDate(),ht+=t,U=Te.AddDays(1)}be=ht/nt}let pt=P.Subtract(M).Days+1;this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Basic Salary",40095);let tt=0;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=D,tt=D,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Days Worked",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=We+" : "+this.GetResource("Years",40095)+", "+Le+" : "+this.GetResource("Months",40095)+", "+je+" : "+this.GetResource("Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=pt,"Exclude at Last"==this.ActEOS_ExcludeLOP?this.isLast&&(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("Total LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=this.dLOPDays):(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.GetResource("LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]=pe),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Years",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.GetResource("Months",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Days",40095),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=We,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=Le,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=je,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Available Gratuity",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=J,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=Y,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=R;let Xe=J+Y+R;if(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=Xe,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]="=",Xe=Q.RoundOffValue(Xe,this.EOS_ROff),this.EOS_MaxDays>0&&this.dEarnedGrDays+Xe>=this.EOS_MaxDays?(Xe=this.EOS_MaxDays-this.dEarnedGrDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=Xe,this.isMaxDaysExceded=!0):(this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=Xe,this.dEarnedGrDays+=Xe),this.dTotGratuityDays+=Xe,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity",40095),we)this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=ht+" / "+nt,tt=be*Xe;else{let U=this.dtpDateOfJoining.Date.Date(),re=this.dtpDateOfRelieving.Date.Date(),Te=0,L=0,t=0,l={iY:Te,iM:L,iD:t};v.J0.GetYearsMonthsDays(U,re,l),Te=l.iY,L=l.iM,t=l.iD;let a=!!this.chkCalcBasedOnLastSal.IsChecked&&this.chkCalcBasedOnLastSal.IsChecked;this.oEvalPayFormulas=new xe.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString(),l={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd},a?(v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),l),I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),l,this.EmpGrade)):(v.J0.SetPayrollDate_1(M.Date(),l),I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&v.J0.SetPayrollDate_1(M.Date(),l,this.EmpGrade)),this.oEvalPayFormulas.PayrollMonth=l.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=l.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=l.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new xe.ph,this.oCPF.ComponentName="GratuityFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_GratuityFormula.Replace("GratuityDays",Xe.toString()),this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.othMPField.IsFinalSettlement=!0,this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.BasicMonthly=D,this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=Te,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let i=0;i<this.oEvalPayFormulas.arrLstCPFields[6].length;i++)if("GratuityFormula"==this.oEvalPayFormulas.arrLstCPFields[6][i].ComponentName){tt=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][i].dEarned);break}}this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=tt,b.dTotGratuitySal+=tt,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.refreshDataView(),console.log(this.dgvGratuity)}GetPreviousLOPDays(c,D){let M=0,P=I.d.common.GetDataSet3("CRM027",this.EmpSeqNo.toString(),c.ToString("dd/MMM/yyyy"),D.ToString("dd/MMM/yyyy")).Tables[0];return null!=P&&P.length>0&&(M=parseFloat(P[0].LOPDays)),M}GetLOPDaysFromDoc(c,D){let M=0;if(I.d.SessionManager.Preferences.ContainsKey("ConsiderLOPBasedOn")&&""!=I.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString()){let P=[];P.push(this.EmpSeqNo),P.push(c.ToString("dd/MMM/yyyy")),P.push(c.ToString("dd/MMM/yyyy")),P.push(D.ToString("dd/MMM/yyyy")),P.push(2),P.push(I.d.SessionManager.UserID),P.push(I.d.SessionManager.RoleID),P.push(I.d.SessionManager.LanguageID);let b=I.d.common.GetDataSet_SP(P,"spPAY_GetEmpAdjDetailsMultiple"),w=[];w.push(c.ToString("dd MMM yyyy")),w.push(""),w.push(0),w.push(I.d.SessionManager.RoleID),w.push(I.d.SessionManager.UserID),w.push(I.d.SessionManager.LanguageID);let $=I.d.common.GetDataSet_SP(w,"spPAY_GetEmpMasterCCDetails");null!=b&&b.Tables.length>0&&b.Tables[0].length>0&&b.Columns[0].Contains("EmpSeqNo")&&(M=this.AggregateLeaves(this.EmpSeqNo.toString(),b,c,D,$,this.dsD.Tables[0],this.EmpGrade))}return M}static RoundOffValue(c,D){if(D>0&&c>0){let M=0,P=!1;M=c%D,M>0&&(D/M<=2&&(P=!0),c-=M,P&&(c+=D))}return c}CalcGratuityBasedOnServiceDays(c,D,M,P){this.dgvGratuity.addEmptyRow();let b="";this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Period",40095),b=this.GetResource("Start Date",40095)+D.ToString("dd/MMM/yyyy")+"          ",b+=this.GetResource("End Date",40095)+M.ToString("dd/MMM/yyyy");let w=0,$=0,X=0,J={iY:w,iM:$,iD:X};v.J0.GetYearsMonthsDays(D,M,J),w=J.iY,$=J.iM,X=J.iD,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Start Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=D.ToString("dd/MMM/yyyy"),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("End Date",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=M.ToString("dd/MMM/yyyy");let Y=M.Subtract(D).Days+1;this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Basic Salary",40095);let R=0;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=c,R=c,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Days Worked",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=w+" : "+this.GetResource("Years",40095)+", "+$+" : "+this.GetResource("Months",40095)+", "+X+" : "+this.GetResource("Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]=Y,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.GetResource("Total Duration Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.GetResource("LOP Days",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.GetResource("Total Service Days",40095),this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dActServiceDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]=this.dLOPDays,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]=this.dServiceDaysAfterLOP,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Total Years",40095),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[1]]=this.dServiceDaysAfterLOP,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[2]]="/",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[3]]="365";let H=this.dServiceDaysAfterLOP/365;this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[4]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=H,this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[6]]="=",this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[7]]=H,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]=this.GetResource("Gratuity Amount",40095);{this.oEvalPayFormulas=new xe.yg,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let ge={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),ge),I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),ge,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=ge.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=ge.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=ge.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),this.oCPF=new xe.ph,this.oCPF.ComponentName="GratuityFormula",this.oCPF.SNo=0,this.oCPF.Formula=this.EOS_GratuityFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.othMPField.sResignType=this.cmbResignType.SelectedValue.toString(),this.oEvalPayFormulas.othMPField.BasicMonthly=c,this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.othMPField.dServiceDays=this.dActServiceDays,this.oEvalPayFormulas.othMPField.dServiceYears=w,this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.ExecuteAllFormulas();for(let Z=0;Z<this.oEvalPayFormulas.arrLstCPFields[6].length;Z++)if("GratuityFormula"==this.oEvalPayFormulas.arrLstCPFields[6][Z].ComponentName){this.dServiceDaysFormulaAmount=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][Z].dEarned);break}}this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[5]]=this.dServiceDaysFormulaAmount,P.dTotGratuitySal+=this.dServiceDaysFormulaAmount,this.dgvGratuity.addEmptyRow(),this.dgvGratuity.Table[this.dgvGratuity.Table.length-1][this.dgvGratuity.TableColumns[0]]="* * * * *"}dgvLeaveEncash_CellValidating(c,D){}btnCalcLeaveEncash_Click(){let c=this.chkLECalcBasedOnLastApprSerYearWise.IsChecked;this.oEvalPayFormulas=new xe.yg,this.oEvalPayFormulas.othMPField.IsFinalSettlement=!1,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let D={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),D),I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&v.J0.SetPayrollDate_1(this.dtpDocDate.Date.Date(),D,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=D.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=D.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=D.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear();let M=0;if(this.dgvLeaveEncash.Table.length>0){for(let b=0;b<this.dgvLeaveEncash.Table.length;b++)c&&this.dgvLeaveEncash.Table[b].dgColLELeaveType_Tag==this.sVacTypeSeqNo||v.J0.IsEmpty(this.dgvLeaveEncash.Table[b].dgColLEApplied)||(v.J0.IsEmpty(this.dgvLeaveEncash.Table[b].dgColLEAmount_Tag)||(this.strFormula=this.dgvLeaveEncash.Table[b].dgColLEAmount_Tag.toString()),this.strFormula=this.strFormula.Replace("EncashDays","("+this.dgvLeaveEncash.Table[b].dgColLEApplied.toString().Replace("-","!")+")"),this.oCPF=new xe.ph,this.oCPF.ComponentName="LEFormula"+this.dgvLeaveEncash.Table[b+"_Tag"].toString(),this.oCPF.SNo=parseInt(this.dgvLeaveEncash.Table[b+"_Tag"]),this.oCPF.Formula=this.strFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF));this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.othMPField.BasicMonthly=parseFloat(this.dsD.Tables[3][this.dsD.Tables[3].length-1].BasicMonthly),this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.ExecuteAllFormulas();for(let b=0;b<this.dgvLeaveEncash.Table.length;b++)if((!c||this.dgvLeaveEncash.Table[b].dgColLELeaveType_Tag!=this.sVacTypeSeqNo)&&0!=v.J0.Double(this.dgvLeaveEncash.Table[b].dgColLEApplied))for(let w=0;w<this.oEvalPayFormulas.arrLstCPFields[6].length;w++)if(this.oEvalPayFormulas.arrLstCPFields[6][w].ComponentName=="LEFormula"+this.dgvLeaveEncash.Table[b+"_Tag"].toString()){this.dgvLeaveEncash.Table[b].dgColLEAmount=this.oEvalPayFormulas.arrLstCPFields[6][w].dEarned,M+=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][w].dEarned);break}}let P=0;if(c&&this.dgvLeaveEncash.Table.length>0)for(let b=0;b<this.dgvLeaveEncash.Table.length;b++)if(this.dgvLeaveEncash.Table[b].dgColLELeaveType_Tag.toString()==this.sVacTypeSeqNo){if(!v.J0.IsEmpty(this.dgvLeaveEncash.Table[b].dgColLEApplied)&&parseFloat(this.dgvLeaveEncash.Table[b].dgColLEApplied)>0){let Y,R,$=parseFloat(this.dgvLeaveEncash.Table[b].dgColLEApplied),X=0,J=null;try{Y=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),this.dtpDateOfJoining.Date.getDate())}catch{Y=new Date(this.dtpDateOfRelieving.Date.getFullYear(),this.dtpDateOfJoining.Date.getMonth(),this.dtpDateOfJoining.Date.getDate()-1)}for(Y>this.dtpDateOfRelieving.Date&&(Y=Y.AddYears(-1)),R=this.dtpDateOfRelieving.Date;$>0;){J=this.ViewModel.GetVacationDays(Y,R,this.EmpSeqNo),X=parseFloat(J.Tables[1][0].CreditedDays),X>$&&(X=$),this.oEvalPayFormulas=new xe.yg,this.oEvalPayFormulas.othMPField.IsFinalSettlement=!1,this.oEvalPayFormulas.sEmpSeqNo=this.EmpSeqNo.toString();let H={PayrollMonth:this.oEvalPayFormulas.PayrollMonth,PayrollMonthStart:this.oEvalPayFormulas.PayrollMonthStart,PayrollMonthEnd:this.oEvalPayFormulas.PayrollMonthEnd};v.J0.SetPayrollDate_1(R,H),I.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==I.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&this.EmpGrade>0&&v.J0.SetPayrollDate_1(R,H,this.EmpGrade),this.oEvalPayFormulas.PayrollMonth=H.PayrollMonth,this.oEvalPayFormulas.PayrollMonthStart=H.PayrollMonthStart,this.oEvalPayFormulas.PayrollMonthEnd=H.PayrollMonthEnd,this.oEvalPayFormulas.arrLstCPFields[6].Clear(),null!=this.dgvLeaveEncash.Table[b].dgColLEAmount_Tag&&""!=this.dgvLeaveEncash.Table[b].dgColLEAmount_Tag.toString().Trim()&&(this.strFormula=this.dgvLeaveEncash.Table[b].dgColLEAmount_Tag.toString()),this.strFormula=this.strFormula.Replace("EncashDays","("+X.toString().Replace("-","!")+")"),this.oCPF=new xe.ph,this.oCPF.ComponentName="LEFormula"+this.dgvLeaveEncash.Table[b+"_Tag"].toString(),this.oCPF.SNo=parseInt(this.dgvLeaveEncash.Table[b+"_Tag"]),this.oCPF.Formula=this.strFormula,this.oCPF.dEarned=this.oCPF.dActual="0",this.oEvalPayFormulas.arrLstCPFields[6].push(this.oCPF),this.oEvalPayFormulas.Intialize(),this.oEvalPayFormulas.othMPField.BasicMonthly=parseFloat(this.oEvalPayFormulas.dsAllEmpsData.Tables[2][this.dsD.Tables[2].length-1].BasicMonthly),this.oEvalPayFormulas.othMPField.TotalLeaves=0,this.oEvalPayFormulas.othMPField.DaysAttended=this.oEvalPayFormulas.othMPField.TotalDays,this.oEvalPayFormulas.ExecuteAllFormulas(),P+=parseFloat(this.oEvalPayFormulas.arrLstCPFields[6][0].dEarned),$=parseFloat(($-X).ToString("0.00")),R=Y.AddDays(-1),Y=Y.AddYears(-1)}this.dgvLeaveEncash.Table[b].dgColLEAmount=P}break}this.txtLEAmount.Text=(parseFloat(this.txtCumLeaveSalBalAmt.Text)+M+P).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLeaveEncash.invalidate(),this.CalculateTotalAmount()}dgvUPS_CellClick(c,D){if("dgColUPSCalc"==this.dgvUPS.Columns[c.cell].DisplayMember){v.J0.SetPayrollMonth(v.J0.ParseDate(this.dgvUPS.Table[c.row].dgColUPSPayrollMonth));let M=new $e.MonthlyPayrollViewModel("Monthly Payroll","UnProcessed");M.sProcessType="UnProcessed",M.SelectedEmpID=this.EmpSeqNo,M.EmployeeList.Code.SelectedValue=M.EmployeeList.Name.SelectedValue=this.EmpSeqNo,M.EmployeeList.Code.Text=M.EmployeeList.Name.Text=this.EmployeeList.Text,M.InitSelectedEmployee(),I.d.page.ShowDialog(M,le.MonthlyPayrollComponent,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{M.DialogResult&&(this.dgvUPS.Table[c.row].dgColUPSDaysAtt=M.dFS_DaysAttended,this.dgvUPS.Table[c.row].dgColUPSLOP=M.dFS_LOPDays,this.dgvUPS.Table[c.row].dgColUPSNetSal=M.dFS_NetSal,this.dgvUPS.updateRow(this.dgvUPS[c.row]));let P=0;if(this.dgvUPS.Table.length>0)for(let b=0;b<this.dgvUPS.Table.length;b++)P+=parseFloat(this.dgvUPS.Table[b].dgColUPSNetSal);this.txtUPSAmount.Text=P.ToString(I.d.SessionManager.sPayrollDecimals),this.dgvUPS.invalidate(),this.CalculateTotalAmount()})}}dgvNoticePay_CellClick(c,D){if("dgColNPCalc"==this.dgvNoticePay.Columns[c.cell].DisplayMember){v.J0.SetPayrollMonth(v.J0.ParseDate(this.dgvNoticePay.Table[c.row].dgColNPPayrollMonth));let M=new $e.MonthlyPayrollViewModel("Monthly Payroll","NoticePay");M.sProcessType="NoticePay",M.SelectedEmpID=this.EmpSeqNo,M.EmployeeList.Code.SelectedValue=M.EmployeeList.Name.SelectedValue=this.EmpSeqNo,M.EmployeeList.Code.Text=M.EmployeeList.Name.Text=this.EmployeeList.Text,M.InitSelectedEmployee(),I.d.page.ShowDialog(M,le.MonthlyPayrollComponent,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{M.DialogResult&&(this.dgvNoticePay.Table[c.row].dgColNPDaysAtt=M.dFS_DaysAttended,this.dgvNoticePay.Table[c.row].dgColNPLOP=M.dFS_LOPDays,this.dgvNoticePay.Table[c.row].dgColNPNetSal=M.dFS_NetSal,this.dgvNoticePay.updateRow(this.dgvNoticePay[c.row])),this.CalculateNoticePayAmount()})}}CalculateNoticePayAmount(){let c=0;if(this.dgvNoticePay.Table.length>0)for(let D=0;D<this.dgvNoticePay.Table.length;D++)"Add"==v.J0.String(this.dgvNoticePay.Table[D].dgColNPType)?c+=parseFloat(this.dgvNoticePay.Table[D].dgColNPNetSal):"Subtract"==v.J0.String(this.dgvNoticePay.Table[D].dgColNPType)&&(c-=parseFloat(this.dgvNoticePay.Table[D].dgColNPNetSal));this.txtNPAmount.Text=c.ToString(I.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dgvOthAdd_CellEndEdit(c,D){null==D&&(D=c.cell),"dgColOthAddAmount"==this.dgvOthAdd.Columns[D].DisplayMember&&(this.dgvOthAdd.addEmptyRow(),this.GenerateSerialNos(this.dgvOthAdd,"dgvOthAdd")),"dgColOthAddAmount"==this.dgvOthAdd.Columns[D].DisplayMember&&this.CalculateOthAddAmount()}dgvOthAdd_RowsAdded(c,D){this.GenerateSerialNos(this.dgvOthAdd)}CalculateOthAddAmount(){let c=0;for(let D=0;D<this.dgvOthAdd.Table.length;D++)v.J0.IsEmpty(this.dgvOthAdd.Table[D].dgColOthAddAmount)||(c+=parseFloat(this.dgvOthAdd.Table[D].dgColOthAddAmount));this.txtOthAddAmount.Text=c.ToString(I.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dgvOthDed_CellEndEdit(c,D){null==D&&(D=c.cell),"dgColOthDedAmount"==this.dgvOthDed.Columns[D].DisplayMember&&(this.dgvOthDed.addEmptyRow(),this.GenerateSerialNos(this.dgvOthDed,"dgvOthDed")),"dgColOthDedAmount"==this.dgvOthDed.Columns[D].DisplayMember&&this.CalculateOthDedAmount()}dgvOthDed_RowsAdded(c,D){this.GenerateSerialNos(this.dgvOthDed)}CalculateOthDedAmount(){let c=0;for(let D=0;D<this.dgvOthDed.Table.length;D++)v.J0.IsEmpty(this.dgvOthDed.Table[D].dgColOthDedAmount)||(c+=parseFloat(this.dgvOthDed.Table[D].dgColOthDedAmount));this.txtOthDedAmount.Text=c.ToString(I.d.SessionManager.sPayrollDecimals),this.CalculateTotalAmount()}dtpDateOfRelieving_SelectedDateChanged(c,D){this.RefreshLeaveEncashDetails()}btnSaveAndPrint_Click(c){this.ViewModel.SelectedEmpID>0?(this.Save_Click(),this.ViewModel.IsSaved&&this.ViewModel.DocID>0&&(this.ViewModel.IsSaved=!1,this.ViewModel.SelectedEmpID=0)):(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0)}btnPrint_Click(c){this.ViewModel.DocID>0||(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0)}btnPrintPreview_Click(c){this.ViewModel.DocID>0||(this.ViewModel.DisplayMessage="Select any Employee.",this.ViewModel.MessageVisibility=!0)}btnExport_Click(c){if(!(this.ViewModel.DocID>0))return this.ViewModel.DisplayMessage="Load document in Edit Mode",void(this.ViewModel.MessageVisibility=!0)}dgvLoanBal_CellClick(c,D){if("dgColLoanBalCalc"==this.dgvLoanBal.Columns[c.cell].DisplayMember){let b=I.d.common.GetDataTable("CRM028","");if(null!=b&&b.length>0){let w,$=Date.Today(),X=this.dsD.Tables[11].filter(J=>J.RefNo==this.dgvLoanBal.Table[c.row].dgColLoanBalDocNo);if(X.length>0){w=new Re.AddEditDocumentViewModel(40057,"Loan Repayment",!0,"IsFrmFS_LoanBal"),w.ScreenObject.Link.LinkCombo.Enable=!1,w.ScreenObject.Link.DocumentList.Enable=!1,w.ScreenObject.Preferences.Selective="false";let J={value:$};w.ScreenObject.OnDocPrefixChanged("lostFocus",0,parseInt(X[0].DocID),J,!1),$=J.value}else{w=new Re.AddEditDocumentViewModel(40057,"Loan Repayment",!1,"IsFrmFS_LoanBal"),w.ScreenObject.Link.LinkCombo.SelectedValue=b[0].DocumentLinkDefID.toString(),w.ScreenObject.Link.LinkCombo.Enable=!1,w.ScreenObject.Link.DocumentList.Enable=!1,w.ScreenObject.Preferences.Selective="false";let J=w.ScreenObject._CCFields.find(Y=>"dcCCNID51"==Y.DBColumnName);null!=J&&(J instanceof r.y$||J instanceof q.G)&&(J.SelectedValue=this.EmpSeqNo),w.OLinkSelectionChanged(null)}w.IsFrmFS_LoanBal=!0;var M=w.ScreenObject.HeaderFields.find(J=>J instanceof st.MI&&"DocDate"==J.DBColumnName.toString());M&&(M.Enable=!1),(M=w.ScreenObject.HeaderFields.find(J=>J instanceof st.MI&&"VoucherNo"==J.DBColumnName.toString()))instanceof qe.e3&&(M.Enable=!1,M.LoadVisibility=!1,M.PreviousVisibility=!1,M.NextVisibility=!1);var P=w.ScreenObject.Link.DocumentList.Items.find(J=>J.Value==this.dgvLoanBal.Table[c.row].dgColLoanBalDocNo_Tag.toString());P&&(P.IsChecked=!0,w.OnLinkDocumentCheckedChanged(P)),(M=w.ScreenObject._CCFields.find(J=>"dcCCNID51"==J.DBColumnName))&&(M.Enable=!1),(M=w.ScreenObject._TextFields.find(J=>"dcAlpha6"==J.DBColumnName))instanceof Ae.Dw&&(M.Text="FFS_LoanBalances");for(let J=0;J<w.ScreenObject.GridData.length;J++)v.J0.IsEmpty(w.ScreenObject.GridData[J].ProductID_Key)||(w.ScreenObject.GridData[J].dcAlpha5=this.dtpDocDate.Date.ToString(I.d.SessionManager.Preferences["Date Format"]),w.ScreenObject.GridData[J].dcAlpha5_Key=this.dtpDocDate.Date.toString());I.d.page.ShowDialog(w,yt.AddEditDocumentComponent),w.DialogResult&&(this.txtLoanBalAmount.Text=(parseFloat(this.txtLoanBalAmount.Text)+w.dFS_LoanAmt).ToString(I.d.SessionManager.sPayrollDecimals),this.dgvLoanBal.Table[c.row].dgColLoanBalCalc_Tag="Paid",this.dgvLoanBal.Table[c.row].dgColLoanBalSNo_Tag=w.RetValue,this.dgvLoanBal.updateRow(this.dgvLoanBal.Table[c.row])),this.CalculateTotalAmount()}}}NumberValidationTextBox(c,D){}GetResource(c,D){let M=c;return null!=this.ViewModel.dsRes1&&this.ViewModel.dsRes1.Tables.length>0&&this.ViewModel.dsRes1.Tables[0].length>0&&(this.drwRes=this.ViewModel.dsRes1.Tables[0].filter(P=>P.CCID==D&&P.Code=="'"+c+"'")),null!=this.drwRes&&this.drwRes.length>0?this.drwRes[0].AliasName.toString():M}cmbSettlementType_SelectionChanged(c,D){this.txtPartialGratuityAmount.IsReadOnly="Partial"!=this.cmbSettlementType.SelectedValue}AggregateLeaves(c,D,M,P,b,w,$){let H,ge,Me,X=0,J=0,R=0,Z=I.d.SessionManager.Preferences.WeeklyOffsDefBasedOn.split(","),ce=" 1=1 ",ne="";if(Me=D.Tables[2],null!=Z&&null!=Z&&Z.length>0)for(let pe=0;pe<Z.length;pe++)v.J0.IsEmpty(Z[pe])||(ne="CCNID"+(parseInt(Z[pe])-5e4),H=b.Tables[0].filter(ve=>ve.EmpSeqNo==c),null!=H&&H.length>0&&(ne.Contains("CCNID51")?(ce+=" AND ( "+ne+"="+H[0].EmpSeqNo+" OR "+ne+"= 1)",Me=Me.filter(ve=>ve[ne]==H[0].EmpSeqNo||1==ve[ne])):(ce+=" AND ( "+ne+"="+H[0][ne]+" OR "+ne+"= 1)",Me=Me.filter(ve=>ve[ne]==H[0][ne]||1==ve[ne]))));" 1=1 "!=ce&&(this.drcWOffAdjDef=Me);let Le,je,Fe,We=D.Tables[3];if(Z=I.d.SessionManager.Preferences.HolidaysBasedOn.split(","),ce=" 1=1 ",ne="",null!=Z&&null!=Z&&Z.length>0)for(let pe=0;pe<Z.length;pe++)v.J0.IsEmpty(Z[pe])||(ne="CCNID"+(parseInt(Z[pe])-5e4),H=b.Tables[0].filter(ve=>ve.EmpSeqNo==c),null!=H&&H.length>0&&(ne.Contains("CCNID51")?(ce+=" AND ( "+ne+"="+H[0].EmpSeqNo+" OR "+ne+"= 1)",We=We.filter(ve=>ve[ne]==H[0].EmpSeqNo||1==ve[ne])):(ce+=" AND ( "+ne+"="+H[0][ne]+" OR "+ne+"= 1)",We=We.filter(ve=>ve[ne]==H[0][ne]||1==ve[ne]))));if(" 1=1 "!=ce&&(ge=We),null!=ge&&ge.length>0&&(this.dtHolidayAdjDef=ge),Fe=D.Tables[0].filter(pe=>pe.EmpSeqNo==c),!v.J0.IsEmpty(Fe)&&null!=Fe&&Fe.length>0)for(let pe=0;pe<Fe.length;pe++){Le=v.J0.ParseDate(Fe[pe].FromDate),je=v.J0.ParseDate(Fe[pe].ToDate),R=parseInt(Fe[pe].ComponentID);let ve=I.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString(),Ct=null;ve.length>0&&(Ct=ve.split(",")),Le>=M?je<=P?(J=parseFloat(Fe[pe].NoOfDays),X+=J):Le<=P&&(J=this.GetNoOfDays(Le,P,R,D,w,$),X+=J):je<=P?je>=M&&(J=this.GetNoOfDays(M,je,R,D,w,$),X+=J):(J=this.GetNoOfDays(M,P,R,D,w,$),X+=J)}return X}GetNoOfDays(c,D,M,P,b,w){let $=0,X=0,J=0,Y=null,R=P.Tables[1].filter(H=>H.GradeID==w&&4==H.Type&&H.ComponentID==M);if(null!=R&&R.length>0){let H=c,ge=R[0].IncludeRExclude.toString();if($=v.J0.GetDateDifference(D,c)+1,"IncludeBoth"==ge||""==ge)return $;if("IncludeWeeklyOffs"==ge)for(;H<=D;)v.J0.IsEmpty(this.dtHolidayAdjDef)||(Y=this.dtHolidayAdjDef.filter(Z=>Z.HolidayDate==H.ToString("dd/MMM/yyyy"))),null!=Y&&Y.length>0&&J++,H=H.AddDays(1);else if("IncludeHolidays"==ge)for(;H<=D;)null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(H,P,c,D,b)&&X++:("NONE"!=b.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?H.getDay().toString()==b.drcAllEmpsData[0].WeeklyOff1.toString()&&X++:H.getDay().toString()==I.d.SessionManager.Preferences.WeeklyOff1&&X++,"NONE"!=b.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?b.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=b.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&H.getDay().toString()==b.drcAllEmpsData[0].WeeklyOff2.toString()&&X++:H.getDay().toString()==I.d.SessionManager.Preferences.WeeklyOff2&&X++),H=H.AddDays(1);else if("ExcludeBoth"==ge)for(;H<=D;){let Z=!1;v.J0.IsEmpty(this.dtHolidayAdjDef)||(Y=this.dtHolidayAdjDef.filter(ce=>ce.HolidayDate==H.ToString("dd/MMM/yyyy"))),null!=Y&&Y.length>0&&(J++,Z=!0),null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(H,P,c,D,b)&&!Z&&X++:("NONE"!=b.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?H.getDay().toString()==b.drcAllEmpsData[0].WeeklyOff1.toString()&&!Z&&X++:H.getDay().toString()==I.d.SessionManager.Preferences.WeeklyOff1&&!Z&&X++,"NONE"!=b.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?b.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=b.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&H.getDay().toString()==b.drcAllEmpsData[0].WeeklyOff2.toString()&&!Z&&X++:H.getDay().toString()==I.d.SessionManager.Preferences.WeeklyOff2&&!Z&&X++),H=H.AddDays(1)}else if("ExcludeWeeklyOffs"==ge)for(;H<=D;)null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0?this.CheckIsWeeklyOffFromDef(H,P,c,D,b)&&X++:("NONE"!=b.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()?H.getDay().toString()==b.drcAllEmpsData[0].WeeklyOff1.toString()&&X++:H.getDay().toString()==I.d.SessionManager.Preferences.WeeklyOff1&&X++,"NONE"!=b.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()?b.drcAllEmpsData[0].WeeklyOff2.toString().toUpperCase()!=b.drcAllEmpsData[0].WeeklyOff1.toString().toUpperCase()&&H.getDay().toString()==b.drcAllEmpsData[0].WeeklyOff2.toString()&&X++:H.getDay().toString()==I.d.SessionManager.Preferences.WeeklyOff2&&X++),H=H.AddDays(1);else if("ExcludeHolidays"==ge)for(;H<=D;)v.J0.IsEmpty(this.dtHolidayAdjDef)||(Y=this.dtHolidayAdjDef.filter(Z=>Z.HolidayDate==H.ToString("dd/MMM/yyyy"))),null!=Y&&Y.length>0&&J++,H=H.AddDays(1)}return $-(X+J)}CheckIsWeeklyOffFromDef(c,D,M,P,b){if(null!=this.drcWOffAdjDef&&this.drcWOffAdjDef.length>0){let Y,w=1,X=b.DateOfRelieve<P?b.DateOfRelieve:P,J=b.DateOfJoining>M?b.DateOfJoining:M;for(;J<=X;){for(Y=J.AddDays(6);J<=Y&&J<=X;){if(D.Columns[2].Contains("Week"+w.toString()+"_W1")&&!v.J0.IsEmpty(this.drcWOffAdjDef[0]["Week"+w.toString()+"_W1"].toString())&&J.getDayName().toString().toLowerCase()==this.drcWOffAdjDef[0]["Week"+w.toString()+"_W1"].toString().toLowerCase()){if(J.ToString("dd MMM yyyy")==c.ToString("dd MMM yyyy"))return!0}else if(D.Columns[2].Contains("Week"+w.toString()+"_W2")&&!v.J0.IsEmpty(this.drcWOffAdjDef[0]["Week"+w.toString()+"_W2"].toString())&&J.getDayName().toString().toLowerCase()==this.drcWOffAdjDef[0]["Week"+w.toString()+"_W2"].toString().toLowerCase()&&J.ToString("dd MMM yyyy")==c.ToString("dd MMM yyyy"))return!0;J=J.AddDays(1)}w++}}return!1}static{this.\u0275fac=function(D){return new(D||Q)}}static{this.\u0275cmp=n.VBU({type:Q,selectors:[["app-final-settlement"]],standalone:!1,decls:315,vars:103,consts:[["acoordionHeader",""],["btnCollapseheader",""],["TabHeaderField",""],["id","maincontainer",1,"maincontainer","master_container"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnpill"],[1,"btnMetroDiv","secondary-btn-group"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-print"],[1,"fa-light","fa-eye"],[1,"fa-light","fa-file-export"],[1,"fa-light","fa-paperclip"],[1,"fa-light","fa-envelope"],[1,"fa-light","fa-broom"],[1,"document-screen","main_div"],[1,"section"],["panelClass","row form-row",3,"isOpen"],["accordion-heading","",1,"collapse_tabfields"],[1,"btn","btn-link"],[1,"fa","pull-right","btn-tab-icon",2,"line-height","36px","color","white","position","relative","left","-10px","float","right","background","none","border","none"],[1,"PACTHeaderFields"],[2,"display","flex","width","100%"],["class","form-group col-xl-3  col-md-3 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],["class","form-group col-xl-6  col-md-6 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"form-group","col-xl-3","col-md-3","col-sm-12","col-xs-12","PACTControl"],[2,"margin-top","auto"],[1,"PACTTabFields","section","tab_content","tab-exrafields","custom_accordion",2,"display","flex"],[1,"master-tab-container",2,"width","100%"],[3,"selectTab","heading","removable"],[1,"documentgrid","row","form-row",2,"width","100%"],["class","form-group col-9 section documentgrid",4,"ngIf"],[1,"form-group","col-3",2,"height","250px","border","1px solid #ccc","overflow","scroll"],["class","form-group col-xl-12  col-md-12 col-sm-12 col-xs-12 PACTControl",4,"ngIf"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"primary-btn-wicon",3,"click"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12",2,"display","flex","flex-direction","row","padding","0px 30px 8px 0px !important","width","100%"],[2,"font-weight","bold"],[1,"form-row","row"],[1,"form-group","col-3"],[3,"heading","removable","selectTab",4,"ngIf"],[1,"fa-light","fa-user"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fas","fa-print"],[1,"fa-light","fa-trash-alt"],[1,"fa-light","fa-file-chart-line"],[1,"form-group","col-xl-12","col-md-12","col-sm-12","col-xs-12",2,"display","flex","/* flex-direction","row","*/padding","0px 0px 0px 0px !important","width","100%"],["FieldDirective","",2,"width","100%",3,"obj","group"],[2,"display","flex"],[1,"input_cntrl_label",2,"flex-direction","column"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-left","auto","margin-bottom","2px"],[1,"secondary-btn","prevnextbtn",3,"click"],[1,"far","fa-angle-left"],[1,"far","fa-angle-right"],[1,"form-group","col-xl-6","col-md-6","col-sm-12","col-xs-12","PACTControl"],[1,"form-group","col-9","section","documentgrid"],[2,"width","100%",3,"obj","group"]],template:function(D,M){if(1&D){const P=n.RV6();n.j41(0,"div",3),n.EFF(1,"\n  "),n.j41(2,"div",4),n.EFF(3,"\n    "),n.j41(4,"div",5),n.EFF(5,"\n      "),n.j41(6,"span",6),n.EFF(7),n.j41(8,"span",7),n.EFF(9),n.k0s(),n.EFF(10,"\n      "),n.k0s(),n.EFF(11,"\n    "),n.k0s(),n.EFF(12,"\n    "),n.j41(13,"div",8),n.EFF(14,"\n      "),n.EFF(15,"\n      "),n.DNE(16,rt,4,3,"span",9),n.EFF(17,"\n      "),n.DNE(18,it,4,3,"span",9),n.EFF(19,"\n      "),n.DNE(20,wt,4,3,"span",9),n.EFF(21,"\n      "),n.j41(22,"span",10),n.bIt("click",function(){return n.eBV(P),n.Njj(M.btnPrint_Click("Print"))}),n.nrm(23,"i",11),n.EFF(24),n.nI1(25,"translate"),n.k0s(),n.EFF(26,"\n      "),n.j41(27,"span",10),n.bIt("click",function(){return n.eBV(P),n.Njj(M.btnPrintPreview_Click("Preview"))}),n.nrm(28,"i",12),n.EFF(29),n.nI1(30,"translate"),n.k0s(),n.EFF(31,"\n      "),n.j41(32,"span",10),n.bIt("click",function(){return n.eBV(P),n.Njj(M.btnExport_Click("Export"))}),n.nrm(33,"i",13),n.EFF(34),n.nI1(35,"translate"),n.k0s(),n.EFF(36,"\n      "),n.j41(37,"span",10),n.bIt("click",function(){return n.eBV(P),n.Njj(M.obj.Button_Click("Attachments"))}),n.nrm(38,"i",14),n.EFF(39),n.nI1(40,"translate"),n.k0s(),n.EFF(41,"\n      "),n.j41(42,"span",10),n.bIt("click",function(){return n.eBV(P),n.Njj(M.obj.Button_Click("EMail"))}),n.nrm(43,"i",15),n.EFF(44),n.nI1(45,"translate"),n.k0s(),n.EFF(46,"\n      "),n.j41(47,"span",10),n.bIt("click",function(){return n.eBV(P),n.Njj(M.obj.Button_Click("Clear"))}),n.nrm(48,"i",16),n.EFF(49),n.nI1(50,"translate"),n.k0s(),n.EFF(51,"\n      "),n.DNE(52,zt,4,3,"span",9),n.EFF(53,"\n          "),n.DNE(54,Zt,4,3,"span",9),n.EFF(55,"           \n    "),n.k0s(),n.EFF(56,"\n  "),n.k0s(),n.EFF(57,"\n  "),n.j41(58,"div",17),n.EFF(59,"\n    "),n.j41(60,"accordion",18,0),n.EFF(62,"\n      "),n.j41(63,"accordion-group",19),n.EFF(64,"\n        "),n.j41(65,"div",20),n.EFF(66,"\n          "),n.j41(67,"span",21),n.EFF(68," Primary Information"),n.k0s(),n.EFF(69,"\n          "),n.nrm(70,"span",22,1),n.EFF(72,"\n        "),n.k0s(),n.EFF(73,"\n        "),n.j41(74,"div"),n.EFF(75,"\n          "),n.j41(76,"div",23),n.EFF(77,"\n            "),n.j41(78,"div",24),n.EFF(79,"\n              "),n.DNE(80,St,25,3,"div",25),n.EFF(81,"\n              "),n.DNE(82,xt,4,2,"div",25),n.EFF(83,"\n            "),n.k0s(),n.EFF(84,"\n            "),n.j41(85,"div",24),n.EFF(86,"\n              "),n.DNE(87,Mt,4,2,"div",26),n.EFF(88,"\n              "),n.DNE(89,Ye,4,2,"div",25),n.EFF(90,"\n            "),n.k0s(),n.EFF(91,"\n            "),n.j41(92,"div",24),n.EFF(93,"\n              "),n.DNE(94,Gt,4,2,"div",25),n.EFF(95,"\n              "),n.DNE(96,ft,4,2,"div",25),n.EFF(97,"\n              "),n.j41(98,"div",27),n.EFF(99,"\n                "),n.j41(100,"label",28),n.EFF(101),n.k0s(),n.EFF(102,"\n              "),n.k0s(),n.EFF(103,"\n            "),n.k0s(),n.EFF(104,"\n            "),n.j41(105,"div",24),n.EFF(106,"\n              "),n.DNE(107,Et,4,2,"div",26),n.EFF(108,"\n              "),n.DNE(109,Pt,4,2,"div",25),n.EFF(110,"\n            "),n.k0s(),n.EFF(111,"\n          "),n.k0s(),n.EFF(112,"\n        "),n.k0s(),n.EFF(113,"\n      "),n.k0s(),n.EFF(114,"\n    "),n.k0s(),n.EFF(115,"\n\n    "),n.j41(116,"div",29,2),n.EFF(118,"\n      "),n.j41(119,"tabset",30),n.EFF(120,"\n        "),n.j41(121,"tab",31),n.bIt("selectTab",function(){return n.eBV(P),n.Njj(M.onSelectTab("dgvGratuity"))}),n.EFF(122,"\n          "),n.EFF(123,"\n            "),n.j41(124,"div",32),n.EFF(125,"\n            "),n.DNE(126,ea,5,2,"div",33),n.EFF(127,"\n            \n            "),n.j41(128,"div",34),n.EFF(129,"\n              "),n.EFF(130," \n              "),n.DNE(131,ta,4,2,"div",35),n.EFF(132,"\n              "),n.DNE(133,aa,4,2,"div",35),n.EFF(134,"\n              "),n.j41(135,"div",36),n.EFF(136,"\n                "),n.eu8(137,37),n.EFF(138,"\n              "),n.k0s(),n.EFF(139,"\n              "),n.j41(140,"div",36),n.EFF(141,"\n                "),n.eu8(142,37),n.EFF(143,"\n              "),n.k0s(),n.EFF(144,"\n              "),n.j41(145,"div",36),n.EFF(146,"\n                "),n.eu8(147,37),n.EFF(148,"\n              "),n.k0s(),n.EFF(149,"\n              "),n.j41(150,"div",36),n.EFF(151,"\n                "),n.j41(152,"button",38),n.bIt("click",function(){return n.eBV(P),n.Njj(M.obj.Button_Click("Gratuity"))}),n.EFF(153),n.k0s(),n.EFF(154,"\n              "),n.k0s(),n.EFF(155,"\n              "),n.j41(156,"div",39),n.EFF(157,"\n                "),n.j41(158,"label"),n.EFF(159),n.k0s(),n.j41(160,"label",40),n.EFF(161),n.k0s(),n.EFF(162,"\n              "),n.k0s(),n.EFF(163,"\n              "),n.j41(164,"div",39),n.EFF(165,"\n                "),n.j41(166,"label"),n.EFF(167),n.k0s(),n.j41(168,"label",40),n.EFF(169),n.k0s(),n.EFF(170," "),n.j41(171,"label"),n.EFF(172),n.k0s(),n.j41(173,"label",40),n.EFF(174),n.k0s(),n.EFF(175," "),n.j41(176,"label"),n.EFF(177),n.k0s(),n.j41(178,"label",40),n.EFF(179),n.k0s(),n.EFF(180,"\n              "),n.k0s(),n.EFF(181,"\n              "),n.j41(182,"div",39),n.EFF(183,"\n                "),n.j41(184,"label"),n.EFF(185),n.k0s(),n.j41(186,"label",40),n.EFF(187),n.k0s(),n.EFF(188,"\n              "),n.k0s(),n.EFF(189,"\n              "),n.j41(190,"div",39),n.EFF(191,"\n                "),n.j41(192,"label"),n.EFF(193),n.k0s(),n.j41(194,"label",40),n.EFF(195),n.k0s(),n.EFF(196,"\n              "),n.k0s(),n.EFF(197,"\n              "),n.DNE(198,sa,4,2,"div",35),n.EFF(199,"\n              "),n.DNE(200,Ft,4,2,"div",35),n.EFF(201,"\n              "),n.DNE(202,la,4,2,"div",35),n.EFF(203,"\n            "),n.k0s(),n.EFF(204,"\n          "),n.k0s(),n.EFF(205,"\n        "),n.k0s(),n.EFF(206,"\n        "),n.j41(207,"tab",31),n.bIt("selectTab",function(){return n.eBV(P),n.Njj(M.onSelectTab("dgvLeaveEncash"))}),n.EFF(208,"\n          "),n.j41(209,"div",41),n.EFF(210,"\n            "),n.DNE(211,ia,4,2,"div",33),n.EFF(212,"\n            "),n.j41(213,"div",42),n.EFF(214,"\n              "),n.DNE(215,kt,4,2,"div",35),n.EFF(216,"\n              "),n.j41(217,"div",36),n.EFF(218,"\n                "),n.eu8(219,37),n.EFF(220,"\n              "),n.k0s(),n.EFF(221,"\n              "),n.j41(222,"div",36),n.EFF(223,"\n                "),n.eu8(224,37),n.EFF(225,"\n              "),n.k0s(),n.EFF(226,"\n              "),n.j41(227,"div",36),n.EFF(228,"\n                "),n.j41(229,"button",38),n.bIt("click",function(){return n.eBV(P),n.Njj(M.obj.Button_Click("LeaveEncash"))}),n.EFF(230),n.k0s(),n.EFF(231,"\n              "),n.k0s(),n.EFF(232,"\n              "),n.DNE(233,_t,4,2,"div",35),n.EFF(234,"\n            "),n.k0s(),n.EFF(235,"\n          "),n.k0s(),n.EFF(236,"\n        "),n.k0s(),n.EFF(237,"\n        "),n.DNE(238,bt,17,6,"tab",43),n.EFF(239,"\n        "),n.j41(240,"tab",31),n.bIt("selectTab",function(){return n.eBV(P),n.Njj(M.onSelectTab("dgvNoticePay"))}),n.EFF(241,"\n          "),n.j41(242,"div",41),n.EFF(243,"\n            "),n.DNE(244,ct,4,2,"div",33),n.EFF(245,"\n            "),n.j41(246,"div",42),n.EFF(247,"\n              "),n.j41(248,"div",36),n.EFF(249,"\n                "),n.eu8(250,37),n.EFF(251,"\n              "),n.k0s(),n.EFF(252,"\n              "),n.DNE(253,jt,4,2,"div",35),n.EFF(254,"\n            "),n.k0s(),n.EFF(255,"\n          "),n.k0s(),n.EFF(256,"\n        "),n.k0s(),n.EFF(257,"\n        "),n.j41(258,"tab",31),n.bIt("selectTab",function(){return n.eBV(P),n.Njj(M.onSelectTab("dgvOthAdd"))}),n.EFF(259,"\n          "),n.j41(260,"div",41),n.EFF(261,"\n            "),n.DNE(262,Bt,4,2,"div",33),n.EFF(263,"\n            "),n.j41(264,"div",42),n.EFF(265,"\n              "),n.j41(266,"div",36),n.EFF(267,"\n                "),n.eu8(268,37),n.EFF(269,"\n              "),n.k0s(),n.EFF(270,"\n              "),n.DNE(271,Wt,4,2,"div",35),n.EFF(272,"\n            "),n.k0s(),n.EFF(273,"\n          "),n.k0s(),n.EFF(274,"\n        "),n.k0s(),n.EFF(275,"\n        "),n.j41(276,"tab",31),n.bIt("selectTab",function(){return n.eBV(P),n.Njj(M.onSelectTab("dgvOthDed"))}),n.EFF(277,"\n          "),n.j41(278,"div",41),n.EFF(279,"\n            "),n.DNE(280,ra,4,2,"div",33),n.EFF(281,"\n            "),n.j41(282,"div",42),n.EFF(283,"\n              "),n.j41(284,"div",36),n.EFF(285,"\n                "),n.eu8(286,37),n.EFF(287,"\n              "),n.k0s(),n.EFF(288,"\n              "),n.DNE(289,da,4,2,"div",35),n.EFF(290,"\n            "),n.k0s(),n.EFF(291,"\n          "),n.k0s(),n.EFF(292,"\n        "),n.k0s(),n.EFF(293,"\n        "),n.j41(294,"tab",31),n.bIt("selectTab",function(){return n.eBV(P),n.Njj(M.onSelectTab("dgvLoanBal"))}),n.EFF(295,"\n          "),n.j41(296,"div",41),n.EFF(297,"\n            "),n.DNE(298,ha,4,2,"div",33),n.EFF(299,"\n            "),n.j41(300,"div",42),n.EFF(301,"\n              "),n.j41(302,"div",36),n.EFF(303,"\n                "),n.eu8(304,37),n.EFF(305,"\n              "),n.k0s(),n.EFF(306,"\n              "),n.DNE(307,Nt,4,2,"div",35),n.EFF(308,"\n            "),n.k0s(),n.EFF(309,"\n          "),n.k0s(),n.EFF(310,"\n        "),n.k0s(),n.EFF(311,"\n      "),n.k0s(),n.EFF(312,"\n\n    "),n.k0s(),n.EFF(313,"\n\n  "),n.k0s(),n.EFF(314,"\n"),n.k0s()}2&D&&(n.R7$(7),n.SpI("\n        ",M.obj.Title," "),n.R7$(),n.xc7("background-color",M.obj.StatusColor),n.R7$(),n.JRh(M.obj.DocStatus),n.R7$(7),n.Y8G("ngIf",M.ViewModel.ApproveVisibility),n.R7$(2),n.Y8G("ngIf",M.ViewModel.PostVisiblility),n.R7$(2),n.Y8G("ngIf",M.ViewModel.PostVisiblility),n.R7$(4),n.JRh(n.bMT(25,91,"Print")),n.R7$(5),n.JRh(n.bMT(30,93,"Preview")),n.R7$(5),n.JRh(n.bMT(35,95,"Export")),n.R7$(5),n.JRh(n.bMT(40,97,"Attachments")),n.R7$(5),n.JRh(n.bMT(45,99,"SMTP_Email")),n.R7$(5),n.JRh(n.bMT(50,101,"Clear")),n.R7$(3),n.Y8G("ngIf",M.obj.UnPostVisiblility),n.R7$(2),n.Y8G("ngIf",M.obj.ReportInfoVisibility),n.R7$(9),n.Y8G("isOpen",M.IsAccordionOpen),n.R7$(7),n.AVh("fa-chevron-down",M.IsAccordionOpen)("fa-chevron-up",!M.IsAccordionOpen),n.R7$(10),n.Y8G("ngIf",M.obj.txtDocNo.Visible),n.R7$(2),n.Y8G("ngIf",M.obj.dtpDocDate.Visible),n.R7$(5),n.Y8G("ngIf",M.obj.EmployeeList.Visible),n.R7$(2),n.Y8G("ngIf",M.obj.cmbSettlementType.Visible),n.R7$(5),n.Y8G("ngIf",M.obj.dtpDateOfJoining.Visible),n.R7$(2),n.Y8G("ngIf",M.obj.dtpDateOfRelieving.Visible),n.R7$(5),n.JRh(M.lblActRelievingDate),n.R7$(6),n.Y8G("ngIf",M.obj.txtRemarks.Visible),n.R7$(2),n.Y8G("ngIf",M.obj.txtNetAmount.Visible),n.R7$(12),n.FS9("heading",M.tpGratuity),n.Y8G("removable",!1),n.R7$(5),n.Y8G("ngIf",M.dgvGratuity.Visible),n.R7$(5),n.Y8G("ngIf",M.cmbResignType.Visible),n.R7$(2),n.Y8G("ngIf",M.cmbResignReason.Visible),n.R7$(4),n.Y8G("obj",M.chkCalcBasedOnLastSal)("group",M.form),n.R7$(5),n.Y8G("obj",M.chkCalcBasedOnActDays)("group",M.form),n.R7$(5),n.Y8G("obj",M.GratuityRemarks)("group",M.form),n.R7$(6),n.JRh(M.btnCalcGratuity),n.R7$(6),n.JRh(M.lbl1GratuityTotalDays),n.R7$(2),n.JRh(M.lblGratuityTotalDays),n.R7$(6),n.JRh(M.lbl1GratuityServiceDays),n.R7$(2),n.JRh(M.lblGratuityServiceDays),n.R7$(3),n.JRh(M.lbl1GratuityLOPDays),n.R7$(2),n.JRh(M.lblGratuityLOPDays),n.R7$(3),n.JRh(M.lbl1GratuityBalDays),n.R7$(2),n.JRh(M.lblGratuityBalDays),n.R7$(6),n.JRh(M.lbl1GratuityTotalGrDays),n.R7$(2),n.JRh(M.lblGratuityTotalGrDays),n.R7$(6),n.JRh(M.lbl1GratuityTaken),n.R7$(2),n.JRh(M.lblGratuityTaken),n.R7$(3),n.Y8G("ngIf",M.txtGratuityAmount.Visible),n.R7$(2),n.Y8G("ngIf",M.txtAvailedGratuityAmount.Visible),n.R7$(2),n.Y8G("ngIf",M.txtPartialGratuityAmount.Visible),n.R7$(5),n.FS9("heading",M.tpLeaveEncashment),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",M.dgvLeaveEncash.Visible),n.R7$(4),n.Y8G("ngIf",M.txtCumLeaveSalBalAmt.Visible),n.R7$(4),n.Y8G("obj",M.chkLECalcBasedOnLastApprSerYearWise)("group",M.form),n.R7$(5),n.Y8G("obj",M.LeaveRemarks)("group",M.form),n.R7$(6),n.JRh(M.btnCalcLE),n.R7$(3),n.Y8G("ngIf",M.txtLEAmount.Visible),n.R7$(5),n.Y8G("ngIf",M.ViewModel.UnProcessedVisible),n.R7$(2),n.FS9("heading",M.tpNoticePay),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",M.dgvNoticePay.Visible),n.R7$(6),n.Y8G("obj",M.NoticePayRemarks)("group",M.form),n.R7$(3),n.Y8G("ngIf",M.txtNPAmount.Visible),n.R7$(5),n.FS9("heading",M.tpOtherAdditions),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",M.dgvOthAdd.Visible),n.R7$(6),n.Y8G("obj",M.OAddRemarks)("group",M.form),n.R7$(3),n.Y8G("ngIf",M.txtOthAddAmount.Visible),n.R7$(5),n.FS9("heading",M.tpOtherDeductions),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",M.dgvOthDed.Visible),n.R7$(6),n.Y8G("obj",M.ODedRemarks)("group",M.form),n.R7$(3),n.Y8G("ngIf",M.txtOthDedAmount.Visible),n.R7$(5),n.FS9("heading",M.tpLoanBalances),n.Y8G("removable",!1),n.R7$(4),n.Y8G("ngIf",M.dgvLoanBal.Visible),n.R7$(6),n.Y8G("obj",M.LoanRemarks)("group",M.form),n.R7$(3),n.Y8G("ngIf",M.txtLoanBalAmount.Visible))},dependencies:[He.bT,ze._,B.Mj,B.kt,te.X,Ze.V6,Ze.fw,It.D9],encapsulation:2})}}return Q})();class Rt{constructor(){this.Days=0}}},58807:(qt,ot,G)=>{G.r(ot),G.d(ot,{RibbonExtPay:()=>Te});var de=G(74523),I=G(31425),Ae=G(34840),r=G(32040),_e=G(67721),at=G(5879),mt=G(11417),v=G(11798),s=G(96598),xe=G(43357),$e=G(67700),st=G(24649),qe=G(96336);const yt=()=>({standalone:!0});function Re(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Process"))}),s.nrm(1,"i",22),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&L&&(s.R7$(2),s.JRh(s.bMT(3,1,"Process")))}function ee(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Post"))}),s.nrm(1,"i",23),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&L&&(s.R7$(2),s.JRh(s.bMT(3,1,"Post")))}function De(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("UnPost"))}),s.nrm(1,"i",24),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&L&&(s.R7$(2),s.JRh(s.bMT(3,1,"UnPost")))}function Be(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Export"))}),s.nrm(1,"i",25),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&L&&(s.R7$(2),s.JRh(s.bMT(3,1,"Export")))}function Se(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",7),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Report"))}),s.nrm(1,"i",26),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&L&&(s.R7$(2),s.JRh(s.bMT(3,1,"Report")))}let lt=(()=>{class L{constructor(){this.form=new v.gE({})}ngOnInit(){this.obj=this.params.obj}static{this.\u0275fac=function(a){return new(a||L)}}static{this.\u0275cmp=s.VBU({type:L,selectors:[["app-consolidated-monthly-payroll"]],standalone:!1,decls:89,vars:32,consts:[[1,"maincontainer"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"page-Subtitle",3,"dblclick"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-broom"],[1,"fa-light","fa-filter"],[1,"fa-light","fa-search"],[1,"main_div",2,"display","flex","flex-direction","column","padding","10px"],[1,"row",2,"height","30px"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12",2,"padding-left","inherit"],["FieldDirective","",3,"obj"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12","divChk",2,"padding-left","inherit"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[3,"click"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12","divChk"],[1,"documentgrid",2,"flex","1","overflow","auto"],[2,"width","100%","height","100%",3,"obj"],[1,"fa-light","fa-gears"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fa-light","fa-file-times"],[1,"fa-light","fa-file-export"],[1,"fa-light","fa-file-chart-line"]],template:function(a,i){1&a&&(s.j41(0,"div",0),s.EFF(1,"\n      "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"div",2),s.EFF(5,"\n          "),s.j41(6,"span",3),s.EFF(7),s.j41(8,"span",4),s.bIt("dblclick",function(d){return i.obj.sPayrollMonth_MouseDoubleClick(d)}),s.EFF(9),s.k0s(),s.EFF(10,"\n          "),s.k0s(),s.EFF(11,"\n        "),s.k0s(),s.EFF(12,"\n\n        "),s.j41(13,"div",5),s.EFF(14,"\n          "),s.DNE(15,Re,4,3,"span",6),s.EFF(16,"\n          "),s.DNE(17,ee,4,3,"span",6),s.EFF(18,"\n          "),s.j41(19,"span",7),s.bIt("click",function(){return i.obj.Button_Click("Clear")}),s.nrm(20,"i",8),s.EFF(21),s.nI1(22,"translate"),s.k0s(),s.EFF(23,"\n          "),s.DNE(24,De,4,3,"span",6),s.EFF(25,"\n          "),s.j41(26,"span",7),s.bIt("click",function(){return i.obj.Button_Click("Filter")}),s.nrm(27,"i",9),s.EFF(28),s.nI1(29,"translate"),s.k0s(),s.EFF(30,"\n          "),s.j41(31,"span",7),s.bIt("click",function(){return i.obj.Button_Click("Load")}),s.nrm(32,"i",10),s.EFF(33),s.nI1(34,"translate"),s.k0s(),s.EFF(35,"\n          "),s.DNE(36,Be,4,3,"span",6),s.EFF(37,"\n          "),s.DNE(38,Se,4,3,"span",6),s.EFF(39,"           \n        "),s.k0s(),s.EFF(40,"\n      "),s.k0s(),s.EFF(41,"\n    "),s.j41(42,"div",11),s.EFF(43,"\n      "),s.j41(44,"div",12),s.EFF(45,"\n        "),s.j41(46,"div",13),s.EFF(47,"\n          "),s.eu8(48,14),s.EFF(49,"\n        "),s.k0s(),s.EFF(50,"\n        "),s.j41(51,"div",15),s.EFF(52,"\n          "),s.eu8(53,14),s.EFF(54,"\n        "),s.k0s(),s.EFF(55,"\n        "),s.j41(56,"div",15),s.EFF(57,"\n          "),s.eu8(58,14),s.EFF(59,"\n        "),s.k0s(),s.EFF(60,"\n      "),s.k0s(),s.EFF(61,"\n      "),s.j41(62,"div",12),s.EFF(63,"\n        "),s.j41(64,"div",16),s.EFF(65,"\n          "),s.j41(66,"input",17),s.mxI("ngModelChange",function(d){return s.DH7(i.obj.IsProcessWithArrears,d)||(i.obj.IsProcessWithArrears=d),d}),s.k0s(),s.EFF(67,"\n          "),s.j41(68,"label",18),s.bIt("click",function(){return i.obj.IsProcessWithArrears=!i.obj.IsProcessWithArrears}),s.EFF(69),s.nI1(70,"translate"),s.k0s(),s.EFF(71,"\n        "),s.k0s(),s.EFF(72,"\n        "),s.j41(73,"div",19),s.EFF(74,"\n          "),s.j41(75,"input",17),s.mxI("ngModelChange",function(d){return s.DH7(i.obj.IsProcessWithAdjustments,d)||(i.obj.IsProcessWithAdjustments=d),d}),s.k0s(),s.EFF(76,"\n          "),s.j41(77,"label",18),s.bIt("click",function(){return i.obj.IsProcessWithAdjustments=!i.obj.IsProcessWithAdjustments}),s.EFF(78),s.nI1(79,"translate"),s.k0s(),s.EFF(80,"\n        "),s.k0s(),s.EFF(81,"\n      "),s.k0s(),s.EFF(82,"\n        \n        "),s.j41(83,"div",20),s.EFF(84,"\n          "),s.nrm(85,"app-PactGridView",21),s.EFF(86,"  \n        "),s.k0s(),s.EFF(87,"\n    "),s.k0s(),s.EFF(88,"\n"),s.k0s()),2&a&&(s.R7$(7),s.SpI("\n            ",i.obj.Title,"\n            "),s.R7$(2),s.SpI("\n              ",i.obj.sPayrollMonth,"\n            "),s.R7$(6),s.Y8G("ngIf",i.obj.PostVisiblility),s.R7$(2),s.Y8G("ngIf",i.obj.PostVisiblility),s.R7$(4),s.JRh(s.bMT(22,20,"Clear")),s.R7$(3),s.Y8G("ngIf",i.obj.UnPostVisiblility),s.R7$(4),s.JRh(s.bMT(29,22,"Filter")),s.R7$(5),s.JRh(s.bMT(34,24,"Load")),s.R7$(3),s.Y8G("ngIf",i.obj.ExportVisiblility),s.R7$(2),s.Y8G("ngIf",i.obj.ReportInfoVisibility),s.R7$(10),s.Y8G("obj",i.obj.chkPostBasedOnDailyAttendance),s.R7$(5),s.Y8G("obj",i.obj.chkIncludeOTHours),s.R7$(5),s.Y8G("obj",i.obj.chkPostBasedOnAttDimWise),s.R7$(8),s.R50("ngModel",i.obj.IsProcessWithArrears),s.Y8G("ngModelOptions",s.lJ4(30,yt)),s.R7$(3),s.JRh(s.bMT(70,26,"ProcesswithArrears")),s.R7$(6),s.R50("ngModel",i.obj.IsProcessWithAdjustments),s.Y8G("ngModelOptions",s.lJ4(31,yt)),s.R7$(3),s.JRh(s.bMT(79,28,"ProcesswithAdjustments")),s.R7$(7),s.Y8G("obj",i.obj.dgvEmployees))},dependencies:[xe.bT,$e._,v.Zm,v.BC,st.X,v.vS,qe.D9],encapsulation:2})}}return L})();var h=G(43767),le=G(26336),q=G(54581),n=G(7321),He=G(98580),ze=G(85985),B=G(21774),te=G(27730),Ze=G(4716),It=G(85152),rt=G(76260),it=G(70259),wt=G(39907);class zt extends He.g{constructor(t){super(),this.DialogResult=!1,this.dtData=null,this.dtDataColumns=null,this.ExcelData=[],this.DisplayMessage="",this.Parent=t[0],this.Parent.Opacity=.3,this.dgv=new n.vv,this.dgv.Columns=new Array,this.dgv.Width="450",this.dgv.Table=[]}Button_Click(t){if("Load"==t.toString()){if(0==this.dgv.Table.length)return this.DisplayMessage="View the data before loading.",void(this.MessageVisibility=!0);try{let a;this.dtData=[],this.dtDataColumns=[];for(let i=0;i<this.dgv.Columns.length;i++)this.dtDataColumns.push(this.dgv.TableColumns[i]);for(let i=0;i<this.dgv.Table.length;i++){a={};for(let o=0;o<this.dgv.Columns.length;o++)null!=this.dgv.Table[i][o]&&null!=this.dgv.Table[i][o]&&(a[o]=this.dgv.Table[i][o].toString());this.dtData.push(a)}this.dtData=this.dgv.Table}catch{}null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!0),this.DialogResult=!0,r.d.page.HideDialog(this.PopUpGUID)}else if("View"==t.toString()){let a;this.dgv.Columns.Clear(),this.dgv.TableColumns.Clear(),this.dgv.Clear();var l=new Array;if(null!=this.ExcelTable&&this.ExcelTable.length>0){for(let o=0;o<this.ExcelTableColumns.length;o++)a=new B.O7,a.Header=this.ExcelTableColumns[o],a.DisplayMember=this.ExcelTableColumns[o],a.ID=this.ExcelTableColumns[o],a.Width=100,a.ReadOnly=!0,l.push(a),this.dgv.TableColumns.push(this.ExcelTableColumns[o]);let i;this.dgv.Columns=l;for(let o=1;o<this.ExcelTable.length;o++){i=this.dgv.NewRow();for(let d=0;d<this.ExcelTableColumns.length;d++)i[this.ExcelTableColumns[d]]=this.ExcelTable[o][d];this.dgv.Table.push(i),this.dgv.updateRow(i)}}}else"Browse"==t.toString()||"Cancel"==t.toString()&&(null!=this.Parent&&(this.Parent.Opacity=1,this.Parent.DialogResult=!1),this.DialogResult=!1,r.d.page.HideDialog(this.PopUpGUID));Logger.InfoLog("ConsMPLoadViewModel::Exiting Button_Click")}OpenFile(t){if(1!==t.target.files.length)throw new Error("Cannot use multiple files");const l=new FileReader,a=t.target.files[0];this.fileExt=a.name.split(".").pop(),this.fileName=a.name,l.onload=i=>{const m=wt.LF(l.result,{type:"binary"});if(this.ExcelData=wt.Wp.sheet_to_json(m.Sheets[m.SheetNames[0]],{header:1}),!h.J0.IsEmpty(this.ExcelData)&&this.ExcelData.length>0)try{this.ExcelTable=this.ExcelData,this.ExcelTableColumns=this.ExcelData[0],this.ActualFileName=this.fileName}catch(y){return void(this.DisplayMessage=y.Message)}},l.readAsBinaryString(a)}}let Zt=(()=>{class L{constructor(){this.form=new v.gE({})}ngOnInit(){}static{this.\u0275fac=function(a){return new(a||L)}}static{this.\u0275cmp=s.VBU({type:L,selectors:[["app-cons-mpload"]],standalone:!1,decls:52,vars:18,consts:[["fileUpload",""],[1,"master-screen",2,"padding-bottom","4px","width","400px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"row","form-row"],[1,"col-xl-10","col-md-10","col-sm-12","col-xs-12"],["type","text","readonly","",3,"ngModelChange","ngModel"],[1,"col-xl-2","col-md-2","col-sm-12","col-xs-12",2,"margin-top","15px","display","flex !important"],["type","file","accept",".xlsx,.xls,.csv","name","upload",2,"display","none",3,"change"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-search"],[1,"form-group","row","form-row","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"Pactdailogfooter"],[1,"primary-btn-wicon",3,"click"],[1,"fa-light","fa-rectangle-xmark"]],template:function(a,i){if(1&a){const o=s.RV6();s.j41(0,"div",1),s.EFF(1,"\n    "),s.j41(2,"div",2),s.EFF(3,"\n        "),s.j41(4,"div",3),s.EFF(5,"\n            "),s.j41(6,"div",4),s.EFF(7,"\n                "),s.j41(8,"label"),s.EFF(9),s.nI1(10,"translate"),s.k0s(),s.EFF(11,"\n                "),s.j41(12,"input",5),s.mxI("ngModelChange",function(m){return s.eBV(o),s.DH7(i.obj.ActualFileName,m)||(i.obj.ActualFileName=m),s.Njj(m)}),s.k0s(),s.EFF(13,"\n            "),s.k0s(),s.EFF(14,"\n            "),s.j41(15,"div",6),s.EFF(16,"\n                "),s.j41(17,"input",7,0),s.bIt("change",function(m){return s.eBV(o),s.Njj(i.obj.OpenFile(m))}),s.k0s(),s.EFF(19,"               \n                "),s.j41(20,"span",8),s.bIt("click",function(){s.eBV(o);const m=s.sdS(18);return s.Njj(m.click())}),s.nrm(21,"i",9),s.EFF(22),s.nI1(23,"translate"),s.k0s(),s.EFF(24,"\n             \n            "),s.k0s(),s.EFF(25,"\n        "),s.k0s(),s.EFF(26,"  \n            \n        "),s.j41(27,"div",10),s.EFF(28,"\n            "),s.eu8(29,11),s.EFF(30,"\n        "),s.k0s(),s.EFF(31,"\n    "),s.k0s(),s.EFF(32,"\n    "),s.j41(33,"div",12),s.EFF(34,"\n        "),s.j41(35,"div"),s.EFF(36,"\n            "),s.j41(37,"button",13),s.bIt("click",function(){return s.eBV(o),s.Njj(i.obj.Button_Click("Load"))}),s.EFF(38),s.nI1(39,"translate"),s.k0s(),s.EFF(40,"\n            "),s.j41(41,"button",8),s.bIt("click",function(){return s.eBV(o),s.Njj(i.obj.Button_Click("View"))}),s.EFF(42),s.nI1(43,"translate"),s.k0s(),s.EFF(44,"\n            "),s.j41(45,"button",8),s.bIt("click",function(){return s.eBV(o),s.Njj(i.obj.Button_Click("Cancel"))}),s.nrm(46,"i",14),s.EFF(47),s.nI1(48,"translate"),s.k0s(),s.EFF(49,"\n           \n        "),s.k0s(),s.EFF(50,"\n    "),s.k0s(),s.EFF(51,"\n"),s.k0s()}2&a&&(s.R7$(9),s.JRh(s.bMT(10,8,"Com_Attachments_FileName")),s.R7$(3),s.R50("ngModel",i.obj.ActualFileName),s.R7$(10),s.JRh(s.bMT(23,10,"Browse")),s.R7$(7),s.Y8G("obj",i.obj.dgv)("group",i.form),s.R7$(9),s.JRh(s.bMT(39,12,"Load")),s.R7$(4),s.JRh(s.bMT(43,14,"View")),s.R7$(5),s.JRh(s.bMT(48,16,"Cancel")))},dependencies:[$e._,v.me,v.BC,v.vS,qe.D9],encapsulation:2})}}return L})();var St=G(48549),xt=G(80197),Mt=G(31051),Ye=G(11592),Gt=G(2979),ft=G(23458),Et=G(58941);class Pt extends He.g{get SelectAll(){return this._SelectAll}set SelectAll(t){t!=this._SelectAll&&(this._SelectAll=t,this.SelectUnselectAll(t))}SerializeGridColumnType(){this.GridColumnType.ContainsKey("id")||this.GridColumnType.push("id","Int64");for(let t=0;t<this.dgvEmployees.TableColumns.length;t++);}get ReportInfoVisibility(){return this._ReportInfoVisibility}set ReportInfoVisibility(t){t!=this._ReportInfoVisibility&&(this._ReportInfoVisibility=t)}constructor(t){super(),this.Opacity=1,this.DialogResult=!1,this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this._SelectAll=!1,this.IsProcessWithArrears=!1,this.IsProcessWithAdjustments=!1,this.chkPostBasedOnDailyAttendance=new Ye.c,this.chkPostBasedOnAttDimWise=new Ye.c,this.chkIncludeOTHours=new Ye.c,this.PostVisiblility=!0,this.UnPostVisiblility=!0,this.ExportVisiblility=!0,this.GridColumnType=new le.bT,this.dsDailyAttendanceData=null,this.ReportsList=[],this.dsData=null,this._ReportInfoVisibility=!0,this.ButtonReport=new Et.v,this.CostCenterID=0,this.sCrAccount="0",this.sDrAccount="0",this.dtRes=null,this.drwRes=null,this.dtCust=null,this.SelectUnCheck=0,this.objCMPLData=null,this.IsProcessed=!1,this.sFilter="",this.iColId=0,this.sBGWorkType="",this.dtArrData=null,this.dtAdjData=[],this.sAdjsCalcMonths="",this.sAdjCalcMonthPaydays="",this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.DefProdID=0,this.ErrorMessage="Missing Report Parameter ' ";try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering ConsolidatedMonthlyPayrollViewModel()"),this.ClassName="ConsolidatedMonthlyPayrollViewModel",this.CostCenterID=40054,this.dtRes=r.d.common.GetDataTable("PAY073",r.d.SessionManager.LangID),this.DisplayName=r.d.GetResource(t.Replace(" ","")),this.Title=r.d.GetResource(t.Replace(" ","")),this.DisplayMessage="",this.sPayrollMonth=" / ["+r.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=r.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.PostVisiblility=r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.ExportVisiblility=r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Export"),this.chkPostBasedOnDailyAttendance.Label=r.d.GetResource("PostbasedonDailyAttendance"),this.chkIncludeOTHours.Label=r.d.GetResource("IncludeOverTimeHours"),this.chkPostBasedOnAttDimWise.Label=r.d.GetResource("PostbasedonAttendanceDimensionwise"),this.LoadGrid(),this.btnFilter_Click(),r.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==r.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==r.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0),this.ReportView()}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION ConsolidatedMonthlyPayrollViewModel()",l)}}sPayrollMonth_MouseDoubleClick(t){let l=new Ae.SetPayrollDateViewModel;r.d.page.ShowDialog(l,_e.SetPayrollDateComponent,{ShowCenter:!0,Title:r.d.GetResource("Pay_SetPayrollDate")}).subscribe(()=>{l.DialogResult&&this.btnClear_Click()})}dgvEmployees_EndEdit(t,l,a){let i=this.dgvEmployees.Table.indexOf(t);if(this.iEmpIndex=this.lstSelectedEmps.indexOf(i),!(this.iEmpIndex<0)){if(r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let o=0;o<this.oCMP.GradeMPFls.length;o++)this.oCMP.GradeMPFls[o].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(r.d.SessionManager.PayrollMonth=this.oCMP.GradeMPFls[o].GradePayrollMonth,r.d.SessionManager.PayrollMonthStart=this.oCMP.GradeMPFls[o].GradePayrollMonthStart,r.d.SessionManager.PayrollMonthEnd=this.oCMP.GradeMPFls[o].GradePayrollMonthEnd);"DaysAttended"==l?(this.oCMP.SetDaysAttended(this.iEmpIndex,"Days Attended",parseFloat(t[l])),this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.DisplayMessage=r.d.GetResource("EnterValidDaysAttended"),this.MessageVisibility=!0):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1"))<parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP.ToString("N1"))?(this.DisplayMessage="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0):this.DisplayMessage="",t.LOPDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("0.0")):"LOPDays"==l?this.oCMP.SetDaysAttended(this.iEmpIndex,"LOP",parseFloat(t[l])):l.startsWith("EarningOTHrs")?this.oCMP.ReEvaluateData(this.iEmpIndex,1,parseInt(l.Replace("EarningOTHrs","")),t[l].toString()):l.startsWith("Earning")&&!l.endsWith("_Arr")?this.oCMP.ReEvaluateData(this.iEmpIndex,0,parseInt(l.Replace("Earning","")),t[l].toString()):l.startsWith("DeductionOTHrs")?this.oCMP.ReEvaluateData(this.iEmpIndex,3,parseInt(l.Replace("DeductionOTHrs","")),t[l].toString()):l.startsWith("Deduction")&&!l.endsWith("_Arr")?this.oCMP.ReEvaluateData(this.iEmpIndex,2,parseInt(l.Replace("Deduction","")),t[l].toString()):l.startsWith("dcAlpha")?l.endsWith("_Key")?this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l.Replace("_Key",""),h.J0.ParseDate(t[l]).ToString("dd/MMM/yyyy")):this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l,t[l].toString()):l.startsWith("dcCCNID")&&(Object.keys(t).Contains(l+"_Key")?this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l,t[l+"_Key"].toString()):this.oCMP.UpdateExtraFieldData(this.iEmpIndex,l,t[l].toString())),this.dgvEmployees.updateRow(t),this.FillProcessedData(i)}}GetResource(t,l){let a=t;return this.drwRes=this.dtRes.filter(i=>i.CCID==l&&i.Code==t),null!=this.drwRes&&this.drwRes.length>0?1==r.d.SessionManager.LanguageID?this.drwRes[0].Name.toString():this.drwRes[0].AliasName.toString():a}LoadGrid(){let l,t=new ze.ControlGenerator;this.dsDocDesig=t.GetScreenInfo(this.CostCenterID),l=this.dsDocDesig.Tables[0].filter(o=>"CreditAccount"==o.SysColumnName),null!=l&&l.length>0&&!h.J0.IsEmptySpace(l[0].UserDefaultValue)&&(this.sCrAccount=l[0].UserDefaultValue.toString()),l=this.dsDocDesig.Tables[0].filter(o=>"DebitAccount"==o.SysColumnName),null!=l&&l.length>0&&!h.J0.IsEmptySpace(l[0].UserDefaultValue)&&(this.sDrAccount=l[0].UserDefaultValue.toString()),this.dgvEmployees=new n.vv,this.dgvEmployees.gridtype="CMP",this.dgvEmployees.Height=0,this.dgvEmployees.SelectAll.Visible=!0,this.dgvEmployees.OnCellEditEnding.Subscribe(this,"dgvEmployees_EndEdit"),this.dgvEmployees.CanUserDeleteRows=!0,this.dgvEmployees.UpdateFooter(),this.dgvEmployees.UpdateTotals();let a=new B.O7;if(this.dgvEmployees.Columns=new Array,this.dgvEmployees.Table=[],a=new B.O7,a.Header=this.GetResource("Select",40054),a.DisplayMember="Select",a.ID="Select",a.DataType="CheckBox",a.Width=50,a.IsFrozen=!0,a.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("Select"),this.dgvEmployees.DataTypes.Bool.push("Select"),a=new B.O7,a.Header=this.GetResource("S No",40054),a.DisplayMember="SNo",a.ID="SNo",a.DataType="TextBlock",a.Width=50,a.ReadOnly=!0,a.IsFrozen=!0,this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("SNo"),a=new B.O7,a.Header="EmpSeqNo",a.DisplayMember="EmpSeqNo",a.ID="EmpSeqNo",a.DataType="TextBlock",a.Width=50,a.ReadOnly=!0,a.IsFrozen=!0,a.IsVisible=!1,this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("EmpSeqNo"),a=new B.O7,a.Header=this.GetResource("Employee Code",40054),a.DisplayMember="EmpCode",a.ID="EmpCode",a.CrRefColName="dcCCNID51",a.DataType="TextBlock",a.Width=150,a.ReadOnly=!0,a.IsFrozen=!0,this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("EmpCode"),a=new B.O7,a.Header=this.GetResource("Employee Name",40054),a.DisplayMember="EmpName",a.ID="EmpName",a.CrRefColName="dcCCNID51",a.DataType="TextBlock",a.Width=250,a.ReadOnly=!0,a.IsFrozen=!0,this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("EmpName"),a=new B.O7,a.Header="GradeID",a.DisplayMember="GradeID",a.ID="GradeID",a.DataType="TextBlock",a.Width=250,a.ReadOnly=!0,a.IsFrozen=!0,a.IsVisible=!1,this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("GradeID"),a=new B.O7,a.Header=this.GetResource("dcAlpha3",40054),a.DisplayMember="NetSalary",a.ID="NetSalary",a.CrRefColName="dcAlpha3",a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.Width=90,a.ReadOnly=!0,a.IsFontBold=!0,a.IsFrozen=!0,a.ShowTotal=!0,a.IsCalculated=1,this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("NetSalary"),this.dgvEmployees.DataTypes.Double.push("NetSalary"),a=new B.O7,a.Header=this.GetResource("Month Days",40054),a.DisplayMember="MonthDays",a.ID="MonthDays",a.CrRefColName="dcAlpha4",a.DataType="FLOAT",a.DecimalPoints="1",a.Width=60,a.ReadOnly=!0,this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("MonthDays"),this.dgvEmployees.DataTypes.Double.push("MonthDays"),a=new B.O7,a.Header=this.GetResource("dcAlpha5",40054),a.DisplayMember="DaysAttended",a.ID="DaysAttended",a.CrRefColName="dcAlpha5",a.DataType="FLOAT",a.DecimalPoints="1",a.Width=60,a.ReadOnly=!1,this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("DaysAttended"),this.dgvEmployees.DataTypes.Double.push("DaysAttended"),a=new B.O7,a.Header=this.GetResource("dcAlpha24",40054),a.DisplayMember="PaidLeaves",a.ID="PaidLeaves",a.CrRefColName="dcAlpha24",a.DataType="FLOAT",a.DecimalPoints="1",a.Width=60,a.ReadOnly=!0,a.ForeColor="Gray",this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("PaidLeaves"),this.dgvEmployees.DataTypes.Double.push("PaidLeaves"),a=new B.O7,a.Header=this.GetResource("dcAlpha6",40054),a.DisplayMember="TotalLeaves",a.ID="TotalLeaves",a.CrRefColName="dcAlpha6",a.DataType="FLOAT",a.DecimalPoints="1",a.Width=60,a.ReadOnly=!0,a.ForeColor="Gray",this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("TotalLeaves"),this.dgvEmployees.DataTypes.Double.push("TotalLeaves"),a=new B.O7,a.Header=this.GetResource("dcAlpha7",40054),a.DisplayMember="WeeklyOffs",a.ID="WeeklyOffs",a.CrRefColName="dcAlpha7",a.DataType="FLOAT",a.DecimalPoints="1",a.Width=60,a.ReadOnly=!0,a.ForeColor="Gray",this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("WeeklyOffs"),this.dgvEmployees.DataTypes.Double.push("WeeklyOffs"),a=new B.O7,a.Header=this.GetResource("dcAlpha8",40054),a.DisplayMember="Holidays",a.ID="Holidays",a.CrRefColName="dcAlpha8",a.DataType="FLOAT",a.DecimalPoints="1",a.Width=60,a.ReadOnly=!0,a.ForeColor="Gray",this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("Holidays"),this.dgvEmployees.DataTypes.Double.push("Holidays"),a=new B.O7,a.Header=this.GetResource("dcAlpha9",40054),a.DisplayMember="LOPDays",a.ID="LOPDays",a.CrRefColName="dcAlpha9",a.DataType="FLOAT",a.DecimalPoints="1",a.Width=60,a.ReadOnly=!1,this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("LOPDays"),this.dgvEmployees.DataTypes.Double.push("LOPDays"),a=new B.O7,a.Header=this.GetResource("dcAlpha10",40054),a.DisplayMember="UnpaidDays",a.ID="UnpaidDays",a.CrRefColName="dcAlpha10",a.DataType="FLOAT",a.DecimalPoints="1",a.Width=60,a.ReadOnly=!0,a.ForeColor="Gray",this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("UnpaidDays"),this.dgvEmployees.DataTypes.Double.push("UnpaidDays"),a=new B.O7,a.Header=this.GetResource("dcAlpha4",40054),a.DisplayMember="TotalDays",a.ID="TotalDays",a.CrRefColName="dcAlpha4",a.DataType="FLOAT",a.DecimalPoints="1",a.Width=60,a.ReadOnly=!0,a.ForeColor="Gray",this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("TotalDays"),this.dgvEmployees.DataTypes.Double.push("TotalDays"),this.dsStructure=r.d.common.GetDataSet("PAY058",r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")),null!=this.dsStructure&&this.dsStructure.Tables.length>0){if(l=this.dsStructure.Tables[0].filter(o=>1==o.Type&&"Yes"==o.Applicable),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let o=0;o<l.length;o++)!h.J0.IsEmpty(l[o].Behaviour)&&("Accruals"==l[o].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==l[o].Behaviour.toString())||(a=new B.O7,a.Header=this.GetResource(l[o].ComponentCode.toString(),50052),a.CrRefColID=parseInt(l[o].ComponentID),a.DisplayMember="Earning"+l[o].SNo.toString(),a.ID="Earning"+l[o].SNo.toString(),a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.HeaderBackColor="LightBlue",a.Width=80,"OverTime"==l[o].FieldType.toString()?(a.DisplayMember="EarningOTHrs"+l[o].SNo.toString(),a.ID="EarningOTHrs"+l[o].SNo.toString(),a.DecimalPoints="2",a.Width=60,a.ReadOnly=!1):"Monthly"==l[o].FieldType.toString()?a.ReadOnly=!1:a.ForeColor="Gray","-1"!=l[o].Visible.toString()&&(a.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(a.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(a.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(a.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(a.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push(a.DisplayMember),this.dgvEmployees.DataTypes.Double.push(a.DisplayMember),"OverTime"==l[o].FieldType.toString()&&(a=new B.O7,a.Header=this.GetResource(l[o].ComponentCode.toString(),50052)+"_Amount",a.CrRefColID=parseInt(l[o].ComponentID),a.DisplayMember="EarningOTAmt"+l[o].SNo.toString(),a.ID="EarningOTAmt"+l[o].SNo.toString(),a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.Width=80,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.ForeColor="Gray",a.HeaderBackColor="LightBlue","-1"!=l[o].Visible.toString()&&(a.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(a.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(a.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(a.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(a.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push(a.DisplayMember),this.dgvEmployees.DataTypes.Double.push(a.DisplayMember)));if(a=new B.O7,a.Header=this.GetResource("dcAlpha11",40054),a.DisplayMember="TotalEarnings",a.ID="TotalEarnings",a.CrRefColName="dcAlpha11",a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.HeaderBackColor="LightBlue",a.Width=90,this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push(a.DisplayMember),this.dgvEmployees.DataTypes.Double.push(a.DisplayMember),null!=l&&l.length>0)for(let o=0;o<l.length;o++)!h.J0.IsEmpty(l[o].Behaviour)&&("Accruals"==l[o].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==l[o].Behaviour.toString())&&(a=new B.O7,a.Header=this.GetResource(l[o].ComponentCode.toString(),50052),a.CrRefColID=parseInt(l[o].ComponentID),a.DisplayMember="Earning"+l[o].SNo.toString(),a.ID="Earning"+l[o].SNo.toString(),a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.HeaderBackColor="GreenYellow",a.Width=80,"Monthly"==l[o].FieldType.toString()?a.ReadOnly=!1:a.ForeColor="Gray","-1"!=l[o].Visible.toString()&&(a.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(a.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(a.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(a.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(a.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push(a.DisplayMember));if(l=this.dsStructure.Tables[0].filter(o=>2==o.Type&&"Yes"==o.Applicable),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let o=0;o<l.length;o++)a=new B.O7,a.Header=this.GetResource(l[o].ComponentCode.toString(),50052),a.CrRefColID=parseInt(l[o].ComponentID),a.DisplayMember="Deduction"+l[o].SNo.toString(),a.ID="Deduction"+l[o].SNo.toString(),a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.HeaderBackColor="LightCoral",a.Width=80,"OverTime"==l[o].FieldType.toString()?(a.DisplayMember="DeductionOTHrs"+l[o].SNo.toString(),a.ID="DeductionOTHrs"+l[o].SNo.toString(),a.DecimalPoints="2",a.Width=60,a.ReadOnly=!1):"Monthly"==l[o].FieldType.toString()?a.ReadOnly=!1:a.ForeColor="Gray","-1"!=l[o].Visible.toString()&&(a.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(a.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(a.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(a.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(a.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push(a.DisplayMember),this.dgvEmployees.DataTypes.Double.push(a.DisplayMember),"OverTime"==l[o].FieldType.toString()&&(a=new B.O7,a.Header=this.GetResource(l[o].ComponentCode.toString(),50052)+"_Amount",a.CrRefColID=parseInt(l[o].ComponentID),a.DisplayMember="DeductionOTAmt"+l[o].SNo.toString(),a.ID="DeductionOTAmt"+l[o].SNo.toString(),a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.Width=80,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.ForeColor="Gray",a.HeaderBackColor="LightCoral","-1"!=l[o].Visible.toString()&&(a.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(a.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(a.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(a.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(a.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push(a.DisplayMember),this.dgvEmployees.DataTypes.Double.push(a.DisplayMember));if(l=this.dsStructure.Tables[0].filter(o=>3==o.Type),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let o=0;o<l.length;o++)a=new B.O7,a.Header=this.GetResource(l[o].ComponentCode.toString(),50052),a.CrRefColID=parseInt(l[o].ComponentID),a.DisplayMember="Loan"+l[o].SNo.toString(),a.ID="Loan"+l[o].SNo.toString(),a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.ForeColor="Gray",a.HeaderBackColor="LightGoldenrodYellow",a.Width=80,"-1"!=l[o].Visible.toString()&&(a.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(a.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(a.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(a.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(a.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push(a.DisplayMember),this.dgvEmployees.DataTypes.Double.push(a.DisplayMember);if(a=new B.O7,a.Header=this.GetResource("dcAlpha12",40054),a.DisplayMember="TotalDeductions",a.ID="TotalDeductions",a.CrRefColName="dcAlpha12",a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.HeaderBackColor="LightCoral",a.Width=90,this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push(a.DisplayMember),this.dgvEmployees.DataTypes.Double.push(a.DisplayMember),l=this.dsStructure.Tables[0].filter(o=>4==o.Type),l.SortBy(["SNo"]),null!=l&&l.length>0)for(let o=0;o<l.length;o++)a=new B.O7,a.Header=this.GetResource(l[o].ComponentCode.toString(),50052),a.CrRefColID=parseInt(l[o].ComponentID),a.DisplayMember="Leave"+l[o].SNo.toString(),a.ID="Leave"+l[o].SNo.toString(),a.DataType="FLOAT",a.DecimalPoints="1",a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.ForeColor="Gray",a.HeaderBackColor="LightGreen",a.Width=60,"-1"!=l[o].Visible.toString()&&(a.IsVisible="1"==l[o].Visible.toString()),"-1"!=l[o].Width.toString()&&(a.Width=parseInt(l[o].Width)),"-1"!=l[o].IndexValue.toString()&&(a.DisplayIndex=parseInt(l[o].IndexValue)),"-1"!=l[o].ReadOnly.toString()&&(a.ReadOnly="1"==l[o].ReadOnly.toString()),"-1"!=l[o].Mandatory.toString()&&(a.Mandatory="1"==l[o].Mandatory.toString()),this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push(a.DisplayMember),this.dgvEmployees.DataTypes.Double.push(a.DisplayMember)}let i=this.dsDocDesig.Tables[0].filter(o=>1==o.IsColumnUserDefined&&(2==o.SectionID&&"H"==o.SectionName||3==o.SectionID));if(null!=i&&i.length>0)for(let o=0;o<i.length;o++){switch(a=new B.O7,a.Header=this.GetResource(i[o].SysColumnName.toString(),40054),a.DisplayMember=i[o].SysColumnName.toString(),a.ID=i[o].SysColumnName.toString(),a.CrRefColName=i[o].SysColumnName.toString(),a.DataType=i[o].ColumnDataType.toString(),a.IsColumnUserDefined=(0,q.yG0)(i[o].IsColumnUserDefined),a.Mandatory=(0,q.yG0)(i[o].IsMandatory),a.DataType.toUpperCase()){case"LISTBOX":a.ValueMember=a.ID+"_Key",this.dgvEmployees.TableColumns.push(a.ID),this.dgvEmployees.TableColumns.push(a.ID+"_Key"),this.dgvEmployees.DataTypes.Int.push(a.ID+"_Key"),a.CostCenterID=parseInt(i[o].ColumnCostCenterID.toString()),a.TypeID=parseInt(i[o].ColumnCCListViewTypeID.toString()),h.J0.IsEmpty(i[o].FetchMaxRows)?h.J0.IsEmpty(i[o].UserProbableValues)||(a.FilterColumn=i[o].UserProbableValues.toString()):a.GridViewID=parseInt(i[o].FetchMaxRows.toString());break;case"TEXT":case"STRING":case"COMBOBOX":if(this.dgvEmployees.TableColumns.push(a.ID),a.IsColumnUserDefined)if("Date"==i[o].UserColumnType.toString()&&(a.DataType="DATE",this.dgvEmployees.TableColumns.push(a.ID+"_Key"),this.dgvEmployees.DataTypes.Date.push(a.ID+"_Key")),"DateTime"==i[o].UserColumnType.toString())a.DataType="DATETIME",this.dgvEmployees.TableColumns.push(a.ID+"_Key");else if("Time"==i[o].UserColumnType.toString())a.DataType="TIME",this.dgvEmployees.TableColumns.push(a.ID+"_Key");else if("Numeric"==i[o].UserColumnType.toString())a.DataType="FLOAT";else if("SELECTIONBOX"==i[o].UserColumnType.toString()||"editablecombobox"==i[o].UserColumnType.toString().toLowerCase())a.DataType="SELECTIONBOX",a.CostCenterID=this.CostCenterID;else if("combobox"==i[o].UserColumnType.toString().toLowerCase()){if(a.ValueBinding=a.ID,!h.J0.IsEmpty(i[o].linkData)&&22803==parseInt(i[o].linkData.toString())||"@YEAR"==a.DefaultValue){a.DataType="PactComboBox";let d=[];for(let m=1980;m<2100;m++){let C={};C.Year=m.toString(),d.push(C)}a.DisplayMember="Year",a.ValueMember="Year",a.ComboData=d,"@YEAR"==a.DefaultValue&&(a.DefaultValue="")}else{a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value";let d=[],m=i[o].UserProbableValues.toString().Trim();if(m.length>0){let C=m.split(";");for(let g=0;g<C.length;g++)d.push(te._p.ComboBoxItems_2(C[g],C[g]))}a.ComboData=d}this.dgvEmployees.TableColumns.push(a.ID+"_Key")}else if("LISTBOX"==i[o].UserColumnType.toString())if(44==parseInt(i[o].ColumnCostCenterID.toString())){a.ValueBinding=a.ID,a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value";let d=Pt.GetLookupData(parseInt(i[o].ColumnCCListViewTypeID));if(null!=d){let m=[];for(let C=0;C<d.length;C++)m.push(te._p.ComboBoxItems_2(d[C].Name.toString(),d[C].NodeID.toString()));a.ComboData=m}this.dgvEmployees.TableColumns.push(a.ID+"_Key")}else a.DataType="LISTBOX",a.ValueMember=a.ID+"_Key",this.dgvEmployees.TableColumns.push(a.ID+"_Key"),a.CostCenterID=parseInt(i[o].ColumnCostCenterID.toString()),a.TypeID=parseInt(i[o].ColumnCCListViewTypeID.toString());else if("Attachment"==i[o].UserColumnType.toString())a.DataType="LINK",a.ReadOnly=!0,a.FilterCondition=i[o].BasedOnXml.toString(),a.Dependantinuse=!1;else if("Image"==i[o].UserColumnType.toString())a.DataType="LINK",a.ReadOnly=!0,a.Dependantinuse=!0;else if("LOOKUP"==i[o].UserColumnType.toString()){a.ValueBinding=a.ID,a.DataType="ComboBox",a.DisplayMember="Name",a.ValueMember="Value";let d=Pt.GetLookupData(parseInt(i[o].ColumnCCListViewTypeID));if(null!=d){let m=[];for(let C=0;C<d.length;C++)m.push(te._p.ComboBoxItems_2(d[C].Name.toString(),d[C].NodeID.toString()));a.ComboData=m}this.dgvEmployees.TableColumns.push(a.ID+"_Key")}break;case"DATE":a.DataType="DATE",this.dgvEmployees.TableColumns.push(a.ID),this.dgvEmployees.TableColumns.push(a.ID+"_Key"),this.dgvEmployees.DataTypes.Date.push(a.ID+"_Key")}a.Width=100,a.HeaderBackColor="LightGray",this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.Contains(i[o].SysColumnName.toString())||this.dgvEmployees.TableColumns.push(i[o].SysColumnName.toString())}if(this.dtCust=r.d.common.GetDataTable("PAY059",r.d.SessionManager.RoleID),null!=this.dtCust&&this.dtCust.length>0){let o=new h.VB;if(o.ReadXml(this.dtCust[0].ValueXml.toString()),null!=o&&o.Tables.length>0&&o.Tables[0].length>0){let d,m=3;for(let C=0;C<this.dgvEmployees.Columns.length;C++)d=o.Tables[0].filter(g=>g.SysColumnName==this.dgvEmployees.Columns[C].CrRefColName),d.length>0?(this.dgvEmployees.Columns[C].DisplayIndex=parseInt(d[0].Index)+m,this.dgvEmployees.Columns[C].Width=parseInt(d[0].Width),this.dgvEmployees.Columns[C].ReadOnly=null!=d[0].ReadOnly&&null!=d[0].ReadOnly&&"1"==d[0].ReadOnly.toString(),this.dgvEmployees.Columns[C].Mandatory=null!=d[0].Mandatory&&null!=d[0].Mandatory&&"1"==d[0].Mandatory.toString(),this.dgvEmployees.Columns[C].IsVisible=null!=d[0].Visible&&null!=d[0].Visible&&"1"==d[0].Visible.toString()):(d=o.Tables[0].filter(g=>g.ID==this.dgvEmployees.Columns[C].CrRefColID),null!=d&&d.length>0?(this.dgvEmployees.Columns[C].DisplayIndex=parseInt(d[0].Index)+m,this.dgvEmployees.Columns[C].Width=parseInt(d[0].Width),this.dgvEmployees.Columns[C].ReadOnly=null!=d[0].ReadOnly&&null!=d[0].ReadOnly&&"1"==d[0].ReadOnly.toString(),this.dgvEmployees.Columns[C].Mandatory=null!=d[0].Mandatory&&null!=d[0].Mandatory&&"1"==d[0].Mandatory.toString(),this.dgvEmployees.Columns[C].IsVisible=null!=d[0].Visible&&null!=d[0].Visible&&"1"==d[0].Visible.toString()):(d=o.Tables[0].filter(g=>g.ID==-this.dgvEmployees.Columns[C].CrRefColID),null!=d&&d.length>0?(this.dgvEmployees.Columns[C].DisplayIndex=parseInt(d[0].Index)+m,this.dgvEmployees.Columns[C].Width=parseInt(d[0].Width),this.dgvEmployees.Columns[C].ReadOnly=null!=d[0].ReadOnly&&null!=d[0].ReadOnly&&"1"==d[0].ReadOnly.toString(),this.dgvEmployees.Columns[C].Mandatory=null!=d[0].Mandatory&&null!=d[0].Mandatory&&"1"==d[0].Mandatory.toString(),this.dgvEmployees.Columns[C].IsVisible=null!=d[0].Visible&&null!=d[0].Visible&&"1"==d[0].Visible.toString()):this.dgvEmployees.Columns[C].DisplayIndex=C))}this.dgvEmployees.Columns.SortBy([{name:"DisplayIndex",parser:parseInt}])}a=new B.O7,a.Header=this.GetResource("Result",40054),a.DisplayMember="Result",a.ID="Result",a.DataType="TextBlock",a.Width=250,a.ReadOnly=!0,this.dgvEmployees.Columns.push(a),this.dgvEmployees.TableColumns.push("Result"),this.dgvEmployees.OnPreviewKeyDown.Subscribe(this,"OnPreviewKeyDown")}OnPreviewKeyDown(t,l,a){if("F5"==l.key){var i=this.dgvEmployees.Columns.find(o=>o.DisplayMember==a);if(null!=i){if(i.ReadOnly||"sno"==a.toLowerCase()||!confirm("Do you want to override all.?"))return!0;for(let o=0;o<this.dgvEmployees.Table.length;o++)this.dgvEmployees.Table[o][a]=t[a].toString(),this.dgvEmployees.TableColumns.Contains(a+"_Key")&&(this.dgvEmployees.Table[o][a+"_Key"]=t[a+"_Key"].toString()),this.dgvEmployees.updateRow(this.dgvEmployees.Table[o]),this.dgvEmployees_EndEdit(this.dgvEmployees.Table[o],a,-1)}}else if(l.ctrlKey)if("F"==l.key)this.dgvEmployees.SearchVisible?this.dgvEmployees.SearchVisible=!1:(this.dgvEmployees.SearchVisible=!0,this.dgvEmployees.AddSearchCols()),l.Handled=!0;else if("E"==l.key){let o=this.GetRawExportHTML().toString();const d=new Blob([o],{type:"text/plain;charser=utf-8"});xt.saveAs(d,this.ScreenName+"_XlsExport_"+(new Date).getTime()+".xls"),l.Handled=!0}return!1}static GetLookupData(t){let l=r.d.common.GetDataSet("PAY060",t.toString());return null!=l&&l.Tables.length>0&&l.Columns[0].Contains("NodeID")?l.Tables[0]:null}dgColSelect_CheckedChanged(t,l){l||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(t){for(let l=0;l<this.dgvEmployees.Table.length;l++)0==this.SelectUnCheck&&(this.dgvEmployees.Table[l].Select=t);this.SelectUnCheck=0}Button_Click(t){if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering Button_Click()"),"Post"==t.toString()){if(!this.IsProcessed)return this.DisplayMessage="Data has been modified, Please Process the Payroll again, then Post...",void(this.MessageVisibility=!0);this.btnPost_Click()}else"Clear"==t.toString()?this.btnClear_Click():"UnPost"==t.toString()?this.btnUnPost_Click():"Filter"==t.toString()?this.btnFilter_Click():"Process"==t.toString()?this.btnProcess_Click():"Load"==t.toString()?this.btnLoad_Click():"Export"==t.toString()?this.btnExport_Click():"Report"==t.toString()&&(this.ReportInfoVisibility=!0,r.d.page.ShowDialog(this,Gt.L,{Title:"Reports"}));Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting Button_Click()")}btnExport_Click(){}btnLoad_Click(){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering btnLoad_Click()"),this.objCMPLData=null;let t=[];t.push(this);let l=new zt(t);r.d.page.ShowDialog(l,Zt,{Title:"Load Data"}).subscribe(()=>{if(l.DialogResult){if(!l.dtDataColumns.Contains("Employee Code"))return this.DisplayMessage="'Employee Code' Column not found.",void(this.MessageVisibility=!0);this.objCMPLData=l.dtData,this.sBGWorkType="LOAD",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting btnLoad_Click()")})}catch(t){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnLoad_Click()",t)}}LoadXLData(t){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering LoadXLData()"),this.InProgress="";let l=0;if(null!=t&&t.length>0){l=t.length,this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=l,this.ProgressMessage="Loading Excel Data, please wait ...";let a,i="",o=-1;for(let d=0;d<this.dgvEmployees.Table.length;d++)if(!h.J0.IsEmpty(this.dgvEmployees.Table[d].EmpCode)&&(i="",a=t.filter(m=>m["Employee Code"]==this.dgvEmployees.Table[d].EmpCode.toString()),a.length>0)){for(let m=1;m<Object.keys(t[0]).length;m++){let C=Object.keys(t[0])[m];for(let g=0;g<this.dgvEmployees.TableColumns.length;g++)if(this.dgvEmployees.Columns[g].Header==C&&this.dgvEmployees.TableColumns.Contains(this.dgvEmployees.Columns[g].ID)){this.dgvEmployees.Table[d][this.dgvEmployees.Columns[g].ID]=a[0][m].toString();{let y=this.dgvEmployees.Table.indexOf(this.dgvEmployees.Table[d]);this.iEmpIndex=this.lstSelectedEmps.indexOf(y);let p=0,e=-1;this.dgvEmployees.Columns[g].ID.startsWith("EarningOTHrs")?(p=1,e=parseInt(this.dgvEmployees.Columns[g].ID.Replace("EarningOTHrs","")),i=this.dgvEmployees.Columns[g].ID,o=g):this.dgvEmployees.Columns[g].ID.startsWith("Earning")?(p=0,e=parseInt(this.dgvEmployees.Columns[g].ID.Replace("Earning","")),i=this.dgvEmployees.Columns[g].ID,o=g):this.dgvEmployees.Columns[g].ID.startsWith("DeductionOTHrs")?(p=3,e=parseInt(this.dgvEmployees.Columns[g].ID.Replace("DeductionOTHrs","")),i=this.dgvEmployees.Columns[g].ID,o=g):this.dgvEmployees.Columns[g].ID.startsWith("Deduction")&&(p=2,e=parseInt(this.dgvEmployees.Columns[g].ID.Replace("Deduction","")),i=this.dgvEmployees.Columns[g].ID,o=g);let u=this.oCMP.arrLstCPFields[this.iEmpIndex][p].find(T=>T.SNo==e);null!=u&&(u.dActual=parseFloat(a[0][m].toString()).ToString(r.d.SessionManager.sPayrollDecimals)),this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],("DaysAttended"==this.dgvEmployees.Columns[g].ID||"LOPDays"==this.dgvEmployees.Columns[g].ID)&&this.dgvEmployees_EndEdit(this.dgvEmployees.Table[d],this.dgvEmployees.Columns[g].ID,g)}break}}o>=0&&this.dgvEmployees_EndEdit(this.dgvEmployees.Table[d],i,o),this.ProgressValue=d+1,this.InProgress=d+1+" of "+l}this.DisplayMessage="Data Loaded Successfully",this.MessageVisibility=!0}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting LoadXLData()")}btnProcess_Click(){this.AddArrearColumns(),this.sBGWorkType="PROCESS",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}AddArrearColumns(){if(this.IsProcessWithArrears||this.IsProcessWithAdjustments){let a=this.dsStructure.Tables[0].filter(i=>1==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType);a.sort((i,o)=>i.SNo-o.SNo),this.AddEarDedArrearColumns(a,"Earning"),a=this.dsStructure.Tables[0].filter(i=>2==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType),a.sort((i,o)=>i.SNo-o.SNo),this.AddEarDedArrearColumns(a,"Deduction")}else{let a=this.dsStructure.Tables[0].filter(i=>1==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType);if(a.sort((i,o)=>i.SNo-o.SNo),null!=a&&a.length>0)for(let i=0;i<a.length;i++)this.dgvEmployees.TableColumns.Contains("Earning"+a[i].SNo+"_Arr")&&(this.dgvEmployees.TableColumns.Remove("Earning"+a[i].SNo+"_Arr"),null!=(t=this.dgvEmployees.Columns.find(o=>o.DisplayMember=="Earning"+a[i].SNo+"_Arr"))&&this.dgvEmployees.Columns.Remove(t)),this.dgvEmployees.TableColumns.Contains("Earning"+a[i].SNo+"_Adj")&&(this.dgvEmployees.TableColumns.Remove("Earning"+a[i].SNo+"_Adj"),null!=(t=this.dgvEmployees.Columns.find(d=>d.DisplayMember=="Earning"+a[i].SNo+"_Adj"))&&this.dgvEmployees.Columns.Remove(t));if(a=this.dsStructure.Tables[0].filter(i=>2==i.Type&&"Yes"==i.Applicable&&"OverTime"!=i.FieldType),null!=a&&a.length>0)for(let i=0;i<a.length;i++){var t;this.dgvEmployees.TableColumns.Contains("Deduction"+a[i].SNo+"_Arr")&&(this.dgvEmployees.TableColumns.Remove("Deduction"+a[i].SNo+"_Arr"),null!=(t=this.dgvEmployees.Columns.find(d=>d.DisplayMember=="Deduction"+a[i].SNo+"_Arr"))&&this.dgvEmployees.Columns.Remove(t)),this.dgvEmployees.TableColumns.Contains("Deduction"+a[i].SNo+"_Adj")&&(this.dgvEmployees.TableColumns.Remove("Deduction"+a[i].SNo+"_Adj"),null!=(t=this.dgvEmployees.Columns.find(d=>d.DisplayMember=="Deduction"+a[i].SNo+"_Adj"))&&this.dgvEmployees.Columns.Remove(t))}}let l=[];for(let a=0;a<this.dgvEmployees.Columns.length;a++)l.push(this.dgvEmployees.Columns[a]);this.dgvEmployees.Columns=l}AddEarDedArrearColumns(t,l){if(null!=t&&t.length>0){let a;if(this.IsProcessWithArrears)for(let i=0;i<t.length;i++)if(this.dgvEmployees.TableColumns.Contains(l+t[i].SNo)){if(this.dgvEmployees.TableColumns.Contains(l+t[i].SNo+"_Arr"))break;if(!h.J0.IsEmpty(t[i].Behaviour)&&("Accruals"==t[i].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==t[i].Behaviour.toString()))continue;a=new B.O7,a.Header=this.GetResource(t[i].ComponentCode.toString(),50052)+"_Arr",a.DisplayMember=l+t[i].SNo.toString()+"_Arr",a.ID=l+t[i].SNo.toString()+"_Arr",a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.HeaderBackColor="Earning"==l?"LightBlue":"LightCoral",a.Width=80,"-1"!=h.J0.String(t[i].Visible)&&(a.IsVisible="1"==h.J0.String(t[i].Visible)),"-1"!=h.J0.String(t[i].Width)&&(a.Width=parseInt(t[i].Width)),"-1"!=h.J0.String(t[i].IndexValue)&&(a.DisplayIndex=parseInt(t[i].IndexValue)),"-1"!=h.J0.String(t[i].Mandatory)&&(a.Mandatory="1"==h.J0.String(t[i].Mandatory));let o=this.dgvEmployees.Columns.find(d=>d.DisplayMember==l+t[i].SNo.toString());null!=o&&(this.dgvEmployees.Columns.Insert(this.dgvEmployees.Columns.indexOf(o)+1,a),this.dgvEmployees.TableColumns.push(a.DisplayMember))}if(this.IsProcessWithAdjustments)for(let i=0;i<t.length;i++)if(this.dgvEmployees.TableColumns.Contains(l+t[i].SNo)){if(this.dgvEmployees.TableColumns.Contains(l+t[i].SNo+"_Adj"))break;if(!h.J0.IsEmpty(t[i].Behaviour)&&("Accruals"==t[i].Behaviour.toString()||"Accruals-AccumulateForPreviousYears"==t[i].Behaviour.toString()))continue;a=new B.O7,a.Header=this.GetResource(t[i].ComponentCode.toString(),50052)+"_Adj",a.DisplayMember=l+t[i].SNo.toString()+"_Adj",a.ID=l+t[i].SNo.toString()+"_Adj",a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.HeaderBackColor="Earning"==l?"LightBlue":"LightCoral",a.Width=80,"-1"!=h.J0.String(t[i].Visible)&&(a.IsVisible="1"==h.J0.String(t[i].Visible)),"-1"!=h.J0.String(t[i].Width)&&(a.Width=parseInt(t[i].Width)),"-1"!=h.J0.String(t[i].IndexValue)&&(a.DisplayIndex=parseInt(t[i].IndexValue)),"-1"!=h.J0.String(t[i].Mandatory)&&(a.Mandatory="1"==h.J0.String(t[i].Mandatory));let o=this.dgvEmployees.Columns.find(d=>d.DisplayMember==l+t[i].SNo.toString());null!=o&&(this.dgvEmployees.Columns.Insert(this.dgvEmployees.Columns.indexOf(o)+1,a),this.dgvEmployees.TableColumns.push(a.DisplayMember))}}}btnUnPost_Click(){this.sBGWorkType="UNPOST",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnClear_Click(){this.oCMP=null,this.dgvEmployees.Clear(),this.dgvEmployees.UpdateTotals(),this.sPayrollMonth=" / ["+r.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=r.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.SelectAll=!1,this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1,this.chkPostBasedOnAttDimWise.IsChecked=!1,this.FailedCount=0,this.Failed="",this.sBGWorkType="",this.lstSelectedEmps=new Array,this.IsProcessed=!1,r.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==r.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==r.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0)}btnPost_Click(){this.sBGWorkType="POST",this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnFilter_Click(){this.sFilter="",r.d.SessionManager.Preferences.ContainsKey("ConsolidatedPayrollFilter")&&parseInt(r.d.SessionManager.Preferences.ConsolidatedPayrollFilter)>0?null==this.objEmpFilter?this.objEmpFilter=new Ze.t("",0,3):(this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=3,this.objEmpFilter.InitControls()),this.objEmpFilter.CostCenters.Enable=!0):null==this.objEmpFilter?this.objEmpFilter=new Ze.t("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),r.d.page.ShowDialog(this.objEmpFilter,St.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted){if(this.objEmpFilter.CostCenterFilters.length>0){let l=1,a="",i="",o="";for(let d=0;d<this.objEmpFilter.CostCenterFilters.length;d++){let m=this.objEmpFilter.CostCenterFilters[d];if(m.CostCenterID>5e4&&(l=2,a="NodeID",i=50051==m.CostCenterID?"EmpSeqNo":"CCNID"+(m.CostCenterID-5e4)),m.SelectedNodes.length>0){if(1==m.SelectedNodes.length)o+=" AND ",o+=i+"="+m.SelectedNodes[0].Id;else if(!m.SelectedNodes.find(C=>C.Id==l&&C.IsGroup))if(o+=" AND ",It.IPrefetchFilter.IsGroupTree(m)){let C="";for(let g=0;g<m.SelectedNodes.length;g++)(null==m.SelectedNodes[g].Parent||!m.SelectedNodes[g].Parent.IsSelected)&&(C.length>0&&(C+=","),C+=m.SelectedNodes[g].Id);0==C.length&&(C+=-12912),o+=i+" IN ",o+=" (select T."+a+" GTID from "+rt.A.GetTagTableName(m.CostCenterID)+" T with(nolock),"+rt.A.GetTagTableName(m.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+a+" IN ",o+=C.toString()+")  group by T."+a+")"}else{o+=i+" IN (";for(let C=0;C<m.SelectedNodes.length;C++)C>0&&(o+=","),o+=m.SelectedNodes[C].Id;o+=")"}}else m.DeleteButtonVisibility||(o+=" AND ",o+=i+"=-12912")}this.sFilter=o.toString()}if(this.objEmpFilter.Filter>0){this.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve)  >='"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==r.d.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n                        Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n                        AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==r.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+r.d.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+r.d.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),h.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let l=r.d.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=l.Trim()&&"None"!=l&&(this.sFilter+="TreeView"==l?" ORDER BY EMP.lft ":" ORDER BY EMP."+l);let a=[];a.push(r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),a.push(this.sFilter),a.push(0),a.push(r.d.SessionManager.RoleID),a.push(r.d.SessionManager.UserID),a.push(r.d.SessionManager.LanguageID);let o,i=r.d.empService.GetData(a,"spPAY_GetEmpMasterCCDetails");if(this.btnClear_Click(),null!=i&&i.Tables.length>0&&i.Tables[0].length>0){if(o=i.Tables[0],r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let d=r.d.SessionManager.dtPayrollPreferences.Tables[0].filter(m=>"DontConsiderEmpsForPayroll"==m.Name&&m.GradeID==i.Tables[0][0].CCNID53);if(null!=d&&d.length>0&&null!=d[0].Value&&null!=d[0].Value&&""!=d[0].Value.toString()&&"True"==d[0].Value.toString()&&(d=r.d.SessionManager.dtPayrollPreferences.Tables[0].filter(m=>"DontConsiderEmpsForPayrollDays"==m.Name&&m.GradeID==i.Tables[0][0].CCNID53),null!=d&&d.length>0&&null!=d[0].Value&&null!=d[0].Value&&""!=d[0].Value.toString())){let m=0;if(m=parseInt(d[0].Value),m>0){let C=new Date(r.d.SessionManager.PayrollMonth.getFullYear(),r.d.SessionManager.PayrollMonth.getMonth(),m),g=i.Tables[0].filter(y=>new Date(y.DOJ)<=C);null!=g&&g.length>0&&(i=[],i=g)}}i.sort((m,C)=>C.CCNID53-m.CCNID53),o=i}this.AddGradeApplicableColumns(o);for(let d=0;d<o.length;d++){let m=this.dgvEmployees.NewRow();m.EmpSeqNo=o[d].EmpSeqNo,m.EmpCode=o[d].EmpCode,m.EmpName=o[d].EmpName,m.GradeID=o[d].CCNID53,m.SNo=(d+1).toString(),m.Select=!1;let C,g="";for(let y=0;y<this.dgvEmployees.TableColumns.length;y++)g=this.dgvEmployees.TableColumns[y],(g.startsWith("dcAlpha")||g.startsWith("dcCCNID"))&&(C=this.dsDocDesig.Tables[0].filter(p=>p.SysColumnName==g),null!=C&&C.length>0&&(h.J0.IsEmpty(C[0].UserColumnType)||("LISTBOX"==C[0].UserColumnType.toString().toUpperCase()?h.J0.IsEmpty(C[0].UserDefaultValue)||(m[g+"_Key"]=C[0].UserDefaultValue.toString()):"TEXT"==C[0].UserColumnType.toString().toUpperCase()||"COMBOBOX"==C[0].UserColumnType.toString().toUpperCase()?h.J0.IsEmpty(C[0].UserDefaultValue)||(m[g]=C[0].UserDefaultValue.toString()):"DATE"==C[0].UserColumnType.toString().toUpperCase()&&(h.J0.IsEmpty(C[0].UserDefaultValue)||"TODAY"==C[0].UserDefaultValue.toString().toUpperCase()&&(m[g]=(new Date).ToString(r.d.SessionManager.Preferences["Date Format"]),this.dgvEmployees.TableColumns.Contains(g+"_Key")&&(m[g+"_Key"]=new Date))))));this.dgvEmployees.addRow(m),this.dgvEmployees.RefreshGrid=!0}}}}}),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting Filter_Click()")}AddGradeApplicableColumns(t){let l,a="";if(null!=(t=t.ToTable(!0,["CCNID53"]))&&t.length>0)for(let o=0;o<t.length;o++)!h.J0.IsEmpty(a)&&a.length>0&&(a+=","),a+=t[o].CCNID53.toString();if(!h.J0.IsEmpty(a)&&a.length>0&&(l=r.d.common.GetDataSet3("PAY125",a,r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"")),null!=l&&l.Tables.length>0){let o=this.dsStructure.Tables[0].filter(C=>1==C.Type);if(o.sort((C,g)=>C.SNo-g.SNo),null!=o&&o.length>0)for(let C=0;C<o.length;C++)this.dgvEmployees.TableColumns.Contains("Earning"+o[C].SNo)?(this.dgvEmployees.TableColumns.Remove("Earning"+o[C].SNo),null!=(i=this.dgvEmployees.Columns.find(g=>g.DisplayMember=="Earning"+o[C].SNo))&&this.dgvEmployees.Columns.Remove(i)):this.dgvEmployees.TableColumns.Contains("EarningOTHrs"+o[C].SNo)&&(this.dgvEmployees.TableColumns.Remove("EarningOTHrs"+o[C].SNo),null!=(i=this.dgvEmployees.Columns.find(y=>y.DisplayMember=="EarningOTHrs"+o[C].SNo))&&this.dgvEmployees.Columns.Remove(i),this.dgvEmployees.TableColumns.Contains("EarningOTAmt"+o[C].SNo)&&(this.dgvEmployees.TableColumns.Remove("EarningOTAmt"+o[C].SNo),null!=(i=this.dgvEmployees.Columns.find(y=>y.DisplayMember=="EarningOTAmt"+o[C].SNo))&&this.dgvEmployees.Columns.Remove(i)));if(o=this.dsStructure.Tables[0].filter(C=>2==C.Type),null!=o&&o.length>0)for(let C=0;C<o.length;C++)if(this.dgvEmployees.TableColumns.Contains("Deduction"+o[C].SNo))this.dgvEmployees.TableColumns.Remove("Deduction"+o[C].SNo),null!=(i=this.dgvEmployees.Columns.find(y=>y.DisplayMember=="Deduction"+o[C].SNo))&&this.dgvEmployees.Columns.Remove(i);else if(this.dgvEmployees.TableColumns.Contains("DeductionOTHrs"+o[C].SNo)){var i;this.dgvEmployees.TableColumns.Remove("DeductionOTHrs"+o[C].SNo),null!=(i=this.dgvEmployees.Columns.find(y=>y.DisplayMember=="DeductionOTHrs"+o[C].SNo))&&this.dgvEmployees.Columns.Remove(i),this.dgvEmployees.TableColumns.Contains("DeductionOTAmt"+o[C].SNo)&&(this.dgvEmployees.TableColumns.Remove("DeductionOTAmt"+o[C].SNo),null!=(i=this.dgvEmployees.Columns.find(p=>p.DisplayMember=="DeductionOTAmt"+o[C].SNo))&&this.dgvEmployees.Columns.Remove(i))}let d=this.dgvEmployees.Columns.find(C=>"TotalDays"==C.DisplayMember);null!=d&&(this.iColId=this.dgvEmployees.Columns.indexOf(d)),o=l.Tables[0].filter(C=>1==C.Type),o.sort((C,g)=>C.SNo-g.SNo),this.AddEarDedColumns(o,"Earning"),d=this.dgvEmployees.Columns.find(C=>"TotalEarnings"==C.DisplayMember),null!=d&&(this.iColId=this.dgvEmployees.Columns.indexOf(d)),o=l.Tables[0].filter(C=>2==C.Type),o.sort((C,g)=>C.SNo-g.SNo),this.AddEarDedColumns(o,"Deduction");let m=[];for(let C=0;C<this.dgvEmployees.Columns.length;C++)m.push(this.dgvEmployees.Columns[C]);if(this.dgvEmployees.Columns=m,this.dtCust=r.d.common.GetDataTable("PAY059",r.d.SessionManager.RoleID),null!=this.dtCust&&this.dtCust.length>0){let C=new h.VB;if(C.ReadXml(this.dtCust[0].ValueXml.toString()),null!=C&&C.Tables.length>0&&C.Tables[0].length>0){let g,y=3;for(let p=0;p<this.dgvEmployees.Columns.length;p++)g=C.Tables[0].filter(e=>e.SysColumnName==this.dgvEmployees.Columns[p].CrRefColName),g.length>0?(this.dgvEmployees.Columns[p].DisplayIndex=parseInt(g[0].Index)+y,this.dgvEmployees.Columns[p].Width=parseInt(g[0].Width),this.dgvEmployees.Columns[p].ReadOnly=null!=g[0].ReadOnly&&null!=g[0].ReadOnly&&"1"==g[0].ReadOnly.toString(),this.dgvEmployees.Columns[p].Mandatory=null!=g[0].Mandatory&&null!=g[0].Mandatory&&"1"==g[0].Mandatory.toString(),this.dgvEmployees.Columns[p].IsVisible=null!=g[0].Visible&&null!=g[0].Visible&&"1"==g[0].Visible.toString()):(g=C.Tables[0].filter(e=>e.ID==this.dgvEmployees.Columns[p].CrRefColID),null!=g&&g.length>0?(this.dgvEmployees.Columns[p].DisplayIndex=parseInt(g[0].Index)+y,this.dgvEmployees.Columns[p].Width=parseInt(g[0].Width),this.dgvEmployees.Columns[p].ReadOnly=null!=g[0].ReadOnly&&null!=g[0].ReadOnly&&"1"==g[0].ReadOnly.toString(),this.dgvEmployees.Columns[p].Mandatory=null!=g[0].Mandatory&&null!=g[0].Mandatory&&"1"==g[0].Mandatory.toString(),this.dgvEmployees.Columns[p].IsVisible=null!=g[0].Visible&&null!=g[0].Visible&&"1"==g[0].Visible.toString()):(g=C.Tables[0].filter(e=>e.ID==-this.dgvEmployees.Columns[p].CrRefColID),null!=g&&g.length>0?(this.dgvEmployees.Columns[p].DisplayIndex=parseInt(g[0].Index)+y,this.dgvEmployees.Columns[p].Width=parseInt(g[0].Width),this.dgvEmployees.Columns[p].ReadOnly=null!=g[0].ReadOnly&&null!=g[0].ReadOnly&&"1"==g[0].ReadOnly.toString(),this.dgvEmployees.Columns[p].Mandatory=null!=g[0].Mandatory&&null!=g[0].Mandatory&&"1"==g[0].Mandatory.toString(),this.dgvEmployees.Columns[p].IsVisible=null!=g[0].Visible&&null!=g[0].Visible&&"1"==g[0].Visible.toString()):this.dgvEmployees.Columns[p].DisplayIndex=p))}this.dgvEmployees.Columns.SortBy([{name:"DisplayIndex",parser:parseInt}])}}}AddEarDedColumns(t,l){if(null!=t&&t.length>0){let a;for(let i=0;i<t.length;i++)h.J0.IsEmpty(t[i].Behaviour)||"Accruals"!=t[i].Behaviour.toString()&&"Accruals-AccumulateForPreviousYears"!=t[i].Behaviour.toString()?(a=new B.O7,a.Header=this.GetResource(t[i].ComponentCode.toString(),50052),a.DisplayMember=l+t[i].SNo.toString(),a.ID=l+t[i].SNo.toString(),a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.HeaderBackColor="Earning"==l?"LightBlue":"LightCoral",a.Width=80,"OverTime"==t[i].FieldType.toString()?(a.DisplayMember="EarningOTHrs"+t[i].SNo.toString(),a.ID="EarningOTHrs"+t[i].SNo.toString(),a.DecimalPoints="2",a.Width=60,a.ReadOnly=!1):"Monthly"==t[i].FieldType.toString()?a.ReadOnly=!1:a.ForeColor="Gray","-1"!=h.J0.String(t[i].Visible)&&(a.IsVisible="1"==h.J0.String(t[i].Visible)),"-1"!=h.J0.String(t[i].Width)&&(a.Width=parseInt(t[i].Width)),"-1"!=h.J0.String(t[i].IndexValue)&&(a.DisplayIndex=parseInt(t[i].IndexValue)),"-1"!=t[i].ReadOnly.toString()&&(a.ReadOnly="1"==t[i].ReadOnly.toString()),"-1"!=h.J0.String(t[i].Mandatory)&&(a.Mandatory="1"==h.J0.String(t[i].Mandatory)),this.iColId=this.iColId+1,this.dgvEmployees.Columns.Insert(this.iColId,a),this.dgvEmployees.TableColumns.push(a.DisplayMember),"OverTime"==t[i].FieldType.toString()&&(a=new B.O7,a.Header=this.GetResource(t[i].ComponentCode.toString(),50052)+"_Amount",a.CrRefColID=parseInt(t[i].ComponentID),a.DisplayMember=l+"OTAmt"+t[i].SNo.toString(),a.ID=l+"OTAmt"+t[i].SNo.toString(),a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.Width=80,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.ForeColor="Gray",a.HeaderBackColor="LightBlue","-1"!=t[i].Visible.toString()&&(a.IsVisible="1"==t[i].Visible.toString()),"-1"!=t[i].Width.toString()&&(a.Width=parseInt(t[i].Width)),"-1"!=t[i].IndexValue.toString()&&(a.DisplayIndex=parseInt(t[i].IndexValue)),"-1"!=t[i].ReadOnly.toString()&&(a.ReadOnly="1"==t[i].ReadOnly.toString()),"-1"!=t[i].Mandatory.toString()&&(a.Mandatory="1"==t[i].Mandatory.toString()),this.iColId=this.iColId+1,this.dgvEmployees.Columns.Insert(this.iColId,a),this.dgvEmployees.TableColumns.push(a.DisplayMember))):(a=new B.O7,a.Header=this.GetResource(t[i].ComponentCode.toString(),50052),a.DisplayMember=l+t[i].SNo.toString(),a.ID=l+t[i].SNo.toString(),a.DataType="FLOAT",a.DecimalPoints=r.d.SessionManager.Preferences.PayrollNoOfDecimals,a.ReadOnly=!0,a.ShowTotal=!0,a.IsCalculated=1,a.HeaderBackColor="GreenYellow",a.Width=80,"Monthly"==t[i].FieldType.toString()?a.ReadOnly=!1:a.ForeColor="Gray","-1"!=h.J0.String(t[i].Visible)&&(a.IsVisible="1"==h.J0.String(t[i].Visible)),"-1"!=h.J0.String(t[i].Width)&&(a.Width=parseInt(t[i].Width)),"-1"!=h.J0.String(t[i].IndexValue)&&(a.DisplayIndex=parseInt(t[i].IndexValue)),"-1"!=t[i].ReadOnly.toString()&&(a.ReadOnly="1"==t[i].ReadOnly.toString()),"-1"!=h.J0.String(t[i].Mandatory)&&(a.Mandatory="1"==h.J0.String(t[i].Mandatory)),this.iColId=this.iColId+1,this.dgvEmployees.Columns.Insert(this.iColId,a),this.dgvEmployees.TableColumns.push(a.DisplayMember))}}bgworker_DoWork(t,l){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering bgworker_DoWork()"),"PROCESS"==this.sBGWorkType?this.ProcessPayrollData():"POST"==this.sBGWorkType?this.PostPayrollData():"UNPOST"==this.sBGWorkType?this.UnPostPayrollData():"LOAD"==this.sBGWorkType&&this.LoadXLData(this.objCMPLData),this.dgvEmployees.UpdateTotals(),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting bgworker_DoWork()")}ProcessPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering ProcessPayrollData()"),this.InProgress="";let t=0,l=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){this.lstSelectedEmps=new Array;let d,a="",i="",o=new Array,m=!1,C=0;for(let g=0;g<this.dgvEmployees.Table.length;g++)if((0,q.yG0)(this.dgvEmployees.Table[g].Select)&&(a+=this.dgvEmployees.Table[g].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(g),l++,m=!1,C=0,r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)){for(let y=0;y<o.length;y++)if(o[y].GradeID==parseInt(this.dgvEmployees.Table[g].GradeID)){C=y,m=!0;break}m?(i=o[C].sEmpIds,i+=","+this.dgvEmployees.Table[g].EmpSeqNo.toString(),o[C].sEmpIds=i,o[C].lstGradeEmps.push(parseInt(this.dgvEmployees.Table[g].EmpSeqNo))):(d=new Mt.ii,d.GradeID=parseInt(this.dgvEmployees.Table[g].GradeID),d.sEmpIds=this.dgvEmployees.Table[g].EmpSeqNo.toString(),d.lstGradeEmps=new Array,d.lstGradeEmps.push(parseInt(this.dgvEmployees.Table[g].EmpSeqNo)),o.push(d))}if(a.length>0&&l>0){if(a=a.substr(0,a.length-1),t=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=t,this.ProgressMessage="Payroll is processing, please wait ...",this.chkPostBasedOnDailyAttendance.IsChecked&&r.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==r.d.SessionManager.Preferences.CaputureDimensionData.toString()){let g=[];g.push(a),g.push(r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),g.push(r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),g.push(this.chkIncludeOTHours.IsChecked?1:0),g.push(h.J0.IntTryParse(r.d.SessionManager.UserID)),g.push(r.d.SessionManager.LanguageID),this.dsDailyAttendanceData=r.d.empService.GetData(g,"spPAY_PostDailyAttendancetoPayroll")}if(this.oCMP=new it.O,this.oCMP.oParent=this,this.oCMP.sSelectedEmpSeqNos=a,r.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==r.d.SessionManager.Preferences.CaputureDimensionData.toString()&&(this.oCMP.IsPostFullAttendance=!0,this.chkPostBasedOnDailyAttendance.IsChecked&&(this.oCMP.IsPostBasedOnDailyAttendance=!0),this.chkPostBasedOnAttDimWise.IsChecked&&(this.oCMP.IsPostBasedOnAttDimWise=!0),this.chkIncludeOTHours.IsChecked&&(this.oCMP.IncludeOTHours=!0)),this.oCMP.PayrollMonth=r.d.SessionManager.PayrollMonth,this.oCMP.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,this.oCMP.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,this.oCMP.GradeMPFls=o,this.oCMP.ProcessPayroll(),this.oCMP.IsCompleted){for(this.ProgressValue=0,this.ProgressMax=t,this.ProgressMessage="Filling data, please wait ...",this.iEmpIndex=0;this.iEmpIndex<this.oCMP.arrLstOthMPFields.length;this.iEmpIndex++)if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0){if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.endsWith("NumFields"))return this.DisplayMessage=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.Replace("NumFields",""),void(this.MessageVisibility=!0);this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult}else{if(r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let y=0;y<o.length;y++)o[y].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(r.d.SessionManager.PayrollMonth=o[y].GradePayrollMonth,r.d.SessionManager.PayrollMonthStart=o[y].GradePayrollMonthStart,r.d.SessionManager.PayrollMonthEnd=o[y].GradePayrollMonthEnd);this.strResult="",this.CalculateAccruals(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);let g=null;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(g=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(y=>y.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==y.VoucherType)),this.IsProcessWithArrears){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=g&&g.length>0)if(h.J0.IsEmpty(g[0].dcAlpha21)||""==h.J0.String(g[0].dcAlpha21).Trim())this.CalculateArrears(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));else{null!=g[0].dcAlpha21&&null!=g[0].dcAlpha21&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=g[0].dcAlpha21.toString()),null!=g[0].dcAlpha22&&null!=g[0].dcAlpha22&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=g[0].dcAlpha22.toString());let y=r.d.common.GetDataTable("PAY099",h.J0.ParseDate(r.d.SessionManager.PayrollMonth).ToString("dd MMM yyyy"));if(null!=y&&y.length>0){let p=r.d.common.GetDataTable("PAY100",this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let e=0;e<y.length;e++){let u=h.J0.ParseDate(y[e].ArrearsCalcMonths);if(null!=p&&p.length>0){let T=p.filter(A=>A.ArrAdjMonth==u);if(null!=T&&T.length>0){for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;A++)null!=T[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&null!=T[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&""!=T[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].ArrData+=u.ToString("dd MMM yyyy")+","+parseFloat(T[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo])+",");for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;A++)null!=T[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&null!=T[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&""!=T[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].ArrData+=u.ToString("dd MMM yyyy")+","+parseFloat(T[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo])+",")}}}}}}else if(null!=g&&g.length>0){for(let y=0;y<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;y++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][y].dArrear="0";for(let y=0;y<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;y++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][y].dArrear="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears=0,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),null!=g[0].dcAlpha21&&null!=g[0].dcAlpha21&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=""),null!=g[0].dcAlpha22&&null!=g[0].dcAlpha22&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays="")}if(this.IsProcessWithAdjustments){if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=g&&g.length>0)if(h.J0.IsEmpty(g[0].dcAlpha32)||""==h.J0.String(g[0].dcAlpha32).Trim())this.AdjustmentsClick(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));else{null!=g[0].dcAlpha32&&null!=g[0].dcAlpha32&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=g[0].dcAlpha32.toString()),null!=g[0].dcAlpha33&&null!=g[0].dcAlpha33&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays=g[0].dcAlpha33.toString());let y=r.d.common.GetDataTable("PAY113",h.J0.ParseDate(r.d.SessionManager.PayrollMonth).ToString("dd MMM yyyy")+"~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);if(null!=y&&y.length>0){let p=r.d.common.GetDataTable("PAY114",this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let e=0;e<y.length;e++){let u=h.J0.ParseDate(y[e].AdjMonth);if(null!=p&&p.length>0){let T=p.filter(A=>A.ArrAdjMonth==u);if(null!=T&&T.length>0){for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;A++)null!=T[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&null!=T[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo]&&""!=T[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].AdjData+=u.ToString("dd MMM yyyy")+","+parseFloat(T[0]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][A].SNo])+",");for(let A=0;A<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;A++)null!=T[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&null!=T[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo]&&""!=T[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo].toString()&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].AdjData+=u.ToString("dd MMM yyyy")+","+parseFloat(T[0]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][A].SNo])+",")}}}}}}else if(null!=g&&g.length>0){for(let y=0;y<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;y++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][y].dAdjusted="0";for(let y=0;y<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;y++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][y].dAdjusted="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments=0,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),null!=g[0].dcAlpha32&&null!=g[0].dcAlpha32&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=""),null!=g[0].dcAlpha33&&null!=g[0].dcAlpha33&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays="")}}else this.IsProcessWithArrears&&this.CalculateArrears(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.IsProcessWithAdjustments&&this.AdjustmentsClick(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo));this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex]),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+t}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(y=>(0,q.yG0)(y.Select)).length>0&&(this.DisplayMessage="Processed Successfully")}}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to process payroll.";this.MessageVisibility=!0,this.CheckViewForUser(0),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting ProcessPayrollData()")}CalculateArrears(t){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering CalculateArrears()"),this.dtArrData=[];let l=new Array,a=r.d.empService.GetQueryData(t,"ARE001",r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),"","");if(null!=a&&a.Tables[0].length>0){let i=h.J0.ParseDate(a.Tables[0][0].DtApplyFrom.toString()),o=h.J0.ParseDate(a.Tables[0][0].DtEffectFrom.toString()),d=a.Tables[1][0].ArrCalcMonths.toString().Replace("/"," ");if(o>i&&r.d.SessionManager.PayrollMonth>=o){let m=i;for(;m<o;)d.Contains(m.ToString("dd MMM yyyy"))||l.push(m.ToString("dd MMM yyyy")),m=m.AddMonths(1)}}if(l.length>0){let o,d,i="";for(let y=0;y<l.length;y++)i.length>0&&(i+=";"),i+=l[y],o={},o.PayrollMonth=l[y],this.dtArrData.push(o);let m="'"+i.Replace(";","','")+"'",C=r.d.common.GetDataSet3("PAY079",t.toString(),m).Tables[0];if(null!=C&&C.length>0){d=C.filter(y=>11==y.VoucherType);for(let y=0;y<d.length;y++)this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays.length>0&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+=";"),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+h.J0.String(d[y].PaidDays)}this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=i;let g=i.split(";");if(g.length>0){for(let F=0;F<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;F++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][F].dArrear="0";for(let F=0;F<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;F++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][F].dArrear="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears=0;let e,u,y=r.d.common.GetDataTable("PAY098",""),p=r.d.common.GetDataSet3("PAY101",t.toString(),r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")),A=0;for(let F=0;F<g.length;F++)if(null!=g[F]&&""!=g[F]&&(d=C.filter(_=>new Date(_.PayrollMonth).ToString("dd MMM yyyy")==new Date(g[F]).ToString("dd MMM yyyy")),d.length>0)){let _=y.filter(N=>N.GradeID==d[0].dcCCNID53&&new Date(N.CPayrollDate)<=new Date(g[F])).Compute("max","CPayrollDate"),f=y.filter(N=>N.GradeID==d[0].dcCCNID53&&new Date(N.CPayrollDate)==new Date(_.ToString())),E=new it.O;if(E.oParent=this,E.sSelectedEmpSeqNos=t.toString(),E.PayrollMonth=r.d.SessionManager.PayrollMonth,E.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,E.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,E.drcArrStructure=f,E.IsArrearclick=!0,E.ArrGradeID=parseInt(d[0].dcCCNID53),E.ProcessPayroll(),E.IsCompleted){E.arrLstOthMPFields[0].TotalDays=parseFloat(d[0].TotalDays),E.arrLstOthMPFields[0].MonthDays=parseFloat(d[0].TotalDays),E.arrLstOthMPFields[0].PaidLeaves=parseFloat(d[0].dcAlpha24),E.arrLstOthMPFields[0].TotalLeaves=parseFloat(d[0].LeavesTaken),E.arrLstOthMPFields[0].WeeklyOffs=parseFloat(d[0].WOffs),E.arrLstOthMPFields[0].Holidays=parseFloat(d[0].Holidays);let N=parseFloat(d[0].TotalDays.toString())-parseFloat(d[0].LOPDays.toString())-parseFloat(d[0].LeavesTaken.toString())-parseFloat(d[0].UnpaidDays.toString());e=p.Tables[0].filter(V=>V.AdjMonth==h.J0.ParseDate(g[F])),null!=e&&e.length>0&&(N+=parseFloat(e[0].Days)),u=p.Tables[1].filter(V=>2==V.DType&&V.ArrAdjMonth==h.J0.ParseDate(g[F])),E.SetDaysAttended(0,"Days Attended",N);let ae=0,z=-1,W=0;d=C.filter(V=>new Date(V.PayrollMonth).ToString("dd MMM yyyy")==new Date(g[F]).ToString("dd MMM yyyy")&&11==V.VoucherType);for(let V=0;V<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;V++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateArrears||""==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateArrears||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateArrears)for(let he=0;he<E.arrLstCPFields[0][0].length;he++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].SNo==E.arrLstCPFields[0][0][he].SNo){W=0,A=0,z=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].SNo,h.J0.IsEmpty(d[0]["dcCalcNum"+z])||(W=parseFloat(d[0]["dcCalcNum"+z])),null!=u&&u.length>0&&(h.J0.IsEmpty(u[0]["Earning"+z])||(A=parseFloat(u[0]["Earning"+z]))),ae=parseFloat(E.arrLstCPFields[0][0][he].dEarned)-W-A,this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData+=g[F]+","+ae+",",this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].dArrear=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].dArrear)+ae).ToString(r.d.SessionManager.sPayrollDecimals),this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].isArrCalculated=!0,null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+=ae);break}d=C.filter(V=>new Date(V.PayrollMonth).ToString("dd MMM yyyy")==new Date(g[F]).ToString("dd MMM yyyy")&&12==V.VoucherType);for(let V=0;V<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;V++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateArrears||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateArrears||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateArrears)for(let he=0;he<E.arrLstCPFields[0][2].length;he++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].SNo==E.arrLstCPFields[0][2][he].SNo){W=0,A=0,z=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].SNo,null!=d[0]["dcCalcNum"+z]&&null!=d[0]["dcCalcNum"+z]&&""!=d[0]["dcCalcNum"+z].toString()&&(W=parseFloat(d[0]["dcCalcNum"+z])),null!=u&&u.length>0&&null!=u[0]["Deduction"+z]&&null!=u[0]["Deduction"+z]&&""!=u[0]["Deduction"+z].toString()&&(A=parseFloat(u[0]["Deduction"+z])),ae=parseFloat(E.arrLstCPFields[0][2][he].dEarned)-W-A,this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData+=g[F]+","+ae+",",this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].dArrear=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].dArrear)+ae).ToString(r.d.SessionManager.sPayrollDecimals),this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].isArrCalculated=!0,null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+=ae);break}}E.IsArrearclick=!1}let k="",x="";k=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays,x=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths,this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays=k,this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths=x,this.oCMP.CalculateNet(),this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex])}}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting CalculateArrears()")}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnArrears_Click()\r\n"+l.Message+"\r\n"+l.stack)}}AdjustmentsClick(t){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering AdjustmentsClick()"),this.dtAdjData=[];let m,C,l=[],a=r.d.empService.GetQueryData(t,"ADJ001","","",""),i=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining,o=r.d.SessionManager.PayrollMonth.AddMonths(-1),d=new Date(i.getFullYear(),i.getMonth(),1),g=Array();for(;o>=d;){if(C=a.filter(y=>y.PayrollMonth&&h.J0.ParseDate(y.PayrollMonth).ToString("dd/MMM/yyyy")==o.ToString("dd/MMM/yyyy")),null!=C&&C.length>0){if(r.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&"True"==r.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=r.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString()){m={},m.PayrollMonth=o.ToString("dd/MMM/yyyy");let y,p,e,u={PayrollMonth:y,PayrollMonthStart:p,PayrollMonthEnd:e};if(h.J0.SetPayrollDate_1(h.J0.ParseDate(r.d.SessionManager.PayrollMonth.AddMonths(-1)),u),y=u.PayrollMonth,p=u.PayrollMonthStart,e=u.PayrollMonthEnd,r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let k=0;k=h.J0.GetEmployeeGrade(t.toString(),y,p,e),k>0&&(u={PayrollMonth:y,PayrollMonthStart:p,PayrollMonthEnd:e},h.J0.SetPayrollDate_1(h.J0.ParseDate(r.d.SessionManager.PayrollMonth.AddMonths(-1)),u,k),y=u.PayrollMonth,p=u.PayrollMonthStart,e=u.PayrollMonthEnd)}let T=[];T.push(t),T.push(y.ToString("dd/MMM/yyyy")),T.push(p.ToString("dd/MMM/yyyy")),T.push(e.ToString("dd/MMM/yyyy")),T.push(0),T.push(r.d.SessionManager.UserID),T.push(r.d.SessionManager.RoleID),T.push(r.d.SessionManager.LanguageID);let A=r.d.empService.ExecuteQuery_SP(T,"spPAY_GetEmpAdjDetailsMultiple");if(null!=A&&A.Tables.length>0&&A.Tables[0].length>0&&A.Columns[0].Contains("EmpSeqNo")){let k=[];k.push(e.ToString("dd MMM yyyy")),k.push(""),k.push(0),k.push(r.d.SessionManager.RoleID),k.push(r.d.SessionManager.UserID),k.push(r.d.SessionManager.LanguageID);let x=r.d.empService.ExecuteQuery_SP(k,"spPAY_GetEmpMasterCCDetails"),F=new Mt.mr,_=F.AggregateLeaves(t.toString(),A,p,e,x,this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.othMPField.GradeID);_>0&&(m.Days=-_),g=F.lstPrevAdj}l.push(m)}if(null!=g&&g.length>0&&r.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")!=o.ToString("dd MMM yyyy")&&"True"==r.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=r.d.SessionManager.Preferences.ConsiderLOPBasedOn.ToString())for(let y=0;y<g.length;y++)g[y].PrevMonth.ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&(m={},m.PayrollMonth=o.ToString("dd/MMM/yyyy"),m.Days=g[y].dDays,l.push(m))}else if(r.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&"True"==r.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&i.getDate()>=parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)){m={},m.PayrollMonth=o.ToString("dd/MMM/yyyy");let y,p,e,u={PayrollMonth:y,PayrollMonthStart:p,PayrollMonthEnd:e};h.J0.SetPayrollDate_1(i,u),y=u.PayrollMonth,p=u.PayrollMonthStart,e=u.PayrollMonthEnd;let T=r.d.SessionManager.PayrollMonth,A=0;r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&(A=h.J0.GetEmployeeGrade(t.toString(),y,p,e),A>0&&(u={PayrollMonth:y,PayrollMonthStart:p,PayrollMonthEnd:e},h.J0.SetPayrollDate(i,u,A),y=u.PayrollMonth,p=u.PayrollMonthStart,e=u.PayrollMonthEnd),h.J0.SetPayrollMonth(y,r.d.SessionManager,A)),h.J0.SetPayrollMonth(y,r.d.SessionManager,A);let k=new it.O;k.oParent=this,k.sSelectedEmpSeqNos=t.ToString(),k.PayrollMonth=r.d.SessionManager.PayrollMonth,k.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,k.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,k.ProcessPayroll(),k.IsCompleted&&(m.Days=k.arrLstOthMPFields[0].DaysAttended),h.J0.SetPayrollMonth(T),l.push(m)}o=o.AddMonths(-1)}if(null!=l&&l.length>0)for(let y=0;y<l.length;y++)null!=l[y].Days&&null!=l[y].Days&&""!=l[y].Days.toString().Trim()&&(m={},m.PayrollMonth=r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),m.AdjMonth=l[y].PayrollMonth.toString(),m.Days=l[y].Days.toString(),this.dtAdjData.push(m));if(null!=this.dtAdjData&&this.dtAdjData.length>0&&(this.SaveAdjustment(),this.sAdjCalcMonthPaydays="",this.sAdjsCalcMonths="",null!=this.dtAdjData&&this.dtAdjData.length>0)){for(let y=0;y<this.dtAdjData.length;y++)this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays+this.dtAdjData[y].Days.toString()+";",this.sAdjsCalcMonths=this.sAdjsCalcMonths+this.dtAdjData[y].AdjMonth.toString()+";";this.sAdjCalcMonthPaydays.length>0&&(this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays.substring(this.sAdjCalcMonthPaydays.length-1,0)),this.sAdjsCalcMonths.length>0&&(this.sAdjsCalcMonths=this.sAdjsCalcMonths.substring(this.sAdjsCalcMonths.length-1,0)),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=this.sAdjsCalcMonths,this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting AdjustmentsClick()")}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION AdjustmentsClick()\r\n"+l.Message+"\r\n"+l.stack)}}SaveAdjustment(){let t=r.d.SessionManager.PayrollMonth;this.CalculateAdjustments(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.oCMP.CalculateNet(),this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex]),h.J0.SetPayrollMonth(t,r.d.SessionManager,this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID)}CalculateAdjustments(t){if(null!=this.dtAdjData&&this.dtAdjData.length>0){let a,i,o,l="";for(let e=0;e<this.dtAdjData.length;e++)l.length>0&&(l+=","),l+="'"+new Date(this.dtAdjData[e].AdjMonth).ToString("dd MMM yyyy")+"'";let d=r.d.empService.GetQueryData(t,"MPL010",l,"","");for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted="0";for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments=0;let p,m=r.d.empService.GetQueryData(0,"MPL014","","",""),C=r.d.empService.GetQueryData(t,"MPL005","","",""),g=r.d.empService.GetQueryData(t,"MPL011",r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"",""),y="";for(let e=0;e<this.dtAdjData.length;e++){let u=new Date(this.dtAdjData[e].AdjMonth),T=u;a=d.filter(_=>new Date(_.PayrollMonth).ToString("dd MMM yyyy")==u.ToString("dd MMM yyyy")&&11==_.VoucherType);let A=null;if(null!=a&&a.length>0){let _=m.filter(f=>f.GradeID==a[0].dcCCNID53&&f.CPayrollDate<=T.ToString("dd MMM yyyy")).Compute("max","CPayrollDate");A=m.filter(f=>f.GradeID==a[0].dcCCNID53&&f.CPayrollDate==h.J0.String(_))}if(y="'"+u.ToString("dd/MMM/yyyy")+"' >= ApplyFrom AND '"+u.ToString("dd/MMM/yyyy")+"' <=EffectFrom",p=C.filter(_=>u.ToString("dd/MMM/yyyy")>=_.ApplyFrom&&u.ToString("dd/MMM/yyyy")<=_.EffectFrom),p=p.sort((_,f)=>_.EffectFrom-f.EffectFrom),i=g.Tables[0].filter(_=>_.ArrearsCalcMonths==h.J0.ParseDate(u)),o=g.Tables[1].filter(_=>1==_.DType&&_.ArrAdjMonth==h.J0.ParseDate(u)),null!=p&&p.length>0){let _=!1;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let f=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(f.length>0)for(let E=0;E<f.length;E++)h.J0.ParseDate(f[E]).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&(_=!0)}null!=i&&i.length>0||_?(u=h.J0.ParseDate(p[0].EffectFrom),r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?h.J0.SetPayrollMonth(u,r.d.SessionManager,null!=a&&a.length>0?parseInt(a[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):h.J0.SetPayrollMonth(u)):r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?h.J0.SetPayrollMonth(u,r.d.SessionManager,null!=a&&a.length>0?parseInt(a[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):h.J0.SetPayrollMonth(u)}else r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?h.J0.SetPayrollMonth(u,r.d.SessionManager,null!=a&&a.length>0?parseInt(a[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):h.J0.SetPayrollMonth(u);let k=parseFloat(this.dtAdjData[e].Days),x=0;x="Actual Days"!=r.d.SessionManager.Preferences.PayDays?parseInt(r.d.SessionManager.Preferences.PayDays):u.DaysInMonth();let F=new it.O;if(F.oParent=this,F.sSelectedEmpSeqNos=t.toString(),F.PayrollMonth=r.d.SessionManager.PayrollMonth,F.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,F.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,F.dAdjDays=k,null!=a&&a.length>0&&(F.IsAdjustments=!0,F.drcArrStructure=A,F.ArrGradeID=h.J0.Int(a[0].dcCCNID53)),F.ProcessPayroll(),F.IsCompleted){let _=0;null!=a&&a.length>0?(F.arrLstOthMPFields[0].TotalDays=parseFloat(a[0].TotalDays),F.arrLstOthMPFields[0].MonthDays=parseFloat(a[0].TotalDays),F.arrLstOthMPFields[0].PaidLeaves=parseFloat(a[0].dcAlpha24),F.arrLstOthMPFields[0].TotalLeaves=parseFloat(a[0].LeavesTaken),F.arrLstOthMPFields[0].WeeklyOffs=parseFloat(a[0].WOffs),F.arrLstOthMPFields[0].Holidays=parseFloat(a[0].Holidays),_=parseFloat(a[0].DaysWorked.toString())+k,F.SetDaysAttended(0,"Days Attended",_)):h.J0.ParseDate(this.dtAdjData[e].AdjMonth).iMonth()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.iMonth()&&h.J0.ParseDate(this.dtAdjData[e].AdjMonth).getFullYear()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.getFullYear()&&(F.arrLstOthMPFields[0].TotalDays=x,F.arrLstOthMPFields[0].TotalLeaves=0,F.SetDaysAttended(0,"Days Attended",Math.abs(k)));let W,f=0,E=-1,N=0,ae=0,z=0;a=d.filter(V=>new Date(V.PayrollMonth).ToString("dd MMM yyyy")==u.ToString("dd MMM yyyy")&&11==V.VoucherType);for(let V=0;V<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;V++)if(h.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateAdjustments)||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateAdjustments)for(let he=0;he<F.arrLstCPFields[0][0].length;he++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].SNo==F.arrLstCPFields[0][0][he].SNo){if(N=0,ae=0,z=0,E=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].SNo,!h.J0.IsEmpty(a)&&a.length>0&&!h.J0.IsEmpty(a[0]["dcCalcNum"+E])&&(N=parseFloat(a[0]["dcCalcNum"+E])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData.length>0&&(W=[],this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData.TrimEnd(","),W=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData.split(";"),null!=W&&W.length>0))for(let ye=0;ye<W.length;ye+=2)new Date(W[ye]).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&(ae=parseFloat(W[ye+1]));null!=o&&o.length>0&&null!=o[0]["Earning"+E]&&null!=o[0]["Earning"+E]&&""!=o[0]["Earning"+E]&&(z=parseFloat(o[0]["Earning"+E])),f=r.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,q.yG0)("True"==r.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PFE"==F.arrLstCPFields[0][0][he].ComponentName?parseFloat(F.arrLstCPFields[0][0][he].dEarned)-N:parseFloat(F.arrLstCPFields[0][0][he].dEarned)-N-ae-z,this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AdjData=h.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AdjData+=T.ToString("dd MMM yyyy")+","+f+",",this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].dAdjusted)+f).ToString(r.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+=f);break}a=d.filter(V=>new Date(V.PayrollMonth).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&12==V.VoucherType);for(let V=0;V<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;V++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateAdjustments||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateAdjustments||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateAdjustments)for(let he=0;he<F.arrLstCPFields[0][2].length;he++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].SNo==F.arrLstCPFields[0][2][he].SNo){if(N=0,ae=0,z=0,E=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].SNo,null!=a&&a.length>0&&null!=a[0]["dcCalcNum"+E]&&null!=a[0]["dcCalcNum"+E]&&""!=a[0]["dcCalcNum"+E].toString()&&(N=parseFloat(a[0]["dcCalcNum"+E])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData.length>0&&(W=[],this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData.TrimEnd(","),W=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData.split(";"),null!=W&&W.length>0))for(let ye=0;ye<W.length;ye+=2)new Date(W[ye]).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&(ae=parseFloat(W[ye+1]));null!=o&&o.length>0&&null!=o[0]["Deduction"+E]&&null!=o[0]["Deduction"+E]&&""!=o[0]["Deduction"+E]&&(z=parseFloat(o[0]["Deduction"+E])),f=r.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,q.yG0)("True"==r.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PF"==F.arrLstCPFields[0][2][he].ComponentName?parseFloat(F.arrLstCPFields[0][2][he].dEarned)-N:parseFloat(F.arrLstCPFields[0][2][he].dEarned)-N-ae-z,this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AdjData=h.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AdjData+=T.ToString("dd MMM yyyy")+","+f+",",this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].dAdjusted)+f).ToString(r.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+=f);break}this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet(),this.FillProcessedData(this.lstSelectedEmps[this.iEmpIndex])}}}}CalculateAccruals(t){let l=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2];if(l=l.filter(a=>a.EmpSeqNo==t),l.length>0&&h.J0.ParseDate(l[0].cEffectFrom).getFullYear()==r.d.SessionManager.PayrollMonth.getFullYear()&&h.J0.ParseDate(l[0].cEffectFrom).iMonth()==r.d.SessionManager.PayrollMonth.iMonth()&&this.oCMP.lstAccrAccumulateSNos.length>0){let a="",i=0,o=0,d=0,m=0,C=0,g=0,y=0,p=0,e=0,u=-1;for(let k=0;k<this.oCMP.lstAccrAccumulateSNos.length;k++)a.length>0&&(a+=","),a+="ISNULL(dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[k]+",0) as dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[k]+",ISNULL(dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[k]+",0) as dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[k];let T=r.d.empService.GetQueryData(t,"CONS002",JSON.stringify(a),r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),""),A=r.d.empService.GetQueryData(0,"CONS003","","","");if(null!=T&&T.length>0){let k=!1;for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;x++)if(o=0,d=0,this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"Accruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour){u=this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].SNo,i=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dActual);for(let F=0;F<T.length;F++)C=parseFloat(T[F].TotalDays),m=parseFloat(T[F].DaysAttended)+parseFloat(T[F].PaidLeaves)+parseFloat(T[F].LOPDays),g=parseFloat(T[F]["dcCalcNum"+u]),y=parseFloat(T[F]["dcCalcNumFC"+u]),p=parseFloat((m/C*i).ToString(r.d.SessionManager.sPayrollDecimals)),e=parseFloat((p-g).ToString(r.d.SessionManager.sPayrollDecimals)),o+=parseFloat(e.ToString(r.d.SessionManager.sPayrollDecimals)),d+=y;this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(o-d).ToString(r.d.SessionManager.sPayrollDecimals)}else this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(k=!0);if(k){for(let x=0;x<T.length;x++){let F=A.filter(E=>E.GradeID==parseInt(T[x].GradeID)&&E.CPayrollDate==h.J0.ParseDate(T[x].PayrollDate)).Compute("max","CPayrollDate"),_=A.filter(E=>E.GradeID==parseInt(T[x].GradeID)&&E.CPayrollDate==F),f=new it.O;if(f.oParent=this,f.sSelectedEmpSeqNos=t.toString(),f.PayrollMonth=r.d.SessionManager.PayrollMonth,f.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,f.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,f.drcArrStructure=_,f.IsCalculateAccruals=!0,f.ArrGradeID=parseInt(T[x].GradeID),f.ProcessPayroll(),f.IsCompleted){f.arrLstOthMPFields[0].TotalDays=parseFloat(T[x].TotalDays),f.arrLstOthMPFields[0].MonthDays=parseFloat(T[x].TotalDays),f.arrLstOthMPFields[0].PaidLeaves=parseFloat(T[x].PaidLeaves),f.arrLstOthMPFields[0].TotalLeaves=parseFloat(T[x].LeavesTaken),f.arrLstOthMPFields[0].WeeklyOffs=parseFloat(T[x].WOffs),f.arrLstOthMPFields[0].Holidays=parseFloat(T[x].Holidays),m=parseFloat(T[x].TotalDays.toString())-parseFloat(T[x].LOPDays.toString())-parseFloat(T[x].LeavesTaken.toString())-parseFloat(T[x].UnpaidDays.toString()),f.SetDaysAttended(0,"Days Attended",m);let E=0,N=-1,ae=0,z=0;for(let W=0;W<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;W++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][W].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][W].Behaviour)for(let V=0;V<f.arrLstCPFields[0][0].length;V++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][W].SNo==f.arrLstCPFields[0][0][V].SNo){ae=0,z=0,N=this.oCMP.arrLstCPFields[this.iEmpIndex][0][W].SNo,null!=T[x]["dcCalcNum"+N]&&null!=T[x]["dcCalcNum"+N]&&""!=T[x]["dcCalcNum"+N].toString()&&(ae=parseFloat(T[x]["dcCalcNum"+N])),null!=T[x]["dcCalcNumFC"+N]&&null!=T[x]["dcCalcNumFC"+N]&&""!=T[x]["dcCalcNumFC"+N].toString()&&(z=parseFloat(T[x]["dcCalcNumFC"+N])),E=parseFloat(f.arrLstCPFields[0][0][V].dEarned)-ae,this.oCMP.arrLstCPFields[this.iEmpIndex][0][W].dPrevAccEar+=parseFloat(E.ToString(r.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][0][W].dPrevAccAdj+=z;break}for(let W=0;W<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;W++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][W].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][W].Behaviour)for(let V=0;V<f.arrLstCPFields[0][2].length;V++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][W].SNo==f.arrLstCPFields[0][2][V].SNo){ae=0,z=0,N=this.oCMP.arrLstCPFields[this.iEmpIndex][2][W].SNo,null!=T[x]["dcCalcNum"+N]&&null!=T[x]["dcCalcNum"+N]&&""!=T[x]["dcCalcNum"+N].toString()&&(ae=parseFloat(T[x]["dcCalcNum"+N])),null!=T[x]["dcCalcNumFC"+N]&&null!=T[x]["dcCalcNumFC"+N]&&""!=T[x]["dcCalcNumFC"+N].toString()&&(z=parseFloat(T[x]["dcCalcNumFC"+N])),E=parseFloat(f.arrLstCPFields[0][2][V].dEarned)-ae,this.oCMP.arrLstCPFields[this.iEmpIndex][2][W].dPrevAccEar+=parseFloat(E.ToString(r.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][2][W].dPrevAccAdj+=z;break}}}for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccAdj).ToString(r.d.SessionManager.sPayrollDecimals));for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccAdj).ToString(r.d.SessionManager.sPayrollDecimals))}}}}FillProcessedData(t){if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering FillProcessedData()"),null!=this.oCMP&&this.oCMP.IsCompleted&&!(this.iEmpIndex>this.oCMP.arrLstOthMPFields.length-1)){if(this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;l++)this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo)&&(this.dgvEmployees.Table[t]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].dEarned).ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Arr")&&(this.dgvEmployees.Table[t]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Arr"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].dArrear).ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Adj")&&(this.dgvEmployees.Table[t]["Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].SNo+"_Adj"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][l].dAdjusted).ToString(r.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;l++)this.dgvEmployees.TableColumns.Contains("EarningOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo)&&(this.dgvEmployees.Table[t]["EarningOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].dActual).ToString(r.d.SessionManager.sPayrollDecimals2)),this.dgvEmployees.TableColumns.Contains("EarningOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo)&&(this.dgvEmployees.Table[t]["EarningOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][1][l].dEarned).ToString(r.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;l++)this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo)&&(this.dgvEmployees.Table[t]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].dEarned).ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Arr")&&(this.dgvEmployees.Table[t]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Arr"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].dArrear).ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Adj")&&(this.dgvEmployees.Table[t]["Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].SNo+"_Adj"]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][l].dAdjusted).ToString(r.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][3].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][3].length;l++)this.dgvEmployees.TableColumns.Contains("DeductionOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo)&&(this.dgvEmployees.Table[t]["DeductionOTHrs"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].dActual).ToString(r.d.SessionManager.sPayrollDecimals2)),this.dgvEmployees.TableColumns.Contains("DeductionOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo)&&(this.dgvEmployees.Table[t]["DeductionOTAmt"+this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][3][l].dEarned).ToString(r.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;l++)this.dgvEmployees.TableColumns.Contains("Loan"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].SNo)&&null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].LoanInstAmt&&(this.dgvEmployees.Table[t]["Loan"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].SNo]=h.J0.Double(this.oCMP.arrLstCPFields[this.iEmpIndex][4][l].LoanInstAmt).ToString(r.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;l++)this.dgvEmployees.TableColumns.Contains("Leave"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][l].SNo)&&(this.dgvEmployees.Table[t]["Leave"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][l].SNo]=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][5][l].LeaveTaken).ToString(r.d.SessionManager.sPayrollDecimals));if(this.oCMP.arrLstCPFields[this.iEmpIndex][6].length>0)for(let l=0;l<this.oCMP.arrLstCPFields[this.iEmpIndex][6].length;l++)if(this.dgvEmployees.TableColumns.Contains(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName))if("LISTBOX"==this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldDataType){if("EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue){let a=r.d.SessionManager.dtFeatures.filter(i=>i.FeatureID==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName.Replace("dcCCNID",""))+5e4);if(null!=a&&a.length>0){let i=r.d.empService.GetQueryData(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue,"CONS001",a[0].TableName.toString(),"","");null!=i&&i.length>0&&(this.dgvEmployees.Table[t][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName]=i[0].Name.toString(),this.dgvEmployees.Table[t][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName+"_Key"]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)}}}else"DATE"==this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldUserColumnType?"EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue&&(h.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)||(this.dgvEmployees.Table[t][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue,h.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)||(this.dgvEmployees.Table[t][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName+"_Key"]=h.J0.ParseDate(this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue)))):"EMPTY"!=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue&&(this.dgvEmployees.Table[t][this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldName]=this.oCMP.arrLstCPFields[this.iEmpIndex][6][l].ExtraFieldValue);this.dgvEmployees.TableColumns.Contains("MonthDays")&&(this.dgvEmployees.Table[t].MonthDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("DaysAttended")&&(this.dgvEmployees.Table[t].DaysAttended=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended.ToString("N1")),this.dgvEmployees.TableColumns.Contains("TotalLeaves")&&(this.dgvEmployees.Table[t].TotalLeaves=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves.ToString("N1")),this.dgvEmployees.TableColumns.Contains("PaidLeaves")&&(this.dgvEmployees.Table[t].PaidLeaves=this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves.ToString("N1")),this.dgvEmployees.TableColumns.Contains("WeeklyOffs")&&(this.dgvEmployees.Table[t].WeeklyOffs=this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs.ToString("N1")),this.dgvEmployees.TableColumns.Contains("Holidays")&&(this.dgvEmployees.Table[t].Holidays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("LOPDays")&&(this.dgvEmployees.Table[t].LOPDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("UnpaidDays")&&(this.dgvEmployees.Table[t].UnpaidDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("TotalDays")&&(this.dgvEmployees.Table[t].TotalDays=this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays.ToString("N1")),this.dgvEmployees.TableColumns.Contains("Basic")&&(this.dgvEmployees.Table[t].Basic=this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly.ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("TotalEarnings")&&(this.dgvEmployees.Table[t].TotalEarnings=this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings.ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("TotalDeductions")&&(this.dgvEmployees.Table[t].TotalDeductions=(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans).ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.TableColumns.Contains("NetSalary")&&(this.dgvEmployees.Table[t].NetSalary=this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary.ToString(r.d.SessionManager.sPayrollDecimals)),this.dgvEmployees.updateRow(this.dgvEmployees.Table[t]),this.dgvEmployees.UpdateTotals(),Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting FillProcessedData()")}}CheckViewForUser(t){if(null!=this.dsDocDesig&&this.dsDocDesig.Tables.length>6&&this.dsDocDesig.Tables[6].length>0)for(let l=0;l<this.dgvEmployees.Columns.length;l++)this.SetView(this.dgvEmployees.Columns[l])}SetView(t){let l=this.dsDocDesig.Tables[6],a=this.dsDocDesig.Tables[0];l=l.filter(i=>1==i.Mode||2==i.Mode||3==i.Mode||4==i.Mode),t instanceof B.O7&&(l=t.CrRefColID>0?l.filter(i=>i.CostCenterColID==1e6+t.CrRefColID):null!=t.CrRefColName&&""!=t.CrRefColName&&t.CrRefColName.startsWith("dcAlpha")?l.filter(i=>i.SysColumnName==t.CrRefColName):[]),l.length>0?(t instanceof B.O7&&(t.IsVisible=(0,q.yG0)(l[0].IsVisible.toString())),h.J0.IsEmpty(l[0].IsMandatory)||t instanceof B.O7&&(t.Mandatory=(0,q.yG0)(l[0].IsMandatory)),t instanceof B.O7&&(t.ReadOnly=!(0,q.yG0)(l[0].IsEditable)),t instanceof B.O7&&(t.Expression=h.J0.String(l[0].Expression)),t instanceof B.O7&&(t.Message=h.J0.String(l[0].FailureMessage)),h.J0.IsEmpty(l[0].ActionOptionID)?t instanceof B.O7&&(t.Action=0):t instanceof B.O7&&(t.Action=parseInt(l[0].ActionOptionID)),h.J0.IsEmpty(l[0].NumFieldEditOptionID)?t instanceof B.O7&&(t.EditOption=0):t instanceof B.O7&&(t.EditOption=parseInt(l[0].NumFieldEditOptionID.toString()))):(t instanceof B.O7&&(a="combobox"==t.DataType.toLowerCase()?a.filter(i=>i.SysColumnName==t.ValueBinding):a.filter(3==t.CostCenterID||2==t.CostCenterID?i=>i.CostcenterColid==t.ID:i=>i.SysColumnName==t.DisplayMember)),a.length>0&&(t instanceof B.O7&&(r.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==r.d.SessionManager.Preferences.EnableDivisionWise.toString()&&50001==t.CostCenterID||r.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==r.d.SessionManager.Preferences.EnableLocationWise.toString()&&50002==t.CostCenterID||(t.ReadOnly=!(0,q.yG0)(a[0].IsEditable.toString()))),h.J0.IsEmpty(a[0].IsMandatory)||t instanceof B.O7&&(t.Mandatory=(0,q.yG0)(a[0].IsMandatory)),t instanceof B.O7&&(t.IsVisible=(0,q.yG0)(a[0].IsVisible.toString()))),t instanceof B.O7&&(t.EditOption=0),t instanceof B.O7&&(t.Expression=""),t instanceof B.O7&&(t.Message=""),t instanceof B.O7&&(t.Action=0))}UnPostPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering UnPostPayrollData()"),this.InProgress="";let t=0,l=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){this.lstSelectedEmps=new Array;let a="";for(let i=0;i<this.dgvEmployees.Table.length;i++)(0,q.yG0)(this.dgvEmployees.Table[i].Select)&&(a+=this.dgvEmployees.Table[i].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(i),l++);if(a.length>0&&l>0){a=a.substr(0,a.length-1);let o,i=a.split(",");t=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=t,this.ProgressMessage="Unposting Payroll, please wait ...";let d=r.d.common.GetDataSet3("PAY061",a,r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")).Tables[0];for(let m=0;m<i.length;m++){if(this.strResult="",null!=i[m]&&""!=i[m]){if(o=d.filter(C=>C.EmpSeqNo==i[m]),null!=o&&o.length>0){let C=0,g=[];g.push(this.CostCenterID),g.push(parseInt(o[0].DocID)),g.push(1);let y=r.d.document.DeleteSelectedRows(g,C);this.strResult=y.Message,C=y.RetValue}else this.strResult="No Data exits to delete.",this.Failed+=this.dgvEmployees.Table[this.lstSelectedEmps[m]].EmpCode.toString()+",",this.FailedCount++;this.dgvEmployees.Table[this.lstSelectedEmps[m]].Result=this.strResult,this.dgvEmployees.updateRow(this.dgvEmployees.Table[this.lstSelectedEmps[m]])}this.ProgressValue=m+1,this.InProgress=m+1+" of "+t}this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(C=>(0,q.yG0)(C.Select)).length>0&&(this.DisplayMessage="Unposted Successfully"),this.MessageVisibility=!0}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to unpost payroll.";this.MessageVisibility=!0,Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting UnPostPayrollData()")}bgworker_RunWorkerCompleted(t,l){this.ProgressVisibility=!1,this.dgvEmployees.UpdateTotals(),this.dgvEmployees.RefreshGrid=!0,"PROCESS"==this.sBGWorkType?this.IsProcessed=!0:"POST"==this.sBGWorkType&&(this.IsProcessed=!1)}PostPayrollData(){Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering PostPayrollData()"),this.InProgress="";let t=0,l=0;if(null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0){for(let a=0;a<this.dgvEmployees.Table.length;a++)(0,q.yG0)(this.dgvEmployees.Table[a].Select)&&l++;if(l>0){t=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=t,this.ProgressMessage="Posting data, please wait...";for(let a=0;a<this.dgvEmployees.Table.length;a++)if((0,q.yG0)(this.dgvEmployees.Table[a].Select)){let i=this.oCMP.arrLstOthMPFields.find(o=>o.EmpSeqNo==this.dgvEmployees.Table[a].EmpSeqNo.toString());if(this.iEmpIndex=this.oCMP.arrLstOthMPFields.indexOf(i),this.iEmpIndex>=0){if(r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let o=0;o<this.oCMP.GradeMPFls.length;o++)this.oCMP.GradeMPFls[o].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(r.d.SessionManager.PayrollMonth=this.oCMP.GradeMPFls[o].GradePayrollMonth,r.d.SessionManager.PayrollMonthStart=this.oCMP.GradeMPFls[o].GradePayrollMonthStart,r.d.SessionManager.PayrollMonthEnd=this.oCMP.GradeMPFls[o].GradePayrollMonthEnd);if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&""!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()&&parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID)>0){let o=r.d.common.GetDataTable("PAY087",this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].INVDocDetailsID.toString()+",54,'"+r.d.SessionManager.UserName+"',40054,"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowLevel.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].CreatedDate.toString()+","+r.d.SessionManager.UserID+","+r.d.SessionManager.RoleID);null!=o&&o.length>0&&(!h.J0.IsEmpty(o[0].CanApprove)&&"TRUE"==o[0].CanApprove.toString().toUpperCase()||(369!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")?441==parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)&&!r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Approved Document"):this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Posted Document"))}this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0?(this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.dgvEmployees.Table[a].Result=this.strResult):(this.strResult="",this.SaveVoucher(),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+t)}this.IsProcessed=!1}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.dgvEmployees&&null!=this.dgvEmployees.Table&&this.dgvEmployees.Table.length>0&&this.dgvEmployees.Table.filter(i=>(0,q.yG0)(i.Select)).length>0&&(this.DisplayMessage="Posted Successfully",r.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==r.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==r.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll?(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0):(this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1))}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to post payroll.";this.MessageVisibility=!0,Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting PostPayrollData()")}ValidatePosting(){try{if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering IsValidated()"),null!=r.d.SessionManager.Preferences.PayrollProduct&&""!=r.d.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(r.d.SessionManager.Preferences.PayrollProduct)),0==this.DefProdID)return this.strResult+="Select any Default Payroll Product at Global Preferences",this.MessageVisibility=!0,!1;for(let t=0;t<this.dgvEmployees.Columns.length;t++)if(this.dgvEmployees.Columns[t].ID.startsWith("dcAlpha")&&!this.dgvEmployees.Columns[t].ID.endsWith("_Key")&&this.dgvEmployees.Columns[t].Mandatory&&"SELECTIONBOX"!=this.dgvEmployees.Columns[t].DataType&&""==h.J0.String(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.Columns[t].ID]))return this.strResult+="Enter "+this.dgvEmployees.Columns[t].Header.toString(),this.MessageVisibility=!0,!1;return this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.strResult+="Days mismatch : Month days and Total days.",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1"))<parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP.ToString("N1"))?(this.strResult+="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&("False"==r.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero||0==parseInt(r.d.SessionManager.Preferences.CreateLoanType))?(this.strResult+="Net Amount should be greater than or equal to zero.",this.MessageVisibility=!0,!1):(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting IsValidated()"),!0)}catch(t){return Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION IsValidated()",t),!1}}SaveVoucher(){try{if(Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering btnPost_Click()"),this.ValidatePosting()){let t=0,l=[];l.push(this.CostCenterID),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocID),l.push(r.d.SessionManager.PayrollMonth.ToString("MMM'/'yyyy")+"-"),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocNo),l.push(Date.Today().ToString("dd/MMM/yyyy")),l.push(r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),l.push(""),l.push(this.GetDocumentXML()),l.push(""),l.push(""),l.push(""),l.push(this.GetActivityXML()),l.push("false"),r.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==r.d.SessionManager.Preferences.EnableLocationWise.toString()?l.push(r.d.SessionManager.LocationID>0?r.d.SessionManager.LocationID:1):l.push(0),r.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==r.d.SessionManager.Preferences.EnableDivisionWise.toString()?l.push(r.d.SessionManager.DivisionID>0?r.d.SessionManager.DivisionID:1):l.push(0),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].WID),l.push(r.d.SessionManager.RoleID),l.push(""),l.push(0),l.push(0),l.push(r.d.SessionManager.CompanyGUID),l.push(r.d.SessionManager.UserName),l.push(r.d.SessionManager.UserID),l.push(r.d.SessionManager.LanguageID),l.push(r.d.SessionManager.IsOffline);let a="",i="",o=r.d.document.SetTempInvDocumentPostPayroll(l);t=o.obj;let d=o;a=null!=d&&d.Tables.length>0&&d.Tables[d.Tables.length-1].length>0&&d.Columns[d.Tables.length-1].Contains("ErrorMessage")?d.Tables[d.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",t=o.obj,t>0?null!=d&&d.Tables.length>0&&d.Tables[d.Tables.length-1].length>0&&d.Columns[d.Tables.length-1].Contains("VoucherNo")&&(i=d.Tables[d.Tables.length-1][0].VoucherNo.toString()):null!=d&&d.Tables.length>0&&d.Tables[d.Tables.length-1].length>0&&d.Columns[d.Tables.length-1].Contains("ServerMessage")&&(this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,t="-407"==d.Tables[d.Tables.length-1][0].ServerMessage.toString()?-407:-12345),this.strResult+=a,this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.dgvEmployees.updateRow(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++;Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting btnPost_Click()")}catch(t){this.strResult+=t.message,Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION btnPost_Click()"+t.stack)}this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult}GetDocumentXML(){let t,l="",a="",i="",o="",d="",m="",C=new Array,g=" dcAlpha1='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly+"',dcAlpha3='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary+"',dcAlpha4='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays+"',dcAlpha5='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended+"',dcAlpha6='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves+"',dcAlpha7='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs+"',dcAlpha8='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays+"',dcAlpha9='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays+"',dcAlpha10='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays+"',\n                    dcAlpha11='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount)+"',dcAlpha12='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans)+"',dcAlpha13='0'";r.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==r.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?(g+=",dcAlpha14='"+this.objEmpFilter.PaymentModes.SelectedValue.toString()+"'",g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":",dcAlpha15='',dcAlpha16=''"):(g+=",dcAlpha14='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()+"'","Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":g+=",dcAlpha15='',dcAlpha16=''"),g+=",dcAlpha17='"+r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+"',dcAlpha18='"+r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+"',\n                                dcAlpha19='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTHours+"',dcAlpha20='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount+"',\n                                dcAlpha21='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths+"',dcAlpha22='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays+"' ",g+=",dcAlpha23='' ",g+=",dcAlpha24='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves+"' ",g+=",dcAlpha25='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActEarnings+"' ",g+=",dcAlpha26='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+"' ",g+=",dcAlpha27='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+"' ",g+=",dcAlpha28='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActDeductions+"' ",g+=",dcAlpha29='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+"' ",g+=",dcAlpha30='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+"' ",g+=",dcAlpha31='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans+"' ",g+=",dcAlpha32='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths+"',dcAlpha33='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays+"' ",r.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==r.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":",dcAlpha34=''":"Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":g+=",dcAlpha34=''",g+=",dcAlpha35='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].ActDaysAttended.toString()+"'",i+='<Alpha Query="',i+=g;for(let e=0;e<this.dgvEmployees.TableColumns.length;e++)this.dgvEmployees.TableColumns[e].startsWith("dcAlpha")&&!this.dgvEmployees.TableColumns[e].endsWith("_Key")&&(d+=" "+this.dgvEmployees.TableColumns[e]+"='"+h.J0.EncodeXML(h.J0.StringValue(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.TableColumns[e]]))+"',");d+=" ",d.length>0&&(i+=","+d),i+='" ></Alpha>',d="",o+='<CostCenters Query="',d+=" dcCCNID51="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",",d+=" dcCCNID53="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID+",",null==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank||"0"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()||null==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank||"Cash"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?d+=" dcCCNID68=1,":d+=" dcCCNID68="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+",",C.push("dcCCNID51"),C.push("dcCCNID53"),C.push("dcCCNID68");let y="",p="";if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim.length>0)for(let e=0;e<Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[24][0]).length;e++)y=Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[24][0])[e].toString(),p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0][y].toString(),y.Contains("CCNID")&&"CCNID51"!=y&&"CCNID53"!=y&&"CCNID68"!=y&&(d+=" dc"+y+"="+p+",",C.Contains("dc"+y)||C.push("dc"+y));for(let e=0;e<this.dgvEmployees.TableColumns.length;e++)this.dgvEmployees.TableColumns[e].startsWith("dcCCNID")&&(C.Contains(this.dgvEmployees.TableColumns[e])||this.dgvEmployees.TableColumns[e].endsWith("_Key")||(d+=" "+this.dgvEmployees.TableColumns[e]+"="+h.J0.EncodeXML(this.dgvEmployees.Table[this.lstSelectedEmps[this.iEmpIndex]][this.dgvEmployees.TableColumns[e]+"_Key"].toString())+","));if(d.length>0&&(o+=d),o+='" ></CostCenters>',a+='" ProductID="'+this.DefProdID+'" Quantity="0" Unit="1" UOMConversion="1" UOMConvertedQty="0" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" RefNO="" BillDate="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" CurrencyID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].CurrencyID+'" ExchangeRate="1" DebitAccount="'+this.sDrAccount+'" CreditAccount="'+this.sCrAccount+'" CommonNarration="'+h.J0.EncodeXML("POSTED FROM CONSOLIDATED MONTHLY PAYROLL"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="1" VoucherType="11" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Earning',m="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==e.VoucherType),null!=t&&t.length>0&&(m=t[0].InvDocDetailsID.toString())),l+=m.length>0?'" DocDetailsID="'+m:'" DocDetailsID="',l+=a.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo&&!h.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo)&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dActual.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dEarned.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dArrear.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted.Replace(",","")+",");if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;e++)h.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo)||(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dActual.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dEarned.Replace(",","")+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="2" VoucherType="12" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Deduction',m="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&12==e.VoucherType),null!=t&&t.length>0&&(m=t[0].InvDocDetailsID.toString())),l+=m.length>0?'" DocDetailsID="'+m:'" DocDetailsID="',l+=a.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)h.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo)||(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dActual.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dEarned.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dArrear.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted.Replace(",","")+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="3" VoucherType="13" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Loan',m="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&13==e.VoucherType),null!=t&&t.length>0&&(m=t[0].InvDocDetailsID.toString())),l+=m.length>0?'" DocDetailsID="'+m:'" DocDetailsID="',l+=a.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;e++)!h.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo)&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].IsVisible&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanActInstAmt.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanInstAmt.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanBalAmt.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanPayStatus+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="4" VoucherType="14" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="Leaves',m="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&14==e.VoucherType),null!=t&&t.length>0&&(m=t[0].InvDocDetailsID.toString())),l+=m.length>0?'" DocDetailsID="'+m:'" DocDetailsID="',l+=a.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;e++)h.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo)||(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveTotOPBal.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].EncashLeavetaken.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveMonOPBal.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveNetBal.Replace(",","")+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}return l.toString()}GetActivityXML(){let i,t="",l="",a="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0)for(let d=0;d<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length;d++)t+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[d].InvDocDetailsID.toString();let o="";if(o+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?t.length>0?'<XML DetailIds="'+t+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':'<XML AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':t.length>0?'<XML DetailIds="'+t+'" >':"<XML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){let d,m,C,g,y,e,p="0";if(l=a="",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>0&&(p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[0].DocID.toString()),o+='<LoanRepaymentXML DocID="'+p+'" DocDetIDs="" WorkFlowID="0" >',o+="<DOCXML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0){let u=0;null!=r.d.SessionManager.dtDocDefAccs&&(i=r.d.SessionManager.dtDocDefAccs.filter(T=>40057==T.CostCenterID&&"CreditAccount"==T.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=r.d.SessionManager.dtDocDefAccs.filter(T=>40057==T.CostCenterID&&"DebitAccount"==T.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(a=i[0].UserDefaultValue.toString()));for(let T=0;T<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;T++)if(!h.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].SNo)&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].IsVisible&&!h.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanInstAmt)){d=this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanDocNo,C=this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanActInstNo,y=3==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanPayStatus)?this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanActInstAmt.Replace(",",""):this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanInstAmt.Replace(",","");let A=parseInt(C);this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[11].filter(_=>_.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&_.RefNo==d&&_.dcAlpha5==r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),null!=e&&e.length>0&&(A=parseInt(e[0].dcNum1))):(r.d.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==r.d.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(_=>_.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&_.DocNo==d&&_.InstallmentNo==A),e.SortBy(["InstallmentNo"])):(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(_=>_.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&_.DocNo==d&&_.InstBalance>0&&_.InstallmentNo<A),e.SortBy(["InstallmentNo"])),null!=e&&e.length>0&&(A=parseInt(e[0].InstallmentNo)));let k=parseFloat(y),x=0,F=0;do{if(u++,e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(_=>_.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&_.DocNo==d&&_.InstallmentNo==A),m=e[0].InvDocDetailsID.toString(),g=e[0].InstallmentAmt.toString().Replace(",",""),x=k>parseFloat(e[0].InstBalance)?parseFloat(e[0].InstBalance):k,o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="'+u+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+m+'" LinkedFieldName="dcNum3" LineNarration="" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="0" RefNO="'+d+'" LinkedFieldValue="'+x+'" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+a+'"  CreditAccount="'+l+'"  ></Transactions>',o+='<Numeric Query="dcNum1='+A+", dcCalcNum1="+A+", dcNum2="+g.Replace(",","")+", dcCalcNum2="+g.Replace(",","")+", dcNum3="+x.toString().Replace(",","")+", dcCalcNum3="+x.toString().Replace(",","")+', " ></Numeric>',o+="<Alpha Query=\"dcAlpha1=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanApprovedAmt+"',dcAlpha2=N'"+(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanBalAmt)-F)+"', dcAlpha3=N'"+y+"', dcAlpha4=N'"+h.J0.ParseDate(e[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanPayStatus+"', \" ></Alpha>",o+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].ComponentID+', " ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>",F+=x,k-=x,e[0].Flag=1,r.d.SessionManager.Preferences.ContainsKey("DeductExcessLoanAmountfromLastInstallment")&&"True"==r.d.SessionManager.Preferences.DeductExcessLoanAmountfromLastInstallment){let _=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(f=>f.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&f.DocNo==d&&0==f.Flag&&f.InstBalance>0).Compute("max","InstallmentNo");null!=_&&null!=_&&(A=parseInt(_))}else A++}while(k>0)}}o+="</DOCXML>",o+="<BillXML></BillXML></LoanRepaymentXML>"}if(this.chkPostBasedOnDailyAttendance.IsChecked&&r.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==r.d.SessionManager.Preferences.CaputureDimensionData.toString()){let y,d="",m="",C="",g="",p="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length>0){C=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[0].DocID.toString();for(let u=0;u<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length;u++)g+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[u].InvDocDetailsID.toString()}y=p="",null!=r.d.SessionManager.dtDocDefAccs&&(i=r.d.SessionManager.dtDocDefAccs.filter(u=>40079==u.CostCenterID&&"CreditAccount"==u.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(y=i[0].UserDefaultValue.toString()),i=r.d.SessionManager.dtDocDefAccs.filter(u=>40079==u.CostCenterID&&"DebitAccount"==u.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(p=i[0].UserDefaultValue.toString())),o+='<AttendanceDimensionwiseXML DocID="'+C+'" DocDetIDs="'+g+'" WorkFlowID="0" >',o+="<DOCXML>";let e=null;if(null!=this.dsDailyAttendanceData&&this.dsDailyAttendanceData.Tables.length>0&&(e=this.dsDailyAttendanceData.Tables[0].filter(u=>u.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),null!=e&&e.length>0){let A,k,x,F,u=[],T=[];T.push("EMPNODE");for(let f=0;f<this.dsDailyAttendanceData.Tables[3].length;f++)T.push(this.dsDailyAttendanceData.Tables[3][f].Data.toString());T.push("OT1"),T.push("OT2"),T.push("OT3"),T.push("OT4"),T.push("OT5"),T.push("DAYSATTENDED"),T.push("ABSENTDAYS"),T.push("Leaves"),T.push("TOTALOTAMOUNT");for(let f=0;f<e.length;f++)if(k=this.ApplyFilter(u,e[f]),null!=k&&k.length>0)for(let E=0;E<T.length;E++)T[E].startsWith("OT")&&(k[0][T[E]]=h.J0.SUMHoursAndMinutes(k[0][T[E]].toString(),e[f][T[E]].toString()));else{A={},A.EMPNODE=e[f].EMPNODE;for(let E=1;E<T.length;E++)A[T[E]]=e[f][T[E]];if(x=this.ApplyFilter(this.dsDailyAttendanceData.Tables[1],e[f]),null!=x&&x.length>0){if(F=this.ApplyFilter(this.dsDailyAttendanceData.Tables[2],e[f]),A.ABSENTDAYS=null!=F&&F.length>0?F[0].ABSENTDAYS:"0",null==this.dsDailyAttendanceData.Tables[4]||this.dsDailyAttendanceData.Columns[4].Contains("NODATA"))A.Leaves="0";else{let E=this.ApplyFilter(this.dsDailyAttendanceData.Tables[4],e[f]),N=0;if(null!=E&&E.length>0){let ae,z;N=0;for(let W=0;W<E.length;W++)ae=h.J0.ParseDate(E[W].FromDate),z=h.J0.ParseDate(E[W].ToDate),ae>=r.d.SessionManager.PayrollMonthStart?z<=r.d.SessionManager.PayrollMonthEnd?N+=parseFloat(E[W].Leaves):ae<=r.d.SessionManager.PayrollMonthEnd&&(N+=this.oCMP.GetNoOfDays(ae,r.d.SessionManager.PayrollMonthEnd,parseInt(E[W].ComponentID))):z<=r.d.SessionManager.PayrollMonthEnd?z>=r.d.SessionManager.PayrollMonthStart&&(N+=this.oCMP.GetNoOfDays(r.d.SessionManager.PayrollMonthStart,z,parseInt(E[W].ComponentID))):N+=this.oCMP.GetNoOfDays(r.d.SessionManager.PayrollMonthStart,r.d.SessionManager.PayrollMonthEnd,parseInt(E[W].ComponentID))}A.Leaves=N>0?N:"0"}A.DAYSATTENDED=parseFloat(x[0].DAYSATTENDED)-parseFloat(A.ABSENTDAYS),A.TOTALOTAMOUNT=x[0].TOTALOTAMOUNT}u.push(A)}let _="0";for(let f=0;f<u.length;f++){if(_="0",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>f&&(_=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[f].InvDocDetailsID.toString()),d="",o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="'+f+'"  DocDetailsID="'+_+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="',o+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',o+='" Rate="0" Gross="0" RefNO="0" LinkedFieldValue="0" IsQtyIgnored="1" AverageRate="0',o+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+p+'"  CreditAccount="'+y+'"  ></Transactions>',o+='<Numeric Query="dcNum1='+h.J0.Double(u[f].TOTALOTAMOUNT)+", dcCalcNum1="+h.J0.Double(u[f].TOTALOTAMOUNT)+", ",o+="dcNum5="+h.J0.Double(u[f].OT1)+", dcCalcNum5="+h.J0.Double(u[f].OT1)+", ",o+="dcNum7="+h.J0.Double(u[f].OT2)+", dcCalcNum7="+h.J0.Double(u[f].OT2)+", ",o+="dcNum9="+h.J0.Double(u[f].OT3)+", dcCalcNum9="+h.J0.Double(u[f].OT3)+", ",o+="dcNum11="+h.J0.Double(u[f].OT4)+", dcCalcNum11="+h.J0.Double(u[f].OT4)+", ",o+="dcNum13="+h.J0.Double(u[f].OT5)+", dcCalcNum13="+h.J0.Double(u[f].OT5)+", ",o+='" ></Numeric>',o+="<Alpha Query=\"dcAlpha1=N'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha2=N'"+h.J0.Double(u[f].DAYSATTENDED)+"', dcAlpha3=N'"+h.J0.Double(u[f].ABSENTDAYS)+"', dcAlpha4=N'"+h.J0.Double(u[f].Leaves)+"', \" ></Alpha>",o+='<CostCenters Query="',d+=" dcCCNID51="+h.J0.Int(u[f].EMPNODE)+",",this.dsDailyAttendanceData.Tables[3].length>0){m="";for(let E=0;E<this.dsDailyAttendanceData.Tables[3].length;E++)m=this.dsDailyAttendanceData.Tables[3][E].Data.toString(),d+=" "+m+"="+h.J0.Int(u[f][m])+","}d.length>0&&(o+=d),o+='" ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>"}}o+="</DOCXML>",o+="</AttendanceDimensionwiseXML>"}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";"),m=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrCalcMonthPaydays.split(";");if(d.length>0){o+="<ArrearsXML>",o+="<Rows>";for(let C=0;C<d.length;C++)o+='<Row PayrollMonth="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),o+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,o+='" ArrearsCalcMonths="'+h.J0.ParseDate(d[C]).ToString("dd/MMM/yyyy"),o+='" ArrCalcMonthPayDays="'+m[C].toString(),o+='" ArrearsCalcDays="',o+='" />';o+="</Rows>",o+="</ArrearsXML>"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.length>0){let d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";"),m=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.split(";");if(d.length>0){o+="<AdjustmentsXML>",o+="<Rows>";for(let C=0;C<d.length;C++)o+='<Row PayrollMonth="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),o+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,o+='" AdjMonth="'+h.J0.ParseDate(d[C]).ToString("dd/MMM/yyyy"),o+='" Days="'+m[C].toString(),o+='" Remarks="',o+='" />';o+="</Rows>",o+="</AdjustmentsXML >"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero.length>0&&(o+='<DelLoanXML DocID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero[0].DocID.toString()+'" > </DelLoanXML>'),this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&"True"==r.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero&&parseInt(r.d.SessionManager.Preferences.CreateLoanType)>0&&(l=a="",null!=r.d.SessionManager.dtDocDefAccs&&(i=r.d.SessionManager.dtDocDefAccs.filter(d=>40056==d.CostCenterID&&"CreditAccount"==d.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=r.d.SessionManager.dtDocDefAccs.filter(d=>40056==d.CostCenterID&&"DebitAccount"==d.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(a=i[0].UserDefaultValue.toString())),o+='<CreateLoanXML DocID="" DocDetIDs="" WorkFlowID="0" >',o+="<DOCXML>",o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="" CommonNarration="LOAN CREATED FROM MONTHLY PAYROLL WHEN NET SALARY LESS THAN 0" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+a+'"  CreditAccount="'+l+'"  ></Transactions>',o+='<Numeric Query="dcNum1=1, dcCalcNum1=1, dcNum2='+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+", dcCalcNum2="+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+', " ></Numeric>',o+="<Alpha Query=\"dcAlpha6=N'"+r.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha1=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha2=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha4=N'1', dcAlpha3=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"',dcAlpha5=N'"+r.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha7=N'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",o+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+r.d.SessionManager.Preferences.CreateLoanType+', " ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>",o+="</DOCXML>",o+="<BillXML></BillXML></CreateLoanXML>"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(d.length>0){let m="";m+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=1 AND PayrollMonth='"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(let C=0;C<d.length;C++){let g="",y="";m+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",g+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+d[C].toString()+"',1";for(let p=0;p<this.oCMP.arrLstCPFields[0][0].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData.length>0){let u=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData.TrimEnd(","),u=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].ArrData.split(";"),null!=u&&u.length>0)for(let T=0;T<u.length;T+=2)h.J0.ParseDate(u[T]).ToString("dd MMM yyyy")==h.J0.ParseDate(d[C]).ToString("dd MMM yyyy")&&(e=u[T+1])}y+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].SNo,g+=null!=e&&""!=e?","+e:",0"}for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData.length>0){let u=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData.TrimEnd(","),u=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].ArrData.split(";"),null!=u&&u.length>0)for(let T=0;T<u.length;T+=2)h.J0.ParseDate(u[T]).ToString("dd MMM yyyy")==h.J0.ParseDate(d[C]).ToString("dd MMM yyyy")&&(e=u[T+1])}y+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].SNo,g+=null!=e&&""!=e?","+e:",0"}m+=y+")",m+=g+")"}o+='<ArrearsDetailXML Query="'+m+'"></ArrearsDetailXML>'}}if(this.oCMP.arrLstCPFields[0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.length>0){let d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";");if(d.length>0){let m="";m+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=2 AND PayrollMonth='"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(let C=0;C<d.length;C++){let g="",y="";m+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",g+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+d[C].toString()+"',2";for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.length>0){let u=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.TrimEnd(","),u=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.split(","),null!=u&&u.length>0)for(let T=0;T<u.length;T+=2)h.J0.ParseDate(u[T]).ToString("dd MMM yyyy")==h.J0.ParseDate(d[C]).ToString("dd MMM yyyy")&&(e=u[T+1])}y+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].SNo,g+=null!=e&&""!=e?","+e:",0"}for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.length>0){let u=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.TrimEnd(","),u=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.split(","),null!=u&&u.length>0)for(let T=0;T<u.length;T+=2)h.J0.ParseDate(u[T]).ToString("dd MMM yyyy")==h.J0.ParseDate(d[C]).ToString("dd MMM yyyy")&&(e=u[T+1])}y+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].SNo,g+=null!=e&&""!=e?","+e:",0"}m+=y+")",m+=g+")"}o+='<AdjustmentsDetailXML Query="'+m+'"></AdjustmentsDetailXML>'}}return o+="</XML>",o.toString()}GetRawExportHTML(){let t="",l="";t+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",l+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",l+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",l+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",l+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",l+=".null{background-color:#ECF9C;}",t+="<style>"+l.toString()+"</style>";let a=this.dgvEmployees.Table;t+="<table>",t+="<tr><td style='padding-top:10p;'><table border=1 style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",t+="<COLGROUP>";let i=null;for(let d=0;d<this.dgvEmployees.TableColumns.length;d++){var o=this.dgvEmployees.TableColumns[d];i=this.dgvEmployees.Columns.find(m=>m.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[d][o].toUpperCase()),null!=i&&i.IsVisible&&(t+="<COL>")}t+="</COLGROUP>",t+="<tr style=''>";for(let d=0;d<this.dgvEmployees.Table.length;d++)o=this.dgvEmployees.Table[d],i=this.dgvEmployees.Columns.find(C=>C.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[d][o].toUpperCase()),null!=i&&i.IsVisible&&(t+="<th class='hdr'>",t+=i.Header,t+="</th>");t+="</tr>";for(let d=0;d<a.length;d++){if(t+="<tr",d%2==1&&(t+=" class=alt"),t+=">",0==this.dgvEmployees.TableColumns.length)t+="<td colspan="+this.dgvEmployees.TableColumns.length+">DELETED ROW</td>";else for(let m=0;m<this.dgvEmployees.TableColumns.length;m++)o=this.dgvEmployees.TableColumns[d],i=this.dgvEmployees.Columns.find(g=>g.DisplayMember.toUpperCase()==this.dgvEmployees.TableColumns[m][o].toUpperCase()),null!=i&&i.IsVisible&&(null==a[d][m]?t+="<td class='null'>":(t+="<td>",t+=a[d][m].toString()),t+="</td>");t+="</tr>"}return t+="</table>",t+="</td></tr></table>",t+="</body><html>",t.toString()}ApplyFilter(t,l){let a=t.filter(i=>i.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let i=0;i<this.dsDailyAttendanceData.Tables[3].length;i++){let o=this.dsDailyAttendanceData.Tables[3][i].Data.toString();a=a.filter(d=>d[o]==l[this.dsDailyAttendanceData.Tables[3][i].Data.toString()])}return a}ReportView(){this.ReportDimension=new ft.y$(0),this.ReportDimension.CCID=this.CostCenterID,this.ReportDimension.TypeID=1,this.ReportsList=[],this.ReportDimension.OnPactListBoxValueChanged.Subscribe(this,"OnReportsLinkClick");let t=[];this.dsData=r.d.common.GetDataSetQuery(" declare @UserID int,@RoleID int        set @UserID="+r.d.SessionManager.UserID+" set @RoleID="+r.d.SessionManager.RoleID+"    \n                    SELECT R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel,Q.Width ,Q.Height,Q.mapxml,Q.MapType\n                    FROM ADM_RevenUReports R  with(nolock)\n                    inner join ADM_DocumentReports Q WITH(NOLOCK) on Q.DocumentReportID=R.ReportID\n                    left join ADM_CostCenterDef A WITH(NOLOCK) on A.CostCenterColID=Q.DocumentField \n                    left join [ADM_DocReportUserRoleMap] DR WITH(NOLOCK) on DR.DocumentViewID=Q.DocumentViewID and DR.CostCenterID=Q.CostCenterID\n                    where  Q.CostCenterID="+this.CostCenterID+" and (DR.UserID=@UserID OR DR.RoleID=@RoleID OR GroupID IN (SELECT GroupID FROM COM_Groups WITH(NOLOCK) WHERE UserID=@UserID OR RoleID=@RoleID))\n                    GROUP BY  Q.ReportID, R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel ,Q.Width,Q.Height,Q.mapxml,Q.MapType \n                    order by Q.ReportID "),null!=this.dsData&&this.dsData.Tables[0].length>0&&this.dsData.Tables[0].forEach(a=>{let i=new Et.v;i.DBColumnID=parseInt(a.ReportID),i.Label=a.ReportName.toString(),this.dsData.Columns[0].Contains("Shortcut")&&(i.KeyTip=a.Shortcut.toString()),this.dsData.Columns[0].Contains("DisplayAsPopup")&&""!=a.DisplayAsPopup.toString()&&(i.Dependantinuse="1"==a.DisplayAsPopup.toString()),this.dsData.Columns[0].Contains("Width")&&""!=a.Width.toString()&&(i.Width=a.Width.toString()),this.dsData.Columns[0].Contains("Height")&&""!=a.Height.toString()&&(i.Length=a.Height.toString()),this.dsData.Columns[0].Contains("DocumentField")&&""!=a.DocumentField.toString()&&(i.Formula=a.DocumentField.toString()),this.dsData.Columns[0].Contains("mapxml")&&""!=a.mapxml.toString()&&(i.ToolTipDescription=a.mapxml.toString()),t.Contains(parseInt(a.ReportID))||(t.push(parseInt(a.ReportID)),this.ReportsList.push(i)),0==this.ReportsList.length&&(this.ButtonReport.Visible=!1)})}OnReportsLinkClick(t){var l=this;return(0,de.A)(function*(){const{ReportViewModel:a}=yield Promise.resolve().then(G.bind(G,39026)),{ReportViewComponent:i}=yield Promise.resolve().then(G.bind(G,31503));let m,o={strXML:""},d=new a;if(l.DisplayMessage=l.GetReportFilterXML(t,o),m=o.strXML,0==l.DisplayMessage.length){var C=l.ReportsList.find(g=>g.DBColumnID==parseInt(t));if(null!=C&&C.Dependantinuse)d.ReportViewModel_Document(l.CostCenterID,m,parseInt(t),!0,null,null),!h.J0.IsEmpty(C.Width)&&h.J0.Double(C.Width)>0&&(d.RptWidth=h.J0.Double(C.Width)),!h.J0.IsEmpty(C.length)&&h.J0.Double(C.length)>0&&(d.RptHeight=h.J0.Double(C.length)),d.DocumentObject=l,r.d.page.HideDialog(l.PopUpGUID),r.d.page.ShowDialog(d,i,{Title:"",HideClose:!0,ShowCenter:!0});else{let g=new a;g.ReportViewModel_Document(l.CostCenterID,m,parseInt(t),!1,null,null),g.DocumentObject=l,r.d.page.HideDialog(l.PopUpGUID),r.d.page.addNewTab({component:i,params:{obj:g}})}}})()}GetReportFilterXML(t,l){let a="";l.strXML="";let i=this.dsData.Tables[0];i=i.filter(m=>m.ReportID==t);let d,o=!1;i.forEach(m=>{(0,q.yG0)(m.GroupLevel)&&(o=!0)}),a+="<XML",o&&(a+=' GroupLevel="1"'),a+=" >";for(let m=0;m<i.length;m++){if(d=i[m].ReportField.toString(),a+="<Row ",a+='ColID ="'+d+'" ',!h.J0.IsEmpty(i[m].SysColumnName))if("dcccnid51"==i[m].SysColumnName.toString().toLowerCase()){let C="";for(let g=0;g<this.dgvEmployees.Table.length;g++)(0,q.yG0)(this.dgvEmployees.Table[g].Select)&&(C+=this.dgvEmployees.Table[g].EmpSeqNo.toString()+",");if(h.J0.IsEmpty(C)||!(C.length>0))return alert(this.ErrorMessage+"Employee '"),"Empty Value";C=C.substr(0,C.length-1),a+='Value ="'+C+'" '}else"duedate"==i[m].SysColumnName.toString().toLowerCase()?a+='Value ="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" ':"dcalpha17"==i[m].SysColumnName.toString().toLowerCase()?a+='Value ="'+r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+'" ':"dcalpha18"==i[m].SysColumnName.toString().toLowerCase()&&(a+='Value ="'+r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+'" ');a+=" />"}return a+="</XML>",l.strXML=a.toString(),""}}function ea(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",5),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Post"))}),s.nrm(1,"i",19),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&L&&(s.R7$(2),s.JRh(s.bMT(3,1,"Post")))}function ta(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",5),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("UnPost"))}),s.nrm(1,"i",20),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&L&&(s.R7$(2),s.JRh(s.bMT(3,1,"UnPost")))}function aa(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",5),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Report"))}),s.nrm(1,"i",21),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&L&&(s.R7$(2),s.JRh(s.bMT(3,1,"Report")))}let sa=(()=>{class L{constructor(){this.form=new v.gE({})}ngOnInit(){this.obj=this.params.obj}static{this.\u0275fac=function(a){return new(a||L)}}static{this.\u0275cmp=s.VBU({type:L,selectors:[["app-post-payroll"]],standalone:!1,decls:100,vars:27,consts:[[1,"maincontainer"],[1,"page-header"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-broom"],[1,"fa-light","fa-filter"],[1,"main_div",2,"display","flex","flex-direction","column","padding","10px"],[1,"masterscreen",2,"height","120px"],[1,"row",2,"height","30px"],[1,"col-xl-3","col-md-4","col-sm-6","col-xs-12",2,"display","flex","flex-direction","row","margin-bottom","9px"],[1,"input_cntrl_label",2,"font-size","13px"],[1,"input_cntrl_label",2,"font-weight","bold","font-size","12px !important"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12",2,"display","flex","flex-direction","row"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12"],["FieldDirective","",3,"obj"],[1,"documentgrid",2,"flex","1","overflow","auto"],[2,"width","100%","height","100%",3,"obj"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fa-light","fa-file-times"],[1,"fa-light","fa-file-chart-line"]],template:function(a,i){1&a&&(s.j41(0,"div",0),s.EFF(1,"\n      "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"span",2),s.EFF(5),s.k0s(),s.EFF(6,"\n        "),s.j41(7,"div",3),s.EFF(8,"\n          "),s.DNE(9,ea,4,3,"span",4),s.EFF(10,"\n          "),s.j41(11,"span",5),s.bIt("click",function(){return i.obj.Button_Click("Clear")}),s.nrm(12,"i",6),s.EFF(13),s.nI1(14,"translate"),s.k0s(),s.EFF(15,"\n          "),s.DNE(16,ta,4,3,"span",4),s.EFF(17,"\n          "),s.j41(18,"span",5),s.bIt("click",function(){return i.obj.Button_Click("Filter")}),s.nrm(19,"i",7),s.EFF(20),s.nI1(21,"translate"),s.k0s(),s.EFF(22,"\n          "),s.DNE(23,aa,4,3,"span",4),s.EFF(24,"           \n        "),s.k0s(),s.EFF(25,"\n      "),s.k0s(),s.EFF(26,"\n      "),s.j41(27,"div",8),s.EFF(28," \n        "),s.j41(29,"div",9),s.EFF(30,"\n          "),s.j41(31,"div",10),s.EFF(32," \n            "),s.j41(33,"div",11),s.EFF(34,"\n                  "),s.j41(35,"label",12),s.EFF(36),s.nI1(37,"translate"),s.k0s(),s.EFF(38,"\n                  "),s.j41(39,"label",13),s.EFF(40),s.k0s(),s.EFF(41,"\n              "),s.k0s(),s.EFF(42,"\n            "),s.k0s(),s.EFF(43,"\n          "),s.j41(44,"div",10),s.EFF(45,"\n                "),s.j41(46,"div",14),s.EFF(47,"\n                "),s.j41(48,"label",12),s.EFF(49),s.nI1(50,"translate"),s.k0s(),s.EFF(51,"\n                "),s.j41(52,"label",13),s.EFF(53),s.k0s(),s.EFF(54,"\n              "),s.k0s(),s.EFF(55,"\n              "),s.j41(56,"div",14),s.EFF(57,"\n                "),s.j41(58,"label",12),s.EFF(59),s.nI1(60,"translate"),s.k0s(),s.EFF(61,"\n                "),s.j41(62,"label",13),s.EFF(63),s.k0s(),s.EFF(64,"              \n            "),s.k0s(),s.EFF(65,"\n          "),s.k0s(),s.EFF(66,"\n          "),s.j41(67,"div",10),s.EFF(68,"\n            "),s.j41(69,"div",15),s.EFF(70,"\n              "),s.eu8(71,16),s.EFF(72,"\n          "),s.k0s(),s.EFF(73,"\n  \n          "),s.j41(74,"div",15),s.EFF(75,"\n            "),s.eu8(76,16),s.EFF(77,"\n        "),s.k0s(),s.EFF(78,"                  \n           "),s.k0s(),s.EFF(79,"\n           "),s.j41(80,"div",10),s.EFF(81,"\n        "),s.j41(82,"div",15),s.EFF(83,"\n          "),s.eu8(84,16),s.EFF(85,"\n      "),s.k0s(),s.EFF(86,"\n      "),s.j41(87,"div",15),s.EFF(88,"\n        "),s.eu8(89,16),s.EFF(90,"\n    "),s.k0s(),s.EFF(91,"\n          "),s.k0s(),s.EFF(92,"\n        "),s.k0s(),s.EFF(93,"\n        "),s.j41(94,"div",17),s.EFF(95,"\n          "),s.nrm(96,"app-PactGridView",18),s.EFF(97,"  \n        "),s.k0s(),s.EFF(98,"\n      "),s.k0s(),s.EFF(99,"\n "),s.k0s()),2&a&&(s.R7$(5),s.JRh(i.obj.Title),s.R7$(4),s.Y8G("ngIf",i.obj.PostVisiblility),s.R7$(4),s.JRh(s.bMT(14,17,"Clear")),s.R7$(3),s.Y8G("ngIf",i.obj.UnPostVisiblility),s.R7$(4),s.JRh(s.bMT(21,19,"Filter")),s.R7$(3),s.Y8G("ngIf",i.obj.ReportInfoVisibility),s.R7$(13),s.SpI("",s.bMT(37,21,"Payroll_PayMonth"),"        :"),s.R7$(4),s.JRh(i.obj.lblPayrollMonth),s.R7$(9),s.SpI("",s.bMT(50,23,"Payroll_StartDate"),"   :"),s.R7$(4),s.JRh(i.obj.lblPayrollMonthStart),s.R7$(6),s.SpI("",s.bMT(60,25,"Payroll_EndDate"),"   :"),s.R7$(4),s.JRh(i.obj.lblPayrollMonthEnd),s.R7$(8),s.Y8G("obj",i.obj.chkPostBasedOnDailyAttendance),s.R7$(5),s.Y8G("obj",i.obj.chkIncludeOTHours),s.R7$(8),s.Y8G("obj",i.obj.chkPostBasedOnAttDimWise),s.R7$(5),s.Y8G("obj",i.obj.IsProcessWithAdjustments),s.R7$(7),s.Y8G("obj",i.obj.EmployeesList))},dependencies:[xe.bT,$e._,st.X,qe.D9],encapsulation:2})}}return L})();var Ft=G(58170),la=G(15524);const ia=L=>({width:L});let kt=(()=>{class L extends la.P{constructor(){super()}ngOnInit(){h.J0.IsEmpty(this.obj.ProgressMessage)||(this.ProgressMessage=this.obj.ProgressMessage),this.obj.progress||(this.obj.progress=0),0===this.obj.total?this.obj.total=this.obj.progress:this.obj.total||(this.obj.total=100),this.obj.progress>this.obj.total&&(this.obj.progress=100,this.obj.total=100),this.obj.progress=this.obj.progress/this.obj.total*100,this.color=this.obj.progress<55?"red":this.obj.progress<75?"yellow":"green",setTimeout(()=>{r.d.page.HideDialog(this.obj.PopUpGUID)},2e3)}static{this.\u0275fac=function(a){return new(a||L)}}static{this.\u0275cmp=s.VBU({type:L,selectors:[["app-progress-bar"]],inputs:{progress:"progress",total:"total"},standalone:!1,features:[s.Vt3],decls:7,vars:7,consts:[[1,"progress-bar-container"],[3,"ngStyle"]],template:function(a,i){1&a&&(s.EFF(0,"\n  "),s.j41(1,"div",0),s.EFF(2,"\n     "),s.j41(3,"div",1),s.EFF(4),s.k0s(),s.EFF(5,"\n  "),s.k0s(),s.EFF(6,"\n  ")),2&a&&(s.R7$(3),s.ZvI("progress-bar ",i.color,""),s.Y8G("ngStyle",s.eq3(5,ia,i.progress+"%")),s.R7$(),s.SpI("\n      ",i.ProgressMessage,"\n     "))},dependencies:[xe.B3],encapsulation:2})}}return L})();class _t extends He.g{get SelectAll(){return this._SelectAll}set SelectAll(t){t!=this._SelectAll&&(this._SelectAll=t,this.SelectUnselectAll(t))}get ReportInfoVisibility(){return this._ReportInfoVisibility}set ReportInfoVisibility(t){t!=this._ReportInfoVisibility&&(this._ReportInfoVisibility=t)}constructor(t){super(),this.ButtonClick=new Ft.Yk,this.ProgressVisibility=!1,this.chkPostBasedOnDailyAttendance=new Ye.c,this.chkPostBasedOnAttDimWise=new Ye.c,this.chkIncludeOTHours=new Ye.c,this.IsProcessWithAdjustments=new Ye.c,this.EmployeesList=new n.vv,this.PostVisiblility=!0,this.UnPostVisiblility=!0,this.dsDailyAttendanceData=null,this.sPayrollMonthMouseDoubleClickCommand=new Ft.Yk,this.btnCancelFlag=!1,this.ReportsList=[],this.dsData=null,this._ReportInfoVisibility=!0,this.ButtonReport=new Et.v,this.sCrAccount="0",this.sDrAccount="0",this.SelectUnCheck=0,this.sFilter="",this.IsPosting=!1,this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.dtAdjData=[],this.sAdjsCalcMonths="",this.sAdjCalcMonthPaydays="",this.DefProdID=0,this.ErrorMessage="Missing Report Parameter ' ";try{Logger.InfoLog("PostPayrollViewModel::Entering PostPayrollViewModel()"),this.ClassName="PostPayrollViewModel",this.CostCenterID=40054,this.DisplayName=r.d.GetResource(t),this.Title=r.d.GetResource(t),this.DisplayMessage="",this.sPayrollMonth=" / ["+r.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.ButtonClick.Subscribe(this,"Button_Click"),this.sPayrollMonthMouseDoubleClickCommand.Subscribe(this,"sPayrollMonth_MouseDoubleClick"),this.lblPayrollMonth=r.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.PostVisiblility=r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Create"),this.UnPostVisiblility=r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Delete"),this.btnCancelFlag=!1,this.chkPostBasedOnDailyAttendance.Label=r.d.GetResource("PostbasedonDailyAttendance"),this.chkIncludeOTHours.Label=r.d.GetResource("IncludeOverTimeHours"),this.chkPostBasedOnAttDimWise.Label=r.d.GetResource("PostbasedonAttendanceDimensionwise"),this.IsProcessWithAdjustments.Label=r.d.GetResource("IsProcessWithAdjustments"),this.LoadGrid(),this.btnFilter_Click(),r.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==r.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==r.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0),this.ReportView(),Logger.InfoLog("PostPayrollViewModel::Exiting PostPayrollViewModel()")}catch(l){Logger.ErrorLog("PostPayrollViewModel::EXCEPTION PostPayrollViewModel()"+l.stack)}}sPayrollMonth_MouseDoubleClick(t){var l=this;return(0,de.A)(function*(){const{SetPayrollDateViewModel:a}=yield Promise.resolve().then(G.bind(G,34840)),{SetPayrollDateComponent:i}=yield Promise.resolve().then(G.bind(G,67721));let o=new a;r.d.page.ShowDialog(o,i,{ShowCenter:!0,Title:r.d.GetResource("Pay_SetPayrollDate")}),o.DialogResult&&l.btnClear_Click()})()}LoadGrid(){let a,l=(new ze.ControlGenerator).GetScreenInfo(this.CostCenterID);a=l.Tables[0].filter(o=>"CreditAccount"==o.SysColumnName),null!=a&&a.length>0&&!h.J0.IsEmpty(a[0].UserDefaultValue)&&(this.sCrAccount=a[0].UserDefaultValue.toString()),a=l.Tables[0].filter(o=>"DebitAccount"==o.SysColumnName),null!=a&&a.length>0&&null!=a[0].UserDefaultValue&&""!=a[0].UserDefaultValue.toString().Trim()&&(this.sDrAccount=a[0].UserDefaultValue.toString()),this.EmployeesList=new n.vv,this.EmployeesList.CanUserDeleteRows=!0,this.EmployeesList.Height=0,this.EmployeesList.Table=[],this.EmployeesList.SelectAll.Visible=!0,this.EmployeesList.TableColumns.push("Select"),this.EmployeesList.DataTypes.Bool.push("Select"),this.EmployeesList.TableColumns.push("SNo"),this.EmployeesList.TableColumns.push("EmpSeqNo"),this.EmployeesList.TableColumns.push("EmpCode"),this.EmployeesList.TableColumns.push("EmpName"),this.EmployeesList.TableColumns.push("GradeID"),this.EmployeesList.TableColumns.push("Result");let i=new B.O7;this.EmployeesList.Columns=[],i=new B.O7,i.Header=r.d.GetResource("Pay_Select"),i.DisplayMember="Select",i.DataType="CheckBox",i.Width=50,i.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.EmployeesList.Columns.push(i),i=new B.O7,i.Header=r.d.GetResource("Payroll_EmpSNo"),i.DisplayMember="SNo",i.DataType="TextBlock",i.Width=50,i.ReadOnly=!0,this.EmployeesList.Columns.push(i),i=new B.O7,i.Header=r.d.GetResource("EmployeeCode"),i.DisplayMember="EmpCode",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,this.EmployeesList.Columns.push(i),i=new B.O7,i.Header=r.d.GetResource("EmployeeName"),i.DisplayMember="EmpName",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,this.EmployeesList.Columns.push(i),i=new B.O7,i.Header=r.d.GetResource("Result"),i.DisplayMember="Result",i.DataType="TextBlock",i.Width=250,i.ReadOnly=!0,this.EmployeesList.Columns.push(i)}dgColSelect_CheckedChanged(t,l){l||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(t){for(let l=0;l<this.EmployeesList.Table.length;l++)0==this.SelectUnCheck&&(this.EmployeesList.Table[l].Select=t);this.SelectUnCheck=0,this.EmployeesList.refreshDataView()}Button_Click(t){Logger.InfoLog("PostPayrollViewModel::Entering Button_Click()"),"Post"==t.toString()?this.btnPost_Click():"Clear"==t.toString()?this.btnClear_Click():"UnPost"==t.toString()?this.btnUnPost_Click():"Filter"==t.toString()?this.btnFilter_Click():"Report"==t.toString()&&(this.ReportInfoVisibility=!0,r.d.page.ShowDialog(this,Gt.L,{Title:"Reports"})),Logger.InfoLog("PostPayrollViewModel::Exiting Button_Click()")}btnUnPost_Click(){this.IsPosting=!1,this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null)}btnClear_Click(){this.EmployeesList.Clear(),this.sPayrollMonth=" / ["+r.d.SessionManager.PayrollMonth.ToString("MMM-yyyy")+"]",this.lblPayrollMonth=r.d.SessionManager.PayrollMonth.ToString("MMM, yyyy"),this.lblPayrollMonthStart=r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy"),this.lblPayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy"),this.SelectAll=!1,this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1,this.chkPostBasedOnAttDimWise.IsChecked=!1,this.FailedCount=0,this.Failed="",this.InProgress="",this.IsPosting=!1,this.lstSelectedEmps=[],r.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==r.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==r.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll&&(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0)}btnPost_Click(){this.IsPosting||(this.IsPosting=!0,this.bgworker_DoWork(null,null),this.bgworker_RunWorkerCompleted(null,null))}btnFilter_Click(){Logger.InfoLog("PostPayrollViewModel::Entering Filter_Click()"),r.d.SessionManager.Preferences.ContainsKey("PostPayrollFilter")&&parseInt(r.d.SessionManager.Preferences.PostPayrollFilter)>0?null==this.objEmpFilter?this.objEmpFilter=new Ze.t("",0,2):this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=2,this.objEmpFilter.InitControls()):null==this.objEmpFilter?this.objEmpFilter=new Ze.t("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0&&r.d.page.ShowDialog(this.objEmpFilter,St.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted)if(this.objEmpFilter.CostCenterFilters.length>0){let l=1,a="",i="",o="";for(let y=0;y<this.objEmpFilter.CostCenterFilters.length;y++){let p=this.objEmpFilter.CostCenterFilters[y];if(p.CostCenterID>5e4&&(l=2,a="NodeID",i=50051==p.CostCenterID?"EmpSeqNo":"CCNID"+(p.CostCenterID-5e4)),p.SelectedNodes.length>0){if(1==p.SelectedNodes.length)o+=" AND ",o+=i+"="+p.SelectedNodes[0].Id;else if(!p.SelectedNodes.find(e=>e.Id==l&&e.IsGroup))if(o+=" AND ",It.IPrefetchFilter.IsGroupTree(p)){let e="";for(let u=0;u<p.SelectedNodes.length;u++)(null==p.SelectedNodes[u].Parent||!p.SelectedNodes[u].Parent.IsSelected)&&(e.length>0&&(e+=","),e+=p.SelectedNodes[u].Id);0==e.length&&(e+=-12912),o+=i+" IN ",o+=" (select T."+a+" GTID from "+rt.A.GetTagTableName(p.CostCenterID)+" T with(nolock),"+rt.A.GetTagTableName(p.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+a+" IN (",o+=e.toString()+")  group by T."+a+")"}else{o+=i+" IN (";for(let e=0;e<p.SelectedNodes.length;e++)e>0&&(o+=","),o+=p.SelectedNodes[e].Id;o+=")"}}else p.DeleteButtonVisibility||(o+=" AND ",o+=i+"=-12912")}this.sFilter=o.toString(),this.sFilter+=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve)  >='"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==r.d.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n                                                            Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n                                                            AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==r.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+r.d.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+r.d.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),h.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                                JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                                JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                                WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                                JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                                JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                                WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let d=r.d.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=d.Trim()&&"None"!=d&&(this.sFilter+="TreeView"==d?" ORDER BY EMP.lft ":" ORDER BY EMP."+d);let m=[];m.push(r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),m.push(this.sFilter),m.push(0),m.push(r.d.SessionManager.RoleID),m.push(r.d.SessionManager.UserID),m.push(r.d.SessionManager.LanguageID);let g,C=r.d.empService.GetData(m,"spPAY_GetEmpMasterCCDetails");if(this.EmployeesList.Clear(),null!=C&&C.Tables.length>0&&C.Tables[0].length>0){if(g=C.Tables[0],r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let y=r.d.SessionManager.dtPayrollPreferences.Tables[0].filter(p=>"DontConsiderEmpsForPayroll"==p.Name&&p.GradeID==C.Tables[0][0].CCNID53);if(null!=y&&y.length>0&&null!=y[0].Value&&null!=y[0].Value&&""!=y[0].Value.toString()&&"True"==y[0].Value.toString()&&(y=r.d.SessionManager.dtPayrollPreferences.Tables[0].filter(p=>"DontConsiderEmpsForPayrollDays"==p.Name&&p.GradeID==C.Tables[0][0].CCNID53),null!=y&&y.length>0&&null!=y[0].Value&&null!=y[0].Value&&""!=y[0].Value.toString())){let p=0;if(p=parseInt(y[0].Value),p>0){let e=new Date(r.d.SessionManager.PayrollMonth.getFullYear(),r.d.SessionManager.PayrollMonth.getMonth(),p),u=C.Tables[0].filter(T=>T.DOJ<=e);null!=u&&u.length>0&&(C=[],C=u)}}C.Tables[0].DefaultView.Sort="CCNID53",g=C.Tables[0].DefaultView.ToTable()}for(let y=0;y<g.length;y++){let p=this.EmployeesList.NewRow();p.EmpSeqNo=g[y].EmpSeqNo,p.EmpCode=g[y].EmpCode,p.EmpName=g[y].EmpName,p.GradeID=g[y].CCNID53,p.SNo=(y+1).toString(),p.Select=!1,this.EmployeesList.addRow(p)}}}else this.objEmpFilter.Filter>0&&this.FilterEmployees()}),Logger.InfoLog("PostPayrollViewModel::Exiting Filter_Click()")}FilterEmployees(){try{Logger.InfoLog("PostPayrollViewModel::Entering FilterEmployees()"),this.sFilter=" AND ( CONVERT(DATETIME,EMP.DOJ) <='"+r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")+"' AND CONVERT(DATETIME,EMP.DORelieve) >='"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"' ) ","True"==r.d.SessionManager.Preferences.NPDontAllowPayrollProcessing&&(this.sFilter+=" AND EmpSeqNo NOT IN ( Select NodeID From COM_CC50051 WITH(NOLOCK) \n\t\t\t                                        Where ResignStatus='Posted' AND DateDiff(day,ISNULL(CONVERT(DATETIME,DORelieve),'01-Jan-9000'),'"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')<=0\n\t\t\t                                        AND DateDiff(day,CONVERT(DATETIME,CONVERT(DATETIME,('01-'+CONVERT(NVARCHAR(3),DATENAME(MONTH,ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000')))+'-'+CONVERT(NVARCHAR,YEAR(ISNULL(CONVERT(DATETIME,DOResign),'01-Jan-9000'))))) ),'"+r.d.SessionManager.PayrollMonthStart.ToString("dd MMM yyyy")+"')>=0 )"),"True"==r.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&(this.sFilter+=" AND NOT ( MONTH(CONVERT(DATETIME,EMP.DOJ))="+r.d.SessionManager.PayrollMonth.iMonth()+" AND YEAR(CONVERT(DATETIME,EMP.DOJ))="+r.d.SessionManager.PayrollMonth.getFullYear()+" AND DAY(CONVERT(DATETIME,EMP.DOJ))>="+parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)+" ) "),r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),h.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),"Processed"==this.objEmpFilter.StatusModes.SelectedValue?this.sFilter+=" AND EmpSeqNo IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))":"UnProcessed"==this.objEmpFilter.StatusModes.SelectedValue&&(this.sFilter+=" AND EmpSeqNo NOT IN (SELECT DISTINCT C51.NODEID FROM INV_DocDetails I\n                                                    JOIN COM_DocCCData CC ON CC.InvDocDetailsID=I.InvDocDetailsID\n                                                    JOIN COM_CC50051 C51 ON C51.NODEID=CC.DCCCNID51\n                                                    WHERE I.CostCenterID=40054  AND  CONVERT(DATETIME,I.DueDate)=CONVERT(DATETIME,'"+r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy")+"'))");let t=r.d.SessionManager.Preferences.ConsolidateMonthlyPayrollSort;""!=t.Trim()&&"None"!=t&&(this.sFilter+="TreeView"==t?" ORDER BY EMP.lft ":" ORDER BY EMP."+t);let l=[];l.push(r.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),l.push(this.sFilter),l.push(0),l.push(r.d.SessionManager.RoleID),l.push(r.d.SessionManager.UserID),l.push(r.d.SessionManager.LanguageID);let i,a=r.d.empService.GetData(l,"spPAY_GetEmpMasterCCDetails");if(this.EmployeesList.Clear(),null!=a&&a.Tables.length>0&&a.Tables[0].length>0){if(i=a.Tables[0],r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let o=r.d.SessionManager.dtPayrollPreferences.Tables[0].filter(d=>"DontConsiderEmpsForPayroll"==d.Name&&d.GradeID==a.Tables[0][0].CCNID53);if(null!=o&&o.length>0&&null!=o[0].Value&&null!=o[0].Value&&""!=o[0].Value.toString()&&"True"==o[0].Value.toString()&&(o=r.d.SessionManager.dtPayrollPreferences.Tables[0].filter(d=>"DontConsiderEmpsForPayrollDays"==d.Name&&d.GradeID==a.Tables[0][0].CCNID53),null!=o&&o.length>0&&null!=o[0].Value&&null!=o[0].Value&&""!=o[0].Value.toString())){let d=0;if(d=parseInt(o[0].Value),d>0){let m=new Date(r.d.SessionManager.PayrollMonth.getFullYear(),r.d.SessionManager.PayrollMonth.getMonth(),d),C=a.Tables[0].filter(g=>new Date(g.DOJ)<=m);null!=C&&C.length>0&&(a=[],a=C)}}a.sort((d,m)=>m.CCNID53-d.CCNID53),i=a}for(let o=0;o<i.length;o++){let d=this.EmployeesList.NewRow();d.EmpSeqNo=i[o].EmpSeqNo,d.EmpCode=i[o].EmpCode,d.EmpName=i[o].EmpName,d.GradeID=i[o].CCNID53,d.SNo=(o+1).toString(),d.Select=!1,this.EmployeesList.addRow(d)}}Logger.InfoLog("PostPayrollViewModel::Exiting FilterEmployees()")}catch(t){Logger.ErrorLog("PostPayrollViewModel::EXCEPTION FilterEmployees()"+t.stack)}}bgworker_DoWork(t,l){Logger.InfoLog("PostPayrollViewModel::Entering bgworker_DoWork()"),this.IsPosting?this.PostPayrollData():this.UnPostPayrollData(),Logger.InfoLog("PostPayrollViewModel::Exiting bgworker_DoWork()")}UnPostPayrollData(){Logger.InfoLog("PostPayrollViewModel::Entering UnPostPayrollData()"),this.InProgress="";let t=0,l=0;if(null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0){this.lstSelectedEmps=[];let a="";for(let i=0;i<this.EmployeesList.Table.length;i++)(0,q.yG0)(this.EmployeesList.Table[i].Select)&&(a+=this.EmployeesList.Table[i].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(i),l++);if(a.length>0&&l>0){a=a.substr(0,a.length-1);let o,i=a.split(",");t=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=t,this.ProgressMessage="Unposting Payroll, please wait ...",r.d.page.ShowDialog({progress:this.ProgressValue,total:this.ProgressMax,ProgressMessage:this.ProgressMessage},kt,{HideHeader:!0,ShowCenter:!0,Title:"ProgressMessage"});let d=r.d.report.GetDataTable("PPVM01",a,r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"));for(let m=0;m<i.length;m++){if(this.strResult="",null!=i[m]&&""!=i[m]){if(o=d.filter(C=>C.EmpSeqNo==i[m]),null!=o&&o.length>0){let C=0,g=[];g.push(this.CostCenterID),g.push(parseInt(o[0].DocID)),g.push(1);let y=r.d.document.DeleteSelectedRows(g,C);this.strResult=y.Message,C=y.RetValue}else this.strResult="No Data exits to delete.",this.Failed+=this.EmployeesList.Table[this.lstSelectedEmps[m]].EmpCode.toString()+",",this.FailedCount++;this.EmployeesList.Table[this.lstSelectedEmps[m]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[m]])}this.ProgressValue=m+1,this.InProgress=m+1+" of "+t}this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.EmployeesList&&null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0&&this.EmployeesList.Table.filter(C=>1==C.Select).length>0&&(this.DisplayMessage="Unposted Successfully"),this.MessageVisibility=!0}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to unpost payroll.";this.MessageVisibility=!0,Logger.InfoLog("PostPayrollViewModel::Exiting UnPostPayrollData()")}bgworker_RunWorkerCompleted(t,l){Logger.InfoLog("PostPayrollViewModel::Entering worker_RunWorkerCompleted()"),this.ProgressVisibility=!1,this.IsPosting=!1,Logger.InfoLog("PostPayrollViewModel::Exiting worker_RunWorkerCompleted()")}PostPayrollData(){Logger.InfoLog("PostPayrollViewModel::Entering PostPayrollData()"),this.InProgress="";let t=0,l=0;if(this.iEmpIndex=0,null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0){this.lstSelectedEmps=[];let d,a="",i="",o=new Array,m=!1,C=0;for(let g=0;g<this.EmployeesList.Table.length;g++)if((0,q.yG0)(this.EmployeesList.Table[g].Select)&&(a+=this.EmployeesList.Table[g].EmpSeqNo.toString()+",",this.lstSelectedEmps.push(g),l++,m=!1,C=0,r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)){for(let y=0;y<o.length;y++)if(o[y].GradeID==parseInt(this.EmployeesList.Table[g].GradeID)){C=y,m=!0;break}m?(i=o[C].sEmpIds,i+=","+this.EmployeesList.Table[g].EmpSeqNo.toString(),o[C].sEmpIds=i,o[C].lstGradeEmps.push(parseInt(this.EmployeesList.Table[g].EmpSeqNo))):(d=new Mt.ii,d.GradeID=parseInt(this.EmployeesList.Table[g].GradeID),d.sEmpIds=this.EmployeesList.Table[g].EmpSeqNo.toString(),d.lstGradeEmps=new Array,d.lstGradeEmps.push(parseInt(this.EmployeesList.Table[g].EmpSeqNo)),o.push(d))}if(a.length>0&&l>0){if(a=a.substr(0,a.length-1),t=l,this.FailedCount=0,this.Failed="",this.ProgressVisibility=!0,this.ProgressValue=0,this.ProgressMax=t,this.ProgressMessage="Payroll is processing, please wait ...",r.d.page.ShowDialog({progress:this.ProgressValue,total:this.ProgressMax,ProgressMessage:this.ProgressMessage},kt,{HideHeader:!0,ShowCenter:!0,Title:"ProgressMessage"}),this.chkPostBasedOnDailyAttendance.IsChecked&&r.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==r.d.SessionManager.Preferences.CaputureDimensionData.toString())if(r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let g=0;g<o.length;g++){h.J0.SetPayrollMonth(r.d.SessionManager.PayrollMonth,r.d.SessionManager,o[g].GradeID);let p=[];p.push(a),p.push(r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),p.push(r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),p.push(this.chkIncludeOTHours.IsChecked?1:0),p.push(h.J0.IntTryParse(r.d.SessionManager.UserID)),p.push(r.d.SessionManager.LanguageID);let e=r.d.empService.GetData(p,"spPAY_PostDailyAttendancetoPayroll");o[g].dsDailyAttendanceDataCollection=e}else{let g=[];g.push(a),g.push(r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")),g.push(r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")),g.push(this.chkIncludeOTHours.IsChecked?1:0),g.push(h.J0.IntTryParse(r.d.SessionManager.UserID)),g.push(r.d.SessionManager.LanguageID),this.dsDailyAttendanceData=r.d.empService.GetData(g,"spPAY_PostDailyAttendancetoPayroll")}if(this.oCMP=new it.O,this.oCMP.oParent=this,this.oCMP.sSelectedEmpSeqNos=a,this.oCMP.IsPostFullAttendance=!0,this.chkPostBasedOnDailyAttendance.IsChecked&&(this.oCMP.IsPostBasedOnDailyAttendance=!0),this.chkPostBasedOnAttDimWise.IsChecked&&(this.oCMP.IsPostBasedOnAttDimWise=!0),this.chkIncludeOTHours.IsChecked&&(this.oCMP.IncludeOTHours=!0),this.oCMP.PayrollMonth=r.d.SessionManager.PayrollMonth,this.oCMP.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,this.oCMP.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,this.oCMP.GradeMPFls=o,this.oCMP.ProcessPayroll(),this.oCMP.IsCompleted){for(this.ProgressValue=0,this.ProgressMax=t,this.ProgressMessage="Saving data, please wait ...",this.iEmpIndex=0;this.iEmpIndex<this.oCMP.arrLstOthMPFields.length;this.iEmpIndex++){if(r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade)for(let g=0;g<o.length;g++)o[g].lstGradeEmps.Contains(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo))&&(r.d.SessionManager.PayrollMonth=o[g].GradePayrollMonth,r.d.SessionManager.PayrollMonthStart=o[g].GradePayrollMonthStart,r.d.SessionManager.PayrollMonthEnd=o[g].GradePayrollMonthEnd,this.dsDailyAttendanceData=o[g].dsDailyAttendanceDataCollection);if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID&&""!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()&&parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID)>0){let g=r.d.common.GetDataTable("PAY088",this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].INVDocDetailsID.toString()+",54,'"+r.d.SessionManager.UserName+"',40054,"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].WorkFlowLevel.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID.toString()+","+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].CreatedDate.toString()+","+r.d.SessionManager.UserID+","+r.d.SessionManager.RoleID);null!=g&&g.length>0&&(!h.J0.IsEmpty(g[0].CanApprove)&&"TRUE"==g[0].CanApprove.toString().toUpperCase()||(369!=parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)||r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Posted Docs")?441==parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[0].StatusID)&&!r.d.SessionManager.IsActionAssigned(this.CostCenterID,"Edit Approved Docs")&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Approved Document"):this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage="Can't Edit Posted Document"))}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.length>0){if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.endsWith("NumFields"))return this.DisplayMessage=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage.Replace("NumFields",""),void(this.MessageVisibility=!0);this.strResult=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sErrorMessage,this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.strResult="",this.CalculateAccruals(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo),this.IsProcessWithAdjustments.IsChecked&&this.AdjustmentsClick(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.SaveVoucher(),this.ProgressValue=this.iEmpIndex+1,this.InProgress=this.iEmpIndex+1+" of "+t}this.MessageVisibility=!0,this.FailedCount>0&&this.Failed.length>1?(this.Failed=this.Failed.substr(0,this.Failed.length-1),this.DisplayMessage="Failed count : "+this.FailedCount+", Emp.Codes : ( "+this.Failed+" )"):null!=this.EmployeesList&&null!=this.EmployeesList.Table&&this.EmployeesList.Table.length>0&&this.EmployeesList.Table.filter(y=>1==y.Select).length>0&&(this.DisplayMessage="Posted Successfully",this.SelectAll=!1,r.d.SessionManager.Preferences.ContainsKey("DefaultPostbasedonAttendanceDimensionWise")&&"True"==r.d.SessionManager.Preferences.DefaultPostbasedonAttendanceDimensionWise?this.chkPostBasedOnAttDimWise.IsChecked=!0:"True"==r.d.SessionManager.Preferences.GetDailyAttendanceDataInMonthlyPayroll?(this.chkPostBasedOnDailyAttendance.IsChecked=!0,this.chkIncludeOTHours.IsChecked=!0):(this.chkIncludeOTHours.IsChecked=!1,this.chkPostBasedOnDailyAttendance.IsChecked=!1))}}else this.DisplayMessage="Select atleast one Employee."}else this.DisplayMessage="No Employees found to post payroll.";this.MessageVisibility=!0,Logger.InfoLog("PostPayrollViewModel::Exiting PostPayrollData()")}AdjustmentsClick(t){try{Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Entering AdjustmentsClick()"),this.dtAdjData=[];let m,C,l=[],a=r.d.empService.GetQueryData(t,"ADJ001","","",""),i=this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining,o=r.d.SessionManager.PayrollMonth.AddMonths(-1),d=new Date(i.getFullYear(),i.getMonth(),1),g=Array();for(;o>=d;){if(C=a.filter(y=>y.PayrollMonth&&h.J0.ParseDate(y.PayrollMonth).ToString("dd/MMM/yyyy")==o.ToString("dd/MMM/yyyy")),null!=C&&C.length>0){if(r.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&"True"==r.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=r.d.SessionManager.Preferences.ConsiderLOPBasedOn.toString()){m={},m.PayrollMonth=o.ToString("dd/MMM/yyyy");let y,p,e,u={PayrollMonth:y,PayrollMonthStart:p,PayrollMonthEnd:e};if(h.J0.SetPayrollDate_1(h.J0.ParseDate(r.d.SessionManager.PayrollMonth.AddMonths(-1)),u),y=u.PayrollMonth,p=u.PayrollMonthStart,e=u.PayrollMonthEnd,r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade){let k=0;k=h.J0.GetEmployeeGrade(t.toString(),y,p,e),k>0&&(u={PayrollMonth:y,PayrollMonthStart:p,PayrollMonthEnd:e},h.J0.SetPayrollDate_1(h.J0.ParseDate(r.d.SessionManager.PayrollMonth.AddMonths(-1)),u,k),y=u.PayrollMonth,p=u.PayrollMonthStart,e=u.PayrollMonthEnd)}let T=[];T.push(t),T.push(y.ToString("dd/MMM/yyyy")),T.push(p.ToString("dd/MMM/yyyy")),T.push(e.ToString("dd/MMM/yyyy")),T.push(0),T.push(r.d.SessionManager.UserID),T.push(r.d.SessionManager.RoleID),T.push(r.d.SessionManager.LanguageID);let A=r.d.empService.ExecuteQuery_SP(T,"spPAY_GetEmpAdjDetailsMultiple");if(null!=A&&A.Tables.length>0&&A.Tables[0].length>0&&A.Columns[0].Contains("EmpSeqNo")){let k=[];k.push(e.ToString("dd MMM yyyy")),k.push(""),k.push(0),k.push(r.d.SessionManager.RoleID),k.push(r.d.SessionManager.UserID),k.push(r.d.SessionManager.LanguageID);let x=r.d.empService.ExecuteQuery_SP(k,"spPAY_GetEmpMasterCCDetails"),_=(new Mt.mr).AggregateLeaves(t.toString(),A,p,e,x,this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.othMPField.GradeID);_>0&&(m.Days=-_)}l.push(m)}if(null!=g&&g.length>0&&r.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")!=o.ToString("dd MMM yyyy")&&"True"==r.d.SessionManager.Preferences.DontConsiderEmpLeavesVacationDataBasedonPostedDate&&""!=r.d.SessionManager.Preferences.ConsiderLOPBasedOn.ToString())for(let y=0;y<g.length;y++)g[y].PrevMonth.ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&(m={},m.PayrollMonth=o.ToString("dd/MMM/yyyy"),m.Days=g[y].dDays,l.push(m))}else if(r.d.SessionManager.PayrollMonth.AddMonths(-1).ToString("dd MMM yyyy")==o.ToString("dd MMM yyyy")&&"True"==r.d.SessionManager.Preferences.DontConsiderEmpsForPayroll&&parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)>0&&i.getDate()>=parseInt(r.d.SessionManager.Preferences.DontConsiderEmpsForPayrollDays)){m={},m.PayrollMonth=o.ToString("dd/MMM/yyyy");let y,p,e,u={PayrollMonth:y,PayrollMonthStart:p,PayrollMonthEnd:e};h.J0.SetPayrollDate_1(h.J0.ParseDate(r.d.SessionManager.PayrollMonth.AddMonths(-1)),u),y=u.PayrollMonth,p=u.PayrollMonthStart,e=u.PayrollMonthEnd;let T=r.d.SessionManager.PayrollMonth,A=0;r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade&&(A=h.J0.GetEmployeeGrade(t.toString(),y,p,e),A>0&&(u={PayrollMonth:y,PayrollMonthStart:p,PayrollMonthEnd:e},h.J0.SetPayrollDate_1(h.J0.ParseDate(r.d.SessionManager.PayrollMonth.AddMonths(-1)),u,A),y=u.PayrollMonth,p=u.PayrollMonthStart,e=u.PayrollMonthEnd)),h.J0.SetPayrollMonth(y);let k=new it.O;k.oParent=this,k.sSelectedEmpSeqNos=t.ToString(),k.PayrollMonth=r.d.SessionManager.PayrollMonth,k.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,k.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,k.ProcessPayroll(),k.IsCompleted&&(m.Days=k.arrLstOthMPFields[0].DaysAttended),h.J0.SetPayrollMonth(T),l.push(m)}o=o.AddMonths(-1)}if(null!=l&&l.length>0)for(let y=0;y<l.length;y++)null!=l[y].Days&&null!=l[y].Days&&""!=l[y].Days.toString().Trim()&&(m={},m.PayrollMonth=r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),m.AdjMonth=l[y].PayrollMonth.toString(),m.Days=l[y].Days.toString(),this.dtAdjData.push(m));if(null!=this.dtAdjData&&this.dtAdjData.length>0&&(this.SaveAdjustment(),this.sAdjCalcMonthPaydays="",this.sAdjsCalcMonths="",null!=this.dtAdjData&&this.dtAdjData.length>0)){for(let y=0;y<this.dtAdjData.length;y++)this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays+this.dtAdjData[y].Days.toString()+";",this.sAdjsCalcMonths=this.sAdjsCalcMonths+this.dtAdjData[y].AdjMonth.toString()+";";this.sAdjCalcMonthPaydays.length>0&&(this.sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays.substring(this.sAdjCalcMonthPaydays.length-1,0)),this.sAdjsCalcMonths.length>0&&(this.sAdjsCalcMonths=this.sAdjsCalcMonths.substring(this.sAdjsCalcMonths.length-1,0)),this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths=this.sAdjsCalcMonths,this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays=this.sAdjCalcMonthPaydays}Logger.InfoLog("ConsolidatedMonthlyPayrollViewModel::Exiting AdjustmentsClick()")}catch(l){Logger.ErrorLog("ConsolidatedMonthlyPayrollViewModel::EXCEPTION AdjustmentsClick()\r\n"+l.Message+"\r\n"+l.stack)}}SaveAdjustment(){let t=r.d.SessionManager.PayrollMonth;this.CalculateAdjustments(parseInt(this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),this.oCMP.CalculateNet(),h.J0.SetPayrollMonth(t,r.d.SessionManager,this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID)}CalculateAdjustments(t){if(null!=this.dtAdjData&&this.dtAdjData.length>0){let a,i,o,l="";for(let e=0;e<this.dtAdjData.length;e++)l.length>0&&(l+=","),l+="'"+new Date(this.dtAdjData[e].AdjMonth).ToString("dd MMM yyyy")+"'";let d=r.d.empService.GetQueryData(t,"MPL010",l,"","");for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted="0";for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted="0";this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments=0,this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments=0;let p,m=r.d.empService.GetQueryData(0,"MPL014","","",""),C=r.d.empService.GetQueryData(t,"MPL005","","",""),g=r.d.empService.GetQueryData(t,"MPL011",r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),"",""),y="";for(let e=0;e<this.dtAdjData.length;e++){let u=new Date(this.dtAdjData[e].AdjMonth),T=u;a=d.filter(_=>new Date(_.PayrollMonth).ToString("dd MMM yyyy")==u.ToString("dd MMM yyyy")&&11==_.VoucherType);let A=null;if(null!=a&&a.length>0){let _=m.filter(f=>f.GradeID==a[0].dcCCNID53&&f.CPayrollDate<=T.ToString("dd MMM yyyy")).Compute("max","CPayrollDate");A=m.filter(f=>f.GradeID==a[0].dcCCNID53&&f.CPayrollDate==h.J0.String(_))}if(y="'"+u.ToString("dd/MMM/yyyy")+"' >= ApplyFrom AND '"+u.ToString("dd/MMM/yyyy")+"' <=EffectFrom",p=C.filter(_=>u.ToString("dd/MMM/yyyy")>=_.ApplyFrom&&u.ToString("dd/MMM/yyyy")<=_.EffectFrom),p=p.sort((_,f)=>_.EffectFrom-f.EffectFrom),i=g.Tables[0].filter(_=>_.ArrearsCalcMonths==h.J0.ParseDate(u)),o=g.Tables[1].filter(_=>1==_.DType&&_.ArrAdjMonth==h.J0.ParseDate(u)),null!=p&&p.length>0){let _=!1;if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.length>0){let f=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sArrsCalcMonths.split(";");if(f.length>0)for(let E=0;E<f.length;E++)h.J0.ParseDate(f[E]).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&(_=!0)}null!=i&&i.length>0||_?(u=h.J0.ParseDate(p[0].EffectFrom),r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?h.J0.SetPayrollMonth(u,r.d.SessionManager,null!=a&&a.length>0?parseInt(a[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):h.J0.SetPayrollMonth(u)):r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?h.J0.SetPayrollMonth(u,r.d.SessionManager,null!=a&&a.length>0?parseInt(a[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):h.J0.SetPayrollMonth(u)}else r.d.SessionManager.Preferences.ContainsKey("ConsiderGlobalPreferencesBasedOnGrade")&&"True"==r.d.SessionManager.Preferences.ConsiderGlobalPreferencesBasedOnGrade?h.J0.SetPayrollMonth(u,r.d.SessionManager,null!=a&&a.length>0?parseInt(a[0].dcCCNID53):this.oCMP.arrLstOthMPFields[0].GradeID):h.J0.SetPayrollMonth(u);let k=parseFloat(this.dtAdjData[e].Days),x=0;x="Actual Days"!=r.d.SessionManager.Preferences.PayDays?parseInt(r.d.SessionManager.Preferences.PayDays):u.DaysInMonth();let F=new it.O;if(F.oParent=this,F.sSelectedEmpSeqNos=t.toString(),F.PayrollMonth=r.d.SessionManager.PayrollMonth,F.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,F.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,F.dAdjDays=k,null!=a&&a.length>0&&(F.IsAdjustments=!0,F.drcArrStructure=A,F.ArrGradeID=h.J0.Int(a[0].dcCCNID53)),F.ProcessPayroll(),F.IsCompleted){let _=0;null!=a&&a.length>0?(F.arrLstOthMPFields[0].TotalDays=parseFloat(a[0].TotalDays),F.arrLstOthMPFields[0].MonthDays=parseFloat(a[0].TotalDays),F.arrLstOthMPFields[0].PaidLeaves=parseFloat(a[0].dcAlpha24),F.arrLstOthMPFields[0].TotalLeaves=parseFloat(a[0].LeavesTaken),F.arrLstOthMPFields[0].WeeklyOffs=parseFloat(a[0].WOffs),F.arrLstOthMPFields[0].Holidays=parseFloat(a[0].Holidays),_=parseFloat(a[0].DaysWorked.toString())+k,F.SetDaysAttended(0,"Days Attended",_)):h.J0.ParseDate(this.dtAdjData[e].AdjMonth).iMonth()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.iMonth()&&h.J0.ParseDate(this.dtAdjData[e].AdjMonth).getFullYear()==this.oCMP.arrLstOthMPFields[this.iEmpIndex].DateOfJoining.getFullYear()&&(F.arrLstOthMPFields[0].TotalDays=x,F.arrLstOthMPFields[0].TotalLeaves=0,F.SetDaysAttended(0,"Days Attended",Math.abs(k)));let W,f=0,E=-1,N=0,ae=0,z=0;a=d.filter(V=>new Date(V.PayrollMonth).ToString("dd MMM yyyy")==u.ToString("dd MMM yyyy")&&11==V.VoucherType);for(let V=0;V<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;V++)if(h.J0.IsEmpty(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateAdjustments)||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].CalculateAdjustments)for(let he=0;he<F.arrLstCPFields[0][0].length;he++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].SNo==F.arrLstCPFields[0][0][he].SNo){if(N=0,ae=0,z=0,E=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].SNo,!h.J0.IsEmpty(a)&&a.length>0&&!h.J0.IsEmpty(a[0]["dcCalcNum"+E])&&(N=parseFloat(a[0]["dcCalcNum"+E])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData.length>0&&(W=[],this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData.TrimEnd(","),W=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].ArrData.split(";"),null!=W&&W.length>0))for(let ye=0;ye<W.length;ye+=2)new Date(W[ye]).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&(ae=parseFloat(W[ye+1]));null!=o&&o.length>0&&null!=o[0]["Earning"+E]&&null!=o[0]["Earning"+E]&&""!=o[0]["Earning"+E]&&(z=parseFloat(o[0]["Earning"+E])),f=r.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,q.yG0)("True"==r.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PFE"==F.arrLstCPFields[0][0][he].ComponentName?parseFloat(F.arrLstCPFields[0][0][he].dEarned)-N:parseFloat(F.arrLstCPFields[0][0][he].dEarned)-N-ae-z,this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AdjData=h.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AdjData+=T.ToString("dd MMM yyyy")+","+f+",",this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].dAdjusted)+f).ToString(r.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][V].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+=f);break}a=d.filter(V=>new Date(V.PayrollMonth).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&12==V.VoucherType);for(let V=0;V<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;V++)if(null==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateAdjustments||""==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateAdjustments||"No"!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].CalculateAdjustments)for(let he=0;he<F.arrLstCPFields[0][2].length;he++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].SNo==F.arrLstCPFields[0][2][he].SNo){if(N=0,ae=0,z=0,E=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].SNo,null!=a&&a.length>0&&null!=a[0]["dcCalcNum"+E]&&null!=a[0]["dcCalcNum"+E]&&""!=a[0]["dcCalcNum"+E].toString()&&(N=parseFloat(a[0]["dcCalcNum"+E])),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData.length>0&&(W=[],this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData.TrimEnd(","),W=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].ArrData.split(";"),null!=W&&W.length>0))for(let ye=0;ye<W.length;ye+=2)new Date(W[ye]).ToString("dd MMM yyyy")==T.ToString("dd MMM yyyy")&&(ae=parseFloat(W[ye+1]));null!=o&&o.length>0&&null!=o[0]["Deduction"+E]&&null!=o[0]["Deduction"+E]&&""!=o[0]["Deduction"+E]&&(z=parseFloat(o[0]["Deduction"+E])),f=r.d.SessionManager.Preferences.ContainsKey("DonotconsiderArrearwhilecalculatingAdjustmentofPF")&&(0,q.yG0)("True"==r.d.SessionManager.Preferences.DonotconsiderArrearwhilecalculatingAdjustmentofPF)&&"PF"==F.arrLstCPFields[0][2][he].ComponentName?parseFloat(F.arrLstCPFields[0][2][he].dEarned)-N:parseFloat(F.arrLstCPFields[0][2][he].dEarned)-N-ae-z,this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AdjData=h.J0.String(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AdjData),this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AdjData+=T.ToString("dd MMM yyyy")+","+f+",",this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].dAdjusted=(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].dAdjusted)+f).ToString(r.d.SessionManager.sPayrollDecimals),null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet&&("Net"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet||"NetAndTax"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][V].AddToNet)&&(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+=f);break}this.oCMP.iEmpIndex=this.iEmpIndex,this.oCMP.othMPField=this.oCMP.arrLstOthMPFields[this.iEmpIndex],this.oCMP.ExecuteAllFormulas(),this.oCMP.CalculateNet()}}}}CalculateAccruals(t){let l=this.oCMP.arrLstOthMPFields[0].dsAllEmpsData.Tables[2];if(l=l.filter(a=>a.EmpSeqNo==t),l.length>0&&h.J0.ParseDate(l[0].cEffectFrom).getFullYear()==r.d.SessionManager.PayrollMonth.getFullYear()&&h.J0.ParseDate(l[0].cEffectFrom).iMonth()==r.d.SessionManager.PayrollMonth.iMonth()&&this.oCMP.lstAccrAccumulateSNos.length>0){let a="",i=0,o=0,d=0,m=0,C=0,g=0,y=0,p=0,e=0,u=-1;for(let k=0;k<this.oCMP.lstAccrAccumulateSNos.length;k++)a.length>0&&(a+=","),a+="ISNULL(dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[k]+",0) as dcCalcNum"+this.oCMP.lstAccrAccumulateSNos[k]+",ISNULL(dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[k]+",0) as dcCalcNumFC"+this.oCMP.lstAccrAccumulateSNos[k];let T=r.d.empService.GetQueryData(t,"PostCalculateAccural",JSON.stringify(a),r.d.SessionManager.PayrollMonth.ToString("dd MMM yyyy"),""),A=r.d.report.GetDataTable("PPVM02","");if(null!=T&&T.length>0){let k=!1;for(let x=0;x<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;x++)if(o=0,d=0,this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"Accruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour){u=this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].SNo,i=parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dActual);for(let F=0;F<T.length;F++)C=parseFloat(T[F].TotalDays),m=parseFloat(T[F].DaysAttended)+parseFloat(T[F].PaidLeaves)+parseFloat(T[F].LOPDays),g=parseFloat(T[F]["dcCalcNum"+u]),y=parseFloat(T[F]["dcCalcNumFC"+u]),p=parseFloat((m/C*i).ToString(r.d.SessionManager.sPayrollDecimals)),e=parseFloat((p-g).ToString(r.d.SessionManager.sPayrollDecimals)),o+=parseFloat(e.ToString(r.d.SessionManager.sPayrollDecimals)),d+=y;this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(o-d).ToString(r.d.SessionManager.sPayrollDecimals)}else this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(k=!0);if(k){for(let x=0;x<T.length;x++){let F=A.filter(f=>f.GradeID==parseInt(T[x].GradeID)&&f.CPayrollDate==h.J0.ParseDate(T[x].PayrollDate)).Compute("max","MaxSchemeID"),_=new it.O;if(_.oParent=this,_.sSelectedEmpSeqNos=t.toString(),_.PayrollMonth=r.d.SessionManager.PayrollMonth,_.PayrollMonthStart=r.d.SessionManager.PayrollMonthStart,_.PayrollMonthEnd=r.d.SessionManager.PayrollMonthEnd,_.drcArrStructure=F,_.IsCalculateAccruals=!0,_.ArrGradeID=parseInt(T[x].GradeID),_.ProcessPayroll(),_.IsCompleted){_.arrLstOthMPFields[0].TotalDays=parseFloat(T[x].TotalDays),_.arrLstOthMPFields[0].MonthDays=parseFloat(T[x].TotalDays),_.arrLstOthMPFields[0].PaidLeaves=parseFloat(T[x].PaidLeaves),_.arrLstOthMPFields[0].TotalLeaves=parseFloat(T[x].LeavesTaken),_.arrLstOthMPFields[0].WeeklyOffs=parseFloat(T[x].WOffs),_.arrLstOthMPFields[0].Holidays=parseFloat(T[x].Holidays),m=parseFloat(T[x].TotalDays.toString())-parseFloat(T[x].LOPDays.toString())-parseFloat(T[x].LeavesTaken.toString())-parseFloat(T[x].UnpaidDays.toString()),_.SetDaysAttended(0,"Days Attended",m);let f=0,E=-1,N=0,ae=0;for(let z=0;z<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;z++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][z].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][z].Behaviour)for(let W=0;W<_.arrLstCPFields[0][0].length;W++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][z].SNo==_.arrLstCPFields[0][0][W].SNo){N=0,ae=0,E=this.oCMP.arrLstCPFields[this.iEmpIndex][0][z].SNo,null!=T[x]["dcCalcNum"+E]&&null!=T[x]["dcCalcNum"+E]&&""!=T[x]["dcCalcNum"+E].toString()&&(N=parseFloat(T[x]["dcCalcNum"+E])),null!=T[x]["dcCalcNumFC"+E]&&null!=T[x]["dcCalcNumFC"+E]&&""!=T[x]["dcCalcNumFC"+E].toString()&&(ae=parseFloat(T[x]["dcCalcNumFC"+E])),f=parseFloat(_.arrLstCPFields[0][0][W].dEarned)-N,this.oCMP.arrLstCPFields[this.iEmpIndex][0][z].dPrevAccEar+=parseFloat(f.ToString(r.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][0][z].dPrevAccAdj+=ae;break}for(let z=0;z<this.oCMP.arrLstCPFields[2].length;z++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][z].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][z].Behaviour)for(let W=0;W<_.arrLstCPFields[0][2].length;W++)if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][z].SNo==_.arrLstCPFields[0][2][W].SNo){N=0,ae=0,E=this.oCMP.arrLstCPFields[this.iEmpIndex][2][z].SNo,null!=T[x]["dcCalcNum"+E]&&null!=T[x]["dcCalcNum"+E]&&""!=T[x]["dcCalcNum"+E].toString()&&(N=parseFloat(T[x]["dcCalcNum"+E])),null!=T[x]["dcCalcNumFC"+E]&&null!=T[x]["dcCalcNumFC"+E]&&""!=T[x]["dcCalcNumFC"+E].toString()&&(ae=parseFloat(T[x]["dcCalcNumFC"+E])),f=parseFloat(_.arrLstCPFields[0][2][W].dEarned)-N,this.oCMP.arrLstCPFields[this.iEmpIndex][2][z].dPrevAccEar+=parseFloat(f.ToString(r.d.SessionManager.sPayrollDecimals)),this.oCMP.arrLstCPFields[this.iEmpIndex][2][z].dPrevAccAdj+=ae;break}}}for(let x=0;x<this.oCMP.arrLstCPFields[0].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][0][x].dPrevAccAdj).ToString(r.d.SessionManager.sPayrollDecimals));for(let x=0;x<this.oCMP.arrLstCPFields[2].length;x++)this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].IsAccrualType&&"ReEvaluateAccruals-AccumulateForPreviousYears"==this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].Behaviour&&(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dAdjusted=(this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccEar-this.oCMP.arrLstCPFields[this.iEmpIndex][2][x].dPrevAccAdj).ToString(r.d.SessionManager.sPayrollDecimals))}}}}ValidatePosting(){try{return Logger.InfoLog("PostPayrollViewModel::Entering IsValidated()"),null!=r.d.SessionManager.Preferences.PayrollProduct&&""!=r.d.SessionManager.Preferences.PayrollProduct&&(this.DefProdID=parseInt(r.d.SessionManager.Preferences.PayrollProduct)),0==this.DefProdID?(this.strResult+="Select any Default Payroll Product at Global Preferences",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays<0?(this.strResult+="Days mismatch : Month days and Total days.",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP>0&&parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays.ToString("N1"))<parseFloat(this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP.ToString("N1"))?(this.strResult+="Employee Should have atleast "+this.oCMP.arrLstOthMPFields[this.iEmpIndex].dblLeavesLOP+" LOP Days",this.MessageVisibility=!0,!1):this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&("False"==r.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero||0==parseInt(r.d.SessionManager.Preferences.CreateLoanType))?(this.strResult+="Net Amount should be greater than or equal to zero.",this.MessageVisibility=!0,!1):(Logger.InfoLog("PostPayrollViewModel::Exiting IsValidated()"),!0)}catch(t){return Logger.ErrorLog("PostPayrollViewModel::EXCEPTION IsValidated()"+t.stack),!1}}SaveVoucher(){try{if(Logger.InfoLog("PostPayrollViewModel::Entering btnPost_Click()"),this.ValidatePosting()){let t=0,l=[];l.push(this.CostCenterID),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocID),l.push(r.d.SessionManager.PayrollMonth.ToString("MMM'/'yyyy")+"-"),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].DocNo),l.push(Date.Today().ToString("dd/MMM/yyyy")),l.push(r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")),l.push(""),l.push(this.GetDocumentXML()),l.push(""),l.push(""),l.push(""),l.push(this.GetActivityXML()),l.push("false"),r.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==r.d.SessionManager.Preferences.EnableLocationWise.toString()?l.push(r.d.SessionManager.LocationID>0?r.d.SessionManager.LocationID:1):l.push(0),r.d.SessionManager.Preferences.ContainsKey("EnableDivisionWise")&&"True"==r.d.SessionManager.Preferences.EnableDivisionWise.toString()?l.push(r.d.SessionManager.DivisionID>0?r.d.SessionManager.DivisionID:1):l.push(0),l.push(this.oCMP.arrLstOthMPFields[this.iEmpIndex].WID),l.push(r.d.SessionManager.RoleID),l.push(""),l.push(0),l.push(0),l.push(r.d.SessionManager.CompanyGUID),l.push(r.d.SessionManager.UserName),l.push(r.d.SessionManager.UserID),l.push(r.d.SessionManager.LanguageID),l.push(r.d.SessionManager.IsOffline);let a="",i="",o=r.d.document.SetTempInvDocumentPostPayroll(l);t=o.obj;let d=o;a=null!=d&&d.Tables.length>0&&d.Tables[d.Tables.length-1].length>0&&d.Tables[d.Tables.length-1].some(m=>m.hasOwnProperty("ErrorMessage"))?d.Tables[d.Tables.length-1][0].ErrorMessage.toString():"Problem in processing your request,Please contact administrator.",t>0?null!=d&&d.Tables.length>0&&d.Tables[d.Tables.length-1].length>0&&d.Tables[d.Tables.length-1].some(m=>m.hasOwnProperty("VoucherNo"))&&(i=d.Tables[d.Tables.length-1][0].VoucherNo.toString()):null!=d&&d.Tables.length>0&&d.Tables[d.Tables.length-1].length>0&&d.Tables[d.Tables.length-1].some(m=>m.hasOwnProperty("ServerMessage"))&&(this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++,t="-407"==d.Tables[d.Tables.length-1][0].ServerMessage.toString()?-407:-12345),this.strResult+=a,this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}else this.Failed+=this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpCode+",",this.FailedCount++;Logger.InfoLog("PostPayrollViewModel::Exiting btnPost_Click()")}catch(t){this.strResult+=t.message,Logger.ErrorLog("PostPayrollViewModel::EXCEPTION btnPost_Click()",t)}this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]].Result=this.strResult,this.EmployeesList.updateRow(this.EmployeesList.Table[this.lstSelectedEmps[this.iEmpIndex]])}GetDocumentXML(){let t,l="",a="",i="",o="",d="",m="",C=[],g=" dcAlpha1='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].BasicMonthly+"',dcAlpha3='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary+"',dcAlpha4='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalDays+"',dcAlpha5='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].DaysAttended+"',dcAlpha6='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].TotalLeaves+"',dcAlpha7='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].WeeklyOffs+"',dcAlpha8='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].Holidays+"',dcAlpha9='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].LOPDays+"',dcAlpha10='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].UnpaidDays+"', dcAlpha11='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarnings+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount)+"',dcAlpha12='"+(this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDeductions+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans)+"',dcAlpha13='0'";r.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==r.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?(g+=",dcAlpha14='"+this.objEmpFilter.PaymentModes.SelectedValue.toString()+"'",g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha15='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank.toString()+"',dcAlpha16='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo.toString()+"'":",dcAlpha15='',dcAlpha16=''"):(g+=",dcAlpha14='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()+"'","Bank Transfer"==h.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode)?g+=",dcAlpha15='"+h.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)+"',dcAlpha16='"+h.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].BankAccNo)+"'":g+=",dcAlpha15='',dcAlpha16=''"),g+=",dcAlpha17='"+r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+"',dcAlpha18='"+r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+"', dcAlpha19='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTHours+"',dcAlpha20='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totOTAmount+"', dcAlpha21='',dcAlpha22=''",g+=",dcAlpha23='' ",g+=",dcAlpha24='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].PaidLeaves+"' ",g+=",dcAlpha25='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActEarnings+"' ",g+=",dcAlpha26='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarArrears+"' ",g+=",dcAlpha27='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totEarAdjustments+"' ",g+=",dcAlpha28='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totActDeductions+"' ",g+=",dcAlpha29='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedArrears+"' ",g+=",dcAlpha30='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totDedAdjustments+"' ",g+=",dcAlpha31='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].totLoans+"' ",g+=",dcAlpha32='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths+"',dcAlpha33='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays+"' ",r.d.SessionManager.Preferences.ContainsKey("ShowPaymentModeselectionWhilePayrollProcessing")&&"True"==r.d.SessionManager.Preferences.ShowPaymentModeselectionWhilePayrollProcessing&&"Default"!=this.objEmpFilter.PaymentModes.SelectedValue?g+="Bank Transfer"==this.objEmpFilter.PaymentModes.SelectedValue?",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":",dcAlpha34=''":"Bank Transfer"==this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode.toString()?g+=",dcAlpha34='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].IBANNo.toString()+"'":g+=",dcAlpha34=''",g+=",dcAlpha35='"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].ActDaysAttended+"'",i+='<Alpha Query="',i+=g,d+=" ",d.length>0&&(i+=","+d),i+='" ></Alpha>',d="",o+='<CostCenters Query="',d+=" dcCCNID51="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",",d+=" dcCCNID53="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].GradeID+",",""==h.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)||"0"==h.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)||"Cash"==h.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].PaymentMode)?d+=" dcCCNID68=1,":d+=" dcCCNID68="+h.J0.String(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAllEmpsData[0].iBank)+",",C.push("dcCCNID51"),C.push("dcCCNID53"),C.push("dcCCNID68");let y="",p="";if(null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim.length>0)for(let e=0;e<Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0]).length;e++)y=Object.keys(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0])[e],p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcAsOnDim[0][y],y.Contains("CCNID")&&"CCNID51"!=y&&"CCNID53"!=y&&"CCNID68"!=y&&(d+=" dc"+y+"="+p+",",C.Contains("dc"+y)||C.push("dc"+y));if(d.length>0&&(o+=d),o+='" ></CostCenters>',a+='" ProductID="'+this.DefProdID+'" Quantity="0',a+='" Unit="1" UOMConversion="1" UOMConvertedQty="0',a+='" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0',a+='" StockValue="0" StockValueFC="0" RefNO="',a+='" BillDate="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),a+='" CurrencyID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].CurrencyID+'" ExchangeRate="1',a+='" DebitAccount="'+this.sDrAccount+'" CreditAccount="'+this.sCrAccount,a+='" CommonNarration="'+h.J0.EncodeXML("POSTED FROM POST PAYROLL"),this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="1" VoucherType="11',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Earning',m="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&11==e.VoucherType),null!=t&&t.length>0&&(m=t[0].InvDocDetailsID.toString())),l+=m.length>0?'" DocDetailsID="'+m:'" DocDetailsID="',l+=a.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][0].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo.toString()&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dActual.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dEarned.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dArrear.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][0][e].dAdjusted.Replace(",","")+",");if(this.oCMP.arrLstCPFields[this.iEmpIndex][1].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][1].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo.toString()&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dActual.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][1][e].dEarned.Replace(",","")+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="2" VoucherType="12',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Deduction',m="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&12==e.VoucherType),null!=t&&t.length>0&&(m=t[0].InvDocDetailsID.toString())),l+=m.length>0?'" DocDetailsID="'+m:'" DocDetailsID="',l+=a.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][2].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo.toString()&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dActual.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dEarned.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dArrear.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][2][e].dAdjusted.Replace(",","")+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="3" VoucherType="13',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Loan',m="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&13==e.VoucherType),null!=t&&t.length>0&&(m=t[0].InvDocDetailsID.toString())),l+=m.length>0?'" DocDetailsID="'+m:'" DocDetailsID="',l+=a.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo.toString()&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].IsVisible&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanActInstAmt.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanInstAmt.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanBalAmt.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][e].LoanPayStatus+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}if(this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0){if(l+="\x11",l+="<Row>",l+="<AccountsXML></AccountsXML>",l+='<Transactions DocSeqNo="4" VoucherType="14',l+='" LinkedInvDocDetailsID="0" LinkedFieldName="',l+='" LineNarration="Leave',m="",null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0&&(t=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[6].filter(e=>e.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&14==e.VoucherType),null!=t&&t.length>0&&(m=t[0].InvDocDetailsID.toString())),l+=m.length>0?'" DocDetailsID="'+m:'" DocDetailsID="',l+=a.toString()+'" ></Transactions>',d="",l+='<Numeric Query="',this.oCMP.arrLstCPFields[this.iEmpIndex][5].length>0)for(let e=0;e<this.oCMP.arrLstCPFields[this.iEmpIndex][5].length;e++)null!=this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo.toString()&&(d+=" dcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveTotOPBal.Replace(",","")+",",d+=" dcCalcNum"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].EncashLeavetaken.Replace(",","")+",",d+=" dcExchRT"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveMonOPBal.Replace(",","")+",",d+=" dcCalcNumFC"+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].SNo+"="+this.oCMP.arrLstCPFields[this.iEmpIndex][5][e].LeaveNetBal.Replace(",","")+",");d.length>0&&(l+=d),l+='" ></Numeric>',l+=i.toString(),l+=o.toString(),l+="<EXTRAXML></EXTRAXML>",l+="</Row>"}return l.toString()}GetActivityXML(){let i,t="",l="",a="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0)for(let d=0;d<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length;d++)t+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed[d].InvDocDetailsID.toString();let o="";if(o+=null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcPayProcessed.length>0?t.length>0?'<XML SysInfo="'+r.d.SessionManager.GetSysInfo()+'" AP="'+r.d.SessionManager.GetAccessPoint()+'" DetailIds="'+t+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':'<XML SysInfo="'+r.d.SessionManager.GetSysInfo()+'" AP="'+r.d.SessionManager.GetAccessPoint()+'" AppRejDate="'+(new Date).ToString("dd/MMM/yyyy")+'" >':t.length>0?'<XML SysInfo="'+r.d.SessionManager.GetSysInfo()+'" AP="'+r.d.SessionManager.GetAccessPoint()+'" DetailIds="'+t+'" >':'<XML SysInfo="'+r.d.SessionManager.GetSysInfo()+'" AP="'+r.d.SessionManager.GetAccessPoint()+'" >',this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].iExtLoansCnt>0){let d,m,C,g,y,e,p="0";if(l=a="",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>0&&(p=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[0].DocID.toString()),o+='<LoanRepaymentXML DocID="'+p+'" DocDetIDs="" WorkFlowID="0" >',o+="<DOCXML>",this.oCMP.arrLstCPFields[this.iEmpIndex][4].length>0){let u=0;null!=r.d.SessionManager.dtDocDefAccs&&(i=r.d.SessionManager.dtDocDefAccs.filter(T=>40057==T.CostCenterID&&"CreditAccount"==T.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=r.d.SessionManager.dtDocDefAccs.filter(T=>40057==T.CostCenterID&&"DebitAccount"==T.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(a=i[0].UserDefaultValue.toString()));for(let T=0;T<this.oCMP.arrLstCPFields[this.iEmpIndex][4].length;T++)if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].SNo&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].SNo.toString()&&1==this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].IsVisible&&null!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanInstAmt&&""!=this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanInstAmt.toString()){d=this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanDocNo,C=this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanActInstNo,y=3==parseInt(this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanPayStatus)?this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanActInstAmt.Replace(",",""):this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanInstAmt.Replace(",","");let A=parseInt(C);this.oCMP.arrLstOthMPFields[this.iEmpIndex].IsAlreadyProcessed?(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[11].filter(_=>_.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&_.RefNo==d&&h.J0.ParseDate(_.dcAlpha5)==r.d.SessionManager.PayrollMonth),null!=e&&e.length>0&&(A=parseInt(e[0].dcNum1))):(r.d.SessionManager.Preferences.ContainsKey("ShowLoanBalRespDedMonthWhilePayProc")&&"True"==r.d.SessionManager.Preferences.ShowLoanBalRespDedMonthWhilePayProc?(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(_=>_.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&_.RefNo==d&&_.InstallmentNo==A),e.SortBy([{name:"InstallmentNo",parser:parseInt}])):(e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(_=>_.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&_.DocNo==d&&_.InstBalance>0&&_.InstallmentNo<A),e.SortBy([{name:"InstallmentNo",parser:parseInt}])),null!=e&&e.length>0&&(A=parseInt(e[0].InstallmentNo)));let k=parseFloat(y),x=0,F=0;do{if(u++,e=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(_=>_.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&_.DocNo==d&&_.InstallmentNo==A),e.length>0)if(m=e[0].InvDocDetailsID.toString(),g=e[0].InstallmentAmt.toString().Replace(",",""),x=k>parseFloat(e[0].InstBalance)?parseFloat(e[0].InstBalance):k,o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="'+u+'"  DocDetailsID="0" LinkedInvDocDetailsID="'+m+'" LinkedFieldName="dcNum3" LineNarration="',o+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',o+='" Rate="0" Gross="0" RefNO="'+d+'" LinkedFieldValue="'+x+'" IsQtyIgnored="1" AverageRate="0',o+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+a+'"  CreditAccount="'+l+'"  ></Transactions>',o+='<Numeric Query="dcNum1='+A+", dcCalcNum1="+A+", dcNum2="+g.Replace(",","")+", dcCalcNum2="+g.Replace(",","")+", dcNum3="+x.toString().Replace(",","")+", dcCalcNum3="+x.toString().Replace(",","")+', " ></Numeric>',o+="<Alpha Query=\"dcAlpha1=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanApprovedAmt+"',dcAlpha2=N'"+(parseFloat(this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanBalAmt)-F)+"', dcAlpha3=N'"+y+"', dcAlpha4=N'"+h.J0.ParseDate(e[0].DeductionMonth).ToString("dd/MMM/yyyy")+"', dcAlpha5=N'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha6=N'1',dcAlpha7=N'"+this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].LoanPayStatus+"', \" ></Alpha>",o+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+this.oCMP.arrLstCPFields[this.iEmpIndex][4][T].ComponentID+', " ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>",F+=x,k-=x,e[0].Flag=1,r.d.SessionManager.Preferences.ContainsKey("DeductExcessLoanAmountfromLastInstallment")&&"True"==r.d.SessionManager.Preferences.DeductExcessLoanAmountfromLastInstallment){let _=this.oCMP.arrLstOthMPFields[this.iEmpIndex].dsAllEmpsData.Tables[10].filter(f=>f.EmpSeqNo==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo&&f.DocNo==d&&0==f.Flag&&f.InstBalance>0).Compute("max","InstallmentNo");null!=_&&null!=_&&(A=parseInt(_))}else A++;else k=0}while(k>0)}}o+="</DOCXML>",o+="<BillXML></BillXML></LoanRepaymentXML>"}if(this.chkPostBasedOnDailyAttendance.IsChecked&&r.d.SessionManager.Preferences.ContainsKey("CaputureDimensionData")&&"True"==r.d.SessionManager.Preferences.CaputureDimensionData.toString()){let y,d="",m="",C="",g="",p="";if(null!=this.oCMP&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length>0){C=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[0].DocID.toString();for(let u=0;u<this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData.length;u++)g+="~"+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcADWData[u].InvDocDetailsID.toString()}y=p="",null!=r.d.SessionManager.dtDocDefAccs&&(i=r.d.SessionManager.dtDocDefAccs.filter(u=>40079==u.CostCenterID&&"CreditAccount"==u.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(y=i[0].UserDefaultValue.toString()),i=r.d.SessionManager.dtDocDefAccs.filter(u=>40079==u.CostCenterID&&"DebitAccount"==u.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(p=i[0].UserDefaultValue.toString())),o+='<AttendanceDimensionwiseXML DocID="'+C+'" DocDetIDs="'+g+'" WorkFlowID="0" >',o+="<DOCXML>";let e=null;if(null!=this.dsDailyAttendanceData&&this.dsDailyAttendanceData.Tables.length>0&&(e=this.dsDailyAttendanceData.Tables[0].filter(u=>u.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo)),null!=e&&e.length>0){let A,k,x,F,u=[],T=[];T.push("EMPNODE");for(let f=0;f<this.dsDailyAttendanceData.Tables[3].length;f++)T.push(this.dsDailyAttendanceData.Tables[3][f].Data.toString());T.push("OT1"),T.push("OT2"),T.push("OT3"),T.push("OT4"),T.push("OT5"),T.push("DAYSATTENDED"),T.push("ABSENTDAYS"),T.push("Leaves"),T.push("TOTALOTAMOUNT");for(let f=0;f<e.length;f++)if(k=this.ApplyFilter(u,e[f]),null!=k&&k.length>0)for(let E=0;E<T.length;E++)T[E].startsWith("OT")&&(k[0][T[E]]=h.J0.SUMHoursAndMinutes(k[0][T[E]].toString(),e[f][T[E]].toString()));else{A={},A.EMPNODE=e[f].EMPNODE;for(let E=1;E<T.length;E++)A[T[E]]=e[f][T[E]];if(x=this.ApplyFilter(this.dsDailyAttendanceData.Tables[1],e[f]),null!=x&&x.length>0){if(F=this.ApplyFilter(this.dsDailyAttendanceData.Tables[2],e[f]),A.ABSENTDAYS=null!=F&&F.length>0?F[0].ABSENTDAYS:"0",null==this.dsDailyAttendanceData.Tables[4]||this.dsDailyAttendanceData.Columns[4].Contains("NODATA"))A.Leaves="0";else{let E=this.ApplyFilter(this.dsDailyAttendanceData.Tables[4],e[f]),N=0;if(null!=E&&E.length>0){let ae,z;N=0;for(let W=0;W<E.length;W++)ae=h.J0.ParseDate(E[W].FromDate),z=h.J0.ParseDate(E[W].ToDate),ae>=r.d.SessionManager.PayrollMonthStart?z<=r.d.SessionManager.PayrollMonthEnd?N+=parseFloat(E[W].Leaves):ae<=r.d.SessionManager.PayrollMonthEnd&&(N+=this.oCMP.GetNoOfDays(ae,r.d.SessionManager.PayrollMonthEnd,parseInt(E[W].ComponentID))):z<=r.d.SessionManager.PayrollMonthEnd?z>=r.d.SessionManager.PayrollMonthStart&&(N+=this.oCMP.GetNoOfDays(r.d.SessionManager.PayrollMonthStart,z,parseInt(E[W].ComponentID))):N+=this.oCMP.GetNoOfDays(r.d.SessionManager.PayrollMonthStart,r.d.SessionManager.PayrollMonthEnd,parseInt(E[W].ComponentID))}A.Leaves=N>0?N:"0"}A.DAYSATTENDED=parseFloat(x[0].DAYSATTENDED)-parseFloat(A.ABSENTDAYS),A.TOTALOTAMOUNT=x[0].TOTALOTAMOUNT}u.push(A)}let _="0";for(let f=0;f<u.length;f++){if(_="0",null!=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay.length>f&&(_=this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanRepay[f].InvDocDetailsID.toString()),d="",o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="'+f+'"  DocDetailsID="'+_+'" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="',o+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',o+='" Rate="0" Gross="0" RefNO="0" LinkedFieldValue="0" IsQtyIgnored="1" AverageRate="0',o+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+p+'"  CreditAccount="'+y+'"  ></Transactions>',o+='<Numeric Query="dcNum1='+h.J0.Double(u[f].TOTALOTAMOUNT)+", dcCalcNum1="+h.J0.Double(u[f].TOTALOTAMOUNT)+", ",o+="dcNum5="+h.J0.Double(u[f].OT1)+", dcCalcNum5="+h.J0.Double(u[f].OT1)+", ",o+="dcNum7="+h.J0.Double(u[f].OT2)+", dcCalcNum7="+h.J0.Double(u[f].OT2)+", ",o+="dcNum9="+h.J0.Double(u[f].OT3)+", dcCalcNum9="+h.J0.Double(u[f].OT3)+", ",o+="dcNum11="+h.J0.Double(u[f].OT4)+", dcCalcNum11="+h.J0.Double(u[f].OT4)+", ",o+="dcNum13="+h.J0.Double(u[f].OT5)+", dcCalcNum13="+h.J0.Double(u[f].OT5)+", ",o+='" ></Numeric>',o+="<Alpha Query=\"dcAlpha1=N'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"',dcAlpha2=N'"+h.J0.Double(u[f].DAYSATTENDED)+"', dcAlpha3=N'"+h.J0.Double(u[f].ABSENTDAYS)+"', dcAlpha4=N'"+h.J0.Double(u[f].Leaves)+"', \" ></Alpha>",o+='<CostCenters Query="',d+=" dcCCNID51="+h.J0.Int(u[f].EMPNODE)+",",this.dsDailyAttendanceData.Tables[3].length>0){m="";for(let E=0;E<this.dsDailyAttendanceData.Tables[3].length;E++)m=this.dsDailyAttendanceData.Tables[3][E].Data.toString(),d+=" "+m+"="+h.J0.Int(u[f][m])+","}d.length>0&&(o+=d),o+='" ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>"}}o+="</DOCXML>",o+="</AttendanceDimensionwiseXML>"}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.length>0){let d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";"),m=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjCalcMonthPaydays.split(";");if(d.length>0){o+="<AdjustmentsXML>",o+="<Rows>";for(let C=0;C<d.length;C++)o+='<Row PayrollMonth="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy"),o+='" EmpSeqNo="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo,o+='" AdjMonth="'+h.J0.ParseDate(d[C]).ToString("dd/MMM/yyyy"),o+='" Days="'+m[C].toString(),o+='" Remarks="',o+='" />';o+="</Rows>",o+="</AdjustmentsXML >"}}if(this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero.length>0&&(o+='<DelLoanXML DocID="'+this.oCMP.arrLstOthMPFields[this.iEmpIndex].drcLoanCrNetSalLessZero[0].DocID.toString()+'" > </DelLoanXML>'),l=a="",this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary<0&&"True"==r.d.SessionManager.Preferences.CreateLoanIfNetSalLessThanZero&&parseInt(r.d.SessionManager.Preferences.CreateLoanType)>0&&(null!=r.d.SessionManager.dtDocDefAccs&&(i=r.d.SessionManager.dtDocDefAccs.filter(d=>40056==d.CostCenterID&&"CreditAccount"==d.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(l=i[0].UserDefaultValue.toString()),i=r.d.SessionManager.dtDocDefAccs.filter(d=>40056==d.CostCenterID&&"DebitAccount"==d.SysColumnName),null!=i&&i.length>0&&null!=i[0].UserDefaultValue&&""!=i[0].UserDefaultValue.toString().Trim()&&(a=i[0].UserDefaultValue.toString())),o+='<CreateLoanXML DocID="" DocDetIDs="" WorkFlowID="0" >',o+="<DOCXML>",o+="<RowHead/>",o+="<Row>",o+="<AccountsXML></AccountsXML>",o+='<Transactions DocSeqNo="1"  DocDetailsID="0" LinkedInvDocDetailsID="0" LinkedFieldName="" LineNarration="" CommonNarration="LOAN CREATED FROM MONTHLY PAYROLL WHEN NET SALARY LESS THAN 0',o+='" ProductID="'+this.DefProdID+'" IsScheme="" Quantity="1" Unit="1" UOMConversion="1" UOMConvertedQty="1',o+='" Rate="0" Gross="0" RefNO="0" IsQtyIgnored="1" AverageRate="0',o+='" StockValue="0" StockValueFC="0" CurrencyID="1" ExchangeRate="1"  DebitAccount="'+a+'"  CreditAccount="'+l+'"  ></Transactions>',o+='<Numeric Query="dcNum1=1, dcCalcNum1=1, dcNum2='+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+", dcCalcNum2="+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+', " ></Numeric>',o+="<Alpha Query=\"dcAlpha6=N'"+r.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha1=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha2=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"', dcAlpha4=N'1', dcAlpha3=N'"+Math.abs(this.oCMP.arrLstOthMPFields[this.iEmpIndex].NetSalary)+"',dcAlpha5=N'"+r.d.SessionManager.PayrollMonth.AddMonths(1).ToString("dd/MMM/yyyy")+"',dcAlpha7=N'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"', \" ></Alpha>",o+='<CostCenters Query="dcCCNID51='+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+", dcCCNID52="+r.d.SessionManager.Preferences.CreateLoanType+', " ></CostCenters>',o+="<EXTRAXML></EXTRAXML>",o+="</Row>",o+="</DOCXML>",o+="<BillXML></BillXML></CreateLoanXML>"),this.oCMP.arrLstCPFields[0].length>0&&this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.length>0){let d=this.oCMP.arrLstOthMPFields[this.iEmpIndex].sAdjsCalcMonths.split(";");if(d.length>0){let m="";m+="    DELETE FROM PAY_EmpMonthlyArrAdjDetails WHERE EmpSeqNo="+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+" AND DType=2 AND PayrollMonth='"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"'";for(let C=0;C<d.length;C++){let g="",y="";m+="  INSERT INTO PAY_EmpMonthlyArrAdjDetails(EmpSeqNo,PayrollMonth,ArrAdjMonth,DType",g+="VALUES("+this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo+",'"+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+"','"+d[C].toString()+"',2";for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][0].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.length>0){let u=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.TrimEnd(","),u=this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].AdjData.split(","),null!=u&&u.length>0)for(let T=0;T<u.length;T+=2)h.J0.ParseDate(u[T]).ToString("dd MMM yyyy")==h.J0.ParseDate(d[C]).ToString("dd MMM yyyy")&&(e=u[T+1])}y+=",Earning"+this.oCMP.arrLstCPFields[this.iEmpIndex][0][p].SNo,g+=null!=e&&""!=e?","+e:",0"}for(let p=0;p<this.oCMP.arrLstCPFields[this.iEmpIndex][2].length;p++){let e="";if(null!=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData&&this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.length>0){let u=[];if(this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.TrimEnd(","),u=this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].AdjData.split(","),null!=u&&u.length>0)for(let T=0;T<u.length;T+=2)h.J0.ParseDate(u[T]).ToString("dd MMM yyyy")==h.J0.ParseDate(d[C]).ToString("dd MMM yyyy")&&(e=u[T+1])}y+=",Deduction"+this.oCMP.arrLstCPFields[this.iEmpIndex][2][p].SNo,g+=null!=e&&""!=e?","+e:",0"}m+=y+")",m+=g+")"}o+='<AdjustmentsDetailXML Query="'+m+'"></AdjustmentsDetailXML>'}}return o+="</XML>",o.toString()}ApplyFilter(t,l){let a=t.filter(i=>i.EMPNODE==this.oCMP.arrLstOthMPFields[this.iEmpIndex].EmpSeqNo);for(let i=0;i<this.dsDailyAttendanceData.Tables[3].length;i++){let o=this.dsDailyAttendanceData.Tables[3][i].Data.toString();a=a.filter(d=>d[o]==l[this.dsDailyAttendanceData.Tables[3][i].Data.toString()])}return a}ReportView(){this.ReportDimension=new ft.y$(0),this.ReportDimension.CCID=this.CostCenterID,this.ReportDimension.TypeID=1,this.ReportsList=[],this.ReportDimension.OnPactListBoxValueChanged.Subscribe(this,"OnReportsLinkClick");let t=[];this.dsData=r.d.common.GetDataSetQuery(" declare @UserID int,@RoleID int        set @UserID="+r.d.SessionManager.UserID+" set @RoleID="+r.d.SessionManager.RoleID+"    \n                     SELECT R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel,Q.Width ,Q.Height,Q.mapxml,Q.MapType\n                     FROM ADM_RevenUReports R  with(nolock)\n                     inner join ADM_DocumentReports Q WITH(NOLOCK) on Q.DocumentReportID=R.ReportID\n                     left join ADM_CostCenterDef A WITH(NOLOCK) on A.CostCenterColID=Q.DocumentField \n                     left join [ADM_DocReportUserRoleMap] DR WITH(NOLOCK) on DR.DocumentViewID=Q.DocumentViewID and DR.CostCenterID=Q.CostCenterID\n                     where  Q.CostCenterID="+this.CostCenterID+" and (DR.UserID=@UserID OR DR.RoleID=@RoleID OR GroupID IN (SELECT GroupID FROM COM_Groups WITH(NOLOCK) WHERE UserID=@UserID OR RoleID=@RoleID))\n                     GROUP BY  Q.ReportID, R.ReportID,Q.ReportName,Q.ReportField,Q.ReportFieldName,Q.DocumentField,Q.DocumentFieldName,A.SysColumnName,Q.Shortcut,Q.DisplayAsPopup,Q.GroupLevel ,Q.Width,Q.Height,Q.mapxml,Q.MapType \n                     order by Q.ReportID "),null!=this.dsData&&this.dsData.Tables[0].length>0&&this.dsData.Tables[0].forEach(a=>{let i=new Et.v;i.DBColumnID=parseInt(a.ReportID),i.Label=a.ReportName.toString(),this.dsData.Columns[0].Contains("Shortcut")&&(i.KeyTip=a.Shortcut.toString()),this.dsData.Columns[0].Contains("DisplayAsPopup")&&""!=a.DisplayAsPopup.toString()&&(i.Dependantinuse="1"==a.DisplayAsPopup.toString()),this.dsData.Columns[0].Contains("Width")&&""!=a.Width.toString()&&(i.Width=a.Width.toString()),this.dsData.Columns[0].Contains("Height")&&""!=a.Height.toString()&&(i.Length=a.Height.toString()),this.dsData.Columns[0].Contains("DocumentField")&&""!=a.DocumentField.toString()&&(i.Formula=a.DocumentField.toString()),this.dsData.Columns[0].Contains("mapxml")&&""!=a.mapxml.toString()&&(i.ToolTipDescription=a.mapxml.toString()),t.Contains(parseInt(a.ReportID))||(t.push(parseInt(a.ReportID)),this.ReportsList.push(i)),0==this.ReportsList.length&&(this.ButtonReport.Visible=!1)})}OnReportsLinkClick(t){var l=this;return(0,de.A)(function*(){const{ReportViewModel:a}=yield Promise.resolve().then(G.bind(G,39026)),{ReportViewComponent:i}=yield Promise.resolve().then(G.bind(G,31503));let m,o={strXML:""},d=new a;if(l.DisplayMessage=l.GetReportFilterXML(t,o),m=o.strXML,0==l.DisplayMessage.length){var C=l.ReportsList.find(g=>g.DBColumnID==parseInt(t));if(null!=C&&C.Dependantinuse)d.ReportViewModel_Document(l.CostCenterID,m,parseInt(t),!0,null,null),!h.J0.IsEmpty(C.Width)&&h.J0.Double(C.Width)>0&&(d.RptWidth=h.J0.Double(C.Width)),!h.J0.IsEmpty(C.length)&&h.J0.Double(C.length)>0&&(d.RptHeight=h.J0.Double(C.length)),d.DocumentObject=l,r.d.page.HideDialog(l.PopUpGUID),r.d.page.ShowDialog(d,i,{Title:"",HideClose:!0,ShowCenter:!0});else{let g=new a;g.ReportViewModel_Document(l.CostCenterID,m,parseInt(t),!1,null,null),g.DocumentObject=l,r.d.page.HideDialog(l.PopUpGUID),r.d.page.addNewTab({component:i,params:{obj:g}})}}})()}GetReportFilterXML(t,l){let a="";l.strXML="";let i=this.dsData.Tables[0];i=i.filter(m=>m.ReportID==t);let d,o=!1;i.forEach(m=>{(0,q.yG0)(m.GroupLevel)&&(o=!0)}),a+="<XML",o&&(a+=' GroupLevel="1"'),a+=" >";for(let m=0;m<i.length;m++)if(d=i[m].ReportField.toString(),a+="<Row ",a+='ColID ="'+d+'" ',!h.J0.IsEmpty(i[m].SysColumnName)){if("dcccnid51"==i[m].SysColumnName.toString().toLowerCase()){let C="";for(let g=0;g<this.EmployeesList.Table.length;g++)(0,q.yG0)(this.EmployeesList.Table[g].Select)&&(C+=this.EmployeesList.Table[g].EmpSeqNo.toString()+",");if(h.J0.IsEmpty(C)||!(C.length>0))return alert(this.ErrorMessage+"Employee '"),"Empty Value";C=C.substr(0,C.length-1),a+='Value ="'+C+'" '}else"duedate"==i[m].SysColumnName.toString().toLowerCase()?a+='Value ="'+r.d.SessionManager.PayrollMonth.ToString("dd/MMM/yyyy")+'" ':"dcalpha17"==i[m].SysColumnName.toString().toLowerCase()?a+='Value ="'+r.d.SessionManager.PayrollMonthStart.ToString("dd/MMM/yyyy")+'" ':"dcalpha18"==i[m].SysColumnName.toString().toLowerCase()&&(a+='Value ="'+r.d.SessionManager.PayrollMonthEnd.ToString("dd/MMM/yyyy")+'" ');a+=" />"}return a+="</XML>",l.strXML=a.toString(),""}}function na(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.Button_Click("Post"))}),s.nrm(1,"i",12),s.EFF(2,"Post"),s.k0s()}}let oa=(()=>{class L{constructor(){this.form=new v.gE({})}ngOnInit(){this.obj=this.params.obj}static{this.\u0275fac=function(a){return new(a||L)}}static{this.\u0275cmp=s.VBU({type:L,selectors:[["app-post-att-time-sheet-to-daily-att"]],standalone:!1,decls:36,vars:12,consts:[[2,"display","flex","position","relative","height","100%"],[2,"width","100%"],[1,"page-header"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],["class","secondary-btn-wicon",3,"click",4,"ngIf"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-broom"],[1,"fa-light","fa-filter"],[1,"fa-light","fa-file-export"],[1,"documentgrid","row","form-row",2,"padding","4px 12px","height","calc(100% - 50px)","width","100%"],[2,"width","100%","height","100%",3,"obj"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"]],template:function(a,i){1&a&&(s.j41(0,"div",0),s.EFF(1,"\n    "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"div",2),s.EFF(5,"\n            "),s.j41(6,"label",3),s.EFF(7),s.k0s(),s.EFF(8,"\n            "),s.j41(9,"div",4),s.EFF(10,"\n            "),s.DNE(11,na,3,0,"span",5),s.EFF(12,"\n            "),s.j41(13,"span",6),s.bIt("click",function(){return i.obj.Button_Click("Clear")}),s.nrm(14,"i",7),s.EFF(15),s.nI1(16,"translate"),s.k0s(),s.EFF(17,"\n            "),s.j41(18,"span",6),s.bIt("click",function(){return i.obj.Button_Click("Filter")}),s.nrm(19,"i",8),s.EFF(20),s.nI1(21,"translate"),s.k0s(),s.EFF(22,"\n            "),s.j41(23,"span",6),s.bIt("click",function(){return i.obj.Button_Click("Export")}),s.nrm(24,"i",9),s.EFF(25),s.nI1(26,"translate"),s.k0s(),s.EFF(27,"\n            "),s.k0s(),s.EFF(28,"\n        "),s.k0s(),s.EFF(29,"\n        "),s.j41(30,"div",10),s.EFF(31,"\n            "),s.nrm(32,"app-PactGridView",11),s.EFF(33,"  \n        "),s.k0s(),s.EFF(34,"\n   "),s.k0s(),s.EFF(35,"\n "),s.k0s()),2&a&&(s.R7$(7),s.JRh(i.obj.Title),s.R7$(4),s.Y8G("ngIf",i.obj.PostVisiblility),s.R7$(4),s.JRh(s.bMT(16,6,"Clear")),s.R7$(5),s.JRh(s.bMT(21,8,"Filter")),s.R7$(5),s.JRh(s.bMT(26,10,"lbl_Export")),s.R7$(7),s.Y8G("obj",i.obj.dgv))},dependencies:[xe.bT,st.X,qe.D9],encapsulation:2})}}return L})();var bt=G(66096),ct=G(61301),jt=G(30786);class Bt extends He.g{get SelectAll(){return this._SelectAll}set SelectAll(t){t!=this._SelectAll&&(this._SelectAll=t,this.SelectUnselectAll(t))}set RefreshGrid(t){}constructor(t){super(),this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this.DialogResult=!1,this.PostVisiblility=!0,this._SelectAll=!1,this.ChkBtnPostOnlyFirstAndLastTrans=new Ye.c,this.PostOnlyFirstInLastOut=!1,this.PostOnlyFirstInLastOutVisibility=!0,this.btnCancelFlag=!1,this.SelectUnCheck=0,this.dsEmps=null,this.sEmpSeqNosOnGrid="",this.sFilter="",this.iPostDocType=0,this.iEmpIndex=0,this.strResult="",this.Failed="",this.FailedCount=0,this.DefProdID=0;try{this.DisplayName=t,this.Title=t,this.DisplayMessage="",this.btnCancelFlag=!1,this.LoadGrid(),this.btnFilter_Click()}catch(l){Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION PostAttTimeSheetToDailyAttViewModel()",l)}}LoadGrid(){this.dgv=new n.vv,this.dgv.Height=0,this.dgv.SelectAll.Visible=!0,this.dgv.CanUserDeleteRows=!0,this.dgv.Table=[],this.dgv.TableColumns.push("Select"),this.dgv.TableColumns.push("SNo"),this.dgv.TableColumns.push("EmpSeqNo"),this.dgv.TableColumns.push("EmpCode"),this.dgv.TableColumns.push("EmpName"),this.dgv.TableColumns.push("VoucherNo"),this.dgv.TableColumns.push("CheckInDate"),this.dgv.TableColumns.push("CheckInTime"),this.dgv.TableColumns.push("CheckOutDate"),this.dgv.TableColumns.push("CheckOutTime"),this.dgv.TableColumns.push("TotalTime"),this.dgv.TableColumns.push("Result"),this.dgv.TableColumns.push("Row_Background"),this.dgv.TableColumns.push("InvDocDetailsID");let l,t=new B.O7;if(this.dgv.Columns=new Array,t=new B.O7,t.Header="Select",t.DisplayMember="Select",t.DataType="CheckBox",t.Width=50,t.CheckedChanged.Subscribe(this,"dgColSelect_CheckedChanged"),this.dgv.Columns.push(t),t=new B.O7,t.Header="#",t.DisplayMember="SNo",t.DataType="TextBlock",t.Width=40,t.ReadOnly=!0,this.dgv.Columns.push(t),t=new B.O7,t.Header="Employee Code",t.DisplayMember="EmpCode",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,this.dgv.Columns.push(t),t=new B.O7,t.Header="Employee Name",t.DisplayMember="EmpName",t.DataType="TextBlock",t.Width=220,t.ReadOnly=!0,this.dgv.Columns.push(t),t=new B.O7,t.Header="Voucher No.",t.DisplayMember="VoucherNo",t.DataType="LINK_VOUCHER",t.Width=180,t.ReadOnly=!0,this.dgv.Columns.push(t),t=new B.O7,t.Header="Check-in Date",t.DisplayMember="CheckInDate",t.DataType="TextBlock",t.Width=120,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),t=new B.O7,t.Header="Check-in Time",t.DisplayMember="CheckInTime",t.DataType="TextBlock",t.Width=120,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),t=new B.O7,t.Header="Check-out Date",t.DisplayMember="CheckOutDate",t.DataType="TextBlock",t.Width=120,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),t=new B.O7,t.Header="Check-out Time",t.DisplayMember="CheckOutTime",t.DataType="TextBlock",t.Width=120,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),t=new B.O7,t.Header="Total Time",t.DisplayMember="TotalTime",t.DataType="TextBlock",t.Width=100,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),t=new B.O7,t.Header="Result",t.DisplayMember="Result",t.DataType="TextBlock",t.Width=200,t.ReadOnly=!0,this.dgv.Columns.push(t),this.dsCols=r.d.common.GetDataSet("PAY062",""),null!=this.dsCols&&this.dsCols.Tables.length>0&&(l=this.dsCols.Tables[0].filter(a=>1==a.IsColumnInUse),null!=l&&l.length>0))for(let a=0;a<l.length;a++)t=new B.O7,t.Header=l[a].USERCOLUMNNAME.toString(),t.DisplayMember=l[a].SysColumnName.toString(),t.ID=l[a].SysColumnName.toString(),t.DataType="LISTBOX",t.CostCenterID=parseInt(l[a].ColumnCostCenterID),t.TypeID=parseInt(l[a].ColumnCCListViewTypeID),t.ReadOnly=!0,t.Width=120,this.dgv.Columns.push(t),this.dgv.TableColumns.push(t.DisplayMember),t=new B.O7,t.DisplayMember=l[a].SysColumnName.toString()+"_Key",t.IsVisible=!1,this.dgv.Columns.push(t),this.dgv.TableColumns.push(t.DisplayMember)}dgColSelect_CheckedChanged(t,l){l||1==this.SelectAll&&(this.SelectUnCheck=1,this.SelectAll=!1)}SelectUnselectAll(t){for(let l=0;l<this.dgv.Table.length;l++)0==this.SelectUnCheck&&(this.dgv.Table[l].Select=t);this.SelectUnCheck=0}Button_Click(t){"Post"==t.toString()?this.btnPost_Click():"Clear"==t.toString()?this.btnClear_Click():"Filter"==t.toString()?this.btnFilter_Click():"Export"==t.toString()&&this.Export_Click()}Export_Click(){}btnClear_Click(){this.dgv.Clear(),this.SelectAll=!1,this.FailedCount=0,this.Failed="",this.InProgress="",this.lstSelectedEmps=new Array}btnPost_Click(){if(this.ValidatePosting()){let l,a,t="",i=null;for(let o=0;o<this.objEmpFilter.DocumentsToLoad.Items.length;o++)if(i=null,1==this.objEmpFilter.DocumentsToLoad.Items[o].IsChecked)if("89"==this.objEmpFilter.DocumentsToLoad.Items[o].Value?r.d.SessionManager.Preferences.ContainsKey("PostAttendanceDataGroupBy")&&""!=r.d.SessionManager.Preferences.PostAttendanceDataGroupBy&&(i=r.d.SessionManager.Preferences.PostAttendanceDataGroupBy.toString().split(",")):"90"==this.objEmpFilter.DocumentsToLoad.Items[o].Value?r.d.SessionManager.Preferences.ContainsKey("PostTimeSheetDataGroupBy")&&""!=r.d.SessionManager.Preferences.PostTimeSheetDataGroupBy&&(i=r.d.SessionManager.Preferences.PostTimeSheetDataGroupBy.toString().split(",")):"103"==this.objEmpFilter.DocumentsToLoad.Items[o].Value&&r.d.SessionManager.Preferences.ContainsKey("PostAttendanceDataGroupBy")&&""!=r.d.SessionManager.Preferences.PostAttendanceDataGroupBy&&(i=r.d.SessionManager.Preferences.PostAttendanceDataGroupBy.toString().split(",")),null!=i){let d="";if(null!=this.dtData&&this.dtData.length>0){let C=this.dtData.filter(g=>g.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[o].Value);if(null!=C&&C.length>0)for(let g=0;g<C.length;g++)d.length>0&&(d+=","),d+=C[g].EmpSeqNo.toString()}let m=this.GetGroupByFilterEmployees(d);if(null!=m&&m.length>0){let C="";if(null!=i&&i.length>0){for(let g=0;g<i.length;g++)h.J0.IsEmptySpace(i[g])||(C.length>0&&(C+=","),C+="-1"==i[g]?"RptManager":"-2"==i[g]?"EmpSeqNo":"CCNID"+(parseInt(i[g])-5e4));if(C.length>0){let g=m.ToTable(!0,C.split(","));if(null!=g&&g.length>0){this.dgv.TableColumns.Contains("Flag")&&this.dgv.TableColumns.Remove("Flag"),this.dgv.TableColumns.push("Flag");for(let y=0;y<g.length;y++){let p=m;for(let e=0;e<Object.keys(g[0]).length;e++){let u=Object.keys(g[0])[e],T=g[0][u];p=p.filter(A=>A[u]==h.J0.String(T))}Object.keys(g[0]).length>0&&p.length>0&&ct.RibbonExtViewModel.GetDocumentObject(40067,"",!1,"PostAttTimeSheet").then(e=>{e.ScreenObject.GridData.Clear();let u=-1;for(let A=0;A<this.dgv.Table.length;A++)if((0,q.yG0)(this.dgv.Table[A].Select)&&(a=this.dtData.filter(k=>k.InvDocDetailsID==this.dgv.Table[0].InvDocDetailsID&&k.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[o].Value),null!=a&&a.length>0&&"1"!=h.J0.String(this.dgv.Table[A].Flag)&&p.filter(k=>k.EmpCode==a[0].EmpCode.toString()).length>0)){if(this.dgv.Table[A].Flag="1",u++,l=e.ScreenObject.GridDataObj.NewRow(),e.ScreenObject.GridDataObj.addRow(l),e.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(e.ScreenObject.GridData[u].dcCCNID51Code=a[0].EmpCode),e.ScreenObject.GridData[u].dcCCNID51_key=a[0].EmpSeqNo,e.ScreenObject.GridData[u].dcCCNID51=a[0].EmpName,e.FillDefaultProd(e.ScreenObject.GridData[u],"dcCCNID51"),e.ScreenObject.GridDataColumns.Contains("RefNo")&&(e.ScreenObject.GridData[u].RefNo=a[0].InvDocDetailsID),e.ScreenObject.GridData[u].dcAlpha1=h.J0.ParseDate(a[0].CheckInDate).ToString(r.d.SessionManager.Preferences["Date Format"]),e.ScreenObject.GridData[u].dcAlpha1_Key=h.J0.ParseDate(a[0].CheckInDate),e.Celleditend(e.ScreenObject.GridData[u],"dcCCNID51",0),e.ScreenObject.GridData[u].dcAlpha2=h.J0.ParseDate(a[0].CheckInTime).ToString("HH:mm"),e.ScreenObject.GridData[u].dcAlpha2_Key=h.J0.ParseDate(a[0].CheckInTime),e.ScreenObject.GridData[u].dcAlpha3=h.J0.ParseDate(a[0].CheckOutTime).ToString("HH:mm"),e.ScreenObject.GridData[u].dcAlpha3_Key=h.J0.ParseDate(a[0].CheckOutTime),e.Celleditend(e.ScreenObject.GridData[u],"dcAlpha3",40067),e.ScreenObject._CCFields.length>0)for(let k=0;k<e.ScreenObject._CCFields.length;k++)"DCCCNID51"!=e.ScreenObject._CCFields[k].DBColumnName.toUpperCase()&&(e.ScreenObject.GridDataColumns.Contains(e.ScreenObject._CCFields[k].DBColumnName+"_key")?e.ScreenObject.GridData[u][e.ScreenObject._CCFields[k].DBColumnName+"_key"]=a[0][e.ScreenObject._CCFields[k].DBColumnName].toString():(e.ScreenObject._CCFields[k]instanceof ft.y$||e.ScreenObject._CCFields[k]instanceof bt.G)&&(e.ScreenObject._CCFields[k].SelectedValue=parseInt(a[0][e.ScreenObject._CCFields[k].DBColumnName])));for(let k=0;k<e.ScreenObject.GridDataColumns.length;k++)e.ScreenObject.GridDataColumns[k].startsWith("dcCCNID")&&!e.ScreenObject.GridDataColumns[k].endsWith("_Key")&&!e.ScreenObject.GridDataColumns[k].endsWith("Code")&&"DCCCNID51"!=e.ScreenObject.GridDataColumns[k].toUpperCase()&&"DCCCNID73"!=e.ScreenObject.GridDataColumns[k].toUpperCase()&&(e.ScreenObject.GridData[u][e.ScreenObject.GridDataColumns[k]+"_Key"]=a[0][e.ScreenObject.GridDataColumns[k]]);e.CalculateTotals(e.ScreenObject.GridData[u],!1),e.ScreenObject.GridDataObj.updateRow(e.ScreenObject.GridData[u]),e.ScreenObject.GridDataObj.RefreshGrid=!0}h.J0.IsEmptySpace(t)||(e.DisplayMessage=t,e.MessageVisibility=!0),e.UpdateFooter=!0,e.RefreshGrid=!0,r.d.page.addNewTab({title:e.DisplayName,component:jt.AddEditDocumentComponent,params:{obj:e}});var T=e.ScreenObject._StaticFields.find(A=>"CommonNarration"==A.DBColumnName);null!=T&&(T.SetFocus=!0)})}}}}}}else{let d=this.dtData.filter(m=>m.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[o].Value);null!=d&&d.length>0&&ct.RibbonExtViewModel.GetDocumentObject(40067,"",!1,"PostAttTimeSheet").then(m=>{m.ScreenObject.GridData.Clear();let C=-1;for(let y=0;y<this.dgv.Table.length;y++)if((0,q.yG0)(this.dgv.Table[y].Select)&&(a=this.dtData.filter(p=>p.InvDocDetailsID==this.dgv.Table[y].InvDocDetailsID.toString()&&p.DocumentType==this.objEmpFilter.DocumentsToLoad.Items[o].Value),null!=a&&a.length>0)){if(C++,l=m.ScreenObject.GridDataObj.NewRow(),m.ScreenObject.GridDataObj.addRow(l),m.ScreenObject.GridDataColumns.Contains("dcCCNID51Code")&&(m.ScreenObject.GridData[C].dcCCNID51Code=a[0].EmpCode),m.ScreenObject.GridData[C].dcCCNID51_key=a[0].EmpSeqNo,m.ScreenObject.GridData[C].dcCCNID51=a[0].EmpName,m.FillDefaultProd(m.ScreenObject.GridData[C],"dcCCNID51"),m.ScreenObject.GridDataColumns.Contains("RefNo")&&(m.ScreenObject.GridData[C].RefNo=a[0].InvDocDetailsID),m.ScreenObject.GridData[C].dcAlpha1=h.J0.ParseDate(a[0].CheckInDate).ToString(r.d.SessionManager.Preferences["Date Format"]),m.ScreenObject.GridData[C].dcAlpha1_Key=h.J0.ParseDate(a[0].CheckInDate),m.Celleditend(m.ScreenObject.GridData[C],"dcCCNID51",0),m.ScreenObject.GridData[C].dcAlpha2=h.J0.ParseDate(a[0].CheckInTime).ToString("HH:mm"),m.ScreenObject.GridData[C].dcAlpha2_Key=h.J0.ParseDate(a[0].CheckInTime),m.ScreenObject.GridData[C].dcAlpha3=h.J0.ParseDate(a[0].CheckOutTime).ToString("HH:mm"),m.ScreenObject.GridData[C].dcAlpha3_Key=h.J0.ParseDate(a[0].CheckOutTime),m.Celleditend(m.ScreenObject.GridData[C],"dcAlpha3",40067),m.ScreenObject._CCFields.length>0)for(let p=0;p<m.ScreenObject._CCFields.length;p++)"DCCCNID51"!=m.ScreenObject._CCFields[p].DBColumnName.toUpperCase()&&(m.ScreenObject.GridDataColumns.Contains(m.ScreenObject._CCFields[p].DBColumnName+"_key")?m.ScreenObject.GridData[C][m.ScreenObject._CCFields[p].DBColumnName+"_key"]=a[0][m.ScreenObject._CCFields[p].DBColumnName].toString():(m.ScreenObject._CCFields[p]instanceof ft.y$||m.ScreenObject._CCFields[p]instanceof bt.G)&&(m.ScreenObject._CCFields[p].SelectedValue=parseInt(a[0][m.ScreenObject._CCFields[p].DBColumnName])));for(let p=0;p<m.ScreenObject.GridDataColumns.length;p++)m.ScreenObject.GridDataColumns[p].startsWith("dcCCNID")&&!m.ScreenObject.GridDataColumns[p].endsWith("_Key")&&"DCCCNID51"!=m.ScreenObject.GridDataColumns[p].toUpperCase()&&"DCCCNID73"!=m.ScreenObject.GridDataColumns[p].toUpperCase()&&(m.ScreenObject.GridData[C][m.ScreenObject.GridDataColumns[p]+"_Key"]=a[0][m.ScreenObject.GridDataColumns[p]]);m.CalculateTotals(m.ScreenObject.GridData[C],!1),m.ScreenObject.GridDataObj.updateRow(m.ScreenObject.GridData[C]),m.ScreenObject.GridDataObj.RefreshGrid=!0}h.J0.IsEmptySpace(t)||(m.DisplayMessage=t,m.MessageVisibility=!0),m.UpdateFooter=!0,m.RefreshGrid=!0,r.d.page.addNewTab({title:m.DisplayName,component:jt.AddEditDocumentComponent,params:{obj:m}});var g=m.ScreenObject._StaticFields.find(y=>"CommonNarration"==y.DBColumnName);g&&(g.SetFocus=!0)})}}}GetGroupByFilterEmployees(t){let l="  AND EmpSeqNo IN ("+t+")",a=[];return a.push(Date.Today().ToString("dd MMM yyyy")),a.push(l),a.push(0),a.push(r.d.SessionManager.RoleID),a.push(r.d.SessionManager.UserID),a.push(r.d.SessionManager.LanguageID),r.d.empService.GetData(a,"spPAY_GetEmpMasterCCDetails").Tables[0]}ValidatePosting(){try{Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering IsValidated()");{let t=0;for(let l=0;l<this.dgv.Table.length;l++)(0,q.yG0)(this.dgv.Table[l].Select)&&t++;if(0==t)return this.DisplayMessage="Select atleast one Document to post",!1;for(let l=0;l<this.dgv.Table.length;l++)if((0,q.yG0)(this.dgv.Table[l].Select)&&(null==this.dgv.Table[l].CheckInTime||null==this.dgv.Table[l].CheckInTime||""==this.dgv.Table[l].CheckInTime.toString()||null==this.dgv.Table[l].CheckOutTime||null==this.dgv.Table[l].CheckOutTime||""==this.dgv.Table[l].CheckOutTime.toString()))return this.DisplayMessage="CheckInTime/CheckOutTime is empty at Row No. : "+(l+1).toString(),!1}return Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Exiting IsValidated()"),!0}catch(t){return Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION IsValidated()"+t.stack),!1}}btnFilter_Click(){Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering Filter_Click()"),null==this.objEmpFilter?this.objEmpFilter=new Ze.t("",0,10):(this.objEmpFilter.Filter=10,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0?r.d.page.ShowDialog(this.objEmpFilter,St.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{this.btnFilter_Click_CallBack()}):this.btnFilter_Click_CallBack()}btnFilter_Click_CallBack(){if(this.DialogResult=this.objEmpFilter.IsCompleted,this.objEmpFilter.IsCompleted){if(this.sEmpSeqNosOnGrid="",this.objEmpFilter.CostCenterFilters.length>0){let l=1,a="",i="",o="";for(let d=0;d<this.objEmpFilter.CostCenterFilters.length;d++){let m=this.objEmpFilter.CostCenterFilters[d];if(m.CostCenterID>5e4&&(l=2,a="NodeID",i=50051==m.CostCenterID?"EmpSeqNo":"CCNID"+(m.CostCenterID-5e4)),m.SelectedNodes.length>0){if(1==m.SelectedNodes.length)o+=" AND ",o+=i+"="+m.SelectedNodes[0].Id;else if(!m.SelectedNodes.find(C=>C.Id==l&&C.IsGroup))if(o+=" AND ",It.IPrefetchFilter.IsGroupTree(m)){let C="";for(let g=0;g<m.SelectedNodes.length;g++)(null==m.SelectedNodes[g].Parent||!m.SelectedNodes[g].Parent.IsSelected)&&(C.length>0&&(C+=","),C+=m.SelectedNodes[g].Id);0==C.length&&(C+=-12912),o+=i+" IN ",o+=" (select T."+a+" GTID from "+rt.A.GetTagTableName(m.CostCenterID)+" T with(nolock),"+rt.A.GetTagTableName(m.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+a+" IN (",o+=C.toString()+")  group by T."+a+")"}else{o+=i+" IN (";for(let C=0;C<m.SelectedNodes.length;C++)C>0&&(o+=","),o+=m.SelectedNodes[C].Id;o+=")"}}else m.DeleteButtonVisibility||(o+=" AND ",o+=i+"=-12912")}this.sFilter=o.toString()}this.FilterEmployees()}}FilterEmployees(){this.sEmpSeqNosOnGrid="",this.objEmpFilter.rBtnPostAttDocs?this.iPostDocType=89:this.objEmpFilter.rBtnPostTimeSheetDocs?this.iPostDocType=90:this.objEmpFilter.rBtnPostOnDutyDocs&&(this.iPostDocType=103),this.iPostDocType=this.objEmpFilter.rBtnPostAttDocs?89:90,this.ChkBtnPostOnlyFirstAndLastTrans.Visible=90==this.iPostDocType,this.ChkBtnPostOnlyFirstAndLastTrans.Visible=!1;try{r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),h.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Entering FilterEmployees()");let l=[];l.push(Date.Today().ToString("dd MMM yyyy")),l.push(this.sFilter),l.push(0),l.push(r.d.SessionManager.RoleID),l.push(r.d.SessionManager.UserID),l.push(r.d.SessionManager.LanguageID);let a=r.d.empService.GetData(l,"spPAY_GetEmpMasterCCDetails"),i="";if(this.dgv.Clear(),null!=a&&a.Tables.length>0&&a.Tables[0].length>0){for(let d=0;d<a.Tables[0].length;d++)i.Trim().length>0&&(i+=","),i+=a.Tables[0][d].EmpSeqNo.toString();var t;let o="";for(let d=0;d<this.objEmpFilter.DocumentsToLoad.Items.length;d++)1==this.objEmpFilter.DocumentsToLoad.Items[d].IsChecked&&(o.Trim().length>0&&(o+=","),o+=this.objEmpFilter.DocumentsToLoad.Items[d].Value);if(t=r.d.common.GetDataSet3("PAY117",o,i,this.objEmpFilter.FromDatePicker.Date.ToString("dd/MMM/yyyy")+"~"+this.objEmpFilter.ToDatePicker.Date.ToString("dd/MMM/yyyy")),this.dtData=t.Tables[0],!(null!=t&&t.Tables.length>0&&t.Tables[0].length>0))return void(this.DisplayMessage="No documents found for the selected Employees.");{let d;for(let m=0;m<t.Tables[0].length;m++){d=this.dgv.NewRow(),d.Select=!1,d.SNo=(m+1).toString(),this.sEmpSeqNosOnGrid.length>0&&(this.sEmpSeqNosOnGrid+=","),this.sEmpSeqNosOnGrid+=t.Tables[0][m].EmpSeqNo.toString(),d.EmpSeqNo=t.Tables[0][m].EmpSeqNo,d.EmpCode=t.Tables[0][m].EmpCode,d.EmpName=t.Tables[0][m].EmpName,d.InvDocDetailsID=t.Tables[0][m].InvDocDetailsID,d.VoucherNo=t.Tables[0][m].VoucherNo,d.CheckInDate=t.Tables[0][m].CheckInDate,h.J0.IsEmptySpace(t.Tables[0][m].CheckInTime)||(d.CheckInTime=h.J0.ParseDate(t.Tables[0][m].CheckInTime).ToString("HH:mm")),h.J0.IsEmptySpace(t.Tables[0][m].CheckOutDate)?d.Row_Background="#F77B7E":d.CheckOutDate=t.Tables[0][m].CheckOutDate,h.J0.IsEmptySpace(t.Tables[0][m].CheckOutTime)||(d.CheckOutTime=h.J0.ParseDate(t.Tables[0][m].CheckOutTime).ToString("HH:mm")),d.TotalTime=h.J0.IsEmptySpace(t.Tables[0][m].TotalTime)?"0.00":t.Tables[0][m].TotalTime,0==parseFloat(d.TotalTime.toString().Replace(":","."))&&(d.Row_Background="#F77B7E");for(let C=0;C<this.dgv.TableColumns.length;C++)this.dgv.TableColumns[C].startsWith("dcCCNID")&&!this.dgv.TableColumns[C].endsWith("_Key")&&(d[this.dgv.TableColumns[C]+"_Key"]=t.Tables[0][m][this.dgv.TableColumns[C]]);this.dgv.addRow(d)}this.dgv.refreshDataView()}}Logger.InfoLog("PostAttTimeSheetToDailyAttViewModel::Exiting FilterEmployees()")}catch(l){Logger.ErrorLog("PostAttTimeSheetToDailyAttViewModel::EXCEPTION FilterEmployees()"+l.stack)}}}var Wt=G(73986);const ra=()=>({standalone:!0});let da=(()=>{class L{constructor(){this.form=new v.gE({})}ngOnInit(){this.obj=this.params.obj}static{this.\u0275fac=function(a){return new(a||L)}}static{this.\u0275cmp=s.VBU({type:L,selectors:[["app-payslip"]],standalone:!1,decls:71,vars:28,consts:[[1,"maincontainer"],[1,"page-header"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group",2,"margin-right","6px"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-eye"],[1,"fa-light","fa-print"],[1,"fa-light","fa-file-export"],[1,"fa-light","fa-envelope"],[1,"fa-light","fa-filter"],[1,"main_div"],[2,"padding","11px"],[1,"row","form-row"],[1,"form-group","col-md-3","col-sm-6","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"form-group","col-xl-3","col-md-4","col-sm-6","col-xs-12","divChk",2,"align-content","center"],["type","checkbox",3,"ngModelChange","ngModel","ngModelOptions"],[3,"click"],[1,"documentgrid","row","form-row",2,"padding","4px 12px","height","calc(100% - 50px)","width","100%"]],template:function(a,i){1&a&&(s.j41(0,"div",0),s.EFF(1,"\n        "),s.j41(2,"div",1),s.EFF(3,"\n            "),s.j41(4,"span",2),s.EFF(5),s.k0s(),s.EFF(6,"\n            "),s.j41(7,"div",3),s.EFF(8,"\n                "),s.j41(9,"span",4),s.bIt("click",function(){return i.obj.Button_Click("Preview")}),s.nrm(10,"i",5),s.EFF(11),s.nI1(12,"translate"),s.k0s(),s.EFF(13," \n                "),s.j41(14,"span",4),s.bIt("click",function(){return i.obj.Button_Click("Print")}),s.nrm(15,"i",6),s.EFF(16),s.nI1(17,"translate"),s.k0s(),s.EFF(18," \n                "),s.j41(19,"span",4),s.bIt("click",function(){return i.obj.Button_Click("Export")}),s.nrm(20,"i",7),s.EFF(21),s.nI1(22,"translate"),s.k0s(),s.EFF(23,"\n                "),s.j41(24,"span",4),s.bIt("click",function(){return i.obj.Button_Click("EMail")}),s.nrm(25,"i",8),s.EFF(26),s.nI1(27,"translate"),s.k0s(),s.EFF(28,"\n                "),s.j41(29,"span",4),s.bIt("click",function(){return i.obj.Button_Click("Filter")}),s.nrm(30,"i",9),s.EFF(31),s.nI1(32,"translate"),s.k0s(),s.EFF(33,"\n            "),s.k0s(),s.EFF(34,"\n        "),s.k0s(),s.EFF(35,"\n"),s.j41(36,"div",10),s.EFF(37,"\n    "),s.j41(38,"div",11),s.EFF(39,"          \n        "),s.j41(40,"div",12),s.EFF(41,"\n            "),s.j41(42,"div",13),s.EFF(43,"\n                "),s.eu8(44,14),s.EFF(45,"\n            "),s.k0s(),s.EFF(46,"\n            "),s.j41(47,"div",13),s.EFF(48,"\n                "),s.eu8(49,14),s.EFF(50,"\n            "),s.k0s(),s.EFF(51,"\n            "),s.j41(52,"div",13),s.EFF(53,"\n                "),s.eu8(54,14),s.EFF(55,"\n            "),s.k0s(),s.EFF(56,"\n                "),s.j41(57,"div",15),s.EFF(58,"\n                  "),s.j41(59,"input",16),s.mxI("ngModelChange",function(d){return s.DH7(i.obj.ExportSeperate,d)||(i.obj.ExportSeperate=d),d}),s.k0s(),s.EFF(60,"\n                  "),s.j41(61,"label",17),s.bIt("click",function(){return i.obj.ExportSeperate=!i.obj.ExportSeperate}),s.EFF(62),s.nI1(63,"translate"),s.k0s(),s.EFF(64,"\n              "),s.k0s(),s.EFF(65,"              \n    "),s.k0s(),s.EFF(66,"\n\n    "),s.j41(67,"div",18),s.EFF(68,"\n        \n    "),s.k0s(),s.EFF(69,"\n"),s.k0s(),s.EFF(70,"\n "),s.k0s()()),2&a&&(s.R7$(5),s.JRh(i.obj.Title),s.R7$(6),s.JRh(s.bMT(12,15,"Preview")),s.R7$(5),s.JRh(s.bMT(17,17,"Print")),s.R7$(5),s.JRh(s.bMT(22,19,"Export")),s.R7$(5),s.JRh(s.bMT(27,21,"EMail")),s.R7$(5),s.JRh(s.bMT(32,23,"Filter")),s.R7$(13),s.Y8G("obj",i.obj.dtpPayrollMonth)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.cmbPayslipLayout)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.cmbSortOn)("group",i.form),s.R7$(5),s.R50("ngModel",i.obj.ExportSeperate),s.Y8G("ngModelOptions",s.lJ4(27,ra)),s.R7$(3),s.JRh(s.bMT(63,25,"Export Each Employee Seperately")))},dependencies:[$e._,v.Zm,v.BC,v.vS,qe.D9],encapsulation:2})}}return L})();var ha=G(43311),Nt=G(24517),Jt=G(48800),Rt=G(12002);class Q{constructor(){this.EmpCode="",this.EmpName="",this.EmpAliasName="",this.Gender="",this.CodePrefix="",this.ParentName="",this.CCMapXML="",this.HistoryXML="",this.PayQuery="",this.CustomFieldsQuery="",this.CustomCostCenterFieldsQuery="",this.NotesXML="",this.ContactsXML="",this.AddressXML="",this.AttachmetsXML="",this.AccLinkXML="",this.PrimaryContactQuery="",this.StaticFieldsQuery="",this.CompanyGUID="",this.GUID="",this.UserName="",this.DocumentsXML="",this.EmpYear="",this.Regime="",this.RotationalLeave="",this.NodeID=0,this.CodeNumber=0,this.StatusID=0,this.EmpTypeID=0,this.ParentID=0,this.CurrencyID=0,this.SelectedNodeID=0,this.ProbationDays=0,this.RptManager=0,this.UserId=0,this.LanguageId=0,this.GroupSeqNoLength=0,this.WID=0,this.IsGroup=!1,this.IDHistoryXML="",this.PaymentModeXML=""}}var ie=G(84151),c=G(17970),D=G(66471),M=G(54253),P=G(67557);class b extends He.g{get CCID(){return this.CostCenterID}set CCID(t){this.CostCenterID=t}get dtPayrollTaxCmpts(){return this.dtPayrollTaxCmptsObj.Table}get PayrollColumnSourceTaxComponents(){return this.dtPayrollTaxCmptsObj.Columns}get lFinancialDate(){return this._lFinancialDate}set lFinancialDate(t){t!=this._lFinancialDate&&(this._lFinancialDate=t)}get ScreenObject(){return this._ScreenObject}set ScreenObject(t){this._ScreenObject=t}constructor(){super(),this.CostCenterID=0,this.TypeID=0,this.AttachmentVisibility=!1,this.Employee=new bt.G(0),this.AttachVisiblility=!1,this.PayrollTaxFields=new Array,this.dtPayrollTaxCmptsObj=new n.vv,this.Savereturnvalue=-1,this.oRadio1=null,this.dsTaxComponents=null,this.CostCenterID=262,this.objEmp=new Q,this.ScreenObject=new P.a(0,0),this.ScreenObject.Data=[],this.ViewAttachments=new Rt.ViewAttachmentViewModel(this),this.OnAddAttachment(),this.AttachVisiblility=r.d.SessionManager.IsActionAssigned(262,"Attach"),this.EmpYear=new te.y$(0),this.EmpYear.LblWidth="60",this.EmpYear.Label=r.d.GetResource("Doc_Year"),this.EmpYear.SelectionChangedCommand.Subscribe(this,"OnYearSelected");for(let t=2e3;t<2100;t++){let l=te._p.ComboBoxItems_2(t.toString(),t.toString());this.EmpYear.Items.push(l)}this.EmpYear.SelectedValue=h.J0.ParseDate(r.d.SessionManager.PayrollMonth).ToString("yyyy"),this.EmpRegime=new te.y$(0),this.EmpRegime.Items.push(te._p.ComboBoxItems_2("Old","Old")),this.EmpRegime.Items.push(te._p.ComboBoxItems_2("New","New")),this.EmpRegime.Label="Regime Opted For",this.lFinancialDate=this.GetFinancialYear(),this.Employee.Visible=!0,this.Employee.Code.TypeID=4,this.Employee.Name.TypeID=1,this.Employee.Code.Visible=this.Employee.Name.Visible=!1,this.Employee.Code.Column=0,this.Employee.Name.Column=1,this.Employee.Code.Visible=!0,this.Employee.Name.Visible=!0,this.Employee.Code.CCID=this.Employee.Name.CCID=50051,this.Employee.LblWidth="80",this.EmpRegime.LblWidth="80",this.Employee.Label=r.d.GetResource("Pay_Employee"),this.Employee.Code.Visible&&(this.Employee.Code.CCID=50051,this.Employee.Code.TypeID=4),this.Employee.Name.Visible&&(this.Employee.Name.CCID=50051,this.Employee.Name.TypeID=1),this.FilterEmployees(),this.Employee.SelectionCallBack.Subscribe(this,"Employee_SelectedValueChanged"),this.dtPayrollTaxCmptsObj.Table=[],this.dtPayrollTaxCmptsObj.Columns=new Array,this.dtPayrollTaxCmptsObj.Height=110,this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields),this.BindHRAGridColumns()}BindHRAGridColumns(){this.PayrollColumnSourceTaxComponents.Clear(),this.dtPayrollTaxCmptsObj.Clear();let t=new B.O7;t.Header="FromDate",t.DisplayMember="ITFromDate",t.ValueMember="ITFromDate_Key",t.DataType="DATE",t.ReadOnly=!1,t.Width=85,this.PayrollColumnSourceTaxComponents.push(t),t=new B.O7,t.Header="ToDate",t.DisplayMember="ITToDate",t.ValueMember="ITToDate_Key",t.DataType="DATE",t.ReadOnly=!1,t.Width=85,this.PayrollColumnSourceTaxComponents.push(t),t=new B.O7,t.Header="Amount",t.DisplayMember="Amount",t.DataType="TextBlock",t.ReadOnly=!1,t.Width=75,this.PayrollColumnSourceTaxComponents.push(t),t=new B.O7,t.Header="Metro",t.ValueBinding="Metro",t.DataType="ComboBox",t.DisplayMember="Name",t.ValueMember="Value",t.Width=60;let l=[];l.push(te._p.ComboBoxItems_2("Yes","Yes")),l.push(te._p.ComboBoxItems_2("No","No")),t.ComboData=l,this.PayrollColumnSourceTaxComponents.push(t),t=new B.O7,t.Header="HRAAddress",t.DisplayMember="HRAAddress",t.DataType="TextArea",t.ReadOnly=!1,t.Width=200,this.PayrollColumnSourceTaxComponents.push(t),t=new B.O7,t.Header="Name of Landlord",t.DisplayMember="NameofLandlord",t.DataType="TextBlock",t.ReadOnly=!1,t.Width=153,this.PayrollColumnSourceTaxComponents.push(t),t=new B.O7,t.Header="Pan of Landlord",t.DisplayMember="PanofLandlord",t.DataType="TextBlock",t.ReadOnly=!1,t.Width=150,this.PayrollColumnSourceTaxComponents.push(t),this.dtPayrollTaxCmptsObj.RefreshGridView()}Employee_SelectedValueChanged(t){""!=this.EmpYear.SelectedValue.toString()?(this.EmpRegime.SelectedValue="",this.PayrollTaxFields.Clear(),this.dtPayrollTaxCmptsObj.Clear(),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsListObj.Clear(),this.ViewAttachments=new Rt.ViewAttachmentViewModel(this),this.OnAddAttachment(),this.GenerateTaxComponentFields(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.PayrollTaxFields)):this.DisplayMessage="Please select the Year"}OnYearSelected(t){this.Employee.SelectedValue=0,this.EmpRegime.SelectedValue="",this.lFinancialDate=this.GetFinancialYear(),this.FilterEmployees(),this.dtPayrollTaxCmptsObj.Columns.Clear(),this.PayrollTaxFields.Clear(),this.dtPayrollTaxCmptsObj.Clear(),this.Employee.SelectedValue>0?this.GenerateTaxComponentFields(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.PayrollTaxFields):this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields)}GetFinancialYear(){let t="",l=new Date(parseInt(this.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth,1),a=l.AddYears(1).AddMonths(-1);return t=this.ScreenObject.GetMonthName(l.getMonth(),!1)+" "+l.getFullYear()+" - "+this.ScreenObject.GetMonthName(a.getMonth(),!1)+" "+a.getFullYear(),t}OnComponentSelection(t){let l="",a="";this.PayrollTaxFields.forEach(i=>{if(i instanceof c.mn){let o=i;if(a=o.Currency.SelectedValue,null!=a){let d=this.dsTaxComponents.Tables[0].filter(m=>"ComboTextValue"==m.ControlType&&m.NodeID==parseInt(a));for(let m=0;m<d.length;m++){let C=d[m];"COMBOTEXTVALUE"===(l=h.J0.String(C.ControlType),l)&&(o.Label=h.J0.String(C.AmountLimit))}}}})}GenerateTaxComponentFields(t,l,a){try{Logger.InfoLog("VoucherGenerator:: Inside GenerateCustomFields");let o,d,i=0,m=null,C=null;if(null===l&&(l=0),0!=t&&0!=l&&(m=r.d.common.GetDataSet3("PAY071",t.toString(),l.toString())),null!=m&&m.Tables.length>0&&m.Tables[0].length>0&&!h.J0.IsEmpty(m.Tables[0][0].SEQNO)&&(C=r.d.common.GetDataSet("PAY072",m.Tables[0][0].SEQNO.toString())),this.dsTaxComponents=r.d.empService.GetIncomeTaxComponents(0,t,l),this.dsTaxComponents.Tables[0].length>0&&this.dsTaxComponents.Columns[0].Contains("ITComponentsValidationMessage")&&!h.J0.IsEmpty(this.dsTaxComponents.Tables[0][0].ITComponentsValidationMessage))return void(this.DisplayMessage=this.dsTaxComponents.Tables[0][0].ITComponentsValidationMessage.toString());let g=this.dsTaxComponents.Tables[0];if(g.forEach(y=>{switch(o=h.J0.String(y.CONTROLTYPE).toUpperCase(),o){case"LABEL":d=new D.D,d.Label=h.J0.String(y.NAME),a.push(d),d.tabname="LABEL";break;case"TEXTBOX":this.LabelLimitAmount=h.J0.String(y.AMOUNTLIMIT),this.oText=new ie.Dw(parseInt(y.NODEID)),this.oText.Label=h.J0.String(y.NAME),this.oText.KeyTip=this.LabelLimitAmount,this.oText.Text=y.AMOUNT.toString(),this.oText.LblWidth="400",this.oText.tabname="TEXTBOX",a.push(this.oText);break;case"COMBOTEXTVALUE":let e=g.filter(u=>"ComboTextValue"==u.CONTROLTYPE&&u.GROUPID==parseInt(y.GROUPID));var p=a.find(u=>u instanceof c.mn&&u.DBColumnID==parseInt(y.GROUPID));null==p?(this.oRadio1=new c.mn,this.oRadio1.DBColumnID=parseInt(y.GROUPID)):this.oRadio1=p,this.oRadio1.tabname="COMBOTEXTVALUE",this.oRadio1.LblWidth="1",(0==i||i!=parseInt(y.GROUPID))&&e.length>0&&(e.forEach(u=>{this.oRadio1.Currency.Items.push(te._p.ComboBoxItems_2(h.J0.String(u.NAME).TrimStart(" "),h.J0.String(u.NODEID)))}),this.oRadio1.Currency.SelectedValue=this.oRadio1.Currency.Items[0].Value,this.oRadio1.Currency.SelectionChangedCommand.Subscribe(this,"OnComponentSelection"),a.push(this.oRadio1)),parseInt(y.SELECTEDNODE)>0?(this.oRadio1.Currency.SelectedValue=h.J0.String(y.SELECTEDNODE),this.oRadio1.ExchangeRate.Text=y.AMOUNT.toString(),this.oRadio1.Label=y.SELECTEDAMTLIMIT.toString()):""==this.oRadio1.ExchangeRate.Text&&(this.oRadio1.ExchangeRate.Text=y.AMOUNT.toString()),null==this.oRadio1.Label&&(this.LabelLimitAmount=h.J0.String(y.AMOUNTLIMIT),this.oRadio1.Label=this.LabelLimitAmount),(0==i||i!=parseInt(y.GROUPID))&&(i=parseInt(y.GROUPID))}}),null!=this.dsTaxComponents&&this.dsTaxComponents.Tables.length>2&&this.dsTaxComponents.Tables[2].length>0&&this.dsTaxComponents.Columns[2].Contains("RegimeType")&&null!=this.dsTaxComponents.Tables[2][0].RegimeType&&null!=this.dsTaxComponents.Tables[2][0].RegimeType&&""!=this.dsTaxComponents.Tables[2][0].RegimeType.toString()&&(this.EmpRegime.SelectedValue=this.dsTaxComponents.Tables[2][0].RegimeType.toString()),null!=this.dsTaxComponents&&this.dsTaxComponents.Tables.length>1&&this.dsTaxComponents.Tables[1].length>0){let p;for(let e=0;e<this.dsTaxComponents.Tables[1].length;e++)p=this.dtPayrollTaxCmptsObj.NewRow(),p.ITFromDate=h.J0.ParseDate(this.dsTaxComponents.Tables[1][e].FromDate).ToString("MMM/yyyy"),p.ITFromDate_Key=h.J0.ParseDate(this.dsTaxComponents.Tables[1][e].FromDate).ToString("dd-MMM-yyyy"),p.ITToDate=h.J0.ParseDate(this.dsTaxComponents.Tables[1][e].ToDate).ToString("MMM/yyyy"),p.ITToDate_Key=h.J0.ParseDate(this.dsTaxComponents.Tables[1][e].ToDate).ToString("dd-MMM-yyyy"),p.Amount=this.dsTaxComponents.Tables[1][e].Amount.toString(),p.Metro=this.dsTaxComponents.Tables[1][e].Metro.toString().TrimEnd(),p.HRAAddress=this.dsTaxComponents.Tables[1][e].Address.toString(),p.NameofLandlord=this.dsTaxComponents.Tables[1][e].Landlord.toString(),p.PanofLandlord=this.dsTaxComponents.Tables[1][e].LandlordPAN.toString(),this.dtPayrollTaxCmptsObj.addRow(p)}if(null!=C&&C.Tables.length>0&&C.Tables[0].length>0){let y=C.Tables[0];if(null!=y&&y.length>0)for(let p=0;p<y.length;p++){let e=new Jt.AddAttachmentViewModel;e.AddAttachmentViewModel_2(this),e.AttachmentID=parseInt(y[p].FileID),e.ActualFileName=y[p].ActualFileName.toString(),e.FileExtension=y[p].FileExtension.toString(),e.FileDescription=y[p].FileDescription.toString(),e.FilePath=h.J0.GetPath(y[p].GUID+"."+y[p].FileExtension),e.RelativeFileName=y[p].RelativeFileName.toString(),e.IsProductImage=!1,this.ViewAttachments.AttachmentsList.push(e)}}else this.BindEmptyRows(2)}catch(i){Logger.ErrorLog("Error : "+i),this.DisplayMessage=i.message}}OnSaveITDeclarations(t){try{Logger.InfoLog("ITDeclarationsViewModel::Entering OnSaveITDeclarations()");let l="";if(l=this.DataValid(),""!=l.toString())return void(this.DisplayMessage=l);this.SaveEmpIncomeTax(),this.OnClear(t)}catch(l){Logger.ErrorLog("ITDeclarationsViewModel::EXCEPTION OnSaveITDeclarations()"+l)}}DataValid(){let l,a,t="",i=0,o=0;0==this.Employee.SelectedValue&&(t+="Please select the Employee \r\n"),""==this.EmpYear.SelectedValue.toString()&&(t+="Please select the Year \r\n");let d=r.d.common.GetDataTable("PAY111",this.EmpYear.SelectedValue.ToString());null!=d&&d.length>0&&(h.J0.IsEmpty(d[0].dcAlpha9)||h.J0.ParseDate(d[0].dcAlpha9)<Date.Today()&&(t+="Cannot save the record,CutOffDate Exceeded \r\n")),this.PayrollTaxFields.forEach(m=>{if(m instanceof ie.Dw){let C=m;i=h.J0.Double(C.KeyTip),o=h.J0.Double(C.Text),i>0&&o>i&&(t=t+"Amount should be less than Limit Amount for '"+C.Label.toString().Trim()+"'\r\n")}if(m instanceof c.mn){let C=m;i=h.J0.Double(C.Label),o=h.J0.Double(C.ExchangeRate.Text),i>0&&o>i&&(t=t+"Amount should be less than Limit Amount for '"+C.Currency.Text.toString().Trim()+"'\r\n")}});for(let m=0;m<this.dtPayrollTaxCmpts.length;m++)h.J0.IsEmpty(this.dtPayrollTaxCmpts[m].ITFromDate_Key)||(h.J0.ParseDate(h.J0.ParseDate(this.dtPayrollTaxCmpts[m].ITFromDate_Key).ToString("MMM/yyyy"))>h.J0.ParseDate(h.J0.ParseDate(this.dtPayrollTaxCmpts[m].ITToDate_Key).ToString("MMM/yyyy"))?t=t+"Fromdate should be less than todate at row no ('"+m.toString()+"')\r\n":h.J0.ParseDate(h.J0.ParseDate(this.dtPayrollTaxCmpts[m].ITToDate_Key).ToString("MMM/yyyy"))<h.J0.ParseDate(h.J0.ParseDate(this.dtPayrollTaxCmpts[m].ITFromDate_Key).ToString("MMM/yyyy"))&&(t=t+"Todate should be greater than fromdate at row no ('"+m.toString()+"')\r\n"));for(let m=0;m<this.dtPayrollTaxCmpts.length&&""!=h.J0.String(this.dtPayrollTaxCmpts[m].ITFromDate_Key);m++){l=h.J0.ParseDate(h.J0.ParseDate(this.dtPayrollTaxCmpts[m].ITFromDate_Key).ToString("MMM/yyyy")),a=h.J0.ParseDate(h.J0.ParseDate(this.dtPayrollTaxCmpts[m].ITToDate_Key).ToString("MMM/yyyy"));for(let C=0;C<this.dtPayrollTaxCmpts.length;C++)if(m!=C){if(""==h.J0.String(this.dtPayrollTaxCmpts[C].ITFromDate_Key))break;if(+l.Date>=+h.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITFromDate_Key).OnlyDate()&&+l.Date<=+h.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITToDate_Key).OnlyDate()||+a.Date>=+h.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITFromDate_Key).OnlyDate()&&+a.Date<=+h.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITToDate_Key).OnlyDate()||+l.Date>=+h.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITFromDate_Key).OnlyDate()&&+a.Date<=+h.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITToDate_Key).OnlyDate()||+h.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITFromDate_Key).OnlyDate()>=+l.Date&&+h.J0.ParseDate(this.dtPayrollTaxCmpts[C].ITToDate_Key).OnlyDate()<=+a.Date){t=t+"Invalid dates entered at row no ('"+C.toString()+"')\r\n";break}}}for(let m=0;m<this.dtPayrollTaxCmpts.length&&""!=h.J0.String(this.dtPayrollTaxCmpts[m].ITFromDate_Key)&&""!=h.J0.String(this.dtPayrollTaxCmpts[m].ITToDate_Key);m++)if(l=h.J0.ParseDate(h.J0.ParseDate(this.dtPayrollTaxCmpts[m].ITFromDate_Key).ToString("MMM/yyyy")),a=h.J0.ParseDate(h.J0.ParseDate(this.dtPayrollTaxCmpts[m].ITToDate_Key).ToString("MMM/yyyy")),""!=this.dtPayrollTaxCmpts[m].Amount.toString()){o=parseFloat(this.dtPayrollTaxCmpts[m].Amount);let C=12*(a.getFullYear()-l.getFullYear())+a.getMonth()-l.getMonth()+1;if(o/C>8e3){if(""==this.dtPayrollTaxCmpts[m].NameofLandlord.toString()){t=t+"Mandatory NameofLandlord row no ('"+(m+1).toString()+"')\r\n";break}if(""==this.dtPayrollTaxCmpts[m].PanofLandlord.toString()){t=t+"Mandatory PanofLandlord row no ('"+(m+1).toString()+"')\r\n";break}}}return t}SaveEmpIncomeTax(){Logger.InfoLog("ITDeclarationsViewModel::Entering SaveEmpIncomeTax");try{let l="";this.objEmp.EmpYear=this.EmpYear.SelectedValue,this.objEmp.EmpCode=this.Employee.SelectedValue.toString(),this.objEmp.Regime=this.EmpRegime.SelectedValue,l+="<Rows>",this.PayrollTaxFields.forEach(o=>{o instanceof ie.Dw?(l+='<row ComponentID="'+o.DBColumnID,l+='" AmountLimit="'+o.KeyTip,l+=null!=o.Text?'" Amount="'+parseFloat(o.Text):'" Amount="0',l+='"/>'):o instanceof c.mn&&(l+='<row ComponentID="'+o.Currency.SelectedValue,l+='" AmountLimit="'+o.Label,l+=null!=o.ExchangeRate.Text?'" Amount="'+parseFloat(o.ExchangeRate.Text):'" Amount="0',l+='"/>')}),l+="</Rows>";let a="";a+="<HRAINFO>";for(let o=0;o<this.dtPayrollTaxCmpts.length;o++)(""!=h.J0.String(this.dtPayrollTaxCmpts[o].ITFromDate_Key)||""!=h.J0.String(this.dtPayrollTaxCmpts[o].ITToDate_Key))&&(a+='<row FromDt="'+h.J0.ParseDate(this.dtPayrollTaxCmpts[o].ITFromDate_Key).ToString("dd-MMM-yyyy"),a+='" ToDt="'+h.J0.ParseDate(this.dtPayrollTaxCmpts[o].ITToDate_Key).ToString("dd-MMM-yyyy"),""!=this.dtPayrollTaxCmpts[o].Amount.toString()?a+='" Amt="'+parseFloat(this.dtPayrollTaxCmpts[o].Amount):a+='" Amt="0',a+='" Metro="'+this.dtPayrollTaxCmpts[o].Metro,a+='" Address="'+this.dtPayrollTaxCmpts[o].HRAAddress,a+='" Landlord="'+this.dtPayrollTaxCmpts[o].NameofLandlord,a+='" LandlordPAN="'+this.dtPayrollTaxCmpts[o].PanofLandlord,a+='"/>');a+="</HRAINFO>";let i=this.ViewAttachments.GetXML();r.d.empService.SaveEmpTaxDeclarations(l.toString(),a.toString(),i.toString(),this.objEmp.EmpYear,this.objEmp.EmpCode,this.objEmp.Regime).subscribe(o=>{this.DisplayMessage=o.Message,this.Savereturnvalue=o.RetValue})}catch(t){Logger.ErrorLog("ITDeclarationsViewModel:: SaveEmpIncomeTax"+t.stack)}}OnClear(t){try{this.Employee.SelectedValue=0,this.EmpRegime.SelectedValue="",this.PayrollColumnSourceTaxComponents.Clear(),this.PayrollTaxFields.Clear(),this.BindHRAGridColumns(),this.GenerateTaxComponentFields(0,0,this.PayrollTaxFields),null!=this.ViewAttachments&&this.ViewAttachments.AttachmentsList.Clear(),this.ViewAttachments=new Rt.ViewAttachmentViewModel(this),this.OnAddAttachment()}catch(l){Logger.ErrorLog("Error : "+l),this.DisplayMessage=l.message}}BindEmptyRows(t){this.dtPayrollTaxCmptsObj.addEmptyRows(t)}FilterEmployees(){try{Logger.InfoLog("ITDeclarationsViewModel::Entering FilterEmployees()");let l,a,t="";l=new Date(parseInt(this.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth-1,1),a=new Date(r.d.SessionManager.AccountingFromMonth>1?parseInt(this.EmpYear.SelectedValue)+1:parseInt(this.EmpYear.SelectedValue),r.d.SessionManager.AccountingToMonth-1,1),a=a.AddMonths(1).AddDays(-1),t=" ( a.StatusID=250 AND (ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')='01-Jan-9000') ",t=t+" or (Year(CONVERT(DATETIME,'"+a.ToString("dd/MMM/yyyy")+"'))<=Year(CONVERT(DATETIME,a.DORelieve)) and CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve)) ",t=t+" or ( CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve))) ",r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(t=t+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),h.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(t+="  AND a.NodeID IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),r.d.SessionManager.IsRptManagerUser&&r.d.SessionManager.IsActionAssigned(262,"Do not show sub ordinates Data")&&(t+="  AND a.NodeID IN ("+r.d.SessionManager.iEmployee+")"),this.Employee.Code.CustomWhere=this.Employee.Name.CustomWhere=t,Logger.InfoLog("ITDeclarationsViewModel::Exiting FilterEmployees()")}catch(t){Logger.ErrorLog("ITDeclarationsViewModel::EXCEPTION FilterEmployees()"+t.stack)}}OnAddAttachment(){Logger.InfoLog("AddProductViewModel::Entering AddAttachment");let t="";null!=this.Attachment&&(t=this.Attachment.ColID);let l=null;null!=this.Attachment&&(l=this.Attachment.RowID),this.Attachment=new Jt.AddAttachmentViewModel,this.Attachment.AddAttachmentViewModel_2(this),""==t?(this.Attachment.ColID="",this.Attachment.RowID=null):(this.Attachment.ColID=t,this.Attachment.RowID=l),Logger.InfoLog("AddProductViewModel::Entering AddAttachment")}OnClickAttachment(t){this.AttachmentVisibility=!0,r.d.page.ShowDialog(this,M.l,{Title:"Attachment"})}}function w(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.obj.OnClickAttachment())}),s.EFF(1,"\n        "),s.nrm(2,"i",22),s.EFF(3),s.nI1(4,"translate"),s.k0s()}2&L&&(s.R7$(3),s.JRh(s.bMT(4,1,"Attachments")))}function $(L,t){if(1&L&&(s.j41(0,"div",26),s.EFF(1),s.k0s()),2&L){const l=s.XpG().$implicit;s.R7$(),s.JRh(l.Label)}}function X(L,t){if(1&L&&s.nrm(0,"input",31),2&L){const l=s.XpG(2).$implicit,a=s.XpG();s.Y8G("placeholder",a.lblwatermark)("ngModel",l.Text)}}function J(L,t){if(1&L){const l=s.RV6();s.j41(0,"input",32),s.mxI("ngModelChange",function(i){s.eBV(l);const o=s.XpG(2).$implicit;return s.DH7(o.Text,i)||(o.Text=i),s.Njj(i)}),s.k0s()}if(2&L){const l=s.XpG(2).$implicit;s.Y8G("tabindex",l.IsTabStop?null:-1)("disabled",!l.Enable||l.IsReadOnly),s.R50("ngModel",l.Text)}}function Y(L,t){if(1&L&&(s.qex(0),s.EFF(1,"\n                "),s.j41(2,"div"),s.EFF(3,"\n                  "),s.j41(4,"label",27),s.EFF(5),s.k0s(),s.EFF(6," \n                  "),s.j41(7,"label",28),s.EFF(8),s.k0s(),s.EFF(9," \n                  "),s.DNE(10,X,1,2,"input",29),s.EFF(11,"\n                  "),s.DNE(12,J,1,3,"input",30),s.EFF(13,"\n                     "),s.EFF(14,"\n                "),s.k0s(),s.EFF(15,"\n              "),s.EFF(16,"\n            "),s.bVm()),2&L){const l=s.XpG().$implicit;s.R7$(2),s.AVh("c-flex",l.LblWidth),s.R7$(2),s.BMQ("for",l.DBColumnName),s.R7$(),s.SpI("  ",l.Label," "),s.R7$(2),s.BMQ("for",l.DBColumnName),s.R7$(),s.SpI("    ",l.KeyTip," "),s.R7$(2),s.Y8G("ngIf",!l.ShowControl),s.R7$(2),s.Y8G("ngIf",l.ShowControl)}}function R(L,t){if(1&L&&(s.qex(0),s.EFF(1,"\n              "),s.eu8(2,13),s.EFF(3,"\n            "),s.bVm()),2&L){const l=s.XpG().$implicit,a=s.XpG();s.R7$(2),s.Y8G("obj",l)("group",a.form)}}function H(L,t){if(1&L&&(s.qex(0),s.EFF(1,"\n          "),s.j41(2,"div",23),s.EFF(3,"\n            "),s.DNE(4,$,2,1,"div",24),s.EFF(5,"\n            "),s.DNE(6,Y,17,8,"ng-container",25),s.EFF(7,"\n            "),s.DNE(8,R,4,2,"ng-container",25),s.EFF(9,"\n          "),s.k0s(),s.EFF(10,"\n        "),s.bVm()),2&L){const l=t.$implicit;s.R7$(2),s.Y8G("ngSwitch",!0),s.R7$(2),s.Y8G("ngSwitchCase","LABEL"==l.tabname),s.R7$(2),s.Y8G("ngSwitchCase","TEXTBOX"==l.tabname),s.R7$(2),s.Y8G("ngSwitchCase","COMBOTEXTVALUE"==l.tabname)}}let ge=(()=>{class L{constructor(){this.form=new v.gE({})}ngOnInit(){this.obj=this.params.obj,console.log(this.obj)}static{this.\u0275fac=function(a){return new(a||L)}}static{this.\u0275cmp=s.VBU({type:L,selectors:[["app-income-tax-declaration"]],standalone:!1,decls:77,vars:18,consts:[["id","maincontainer",1,"maincontainer",2,"display","flex"],[2,"flex-direction","column","justify-content","flex-end","width","100%"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-save"],[1,"fa-light","fa-broom"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"main_div","detailed",2,"padding","10px"],[1,"row"],[1,"form-group","col-xl-3","col-md-4","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"input_cntrl_label"],[1,"form-group","col-xl-6","col-md-4","col-sm-12","col-xs-12","PACTControl"],[2,"height","calc(100% - 190px)","overflow","auto"],[1,"PACTHeaderFields","row","form-row"],[4,"ngFor","ngForOf"],[1,"documentgrid",2,"height","140px"],[1,"page-subtitle",2,"padding","0","display","block","height","30px","font-size","16px"],[2,"height","90px"],[1,"fa-light","fa-paperclip"],[1,"form-group","row","PACTControl",3,"ngSwitch"],["class","input_cntrl_label panel-heading","style","font-weight: bold; background-color:var(--gridheaderbg-color); padding: 4px;",4,"ngSwitchCase"],[4,"ngSwitchCase"],[1,"input_cntrl_label","panel-heading",2,"font-weight","bold","background-color","var(--gridheaderbg-color)","padding","4px"],[1,"input_cntrl_label",2,"width","70%"],[1,"input_cntrl_label",2,"width","10%","font-weight","bold"],["disabled","","class","input_cntrl disablecntrl","style","text-align: right;width: 20%;",3,"placeholder","ngModel",4,"ngIf"],["class","input_cntrl","style","width: 20%;text-align: right;",3,"tabindex","disabled","ngModel","ngModelChange",4,"ngIf"],["disabled","",1,"input_cntrl","disablecntrl",2,"text-align","right","width","20%",3,"placeholder","ngModel"],[1,"input_cntrl",2,"width","20%","text-align","right",3,"ngModelChange","tabindex","disabled","ngModel"]],template:function(a,i){1&a&&(s.j41(0,"div",0),s.EFF(1,"\n  "),s.j41(2,"div",1),s.EFF(3,"\n  "),s.j41(4,"div",2),s.EFF(5,"\n     "),s.j41(6,"div",3),s.EFF(7,"\n      "),s.j41(8,"span",4),s.EFF(9),s.k0s(),s.EFF(10,"\n    "),s.k0s(),s.EFF(11,"\n    "),s.j41(12,"div",5),s.EFF(13,"\n      "),s.EFF(14,"\n      "),s.j41(15,"span",6),s.bIt("click",function(){return i.obj.OnSaveITDeclarations()}),s.EFF(16,"\n        "),s.nrm(17,"i",7),s.EFF(18),s.nI1(19,"translate"),s.k0s(),s.EFF(20,"\n      "),s.j41(21,"span",6),s.bIt("click",function(){return i.obj.OnClear("Clear")}),s.EFF(22,"\n        "),s.nrm(23,"i",8),s.EFF(24),s.nI1(25,"translate"),s.k0s(),s.EFF(26,"\n      "),s.DNE(27,w,5,3,"span",9),s.EFF(28,"\n  "),s.k0s(),s.EFF(29,"\n  "),s.k0s(),s.EFF(30,"\n  "),s.j41(31,"div",10),s.EFF(32,"\n    "),s.j41(33,"div",11),s.EFF(34,"\n      "),s.j41(35,"div",12),s.EFF(36,"\n        "),s.eu8(37,13),s.EFF(38,"\n        "),s.j41(39,"label",14),s.EFF(40),s.k0s(),s.EFF(41,"\n      "),s.k0s(),s.EFF(42,"\n      "),s.j41(43,"div",15),s.EFF(44,"\n        "),s.eu8(45,13),s.EFF(46,"\n      "),s.k0s(),s.EFF(47,"\n      "),s.j41(48,"div",12),s.EFF(49,"\n        "),s.eu8(50,13),s.EFF(51,"\n      "),s.k0s(),s.EFF(52,"\n    "),s.k0s(),s.EFF(53,"\n    "),s.j41(54,"div",16),s.EFF(55,"\n      "),s.j41(56,"div",17),s.EFF(57,"\n        "),s.DNE(58,H,11,4,"ng-container",18),s.EFF(59,"\n      "),s.k0s(),s.EFF(60,"\n    "),s.k0s(),s.EFF(61,"\n    "),s.j41(62,"div",19),s.EFF(63,"\n      "),s.j41(64,"span",20),s.EFF(65,"HRA Information"),s.k0s(),s.EFF(66,"\n      "),s.j41(67,"div",21),s.EFF(68,"\n        "),s.eu8(69,13),s.EFF(70,"\n      "),s.k0s(),s.EFF(71,"\n    "),s.k0s(),s.EFF(72,"\n  "),s.k0s(),s.EFF(73,"\n  "),s.k0s(),s.EFF(74,"\n"),s.k0s(),s.EFF(75,"\n\n"),s.EFF(76,"\n")),2&a&&(s.R7$(9),s.SpI("\n        ",i.obj.Title,"\n      "),s.R7$(9),s.JRh(s.bMT(19,14,"Save")),s.R7$(6),s.JRh(s.bMT(25,16,"Clear")),s.R7$(3),s.Y8G("ngIf",i.obj.AttachVisiblility),s.R7$(10),s.Y8G("obj",i.obj.EmpYear)("group",i.form),s.R7$(3),s.JRh(i.obj.lFinancialDate),s.R7$(5),s.Y8G("obj",i.obj.Employee)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.EmpRegime)("group",i.form),s.R7$(8),s.Y8G("ngForOf",i.obj.PayrollTaxFields),s.R7$(11),s.Y8G("obj",i.obj.dtPayrollTaxCmptsObj)("group",i.form))},dependencies:[xe.Sq,xe.bT,xe.ux,xe.e1,$e._,v.me,v.BC,v.vS,qe.D9],encapsulation:2})}}return L})();var Z=G(82503);class ce extends He.g{constructor(t){super(),this.dtpFromDate=new Z.P6(0),this.dtpToDate=new Z.P6(0),this.lTotalTaxAmount="",this.lTDSPaidAmount="",this.lTDSAmount="",this.ButtonClick=new Ft.Yk,this.iComponentID=0,Logger.InfoLog("TDSPostingViewModel::Entering TDSPostingViewModel()"),this.DisplayMessage="",this.Parent=t[0],this.lTotalTaxAmount=t[1].toString(),this.lTDSPaidAmount=t[2].toString(),this.lTDSAmount=t[3].toString(),this.iComponentID=parseInt(t[4]),this.ButtonClick.Subscribe(this,"Button_Click"),this.LoadGrid(),this.dtpFromDate.Label="From Date",this.dtpFromDate.LblWidth="80",this.dtpFromDate.Date=new Date(parseInt(this.Parent.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth-1,1),this.dtpToDate.Label="To Date",this.dtpToDate.LblWidth="80",this.dtpToDate.Date=this.dtpFromDate.Date.AddYears(1).AddMonths(-1),this.Generate_Click(0),Logger.InfoLog("TDSPostingViewModel::Exiting TDSPostingViewModel()")}LoadGrid(){this.dgv=new n.vv,this.dgv.Width="550",this.dgv.CanUserDeleteRows=!1,this.dgv.CanUserAddRows=!1,this.dgv.OnCellEditEnding.Subscribe(this,"dgv_EndEdit"),this.dgv.TableColumns.push("SNo"),this.dgv.TableColumns.push("Month"),this.dgv.TableColumns.push("Amount");let t=new B.O7;this.dgv.Columns=[],t=new B.O7,t.Header="#",t.DisplayMember="SNo",t.DataType="TextBlock",t.Width=40,t.ReadOnly=!0,this.dgv.Columns.push(t),t=new B.O7,t.Header="Month",t.DisplayMember="Month",t.DataType="TextBlock",t.Width=180,t.ReadOnly=!0,t.TextAlign="Center",this.dgv.Columns.push(t),t=new B.O7,t.Header="Amount",t.DisplayMember="Amount",t.DataType="TextBlock",t.Width=180,t.ReadOnly=!1,t.TextAlign="FLOAT",this.dgv.Columns.push(t),this.dgv.Columns[2].footer="0.00",this.dgv.UpdateFooter()}Button_Click(t){Logger.InfoLog("TDSPostingViewModel::Entering Button_Click"),"Post"==t.toString()?this.Post_Click():"Cancel"==t.toString()?r.d.page.HideDialog(this.PopUpGUID):"Generate"==t.toString()&&this.Generate_Click(1),Logger.InfoLog("TDSPostingViewModel::Exiting Button_Click")}Generate_Click(t){this.dgv.Clear();let l=new Date(parseInt(this.Parent.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth-1,1),a=l.AddYears(1).AddMonths(-1);if(this.dtpFromDate.Date<l||this.dtpFromDate.Date>a)return this.DisplayMessage="From Date should be in Between Finacial Year",void(this.MessageVisibility=!0);if(this.dtpToDate.Date<l||this.dtpToDate.Date>a)return this.DisplayMessage="To Date should be in Between Finacial Year",void(this.MessageVisibility=!0);let i=r.d.common.GetDataSet3("PAY122",this.Parent.Employee.SelectedValue,this.dtpFromDate.Date.ToString("dd MMM yyyy"),this.dtpToDate.Date.ToString("dd MMM yyyy"));if(0==t){if(null!=i&&i.length>0){let y=i.Compute("max","PayrollDate");h.J0.IsEmpty(y)||(this.dtpFromDate.Date=new Date(y))}}else if(1==t&&null!=i&&i.length>0)return this.DisplayMessage="Payroll Already Processed For the Month - "+new Date(i.Rows[0].PayrollDate).ToString("dd MMM yyyy"),void(this.MessageVisibility=!0);let o=null,d=0,m=0,C=0,g=this.dtpFromDate.Date;for(;g<=this.dtpToDate.Date;)d+=1,g=g.AddMonths(1);for(m=parseFloat(this.lTDSAmount)/d,m=parseFloat(m.ToString("0.00")),g=this.dtpFromDate.Date;g<=this.dtpToDate.Date;)o=this.dgv.NewRow(),o.SNo=this.dgv.Table.length+1,o.Month=g.ToString("dd MMM yyyy"),o.Amount=g.ToString("dd MMM yyyy")==this.dtpToDate.Date.ToString("dd MMM yyyy")?parseFloat(this.lTDSAmount)-C:m,this.dgv.addRow(o),C+=parseFloat(o.Amount),g=g.AddMonths(1);this.dgv.Columns[2].footer=C.ToString("0.00"),this.dgv.UpdateFooter()}Post_Click(){try{if(Logger.InfoLog("TDSPostingViewModel::Entering Post_Click()"),0==this.dgv.Table.length)return this.DisplayMessage="No Data to Post",void(this.MessageVisibility=!0);if(this.ValidatePosting()){let d,t="",l=0,a="0",i="0",o=r.d.common.GetScreenInfo(40068);d=o.Tables[0].filter(p=>"CreditAccount"==p.SysColumnName),null!=d&&d.length>0&&null!=d[0].UserDefaultValue&&""!=d[0].UserDefaultValue.toString().Trim()&&(a=d[0].UserDefaultValue.toString()),d=o.Tables[0].filter(p=>"DebitAccount"==p.SysColumnName),null!=d&&d.length>0&&null!=d[0].UserDefaultValue&&""!=d[0].UserDefaultValue.toString().Trim()&&(i=d[0].UserDefaultValue.toString()),d=o.Tables[0].filter(p=>"ProductID"==p.SysColumnName),null!=d&&d.length>0&&null!=d[0].UserDefaultValue&&""!=d[0].UserDefaultValue.toString().Trim()&&(l=parseInt(d[0].UserDefaultValue));let m=r.d.common.GetDataSet3("PAY123",this.Parent.Employee.SelectedValue,this.iComponentID.ToString(),this.iComponentID.ToString()),C="",g="",y=0;for(let p=0;p<this.dgv.Table.length;p++)if(C="",y=0,null!=this.dgv.Table[p].Amount&&null!=this.dgv.Table[p].Amount&&""!=this.dgv.Table[p].Amount.toString()&&null!=this.dgv.Table[p].Month&&null!=this.dgv.Table[p].Month&&""!=this.dgv.Table[p].Month.toString()){if(null!=m&&m.Tables.length>0){let e=m.Tables[0].filter(u=>new Date(u.dcAlpha2).ToString("dd MMM yyyy")==new Date(this.dgv.Table[p].Month).ToString("dd MMM yyyy")||new Date(u.dcAlpha4).ToString("dd MMM yyyy")==new Date(this.dgv.Table[p].Month).ToString("dd MMM yyyy"));null!=e&&e.length>0&&(g=e[0].InvDocDetailsID.toString(),y=parseInt(e[0].DocID))}C=g.length>0?'<XML SysInfo="'+r.d.SessionManager.GetSysInfo()+'" AP="Desktop" DetailIds="'+g+'"> </XML>':'<XML SysInfo="'+r.d.SessionManager.GetSysInfo()+'" AP="Desktop" > </XML>',t+="<ROWS>",t+="<DocumentXML>",t+=this.GetRecXML(new Date(this.dgv.Table[p].Month),new Date(this.dgv.Table[p].Month),parseFloat(this.dgv.Table[p].Amount),l,a,i,g),t+="</DocumentXML>",t+="<ActivityXML>",t+=C,t+="</ActivityXML>",t+="<DOCIDXML>",t+='<XML DOCID="'+y+'"></XML>',t+="</DOCIDXML>",t+="</ROWS>"}if(t.length>0&&t.length>0){t="<REC>"+t,t+="</REC>";let p=[];p.push(t.toString()),p.push(r.d.SessionManager.GetSysInfo()),p.push("Desktop"),p.push(r.d.SessionManager.UserID),p.push(r.d.SessionManager.LanguageID);let e=r.d.empService.ExecuteQuery_SP(p,"spPAY_PostTDSDoc");return null!=e&&e.Tables.length>0&&e.Tables[e.Tables.length-1].length>0&&e.Columns[e.Tables.length-1].Contains("ErrorMessage")?(this.DisplayMessage=e.Tables[e.Tables.length-1][0].ErrorMessage.toString(),void(this.MessageVisibility=!0)):(this.DisplayMessage="Problem in processing your request,Please contact administrator.",void(this.MessageVisibility=!0))}}Logger.InfoLog("TDSPostingViewModel::Exiting Post_Click()")}catch(t){Logger.ErrorLog("TDSPostingViewModel::EXCEPTION btnPost_Click()\r\n"+t.stack)}}ValidatePosting(){try{return Logger.InfoLog("TDSPostingViewModel::Entering ValidatePosting()"),parseFloat(this.dgv.Columns[2].footer)!=parseFloat(this.lTDSAmount)?(this.DisplayMessage="TDS Amount not Equal",this.MessageVisibility=!0,!1):this.iComponentID<=0?(this.DisplayMessage="TDS Component Should be Monthly Type",this.MessageVisibility=!0,!1):(Logger.InfoLog("TDSPostingViewModel::Exiting ValidatePosting()"),!0)}catch(t){return Logger.ErrorLog("TDSPostingViewModel::EXCEPTION ValidatePosting()\r\n"+t.stack),!1}}dgv_EndEdit(t,l,a){try{Logger.InfoLog("TDSPostingViewModel::Entering dgv_EndEdit()");let i=0;if(this.dgv.Table.length>0){for(let o=0;o<this.dgv.Table.length;o++)null!=this.dgv.Table[o].Amount&&null!=this.dgv.Table[o].Amount&&""!=this.dgv.Table[o].Amount.toString()&&(i+=parseFloat(this.dgv.Table[o].Amount));this.dgv.Columns[2].footer=i.ToString("0.00"),this.dgv.UpdateFooter()}Logger.InfoLog("TDSPostingViewModel::Exiting dgv_EndEdit()")}catch(i){Logger.ErrorLog("TDSPostingViewModel::EXCEPTION dgv_EndEdit()\r\n"+i.stack)}}GetRecXML(t,l,a,i,o,d,m){let C="",g="",y="",p="",e="",u="";return y+='<Alpha Query="',y+=" dcAlpha1=3,dcAlpha2='"+t.ToString("dd MMM yyyy")+"',dcAlpha3="+this.iComponentID+",dcAlpha4='"+l.ToString("dd MMM yyyy")+"', ",y+='" ></Alpha>',u="",e+='<CostCenters Query="',u+=" dcCCNID51="+this.Parent.Employee.SelectedValue+",",u.length>0&&(e+=u),e+='" ></CostCenters>',g+=m.length>0?'" DocDetailsID="'+m:'" DocDetailsID="',g+='" ProductID="'+i+'" Quantity="0',g+='" Unit="1" UOMConversion="1" UOMConvertedQty="0',g+='" Rate="0" Gross="0" IsQtyIgnored="1" AverageRate="0',g+='" StockValue="0" StockValueFC="0" RefNO="',g+='" BillDate="'+(new Date).ToString("dd/MMM/yyyy"),g+='" CurrencyID="1" ExchangeRate="1',g+='" DebitAccount="'+o+'" CreditAccount="'+d,g+='" CommonNarration="'+h.J0.EncodeXML(""),p+='<Numeric Query="',p+="dcNum1="+a+", dcCalcNum1="+a,p+='" ></Numeric>',C+="<Row>",C+="<AccountsXML></AccountsXML>",C+='<Transactions DocSeqNo="1',C+='" LinkedInvDocDetailsID="0" LinkedFieldName="',C+='" LineNarration="'+h.J0.EncodeXML(""),C+=g.toString()+'" ></Transactions>',C+=y.toString(),C+=p.toString(),C+=e.toString(),C+="<EXTRAXML></EXTRAXML>",C+="</Row>",C.toString()}}let ne=(()=>{class L{constructor(){this.form=new v.gE({}),this.lblTotalTaxAmount="TOTAL INCOME TAX PAYABLE : ",this.lblTDSPaidAmount="TDS Paid : ",this.lblTDSAmount="Payable TDS Amount : "}ngOnInit(){}static{this.\u0275fac=function(a){return new(a||L)}}static{this.\u0275cmp=s.VBU({type:L,selectors:[["app-tds-posting"]],inputs:{obj:"obj"},standalone:!1,decls:72,vars:21,consts:[[1,"master-screen",2,"padding-bottom","4px","width","700px"],[1,"PACTHeaderFields","dialogSubBody"],[1,"row"],["FieldDirective","",3,"obj","group"],[2,"margin-left","12px"],[1,"form-group",2,"margin-left","12px"],[1,"primary-btn-wicon",3,"click"],[2,"padding-top","5px"],[2,"font-weight","bold","margin-left","10px"],[2,"padding-top","5px","margin-left","25px"],[1,"documentgrid","row","form-row",2,"width","100%","margin-top","5px"],[2,"width","100%",3,"obj","group"],[1,"Pactdailogfooter"],[1,"secondary-btn-wicon",3,"click"]],template:function(a,i){1&a&&(s.j41(0,"div",0),s.EFF(1,"\n    "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"div",2),s.EFF(5,"\n            "),s.j41(6,"div"),s.EFF(7,"\n            "),s.eu8(8,3),s.EFF(9,"\n        "),s.k0s(),s.EFF(10,"\n        "),s.j41(11,"div",4),s.EFF(12,"\n            "),s.eu8(13,3),s.EFF(14,"\n        "),s.k0s(),s.EFF(15,"\n        "),s.j41(16,"div",5),s.EFF(17,"\n            "),s.j41(18,"button",6),s.bIt("click",function(){return i.obj.Button_Click("Generate")}),s.EFF(19),s.nI1(20,"translate"),s.k0s(),s.EFF(21,"\n          "),s.k0s(),s.EFF(22,"\n        "),s.k0s(),s.EFF(23,"\n        "),s.j41(24,"div",2),s.EFF(25,"\n            "),s.j41(26,"div",7),s.EFF(27,"\n                "),s.j41(28,"label"),s.EFF(29),s.k0s(),s.j41(30,"label",8),s.EFF(31),s.k0s(),s.EFF(32,"\n            "),s.k0s(),s.EFF(33,"\n            "),s.j41(34,"div",9),s.EFF(35,"\n                "),s.j41(36,"label"),s.EFF(37),s.k0s(),s.j41(38,"label",8),s.EFF(39),s.k0s(),s.EFF(40,"\n            "),s.k0s(),s.EFF(41,"\n            "),s.j41(42,"div",9),s.EFF(43,"\n                "),s.j41(44,"label"),s.EFF(45),s.k0s(),s.j41(46,"label",8),s.EFF(47),s.k0s(),s.EFF(48,"\n            "),s.k0s(),s.EFF(49,"\n        "),s.k0s(),s.EFF(50,"\n        "),s.j41(51,"div",10),s.EFF(52,"\n            "),s.nrm(53,"app-PactGridView",11),s.EFF(54,"\n        "),s.k0s(),s.EFF(55,"\n\n\n        "),s.j41(56,"div",12),s.EFF(57,"\n            "),s.j41(58,"div"),s.EFF(59,"\n                "),s.j41(60,"button",6),s.bIt("click",function(){return i.obj.Button_Click("Post")}),s.EFF(61),s.nI1(62,"translate"),s.k0s(),s.EFF(63,"\n                "),s.j41(64,"button",13),s.bIt("click",function(){return i.obj.Button_Click("Cancel")}),s.EFF(65),s.nI1(66,"translate"),s.k0s(),s.EFF(67,"\n            "),s.k0s(),s.EFF(68,"\n        "),s.k0s(),s.EFF(69,"\n    "),s.k0s(),s.EFF(70,"\n"),s.k0s(),s.EFF(71,"\n")),2&a&&(s.R7$(8),s.Y8G("obj",i.obj.dtpFromDate)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.dtpToDate)("group",i.form),s.R7$(6),s.JRh(s.bMT(20,15,"Generate")),s.R7$(10),s.JRh(i.lblTotalTaxAmount),s.R7$(2),s.JRh(i.obj.lTotalTaxAmount),s.R7$(6),s.JRh(i.lblTDSPaidAmount),s.R7$(2),s.JRh(i.obj.lTDSPaidAmount),s.R7$(6),s.JRh(i.lblTDSAmount),s.R7$(2),s.JRh(i.obj.lTDSAmount),s.R7$(6),s.Y8G("obj",i.obj.dgv)("group",i.form),s.R7$(8),s.JRh(s.bMT(62,17,"Post")),s.R7$(4),s.JRh(s.bMT(66,19,"Close")))},dependencies:[$e._,st.X,qe.D9],encapsulation:2})}}return L})();class Me extends He.g{constructor(){super(...arguments),this.CostCenterID=0,this.MessageDisplay="",this.TypeID=0,this.Employee=new bt.G(0),this.TDSPostVisiblility=!1,this.PrintVisiblility=!1,this.ExportVisiblility=!1,this.WorksheetVisiblility=!1,this.txtDesignation="",this.dtPayrollTaxCmptsObj=new n.vv,this.Savereturnvalue=0,this.dsITComputation=null,this.sbComputationData="",this.sbValidation="",this.dPayableTDSAmount=0,this.dTotalTaxAmount=0,this.dTDSPaidAmount=0,this.iCompnentID=0,this.objTDSVM=null}get CCID(){return this.CostCenterID}set CCID(t){this.CostCenterID=t}get lFinancialDate(){return this._lFinancialDate}set lFinancialDate(t){t!=this._lFinancialDate&&(this._lFinancialDate=t)}get ScreenObject(){return this._ScreenObject}set ScreenObject(t){this._ScreenObject=t}get dtPayrollTaxCmpts(){return this.dtPayrollTaxCmptsObj.Table}get PayrollColumnSourceTaxComponents(){return this.dtPayrollTaxCmptsObj.Columns}IncomeTaxComputationViewModel(){Logger.InfoLog("ITComputationViewModel::Entering ITComputationViewModel"),this.objEmp=new Q,this.ScreenObject=new P.a(0,0),this.ScreenObject.Data=[],this.TDSPostVisiblility=r.d.SessionManager.IsActionAssigned(264,"TDS Posting"),this.PrintVisiblility=r.d.SessionManager.IsActionAssigned(264,"Print"),this.ExportVisiblility=r.d.SessionManager.IsActionAssigned(264,"Export"),this.WorksheetVisiblility=r.d.SessionManager.IsActionAssigned(264,"WorkSheet"),this.EmpYear=new te.y$(0);for(let t=2e3;t<2100;t++){let l=te._p.ComboBoxItems_2(t.toString(),t.toString());this.EmpYear.Items.push(l)}this.EmpYear.SelectedValue=h.J0.ParseDate(r.d.SessionManager.PayrollMonth).ToString("yyyy"),this.lFinancialDate=this.GetFinancialYear(),this.EmpRegime=new te.y$(0),this.EmpRegime.Items.push(te._p.ComboBoxItems_2("Old","Old")),this.EmpRegime.Items.push(te._p.ComboBoxItems_2("New","New")),this.Employee.Visible=!0,this.Employee.Code.TypeID=4,this.Employee.Name.TypeID=1,this.Employee.Code.Visible=this.Employee.Name.Visible=!1,this.Employee.Code.Column=0,this.Employee.Name.Column=1,this.Employee.Code.Visible=!0,this.Employee.Name.Visible=!0,this.Employee.Code.CCID=this.Employee.Name.CCID=50051,this.Employee.Code.Visible&&(this.Employee.Code.CCID=50051,this.Employee.Code.TypeID=4),this.Employee.Name.Visible&&(this.Employee.Name.CCID=50051,this.Employee.Name.TypeID=1),this.FilterEmployees(),this.dtPayrollTaxCmptsObj.Table=[],this.dtPayrollTaxCmptsObj.Columns=[],Logger.InfoLog("ITComputationViewModel::Exiting ITComputationViewModel")}GetFinancialYear(){let t="",l=new Date(parseInt(this.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth,1),a=l.AddYears(1).AddMonths(-1);return t=this.ScreenObject.GetMonthName(l.getMonth(),!1)+" "+l.getFullYear()+" - "+this.ScreenObject.GetMonthName(a.getMonth(),!1)+" "+a.getFullYear(),t}Employee_SelectedValueChanged(t){this.dsITComputation=r.d.empService.GetIncomeTaxCalcDetails(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,r.d.SessionManager.AccountingFromMonth),this.GetResPerson()}GetResPerson(){this.lstResponsiblePerson=new We,this.txtDesignation="";let a,i,t=" 1=1 ",l="";if(r.d.SessionManager.Preferences.ContainsKey("IncomeTaxResponsibleBasedOn")&&""!=r.d.SessionManager.Preferences.ContainsKey("IncomeTaxResponsibleBasedOn").toString()&&r.d.SessionManager.Preferences.ContainsKey("IncomeTaxResponsibleBasedOnXML")&&""!=r.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOnXML&&r.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOnXML.length>0){a=new h.VB,a.ReadXml(r.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOnXML),i=a.Tables[0];let d=r.d.SessionManager.Preferences.IncomeTaxResponsibleBasedOn.split(",");if(null!=d&&d.length>0)for(let m=0;m<d.length;m++)if(null!=d[m]&&""!=d[m]&&(l="CCNID"+(parseInt(d[m])-5e4),null!=this.dsITComputation&&this.dsITComputation.Tables.length>27&&this.dsITComputation.Tables[27].length>0)){let C=this.dsITComputation.Tables[27].filter(g=>g.NodeID=this.Employee.SelectedValue);null!=C&&C.length>0&&(t+=" AND ( dc"+l+"="+C[0][l]+" )",i=i.filter(g=>g["dc"+l]==C[0][l]))}}let o="";if(" 1=1 "!=t&&(o=i),null!=o&&o.length>0){this.lstResponsiblePerson.SelectedValue=o[0].ResponsiblePerson.toString();let d=r.d.common.GetDataSet("PAY070",this.lstResponsiblePerson.SelectedValue.toString());null!=d&&d.Tables[0].length>0&&(this.lstResponsiblePerson.Text=d.Tables[0][0].Name.toString(),this.lstResponsiblePerson.Tag=d.Tables[0][0].FHName.toString(),this.txtDesignation=d.Tables[0][0].Designation.toString())}}OnYearSelected(t){this.FilterEmployees(),this.dsITComputation=r.d.empService.GetIncomeTaxCalcDetails(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,r.d.SessionManager.AccountingFromMonth),this.GetResPerson()}OnSaveITComputation(t){try{Logger.InfoLog("ITComputationViewModel::Entering OnSaveITComputation()"),this.sbValidation?this.DisplayMessage=this.sbValidation.toString():r.d.empService.SaveEmpTaxComputation(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue,this.sbComputationData.toString()).subscribe(l=>{this.DisplayMessage=l.Message,this.Savereturnvalue=l.RetValue})}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnSaveITComputation()"+l.stack)}}OnDeleteITComputation(t){try{this.sbValidation?this.DisplayMessage=this.sbValidation.toString():r.d.empService.DeleteEmpTaxComputation(parseInt(this.EmpYear.SelectedValue),this.Employee.SelectedValue).subscribe(l=>{this.DisplayMessage=l.Message,this.Savereturnvalue=l.RetValue})}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnDeleteITComputation()"+l.stack)}}OnSaveRegimeITComputation(t){try{Logger.InfoLog("ITComputationViewModel::Entering OnSaveRegimeITComputation()"),this.sbValidation?(this.DisplayMessage=this.sbValidation.toString(),this.MessageVisibility=!0):null!=this.EmpRegime.SelectedValue?(r.d.common.GetDataSet3("PAY121",this.EmpRegime.SelectedValue,this.Employee.SelectedValue.toString(),this.EmpYear.SelectedValue),this.DisplayMessage="Updated Succesfully",this.MessageVisibility=!0):(this.DisplayMessage="Please select RegimeType",this.MessageVisibility=!0)}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnSaveRegimeITComputation()"+l.stack)}}OnTDSPostITComputation(t){try{if(Logger.InfoLog("ITComputationViewModel::Entering OnTDSPostITComputation()"),!this.DisplayMessage){let l=[];l.push(this),l.push(this.dTotalTaxAmount),l.push(this.dTDSPaidAmount),l.push(this.dPayableTDSAmount),l.push(this.iCompnentID),this.objTDSVM=new ce(l),r.d.page.ShowDialog(this.objTDSVM,ne,{ShowCenter:!0,Title:"TDS Posting"}).subscribe(()=>{})}Logger.InfoLog("ITComputationViewModel::Exiting OnTDSPostITComputation()")}catch(l){Logger.ErrorLog("ITComputationViewModel::EXCEPTION OnTDSPostITComputation()"+l.stack)}}FilterEmployees(){try{Logger.InfoLog("ITComputationViewModel::Entering FilterEmployees()");let l,a,t="";l=new Date(parseInt(this.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth-1,1),a=new Date(r.d.SessionManager.AccountingFromMonth>1?parseInt(this.EmpYear.SelectedValue)+1:parseInt(this.EmpYear.SelectedValue),r.d.SessionManager.AccountingToMonth-1,1),a=a.AddMonths(1).AddDays(-1),t=" ( a.StatusID=250 AND (ISNULL(CONVERT(DATETIME,a.DORelieve),'01-Jan-9000')='01-Jan-9000') ",t=t+" or (Year(CONVERT(DATETIME,'"+a.ToString("dd/MMM/yyyy")+"'))<=Year(CONVERT(DATETIME,a.DORelieve)) and CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve)) ",t=t+" or ( CONVERT(DATETIME,'"+l.ToString("dd/MMM/yyyy")+"')<=CONVERT(DATETIME,a.DORelieve))) ",r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(t=t+" AND a.NodeID IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),h.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(t+="  AND a.NodeID IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),r.d.SessionManager.IsRptManagerUser&&r.d.SessionManager.IsActionAssigned(264,"Do not show sub ordinates Data")&&(t+="  AND a.NodeID IN ("+r.d.SessionManager.iEmployee+")"),this.Employee.Code.CustomWhere=this.Employee.Name.CustomWhere=t,Logger.InfoLog("ITComputationViewModel::Exiting FilterEmployees()")}catch(t){Logger.ErrorLog("ITComputationViewModel::EXCEPTION FilterEmployees()"+t.stack)}}}class We{}var Le=G(89731),je=G(39807),Fe=G(54047),pe=G(61488),ve=G(65039);function Ct(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",27),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.PrintForm16_Click("PrintForm16"))}),s.nrm(1,"i",28),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&L&&(s.R7$(2),s.JRh(s.bMT(3,1,"Print")))}function dt(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.btnSave_Click("Export"))}),s.nrm(1,"i",29),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&L&&(s.R7$(2),s.JRh(s.bMT(3,1,"Export")))}function Ee(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.btnSave_Click("Worksheet"))}),s.nrm(1,"i",29),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&L&&(s.R7$(2),s.JRh(s.bMT(3,1,"WorkSheet")))}function we(L,t){if(1&L){const l=s.RV6();s.j41(0,"span",6),s.bIt("click",function(){s.eBV(l);const i=s.XpG();return s.Njj(i.btnSave_Click("TDSPost"))}),s.nrm(1,"i",7),s.EFF(2),s.nI1(3,"translate"),s.k0s()}2&L&&(s.R7$(2),s.JRh(s.bMT(3,1,"TDSPost")))}let be=(()=>{class L{constructor(){this.form=new v.gE({}),this.prevSelectedEmp=0,this.iSelectedEmpSeqNo=0,this.prevSelectReperson=0,this.BasicIndex=-1,this.TotalSalaryIndex=0,this.Form12Section1Index=0,this.Form12Section2Index=0,this.Exemptionsunder10Index=0,this.HRA10BasicIndex=0,this.HRAAcutalIndex=0,this.HRAMetroNonMetroIndex=0,this.HRAExemptionIndex=0,this.TDSPaidIndex=0,this.NetTaxPayableIndex=0,this.InhandAmountIndex=0,this.MonthlyDeducIndex=0,this.intTotalIncometaxPayableindex=0,this.TotAmtOthExemptUs10Index=0,this.ConveyanceIndex=0,this.ChildrenEduIndex=0,this.StandardDedIndex=0,this.MedicalIndex=0,this.LTAIndex=0,this.LeaveEncashIndex=0,this.FoodIndex=0,this.GratuityIndex=0,this.BalanceSalInc12BAIndex=0,this.ProfessionalTaxIndex=0,this.NetTaxableSalIndex=0,this.GrossTotalIncomeIndex=0,this.IncomefromHousePropertyIndex=0,this.intDeducunder8oCto80CCCIndex=0,this.intTotalDeducunder8oCto80CCCIndex=0,this.intOtherDeducunder8oCto80CCCIndex=0,this.dblTotalIncomeIndex=0,this.dblTotalIncomeRoundoffIndex=0,this.intOtherDeducunder8oCto80CCCIndex1=0,this.dblTaxOnTotalIncomeIndex=0,this.dblRebateIndex=0,this.dblTaxPayableAfterRebateIndex=0,this.dblSurchargeIndex=0,this.dblTaxPayableIndex=0,this.dblEducationCessIndex=0,this.dblSecHighEduCessIndex=0,this.NewStandardDedIndex=0,this.NewRegimeStartIndex=0,this.intNewDeducunder8oCto80CCCIndex=0,this.intNewTotalDeducunder8oCto80CCCIndex=0,this.intNewOtherDeducunder8oCto80CCCIndex1=0,this.dblNewTotalIncomeIndex=0,this.dblNewTotalIncomeRoundoffIndex=0,this.dblNewTaxOnTotalIncomeIndex=0,this.dblNewRebateIndex=0,this.dblNewTaxPayableAfterRebateIndex=0,this.dblNewSurchargeIndex=0,this.dblNewTaxPayableIndex=0,this.dblNewEducationCessIndex=0,this.dblNewSecHighEduCessIndex=0,this.intNewTotalIncometaxPayableindex=0,this.NewTDSPaidIndex=0,this.NewNetTaxPayableIndex=0,this.NewNetTaxableSalIndex=0,this.NewGrossTotalIncomeIndex=0,this.intNewOtherDeducunder8oCto80CCCIndex=0,this.dblbalanceSalaryInc12BA=0,this.dblTotalCellSalary=0,this.dPerq1=0,this.dPerq2=0,this.HraMinValue=0,this.dblMedicalAmount=0,this.dblLTAAmount=0,this.dblLeaveEncashAmount=0,this.dblFoodAmount=0,this.dblGratuityAmount=0,this.dblTotaldeduction80ccc80c=0,this.dblNetTaxableSal=0,this.dblGrossTotalIncome=0,this.dblTDS=0,this.dblNetTaxPayable=0,this.dblInhandAmount=0,this.dblSelfletoutamount=0,this.dblTotalIncome=0,this.dblTotalIncomeRoundoff=0,this.dblServiceDays=0,this.dblStandardDeduction=0,this.dblNewStandardDeduction=0,this.dblNewTotaldeduction80ccc80c=0,this.dblNewTotalIncome=0,this.dblNewTotalIncomeRoundoff=0,this.dblNewSelfletoutamount=0,this.dblNewGrossTotalIncome=0,this.dblNewNetTaxableSal=0,this.lstTaxSalbs=new Array,this.lstNewTaxSalbs=new Array,this.bIsNewRegime=!1,this.txtPlace=new ie.Dw,this.dvTaxSlabsData=[],this.dvLimitData=[],this.dtpDate=new Z.Lc}ngOnInit(){this.obj=this.params.obj,this.grdIncomeTax=new je.j,this.grdIncomeTax.ItComput=!0,this.ITComputationViewModel=this.obj,this.BindGridColumns(),this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.ITComputationViewModel.EmpYear.SelectionChangedCommand.Subscribe(this,"cmbYear_SelectionChanged"),this.lstEmployee.SelectionChangedCommand.Subscribe(this,"lstEmployee_SelectionChanged"),this.dtpDate=new Z.Lc,r.d.page.MaximizeTab(this.obj),this.MessageDisplay=""}set MessageDisplay(l){this.ITComputationViewModel.DisplayMessage=l}BindGridColumns(){try{let l=new pe.bA;l.Alignment="Center",l.FontFamilyName="Arial",l.FontSize=12,l.IsBold=!0,l.BackColor="White",l.ForeColor="Black",l.IsVisible=!0;let i,a=new pe.bA;a.Alignment="Left",a.FontFamilyName="Arial",a.FontSize=11,a.IsBold=!1,a.BackColor="White",a.ForeColor="#FF333333",i=new Fe.D_,i.HeaderText="SNo",i.width=10,i.HeaderAppearance=new pe.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=a,this.grdIncomeTax.ReportColumns.push(i),i=new Fe.D_,i.HeaderText="Header",i.width=20,i.HeaderAppearance=new pe.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=a,this.grdIncomeTax.ReportColumns.push(i),i=new Fe.D_,i.HeaderText="ComponentID",i.width=25,i.HeaderAppearance=new pe.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=a,this.grdIncomeTax.ReportColumns.push(i),i=new Fe.D_,i.HeaderText="Salary Breakup",i.width=220,i.HeaderAppearance=l,i.DataAppearance=a,this.grdIncomeTax.ReportColumns.push(i),i=new Fe.D_,i.HeaderText="Investment & Bill Details",i.width=100,i.HeaderAppearance=l,i.DataAppearance=a,this.grdIncomeTax.ReportColumns.push(i);let e,o=0,d=0,m=0,C=0,g=0,y=0,p=0;g=r.d.SessionManager.FinancialYearStartDate.getFullYear(),e=g.toString(),g=parseInt(e.substr(2,2)),y=g+1,o=r.d.SessionManager.AccountingFromMonth,C=o,p=1==C?12:15;for(let u=C;u<=p;u++)if(12==d){m=d-u;for(let T=1;T<=m;T++)i=new Fe.D_,i.HeaderText=this.GetMonthName(T,!1),i.width=65,i.HeaderAppearance=l,i.DataAppearance=a,this.grdIncomeTax.ReportColumns.push(i),u+=1}else i=new Fe.D_,d=o,i.HeaderText=this.GetMonthName(u,!1),i.width=65,i.HeaderAppearance=l,i.DataAppearance=a,this.grdIncomeTax.ReportColumns.push(i);i=new Fe.D_,i.HeaderText="RegimeType",i.width=25,i.HeaderAppearance=new pe.bA,i.HeaderAppearance.IsVisible=!1,i.HeaderAppearance.Alignment="Center",i.HeaderAppearance.FontFamilyName="Arial",i.HeaderAppearance.FontSize=12,i.HeaderAppearance.IsBold=!0,i.HeaderAppearance.BackColor="White",i.HeaderAppearance.ForeColor="Black",i.DataAppearance=a,this.grdIncomeTax.ReportColumns.push(i),i=new Fe.D_,i.HeaderText="Amount",i.width=100,i.HeaderAppearance=l,i.DataAppearance=a,this.grdIncomeTax.ReportColumns.push(i)}catch(l){Logger.ErrorLog("Error : "+l),this.MessageDisplay=l.message}}get lstEmployee(){return this.ITComputationViewModel.Employee.Code}get lstEmployeeName(){return this.ITComputationViewModel.Employee.Name}get cmbYear(){return this.ITComputationViewModel.EmpYear}get cmbRegime(){return this.ITComputationViewModel.EmpRegime}clear(l){this.MessageDisplay="",this.prevSelectedEmp=0,this.prevSelectReperson=0,this.dblbalanceSalaryInc12BA=this.dblTotalCellSalary=this.dPerq1=this.dPerq2=this.HraMinValue=this.dblMedicalAmount=this.dblLTAAmount=this.dblLeaveEncashAmount=this.dblFoodAmount=this.dblGratuityAmount=0,this.dblTotaldeduction80ccc80c=this.dblNetTaxableSal=this.dblGrossTotalIncome=this.dblTotalIncome=this.dblTotalIncomeRoundoff=this.dblServiceDays=this.dblTDS=this.dblNetTaxPayable=this.dblInhandAmount=0,this.dblStandardDeduction=0,this.cmbRegime.SelectedValue="",this.grdIncomeTax.Clear(),this.ITComputationViewModel.txtDesignation="",1==l&&(this.lstEmployee.SelectedValue=this.lstEmployeeName.SelectedValue=this.ITComputationViewModel.lstResponsiblePerson.SelectedValue=null,this.lstEmployee.SelectedValue=this.lstEmployeeName.SelectedValue=this.ITComputationViewModel.lstResponsiblePerson.SelectedValue=null)}btnSave_Click(l){if(null!=l)try{if("Clear"==l)this.clear(1);else if("Save"==l)try{let a=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i=0,o=0,d=0,m="";if(0==a.length){m+="<Rows>";for(let C=0;C<this.grdIncomeTax.Data.length;C++)null!=this.grdIncomeTax.Data[C].Cells[1].Value&&(m+='<row HeaderID="'+this.grdIncomeTax.Data[C].Cells[1].Value,parseFloat(this.grdIncomeTax.Data[C].Cells[2].Value)<0?m+='" HeaderName="'+this.grdIncomeTax.Data[C].Cells[3].Value:m+='" HeaderName="',m+='" ComponentID="'+this.grdIncomeTax.Data[C].Cells[2].Value,i=h.J0.Double(this.grdIncomeTax.Data[C].Cells[4].Value),m+=i>=0?'" ComponentAmount="'+i:'" ComponentAmount="-1',null!=this.grdIncomeTax.Data[C].Cells[17].Value?(d=h.J0.Int(this.grdIncomeTax.Data[C].Cells[17].Value),m+=d>=0?'" RegimeType="'+d:'" RegimeType="0'):m+='" RegimeType="0',o=h.J0.Double(this.grdIncomeTax.Data[C].Cells[17].Value),m+='" TotalAmount="'+o,m+='"/>');m+="</Rows>",this.ITComputationViewModel.sbComputationData=m,this.clear(1)}else m+=a,this.ITComputationViewModel.sbValidation=m;this.ITComputationViewModel.OnSaveITComputation(l)}catch(a){Logger.ErrorLog("Error : "+a)}else if("Delete"==l)try{let a=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i="";0==a.length?(this.ITComputationViewModel.sbComputationData=i,this.clear(1)):(i+=a,this.ITComputationViewModel.sbValidation=i),this.ITComputationViewModel.OnDeleteITComputation(l)}catch(a){Logger.ErrorLog("Error : "+a)}else if("Export"==l){let a=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i="";0==a.length?(this.ITComputationViewModel.sbComputationData=i,this.ExportToExcel()):(i+=a,this.ITComputationViewModel.sbValidation=i)}else if("Worksheet"==l){if(null==this.dtpDate.Date&&(this.dtpDate.Date=new Date),!(this.lstEmployee.SelectedValue>0))return this.ITComputationViewModel.DisplayMessage="Select any Employee",void(this.ITComputationViewModel.MessageVisibility=!0);this.txtPlace.Text.Trim(),this.dtpDate.Date.ToString("dd/MMM/yyyy"),this.WorkSheetPrintGrid(),this.Form16export()}else if("SaveRegime"==l)try{let a=this.ValidateData();this.ITComputationViewModel.sbValidation=null,this.ITComputationViewModel.sbComputationData=null;let i="";0==a.length?this.ITComputationViewModel.sbComputationData=i:(i+=a,this.ITComputationViewModel.sbValidation=i),this.ITComputationViewModel.OnSaveRegimeITComputation(l)}catch(a){Logger.ErrorLog("Error : "+a)}else if("TDSPost"==l)try{if(!(this.iSelectedEmpSeqNo>0))return this.ITComputationViewModel.DisplayMessage="Select any Employee",void(this.ITComputationViewModel.MessageVisibility=!0);if(this.dvEmpTaxComputation=this.dsTaxData.Tables[21],!(null!=this.dvEmpTaxComputation&&this.dvEmpTaxComputation.length>0))return this.ITComputationViewModel.DisplayMessage="Please Save Income Tax Computation",void(this.ITComputationViewModel.MessageVisibility=!0);if(this.dvEmpTaxComputation.RowFilter="",null==this.cmbRegime.SelectedValue)return this.ITComputationViewModel.DisplayMessage="Please Save Regime Opted For",void(this.ITComputationViewModel.MessageVisibility=!0);if(this.dvEmpTaxComputation="New"==this.cmbRegime.SelectedValue.toString()?this.dsTaxData.Tables[21].filter(a=>-122==a.ComponentID&&1==a.RegimeType):this.dsTaxData.Tables[21].filter(a=>-122==a.ComponentID&&0==a.RegimeType),this.dvEmpTaxComputation.length>0&&(this.ITComputationViewModel.dTotalTaxAmount=parseFloat(this.dvEmpTaxComputation[0].TotalAmount)),this.dvEmpTaxComputation="New"==this.cmbRegime.SelectedValue.toString()?this.dsTaxData.Tables[21].filter(a=>-123==a.ComponentID&&1==a.RegimeType):this.dsTaxData.Tables[21].filter(a=>-123==a.ComponentID&&0==a.RegimeType),this.dvEmpTaxComputation.length>0&&(this.ITComputationViewModel.dTDSPaidAmount=parseFloat(this.dvEmpTaxComputation[0].TotalAmount)),this.dvEmpTaxComputation="New"==this.cmbRegime.SelectedValue.toString()?this.dsTaxData.Tables[21].filter(a=>-124==a.ComponentID&&1==a.RegimeType):this.dsTaxData.Tables[21].filter(a=>-124==a.ComponentID&&0==a.RegimeType),this.dvEmpTaxComputation.length>0&&(this.ITComputationViewModel.dPayableTDSAmount=parseFloat(this.dvEmpTaxComputation[0].TotalAmount)),null!=this.dsTaxData&&this.dsTaxData.Tables.length>19&&this.dsTaxData.Tables[19].length>0){let a=this.dsTaxData.Tables[19].filter(i=>"TDS"==i.TaxmapName&&"Monthly"==i.FieldType);null!=a&&a.length>0&&(this.ITComputationViewModel.iCompnentID=parseInt(a[0].componentID))}this.ITComputationViewModel.OnTDSPostITComputation(l)}catch{}}catch(a){Logger.ErrorLog("Error : "+a),this.MessageDisplay=a.message}}WorkSheetPrintGrid(){this.grdPrint=new je.j,this.grdPrint.Data.Clear(),this.grdPrint.ReportColumns.Clear();let l=new pe.bA;l.Alignment="Center",l.FontFamilyName="Arial",l.FontSize=12,l.IsBold=!0,l.BackColor="White",l.ForeColor="Black",l.IsVisible=!0;let i,a=new pe.bA;a.Alignment="Left",a.FontFamilyName="Arial",a.FontSize=12,a.IsBold=!0,a.BackColor="White",a.ForeColor="#FF333333";for(let d=1;d<=10;d++)i=new Fe.D_,i.FieldName="Col"+d.toString(),i.width=70,i.HeaderText="Col"+d.toString(),i.HeaderAppearance=l,i.DataAppearance=a,this.grdPrint.ReportColumns.push(i);this.grdPrint.ReportColumns[0].width=60,this.grdPrint.ReportColumns[3].width=90,this.grdPrint.ReportColumns[4].width=90,this.grdPrint.ReportColumns[5].width=90,this.grdPrint.ReportColumns[6].width=80,this.grdPrint.ReportColumns[7].width=80,this.grdPrint.ReportColumns[8].width=80,this.grdPrint.ReportColumns[9].width=80;let o=0;this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[o].Cells[0].Value="WorkSheet\nEmployee Code : "+this.ITComputationViewModel.Employee.Code.Text+", Employee Name : "+this.ITComputationViewModel.Employee.Name.Text+"\nFinancial Year : "+this.dtFromMonth.getFullYear()+" - "+this.dtToMonth.getFullYear()+", Assessment Year : "+this.dtFromMonth.AddYears(1).getFullYear()+" - "+this.dtToMonth.AddYears(1).getFullYear(),this.grdPrint.Data[o].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[0].ColSpan=10,o++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[o].Cells[0].Value="Salary Breakup",this.grdPrint.Data[o].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[0].ColSpan=5,this.grdPrint.Data[o].Cells[5].Value="Investment & Bill Details",this.grdPrint.Data[o].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[5].ColSpan=1,this.grdPrint.Data[o].Cells[6].Value="Post Past",this.grdPrint.Data[o].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[6].ColSpan=1,this.grdPrint.Data[o].Cells[7].Value="Actual",this.grdPrint.Data[o].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[7].ColSpan=1,this.grdPrint.Data[o].Cells[8].Value="Projection",this.grdPrint.Data[o].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[8].ColSpan=1,this.grdPrint.Data[o].Cells[9].Value="Amount",this.grdPrint.Data[o].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[o].Cells[9].ColSpan=1;for(let d=0;d<this.grdIncomeTax.Data.length;d++){let m;o++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[o].Cells[0].Value=null!=this.grdIncomeTax.Data[d].Cells[3].Value&&""!=this.grdIncomeTax.Data[d].Cells[3].Value.toString()?this.grdIncomeTax.Data[d].Cells[3].Value:"",this.grdPrint.Data[o].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[o].Cells[0].ColSpan=5,this.grdPrint.Data[o].Cells[5].Value=null!=this.grdIncomeTax.Data[d].Cells[4].Value&&""!=this.grdIncomeTax.Data[d].Cells[4].Value.toString()&&h.J0.DoubleTryParse(this.grdIncomeTax.Data[d].Cells[4].Value.toString())?parseFloat(this.grdIncomeTax.Data[d].Cells[4].Value).toString():"",this.grdPrint.Data[o].Cells[5].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[5].ColSpan=1;let C=0,g=0,y=0;for(let p=5;p<this.grdIncomeTax.ReportColumns.length;p++)null!=this.grdIncomeTax.ReportColumns[p].Tag&&null!=this.grdIncomeTax.ReportColumns[p].Tag&&""!=this.grdIncomeTax.ReportColumns[p].Tag.toString()&&("Past"==this.grdIncomeTax.ReportColumns[p].Tag?(m=h.J0.DoubleTryParse(this.grdIncomeTax.Data[d].Cells[p].Value.toString()),C+=null!=this.grdIncomeTax.Data[d].Cells[p].Value&&""!=this.grdIncomeTax.Data[d].Cells[p].Value.toString()&&h.J0.DoubleTryParse(this.grdIncomeTax.Data[d].Cells[p].Value.toString())?parseFloat(this.grdIncomeTax.Data[d].Cells[p].Value):0):"Processed"==this.grdIncomeTax.ReportColumns[p].Tag?g+=null!=this.grdIncomeTax.Data[d].Cells[p].Value&&""!=this.grdIncomeTax.Data[d].Cells[p].Value.toString()&&h.J0.DoubleTryParse(this.grdIncomeTax.Data[d].Cells[p].Value.toString())?parseFloat(this.grdIncomeTax.Data[d].Cells[p].Value):0:"Future"==this.grdIncomeTax.ReportColumns[p].Tag&&(y+=null!=this.grdIncomeTax.Data[d].Cells[p].Value&&""!=this.grdIncomeTax.Data[d].Cells[p].Value.toString()&&h.J0.DoubleTryParse(this.grdIncomeTax.Data[d].Cells[p].Value.toString())?parseFloat(this.grdIncomeTax.Data[d].Cells[p].Value):0));this.grdPrint.Data[o].Cells[6].Value=d<=this.TotalSalaryIndex||d>this.MonthlyDeducIndex?C.toString():"",this.grdPrint.Data[o].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[6].ColSpan=1,this.grdPrint.Data[o].Cells[7].Value=d<=this.TotalSalaryIndex||d>this.MonthlyDeducIndex?g.toString():"",this.grdPrint.Data[o].Cells[7].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[7].ColSpan=1,this.grdPrint.Data[o].Cells[8].Value=d<=this.TotalSalaryIndex||d>this.MonthlyDeducIndex?y.toString():"",this.grdPrint.Data[o].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[8].ColSpan=1,15!=d&&41!=d&&(this.grdPrint.Data[o].Cells[9].Value=null!=this.grdIncomeTax.Data[d].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[d].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[d].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00"),this.grdPrint.Data[o].Cells[9].CellAppearance.Alignment="Right",this.grdPrint.Data[o].Cells[9].ColSpan=1}}ExportToExcel(){this.export()}export(){var l=this;return(0,de.A)(function*(){let a="Income Tax Computation\nEmployee Code : "+l.ITComputationViewModel.Employee.Code.Text+", Employee Name : "+l.ITComputationViewModel.Employee.Name.Text+"\nFinancial Year : "+l.dtFromMonth.getFullYear()+" - "+l.dtToMonth.getFullYear()+", Assessment Year : "+(l.dtFromMonth.getFullYear()+1)+" - "+(l.dtToMonth.getFullYear()+1),i=l.generatePrintContent(l.grdIncomeTax,a,!0);const o=new Blob([i],{type:"text/plain;charser=utf-8"});(0,xt.saveAs)(o,"ITFile.xls")})()}Form16export(){var l=this;return(0,de.A)(function*(){let a=l.generatePrintContent(l.grdPrint,"",!1,!0);const i=new Blob([a],{type:"text/plain;charser=utf-8"});(0,xt.saveAs)(i,"TAX_PLACE_DATE_Form.xls")})()}getExcelColumnName(l){let o,a=l+1,i="";for(;a>0;)o=(a-1)%26,i=String.fromCharCode(65+o)+i,a=Math.floor((a-o)/26);return i}GetExportHTML(l){Logger.InfoLog("PostedDocumentViewModel:: inside GetExportHTML ");let a="",i="";a+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",i+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",i+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",i+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",i+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",a+="<style>"+i.toString()+"</style>";let m,d=0;for(let C=0;C<this.grdIncomeTax.ReportColumns.length;C++)d+=this.grdIncomeTax.ReportColumns[C].width;a+="<table>",a+="\r\n<tr><td align='center'><h2>",a+=r.d.SessionManager.CompanyName,a+="</h2></td></tr>",a+="\r\n<tr><td align='center'><h3 style='vertical-align:middl;'>",a+=l,a+="</h3></td></tr>",a+="\r\n<tr><td align='center'>",a+=" From :  "+this.dtFromMonth.ToString(r.d.SessionManager.Preferences["Date Format"]),a+=" &nbs;&nbsp;&nbsp;To :  "+this.dtToMonth.ToString(r.d.SessionManager.Preferences["Date Format"]),a+="</td></tr>",a+="<tr><td style='padding-top:10p;'><table border=1 width='"+d+"' style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",a+="<COLGROUP>";for(let C=0;C<this.grdIncomeTax.ReportColumns.length;C++)h.J0.IsEmpty(this.grdIncomeTax.ReportColumns[C].ColumnType)||"FLOAT"!=this.grdIncomeTax.ReportColumns[C].ColumnType?a+="<COL style=''>":a+="<COL style='text-align:righ;'>";a+="</COLGROUP>",a+="<tr style=''>";for(let C=0;C<this.grdIncomeTax.ReportColumns.length;C++)a+="<th class='hdr' width='"+this.grdIncomeTax.ReportColumns[C].width,a+="' >",a+=this.grdIncomeTax.ReportColumns[C].HeaderText,a+="</th>";a+="</tr>";for(let C=0;C<this.grdIncomeTax.Data.length;C++){a+="<tr",C%2==1&&(a+=" class=alt"),a+=">";for(let g=0;g<this.grdIncomeTax.ReportColumns.length;g++)a+="<td",h.J0.IsEmpty(this.grdIncomeTax.ReportColumns[g].ColumnType)||"FLOAT"!=this.grdIncomeTax.ReportColumns[g].ColumnType?a+=" align='left'":a+=" align='right'",a+=">",h.J0.IsEmpty(this.grdIncomeTax.ReportColumns[g].ColumnType),m=this.grdIncomeTax.ReportColumns.indexOf(this.grdIncomeTax.ReportColumns[g]),this.grdIncomeTax.ReportColumns.Contains(m)&&(a+=h.J0.String(this.grdIncomeTax.Data[C].Cells[m].Text)),a+="</td>";a+="</tr>"}return a+="</table>",a+="</td></tr></table>",a+="</body><html>",Logger.InfoLog("PostedDocumentViewModel:: exiting GetExportHTML "),a}ValidateData(){let l="";return null==this.lstEmployee.SelectedValue&&(l="Please select the Employee."),l}GetMonthName(l,a){l>12&&(l-=12);let i="";switch(l){case 1:i=a?"January":"Jan";break;case 2:i=a?"February":"Feb";break;case 3:i=a?"March":"Mar";break;case 4:i=a?"April":"Apr";break;case 5:i="May";break;case 6:i=a?"June":"Jun";break;case 7:i=a?"July":"Jul";break;case 8:i=a?"August":"Aug";break;case 9:i=a?"September":"Sep";break;case 10:i=a?"October":"Oct";break;case 11:i=a?"November":"Nov";break;case 12:i=a?"December":"Dec"}return i}lstEmployee_SelectionChanged(l){this.lstEmployee.SelectedValue!=this.prevSelectedEmp&&(this.lstEmployeeName.SelectedValue=this.lstEmployee.SelectedValue,this.clear(0),this.prevSelectedEmp=this.lstEmployee.SelectedValue,this.iSelectedEmpSeqNo=this.lstEmployee.SelectedValue,this.ITComputationViewModel.Employee_SelectedValueChanged(l),this.FillDetails())}grdIncomeTax_CellEndEdit(l){if(4==l.ColumnIndex){let a=0;try{a=parseFloat(this.grdIncomeTax.Data[l.RowIndex][l.ColumnIndex]),a<0&&(a=0)}catch{}if(l.RowIndex==this.IncomefromHousePropertyIndex||l.RowIndex==this.IncomefromHousePropertyIndex+1||l.RowIndex==this.IncomefromHousePropertyIndex+2||l.RowIndex==this.IncomefromHousePropertyIndex+3||l.RowIndex==this.IncomefromHousePropertyIndex+4)return;l.RowIndex>=this.intDeducunder8oCto80CCCIndex&&l.RowIndex<this.intTotalDeducunder8oCto80CCCIndex||(this.grdIncomeTax.Data[l.RowIndex][this.grdIncomeTax.ReportColumns.length-1]=h.J0.GetAmount(a)),this.dblbalanceSalaryInc12BA=this.dblTotalCellSalary+this.dPerq1+this.dPerq2-(this.HraMinValue+parseFloat(this.grdIncomeTax.Data[this.ConveyanceIndex][this.grdIncomeTax.ReportColumns.length-1].Value)+parseFloat(this.grdIncomeTax.Data[this.ChildrenEduIndex][this.grdIncomeTax.ReportColumns.length-1].Value)+parseFloat(this.grdIncomeTax.Data[this.MedicalIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.LTAIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.LeaveEncashIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.FoodIndex][4].Value)+parseFloat(this.grdIncomeTax.Data[this.GratuityIndex][4].Value)+this.dblStandardDeduction),this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex][this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblbalanceSalaryInc12BA),a=parseFloat(this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex][this.grdIncomeTax.ReportColumns.length-1].Value)-parseFloat(this.grdIncomeTax.Data[this.ProfessionalTaxIndex][this.grdIncomeTax.ReportColumns.length-1].Value),this.grdIncomeTax.Data[this.NetTaxableSalIndex][this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(a),this.dblGrossTotalIncome=0,this.dblGrossTotalIncome=a+this.dblSelfletoutamount-parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4][this.grdIncomeTax.ReportColumns.length-1].Value),this.grdIncomeTax.Data[this.GrossTotalIncomeIndex][this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblGrossTotalIncome);let i=0,o=0;if(this.dvLimit=this.dvLimitData.filter(C=>995==C.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(o=parseFloat(this.dvLimit[0].AmountLimit)),l.RowIndex>=this.intDeducunder8oCto80CCCIndex&&l.RowIndex<=this.intTotalDeducunder8oCto80CCCIndex){let C=0;for(let g=this.intDeducunder8oCto80CCCIndex+1;g<this.intTotalDeducunder8oCto80CCCIndex;g++)this.dvLimit=this.dvLimitData.filter(y=>y.ComponentID==parseInt(this.grdIncomeTax.Data[g].Cells[2].Value)),this.dvLimit.length>0&&(i=h.J0.Double(this.dvLimit[0].AmountLimit),i>0&&parseInt(this.grdIncomeTax.Data[g].Cells[2].Value)==parseInt(this.dvLimit[0].ComponentID)&&parseFloat(this.grdIncomeTax.Data[g].Cells[l.ColumnIndex].Value)>i&&(this.grdIncomeTax.Data[g].Cells[l.ColumnIndex].Value=h.J0.GetAmount(i),this.grdIncomeTax.Data[g].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(i))),C+=parseFloat(this.grdIncomeTax.Data[g].Cells[l.ColumnIndex].Value);this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex][4].Value=h.J0.GetAmount(C),C>o&&(C=o),this.dblTotaldeduction80ccc80c=C,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex][this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblTotaldeduction80ccc80c)}let m=0;for(let C=this.intOtherDeducunder8oCto80CCCIndex;C<=this.intOtherDeducunder8oCto80CCCIndex1;C++)this.dvLimit=this.dvLimitData.filter(g=>g.ComponentID==parseInt(this.grdIncomeTax.Data[C].Cells[2].Value)),this.dvLimit.length>0&&(i=h.J0.Double(this.dvLimit[0].AmountLimit),i>0&&parseInt(this.grdIncomeTax.Data[C].Cells[2].Value)==parseInt(this.dvLimit[0].ComponentID)&&parseFloat(this.grdIncomeTax.Data[C].Cells[l.ColumnIndex].Value)>i&&(this.grdIncomeTax.Data[C].Cells[l.ColumnIndex].Value=h.J0.GetAmount(i),this.grdIncomeTax.Data[C].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(i))),m+=parseFloat(this.grdIncomeTax.Data[C].Cells[l.ColumnIndex].Value);this.grdIncomeTax.Data[this.dblTotalIncomeIndex][this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblGrossTotalIncome-this.dblTotaldeduction80ccc80c-m),this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex][this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(Math.round(this.dblGrossTotalIncome-this.dblTotaldeduction80ccc80c-m)),this.UpdateTotals(parseFloat(this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex][this.grdIncomeTax.ReportColumns.length-1].Value))}}UpdateTotals(l){let a=0;for(let p=0;p<this.lstTaxSalbs.length&&l>0;p++)if(0==p){if(l<this.lstTaxSalbs[p].ToSlab){a+=l*this.lstTaxSalbs[p].Percentage;break}a+=this.lstTaxSalbs[p].ToSlab*this.lstTaxSalbs[p].Percentage}else{if(l<this.lstTaxSalbs[p].ToSlab){a+=(l-this.lstTaxSalbs[p-1].ToSlab)*this.lstTaxSalbs[p].Percentage;break}a+=(this.lstTaxSalbs[p].ToSlab-this.lstTaxSalbs[p-1].ToSlab)*this.lstTaxSalbs[p].Percentage}this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(Math.round(a));let i=0,o=0;o=h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value),o>0&&(parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)<2016?l<=5e5&&(i=2e3):2016==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?l<=5e5&&(i=5e3):2017==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)||2018==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?l<=35e4&&(i=2500):parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2019&&l<=5e5&&(i=12500)),this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(o<i?Math.round(o):Math.round(i)),o-i<0?(this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=0,a=0):(this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(o-i),a=o-i);let C,d=0,m=null,g=new le.bT;if(this.dsTaxData.Tables[7].length>0){let p;C=new Le.Nl("Basic",""),g.push("Basic",C),g.Basic.setFieldValue(parseFloat(this.dsTaxData.Tables[3][0].BasicMonthly).toString()),C=new Le.Nl("TotalIncome",""),g.push("TotalIncome",C),g.TotalIncome.setFieldValue(this.dblTotalIncomeRoundoff),m=this.dsTaxData.Tables[8];let u=this.dsTaxData.Tables[3];if(m=this.dsTaxData.Tables[8].filter(T=>1==T.Type&&"OverTime"!=T.FieldType),m.length>0)for(let T=0;T<m.length;T++)p=this.dsTaxData.Tables[8].filter(A=>A.ComponentID==m[T].ComponentID),null!=p&&p.length>0&&(C=new Le.Nl(m[T].ComponentName.toString(),""),g.push(m[T].ComponentName.toString(),C),g[m[T].ComponentName.toString()].setFieldValue(u[0]["Earning"+p[0].SNo.toString()].toString()));if(m=this.dsTaxData.Tables[8].filter(T=>2==T.Type&&"OverTime"!=T.FieldType),m.length>0)for(let T=0;T<m.length;T++)p=this.dsTaxData.Tables[8].filter(A=>A.ComponentID==m[T].ComponentID),null!=p&&p.length>0&&(C=new Le.Nl(m[T].ComponentName.toString(),""),g.push(m[T].ComponentName.toString(),C),g[m[T].ComponentName.toString()].setFieldValue(u[0]["Deduction"+p[0].SNo.toString()].toString()))}let y=g;this.dvTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].Surcharge&&null!=this.dvTaxSlabs[0].Surcharge&&""!=this.dvTaxSlabs[0].Surcharge.toString().Trim()&&(d=parseFloat(r.d.eval.EvaluateExpression(this.dvTaxSlabs[0].Surcharge.toString(),y))),this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[3].Value="Surcharge @ "+d+"%",this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=(l=a*d/100)>0?h.J0.GetAmount(Math.round(l)):0,a+=Math.round(l),this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=a>0?h.J0.GetAmount(a):0,d=0,this.dvTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].EducationCess&&null!=this.dvTaxSlabs[0].EducationCess&&""!=this.dvTaxSlabs[0].EducationCess.toString().Trim()&&(d=parseFloat(r.d.eval.EvaluateExpression(this.dvTaxSlabs[0].EducationCess.toString(),y))),this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[3].Value="Education Cess @ "+d+"%",l=a*d/100,a+=Math.round(l),this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?h.J0.GetAmount(Math.round(l)):0,d=0,this.dvTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].SecondaryandHighEduc&&null!=this.dvTaxSlabs[0].SecondaryandHighEduc&&""!=this.dvTaxSlabs[0].SecondaryandHighEduc.toString().Trim()&&(d=parseFloat(r.d.eval.EvaluateExpression(this.dvTaxSlabs[0].SecondaryandHighEduc.toString(),y))),this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[3].Value="Secondary and Higher Education Cess @ "+d+"%",l=a*d/100,a+=Math.round(l),this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?h.J0.GetAmount(Math.round(l)):0,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=a>0?h.J0.GetAmount(Math.round(a)):0,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(parseFloat(this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)-parseFloat(this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value))}UpdateTotalsNewRegime(l){let a=0;for(let p=0;p<this.lstNewTaxSalbs.length&&l>0;p++)if(0==p){if(l<this.lstNewTaxSalbs[p].ToSlab){a+=l*this.lstNewTaxSalbs[p].Percentage;break}a+=this.lstNewTaxSalbs[p].ToSlab*this.lstNewTaxSalbs[p].Percentage}else{if(l<this.lstNewTaxSalbs[p].ToSlab){a+=(l-this.lstNewTaxSalbs[p-1].ToSlab)*this.lstNewTaxSalbs[p].Percentage;break}a+=(this.lstNewTaxSalbs[p].ToSlab-this.lstNewTaxSalbs[p-1].ToSlab)*this.lstNewTaxSalbs[p].Percentage}this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(Math.round(a));let i=0,o=0;o=parseFloat(this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value),o>0&&parseInt(this.cmbYear.SelectedValue)>=2023&&l<=7e5&&(i=25e3),this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(o<i?Math.round(o):Math.round(i)),o-i<0?(this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=0,a=0):(this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(o-i),a=o-i);let C,d=0,m=null,g=new le.bT;if(this.dsTaxData.Tables[7].length>0){let p;C=new Le.Nl("Basic",""),g.push("Basic",C),g.Basic.setFieldValue(parseFloat(this.dsTaxData.Tables[3][0].BasicMonthly).toString()),C=new Le.Nl("TotalIncome",""),g.push("TotalIncome",C),g.TotalIncome.setFieldValue(this.dblNewTotalIncomeRoundoff),m=this.dsTaxData.Tables[8];let e=this.dsTaxData.Tables[3];if(m=this.dsTaxData.Tables[8].filter(u=>1==u.Type&&"OverTime"!=u.FieldType),m.length>0)for(let u=0;u<m.length;u++)p=this.dsTaxData.Tables[8].filter(T=>T.ComponentID==m[u].ComponentID),null!=p&&p.length>0&&(C=new Le.Nl(m[u].ComponentName.toString(),""),g.push(m[u].ComponentName.toString(),C),g[m[u].ComponentName.toString()].setFieldValue(e[0]["Earning"+p[0].SNo.toString()].toString()));if(m=this.dsTaxData.Tables[8].filter(u=>2==u.Type&&"OverTime"!=u.FieldType),m.length>0)for(let u=0;u<m.length;u++)p=this.dsTaxData.Tables[8].filter(T=>T.ComponentID==m[u].ComponentID),null!=p&&p.length>0&&(C=new Le.Nl(m[u].ComponentName.toString(),""),g.push(m[u].ComponentName.toString(),C),g[m[u].ComponentName.toString()].setFieldValue(e[0]["Deduction"+p[0].SNo.toString()].toString()))}let y=g;this.dvNewTaxSlabs.length>0&&null!=this.dvTaxSlabs[0].Surcharge&&""!=this.dvNewTaxSlabs[0].Surcharge.toString().Trim()&&(d=parseFloat(r.d.eval.EvaluateExpression(this.dvNewTaxSlabs[0].Surcharge.toString(),y))),this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[3].Value="Surcharge @ "+d+"%",this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=(l=a*d/100)>0?h.J0.GetAmount(Math.round(l)):0,a+=Math.round(l),this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=a>0?h.J0.GetAmount(a):0,d=0,this.dvNewTaxSlabs.length>0&&null!=this.dvNewTaxSlabs[0].EducationCess&&""!=this.dvNewTaxSlabs[0].EducationCess.toString().Trim()&&(d=parseFloat(r.d.eval.EvaluateExpression(this.dvNewTaxSlabs[0].EducationCess.toString(),y))),this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[3].Value="Education Cess @ "+d+"%",l=a*d/100,a+=Math.round(l),this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?h.J0.GetAmount(Math.round(l)):0,d=0,this.dvNewTaxSlabs.length>0&&null!=this.dvNewTaxSlabs[0].SecondaryandHighEduc&&""!=this.dvNewTaxSlabs[0].SecondaryandHighEduc.toString().Trim()&&(d=parseFloat(r.d.eval.EvaluateExpression(this.dvNewTaxSlabs[0].SecondaryandHighEduc.toString(),y))),this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[3].Value="Secondary and Higher Education Cess @ "+d+"%",l=a*d/100,a+=Math.round(l),this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=l>0?h.J0.GetAmount(Math.round(l)):0,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=a>0?h.J0.GetAmount(Math.round(a)):0,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(parseFloat(this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)-parseFloat(this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value))}FillDetails(){try{let l=0,a=0,i=0,o=(new Date).OnlyDate(),d="";this.dsTaxData=this.ITComputationViewModel.dsITComputation;let m=this.dsTaxData.Tables[0],C=this.dsTaxData.Tables[22],g=this.dsTaxData.Tables[1],y=this.dsTaxData.Tables[2],p=this.dsTaxData.Tables[2];p=this.dsTaxData.Tables[2].filter(S=>"1"==S.ComponentType);let e=this.dsTaxData.Tables[3],u=this.dsTaxData.Tables[18];this.dvTaxSlabsData=this.dsTaxData.Tables[7],this.dvTaxSlabs=this.dsTaxData.Tables[7];let T=this.dsTaxData.Tables[15].filter(S=>"Old"==S.Regime);null!=T&&T.length>0&&(this.dvLimit=T,this.dvLimitData=this.dvLimit);let A=this.dsTaxData.Tables[15].filter(S=>"New"==S.Regime);null!=A&&A.length>0&&(this.dvNewLimit=A);let k=this.dsTaxData.Tables[7].filter(S=>"New"==S.RegimeType);if(null!=k&&k.length>0&&parseInt(this.cmbYear.SelectedValue)>=2020&&(!h.J0.IsEmpty(this.dvNewLimit)&&this.dvNewLimit.length>0?this.bIsNewRegime=!0:d+="Income tax amount limit data not avalilable for the selected year in New Regime"),this.dvEmpTaxComputation=this.dsTaxData.Tables[21],m.length>0&&(m=this.dsTaxData.Tables[0].filter(S=>"IT_BASIC"==S.MapFieldName),0==m.length&&(d+="Basic component is not available,Please map component in the payroll strucuture\r\n")),0==e.length&&(d+="Employee Payroll information not available\r\n"),!h.J0.IsEmpty(this.dvLimit)&&0==this.dvLimit.length&&(d+="Income tax amount limit data not avalilable for the selected year"),""!=d.toString())return this.MessageDisplay=d,this.ITComputationViewModel.MessageDisplay=d,void(this.ITComputationViewModel.MessageVisibility=!0);this.dsTaxData.Tables.length>26&&this.dsTaxData.Tables[26].length>0&&this.dsTaxData.Columns[26].Contains("RegimeType")&&null!=this.dsTaxData.Tables[26][0].RegimeType&&null!=this.dsTaxData.Tables[26][0].RegimeType&&""!=this.dsTaxData.Tables[26][0].RegimeType.toString()&&(this.cmbRegime.SelectedValue=this.dsTaxData.Tables[26][0].RegimeType.toString()),this.dblServiceDays=0,this.dtDateofJoining=h.J0.ParseDate(u[0].CDOJ),this.dtFromMonth=new Date(parseInt(this.ITComputationViewModel.EmpYear.SelectedValue),r.d.SessionManager.AccountingFromMonth-1,1),this.dtToMonth=this.dtFromMonth.AddYears(1).AddDays(-1),this.dblServiceDays=o.Subtract(this.dtDateofJoining).Days+1;let x=0,F=0,_=0,f={iY:x,iM:F,iD:_};h.J0.GetYearsMonthsDays(h.J0.ParseDate(u[0].CDOB),this.dtToMonth.OnlyDate(),f),x=f.iY,F=f.iM,_=f.iD,this.dvTaxSlabs=this.dvTaxSlabsData.filter(x>=80?S=>"SuperSeniorCitizen"==S.Gender&&"Old"==S.RegimeType:x>=60?S=>"SeniorCitizen"==S.Gender&&"Old"==S.RegimeType:S=>S.Gender==h.J0.String(u[0].GenderName)&&"Old"==S.RegimeType),this.lstTaxSalbs.Clear();for(let S=0;S<this.dvTaxSlabs.length;S++)this.lstTaxSalbs.push(new nt),this.lstTaxSalbs[S].FromSlab=parseFloat(this.dvTaxSlabs[S].Fromslab),this.lstTaxSalbs[S].ToSlab=parseFloat(this.dvTaxSlabs[S].Toslab),this.lstTaxSalbs[S].Percentage=parseFloat(this.dvTaxSlabs[S].Percentage)/100;i=17,a=5;for(let S=5;S<this.grdIncomeTax.ReportColumns.length;S++)this.grdIncomeTax.ReportColumns[S].HeaderText.toString()==h.J0.StringValue(C[0].Month)&&(a=this.grdIncomeTax.ReportColumns.indexOf(this.grdIncomeTax.ReportColumns[S])),!h.J0.IsEmpty(C[0].RelieveMonth)&&this.grdIncomeTax.ReportColumns[S].HeaderText.toString()==h.J0.StringValue(C[0].RelieveMonth)&&(i=this.grdIncomeTax.ReportColumns.indexOf(this.grdIncomeTax.ReportColumns[S]));let E=0,N=0;this.dsTaxData.Tables[0].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[0].length);let W,ae=0,z=0;for(let S=0;S<this.dsTaxData.Tables[0].length;S++){if(W=new Array,E=5,ae=0,z=0,this.grdIncomeTax.Data[S].Cells[17].Value=0,this.grdIncomeTax.Data[S].Cells[0].Value=this.dsTaxData.Tables[0][S].SNo,this.grdIncomeTax.Data[S].Cells[2].Value=this.dsTaxData.Tables[0][S].componentID,this.grdIncomeTax.Data[S].Cells[3].Value=this.dsTaxData.Tables[0][S].SalaryBreakup,this.grdIncomeTax.Data[S].Cells[3].CellAppearance=new pe.bA,this.grdIncomeTax.Data[S].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[S].Cells[3].ColSpan=2,null!=this.dsTaxData.Tables[0][S].MapFieldName&&null!=this.dsTaxData.Tables[0][S].MapFieldName&&"IT_BASIC"==this.dsTaxData.Tables[0][S].MapFieldName.toString().Trim()&&(this.BasicIndex=S),parseInt(this.dsTaxData.Tables[0][S].SNo)>0){for(let K=0;K<g.length;K++)for(let j=5;j<this.grdIncomeTax.ReportColumns.length;j++)if(!W.Contains(this.grdIncomeTax.ReportColumns[j].HeaderText)&&g[K].month.toString()==this.grdIncomeTax.ReportColumns[j].HeaderText.toString()){this.grdIncomeTax.ReportColumns[j].Tag="Processed",W.push(this.grdIncomeTax.ReportColumns[j].HeaderText),l=0,h.J0.IsEmpty(g[K]["dcCalcNum"+this.dsTaxData.Tables[0][S].SNo.toString()])||(l=parseFloat(g[K]["dcCalcNum"+this.dsTaxData.Tables[0][S].SNo.toString()])),this.grdIncomeTax.Data[S].Cells[j].Value=l>0?h.J0.GetAmount(l):0,this.grdIncomeTax.Data[S].Cells[j].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[j].IsNormal=!1,z=h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].Value)+l,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].Value=h.J0.GetAmount(z),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.IsBold=!0,ae+=l;break}for(let K=0;K<p.length;K++)for(let j=5;j<this.grdIncomeTax.ReportColumns.length;j++)if(parseInt(this.dsTaxData.Tables[0][S].componentID)==parseInt(p[K].componentid)&&p[K].FieldName.toString()==this.grdIncomeTax.ReportColumns[j].HeaderText.toString()&&!h.J0.IsEmpty(p[K].Amount)&&parseFloat(p[K].Amount)>0&&!W.Contains(this.grdIncomeTax.ReportColumns[j].HeaderText)){W.push(this.grdIncomeTax.ReportColumns[j].HeaderText),l=0,h.J0.IsEmpty(p[K].Amount)||(l=parseFloat(p[K].Amount)),this.grdIncomeTax.Data[S].Cells[j].Value=l>0?h.J0.GetAmount(l):0,this.grdIncomeTax.Data[S].Cells[j].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[j].IsNormal=!1,z=h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].Value)+l,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].Value=h.J0.GetAmount(z),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[j].CellAppearance.IsBold=!0,ae+=l;break}if(0==e.length)return;for(let K=0;K<e.length;K++)for(E=a;E<i;E++)!W.Contains(this.grdIncomeTax.ReportColumns[E].HeaderText)&&h.J0.IntegerValue(this.grdIncomeTax.Data[S].Cells[E].Value)<=0&&(this.grdIncomeTax.ReportColumns[E].Tag="Future",W.push(this.grdIncomeTax.ReportColumns[E].HeaderText),l=parseFloat(e[K]["Earning"+this.dsTaxData.Tables[0][S].SNo.toString()]),this.grdIncomeTax.Data[S].Cells[E].Value=l>0?h.J0.GetAmount(l):0,this.grdIncomeTax.Data[S].Cells[E].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[E].IsNormal=!1,z=h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].Value)+l,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].Value=h.J0.GetAmount(z),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[E].CellAppearance.IsBold=!0,ae+=l)}E=this.grdIncomeTax.ReportColumns.length-1,this.dblTotalCellSalary=this.dblTotalCellSalary+ae,parseInt(this.dsTaxData.Tables[0][S].SNo)>0?(this.grdIncomeTax.Data[S].Cells[E].Value=h.J0.GetAmount(ae),this.grdIncomeTax.Data[S].Cells[E].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[E].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[S].Cells[E].CellAppearance.FontSize=12,this.grdIncomeTax.Data[S].Cells[E].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[S].Cells[E].IsNormal=!1,this.grdIncomeTax.Data[S].Cells[E].CellAppearance.ForeColor="#0bd10b"):(this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblTotalCellSalary),this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dsTaxData.Tables[0].length-1].Cells[3].IsNormal=!1,this.TotalSalaryIndex=this.dsTaxData.Tables[0].length-1,this.grdIncomeTax.Data[S].Cells[1].Value=this.TotalSalaryIndex,N=this.TotalSalaryIndex)}if(N++,this.Form12Section1Index=this.TotalSalaryIndex+1,this.Form12Section2Index=this.TotalSalaryIndex+2,this.grdIncomeTax.addEmptyRowsWithCellApperance(2),this.dsTaxData.Tables[4].length>0){let S=0;for(let K=0;K<this.dsTaxData.Tables[4].length;K++)S=N+K,this.grdIncomeTax.Data[S].Cells[17].Value=0,this.grdIncomeTax.Data[S].Cells[0].Value=0,this.grdIncomeTax.Data[S].Cells[1].Value=S+1,this.grdIncomeTax.Data[S].Cells[2].Value=this.dsTaxData.Tables[4][K].componentid,this.grdIncomeTax.Data[S].Cells[3].Value=this.dsTaxData.Tables[4][K].SalaryBreakup,this.grdIncomeTax.Data[S].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[S].Cells[3].ColSpan=14,this.grdIncomeTax.Data[S].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[S].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[S].Cells[3].CellAppearance.IsBold=!0,-1==parseInt(this.dsTaxData.Tables[4][K].FieldType)&&(this.dPerq1=parseFloat(this.dsTaxData.Tables[4][K].Amount)),-2==parseInt(this.dsTaxData.Tables[4][K].FieldType)&&(this.dPerq2=parseFloat(this.dsTaxData.Tables[4][K].Amount)),this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(parseFloat(this.dsTaxData.Tables[4][K].AMOUNT)),this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b"}let V=0,he=0,ye=0;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.Exemptionsunder10Index=this.Form12Section2Index+1,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[17].Value=0,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[0].Value=0,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[1].Value=this.Exemptionsunder10Index,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[2].Value=-101,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].Value="Less : Exemptions Under 10 ",this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].ColSpan=15,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.Exemptionsunder10Index].Cells[3].CellAppearance.IsBold=!0,this.dsTaxData.Tables[5].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(1),N=this.HRA10BasicIndex=this.Exemptionsunder10Index+1,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[1].Value=this.HRA10BasicIndex,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[2].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[3].Value="Actual Rent Paid - 10% of Basic ",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[3].ColSpan=2;let Pe=0,Ge=0,O=this.dsTaxData.Tables[13];if(O.length>0){for(let S=0;S<O.length;S++)for(let K=5;K<this.grdIncomeTax.ReportColumns.length;K++)if(O[S].MONTHTEXT.toString()==this.grdIncomeTax.ReportColumns[K].HeaderText.toString()){l=0,h.J0.IsEmpty(O[S].AMOUNT)||(l=parseFloat(O[S].AMOUNT)),l>0?(Ge=h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.BasicIndex].Cells[K].Value),l-=10*Ge/100,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[K].Value=h.J0.GetAmount(l)):this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[K].Value=0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[K].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[K].IsNormal=!1,Pe+=l;break}}else for(let S=5;S<this.grdIncomeTax.ReportColumns.length;S++)this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[S].Value=h.J0.GetAmount(0),this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[S].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[S].IsNormal=!1;if(V=Pe,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(Pe),this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.HRA10BasicIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.HRAAcutalIndex=this.HRA10BasicIndex+1,Pe=0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[1].Value=this.HRAAcutalIndex,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[2].Value=this.dsTaxData.Tables[6][0].componentid.toString(),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[3].Value="Actual Received ",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[3].ColSpan=2,this.dsTaxData.Tables[6].length>0){for(E=5;E<17;E++)this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[E].Value=h.J0.GetAmount(0),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[E].IsNormal=!1,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[E].CellAppearance.Alignment="Right";E=5;for(let S=0;S<this.TotalSalaryIndex;S++)if(parseInt(this.grdIncomeTax.Data[S].Cells[2].Value)==parseInt(this.dsTaxData.Tables[6][0].componentid))for(E=5;E<i;E++)this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[E].Value=h.J0.GetAmount(h.J0.DoubleTryParse(this.grdIncomeTax.Data[S].Cells[E].Value)),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[E].CellAppearance.Alignment="Right",Pe+=h.J0.DoubleTryParse(this.grdIncomeTax.Data[S].Cells[E].Value)}he=Pe,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(Pe),this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.Data[this.HRAAcutalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1;let Je=0,Ne=0;if(this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dsTaxData.Tables[7].length>0){Pe=0;let K,Ve,S=null,j=new le.bT;K=new Le.Nl("Basic",""),j.push("Basic",K),j.Basic.setFieldValue(h.J0.DoubleTryParse(this.dsTaxData.Tables[3][0].BasicMonthly).toString()),S=this.dsTaxData.Tables[8].filter(fe=>1==fe.Type&&"OverTime"!=fe.FieldType);let se=this.dsTaxData.Tables[3];if(S.length>0)for(let fe=0;fe<S.length;fe++)Ve=this.dsTaxData.Tables[8].filter(Ke=>Ke.ComponentID==S[fe].ComponentID),null!=Ve&&Ve.length>0&&(K=new Le.Nl(S[fe].ComponentName.toString(),""),j.push(S[fe].ComponentName.toString(),K),j[S[fe].ComponentName.toString()].setFieldValue(se[0]["Earning"+Ve[0].SNo.toString()].toString()));if(S=this.dsTaxData.Tables[8].filter(fe=>2==fe.Type&&"OverTime"!=fe.FieldType),S.length>0)for(let fe=0;fe<S.length;fe++)Ve=this.dsTaxData.Tables[8].filter(Ke=>Ke.ComponentID==S[fe].ComponentID),null!=Ve&&Ve.length>0&&(K=new Le.Nl(S[fe].ComponentName.toString(),""),j.push(S[fe].ComponentName.toString(),K),j[S[fe].ComponentName.toString()].setFieldValue(se[0]["Deduction"+Ve[0].SNo.toString()].toString()));if(S=this.dsTaxData.Tables[7],S.length>0){let fe=j;Je=parseFloat(r.d.eval.EvaluateExpression(S[0].MetroFormula.toString(),fe)),Ne=parseFloat(r.d.eval.EvaluateExpression(S[0].NonmetroFormula.toString(),fe))}}this.HRAMetroNonMetroIndex=this.HRAAcutalIndex+1,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[1].Value=this.HRAMetroNonMetroIndex,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[2].Value=-102,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[3].Value="Metro/Non-Metro ",this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[3].ColSpan=2;let ue="";if(O.length>0){for(let S=0;S<O.length;S++)for(let K=5;K<this.grdIncomeTax.ReportColumns.length;K++)if(O[S].MONTHTEXT.toString()==this.grdIncomeTax.ReportColumns[K].HeaderText.toString()){ue=O[S].METRO.toString(),"Yes"==ue?(l=Je,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[K].Value=h.J0.GetAmount(l)):"No"==ue.TrimEnd(" ")?(l=Ne,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[K].Value=h.J0.GetAmount(l)):this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[K].Value=0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[K].CellAppearance.Alignment="Right",Pe+=l;break}}else for(let S=5;S<this.grdIncomeTax.ReportColumns.length;S++)this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[S].Value=h.J0.GetAmount(0),this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[S].IsNormal=!1,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[S].CellAppearance.Alignment="Right";ye=Pe,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(Pe),this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.HRAMetroNonMetroIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.HRAExemptionIndex=this.HRAMetroNonMetroIndex+1,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[1].Value=this.HRAExemptionIndex,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[2].Value=-103,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].Value="HRA Exemption ",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[3].CellAppearance.IsBold=!0,this.HraMinValue=Math.min(V,he,ye),this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.HraMinValue),this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.TotAmtOthExemptUs10Index=this.HRAExemptionIndex+1,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[17].Value=0,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[0].Value=0,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[1].Value=this.TotAmtOthExemptUs10Index,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[2].Value=10001,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[3].Value="Total amount of any other exemption under section 10",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[3].ColSpan=14;let ke=0,me=this.dsTaxData.Tables[25].filter(S=>"U/S 10 : 1) Total amount of any other exemption under section 10"==S.Name);null!=me&&me.length>0&&null!=me[0].Amount&&null!=me[0].Amount&&""!=me[0].Amount.toString()&&(ke=parseFloat(me[0].Amount)),this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(ke),this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(2);let Ue=0,Ht=0,ma=0;if(this.dvLimit=this.dvLimitData.filter(S=>998==S.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(Ue=parseFloat(this.dvLimit[0].AmountLimit)),this.ConveyanceIndex=this.TotAmtOthExemptUs10Index+1,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[1].Value=this.ConveyanceIndex,this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[2].Value=parseInt(this.dsTaxData.Tables[9][0].ComponentID),this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[3].Value="Conveyance",this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[3].ColSpan=14,parseInt(this.dsTaxData.Tables[9][0].ComponentID)>0){if(this.dsTaxData.Tables[9].length>0){E=5;for(let S=0;S<this.TotalSalaryIndex;S++)if(parseInt(this.grdIncomeTax.Data[S].Cells[2].Value)==parseInt(this.dsTaxData.Tables[9][0].ComponentID))for(E=5;E<i;E++)h.J0.IsEmpty(this.grdIncomeTax.Data[S].Cells[E].Value)||(Ht+=h.J0.DoubleTryParse(this.grdIncomeTax.Data[S].Cells[E].Value))}ma=Ht/12,0==ma||ma>Ue?Ue*=12:Ue=Ht}parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2018&&(Ue=0,2018==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?this.dblStandardDeduction=4e4:parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2019&&(this.dblStandardDeduction=5e4)),this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(Ue),this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.ChildrenEduIndex=this.ConveyanceIndex+1,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[1].Value=this.ChildrenEduIndex,this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[2].Value=parseInt(this.dsTaxData.Tables[9][1].ComponentID),this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[3].Value="Children Education Allowances";let Pa=0;if(parseInt(this.dsTaxData.Tables[9][0].ComponentID)>0){let S=0,K=0,j=0,Ve=0;if(this.dvLimit=this.dvLimitData,this.dvLimit=this.dvLimitData.filter(se=>996==se.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(j=parseFloat(this.dvLimit[0].AmountLimit)),this.dvLimit=this.dvLimitData,this.dvLimit=this.dvLimitData.filter(se=>996==se.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(K=parseInt(this.dvLimit[0].AmountLimit)),this.dsTaxData.Tables[10].length>0){S=parseInt(this.dsTaxData.Tables[10][0][0]),S>K&&(S=K),Ve=12*S*j,E=5;for(let se=0;se<this.TotalSalaryIndex;se++)if(parseInt(this.grdIncomeTax.Data[se].Cells[2].Value)==parseInt(this.dsTaxData.Tables[9][1].ComponentID))for(E=5;E<i;E++)null!=this.grdIncomeTax.Data[se].Cells[E].Value&&""!=this.grdIncomeTax.Data[se].Cells[E].Value.toString()&&0!=h.J0.DoubleTryParse(this.grdIncomeTax.Data[se].Cells[E].Value)&&(Pa+=S*j)}}this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(Pa),this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.dsTaxData.Tables[11].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[11].length);let ga=0,Ia=0;ga=this.ChildrenEduIndex+1,N=ga;for(let S=0;S<this.dsTaxData.Tables[11].length;S++)this.grdIncomeTax.Data[N].Cells[17].Value=0,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=ga+S,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[11][S].NodeID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[11][S].NAME.toString(),this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.dvEmpTaxComputation=this.dsTaxData.Tables[21],this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(K=>K.ComponentID==parseInt(this.dsTaxData.Tables[11][S].NODEID)&&0==K.RegimeType),this.dvEmpTaxComputation.length>0?(this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount)),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount))):(this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(0),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(0)),Ia+=h.J0.DoubleTryParse(this.grdIncomeTax.Data[N].Cells[4].Value),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",N+=1;this.MedicalIndex=this.ChildrenEduIndex+1,this.LTAIndex=this.MedicalIndex+1,this.FoodIndex=this.LTAIndex+1,this.LeaveEncashIndex=this.FoodIndex+1,this.GratuityIndex=this.LeaveEncashIndex+1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.StandardDedIndex=this.GratuityIndex+1,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[1].Value=this.StandardDedIndex,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[2].Value=1e3,this.grdIncomeTax.Data[this.StandardDedIndex].Cells[3].Value="STANDARD DEDUCTION",this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblStandardDeduction),this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",N+=1,this.dblbalanceSalaryInc12BA=this.dblTotalCellSalary+this.dPerq1+this.dPerq2-(this.HraMinValue+h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)+h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.ConveyanceIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)+h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.ChildrenEduIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)+h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.MedicalIndex].Cells[4].Value)+h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.LTAIndex].Cells[4].Value)+h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.LeaveEncashIndex].Cells[4].Value)+h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.FoodIndex].Cells[4].Value)+h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.GratuityIndex].Cells[4].Value)+this.dblStandardDeduction),this.grdIncomeTax.addEmptyRowsWithCellApperance(3),this.BalanceSalInc12BAIndex=this.StandardDedIndex+1,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[1].Value=this.BalanceSalInc12BAIndex,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[2].Value=-104,this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[3].Value="Balance Salary including Perquisites",this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblbalanceSalaryInc12BA),this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.BalanceSalInc12BAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545";let At=0,xa=this.dsTaxData.Tables[12];this.ProfessionalTaxIndex=this.BalanceSalInc12BAIndex+1,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[0].Value=-105,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[1].Value=this.ProfessionalTaxIndex,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[2].Value=0,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[3].Value="Professional Tax",g=this.dsTaxData.Tables[20];let Ie=!1;if(xa.length>0){Ie=!1;for(let S=0;S<this.dsTaxData.Tables[19].length;S++)if("PROFESSIONAL TAX"==h.J0.StringValue(this.dsTaxData.Tables[19][S].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][S].SNo)>0)for(let K=5;K<this.grdIncomeTax.ReportColumns.length-2;K++){Ie=!1;for(let j=0;j<g.length;j++)if(g[j].month.toString()==this.grdIncomeTax.ReportColumns[K].HeaderText.toString()){h.J0.IsEmpty(g[j]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])||(At+=parseFloat(g[j]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])),Ie=!0;break}if(!Ie)for(let j=0;j<p.length;j++)if(parseInt(this.dsTaxData.Tables[19][S].componentID)==parseInt(p[j].componentid)&&p[j].FieldName.toString()==this.grdIncomeTax.ReportColumns[K].HeaderText.toString()&&parseFloat(p[j].Amount)>0){h.J0.IsEmpty(p[j].Amount)||(At+=parseFloat(p[j].Amount)),Ie=!0;break}if(!Ie)for(let j=0;j<e.length;j++)h.J0.IsEmpty(e[j]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()])||(At+=parseFloat(e[j]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()]))}}this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[4].Value=h.J0.GetAmount(At),this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(At),this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.NetTaxableSalIndex=this.ProfessionalTaxIndex+1,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[1].Value=this.NetTaxableSalIndex,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[2].Value=-106,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[3].Value="Net Taxable Salary",this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[3].ColSpan=14,this.dblNetTaxableSal=0,this.dblNetTaxableSal=this.dblbalanceSalaryInc12BA-At,this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblNetTaxableSal),this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[14].length+3);let Sa=0;this.IncomefromHousePropertyIndex=this.NetTaxableSalIndex+1;for(let S=0;S<this.dsTaxData.Tables[14].length;S++){this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[1].Value=this.IncomefromHousePropertyIndex,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[2].Value=parseInt(this.dsTaxData.Tables[14][S].NODEID),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[3].Value=this.dsTaxData.Tables[14][S].NAME,Sa=parseFloat(this.dsTaxData.Tables[14][S].AMOUNT),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[4].Value=h.J0.GetAmount(parseFloat(this.dsTaxData.Tables[14][S].AMOUNT)),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";break}let Ma=0;this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[1].Value=this.IncomefromHousePropertyIndex+1,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[2].Value=-107,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[3].Value="Less : Standard deduction 30%",Ma=30*Sa/100,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[4].Value=h.J0.GetAmount(Ma),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";let Ut=0;this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[1].Value=this.IncomefromHousePropertyIndex+2,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[2].Value=-108,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[3].Value="",Ut=parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex].Cells[4].Value)-parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+1].Cells[4].Value),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[4].Value=h.J0.GetAmount(Ut),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+2].Cells[5].ColSpan=12;let Yt=0;for(let S=1;S<this.dsTaxData.Tables[14].length;S++){this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[1].Value=this.IncomefromHousePropertyIndex+3,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[2].Value=parseInt(this.dsTaxData.Tables[14][S].NODEID),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[3].Value=this.dsTaxData.Tables[14][S].NAME,Yt=parseFloat(this.dsTaxData.Tables[14][S].AMOUNT),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[4].Value=h.J0.GetAmount(Yt),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+3].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";break}this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[17].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[0].Value=0,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[1].Value=this.IncomefromHousePropertyIndex+4,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[2].Value=-109,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[3].Value="Loss from House Property",this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[3].ColSpan=2,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[5].ColSpan=12,this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(Yt-Ut),this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right";let Xt=0;this.dblSelfletoutamount=0,N=Xt=this.IncomefromHousePropertyIndex+5;for(let S=2;S<this.dsTaxData.Tables[14].length;S++)this.grdIncomeTax.Data[N].Cells[17].Value=0,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=Xt,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[14][S].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[14][S].NAME,this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(parseFloat(this.dsTaxData.Tables[14][S].AMOUNT)),this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.dblSelfletoutamount=this.dblSelfletoutamount+parseFloat(this.dsTaxData.Tables[14][S].AMOUNT),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(h.J0.DoubleTryParse(this.dsTaxData.Tables[14][S].AMOUNT)),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,Xt+=1;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.GrossTotalIncomeIndex=Xt,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[1].Value=this.GrossTotalIncomeIndex,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[2].Value=-110,this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[3].Value="Gross Total Income",this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[3].ColSpan=14,this.dblGrossTotalIncome=this.dblNetTaxableSal+this.dblSelfletoutamount-(Yt-Ut),this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblGrossTotalIncome),this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.GrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intDeducunder8oCto80CCCIndex=this.GrossTotalIncomeIndex+1,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[1].Value=this.intDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[2].Value=-111,this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[3].Value="Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intDeducunder8oCto80CCCIndex].Cells[3].ColSpan=15,this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[16].length);let fa=0,ca=0,ut=0;N=ut=this.intDeducunder8oCto80CCCIndex+1;for(let S=0;S<this.dsTaxData.Tables[16].length;S++){if(this.grdIncomeTax.Data[N].Cells[17].Value=0,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=ut,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[16][S].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[16][S].NAME,this.dvEmpTaxComputation.RowFilter="",this.dvEmpTaxComputation.filter(K=>K.ComponentID==parseInt(this.dsTaxData.Tables[16][S].NODEID)),this.dvEmpTaxComputation.length>0)this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else if("PF(Deduction from Salary)"==h.J0.String(this.dsTaxData.Tables[16][S].NAME)){let K=0;Ie=!1;for(let j=0;j<this.dsTaxData.Tables[19].length;j++)if("PF(Deduction from Salary)"==h.J0.String(this.dsTaxData.Tables[19][j].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][j].SNo)>0)for(let Ve=5;Ve<this.grdIncomeTax.ReportColumns.length-2;Ve++){Ie=!1;for(let se=0;se<g.length;se++)if(h.J0.String(g[se].month)==this.grdIncomeTax.ReportColumns[Ve].HeaderText.toString()){h.J0.IsEmpty(g[se]["dcCalcNum"+h.J0.String(this.dsTaxData.Tables[19][j].SNo)])||(K+=parseFloat(g[se]["dcCalcNum"+h.J0.String(this.dsTaxData.Tables[19][j].SNo)])),Ie=!0;break}if(!Ie)for(let se=0;se<p.length;se++)if(parseInt(this.dsTaxData.Tables[19][j].componentID)==parseInt(p[se].componentid)&&p[se].FieldName.toString()==this.grdIncomeTax.ReportColumns[Ve].HeaderText.toString()&&parseFloat(p[se].Amount)>0){h.J0.IsEmpty(p[se].Amount)||(K+=parseFloat(p[se].Amount)),Ie=!0;break}if(!Ie&&Ve>=a)for(let se=0;se<e.length;se++)h.J0.IsEmpty(e[se]["Deduction"+h.J0.String(this.dsTaxData.Tables[19][j].SNo)])||(K+=parseFloat(e[se]["Deduction"+h.J0.String(this.dsTaxData.Tables[19][j].SNo)]))}this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(K)}else this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(parseFloat(this.dsTaxData.Tables[16][S].AMOUNT));this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",0==S&&(fa=h.J0.DoubleTryParse(this.grdIncomeTax.Data[N].Cells[4].Value)),S>0&&(ca+=h.J0.DoubleTryParse(this.grdIncomeTax.Data[N].Cells[4].Value)),this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,N+=1,ut+=1}this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intTotalDeducunder8oCto80CCCIndex=ut,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[1].Value=this.intTotalDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[2].Value=-112,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[3].Value="Total Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[5].ColSpan=12,this.dblTotaldeduction80ccc80c=ca+fa,this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[4].Value=h.J0.GetAmount(this.dblTotaldeduction80ccc80c);let Ca=0;this.dvLimit=this.dvLimitData.filter(S=>995==S.ComponentID),null!=this.dvLimit[0].AmountLimit&&null!=this.dvLimit[0].AmountLimit&&""!=this.dvLimit[0].AmountLimit.toString()&&(Ca=parseFloat(this.dvLimit[0].AmountLimit)),this.dblTotaldeduction80ccc80c>Ca&&(this.dblTotaldeduction80ccc80c=Ca),this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblTotaldeduction80ccc80c),this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b";let Lt=0;this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[17].length),this.intOtherDeducunder8oCto80CCCIndex=this.intTotalDeducunder8oCto80CCCIndex+1,N=ut=this.intTotalDeducunder8oCto80CCCIndex+1;for(let S=0;S<this.dsTaxData.Tables[17].length;S++){let K=0;if(this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=ut,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(this.dsTaxData.Tables[17][S].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[17][S].NAME,this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(j=>j.ComponentID==parseInt(this.dsTaxData.Tables[17][S].NODEID)&&0==j.RegimeType),this.dvEmpTaxComputation.length>0)Lt+=parseFloat(this.dvEmpTaxComputation[0].ComponentAmount),this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else{if(K=0,K=parseFloat(this.dsTaxData.Tables[17][S].AMOUNT),"80D-Self/Spouse/Dependant Children"==h.J0.String(this.dsTaxData.Tables[17][S].NAME)||"80D-Self/Dependant/Parent (not Sr Citizen)"==this.dsTaxData.Tables[17][S].NAME.toString()||"80D-Self/Dependant/Parent (Sr Citizen)"==this.dsTaxData.Tables[17][S].NAME.toString()){Ie=!1;for(let j=0;j<this.dsTaxData.Tables[19].length;j++)if(!h.J0.IsEmpty(this.dsTaxData.Tables[19][j].TaxmapName)&&this.dsTaxData.Tables[19][j].TaxmapName.toString()==this.dsTaxData.Tables[17][S].NAME.toString()&&parseInt(this.dsTaxData.Tables[19][j].SNo)>0)for(let Ve=5;Ve<this.grdIncomeTax.ReportColumns.length-2;Ve++){Ie=!1;for(let se=0;se<g.length;se++)if(g[se].month.toString()==this.grdIncomeTax.ReportColumns[Ve].HeaderText.toString()){null!=g[se]["dcCalcNum"+this.dsTaxData.Tables[19][j].SNo.toString()]&&null!=g[se]["dcCalcNum"+this.dsTaxData.Tables[19][j].SNo.toString()]&&""!=g[se]["dcCalcNum"+this.dsTaxData.Tables[19][j].SNo.toString()].toString()&&(K+=parseFloat(g[se]["dcCalcNum"+this.dsTaxData.Tables[19][j].SNo.toString()])),Ie=!0;break}if(!Ie)for(let se=0;se<p.length;se++)if(parseInt(this.dsTaxData.Tables[19][j].componentID)==parseInt(p[se].componentid)&&p[se].FieldName.toString()==this.grdIncomeTax.ReportColumns[Ve].HeaderText.toString()&&parseFloat(p[se].Amount)>0){null!=p[se].Amount&&null!=p[se].Amount&&""!=p[se].Amount.toString()&&(K+=parseFloat(p[se].Amount)),Ie=!0;break}if(!Ie)for(let se=0;se<e.length;se++)null!=e[se]["Deduction"+this.dsTaxData.Tables[19][j].SNo.toString()]&&null!=e[se]["Deduction"+this.dsTaxData.Tables[19][j].SNo.toString()]&&""!=e[se]["Deduction"+this.dsTaxData.Tables[19][j].SNo.toString()].toString()&&(K+=parseFloat(e[se]["Deduction"+this.dsTaxData.Tables[19][j].SNo.toString()]))}}Lt+=K,this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(K)}this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dvEmpTaxComputation.length>0?parseFloat(this.dvEmpTaxComputation[0].ComponentAmount):K),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,ut+=1}this.intOtherDeducunder8oCto80CCCIndex1=ut-1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTotalIncomeIndex=this.intOtherDeducunder8oCto80CCCIndex1+1,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[1].Value=this.dblTotalIncomeIndex,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[2].Value=-113,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].Value="Total Income",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.dblTotalIncome=this.dblGrossTotalIncome-this.dblTotaldeduction80ccc80c-Lt,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblTotalIncome),this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dblTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTotalIncomeRoundoffIndex=this.dblTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[2].Value=-114,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].Value="Total Income rounded off",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[3].CellAppearance.IsBold=!0,this.dblTotalIncomeRoundoff=Math.round(this.dblTotalIncome),this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblTotalIncomeRoundoff),this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.Data[this.dblTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTaxOnTotalIncomeIndex=this.dblTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[2].Value=-115,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[3].Value="Tax on Total Income",this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblRebateIndex=this.dblTaxOnTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+2,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[2].Value=-116,parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)<2016?this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.2,000 for Taxable Income below Rs.5,00,000/-)":2016==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.5,000 for Taxable Income below Rs.5,00,000/-)":2017==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)||2018==parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)?this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.2,500 for Taxable Income below Rs.3,50,000/-)":parseInt(this.ITComputationViewModel.EmpYear.SelectedValue)>=2019&&(this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.12,500 for Taxable Income below Rs.5,00,000/-)"),this.grdIncomeTax.Data[this.dblRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTaxPayableAfterRebateIndex=this.dblRebateIndex+1,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+3,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[2].Value=-117,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[3].Value="Tax Payable after rebate U/S 87A",this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblSurchargeIndex=this.dblTaxPayableAfterRebateIndex+1,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+4,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[2].Value=-118,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblTaxPayableIndex=this.dblSurchargeIndex+1,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+5,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[2].Value=-119,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[3].Value="Tax Payable",this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblEducationCessIndex=this.dblTaxPayableIndex+1,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+6,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[2].Value=-120,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblSecHighEduCessIndex=this.dblEducationCessIndex+1,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[1].Value=this.dblTotalIncomeRoundoffIndex+7,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[2].Value=-121,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intTotalIncometaxPayableindex=this.dblSecHighEduCessIndex+1,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[17].Value=0,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[1].Value=this.intTotalIncometaxPayableindex,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[2].Value=-122,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[3].Value="Total Income Tax Payable",this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.TDSPaidIndex=this.intTotalIncometaxPayableindex+1,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[1].Value=this.TDSPaidIndex,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[2].Value=-123,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[3].Value="TDS Paid",this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.TDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#0bd10b",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NetTaxPayableIndex=this.TDSPaidIndex+1,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[1].Value=this.NetTaxPayableIndex,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[2].Value=-124,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[3].Value="Net Tax Payable",this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545";let ba,pa=0,vt=0,Ea=0,Fa=0,Kt=0,Na=0;Kt=r.d.SessionManager.FinancialYearStartDate.getFullYear(),ba=Kt.toString(),Kt=parseInt(ba.substr(2,2)),Na=Kt+1,pa=r.d.SessionManager.AccountingFromMonth,Fa=pa;let Qt=1;vt=pa,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.MonthlyDeducIndex=this.NetTaxPayableIndex+1,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[1].Value=this.MonthlyDeducIndex,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[2].Value=-125,this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[3].Value="Monthly Deductions from salary",this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[3].ColSpan=2;for(let S=5;S<this.grdIncomeTax.ReportColumns.length;S++)if(13==vt){Ea=vt-Qt;for(let K=1;K<=Ea;K++)this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[S].Value=this.GetMonthName(K,!1),this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[S].CellAppearance.Alignment="Center",Qt+=1,S++}else this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[S].Value=this.GetMonthName(vt,!1),this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[S].CellAppearance.Alignment="Center",vt+=1,Qt+=1;this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.MonthlyDeducIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].IsNormal=!1,this.dsTaxData.Tables[19].length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(this.dsTaxData.Tables[19].length+1);let $t=0,Ot=0,Dt=0;N=$t=this.MonthlyDeducIndex+1,g=this.dsTaxData.Tables[20];for(let S=0;S<this.dsTaxData.Tables[19].length;S++){if(W=new Array,E=5,Dt=Ot=0,this.grdIncomeTax.Data[N+S].Cells[17].Value=0,this.grdIncomeTax.Data[N+S].Cells[0].Value=this.dsTaxData.Tables[19][S].SNo,this.grdIncomeTax.Data[N+S].Cells[1].Value=$t+S,this.grdIncomeTax.Data[N+S].Cells[2].Value=this.dsTaxData.Tables[19][S].componentID,this.grdIncomeTax.Data[N+S].Cells[3].Value=this.dsTaxData.Tables[19][S].SalaryBreakup,this.grdIncomeTax.Data[N+S].Cells[3].ColSpan=2,parseInt(this.dsTaxData.Tables[19][S].SNo)>0){for(let K=0;K<g.length;K++)for(let j=5;j<this.grdIncomeTax.ReportColumns.length;j++)if(g[K].month.toString()==this.grdIncomeTax.ReportColumns[j].HeaderText.toString()&&!W.Contains(this.grdIncomeTax.ReportColumns[j].HeaderText)){W.push(this.grdIncomeTax.ReportColumns[j].HeaderText),l=0,h.J0.IsEmpty(g[K]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])||(l=parseFloat(g[K]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])),this.grdIncomeTax.Data[N+S].Cells[j].Value=l>=0?h.J0.GetAmount(l):0,this.grdIncomeTax.Data[N+S].Cells[j].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+S].Cells[j].IsNormal=!1,Dt+=l;break}p=y,p=this.dsTaxData.Tables[2].filter(K=>"2"==K.ComponentType);for(let K=0;K<p.length;K++)for(let j=5;j<this.grdIncomeTax.ReportColumns.length;j++)if(parseInt(this.dsTaxData.Tables[19][S].componentID)==parseInt(p[K].componentid)&&p[K].FieldName.toString()==this.grdIncomeTax.ReportColumns[j].HeaderText.toString()&&parseFloat(p[K].Amount)>0&&!W.Contains(this.grdIncomeTax.ReportColumns[j].HeaderText)){this.grdIncomeTax.ReportColumns[j].Tag="Past",W.push(this.grdIncomeTax.ReportColumns[j].HeaderText),l=0,h.J0.IsEmpty(p[K].Amount)||(l=parseFloat(p[K].Amount)),this.grdIncomeTax.Data[N+S].Cells[j].Value=l>=0?h.J0.GetAmount(l):0,this.grdIncomeTax.Data[N+S].Cells[j].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+S].Cells[j].IsNormal=!1,Dt+=l;break}if(0==e.length)return;for(let K=0;K<e.length;K++)for(E=a;E<i;E++)!W.Contains(this.grdIncomeTax.ReportColumns[E].HeaderText)&&h.J0.DoubleTryParse(this.grdIncomeTax.Data[N+S].Cells[E].Value)<=0&&(W.push(this.grdIncomeTax.ReportColumns[E].HeaderText),l=parseFloat(e[K]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()]),this.grdIncomeTax.Data[N+S].Cells[E].Value=l>=0?h.J0.GetAmount(l):0,this.grdIncomeTax.Data[N+S].Cells[E].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+S].Cells[E].IsNormal=!1,Dt+=l)}this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(Dt),this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.FontSize=12,this.grdIncomeTax.Data[N+S].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.IsBold=!0}this.InhandAmountIndex=$t+this.dsTaxData.Tables[19].length;let ua=0;this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[17].Value=0,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[1].Value=this.InhandAmountIndex,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[2].Value=-126,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].Value="In Hand",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].CellAppearance.ForeColor="#dc3545",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].ColSpan=2,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[3].IsNormal=!1,E=5;let Da=0;for(E=5;E<17;E++)this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[E].Value=h.J0.GetAmount(0),this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[E].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[E].CellAppearance.ForeColor="#dc3545";for(E=5;E<i;E++){Ot=0;for(let S=$t;S<this.InhandAmountIndex;S++)Ot+=h.J0.DoubleTryParse(this.grdIncomeTax.Data[S].Cells[E].Value);Da=h.J0.DoubleTryParse(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[E].Value)-Ot,this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[E].Value=h.J0.GetAmount(Da),this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[E].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[E].CellAppearance.ForeColor="#dc3545",ua+=Da}this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(ua),this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.InhandAmountIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="#dc3545",Ie=!1;for(let S=0;S<this.dsTaxData.Tables[19].length;S++)if("TDS"==h.J0.StringValue(this.dsTaxData.Tables[19][S].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][S].SNo)>0)for(let K=5;K<this.grdIncomeTax.ReportColumns.length-2;K++){Ie=!1;for(let j=0;j<g.length;j++)if(g[j].month.toString()==this.grdIncomeTax.ReportColumns[K].HeaderText.toString()){h.J0.IsEmpty(g[j]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])||(this.dblTDS+=parseFloat(g[j]["dcCalcNum"+this.dsTaxData.Tables[19][S].SNo.toString()])),Ie=!0;break}if(!Ie)for(let j=0;j<p.length;j++)if(parseInt(this.dsTaxData.Tables[19][S].componentID)==parseInt(p[j].componentid)&&p[j].FieldName.toString()==this.grdIncomeTax.ReportColumns[K].HeaderText.toString()&&parseFloat(p[j].Amount)>0){h.J0.IsEmpty(p[j].Amount)||(this.dblTDS+=parseFloat(p[j].Amount)),Ie=!0;break}if(!Ie)for(let j=0;j<e.length;j++)h.J0.IsEmpty(e[j]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()])||(this.dblTDS+=parseFloat(e[j]["Deduction"+this.dsTaxData.Tables[19][S].SNo.toString()]))}if(this.UpdateTotals(this.dblTotalIncomeRoundoff),this.bIsNewRegime){let S=0,K=0,j=0;this.dvNewTaxSlabs=this.dsTaxData.Tables[7];let Ve={iY:S,iM:K,iD:j};h.J0.GetYearsMonthsDays(new Date(u[0].CDOB),this.dtToMonth.OnlyDate(),Ve),S=Ve.iY,K=Ve.iM,j=Ve.iD,this.dvNewTaxSlabs=this.dsTaxData.Tables[7].filter(S>=80?oe=>"SuperSeniorCitizen"==oe.Gender&&"New"==oe.RegimeType:S>=60?oe=>"SeniorCitizen"==oe.Gender&&"New"==oe.RegimeType:oe=>oe.Gender==h.J0.String(u[0].GenderName)&&"New"==oe.RegimeType),this.lstNewTaxSalbs.Clear();for(let oe=0;oe<this.dvNewTaxSlabs.length;oe++)this.lstNewTaxSalbs.push(new nt),this.lstNewTaxSalbs[oe].FromSlab=parseFloat(this.dvNewTaxSlabs[oe].Fromslab),this.lstNewTaxSalbs[oe].ToSlab=parseFloat(this.dvNewTaxSlabs[oe].Toslab),this.lstNewTaxSalbs[oe].Percentage=parseFloat(this.dvNewTaxSlabs[oe].Percentage)/100;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewRegimeStartIndex=this.InhandAmountIndex+1,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[1].Value=this.NewRegimeStartIndex,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[2].Value=-130,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].Value="Computation Based on New Regime",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.Alignment="Center",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.FontFamilyName="Tahoma",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.IsBold=!0,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.ForeColor="Black",this.grdIncomeTax.Data[this.NewRegimeStartIndex].Cells[3].CellAppearance.FontSize=18,this.grdIncomeTax.Data[this.NewRegimeStartIndex].Height=32,this.dblNewStandardDeduction=5e4,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewStandardDedIndex=this.NewRegimeStartIndex+1,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[1].Value=this.NewStandardDedIndex,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[2].Value=1e3,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[3].Value="STANDARD DEDUCTION",this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblNewStandardDeduction),this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewStandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewNetTaxableSalIndex=this.NewStandardDedIndex+1,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[1].Value=this.NewNetTaxableSalIndex,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[2].Value=-106,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].Value="Net Taxable Salary",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[3].ColSpan=14,this.dblNewNetTaxableSal=0,this.dblNewNetTaxableSal=this.dblTotalCellSalary-this.dblNewStandardDeduction,this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblNewNetTaxableSal),this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewNetTaxableSalIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red";let se=0;this.dblNewSelfletoutamount=0;let fe=this.dsTaxData.Tables[14].filter(oe=>"New"==oe.RegimeType||"Both"==oe.RegimeType);if(null!=fe&&fe.length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(fe.length),N=se=this.NewNetTaxableSalIndex+1,null!=fe&&fe.length>0)for(let oe=0;oe<fe.length;oe++)this.grdIncomeTax.Data[N].Cells[17].Value=1,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=se,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(fe[oe].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=fe[oe].NAME,this.grdIncomeTax.Data[N].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(parseFloat(fe[oe].AMOUNT)),this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.dblNewSelfletoutamount=this.dblNewSelfletoutamount+parseFloat(fe[oe].AMOUNT),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(parseFloat(fe[oe].AMOUNT)),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,se+=1;this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewGrossTotalIncomeIndex=se,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[1].Value=this.NewGrossTotalIncomeIndex,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[2].Value=-110,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].Value="Gross Total Income",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[3].ColSpan=14,this.dblNewGrossTotalIncome=this.dblNewNetTaxableSal+this.dblNewSelfletoutamount,this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblNewGrossTotalIncome),this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewGrossTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intNewDeducunder8oCto80CCCIndex=this.NewGrossTotalIncomeIndex+1,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[1].Value=this.intNewDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[2].Value=-111,this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[3].Value="Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.intNewDeducunder8oCto80CCCIndex].Cells[3].ColSpan=14;let Ke=this.dsTaxData.Tables[16].filter(oe=>"New"==oe.RegimeType||"Both"==oe.RegimeType);null!=Ke&&Ke.length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(Ke.length);let Aa=0,Ta=0,Tt=0;if(N=Tt=this.intNewDeducunder8oCto80CCCIndex+1,null!=Ke&&Ke.length>0)for(let oe=0;oe<Ke.length;oe++){if(this.grdIncomeTax.Data[N].Cells[17].Value=1,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=Tt,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(Ke[oe].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=this.dsTaxData.Tables[16][oe].NAME,this.grdIncomeTax.Data[N].Cells[3].CellAppearance.Alignment="Left",this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(Qe=>Qe.ComponentID==parseInt(Ke[oe].NODEID)&&0==Qe.RegimeType),this.dvEmpTaxComputation.length>0)this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else if("PF(Deduction from Salary)"==Ke[oe].NAME.toString()){let Qe=0;Ie=!1;for(let Oe=0;Oe<this.dsTaxData.Tables[19].length;Oe++)if("PF(Deduction from Salary)"==h.J0.String(this.dsTaxData.Tables[19][Oe].TaxmapName)&&parseInt(this.dsTaxData.Tables[19][Oe].SNo)>0)for(let gt=5;gt<this.grdIncomeTax.ReportColumns.length-2;gt++){Ie=!1;for(let Ce=0;Ce<g.length;Ce++)if(h.J0.String(g[Ce].month)==this.grdIncomeTax.ReportColumns[gt].HeaderText.toString()){null!=g[Ce]["dcCalcNum"+h.J0.String(this.dsTaxData.Tables[19][Oe].SNo)]&&""!=g[Ce]["dcCalcNum"+h.J0.String(this.dsTaxData.Tables[19][Oe].SNo)].toString()&&(Qe+=parseFloat(g[Ce]["dcCalcNum"+this.dsTaxData.Tables[19][Oe].SNo.toString()])),Ie=!0;break}if(!Ie)for(let Ce=0;Ce<p.length;Ce++)if(parseInt(this.dsTaxData.Tables[19][Oe].componentID)==parseInt(p[Ce].componentid)&&p[Ce].FieldName.toString()==this.grdIncomeTax.ReportColumns[gt].HeaderText.toString()&&parseFloat(p[Ce].Amount)>0){null!=p[Ce].Amount&&""!=p[Ce].Amount.toString()&&(Qe+=parseFloat(p[Ce].Amount)),Ie=!0;break}if(!Ie)for(let Ce=0;Ce<e.length;Ce++)null!=e[Ce]["Deduction"+h.J0.String(this.dsTaxData.Tables[19][Oe].SNo)]&&""!=e[Ce]["Deduction"+h.J0.String(this.dsTaxData.Tables[19][Oe].SNo)].toString()&&(Qe+=parseFloat(e[Ce]["Deduction"+this.dsTaxData.Tables[19][Oe].SNo.toString()]))}this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(Qe)}else this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(parseFloat(Ke[oe].Amount));0==oe&&(Aa=parseFloat(this.grdIncomeTax.Data[N].Cells[4].Value)),oe>0&&(Ta+=parseFloat(this.grdIncomeTax.Data[N].Cells[4].Value)),this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.grdIncomeTax.Data[N].Cells[5].rowSpan=Ke.length,this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].rowSpan=Ke.length,N+=1,Tt+=1}this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intNewTotalDeducunder8oCto80CCCIndex=Tt,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[1].Value=this.intNewTotalDeducunder8oCto80CCCIndex,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[2].Value=-112,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[3].Value="Total Deductions under 80C to 80CCC",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[5].ColSpan=12,this.dblNewTotaldeduction80ccc80c=Ta+Aa,this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[4].Value=h.J0.GetAmount(this.dblNewTotaldeduction80ccc80c);let ya=0;this.dvNewLimit=this.dsTaxData.Tables[15].filter(oe=>995==oe.ComponentID),null!=this.dvNewLimit[0].AmountLimit&&""!=this.dvNewLimit[0].AmountLimit.toString()&&(ya=parseFloat(this.dvNewLimit[0].AmountLimit)),this.dblNewTotaldeduction80ccc80c>ya&&(this.dblNewTotaldeduction80ccc80c=ya),this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblNewTotaldeduction80ccc80c),this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intNewTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green";let Vt=0,et=this.dsTaxData.Tables[17].filter(oe=>"New"==oe.RegimeType||"Both"==oe.RegimeType);if(null!=et&&et.length>0&&this.grdIncomeTax.addEmptyRowsWithCellApperance(et.length),this.intNewOtherDeducunder8oCto80CCCIndex=this.intNewTotalDeducunder8oCto80CCCIndex+1,N=Tt=this.intNewTotalDeducunder8oCto80CCCIndex+1,null!=et&&et.length>0)for(let oe=0;oe<et.length;oe++){let Qe=0;if(this.grdIncomeTax.Data[N].Cells[17].Value=1,this.grdIncomeTax.Data[N].Cells[0].Value=0,this.grdIncomeTax.Data[N].Cells[1].Value=Tt,this.grdIncomeTax.Data[N].Cells[2].Value=parseInt(et[oe].NODEID),this.grdIncomeTax.Data[N].Cells[3].Value=et[oe].NAME,this.grdIncomeTax.Data[N].Cells[3].CellAppearance.Alignment="Left",this.dvEmpTaxComputation=this.dsTaxData.Tables[21].filter(Oe=>Oe.ComponentID==parseInt(et[oe].NODEID)&&0==Oe.RegimeType),this.dvEmpTaxComputation.length>0)Vt+=parseFloat(this.dvEmpTaxComputation[0].ComponentAmount),this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(parseFloat(this.dvEmpTaxComputation[0].ComponentAmount));else{if(Qe=0,Qe=parseFloat(et[oe].AMOUNT),"80D-Self/Spouse/Dependant Children"==et[oe].NAME.toString()||"80D-Self/Dependant/Parent (not Sr Citizen)"==et[oe].NAME.toString()||"80D-Self/Dependant/Parent (Sr Citizen)"==et[oe].NAME.toString()){Ie=!1;for(let Oe=0;Oe<this.dsTaxData.Tables[19].length;Oe++)if(this.dsTaxData.Tables[19][Oe].TaxmapName.toString()==et[oe].NAME.toString()&&parseInt(this.dsTaxData.Tables[19][Oe].SNo)>0)for(let gt=5;gt<this.grdIncomeTax.ReportColumns.length-2;gt++){Ie=!1;for(let Ce=0;Ce<g.length;Ce++)if(g[Ce].month.toString()==this.grdIncomeTax.ReportColumns[gt].HeaderText.toString()){null!=g[Ce]["dcCalcNum"+h.J0.String(this.dsTaxData.Tables[19][Oe].SNo)]&&""!=g[Ce]["dcCalcNum"+h.J0.String(this.dsTaxData.Tables[19][Oe].SNo)].toString()&&(Qe+=parseFloat(g[Ce]["dcCalcNum"+this.dsTaxData.Tables[19][Oe].SNo.toString()])),Ie=!0;break}if(!Ie)for(let Ce=0;Ce<p.length;Ce++)if(parseInt(this.dsTaxData.Tables[19][Oe].componentID)==parseInt(p[Ce].componentid)&&p[Ce].FieldName.toString()==this.grdIncomeTax.ReportColumns[gt].HeaderText.toString()&&parseFloat(p[Ce].Amount)>0){null!=p[Ce].Amount&&""!=p[Ce].Amount.toString()&&(Qe+=parseFloat(p[Ce].Amount)),Ie=!0;break}if(!Ie)for(let Ce=0;Ce<e.length;Ce++)null!=e[Ce]["Deduction"+this.dsTaxData.Tables[19][Oe].SNo.toString()]&&null!=e[Ce]["Deduction"+this.dsTaxData.Tables[19][Oe].SNo.toString()]&&""!=e[Ce]["Deduction"+this.dsTaxData.Tables[19][Oe].SNo.toString()].toString()&&(Qe+=parseFloat(e[Ce]["Deduction"+this.dsTaxData.Tables[19][Oe].SNo.toString()]))}}Vt+=Qe,this.grdIncomeTax.Data[N].Cells[4].Value=h.J0.GetAmount(Qe)}this.grdIncomeTax.Data[N].Cells[4].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[N].Cells[5].ColSpan=12,this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dvEmpTaxComputation.length>0?parseFloat(this.dvEmpTaxComputation[0].ComponentAmount):Qe),this.grdIncomeTax.Data[N].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",N+=1,Tt+=1}this.intNewOtherDeducunder8oCto80CCCIndex1=Tt-1,this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTotalIncomeIndex=this.intNewOtherDeducunder8oCto80CCCIndex1+1,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[1].Value=this.dblNewTotalIncomeIndex,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[2].Value=-113,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].Value="Total Income",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[3].ColSpan=14,this.dblNewTotalIncome=this.dblNewGrossTotalIncome-this.dblNewTotaldeduction80ccc80c-Vt,this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblNewTotalIncome),this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTotalIncomeRoundoffIndex=this.dblNewTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[2].Value=-114,this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[3].Value="Total Income rounded off",this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[3].ColSpan=14,this.dblNewTotalIncomeRoundoff=Math.round(this.dblNewTotalIncome),this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblNewTotalIncomeRoundoff),this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTotalIncomeRoundoffIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTaxOnTotalIncomeIndex=this.dblNewTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+1,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[2].Value=-115,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[3].Value="Tax on Total Income",this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewRebateIndex=this.dblNewTaxOnTotalIncomeIndex+1,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+2,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[2].Value=-116,parseInt(this.cmbYear.SelectedValue)>=2023&&(this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[3].Value="Rebate U/S 87A (Rs.25,000 for Taxable Income below Rs.7,00,000/-)"),this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTaxPayableAfterRebateIndex=this.dblNewRebateIndex+1,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+3,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[2].Value=-117,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[3].Value="Tax Payable after rebate U/S 87A",this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTaxPayableAfterRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewSurchargeIndex=this.dblNewTaxPayableAfterRebateIndex+1,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+4,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[2].Value=-118,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewTaxPayableIndex=this.dblNewSurchargeIndex+1,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+5,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[2].Value=-119,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].Value="Tax Payable",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewEducationCessIndex=this.dblNewTaxPayableIndex+1,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+6,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[2].Value=-120,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.dblNewSecHighEduCessIndex=this.dblNewEducationCessIndex+1,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[1].Value=this.dblNewTotalIncomeRoundoffIndex+7,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[2].Value=-121,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.dblNewSecHighEduCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.intNewTotalIncometaxPayableindex=this.dblNewSecHighEduCessIndex+1,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[17].Value=1,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[0].Value=0,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[1].Value=this.intNewTotalIncometaxPayableindex,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[2].Value=-122,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].Value="Total Income Tax Payable",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.intNewTotalIncometaxPayableindex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewTDSPaidIndex=this.intNewTotalIncometaxPayableindex+1,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[1].Value=this.NewTDSPaidIndex,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[2].Value=-123,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[3].Value="TDS Paid",this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value=h.J0.GetAmount(this.dblTDS),this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewTDSPaidIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Green",this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.NewNetTaxPayableIndex=this.NewTDSPaidIndex+1,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[17].Value=1,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[0].Value=0,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[1].Value=this.NewNetTaxPayableIndex,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[2].Value=-124,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].Value="Net Tax Payable",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].CellAppearance.Alignment="Left",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].ColSpan=14,this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[3].CellAppearance.ForeColor="Red",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.Alignment="Right",this.grdIncomeTax.Data[this.NewNetTaxPayableIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].CellAppearance.ForeColor="Red",this.UpdateTotalsNewRegime(this.dblNewTotalIncomeRoundoff)}}catch(l){Logger.ErrorLog("Error : "+l)}}cmbYear_SelectionChanged(l){this.clear(0),this.ITComputationViewModel.FilterEmployees(),this.ITComputationViewModel.lFinancialDate=this.ITComputationViewModel.GetFinancialYear(),null!=this.lstEmployee.SelectedValue&&0!=this.lstEmployee.SelectedValue&&(this.grdIncomeTax.addEmptyRowsWithCellApperance(1),this.ITComputationViewModel.OnYearSelected("Year"),this.FillDetails())}PrintForm16_Click(l){var a=this;return(0,de.A)(function*(){if(null==a.dtpDate.Date&&(a.dtpDate.Date=new Date),!(a.lstEmployee.SelectedValue>0))return a.obj.DisplayMessage="Select any Employee",void(a.obj.MessageVisibility=!0);a.txtPlace.Text.Trim(),a.dtpDate.Date.ToString("dd/MMM/yyyy"),a.LoadForm16PrintGrid(),a.Form16export()})()}LoadForm16PrintGrid(){let l,i="",o=-1,d=-1,m=-1,C=-1;this.grdPrint=new je.j,this.grdPrint.ItComput=!0,this.grdPrint.Data.Clear(),this.grdPrint.ReportColumns.Clear();let g=new pe.bA;g.Alignment="Center",g.FontFamilyName="Arial",g.FontSize=12,g.IsBold=!0,g.BackColor="White",g.ForeColor="Black",g.IsVisible=!0;let p,y=new pe.bA;y.Alignment="Left",y.FontFamilyName="Arial",y.FontSize=12,y.IsBold=!0,y.BackColor="White",y.ForeColor="#FF333333";for(let O=1;O<=10;O++)p=new Fe.D_,p.FieldName="Col"+O.toString(),p.width=70,p.HeaderText="Col"+O.toString(),p.HeaderAppearance=g,p.DataAppearance=y,this.grdPrint.ReportColumns.push(p);this.grdPrint.ReportColumns[0].width=60,this.grdPrint.ReportColumns[3].width=75,this.grdPrint.ReportColumns[4].width=90,this.grdPrint.ReportColumns[5].width=75,this.grdPrint.ReportColumns[6].width=40,this.grdPrint.ReportColumns[7].width=90,this.grdPrint.ReportColumns[8].width=90,this.grdPrint.ReportColumns[9].width=90;let e=0;this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="FORM NO. 16",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="[See rule 31(1)(a)]",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="PART A",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Certificate under Section 203 of the Income-tax Act, 1961 for tax deducted at source on salary",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Name and address of the Employer",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="Name and address of the Employee",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=5,l=this.dsTaxData.Tables[23].filter(O=>O.DBIndex==r.d.SessionManager.CompanyIndex),i="",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Name&&null!=l[0].Name&&""!=l[0].Name.toString().Trim()?l[0].Name.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n":"")),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=5,l=this.dsTaxData.Tables[24].filter(O=>4==O.AddressTypeID),i="",i+="\t"+this.dsTaxData.Tables[18][0].Name.toString().Trim()+"\r\n",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n\t":"")),this.grdPrint.Data[e].Cells[5].Value=i,this.grdPrint.Data[e].Cells[5].ColSpan=5,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="PAN of the Deductor",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=3,this.grdPrint.Data[e].Cells[3].Value="TAN of the Deductor",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=3,this.grdPrint.Data[e].Cells[6].Value="PAN of the Employee",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="Employee Reference No. provided by the Employer (If available)",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,l=this.dsTaxData.Tables[23].filter(O=>O.DBIndex==r.d.SessionManager.CompanyIndex),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=null!=l&&l.length>0&&null!=l[0].PANNo&&null!=l[0].PANNo&&""!=l[0].PANNo.toString().Trim()?l[0].PANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=3,this.grdPrint.Data[e].Cells[3].Value=null!=l&&l.length>0&&null!=l[0].TANNo&&null!=l[0].TANNo&&""!=l[0].TANNo.toString().Trim()?l[0].TANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=3,this.grdPrint.Data[e].Cells[6].Value=this.dsTaxData.Tables[18].length>0&&null!=this.dsTaxData.Tables[18][0].PANNo&&null!=this.dsTaxData.Tables[18][0].PANNo&&""!=this.dsTaxData.Tables[18][0].PANNo.toString().Trim()?this.dsTaxData.Tables[18][0].PANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=this.dsTaxData.Tables[18].length>0&&null!=this.dsTaxData.Tables[18][0].Code&&null!=this.dsTaxData.Tables[18][0].Code?this.dsTaxData.Tables[18][0].Code.toString():"",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="CIT (TDS)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="Assessment Year",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=3,this.grdPrint.Data[e].Cells[8].Value="Period with the Employer\r\nFrom                  To",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Acknowledgement Nos. of all quarterly statements of TDS under sub sec. (3) of Sec.200 as provided by the TIN Facilitation Centre or NSDL website.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value=(this.dtToMonth.getFullYear()+"-"+(this.dtToMonth.getFullYear()+1).toString().substr(2)).toString(),this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=3,this.grdPrint.Data[e].Cells[8].Value=this.dtFromMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].Value=this.dtToMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Summary of amount paid/credited and tax deducted at source thereon in respect of the employee",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Quarter(s)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].Value="Receipt Numbers of original quarterly statements of TDS under sub-section (3) of Section 200",this.grdPrint.Data[e].Cells[2].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].Value="Amount paid/credited",this.grdPrint.Data[e].Cells[4].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].Value="Amount of tax deducted (Rs.)",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="Amount of tax deposited/remitted in respect",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Q1",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,o=e,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Q2",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Q3",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Q4",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,d=e,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Total (Rs.)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=2,this.grdPrint.Data[e].Cells[2].Value="",this.grdPrint.Data[e].Cells[2].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[2].ColSpan=2,this.grdPrint.Data[e].Cells[4].Value="",this.grdPrint.Data[e].Cells[4].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[4].ColSpan=2,this.grdPrint.Data[e].Cells[6].Value="",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="I. DETAILS OF TAX DEDUCTED AND DEPOSITED IN THE CENTRAL GOVERNMENT ACCOUNT THROUGH BOOK ADJUSTMENT\r\n(The deductor to provide payment wise details of tax deducted and deposited with respect to the deductee)",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",e++,m=e,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Sl. No.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Tax Deposited in respect of the deductee (Rs.)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Book Identification Number (BIN)",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[3].Value="Receipt Numbers of Form No. 24G",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=2,this.grdPrint.Data[e].Cells[5].Value="DDO serial number in Form no. 24G",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=2,this.grdPrint.Data[e].Cells[7].Value="Date of transfer voucher \r\n (dd/mm/yyyy)",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=2,this.grdPrint.Data[e].Cells[9].Value="Status of matching with Form no. 24G",this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].ColSpan=1,this.grdPrint.Data[m].Cells[0].rowSpan=2,this.grdPrint.Data[m].Cells[1].rowSpan=2,this.grdPrint.Data[m].Cells[2].rowSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Total (Rs.)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].ColSpan=2,this.grdPrint.Data[e].Cells[5].ColSpan=2,this.grdPrint.Data[e].Cells[7].ColSpan=2,this.grdPrint.Data[e].Cells[9].ColSpan=1,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="II. DETAILS OF TAX DEDUCTED AND DEPOSITED IN THE CENTRAL GOVERNMENT ACCOUNT THROUGH CHALLAN\r\n(The deductor to provide payment wise details of tax deducted and deposited with respect to the deductee)",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",e++,C=e,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Sl. No.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Tax Deposited in respect of the deductee (Rs.)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Challan Identification Number (CIN)",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[3].Value="BSR Code of the Bank Branch",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=2,this.grdPrint.Data[e].Cells[5].Value="Date on which Tax deposited (dd/mm/yyyy)",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=2,this.grdPrint.Data[e].Cells[7].Value="Challan Serial Number",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=2,this.grdPrint.Data[e].Cells[9].Value="Status of matching with OLTAS*",this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].ColSpan=1,this.grdPrint.Data[C].Cells[0].rowSpan=2,this.grdPrint.Data[C].Cells[1].rowSpan=2,this.grdPrint.Data[C].Cells[2].rowSpan=2;let u=0,T=0,A=0,k=0,x=0,F=0,_=r.d.common.GetDataTable("INC001",this.iSelectedEmpSeqNo.toString()+"~"+this.obj.EmpYear.SelectedValue);if(null!=_&&_.length>0){if(l=_.filter(O=>"Monthly"==O.dcAlpha2),null!=l&&l.length>0){u=0;for(let O=0;O<l.length;O++)e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=O+1,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,F=0,F=h.J0.Double(l[O].dcNum5.toString()),this.grdPrint.Data[e].Cells[1].Value=F.ToString("0.00"),this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[1].ColSpan=2,u+=F,this.grdPrint.Data[e].Cells[3].Value=null!=l[O].dcAlpha5&&null!=l[O].dcAlpha5?l[O].dcAlpha5.toString():"",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=2,this.grdPrint.Data[e].Cells[5].Value=null!=l[O].dcAlpha6&&null!=l[O].dcAlpha6?h.J0.ParseDate(l[O].dcAlpha6).ToString("dd'-'MMM'-'yyyy"):"",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=2,this.grdPrint.Data[e].Cells[7].Value=null!=l[O].dcAlpha7&&null!=l[O].dcAlpha7?l[O].dcAlpha7.toString():"",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=2,this.grdPrint.Data[e].Cells[9].Value="F",this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].ColSpan=1}if(e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Total (Rs.)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value=u.ToString("0.00"),this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].ColSpan=7,l=_.filter(O=>"Quarterly"==O.dcAlpha2),null!=l&&l.length>0){u=T=A=k=x=0;let O=0;for(let Je=0;Je<l.length;Je++)O=parseInt(l[Je].dcAlpha3.toString().Replace("Quarter",""))-1,this.grdPrint.Data[o+O].Cells[2].Value=null!=l[Je].dcAlpha8&&null!=l[Je].dcAlpha8?l[Je].dcAlpha8.toString():"",this.grdPrint.Data[o+O].Cells[2].CellAppearance.Alignment="Center",this.grdPrint.Data[o+O].Cells[2].ColSpan=2,F=0,0==O?(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[5].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[5].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[5].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[6].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[6].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[6].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[7].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[7].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[7].Value):0):1==O?(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[8].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[8].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[8].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[9].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[9].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[9].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[10].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[10].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[10].Value):0):2==O?(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[11].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[11].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[11].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[12].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[12].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[12].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[13].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[13].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[13].Value):0):3==O&&(F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[14].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[14].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[14].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[15].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[15].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[15].Value):0,F+=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[16].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[16].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[16].Value):0),this.grdPrint.Data[o+O].Cells[4].Value=F.ToString("0.00"),this.grdPrint.Data[o+O].Cells[4].CellAppearance.Alignment="Right",this.grdPrint.Data[o+O].Cells[4].ColSpan=2,u+=F,F=0,F=h.J0.Double(l[Je].dcNum6.toString()),this.grdPrint.Data[o+O].Cells[6].Value=F.ToString("0.00"),this.grdPrint.Data[o+O].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[o+O].Cells[6].ColSpan=2,T+=F,F=0,F=h.J0.Double(l[Je].dcNum7.toString()),this.grdPrint.Data[o+O].Cells[8].Value=F.ToString("0.00"),this.grdPrint.Data[o+O].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[o+O].Cells[8].ColSpan=2,A+=F}this.grdPrint.Data[d+1].Cells[4].Value=u.ToString("0.00"),this.grdPrint.Data[d+1].Cells[4].CellAppearance.Alignment="Right",this.grdPrint.Data[d+1].Cells[4].ColSpan=2,this.grdPrint.Data[d+1].Cells[6].Value=T.ToString("0.00"),this.grdPrint.Data[d+1].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[d+1].Cells[6].ColSpan=2,this.grdPrint.Data[d+1].Cells[8].Value=A.ToString("0.00"),this.grdPrint.Data[d+1].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[d+1].Cells[8].ColSpan=2}e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Verification",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),i="",i="I, "+h.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text).toUpperCase()+", son / daughter of "+(null==this.ITComputationViewModel.lstResponsiblePerson.Tag?"":this.ITComputationViewModel.lstResponsiblePerson.Tag.toString().toUpperCase())+" working in the capacity of "+this.ITComputationViewModel.txtDesignation.toUpperCase()+" (designation) do hereby certify that a sum of Rs. "+this.grdPrint.Data[d+1].Cells[6].Value+" ["+h.J0.ConvertNumberToText(parseFloat(null!=this.grdPrint.Data[d+1].Cells[6].Value&&null!=this.grdPrint.Data[d+1].Cells[6].Value&&""!=this.grdPrint.Data[d+1].Cells[6].Value.toString()?this.grdPrint.Data[d+1].Cells[6].Value:"0").ToString("N2"),"2","Rs.","Paisa","English")+" (in words)] has been deducted and a sum of Rs. "+this.grdPrint.Data[d+1].Cells[8].Value+" ["+h.J0.ConvertNumberToText(parseFloat(null!=this.grdPrint.Data[d+1].Cells[6].Value&&null!=this.grdPrint.Data[d+1].Cells[6].Value&&""!=this.grdPrint.Data[d+1].Cells[6].Value.toString()?this.grdPrint.Data[d+1].Cells[8].Value:"0").ToString("N2"),"2","Rs.","Paisa","English")+" ] has been deposited to the credit of the Central Government. I further certify that the information given above is true, complete and correct and is based on the books of account, documents, TDS statements, TDS deposited and other available records.",this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="(Signature of person responsible for deduction of Tax)",this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Place : "+this.txtPlace.Text.Trim(),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[5].Value="Full Name : "+h.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text).toString(),this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Date  : "+this.dtpDate.Date.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[5].Value="Designation : "+this.ITComputationViewModel.txtDesignation,this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Notes :",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),i="",i="1. Part B (Annexure) of the certificate in Form No.16 shall be issued by the employer.\n\n2. If an assessee is employed under one employer during the year, Part 'A' of the certificate in Form No.16 issued for the quarter ending on 31st March of the financial year shall contain the details of tax deducted and deposited for all the quarters of the financial year.\n\n3. If an assessee is employed under more than one employer during the year, each of the employers shall issue Part A of the certificate in Form No.16 pertaining to the period for which such assessee was employed with each of the employers. Part B (Annexure) of the certificate in Form No. 16 may be issued by each of the employers or the last employer at the option of the assessee.\n\n4. To update PAN details in Income Tax Department database, apply for 'PAN change request' through NSDL or UTITSL.\n\n",this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Legend used in Form 16",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   * Status of matching with OLTAS",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Legend",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Description",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Definition",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="U",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Unmatched",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Deductors have not deposited taxes or have furnished incorrect particulars of tax payment. Final credit will be reflected only when payment details in bank match with details of deposit in TDS / TCS statement",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="P",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Provisional",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value='Provisional tax credit is effected only for TDS / TCS Statements filed by Government deductors."P" status will be changed to Final (F) on verification of payment details submitted by Pay and Accounts Officer (PAO)',this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="F",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Final",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="In case of non-government deductors, payment details of TDS / TCS deposited in bank by deductor have matched with the payment details mentioned in the TDS / TCS statement filed by the deductors. In case of government deductors, details of TDS / TCS booked in Government account have been verified by Pay & Accounts Officer (PAO)",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="O",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=1,this.grdPrint.Data[e].Cells[1].Value="Overbooked",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=2,this.grdPrint.Data[e].Cells[3].Value="Payment details of TDS / TCS deposited in bank by deductor have matched with details mentioned in the TDS / TCS statement but the amount is over claimed in the statement. Final (F) credit will be reflected only when deductor reduces claimed amount in the statement or makes new payment for excess amount claimed in the statement",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[3].ColSpan=7,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Tag="Break",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="FORM NO. 16",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="PART B",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Certificate under Section 203 of the Income-tax Act, 1961 for tax deducted at source on salary",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Name and address of the Employer",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="Name and address of the Employee",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=5,l=this.dsTaxData.Tables[23].filter(O=>O.DBIndex==r.d.SessionManager.CompanyIndex),i="",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Name&&null!=l[0].Name&&""!=l[0].Name.toString().Trim()?l[0].Name.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n":"")),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=5,l=this.dsTaxData.Tables[24].filter(O=>4==O.AddressTypeID),i="",i+="\t"+this.dsTaxData.Tables[18][0].Name.toString().Trim()+"\r\n",null!=l&&l.length>0&&(i+="\t"+(null!=l[0].Address1&&null!=l[0].Address1&&""!=l[0].Address1.toString().Trim()?l[0].Address1.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address2&&null!=l[0].Address2&&""!=l[0].Address2.toString().Trim()?l[0].Address2.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Address3&&null!=l[0].Address3&&""!=l[0].Address3.toString().Trim()?l[0].Address3.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].City&&null!=l[0].City&&""!=l[0].City.toString().Trim()?l[0].City.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].State&&null!=l[0].State&&""!=l[0].State.toString().Trim()?l[0].State.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Zip&&null!=l[0].Zip&&""!=l[0].Zip.toString().Trim()?l[0].Zip.toString().Trim()+"\r\n\t":""),i+="\t"+(null!=l[0].Country&&null!=l[0].Country&&""!=l[0].Country.toString().Trim()?l[0].Country.toString().Trim()+"\r\n\t":"")),this.grdPrint.Data[e].Cells[5].Value=i,this.grdPrint.Data[e].Cells[5].ColSpan=5,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="PAN of the Deductor",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=3,this.grdPrint.Data[e].Cells[3].Value="TAN of the Deductor",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=4,this.grdPrint.Data[e].Cells[7].Value="PAN of the Employee",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=3,l=this.dsTaxData.Tables[23].filter(O=>O.DBIndex==r.d.SessionManager.CompanyIndex),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value=null!=l&&l.length>0&&null!=l[0].PANNo&&null!=l[0].PANNo&&""!=l[0].PANNo.toString().Trim()?l[0].PANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=3,this.grdPrint.Data[e].Cells[3].Value=null!=l&&l.length>0&&null!=l[0].TANNo&&null!=l[0].TANNo&&""!=l[0].TANNo.toString().Trim()?l[0].TANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[3].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[3].ColSpan=4,this.grdPrint.Data[e].Cells[7].Value=this.dsTaxData.Tables[18].length>0&&null!=this.dsTaxData.Tables[18][0].PANNo&&null!=this.dsTaxData.Tables[18][0].PANNo&&""!=this.dsTaxData.Tables[18][0].PANNo.toString().Trim()?this.dsTaxData.Tables[18][0].PANNo.toString().Trim():"",this.grdPrint.Data[e].Cells[7].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[7].ColSpan=3,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="CIT (TDS)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="Assessment Year",this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=3,this.grdPrint.Data[e].Cells[8].Value="Period with the Employer\r\nFrom                  To",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Acknowledgement Nos. of all quarterly statements of TDS under sub sec. (3) of Sec.200 as provided by the TIN Facilitation Centre or NSDL website.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value=(this.dtToMonth.getFullYear()+"-"+(this.dtToMonth.getFullYear()+1).toString().substr(2)).toString(),this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[5].ColSpan=3,this.grdPrint.Data[e].Cells[8].Value=this.dtFromMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[9].Value=this.dtToMonth.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[9].CellAppearance.Alignment="Center",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Details of Salary Paid and any other income and tax deducted",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[0].ColSpan=6,this.grdPrint.Data[e].Cells[6].Value="Rs",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="Rs.",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Center",this.grdPrint.Data[e].Cells[8].ColSpan=2;let f=0,E=0,N=0,ae=0,z=0,W=0,V=0,he=0,ye=0;e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="1.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Gross Salary",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Salary as per provisions contained in section 17(1)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.TotalSalaryIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Value of perquisites under section 17(2) (as per Form No. 12BA, wherever applicable)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.Form12Section1Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.Form12Section1Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.Form12Section1Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (c)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Profits in lieu of salary under section 17(3) (as per Form No. 12BA, wherever applicable)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.Form12Section2Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.Form12Section2Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.Form12Section2Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (d)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=7,this.grdPrint.Data[e].Cells[8].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,E=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (e)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Reported total amount of salary received from other employer(s)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value="0.00",this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,N=parseFloat(this.grdPrint.Data[e].Cells[8].Value),f=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="2.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Less: Allowances to the extent exempt under section 10",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Travel concession or assistance under section 10(5)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.LTAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.LTAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.LTAIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Death-cum-retirement gratuity under section 10(10)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (c)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Commuted value of pension under section 10(10A)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (d)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Cash equivalent of leave salary encashment under section 10 (10AA)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (e)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="House rent allowance under section 10(13A)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.HRAExemptionIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (f)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Amount of any other exemption under section 10 [Note: Break-up to be prepared by employee and issued to the employee, where applicable , before furnishing of Part B to the employee]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (g)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of any other exemption under section 10",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=this.grdIncomeTax.Data[this.TotAmtOthExemptUs10Index].Cells[this.grdIncomeTax.ReportColumns.length-1].Value,this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (h)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of exemption claimed under section 10\r\n [2(a)+2(b)+2(c)+2(d)+2(e)+2(g)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,E-=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="3.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of salary received from current employer\r\n[1(d)-2(h)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=E.toString(),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,N+=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="4.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Less: Deductions under section 16",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,f=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Standard deduction under section 16(ia)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.StandardDedIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Entertainment allowance under section 16(ii)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (c)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Tax on employment under section 16(iii)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.ProfessionalTaxIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,f+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="5.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of deductions under section 16\r\n[4(a)+4(b)+4(c)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,N-=parseFloat(this.grdPrint.Data[e].Cells[8].Value),z=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="6.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value='Income chargeable under the head "Salaries"\r\n[(3+1(e))-5]',this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=N.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,z+=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="7.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Add: Any other income reported by the employee under as per section 192 (2B)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,ae=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Income (or admissible loss) from house property reported by employee offered for TDS",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?(-1*parseFloat(this.grdIncomeTax.Data[this.IncomefromHousePropertyIndex+4].Cells[this.grdIncomeTax.ReportColumns.length-1].Value)).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,ae+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Income under the head Other Sources offered for TDS",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.GrossTotalIncomeIndex-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.GrossTotalIncomeIndex-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.GrossTotalIncomeIndex-1].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].ColSpan=2,ae+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="8.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total amount of other income reported by the employee\r\n[7(a)+7(b)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=ae.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,z+=parseFloat(this.grdPrint.Data[e].Cells[8].Value),V=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="9.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Gross total income (6+8)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=2,this.grdPrint.Data[e].Cells[8].Value=z.ToString("0.00"),this.grdPrint.Data[e].Cells[8].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[8].ColSpan=2,V+=parseFloat(this.grdPrint.Data[e].Cells[8].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="10.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deductions under Chapter VI-A",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=9,W=0;let Pe=0;for(let O=this.intDeducunder8oCto80CCCIndex+1;O<this.intTotalDeducunder8oCto80CCCIndex;O++)if(null!=this.grdIncomeTax.Data[O].Cells[3].Value&&this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80CCC-")){Pe+=null!=this.grdIncomeTax.Data[O].Cells[4].Value&&""!=this.grdIncomeTax.Data[O].Cells[4].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[4].Value):0;break}e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (a)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of life insurance premia, contributions to provident fund etc. under section 80C",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?(this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value-Pe).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (b)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of contribution to certain pension funds under section 80CCC",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=Pe.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,f=0;for(let O=this.intOtherDeducunder8oCto80CCCIndex;O<=this.intOtherDeducunder8oCto80CCCIndex1;O++)null!=this.grdIncomeTax.Data[O].Cells[3].Value&&this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80CCD(1)-")&&(f+=null!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (c)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of contribution by taxpayer to pension scheme under section 80CCD (1)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4;let Ge=f;e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (d)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total deduction under section 80C, 80CCC and 80CCD(1)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=(Ge+parseFloat(null!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.intTotalDeducunder8oCto80CCCIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00")).ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let O=this.intOtherDeducunder8oCto80CCCIndex;O<=this.intOtherDeducunder8oCto80CCCIndex1;O++)null!=this.grdIncomeTax.Data[O].Cells[3].Value&&this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80CCD(1B)-")&&(f+=null!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (e)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deductions in respect of amount paid/deposited to notified pension scheme under section 80CCD (1B)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let O=this.intOtherDeducunder8oCto80CCCIndex;O<=this.intOtherDeducunder8oCto80CCCIndex1;O++)null!=this.grdIncomeTax.Data[O].Cells[3].Value&&this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80CCD(2)-")&&(f+=null!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (f)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of contribution by Employer to pension scheme under section 80CCD (2)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let O=this.intOtherDeducunder8oCto80CCCIndex;O<=this.intOtherDeducunder8oCto80CCCIndex1;O++)null!=this.grdIncomeTax.Data[O].Cells[3].Value&&this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80D-")&&(f+=null!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (g)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of health insurance premia under section 80D",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let O=this.intOtherDeducunder8oCto80CCCIndex;O<=this.intOtherDeducunder8oCto80CCCIndex1;O++)null!=this.grdIncomeTax.Data[O].Cells[3].Value&&this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80DD-")&&(f+=null!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (h)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of Medical Treatment of handicapped Dependent under section 80DD",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let O=this.intOtherDeducunder8oCto80CCCIndex;O<=this.intOtherDeducunder8oCto80CCCIndex1;O++)null!=this.grdIncomeTax.Data[O].Cells[3].Value&&this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80U-")&&(f+=null!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (i)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of Physically Disable Assesse under section 80U",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let O=this.intOtherDeducunder8oCto80CCCIndex;O<=this.intOtherDeducunder8oCto80CCCIndex1;O++)null!=this.grdIncomeTax.Data[O].Cells[3].Value&&this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80E-")&&(f+=null!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (j)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of interest on loan taken for higher education under section 80E",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let O=this.intOtherDeducunder8oCto80CCCIndex;O<=this.intOtherDeducunder8oCto80CCCIndex1;O++)null!=this.grdIncomeTax.Data[O].Cells[3].Value&&(this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80G-")||this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80GGA-")||this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80GGC-"))&&(f+=null!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (k)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total Deduction in respect of donations to certain funds, charitable institutions, etc. under section 80G",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=h.J0.Double(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let O=this.intOtherDeducunder8oCto80CCCIndex;O<=this.intOtherDeducunder8oCto80CCCIndex1;O++)null!=this.grdIncomeTax.Data[O].Cells[3].Value&&this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80TTA-")&&(f+=null!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (l)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of interest on deposits in savings account under section 80TTA",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=h.J0.Double(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let O=this.intOtherDeducunder8oCto80CCCIndex;O<=this.intOtherDeducunder8oCto80CCCIndex1;O++)null!=this.grdIncomeTax.Data[O].Cells[3].Value&&this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80EEB-")&&(f+=null!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (m)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of interest on Electric Vehicle Loan under section 80EEB",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (n)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Amount deductible under any other provision(s) of Chapter VI-A [Note: Break-up to be prepared by employee and issued to the employee, where applicable , before furnishing of Part B to the employee]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].ColSpan=4,f=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (o)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total of amount deductible under any other provision(s) of Chapter VI-A",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let O=this.intOtherDeducunder8oCto80CCCIndex;O<=this.intOtherDeducunder8oCto80CCCIndex1;O++)null!=this.grdIncomeTax.Data[O].Cells[3].Value&&this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80CCF-")&&(f+=null!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (p)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of Amount invested in specific Government approved Infrastructure bonds under section 80CCF",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let O=this.intOtherDeducunder8oCto80CCCIndex;O<=this.intOtherDeducunder8oCto80CCCIndex1;O++)null!=this.grdIncomeTax.Data[O].Cells[3].Value&&this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80DDB-")&&(f+=null!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (q)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction for Medical Treatment of certain specified ailments for Self/Dependent under section 80DDB",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),f=0;for(let O=this.intOtherDeducunder8oCto80CCCIndex;O<=this.intOtherDeducunder8oCto80CCCIndex1;O++)null!=this.grdIncomeTax.Data[O].Cells[3].Value&&this.grdIncomeTax.Data[O].Cells[3].Value.toString().startsWith("80GG-")&&(f+=null!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[O].Cells[this.grdIncomeTax.ReportColumns.length-1].Value):0);e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="   (r)",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Deduction in respect of house rent paid who does not get HRA under section 80GG",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=f.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,W+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="11.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Aggregate of deductible amount under Chapter VI-A\r\n[10(d)+10(e)+10(f)+10(g)+10(h)+10(i)+10(j)+10(k)+10(l)+10(m)+10(n)+10(o)+10(p)+10(q)+10(r)]",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=W.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,V-=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="12.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Total taxable income (9-11)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=Math.round(V).ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,he=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="13.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Tax on total income",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblTaxOnTotalIncomeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,he+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="14.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Rebate under section 87A, if applicable",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblRebateIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,he-=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="15.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Surcharge, wherever applicable",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblSurchargeIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,he+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="16.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Health and education cess",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=null!=this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value&&""!=this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value.toString()?parseFloat(this.grdIncomeTax.Data[this.dblEducationCessIndex].Cells[this.grdIncomeTax.ReportColumns.length-1].Value).ToString("0.00"):"0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,he+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),ye=0,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="17.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Tax payable (13+15+16-14)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=he.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,ye+=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="18.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Less: Relief under section 89 (attach details)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value="0.00",this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,ye-=parseFloat(this.grdPrint.Data[e].Cells[6].Value),e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="19.",this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].Value="Net tax payable (17-18)",this.grdPrint.Data[e].Cells[1].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[1].ColSpan=5,this.grdPrint.Data[e].Cells[6].Value=ye.ToString("0.00"),this.grdPrint.Data[e].Cells[6].CellAppearance.Alignment="Right",this.grdPrint.Data[e].Cells[6].ColSpan=4,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Verification",this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Center",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),i="",i="I, "+h.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text).toUpperCase()+", son / daughter of "+(null==this.ITComputationViewModel.lstResponsiblePerson.Tag?"":this.ITComputationViewModel.lstResponsiblePerson.Tag.toString().toUpperCase())+" working in the capacity of "+this.ITComputationViewModel.txtDesignation.toUpperCase()+" (designation) do hereby certify that the information given above is true, complete and correct and is based on the books of account, documents, TDS statements, and other available records.",this.grdPrint.Data[e].Cells[0].Value=i,this.grdPrint.Data[e].Cells[0].ColSpan=10,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=10,e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[5].Value="(Signature of person responsible for deduction of Tax)",this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Place : "+this.txtPlace.Text.Trim(),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[5].Value="Full Name : "+h.J0.StringValue(this.ITComputationViewModel.lstResponsiblePerson.Text),this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left",e++,this.grdPrint.addEmptyRowsWithCellApperance(1),this.grdPrint.Data[e].Cells[0].Value="Date  : "+this.dtpDate.Date.ToString("dd'-'MMM'-'yyyy"),this.grdPrint.Data[e].Cells[0].ColSpan=5,this.grdPrint.Data[e].Cells[0].CellAppearance.Alignment="Left",this.grdPrint.Data[e].Cells[5].Value="Designation : "+this.ITComputationViewModel.txtDesignation,this.grdPrint.Data[e].Cells[5].ColSpan=5,this.grdPrint.Data[e].Cells[5].CellAppearance.Alignment="Left"}generatePrintContent(l,a="",i=!1,o=!1){let d="",m="",C="",g="",p="";if(d+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",m+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",m+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",m+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",m+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",d+="<style>"+m.toString()+"</style>",p=d,p+=`<h3 style="text-align: center;">${a}</h3>`,p+=" <table  border=1  style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",o){p+="<thead>",p+="<tr>";for(let u=0;u<l.ReportColumns.length;u++){const T=l.ReportColumns[u];T.HeaderAppearance.IsVisible&&(p+=`<th  width=${T.width} ></th>`)}p+="</tr>",p+="</thead>"}else{p+="<thead>",p+="<tr>";for(let u=0;u<l.ReportColumns.length;u++){const T=l.ReportColumns[u];T.HeaderAppearance.IsVisible&&(p+=`<th class='hdr'  width=${T.width} >${T.HeaderText}</th>`)}p+="</tr>",p+="</thead>"}p+="<tbody>";for(let u=0;u<l.Data.length;u++){p+="<tr",u%2==1&&(p+=" class=alt"),p+=">";const T=l.Data[u];for(let A=0;A<l.ReportColumns.length;)l.ReportColumns[A].HeaderAppearance.IsVisible?(p+=T.Cells[A].ColSpan>1?`<td  align=${T.Cells[A].CellAppearance.Alignment} colspan=${T.Cells[A].ColSpan} `:"<td ",null!=T.Cells[A].CellAppearance&&(C=(T.Cells[A].CellAppearance.ForeColor.startsWith("#ff")||T.Cells[A].CellAppearance.ForeColor.startsWith("#FF"))&&9==T.Cells[A].CellAppearance.ForeColor.length?"#"+T.Cells[A].CellAppearance.ForeColor.substr(3):T.Cells[A].CellAppearance.ForeColor,g=(T.Cells[A].CellAppearance.BackColor.startsWith("#ff")||T.Cells[A].CellAppearance.BackColor.startsWith("#FF"))&&9==T.Cells[A].CellAppearance.BackColor.length?"#"+T.Cells[A].CellAppearance.BackColor.substr(3):T.Cells[A].CellAppearance.BackColor,p+=` style='background-color:${g} + ;color:${C}'`),p+=" >",p+=h.J0.StringValue(T.Cells[A].Value),p+="</td>",A+=T.Cells[A].ColSpan):A+=T.Cells[A].ColSpan;p+="</tr>"}return p+="</tbody>",p+="</table>",p}static{this.\u0275fac=function(a){return new(a||L)}}static{this.\u0275cmp=s.VBU({type:L,selectors:[["app-income-tax-computation"]],standalone:!1,decls:110,vars:29,consts:[["id","maincontainer",1,"maincontainer",2,"display","flex","padding","12px"],[2,"flex-direction","column","justify-content","flex-end","width","100%"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-save"],["class","secondary-btn-wicon",3,"click",4,"ngIf"],[1,"fa-light","fa-trash-alt"],[1,"fa-light","fa-broom"],["class","secondary-btn",3,"click",4,"ngIf"],[1,"main_div","detailed",2,"padding","10px 10px 0 10px"],[1,"row",2,"height","40px"],[1,"form-group","col-xl-4","col-md-4","col-sm-12","col-xs-12","PACTControl",2,"flex-direction","row","align-items","center","justify-content","space-between"],[1,"input_cntrl_label"],[1,"NoLabel",2,"margin-left","5px","width","100px"],["FieldDirective","",3,"obj","group"],[1,"input_cntrl_label",2,"margin-left","10px"],[1,"NoLabel",2,"margin-left","5px","min-width","150px"],[1,"PactMasterTree","Pactpagetree",2,"height","calc(100% - 80px)","width","100%","border","1px solid rgb(204, 204, 204)"],[3,"obj"],[1,"row",2,"height","40px","margin-top","3px"],[1,"form-group","col-xl-3","col-md-3","col-sm-12","col-xs-12","PACTControl",2,"flex-direction","row","align-items","center","justify-content","space-between"],[1,"NoLabel",2,"flex","1","margin-left","5px"],[1,"primary-btn-wicon",2,"flex","1","margin-left","5px",3,"click"],[1,"form-group","col-xl-2","col-md-2","col-sm-12","col-xs-12","PACTControl",2,"flex-direction","row","align-items","center","justify-content","space-between"],[1,"secondary-btn-wicon",3,"click"],[1,"fa-light","fa-print"],[1,"fa-light","fa-file-export"]],template:function(a,i){1&a&&(s.j41(0,"div",0),s.EFF(1,"\n  "),s.j41(2,"div",1),s.EFF(3,"\n  "),s.j41(4,"div",2),s.EFF(5,"\n     "),s.j41(6,"div",3),s.EFF(7,"\n      "),s.j41(8,"span",4),s.EFF(9),s.k0s(),s.EFF(10,"\n    "),s.k0s(),s.EFF(11,"\n    "),s.j41(12,"div",5),s.EFF(13,"\n      "),s.j41(14,"span",6),s.bIt("click",function(){return i.btnSave_Click("Save")}),s.nrm(15,"i",7),s.EFF(16),s.nI1(17,"translate"),s.k0s(),s.EFF(18,"\n      "),s.DNE(19,Ct,4,3,"span",8),s.EFF(20,"\n      "),s.j41(21,"span",6),s.bIt("click",function(){return i.btnSave_Click("Delete")}),s.nrm(22,"i",9),s.EFF(23),s.nI1(24,"translate"),s.k0s(),s.EFF(25,"\n      "),s.j41(26,"span",6),s.bIt("click",function(){return i.btnSave_Click("Clear")}),s.nrm(27,"i",10),s.EFF(28),s.nI1(29,"translate"),s.k0s(),s.EFF(30,"\n      "),s.DNE(31,dt,4,3,"span",11),s.EFF(32,"\n      "),s.DNE(33,Ee,4,3,"span",11),s.EFF(34,"\n      "),s.DNE(35,we,4,3,"span",11),s.EFF(36,"\n    "),s.k0s(),s.EFF(37,"\n  "),s.k0s(),s.EFF(38,"\n  "),s.j41(39,"div",12),s.EFF(40,"\n    "),s.j41(41,"div",13),s.EFF(42,"\n      "),s.j41(43,"div",14),s.EFF(44,"\n        "),s.j41(45,"label",15),s.EFF(46,"Financial Year "),s.k0s(),s.EFF(47,"\n        "),s.j41(48,"div",16),s.EFF(49,"\n          "),s.eu8(50,17),s.EFF(51,"\n        "),s.k0s(),s.EFF(52,"\n        "),s.j41(53,"label",18),s.EFF(54),s.k0s(),s.EFF(55,"\n      "),s.k0s(),s.EFF(56,"\n      "),s.j41(57,"div",14),s.EFF(58,"\n      "),s.j41(59,"label",15),s.EFF(60,"Employee "),s.k0s(),s.EFF(61,"\n      "),s.j41(62,"div",19),s.EFF(63,"\n          "),s.eu8(64,17),s.EFF(65,"\n        "),s.k0s(),s.EFF(66,"\n      "),s.k0s(),s.EFF(67,"\n      "),s.k0s(),s.EFF(68,"\n      "),s.j41(69,"div",20),s.EFF(70,"\n        "),s.nrm(71,"app-report-grid",21),s.EFF(72,"\n      "),s.k0s(),s.EFF(73,"\n      "),s.j41(74,"div",22),s.EFF(75,"\n        "),s.j41(76,"div",23),s.EFF(77,"\n          "),s.j41(78,"label",15),s.EFF(79,"Regime Opted For "),s.k0s(),s.EFF(80,"\n          "),s.j41(81,"div",24),s.EFF(82,"\n            "),s.eu8(83,17),s.EFF(84,"\n          "),s.k0s(),s.EFF(85,"\n          "),s.j41(86,"button",25),s.bIt("click",function(){return i.btnSave_Click("SaveRegime")}),s.EFF(87),s.nI1(88,"translate"),s.k0s(),s.EFF(89,"\n        "),s.k0s(),s.EFF(90,"\n        "),s.j41(91,"div",26),s.EFF(92,"\n       "),s.j41(93,"label",15),s.EFF(94,"Place"),s.k0s(),s.EFF(95,"\n        "),s.j41(96,"div",24),s.EFF(97,"\n          "),s.eu8(98,17),s.EFF(99,"\n        "),s.k0s(),s.EFF(100,"\n        "),s.j41(101,"div",24),s.EFF(102,"\n          "),s.eu8(103,17),s.EFF(104,"\n       "),s.k0s(),s.EFF(105,"\n      "),s.k0s(),s.EFF(106,"\n      \n    "),s.k0s(),s.EFF(107,"\n\n  "),s.k0s(),s.EFF(108,"\n  "),s.k0s(),s.EFF(109,"\n"),s.k0s()),2&a&&(s.R7$(9),s.SpI("\n        ",i.obj.Title,"\n      "),s.R7$(7),s.JRh(s.bMT(17,21,"Save")),s.R7$(3),s.Y8G("ngIf",i.obj.PrintVisiblility),s.R7$(4),s.JRh(s.bMT(24,23,"Delete")),s.R7$(5),s.JRh(s.bMT(29,25,"Clear")),s.R7$(3),s.Y8G("ngIf",i.obj.ExportVisiblility),s.R7$(2),s.Y8G("ngIf",i.obj.WorksheetVisiblility),s.R7$(2),s.Y8G("ngIf",i.obj.TDSPostVisiblility),s.R7$(15),s.Y8G("obj",i.obj.EmpYear)("group",i.form),s.R7$(4),s.JRh(i.obj.lFinancialDate),s.R7$(10),s.Y8G("obj",i.obj.Employee)("group",i.form),s.R7$(7),s.Y8G("obj",i.grdIncomeTax),s.R7$(12),s.Y8G("obj",i.obj.EmpRegime)("group",i.form),s.R7$(4),s.JRh(s.bMT(88,27,"SaveRegime")),s.R7$(11),s.Y8G("obj",i.txtPlace)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.dtpDate)("group",i.form))},dependencies:[xe.bT,$e._,ve.e,qe.D9],encapsulation:2})}}return L})();class nt{constructor(){this.FromSlab=0,this.ToSlab=0,this.Percentage=0}}var ht=G(86246);class pt{constructor(t){this.MessageVisibility=!1,this.sBMConString="",this.bUseROffTimings=!1,this.bDocColumns=!1,this.bDirection=!1,this.sBMDBAdapterAccess="",this.IsAutoPost=!1,this.dtConfig=null,this.dicConf=new le.bT,this.BMCDeviceBrandName=te.y$.PactComboBoxData3("BMCDeviceBrandName",10),this.BMCDatabaseType=te.y$.PactComboBoxData3("BMCDatabaseType",10),this.BMCServerName=new ie.Dw(0),this.BMCUserId=new ie.Dw(0),this.BMCPassword=new ie.Dw(0),this.BMCDatabaseName=new ie.Dw(0),this.ETMEmpTableName=new ie.Dw(0),this.ETMEmpSeqNo=new ie.Dw(0),this.ETMEmpCode=new ie.Dw(0),this.ETMEmpCodeInDevice=new ie.Dw(0),this.ETMEmpName=new ie.Dw(0),this.ETMEmpWhere=new ie.Dw(0),this.APTMAttendPunchTableName=new ie.Dw(0),this.APTMEmpSeqNo=new ie.Dw(0),this.APTMEmpCode=new ie.Dw(0),this.APTMEmpCodeInDevice=new ie.Dw(0),this.APTMPunchDateTime=new ie.Dw(0),this.APTMDeviceNo=new ie.Dw(0),this.APTMDeviceNoValues=new ie.Dw(0),this.APTMDirection=new ie.Dw(0),this.APTMDirectionInVal=new ie.Dw(0),this.APTMDirectionOutVal=new ie.Dw(0),this.APTMAttendPunchWhere=new ie.Dw(0),this.FromDate=new Z.Lc(0),this.ToDate=new Z.Lc(0),this.DPCDocumentName=te.y$.PactComboBoxData3("DPCDocumentName",10),this.ROTUseROffTimings=Ye.c.PactCheckBoxData_1("Use Round off Timings",10),this.GetMultipleCheckINOUTInaDay=Ye.c.PactCheckBoxData_1("Get Multiple Check IN/OUT in a Day",10),this.OverrideAttendanceDoc=Ye.c.PactCheckBoxData_1("Override Attendance Document",10),this.DonotPullBiometricDataifAttendanceisposted=Ye.c.PactCheckBoxData_1("Do not Pull Biometric Data if Attendance is posted",10),this.AutoPostAtaTime=Ye.c.PactCheckBoxData_1("AutoPost At a Time",10),this.SortBasedOn=te.y$.PactComboBoxData3("SortBasedOn",10),this.GDBQchkUseQuery=Ye.c.PactCheckBoxData_1("Use Query to get the Data",10),this.GDBQtxtQuery=new ie.Dw(0),this.sFilter="",this.sSelectedEmpSeqNos="",this.sSelectedEmpCodes="",this.sbPostErrLog="",this.oDocument=null,this.bOverrideAttendanceDoc=!1,this.bDonotPullBiometricDataifAttendanceisposted=!1,this.bAutoPostAtaTime=!1,this.dtShiftsData=null,this.dtBioMetData=null,this.dsbEmps=null,this.dsbDims=null,this.sEmpSeqNosOnGrid="",this.bGetMultipleCheckInOutInaDay=!0;try{Logger.InfoLog("BiometricConfigViewModel::Entering BiometricConfigViewModel()"),this.DisplayName=t,this.Title=t,this.DisplayMessage="",this.ShowConfigurations=!!r.d.SessionManager.IsActionAssigned(141,"Configuration"),this.Initialize(),this.subcontroller()}catch(l){Logger.ErrorLog("BiometricConfigViewModel::EXCEPTION BiometricConfigViewModel()\r\n"+l.Message+"\r\n"+l.stack)}}subcontroller(){var t=this;return(0,de.A)(function*(){yield t.LoadConfig(),t.LoadGrid(),t.DPCDocumentName.SelectionChangedCommand.Subscribe(t,"DPCDocumentNameSelectionChanged"),t.sBMConString=t.GetBMConnString(),t.ToDate.Label="To Date",t.FromDate.Label="From Date"})()}Initialize(){this.BMCDeviceBrandName.Items.Clear(),this.BMCDeviceBrandName.Items.push(te._p.ComboBoxItems_2("***MANUAL***","1")),this.BMCDeviceBrandName.Items.push(te._p.ComboBoxItems_2("ViRDI->AC-5000RF","2")),this.BMCDeviceBrandName.SelectedValue="1",this.BMCDatabaseType.Items.Clear(),this.BMCDatabaseType.Items.push(te._p.ComboBoxItems_2("MS SQL Server","1")),this.BMCDatabaseType.Items.push(te._p.ComboBoxItems_2("MS Access","2")),this.BMCDatabaseType.Items.push(te._p.ComboBoxItems_2("API","3")),this.BMCDatabaseType.SelectedValue="1",this.DPCDocumentName.Items.Clear(),this.DPCDocumentName.Items.push(te._p.ComboBoxItems_2("Attendance","40089")),this.DPCDocumentName.Items.push(te._p.ComboBoxItems_2("Time Sheet","40090")),this.DPCDocumentName.Items.push(te._p.ComboBoxItems_2("Daily Attendance","40067")),this.DPCDocumentName.Items.push(te._p.ComboBoxItems_2("Employee wise Work Sheet","40087")),this.DPCDocumentName.SelectedValue="40090",this.SortBasedOn.Items.Clear(),this.SortBasedOn.Items.push(te._p.ComboBoxItems_2("None","1")),this.SortBasedOn.Items.push(te._p.ComboBoxItems_2("EmpCode","2")),this.SortBasedOn.Items.push(te._p.ComboBoxItems_2("EmpName","3")),this.SortBasedOn.Items.push(te._p.ComboBoxItems_2("TreeView","4")),this.SortBasedOn.Items.push(te._p.ComboBoxItems_2("EmpCode Numeric","5")),this.SortBasedOn.SelectedValue="1",this.dgCol=new B.O7,this.dgvROffTimings=new n.vv,this.dgvROffTimings.Columns=[],this.dgvROffTimings.Width="",this.dgvROffTimings.AllowReorderColumns=!1,this.dgvROffTimings.CanUserResizeColumns=!0,this.dgvROffTimings.CanUserSortColumns=!1,this.dgvROffTimings.CanUserDeleteRows=!0,this.dgvROffTimings.CanUserAddRows=!0,this.dgCol=new B.O7,this.dgCol.Header="Start Time",this.dgCol.DisplayMember="StartTime",this.dgCol.ValueMember="StartTime_Key",this.dgCol.DataType="Time2",this.dgCol.ReadOnly=!1,this.dgCol.Width=95,this.dgvROffTimings.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="End Time",this.dgCol.DisplayMember="EndTime",this.dgCol.ValueMember="EndTime_Key",this.dgCol.DataType="Time2",this.dgCol.ReadOnly=!1,this.dgCol.Width=95,this.dgvROffTimings.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="ROff Time",this.dgCol.DisplayMember="ROffTime",this.dgCol.ValueMember="ROffTime_Key",this.dgCol.DataType="Time2",this.dgCol.ReadOnly=!1,this.dgCol.Width=95,this.dgvROffTimings.Columns.push(this.dgCol),this.dgvROffTimings.Table=[],this.dgvROffTimings.TableColumns.push("StartTime"),this.dgvROffTimings.TableColumns.push("StartTime_Key"),this.dgvROffTimings.TableColumns.push("EndTime"),this.dgvROffTimings.TableColumns.push("EndTime_Key"),this.dgvROffTimings.TableColumns.push("ROffTime"),this.dgvROffTimings.TableColumns.push("ROffTime_Key"),this.dgvDocColumns=new n.vv,this.dgvDocColumns.Columns=[],this.dgvDocColumns.Width="",this.dgvDocColumns.AllowReorderColumns=!1,this.dgvDocColumns.CanUserResizeColumns=!0,this.dgvDocColumns.CanUserSortColumns=!1,this.dgvDocColumns.CanUserDeleteRows=!0,this.dgvDocColumns.CanUserAddRows=!1,this.dgCol=new B.O7,this.dgCol.Header="Source",this.dgCol.DisplayMember="Source",this.dgCol.ValueMember="Source_Key",this.dgCol.DataType="TextBlock",this.dgCol.ReadOnly=!0,this.dgCol.Width=150,this.dgvDocColumns.Columns.push(this.dgCol);let t=[],l=r.d.empService.GetQueryData(0,"BIO001","","","");l&&l.Tables.length>0&&(t=l.Tables[0]),this.dgCol=new B.O7,this.dgCol.Header="Destination",null!=t&&t.length>0&&(this.dgCol.ValueBinding="Destination",this.dgCol.DisplayMember="USERCOLUMNNAME",this.dgCol.ValueMember="SYSCOLUMNNAME",this.dgCol.DataType="ComboBox",this.dgCol.ReadOnly=!1,this.dgCol.Width=150,this.dvcol=t,this.dgCol.ComboData=this.dvcol,this.dgvDocColumns.Columns.push(this.dgCol)),this.dgvDocColumns.Table=[],this.dgvDocColumns.TableColumns.push("Source"),this.dgvDocColumns.TableColumns.push("Source_Key"),this.dgvDocColumns.TableColumns.push("Destination"),this.dgvDocColumns.TableColumns.push("Destination_Key")}LoadGrid(){this.dgv=new n.vv,this.dgv.Columns=[],this.dgv.Width="",this.dgv.HeaderHeight=40,this.dgv.AllowReorderColumns=!1,this.dgv.CanUserResizeColumns=!0,this.dgv.CanUserSortColumns=!1,this.dgv.CanUserDeleteRows=!0,this.dgv.IsReadOnly=!0,this.dgCol=new B.O7,this.dgCol.Header="#",this.dgCol.DisplayMember="SlNo",this.dgCol.ID="SlNo",this.dgCol.Width=45,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="Employee Code",this.dgCol.DisplayMember="EmpCode",this.dgCol.ID="EmpCode",this.dgCol.Width=120,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="Employee Name",this.dgCol.DisplayMember="EmpName",this.dgCol.ID="EmpName",this.dgCol.Width=250,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="Punch Date",this.dgCol.DisplayMember="PunchDate",this.dgCol.ID="PunchDate",this.dgCol.Width=90,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="Shift Code",this.dgCol.DisplayMember="ShiftCode",this.dgCol.ID="ShiftCode",this.dgCol.Width=100,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="Shift Name",this.dgCol.DisplayMember="ShiftName",this.dgCol.ID="ShiftName",this.dgCol.Width=100,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="Act.\nStart Time",this.dgCol.DisplayMember="ActStartTime",this.dgCol.ID="ActStartTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="Act.\nEnd Time",this.dgCol.DisplayMember="ActEndTime",this.dgCol.ID="ActEndTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="Act.\nTotal Hours",this.dgCol.DisplayMember="ActTotHrs",this.dgCol.ID="ActTotHrs",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.bUseROffTimings&&(this.dgCol=new B.O7,this.dgCol.Header="ROff\nStart Time",this.dgCol.DisplayMember="ROffStartTime",this.dgCol.ID="ROffStartTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="ROff\nEnd Time",this.dgCol.DisplayMember="ROffEndTime",this.dgCol.ID="ROffEndTime",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="ROff\nTotal Hours",this.dgCol.DisplayMember="ROffTotHrs",this.dgCol.ID="ROffTotHrs",this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol));for(let t=0;t<this.dgvDocColumns.Table.length;t++)null!=this.dgvDocColumns.Table[t].Destination&&""!=this.dgvDocColumns.Table[t].Destination.toString()&&"-1"!=this.dgvDocColumns.Table[t].Destination.toString()&&(this.dgCol=new B.O7,this.dgCol.Header=this.dgvDocColumns.Table[t].Source.toString(),this.dgCol.DisplayMember=this.dgvDocColumns.Table[t].Source.toString(),this.dgCol.ID=this.dgvDocColumns.Table[t].Source.toString(),this.dgCol.Width=80,this.dgCol.ReadOnly=!0,this.dgCol.TextAlign="Center",this.dgv.Columns.push(this.dgCol),this.bDocColumns=!0);this.dgCol=new B.O7,this.dgCol.Header="Remarks",this.dgCol.DisplayMember="Remarks",this.dgCol.ID="Remarks",this.dgCol.Width=250,this.dgCol.ReadOnly=!0,this.dgv.Columns.push(this.dgCol),this.dgv.Table=[],this.dgv.TableColumns.push("SlNo"),this.dgv.TableColumns.push("EmpCode"),this.dgv.TableColumns.push("EmpName"),this.dgv.TableColumns.push("PunchDate"),this.dgv.TableColumns.push("ShiftCode"),this.dgv.TableColumns.push("ShiftName"),this.dgv.TableColumns.push("ActStartTime"),this.dgv.TableColumns.push("ActEndTime"),this.dgv.TableColumns.push("ActTotHrs"),this.bUseROffTimings&&(this.dgv.TableColumns.push("ROffStartTime"),this.dgv.TableColumns.push("ROffEndTime"),this.dgv.TableColumns.push("ROffTotHrs"));for(let t=0;t<this.dgvDocColumns.Table.length;t++)null!=this.dgvDocColumns.Table[t].Destination&&null!=this.dgvDocColumns.Table[t].Destination&&""!=this.dgvDocColumns.Table[t].Destination.toString()&&"-1"!=this.dgvDocColumns.Table[t].Destination.toString()&&this.dgv.TableColumns.push(this.dgvDocColumns.Table[t].Source.toString());this.dgv.TableColumns.push("Remarks"),this.dgv.TableColumns.push("Row_Background"),this.dgvFailedRecord=new n.vv,this.dgvFailedRecord.Columns=[],this.dgvFailedRecord.Width="",this.dgvFailedRecord.HeaderHeight=30,this.dgvFailedRecord.CanUserResizeColumns=!0,this.dgvFailedRecord.IsReadOnly=!0,this.dgCol=new B.O7,this.dgCol.Header="Attendance Date",this.dgCol.DisplayMember="AttendanceDate",this.dgCol.ID="AttendanceDate",this.dgCol.Width=100,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="Code",this.dgCol.DisplayMember="Code",this.dgCol.ID="Code",this.dgCol.Width=150,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="Name",this.dgCol.DisplayMember="Name",this.dgCol.ID="Name",this.dgCol.Width=150,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgCol=new B.O7,this.dgCol.Header="Message",this.dgCol.DisplayMember="Message",this.dgCol.ID="Message",this.dgCol.Width=250,this.dgCol.ReadOnly=!0,this.dgvFailedRecord.Columns.push(this.dgCol),this.dgvFailedRecord.Table=[],this.dgvFailedRecord.TableColumns.push("AttendanceDate"),this.dgvFailedRecord.TableColumns.push("Code"),this.dgvFailedRecord.TableColumns.push("Name"),this.dgvFailedRecord.TableColumns.push("Message")}dgv_BeforeRowDeleting(t){return!1}LoadConfig(){var t=this;return(0,de.A)(function*(){t.dicConf.Clear();let l=r.d.empService.GetQueryData(0,"BIO002","","","");if(l&&l.Tables.length>0&&(t.dtConfig=l.Tables[0]),null!=t.dtConfig&&t.dtConfig.length>0){for(let a=0;a<t.dtConfig.length;a++)t.dicConf.push(h.J0.String(t.dtConfig[a].Name),h.J0.String(t.dtConfig[a].Value));if(t.drc=t.dtConfig.filter(a=>"BMCDeviceBrandName"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.BMCDeviceBrandName.SelectedValue=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"BMCDatabaseType"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.BMCDatabaseType.SelectedValue=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"BMCServerName"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.BMCServerName.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"BMCUserId"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.BMCUserId.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"BMCPassword"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&""!=t.drc[0].Value.toString()){let a=yield r.d.empService.DecryptString(t.drc[0].Value.toString());t.BMCPassword.Text=a.DecryptString}if(t.drc=t.dtConfig.filter(a=>"BMCDatabaseName"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.BMCDatabaseName.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"ETMEmpTableName"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.ETMEmpTableName.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"ETMEmpSeqNo"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.ETMEmpSeqNo.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"ETMEmpCode"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.ETMEmpCode.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"ETMEmpCodeInDevice"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.ETMEmpCodeInDevice.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"ETMEmpName"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.ETMEmpName.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"ETMEmpWhere"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.ETMEmpWhere.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"APTMAttendPunchTableName"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.APTMAttendPunchTableName.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"APTMEmpSeqNo"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.APTMEmpSeqNo.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"APTMEmpCode"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.APTMEmpCode.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"APTMEmpCodeInDevice"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.APTMEmpCodeInDevice.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"APTMPunchDateTime"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.APTMPunchDateTime.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"APTMDeviceNo"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.APTMDeviceNo.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"APTMDeviceNoValues"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.APTMDeviceNoValues.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"APTMDirection"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.APTMDirection.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"APTMDirectionInVal"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.APTMDirectionInVal.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"APTMDirectionOutVal"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.APTMDirectionOutVal.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"APTMAttendPunchWhere"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.APTMAttendPunchWhere.Text=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"DPCDocumentName"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.DPCDocumentName.SelectedValue=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"GetMultipleCheckINOUTInaDay"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.GetMultipleCheckINOUTInaDay.IsChecked=(0,q.yG0)(t.drc[0].Value),t.bGetMultipleCheckInOutInaDay=(0,q.yG0)(t.drc[0].Value)),t.drc=t.dtConfig.filter(a=>"OverrideAttendanceDoc"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.OverrideAttendanceDoc.IsChecked=(0,q.yG0)(t.drc[0].Value),t.bOverrideAttendanceDoc=(0,q.yG0)(t.drc[0].Value)),t.drc=t.dtConfig.filter(a=>"DonotPullBiometricDataifAttendanceisposted"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.DonotPullBiometricDataifAttendanceisposted.IsChecked=(0,q.yG0)(t.drc[0].Value),t.bDonotPullBiometricDataifAttendanceisposted=(0,q.yG0)(t.drc[0].Value)),t.drc=t.dtConfig.filter(a=>"AutoPostAtaTime"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.AutoPostAtaTime.IsChecked=(0,q.yG0)(t.drc[0].Value),t.bAutoPostAtaTime=(0,q.yG0)(t.drc[0].Value)),t.drc=t.dtConfig.filter(a=>"SortBasedOn"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.SortBasedOn.SelectedValue=t.drc[0].Value.toString()),t.drc=t.dtConfig.filter(a=>"ROTUseROffTimings"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.ROTUseROffTimings.IsChecked=(0,q.yG0)(t.drc[0].Value),t.bUseROffTimings=t.ROTUseROffTimings.IsChecked),t.dgvROffTimings.Clear(),t.drc=t.dtConfig.filter(a=>"ROffTimingsXML"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value){t.dsROffTimings=new h.VB,t.drc[0].Value.toString().Contains("\r\n")&&(t.drc[0].Value=t.drc[0].Value.toString().Replace("\r\n","")),t.dsROffTimings.ReadXml(t.drc[0].Value.toString());let a=new h.VB;a.LoadXml(t.drc[0].Value.toString());let i=a.SelectSingleNode("RoundOffTimings");if(null!=i){let o;if(i.childNodes.length>0)for(let d=0;d<i.childNodes.length;d++)o=t.dgvROffTimings.NewRow(),o.StartTime=i.childNodes[d].attributes.MinsFrom.value,o.StartTime_Key=i.childNodes[d].attributes.MinsFrom.value,o.EndTime=i.childNodes[d].attributes.MinsUpto.value,o.EndTime_Key=i.childNodes[d].attributes.MinsUpto.value,o.ROffTime=i.childNodes[d].attributes.ROffTime.value,o.ROffTime_Key=i.childNodes[d].attributes.ROffTime.value,t.dgvROffTimings.addRow(o)}}if(t.dgvDocColumns.Clear(),t.drc=t.dtConfig.filter(a=>"DocColumnsXML"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value){t.dsDocColumns=new h.VB,t.drc[0].Value.toString().Contains("\r\n")&&(t.drc[0].Value=t.drc[0].Value.toString().Replace("\r\n","")),t.dsDocColumns.ReadXml(t.drc[0].Value.toString());let a=new h.VB;a.LoadXml(t.drc[0].Value.toString());let i=a.SelectSingleNode("DocColumns");if(null!=i){let o;if(i.childNodes.length>0)for(let d=0;d<i.childNodes.length;d++)o=t.dgvDocColumns.NewRow(),o.Source=i.childNodes[d].attributes.Source.value,o.Source_Key=i.childNodes[d].attributes.Source.value,o.Destination=i.childNodes[d].attributes.Destination.value,o.Destination_Key=i.childNodes[d].attributes.Destination.value,t.dgvDocColumns.addRow(o)}}t.drc=t.dtConfig.filter(a=>"GDBQchkUseQuery"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.GDBQchkUseQuery.IsChecked=(0,q.yG0)(t.drc[0].Value)),t.drc=t.dtConfig.filter(a=>"GDBQtxtQuery"==a.Name),null!=t.drc&&t.drc.length>0&&null!=t.drc[0].Value&&(t.GDBQtxtQuery.Text=t.drc[0].Value.toString().Replace("[ENTER]","\r\n"))}})()}OnButtonClick(t){if(null!=t&&"BMCTestConn"!=t.toString()&&"SaveConfig"!=t.toString())if("GetData"==t.toString())this.GetData_Click();else if("PostData"==t.toString())this.PostData_Click();else if("Export"==t.toString())this.Export_Click();else if("ExportFailedRecords"==t.toString()){let l="";l+="<html><body style='color:blac;background-color:white;'>",l+="<style>",l+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",l+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:left;}",l+="</style>",l+="<table border=1 width='950' style='border-collapse:collaps;  font-family:arial; font-size:9pt;' >",l+="<tr><td class='hdr'><b>Sno<b></td>",l+="<td class='hdr' width='150'><b>Daily Attendance Date<b></td>",l+="<td class='hdr' width='150'><b>Code<b></td>",l+="<td class='hdr' width='150'><b>Name<b></td>",l+="<td class='hdr' width='750'><b>Message<b></td></tr>";let a=new h.VB;a.LoadXml(this.sbPostErrLog.toString());let i=a.SelectSingleNode("FailedRecord");if(null!=i&&i.childNodes.length>0)for(let o=0;o<i.childNodes.length;o++)l+="<tr",l+=">",l+="<td align='left' >"+o+"1</td>",l+="<td align='left' >"+i.childNodes[o].attributes.DADate!=null?i.childNodes[o].attributes.DADate.value:"</td>",l+="<td align='left' >"+i.childNodes[o].attributes.Code!=null?i.childNodes[o].attributes.Code.value:"</td>",l+="<td align='left' >"+i.childNodes[o].attributes.Name!=null?i.childNodes[o].attributes.Name.value:"</td>",l+="<td align='left' >"+i.childNodes[o].attributes.Error!=null?i.childNodes[o].attributes.Error.value:"</td>",l+="</tr>";l+="</table>",l+="</body>",l+="</html>"}}Filter_Click(){var t=this;return(0,de.A)(function*(){if(t.sSelectedEmpSeqNos=t.sSelectedEmpCodes="",null==t.objEmpFilter?t.objEmpFilter=new Ze.t("",0,11):(t.objEmpFilter.Filter=11,t.objEmpFilter.InitControls()),t.objEmpFilter.Filter>0&&(yield r.d.page.openDialog(t.objEmpFilter,St.m,{ShowCenter:!0})),t.objEmpFilter.IsCompleted)if(t.objEmpFilter.CostCenterFilters.length>0){let l=1,a="",i="",o="";t.objEmpFilter.CostCenterFilters.forEach(m=>{if(m.CostCenterID>5e4&&(l=2,a="NodeID",i=50051==m.CostCenterID?"EmpSeqNo":"CCNID"+(m.CostCenterID-5e4)),m.SelectedNodes.length>0){if(1==m.SelectedNodes.length)o+=" AND ",o+=i+"="+m.SelectedNodes[0].Id;else if(null==m.SelectedNodes.find(g=>g.Id==l&&g.IsGroup))if(o+=" AND ",It.IPrefetchFilter.IsGroupTree(m)){let g="";for(let y=0;y<m.SelectedNodes.length;y++)(null==m.SelectedNodes[y].Parent||!m.SelectedNodes[y].Parent.IsSelected)&&(g.length>0&&(g+=","),g+=m.SelectedNodes[y].Id);0==g.length&&(g+=-12912),o+=i+" IN ",o+=" (select T."+a+" GTID from ",o+=rt.A.GetTagTableName(m.CostCenterID)+" T with(nolock),",o+=rt.A.GetTagTableName(m.CostCenterID)+" GTP with(nolock) where T.lft BETWEEN GTP.lft AND GTP.rgt AND GTP."+a+" IN (",o+=g.toString()+")  group by T."+a+")"}else{o+=i+" IN (";for(let g=0;g<m.SelectedNodes.length;g++)g>0&&(o+=","),o+=m.SelectedNodes[g].Id;o+=")"}}else m.DeleteButtonVisibility||(o+=" AND ",o+=i+"=-12912")}),t.sFilter=o.toString(),r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(t.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),h.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(t.sFilter+="  AND EmpSeqNo IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")");let d=[];if(d.push(t.ToDate.Date.ToString("dd MMM yyyy")),d.push(t.sFilter),d.push(0),d.push(r.d.SessionManager.RoleID),d.push(r.d.SessionManager.UserID),d.push(r.d.SessionManager.LanguageID),t.dtFiltEmps=r.d.common.GetDataSet_SP(d,"spPAY_GetEmpMasterCCDetails").Tables[0],null!=t.dtFiltEmps&&t.dtFiltEmps.length>0)for(let m=0;m<t.dtFiltEmps.length;m++)t.sSelectedEmpSeqNos.length>0&&(t.sSelectedEmpSeqNos+=",",t.sSelectedEmpCodes+=","),t.sSelectedEmpSeqNos+=t.dtFiltEmps[m].EmpSeqNo.toString(),t.sSelectedEmpCodes+="'"+t.dtFiltEmps[m].EmpCode.toString()+"'"}else t.objEmpFilter.Filter>0&&t.FilterEmployees()})()}FilterEmployees(){try{Logger.InfoLog("BiometricConfigViewModel::Entering FilterEmployees()"),r.d.SessionManager.LocationID>0&&r.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&r.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+r.d.SessionManager.LocationID+")"),h.J0.IsEmpty(r.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+r.d.SessionManager.sWHEmpFilteredEmpSeqNos+")");let t=[];if(t.push(this.ToDate.Date.ToString("dd MMM yyyy")),t.push(this.sFilter),t.push(0),t.push(r.d.SessionManager.RoleID),t.push(r.d.SessionManager.UserID),t.push(r.d.SessionManager.LanguageID),this.dtFiltEmps=r.d.common.GetDataSet_SP(t,"spPAY_GetEmpMasterCCDetails").Tables[0],null!=this.dtFiltEmps&&this.dtFiltEmps.length>0)for(let l=0;l<this.dtFiltEmps.length;l++)this.sSelectedEmpSeqNos.length>0&&(this.sSelectedEmpSeqNos+=",",this.sSelectedEmpCodes+=","),this.sSelectedEmpSeqNos+=this.dtFiltEmps[l].EmpSeqNo.toString(),this.sSelectedEmpCodes+="'"+this.dtFiltEmps[l].EmpCode.toString()+"'";Logger.InfoLog("BiometricConfigViewModel::Exiting FilterEmployees()")}catch(t){Logger.ErrorLog("BiometricConfigViewModel::EXCEPTION FilterEmployees()\r\n"+t.Message+"\r\n"+t.stack)}}Export_Click(){}PostData_Click(){ct.RibbonExtViewModel.GetPay_BioPostData(this)}GetGroupByFilterEmployees(){let t="  AND EmpSeqNo IN ("+this.sEmpSeqNosOnGrid+")",l=[];return l.push(this.ToDate.Date.ToString("dd MMM yyyy")),l.push(t),l.push(0),l.push(r.d.SessionManager.RoleID),l.push(r.d.SessionManager.UserID),l.push(r.d.SessionManager.LanguageID),r.d.common.GetDataSet_SP(l,"spPAY_GetEmpMasterCCDetails").Tables[0]}CreateSQLTable(t,l){let a="",i="",o="";a=" CREATE TABLE "+t+"(";for(let d=0;d<l.Columns.length;d++){switch(o="",i=l.Columns[d].DataType.toString(),i){case"System.Int32":o=" int ";break;case"System.Int64":o=" bigint ";break;case"System.Int16":o=" smallint ";break;case"System.Byte":o=" tinyint ";break;case"System.Decimal":o=" float ";break;case"System.DateTime":o=" datetime ";break;case"System.String":o=h.J0.Format(" nvarchar({0}) ",-1==l.Columns[d].MaxLength?"max":l.Columns[d].MaxLength.toString())}""!=o?(a+="\n ["+l.Columns[d].ColumnName+"] ",a+=o,a+=","):(l.Columns.Remove(l.Columns[d].ColumnName),l.AcceptChanges(),d--)}return a.substr(0,a.length-1)+"\n)"}BulkInsertData(t,l){}GetShiftsAssignedData(){let l=r.d.empService.GetQueryData(0,"BIO003",r.d.SessionManager.Preferences.ShiftAssignBasedOn,this.FromDate.Date.ToString("dd MMM yyyy"),this.ToDate.Date.ToString("dd MMM yyyy"));l&&l.Tables.length>0&&(this.dtShiftsData=l.Tables[0])}GetBioMetricData(){this.dicConf.APTMAttendPunchTableName=this.dicConf.APTMAttendPunchTableName.Replace("@Month",this.FromDate.Date.iMonth().toString()).Replace("@Year",this.FromDate.Date.getFullYear().toString());let t="\n        Select EmpCode, EmpName, CONVERT(VARCHAR(11), PunchTime, 106) as PunchDate, PunchTime, CONVERT(VARCHAR(8), PunchTime, 108) as PTime ";this.bDocColumns&&this.dicConf.APTMDeviceNo.Trim().length>0&&(t+=",DeviceNo as DeviceNo "),this.dicConf.APTMDirection.Trim().length>0&&(t+=" ,Direction as Direction",this.bDirection=!0),t+=" FROM ( Select EMP."+this.dicConf.ETMEmpCode+" as EmpCode, EMP."+this.dicConf.ETMEmpName+" as EmpName, ",t+=" AP."+this.dicConf.APTMPunchDateTime+" as PunchTime ",this.bDocColumns&&this.dicConf.APTMDeviceNo.Trim().length>0&&(t+=" ,AP."+this.dicConf.APTMDeviceNo+" as DeviceNo "),this.dicConf.APTMDirection.Trim().length>0&&(t+=" ,AP."+this.dicConf.APTMDirection+" as Direction "),t+=" From "+this.dicConf.APTMAttendPunchTableName+" AP WITH(NOLOCK)",""!=this.dicConf.APTMEmpSeqNo?t+=" JOIN "+this.dicConf.ETMEmpTableName+" EMP WITH(NOLOCK) on EMP."+this.dicConf.ETMEmpSeqNo+"=AP."+this.dicConf.APTMEmpSeqNo+" ":""!=this.dicConf.APTMEmpCode?t+=" JOIN "+this.dicConf.ETMEmpTableName+" EMP WITH(NOLOCK) on EMP."+this.dicConf.ETMEmpCode+"=AP."+this.dicConf.APTMEmpCode:""!=this.dicConf.APTMEmpCodeInDevice&&(t+=" JOIN "+this.dicConf.ETMEmpTableName+" EMP WITH(NOLOCK) on EMP."+this.dicConf.ETMEmpCodeInDevice+"=AP."+this.dicConf.APTMEmpCodeInDevice),t+=" WHERE 1=1 ",this.sSelectedEmpCodes.Trim().length>0&&(t+=" AND EMP."+this.dicConf.ETMEmpCode+" IN ("+this.sSelectedEmpCodes+") "),this.dicConf.ETMEmpWhere.Trim().length>0&&(t+=" AND "+this.dicConf.ETMEmpWhere),this.dicConf.APTMAttendPunchWhere.Trim().length>0&&(t+=" AND "+this.dicConf.APTMAttendPunchWhere),this.dicConf.APTMDeviceNo.Trim().length>0&&this.dicConf.APTMDeviceNoValues.Trim().length>0&&(t+=" AND AP."+this.dicConf.APTMDeviceNo+" IN("+this.dicConf.APTMDeviceNoValues+")"),t+=" AND DATEDIFF(DAY,AP."+this.dicConf.APTMPunchDateTime+",'"+this.FromDate.Date.AddDays(-1).ToString("dd MMM yyyy")+"')<=0 AND DATEDIFF(DAY,AP."+this.dicConf.APTMPunchDateTime+",'"+this.ToDate.Date.AddDays(1).ToString("dd MMM yyyy")+"')>=0\n) as tbl\n        Order By PunchTime, EmpCode ";let l=[];l.push(this.BMCDatabaseType.SelectedValue),l.push(this.BMCServerName.Text.Trim()),l.push(this.BMCDatabaseName.Text.Trim()),l.push(this.BMCUserId.Text.Trim()),l.push(this.BMCPassword.Text);let a=r.d.empService.ReportDataSet("RPT022",!0,t,"","","","",l);this.dtBioMetData=a.Tables[0]}GetData_Click(){var t=this;return(0,de.A)(function*(){let l=0;if(t.sEmpSeqNosOnGrid="",t.ListVisbility=!1,yield t.LoadConfig(),t.IsAutoPost){let m=[];if(m.push(t.ToDate.Date.ToString("dd MMM yyyy")),m.push(t.sFilter),m.push(0),m.push(r.d.SessionManager.RoleID),m.push(r.d.SessionManager.UserID),m.push(r.d.SessionManager.LanguageID),t.dtFiltEmps=r.d.common.GetDataSet_SP(m,"spPAY_GetEmpMasterCCDetails").Tables[0],null!=t.dtFiltEmps&&t.dtFiltEmps.length>0)for(let C=0;C<t.dtFiltEmps.length;C++)t.sSelectedEmpSeqNos.length>0&&(t.sSelectedEmpSeqNos+=",",t.sSelectedEmpCodes+=","),t.sSelectedEmpSeqNos+=t.dtFiltEmps[C].EmpSeqNo.toString(),t.sSelectedEmpCodes+="'"+t.dtFiltEmps[C].EmpCode.toString()+"'"}else yield t.Filter_Click();if(t.FromDate.Date>t.ToDate.Date)return t.DisplayMessage="'From Date' should be less than or Equal to 'To Date'",void(t.MessageVisibility=!0);if(0==t.sSelectedEmpCodes.length)return t.DisplayMessage="No Employees found",void(t.MessageVisibility=!0);t.DispMessage="Loading data, Please wait....",t.MsgVisibility=!0;let a="";for(let m=0;m<t.dgvDocColumns.Table.length;m++)null!=t.dgvDocColumns.Table[m].Destination&&null!=t.dgvDocColumns.Table[m].Destination&&""!=t.dgvDocColumns.Table[m].Destination.toString()&&"-1"!=t.dgvDocColumns.Table[m].Destination.toString()&&t.dgvDocColumns.Table[m].Destination.toString().startsWith("dcCCNID")&&(a.length>0&&(a+=","),a+=(5e4+parseInt(t.dgvDocColumns.Table[m].Destination.toString().Replace("dcCCNID",""))).toString());a.length>0&&(t.dsbDims=r.d.empService.GetQueryData(0,"BIO007",JSON.stringify(a),"",""));let i="";if(t.dsbEmps=r.d.empService.GetQueryData(0,"BIO004","","",""),t.dgv.Clear(),t.GDBQchkUseQuery.IsChecked&&t.GDBQtxtQuery.Text.Trim().length>0){let m=[],C="";if("1"==t.BMCDatabaseType.SelectedValue){C=t.GDBQtxtQuery.Text.Replace("@FROMDATE@","'"+t.FromDate.Date.ToString("dd-MMM-yyyy")+"'").Replace("@TODATE@","'"+t.ToDate.Date.ToString("dd-MMM-yyyy")+"'").Replace("@EMPCODES@",t.sSelectedEmpCodes).Replace("@Month",t.FromDate.Date.iMonth().toString()).Replace("@Year",t.FromDate.Date.getFullYear().toString());try{m=r.d.empService.GetData_ClickData(t.Title,t.sFilter,t.FromDate.Date.ToString("dd MMM yyyy"),t.ToDate.Date.ToString("dd MMM yyyy"),t.sSelectedEmpCodes)}catch(g){return t.MsgVisibility=!1,t.DisplayMessage=g.Message,void(t.MessageVisibility=!0)}}else if("2"==t.BMCDatabaseType.SelectedValue){C=t.GDBQtxtQuery.Text.Replace("@FROMDATE@","#"+t.FromDate.Date.ToString("dd-MMM-yyyy")+"#").Replace("@TODATE@","#"+t.ToDate.Date.ToString("dd-MMM-yyyy")+"#").Replace("@EMPCODES@",t.sSelectedEmpCodes).Replace("@Month",t.FromDate.Date.iMonth().toString()).Replace("@Year",t.FromDate.Date.getFullYear().toString());try{m=r.d.empService.GetData_ClickData(t.Title,t.sFilter,t.FromDate.Date.ToString("dd MMM yyyy"),t.ToDate.Date.ToString("dd MMM yyyy"),t.sSelectedEmpCodes)}catch(g){return t.MsgVisibility=!1,t.DisplayMessage=g.Message,void(t.MessageVisibility=!0)}}if(null!=m&&m.Tables.length>0&&m.Tables[0].length>0){let g,y;l=0;for(let p=0;p<m.Tables[0].length;p++)y=t.dsbEmps.Tables[0].filter(e=>e.Code==m.Tables[0][p].EmpCode.toString()),null!=y&&y.length>0&&(t.sEmpSeqNosOnGrid.length>0&&(t.sEmpSeqNosOnGrid+=","),t.sEmpSeqNosOnGrid+=y[0].NodeID.toString(),l++,g=t.dgv.NewRow(),g.SlNo=l.toString(),g.EmpCode=m.Tables[0][p].EmpCode,g.EmpName=m.Tables[0][p].EmpName,g.PunchDate=new Date(m.Tables[0][p].PunchDate).ToString("dd/MMM/yyyy"),g.ShiftCode=m.Tables[0][p].ShiftCode,g.ShiftName=m.Tables[0][p].ShiftName,m.Tables[0][p].StartTime.toString().Contains(".")||(m.Tables[0][p].StartTime=m.Tables[0][p].StartTime.toString().Contains(":")?m.Tables[0][p].StartTime.toString().Replace(":","."):m.Tables[0][p].StartTime.toString()+".0"),g.ActStartTime=new Date(m.Tables[0][p].StartTime.toString().Replace(".",":")).ToString("HH:mm"),m.Tables[0][p].EndTime.toString().Contains(".")||(m.Tables[0][p].EndTime=m.Tables[0][p].EndTime.toString().Contains(":")?m.Tables[0][p].EndTime.toString().Replace(":","."):m.Tables[0][p].EndTime.toString()+".0"),g.ActEndTime=new Date(m.Tables[0][p].EndTime.toString().Replace(".",":")).ToString("HH:mm"),g.ActTotHrs=parseFloat(m.Tables[0][p].TotHrs).ToString("00.00"),0==parseFloat(g.ActTotHrs)&&(g.Row_Background="#F77B7E"),t.bDocColumns&&(t.dgv.TableColumns.Contains("IN Device No")&&(g["IN Device No"]=m.Tables[0][p].INDeviceNo),t.dgv.TableColumns.Contains("OUT Device No")&&(g["OUT Device No"]=m.Tables[0][p].OUTDeviceNo)),g.Remarks="",t.dgv.addRow(g));t.MsgVisibility=!1}else t.MsgVisibility=!1,t.DisplayMessage="No data found.",t.MessageVisibility=!0;return}if("2"==t.BMCDatabaseType.SelectedValue){t.dicConf.ETMEmpTableName=t.ETMEmpTableName.Text.Trim(),t.dicConf.APTMAttendPunchTableName=t.APTMAttendPunchTableName.Text.Trim();let g="";g=" SELECT * FROM "+t.dicConf.ETMEmpTableName,t.dicConf.APTMAttendPunchTableName=t.dicConf.APTMAttendPunchTableName.Replace("@Month",t.FromDate.Date.iMonth().toString()).Replace("@Year",t.FromDate.Date.getFullYear().toString()),g=" SELECT * FROM "+t.dicConf.APTMAttendPunchTableName+" WHERE DateValue("+t.dicConf.APTMPunchDateTime+") BETWEEN #"+t.FromDate.Date.AddDays(-1).ToString("dd/MMM/yyyy")+"# AND #"+t.ToDate.Date.AddDays(1).ToString("dd/MMM/yyyy")+"#"}"3"==t.BMCDatabaseType.SelectedValue&&(t.dicConf.ETMEmpTableName=t.ETMEmpTableName.Text.Trim(),t.dicConf.APTMAttendPunchTableName=t.APTMAttendPunchTableName.Text.Trim());let o=[],d=!1;if(""!=t.dicConf.ETMEmpTableName.Trim()&&""!=t.dicConf.APTMAttendPunchTableName.Trim()){if(null!=t.dtFiltEmps&&t.dtFiltEmps.length>0){if(t.GetShiftsAssignedData(),null==t.dtShiftsData||0==t.dtShiftsData.length)return t.MsgVisibility=!1,t.DisplayMessage="Enter atlest one Shift Assign document for Default Employee",void(t.MessageVisibility=!0);let C=r.d.SessionManager.Preferences.ShiftAssignBasedOn;t.GetBioMetricData();let g=[];g.push("EmpSeqNo"),g.push("EmpCode"),g.push("EmpName"),g.push("PunchDate"),g.push("StartTime"),g.push("EndTime"),g.push("TotHrs"),t.bDocColumns&&(t.dgv.TableColumns.Contains("IN Device No")&&g.push("IN Device No"),t.dgv.TableColumns.Contains("OUT Device No")&&g.push("OUT Device No")),g.push("Remarks"),g.push("lfts"),g.push("EmpCodeNumeric");let e,u,T,A,k,x,F,y=t.FromDate.Date.OnlyDate(),p=t.ToDate.Date.OnlyDate(),_=null,f="",E="",N=!1,ae=0,z=0;l=0;let W=t.dtBioMetData.ToTable(!0,["EmpCode","EmpName"]);if(null!=W&&W.length>0){let V=null,he="";for(let Ge=0;Ge<W.length;Ge++)T=t.dtFiltEmps.filter(O=>O.EmpCode==W[Ge].EmpCode.toString()),null!=T&&T.length>0&&(he.length>0&&(he+=","),he+=T[0].EmpSeqNo.toString());if("-2"!=C){let Ge=[];Ge.push(p.ToString("dd MMM yyyy")),Ge.push(" AND EmpSeqNo IN("+he+")"),Ge.push(0),Ge.push(r.d.SessionManager.RoleID),Ge.push(r.d.SessionManager.UserID),Ge.push(r.d.SessionManager.LanguageID),V=r.d.common.GetDataSet_SP(Ge,"spPAY_GetEmpMasterCCDetails").Tables[0]}t.bDonotPullBiometricDataifAttendanceisposted&&(i="",40067==parseInt(t.DPCDocumentName.SelectedValue)||40087==parseInt(t.DPCDocumentName.SelectedValue)?i="SELECT C.dcCCNID51 EmpSeqNo,CONVERT(DATETIME,T.DCALPHA1) DADate,I.VoucherNo FROM INV_DOCDETAILS I WITH(NOLOCK)\n                            JOIN COM_DOCCCDATA C WITH(NOLOCK) ON C.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCTEXTDATA T WITH(NOLOCK) ON T.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCNUMDATA N WITH(NOLOCK) ON N.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            WHERE T.tDocumentType = 67 AND StatusID NOT IN(372, 376) AND C.dcCCNID51 in ("+he+")\n                            AND ISDATE(T.DCALPHA1) = 1 AND CONVERT(DATETIME, T.DCALPHA1) BETWEEN CONVERT(DATETIME, '"+t.FromDate.Date.ToString("dd/MMM/yyyy")+"') AND CONVERT(DATETIME, '"+t.ToDate.Date.ToString("dd/MMM/yyyy")+"') ":(40089==parseInt(t.DPCDocumentName.SelectedValue)||40090==parseInt(t.DPCDocumentName.SelectedValue))&&(i="SELECT C.dcCCNID51 EmpSeqNo,CONVERT(DATETIME,T.DCALPHA1) DADate,I.VoucherNo FROM INV_DOCDETAILS I WITH(NOLOCK)\n                            JOIN COM_DOCCCDATA C WITH(NOLOCK) ON C.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCTEXTDATA T WITH(NOLOCK) ON T.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            JOIN COM_DOCNUMDATA N WITH(NOLOCK) ON N.INVDOCDETAILSID = I.INVDOCDETAILSID\n                            WHERE T.tCostCenterID = "+parseInt(t.DPCDocumentName.SelectedValue)+" AND StatusID NOT IN(372, 376) AND C.dcCCNID51 in ("+he+")\n                            AND ISDATE(T.DCALPHA1) = 1 AND CONVERT(DATETIME, T.DCALPHA1) BETWEEN CONVERT(DATETIME, '"+t.FromDate.Date.ToString("dd/MMM/yyyy")+"') AND CONVERT(DATETIME, '"+t.ToDate.Date.ToString("dd/MMM/yyyy")+"') "),i.Trim().length>0&&(_=r.d.empService.GetQueryData(parseInt(t.DPCDocumentName.SelectedValue),"BIO008",JSON.stringify(he),t.FromDate.Date.ToString("dd/MMM/yyyy"),t.ToDate.Date.ToString("dd/MMM/yyyy"))));let ye=null,Pe=null;for(;y<=p;){for(let Ge=0;Ge<W.length;Ge++){if(d=!1,T=t.dtFiltEmps.filter(Ne=>Ne.EmpCode==W[Ge].EmpCode.toString()),null!=T&&T.length>0){if(y<h.J0.ParseDate(T[0].DOJ))continue;E=T[0].EmpSeqNo.toString(),ae=parseInt(T[0].lft)}if(t.bDonotPullBiometricDataifAttendanceisposted&&null!=_&&_.length>0&&(k=_.filter(Ne=>Ne.EmpSeqNo==E&&Ne.DADate==y.ToString("dd/MMM/yyyy")),null!=k&&k.length>0))continue;l++,e={},e.SNo=l.toString(),e.EmpSeqNo=E,e.lfts=ae,null!=t.SortBasedOn.SelectedValue&&"5"==t.SortBasedOn.SelectedValue&&(z=0,z=h.J0.Int(W[Ge].EmpCode),e.EmpCodeNumeric=z>0?z:0),e.EmpCode=W[Ge].EmpCode,e.EmpName=W[Ge].EmpName,e.PunchDate=y.ToString("dd/MMM/yyyy"),N=!1;let O="",Je=t.dtShiftsData;if("-2"==C)O="EmpSeqNo IN(1,"+E+") ",Je=Je.filter(Ne=>1==Ne.EmpSeqNo||Ne.EmpSeqNo==E);else{let Ne="",ue=C.split(",");if(null!=ue&&ue.length>0){let ke=V.filter(me=>me.EmpSeqNo==E);for(let me=0;me<ue.length;me++)null!=ue[me]&&""!=ue[me]&&(Ne="-2"==ue[me]?"EmpSeqNo":"dcCCNID"+(parseInt(ue[me])-5e4),O.length>0&&(O+=" AND "),O+=Ne+"="+ke[0][Ne.Replace("dcCCNID","CCNID")],Je=Je.filter(Ue=>Ue[Ne]==ke[0][Ne.Replace("dcCCNID","CCNID")]))}}if(f=O+" AND AssigningFrom <='"+y.ToString("dd/MMM/yyyy")+"' AND AssigningUpto >='"+y.ToString("dd/MMM/yyyy")+"'",Je=Je.filter(Ne=>null!=Ne.AssigningFrom&&new Date(Ne.AssigningFrom).ToString("dd/MMM/yyyy")<=y.ToString("dd/MMM/yyyy")&&null!=Ne.AssigningUpto&&new Date(Ne.AssigningUpto).ToString("dd/MMM/yyyy")>=y.ToString("dd/MMM/yyyy")),T=Je,T.sort((Ne,ue)=>Ne.DocID>ue.DocID||Ne.DocID==ue.DocID&&Ne.EmpSeqNo>ue.EmpSeqNo?1:-1),null!=T&&T.length>0){let Ne=(new Date).OnlyDate();if(x=h.J0.ParseDate(Ne.ToString("dd/MMM/yyyy")+" "+T[0].ShiftBMStartTime),F=h.J0.ParseDate(Ne.ToString("dd/MMM/yyyy")+" "+T[0].ShiftBMEndTime),x>F?(x=y.AddHours(x.getHours()).AddMinutes(x.getMinutes()).AddSeconds(x.getSeconds()),F=y.AddDays(1).AddHours(F.getHours()).AddMinutes(F.getMinutes()).AddSeconds(F.getSeconds())):(x=y.AddHours(x.getHours()).AddMinutes(x.getMinutes()).AddSeconds(x.getSeconds()),F=y.AddHours(F.getHours()).AddMinutes(F.getMinutes()).AddSeconds(F.getSeconds())),f="EmpCode='"+e.EmpCode.toString()+"' AND PunchTime>='"+x.toString()+"' AND PunchTime<='"+F.toString()+"'",A=t.dtBioMetData.filter(ue=>ue.EmpCode==e.EmpCode.toString()&&new Date(ue.PunchTime)>=x&&new Date(ue.PunchTime)<=F),A.sort((ue,ke)=>ue.PunchTime-ke.PunchTime),!(null!=A&&A.length>0))continue;if(1==A.length)e.StartTime=new Date(A[0].PunchTime).ToString("HH:mm:00"),e.EndTime=new Date(A[0].PunchTime).ToString("HH:mm:00"),F=x,t.bDirection&&(e.Remarks=t.APTMDirectionInVal.Text==A[0].Direction.toString()?"Check-Out Missing":"Check-In Missing"),g.Contains("IN Device No")&&(e["IN Device No"]=A[0].DeviceNo.toString()),g.Contains("OUT Device No")&&(e["OUT Device No"]=A[0].DeviceNo.toString());else if(t.bDirection){let ue=!1,ke=!1;if(t.bGetMultipleCheckInOutInaDay){for(let me=0;me<A.length;me++){ue=!1,ke=!1,u={};for(let Ue=0;Ue<e.ItemArray.length;Ue++)u[Ue]=e[Ue];t.APTMDirectionInVal.Text==A[me].Direction.toString()&&(u.StartTime=new Date(A[me].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(u["IN Device No"]=A[me].DeviceNo.toString()),ue=!0),t.APTMDirectionOutVal.Text==A[me].Direction.toString()&&(u.EndTime=new Date(A[me].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(u["OUT Device No"]=A[me].DeviceNo.toString()),ke=!0),(ue||ke)&&(A.length>me+1?(ue&&(t.APTMDirectionOutVal.Text==A[me+1].Direction.toString()?(u.EndTime=new Date(A[me+1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(u["OUT Device No"]=A[me+1].DeviceNo.toString()),me++):(u.EndTime=new Date(A[me].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(u["OUT Device No"]=A[me].DeviceNo.toString()),u.Remarks="Check-Out Missing",F=x)),ke&&(u.StartTime=new Date(A[me].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(u["IN Device No"]=A[me].DeviceNo.toString()),u.Remarks="Check-In Missing",F=x)):(ue&&(u.EndTime=new Date(A[me].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(u["OUT Device No"]=A[me].DeviceNo.toString()),u.Remarks="Check-Out Missing",F=x),ke&&(u.StartTime=new Date(A[me].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(u["IN Device No"]=A[me].DeviceNo.toString()),u.Remarks="Check-In Missing",F=x)),x=new Date(x.ToString("dd/MMM/yyyy")+" "+u.StartTime.toString()),F=new Date(x.ToString("dd/MMM/yyyy")+" "+u.EndTime.toString())<new Date(x.ToString("dd/MMM/yyyy")+" "+u.StartTime.toString())?new Date(F.ToString("dd/MMM/yyyy")+" "+u.EndTime.toString()):new Date(x.ToString("dd/MMM/yyyy")+" "+u.EndTime.toString()),u.TotHrs=ct.RibbonExtViewModel.CalculateTotalTime(x,x,F,F),o.push(u))}N=!0}else{if(f="EmpCode='"+e.EmpCode.toString()+"' AND PunchTime>='"+x.toString()+"' AND PunchTime<='"+F.toString()+"' AND Direction='"+t.APTMDirectionInVal.Text+"'",ye=t.dtBioMetData.filter(me=>me.EmpCode==e.EmpCode.toString()&&new Date(me.PunchTime)>=x&&new Date(me.PunchTime)<=F&&me.Direction==t.APTMDirectionInVal.Text),ye.sort((me,Ue)=>me.PunchTime-Ue.PunchTime),null!=ye&&ye.length>0&&(ue=!0,e.StartTime=new Date(ye[0].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(e["IN Device No"]=ye[0].DeviceNo.toString())),f="EmpCode='"+e.EmpCode.toString()+"' AND PunchTime>='"+x.toString()+"' AND PunchTime<='"+F.toString()+"' AND Direction='"+t.APTMDirectionOutVal.Text+"'",Pe=t.dtBioMetData.filter(me=>me.EmpCode==e.EmpCode.toString()&&new Date(me.PunchTime)>=x&&new Date(me.PunchTime)<=F&&me.Direction==t.APTMDirectionInVal.Text),Pe.sort((me,Ue)=>me.PunchTime-Ue.PunchTime),null!=Pe&&Pe.length>0&&(ue?new Date(Pe[Pe.length-1].PunchTime)>new Date(ye[0].PunchTime)&&(ke=!0,e.EndTime=new Date(Pe[Pe.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(e["OUT Device No"]=Pe[Pe.length-1].DeviceNo.toString())):(ke=!0,e.EndTime=new Date(Pe[Pe.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(e["OUT Device No"]=Pe[Pe.length-1].DeviceNo.toString()))),!ue&&!ke)continue;(!ue||!ke)&&(F=x,ue?(e.EndTime=new Date(ye[0].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(e["OUT Device No"]=ye[0].DeviceNo.toString()),e.Remarks="Check-Out Missing"):(e.StartTime=new Date(Pe[Pe.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(e["IN Device No"]=Pe[Pe.length-1].DeviceNo.toString()),e.Remarks="Check-In Missing"))}}else if(t.bGetMultipleCheckInOutInaDay&&A.length>2){for(let ue=0;ue<A.length;ue+=2){u={};for(let ke=0;ke<e.ItemArray.length;ke++)u[ke]=e[ke];u.StartTime=new Date(A[ue].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(u["IN Device No"]=A[ue].DeviceNo.toString()),ue==A.length-1?(u.EndTime=new Date(A[ue].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(u["OUT Device No"]=A[ue].DeviceNo.toString())):(u.EndTime=new Date(A[ue+1].PunchTime).ToString("HH:mm:00"),g.Contains("OUT Device No")&&(u["OUT Device No"]=A[ue+1].DeviceNo.toString())),x=new Date(x.ToString("dd/MMM/yyyy")+" "+u.StartTime.toString()),F=new Date(x.ToString("dd/MMM/yyyy")+" "+u.EndTime.toString())<new Date(x.ToString("dd/MMM/yyyy")+" "+u.StartTime.toString())?new Date(F.ToString("dd/MMM/yyyy")+" "+u.EndTime.toString()):new Date(x.ToString("dd/MMM/yyyy")+" "+u.EndTime.toString()),u.TotHrs=ct.RibbonExtViewModel.CalculateTotalTime(x,x,F,F),o.push(u)}N=!0}else e.StartTime=new Date(A[0].PunchTime).ToString("HH:mm:00"),e.EndTime=new Date(A[A.length-1].PunchTime).ToString("HH:mm:00"),g.Contains("IN Device No")&&(e["IN Device No"]=A[0].DeviceNo.toString()),g.Contains("OUT Device No")&&(e["OUT Device No"]=A[A.length-1].DeviceNo.toString());N||(x=new Date(x.ToString("dd/MMM/yyyy")+" "+e.StartTime.toString()),F=new Date(x.ToString("dd/MMM/yyyy")+" "+e.EndTime.toString())<new Date(x.ToString("dd/MMM/yyyy")+" "+e.StartTime.toString())?new Date(F.ToString("dd/MMM/yyyy")+" "+e.EndTime.toString()):new Date(x.ToString("dd/MMM/yyyy")+" "+e.EndTime.toString()),e.TotHrs=ct.RibbonExtViewModel.CalculateTotalTime(x,x,F,F))}else{if(!t.IsAutoPost)return t.MsgVisibility=!1,t.DisplayMessage="Assign Shift for the Employee Code : "+W[Ge].EmpCode,void(t.MessageVisibility=!0);t.MsgVisibility=!1,t.DisplayMessage="Assign Shift for the Employee Code : "+W[Ge].EmpCode,t.MessageVisibility=!0,d=!0}d||N||o.push(e)}y=y.AddDays(1)}}}if(l=0,o.length>0){let C,g,y="";null!=t.SortBasedOn.SelectedValue&&"1"!=t.SortBasedOn.SelectedValue&&("2"==t.SortBasedOn.SelectedValue?y="EmpCode":"3"==t.SortBasedOn.SelectedValue?y="EmpName":"4"==t.SortBasedOn.SelectedValue?y="lfts":"5"==t.SortBasedOn.SelectedValue&&(y="EmpCodeNumeric"));for(let p=0;p<o.length;p++){if(g=t.dsbEmps.Tables[0].filter(u=>u.Code==o[p].EmpCode.toString()),!(null!=g&&g.length>0))continue;t.sEmpSeqNosOnGrid.length>0&&(t.sEmpSeqNosOnGrid+=","),t.sEmpSeqNosOnGrid+=g[0].NodeID.toString(),l++;let e=(new Date).OnlyDate();if(C=t.dgv.NewRow(),C.SlNo=l.toString(),C.EmpCode=o[p].EmpCode,C.EmpName=o[p].EmpName,C.PunchDate=new Date(o[p].PunchDate).ToString("dd/MMM/yyyy"),C.ActStartTime=h.J0.ParseDate(e.ToString("dd/MMM/yyyy")+" "+o[p].StartTime).ToString("HH:mm"),C.ActEndTime=h.J0.ParseDate(e.ToString("dd/MMM/yyyy")+" "+o[p].EndTime).ToString("HH:mm"),C.ActTotHrs=o[p].TotHrs,t.bUseROffTimings){let u,T,A,x,k=0;if(u=h.J0.ParseDate(e.ToString("dd/MMM/yyyy")+" "+C.ActStartTime),T=h.J0.ParseDate(e.ToString("dd/MMM/yyyy")+" "+C.ActEndTime),null!=t.dsROffTimings.Tables.ROffRow&&(x=t.dsROffTimings.Tables.ROffRow.filter(F=>F.MinsFrom<=u.ToString("HH:mm")&&u.ToString("HH:mm")<=F.MinsUpto),null!=x&&x.length>0&&(u=new Date(u.getFullYear(),u.iMonth(),u.getDate(),parseInt(x[0].ROffTime.toString().split(":")[0]),parseInt(x[0].ROffTime.toString().split(":")[1]),0)),x=t.dsROffTimings.Tables.ROffRow.filter(F=>F.MinsFrom<=T.ToString("HH:mm")&&T.ToString("HH:mm")<=F.MinsUpto),null!=x&&x.length>0&&(T=new Date(T.getFullYear(),T.iMonth(),T.getDate(),parseInt(x[0].ROffTime.toString().split(":")[0]),parseInt(x[0].ROffTime.toString().split(":")[1]),0))),C.ROffStartTime=u.ToString("HH:mm"),C.ROffEndTime=T.ToString("HH:mm"),k=0,A=T.Subtract(u),u>T){C.ROffTotHrs="00.00",C.Row_Background="#F77B7E";continue}A=T.Subtract(u),k=parseFloat(A.Hours.ToString("00")+"."+A.Minutes.ToString("00")),C.ROffTotHrs=k.ToString("00.00")}t.bDocColumns&&(t.dgv.TableColumns.Contains("IN Device No")&&(C["IN Device No"]=o[p]["IN Device No"].toString()),t.dgv.TableColumns.Contains("OUT Device No")&&(C["OUT Device No"]=o[p]["OUT Device No"].toString())),0==parseFloat(C.ActTotHrs)&&(C.Row_Background="#F77B7E"),C.Remarks=h.J0.String(o[p].Remarks),t.dgv.addRow(C)}t.MsgVisibility=!1}else t.MsgVisibility=!1,t.DisplayMessage="No data found.",t.MessageVisibility=!0}})()}GetBMConnString(){return"1"==this.BMCDatabaseType.SelectedValue?"Data Source="+this.BMCServerName.Text.Trim()+";Initial Catalog="+this.BMCDatabaseName.Text.Trim()+";Persist Security Info=True;User ID="+this.BMCUserId.Text.Trim()+";Password="+this.BMCPassword.Text:""}}var tt=G(91435);function Xe(L,t){if(1&L&&(s.j41(0,"div",20),s.EFF(1,"\n                            "),s.j41(2,"app-PactGridView",21),s.EFF(3,"\n                            "),s.k0s(),s.EFF(4,"\n                        "),s.k0s()),2&L){const l=s.XpG();s.R7$(2),s.Y8G("obj",l.obj.dgv)("group",l.form)}}function U(L,t){if(1&L&&(s.qex(0),s.EFF(1,"\n                                "),s.j41(2,"app-PactGridView",21),s.EFF(3,"\n                                "),s.k0s(),s.EFF(4,"\n                            "),s.bVm()),2&L){const l=s.XpG();s.R7$(2),s.Y8G("obj",l.obj.dgvFailedRecord)("group",l.form)}}let re=(()=>{class L{constructor(){this.form=new v.gE({})}ngOnInit(){this.params?.obj&&(this.obj=this.params.obj)}static{this.\u0275fac=function(a){return new(a||L)}}static{this.\u0275cmp=s.VBU({type:L,selectors:[["app-biometric-config-view-model"]],standalone:!1,decls:64,vars:17,consts:[["id","maincontainer",1,"maincontainer","master_container"],[1,"page-header"],[1,"page-title_div"],[1,"page-title"],[1,"btnMetroDiv","secondary-btn-group"],[1,"secondary-btn",3,"click"],[1,"fa-light","fa-user"],[1,"fa-light","fa-floppy-disk-circle-arrow-right"],[1,"fa-light","fa-file-export"],[1,"document-screen","main_div"],[1,"PACTTabFields","pagesection-noborder","tab_content","tab-exrafields","custom_accordion",2,"height","100%"],[1,"master-tab-container",2,"width","100%","height","98%"],["heading","Data",3,"removable"],[1,"row","form-row",2,"width","100%","margin-left","10px"],[1,"form-group","col-xl-4","col-md-4","col-sm-12","col-xs-12","PACTControl"],["FieldDirective","",3,"obj","group"],[1,"documentgrid","row","form-row",2,"width","100%"],["class","form-group col-9 section documentgrid",4,"ngIf"],[1,"form-group","col-3",2,"overflow","scroll"],[4,"ngIf"],[1,"form-group","col-9","section","documentgrid"],[2,"width","100%",3,"obj","group"]],template:function(a,i){1&a&&(s.j41(0,"div",0),s.EFF(1,"\n    "),s.j41(2,"div",1),s.EFF(3,"\n        "),s.j41(4,"div",2),s.EFF(5,"\n            "),s.j41(6,"span",3),s.EFF(7),s.k0s(),s.EFF(8,"\n\n        "),s.k0s(),s.EFF(9,"\n        "),s.j41(10,"div",4),s.EFF(11,"\n            "),s.j41(12,"span",5),s.bIt("click",function(){return i.obj.OnButtonClick("GetData")}),s.nrm(13,"i",6),s.EFF(14),s.nI1(15,"translate"),s.k0s(),s.EFF(16,"\n            "),s.j41(17,"span",5),s.bIt("click",function(){return i.obj.OnButtonClick("PostData")}),s.nrm(18,"i",7),s.EFF(19),s.nI1(20,"translate"),s.k0s(),s.EFF(21,"\n            "),s.j41(22,"span",5),s.bIt("click",function(){return i.obj.OnButtonClick("Export")}),s.nrm(23,"i",8),s.EFF(24),s.nI1(25,"translate"),s.k0s(),s.EFF(26,"\n        "),s.k0s(),s.EFF(27,"\n    "),s.k0s(),s.EFF(28,"\n\n    "),s.j41(29,"div",9),s.EFF(30,"\n\n        "),s.j41(31,"div",10),s.EFF(32,"\n            "),s.j41(33,"tabset",11),s.EFF(34,"\n                "),s.j41(35,"tab",12),s.EFF(36,"\n                    "),s.j41(37,"div",13),s.EFF(38,"\n                        "),s.j41(39,"div",14),s.EFF(40,"\n                            "),s.eu8(41,15),s.EFF(42,"\n                        "),s.k0s(),s.EFF(43,"\n                        "),s.j41(44,"div",14),s.EFF(45,"\n                            "),s.eu8(46,15),s.EFF(47,"\n                        "),s.k0s(),s.EFF(48,"\n                    "),s.k0s(),s.EFF(49,"\n                    "),s.j41(50,"div",16),s.EFF(51,"\n                        "),s.DNE(52,Xe,5,2,"div",17),s.EFF(53,"\n                        "),s.j41(54,"div",18),s.EFF(55,"\n                            "),s.DNE(56,U,5,2,"ng-container",19),s.EFF(57,"\n\n                        "),s.k0s(),s.EFF(58,"\n                    "),s.k0s(),s.EFF(59,"\n                "),s.k0s(),s.EFF(60,"\n            "),s.k0s(),s.EFF(61,"\n        "),s.k0s(),s.EFF(62,"\n    "),s.k0s(),s.EFF(63,"\n"),s.k0s()),2&a&&(s.R7$(7),s.SpI("\n                ",i.obj.Title,"\n            "),s.R7$(7),s.JRh(s.bMT(15,11,"Get Data")),s.R7$(5),s.JRh(s.bMT(20,13,"Post")),s.R7$(5),s.JRh(s.bMT(25,15,"Export")),s.R7$(11),s.Y8G("removable",!1),s.R7$(6),s.Y8G("obj",i.obj.FromDate)("group",i.form),s.R7$(5),s.Y8G("obj",i.obj.ToDate)("group",i.form),s.R7$(6),s.Y8G("ngIf",i.obj.dgv),s.R7$(4),s.Y8G("ngIf",i.obj.ListVisbility))},dependencies:[xe.bT,$e._,st.X,tt.V6,tt.fw,qe.D9],encapsulation:2})}}return L})();class Te{static LoadPayrollScreen(t,l){if(50054!=t.FeatureID)if(256==t.FeatureID){let a=new Ae.SetPayrollDateViewModel;r.d.page.ShowDialog(a,_e.SetPayrollDateComponent,{ShowCenter:!0,Title:r.d.GetResource("Pay_SetPayrollDate")})}else if(258==t.FeatureID){let a=r.d.page.tabs.find(i=>i.params?.obj instanceof _t);if(a)r.d.page.SetActiveTab(a);else{let i=new _t(l);i.DisplayName=l,r.d.page.addNewTab({title:t.ScreenName,component:sa,params:{obj:i}})}}else if(260==t.FeatureID){let a=r.d.page.tabs.find(i=>i.params?.obj instanceof Pt);if(a)r.d.page.SetActiveTab(a);else{let i=new Pt(l);i.DisplayName=l,r.d.page.addNewTab({title:t.ScreenName,component:lt,params:{obj:i}})}}else if(261==t.FeatureID){let a=r.d.page.tabs.find(i=>i.params?.obj instanceof Wt.N);if(a)r.d.page.SetActiveTab(a);else{let i=new Wt.N(l);i.DisplayName=l,r.d.page.addNewTab({title:t.ScreenName,component:da,params:{obj:i}})}}else if(262==t.FeatureID){let a=r.d.page.tabs.find(i=>i.params?.obj instanceof b);if(a)r.d.page.SetActiveTab(a);else{let i=new b;i.Title=i.DisplayName=l,r.d.page.addNewTab({title:t.ScreenName,component:ge,params:{obj:i}})}}else if(263!=t.FeatureID)if(264==t.FeatureID){let a=r.d.page.tabs.find(i=>i.params?.obj instanceof Me);if(a)r.d.page.SetActiveTab(a);else{let i=new Me;i.IncomeTaxComputationViewModel(),i.Title=i.DisplayName=l,r.d.page.addNewTab({title:t.ScreenName,component:be,params:{obj:i}})}}else if(40095==t.FeatureID){let a=r.d.page.tabs.find(i=>i.params?.obj instanceof Nt.FinalSettlementViewModel);if(a)r.d.page.SetActiveTab(a);else{let i=new Nt.FinalSettlementViewModel(l);i.DisplayName=l,r.d.page.addNewTab({title:t.ScreenName,component:ha.FinalSettlementComponent,params:{obj:i}})}}else if(141==t.FeatureID){let a=r.d.page.tabs.find(i=>i.params?.obj instanceof pt);if(a)r.d.page.SetActiveTab(a);else{let i=new pt(l);i.DisplayName=l,r.d.page.addNewTab({title:t.ScreenName,component:re,params:{obj:i}})}}else if(266==t.FeatureID){let a=r.d.page.tabs.find(i=>i.params?.obj instanceof Bt);if(a)r.d.page.SetActiveTab(a);else{let i=new Bt(l);i.DisplayName=l,r.d.page.addNewTab({title:t.ScreenName,component:oa,params:{obj:i}})}}else if(267!=t.FeatureID)if(40054==t.FeatureID){let a=r.d.page.tabs.find(i=>i.params?.obj instanceof at.MonthlyPayrollViewModel);if(a)r.d.page.SetActiveTab(a);else{let i=new at.MonthlyPayrollViewModel(t.ScreenName,"");i.DisplayName=l,r.d.page.addNewTab({title:t.ScreenName,component:mt.MonthlyPayrollComponent,params:{obj:i}})}}else if(40088!=t.FeatureID&&"4101"===t.FeatureActionID.toString())return{component:I.TreeViewPageComponent,params:{ScreenName:t.ScreenName,FeatureActionID:t.FeatureActionID,CostCenterID:t.FeatureID,Call:"C3"},basedon:"CostCenterID"};return{}}static LoadMonthlyPayrolByVoucherNo(t,l){return new at.MonthlyPayrollViewModel(t,"",l)}static GetAppraisal(t){let A,l=0,a=0,i=0,o=0,d=!1,C="",g="",y="",p=new Date,e=new Date,u=new Date,T=t.ToTable(!0,["EmpSeqNo"]);if(null!=T&&T.length>0)for(let k=0;k<T.length;k++)if(null!=T[k].EmpSeqNo&&null!=T[k].EmpSeqNo&&""!=T[k].EmpSeqNo.toString()&&(l=parseInt(T[k].EmpSeqNo),A=t.filter(x=>x.EmpSeqNo==l),null!=A&&A.length>0)){p=new Date(A[0].EffectFrom),e=new Date(A[0].ApplyFrom),u=new Date(A[0].NextAppraisalDate),null!=A[0].Remarks&&null!=A[0].Remarks&&(C=A[0].Remarks.toString()),null!=A[0].Reason&&null!=A[0].Reason&&(g=A[0].Reason.toString());let x=r.d.common.GetDataSet3("BULK004",l.toString(),p.getMonth().toString(),p.getFullYear().toString());i=null!=x&&x.Tables.length>0&&x.Tables[0].length>0?parseInt(x.Tables[0][0].SeqNo):0;let F=new ht.X(null,l,new Date,i);F.isFromBulkAppraisals=!0,F.EffectFrom.Date=p,F.ActAppraisalFrom.Date=e,F.NextAppraisal.Date=u,F.Remarks.Text=C,F.Reason.Text=g;for(let _=0;_<A.length;_++){if(a=parseInt(A[_].ComponentID),o=parseFloat(A[_].Amt),d=!1,null!=x&&x.Tables.length>1&&x.Tables[1].length>0){let f=x.Tables[1].filter(E=>"BasicMonthlyFld"==E.prefname);null!=f&&f.length>0&&""!=f[0].prefvalue.toString()&&a==parseInt(f[0].prefvalue.toString())&&(F.BasicMonthly.Text=o.toString(),d=!0),f=x.Tables[1].filter(E=>"AnnualCTCFld"==E.prefname),null!=f&&f.length>0&&""!=f[0].prefvalue.toString()&&a==parseInt(f[0].prefvalue.toString())&&(F.AnnualCTC.Text=o.toString(),d=!0)}for(let f=0;f<F.dgvEarnings.Table.length;f++)if(F.dgvEarnings.Table[f].EarComponentID.toString()==a.toString()){F.dgvEarnings.Table[f].EarValue=o,d=!0;break}if(!d)for(let f=0;f<F.dgvDeductions.Table.length;f++)if(F.dgvDeductions.Table[f].DedComponentID.toString()==a.toString()){F.dgvDeductions.Table[f].DedValue=o;break}}F.ExecuteFormulas(),F.OnButtonClick("Save"),null!=F.DisplayMessage&&F.DisplayMessage.length>0||F.strUpdate.length>0&&(y+=F.strUpdate)}return y}static LoadFinalSettlementByVoucherNo(t,l){return new Nt.FinalSettlementViewModel(t,l)}static ShowQuickAdd_Payroll(t,l){return(0,de.A)(function*(){if(50051==t){const{AddEditEmpMasterComponent:a}=yield G.e(8334).then(G.bind(G,65953)),{AddEditEmpMasterViewModel:i}=yield Promise.resolve().then(G.bind(G,68439));let d={obj:new i(l,0,0,"",!1)};r.d.page.addNewTab({title:"",component:a,params:d})}})()}}},73986:(qt,ot,G)=>{G.d(ot,{N:()=>qe});var de=G(32040),I=G(43767),Ae=G(98580),r=G(82503),_e=G(27730),at=G(4716),mt=G(85152),v=G(76260),s=G(57528),xe=G(423),$e=G(58170),st=G(48549);class qe extends Ae.g{constructor(Re){super(),this.ProgressVisibility=!1,this.ProgressValue=0,this.ProgressMax=0,this.dtpPayrollMonth=new r.Lc(0),this.cmbPayslipLayout=new _e.y$(0),this.cmbSortOn=new _e.y$(0),this.PrintCallBack=new $e.Yk,this.dtPrintLayouts=null,this.sFilter="",this.drSelectedPrintLayout=null,this.sDocIDs="",this.IsPDFExport=!1,this.iCostCenterID=40054,this.ExportSeperate=!1;try{if(this.DisplayName=de.d.GetResource(Re),this.Title=de.d.GetResource(Re),this.DisplayMessage="",this.dtpPayrollMonth.CustomFormat="MMM/yyyy",this.dtpPayrollMonth.Date=de.d.SessionManager.PayrollMonth,this.dtPrintLayouts=de.d.common.GetDataTable("PAY064",this.iCostCenterID.toString()+"~"+de.d.SessionManager.RoleID+"~"+de.d.SessionManager.UserID+"~"+de.d.SessionManager.LocationID),null!=this.dtPrintLayouts&&this.dtPrintLayouts.length>0){let ee="-1";for(let De=0;De<this.dtPrintLayouts.length;De++)this.cmbPayslipLayout.Items.push(_e._p.ComboBoxItems_2(this.dtPrintLayouts[De].Name.toString(),this.dtPrintLayouts[De].DocPrintLayoutID.toString())),"true"==this.dtPrintLayouts[De].IsDefault.toString().toLowerCase()&&(ee=this.dtPrintLayouts[De].DocPrintLayoutID.toString());this.cmbPayslipLayout.SelectedValue=ee,"-1"==ee&&!I.J0.IsEmpty(this.dtPrintLayouts[0].DocPrintLayoutID)&&(ee=this.dtPrintLayouts[0].DocPrintLayoutID.toString(),this.cmbPayslipLayout.SelectedValue=ee)}if(this.cmbSortOn.Items.Clear(),this.cmbSortOn.Items.push(_e._p.ComboBoxItems_2("EmpCode","1")),this.cmbSortOn.Items.push(_e._p.ComboBoxItems_2("EmpName","2")),this.cmbSortOn.Items.push(_e._p.ComboBoxItems_2("TreeView","3")),this.cmbSortOn.SelectedValue="1",this.dtpPayrollMonth.Label=de.d.GetResource("Payroll_Month"),this.cmbPayslipLayout.Label=de.d.GetResource("PayslipLayout"),this.cmbSortOn.Label=de.d.GetResource("SortOn"),de.d.SessionManager.IsEmpUser&&!de.d.SessionManager.IsRptManagerUser){let ee="";I.J0.IsEmpty(de.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(ee="  AND EmpSeqNo IN ("+de.d.SessionManager.sWHEmpFilteredEmpSeqNos+")");let De=[];De.push(de.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),De.push(ee),De.push(1),De.push(de.d.SessionManager.RoleID),De.push(de.d.SessionManager.UserID),De.push(de.d.SessionManager.LanguageID),this.dsEmps=de.d.empService.GetData(De,"spPAY_GetEmpMasterCCDetails")}else this.btnFilter_Click();this.PrintCallBack.Subscribe(this,"PrintVoucher")}catch(ee){Logger.ErrorLog("PayslipViewModel::EXCEPTION PayslipViewModel()",ee)}}Button_Click(Re){this.IsPDFExport=!1,"Preview"==Re.toString()?this.btnPreview_Click(0):"Print"==Re.toString()?this.btnPreview_Click(1):"Export"==Re.toString()?(this.IsPDFExport=!0,this.btnPreview_Click(3)):"EMail"==Re.toString()?this.btnPreview_Click(2):"Filter"==Re.toString()&&this.btnFilter_Click(),Logger.InfoLog("PayslipViewModel::Exiting Button_Click()")}btnPreview_Click(Re){if(null!=this.dsEmps&&0!=this.dsEmps.Tables.length)try{let ee=this.dsEmps.Tables[0],De=0,Be=0;if(null!=ee&&ee.length>0){let Se="",lt="";for(let h=0;h<ee.length;h++)Se+=ee[h].EmpSeqNo.toString()+",",Be++;if(Se.length>0&&Be>0){Se=Se.substr(0,Se.length-1),lt="TreeView"==this.cmbSortOn.GetselectedItem().Name?" ORDER BY e.lft":" ORDER BY e."+this.cmbSortOn.GetselectedItem().Name.Replace("Emp","");let h=de.d.common.GetDataSet3("PAY065",this.iCostCenterID.toString(),this.dtpPayrollMonth.Date.ToString("01/MMM/yyyy"),Se+"~"+lt);if(null!=h&&h.Tables[0].length>0&&I.J0.IntTryParse(this.cmbPayslipLayout.SelectedValue)>0){De=h.Tables[0].length,this.sDocIDs="";let le=this.dtPrintLayouts.filter(q=>q.DocPrintLayoutID==this.cmbPayslipLayout.SelectedValue);for(let q=0;q<h.Tables[0].length;q++)this.sDocIDs+=h.Tables[0][q].DocID.toString()+",";if(this.sDocIDs.length>0)if(this.drSelectedPrintLayout=le[0],this.sDocIDs=this.sDocIDs.substr(0,this.sDocIDs.length-1),0==Re)this.PrintCallBack.Call(!0);else if(1==Re)this.PrintCallBack.Call(!1);else if(3==Re)if(this.ExportSeperate)for(let q=0;q<h.Tables[0].length;q++)this.sDocIDs=h.Tables[0][q].DocID.toString(),this.PrintCallBack.Call(!1);else this.PrintCallBack.Call(!1);else 2==Re&&this.SendPaySlipsToEMail()}else 0==h.Tables[0].length?this.DisplayMessage="Payroll Not Processed For Selected Employees On This Payroll Month":-1==I.J0.IntTryParse(this.cmbPayslipLayout.SelectedValue)&&(this.DisplayMessage="Please select Payslip Layout")}}else this.DisplayMessage="No Employees found to generate preview.";Logger.InfoLog("PayslipViewModel::Exiting btnPreview_Click()")}catch(ee){Logger.ErrorLog("PayslipViewModel::EXCEPTION btnPreview_Click()"+ee.stack)}else this.DisplayMessage="First filter the Employees, then Preview"}SendPaySlipsToEMail(){try{Logger.InfoLog("PayslipViewModel::Entering SendPaySlipsToEMail()"),null!=this.sDocIDs&&this.sDocIDs.length>0?de.d.page.ShowDialog(new s.SendEmailSMSViewModel(!0,this.iCostCenterID,0,this),xe.SendEmailSMSComponent):this.DisplayMessage="No Employees found to Send Email.",Logger.InfoLog("PayslipViewModel::Exiting SendPaySlipsToEMail()")}catch(Re){Logger.ErrorLog("PayslipViewModel::EXCEPTION SendPaySlipsToEMail()"+Re.stack)}}btnFilter_Click(){try{this.sFilter="",de.d.SessionManager.Preferences.ContainsKey("PayslipFilter")&&parseInt(de.d.SessionManager.Preferences.PayslipFilter)>0&&"Widget"!=this.DisplayName?null==this.objEmpFilter?this.objEmpFilter=new at.t("",0,4):(this.objEmpFilter.CostCenterFilters.length>0?this.objEmpFilter.CostCenters.SelectedValue=this.objEmpFilter.CostCenterFilters[0].CostCenterID.toString():(this.objEmpFilter.Filter=4,this.objEmpFilter.InitControls()),this.objEmpFilter.CostCenters.Enable=!0):null==this.objEmpFilter?this.objEmpFilter=new at.t("",0,0):(this.objEmpFilter.Filter=0,this.objEmpFilter.InitControls()),this.objEmpFilter.Filter>0?de.d.page.ShowDialog(this.objEmpFilter,st.m,{ShowCenter:!0,HideHeader:!0}).subscribe(()=>{this.btnFilter_Click_CallBack()}):this.btnFilter_Click_CallBack()}catch(Re){Logger.ErrorLog("PayslipViewModel::EXCEPTION btnFilter_Click()",Re)}}btnFilter_Click_CallBack(){if(this.objEmpFilter.IsCompleted){if(this.objEmpFilter.CostCenterFilters.length>0){let ee=1,De="",Be="",Se="";for(let lt=0;lt<this.objEmpFilter.CostCenterFilters.length;lt++){let h=this.objEmpFilter.CostCenterFilters[lt];if(h.CostCenterID>5e4&&(ee=2,De="NodeID",Be=50051==h.CostCenterID?"EmpSeqNo":"CCNID"+(h.CostCenterID-5e4)),h.SelectedNodes.length>0){if(1==h.SelectedNodes.length)Se+=" AND ",Se+=Be+"="+h.SelectedNodes[0].Id;else if(!h.SelectedNodes.find(le=>le.Id==ee&&le.IsGroup))if(Se+=" AND ",mt.IPrefetchFilter.IsGroupTree(h)){let le="";for(let q=0;q<h.SelectedNodes.length;q++)(null==h.SelectedNodes[q].Parent||!h.SelectedNodes[q].Parent.IsSelected)&&(le.length>0&&(le+=","),le+=h.SelectedNodes[q].Id);0==le.length&&(le+=-12912),Se+=Be+" IN ",Se+=" (select T."+De+" GTID from "+v.A.GetTagTableName(h.CostCenterID)+" T with(nolock),",v.A.GetTagTableName(h.CostCenterID),Se+=le.toString()+")  group by T."+De+")"}else{Se+=Be+" IN (";for(let le=0;le<h.SelectedNodes.length;le++)le>0&&(Se+=","),Se+=h.SelectedNodes[le].Id;Se+=")"}}else h.DeleteButtonVisibility||(Se+=" AND ",Se+=Be+"=-12912")}this.sFilter=Se.toString()}if(this.objEmpFilter.Filter>0){de.d.SessionManager.LocationID>0&&de.d.SessionManager.Preferences.ContainsKey("LocationWiseDimension")&&de.d.SessionManager.Preferences.LocationWiseDimension.split(",").Contains("50051")&&(this.sFilter+=" AND EmpSeqNo IN ( Select NodeID From Com_CCCCData with(nolock) where CostCenterID=50051 and CCNID2="+de.d.SessionManager.LocationID+")"),I.J0.IsEmpty(de.d.SessionManager.sWHEmpFilteredEmpSeqNos)||(this.sFilter+="  AND EmpSeqNo IN ("+de.d.SessionManager.sWHEmpFilteredEmpSeqNos+")"),4==this.objEmpFilter.Filter&&"All"!=this.objEmpFilter.PaymentModes.SelectedValue&&(this.sFilter+=" AND EMP.PaymentMode ='"+this.objEmpFilter.PaymentModes.SelectedValue+"' ");let ee=[];ee.push(de.d.SessionManager.PayrollMonthEnd.ToString("dd MMM yyyy")),ee.push(this.sFilter),ee.push(1),ee.push(de.d.SessionManager.RoleID),ee.push(de.d.SessionManager.UserID),ee.push(de.d.SessionManager.LanguageID),this.dsEmps=de.d.empService.GetData(ee,"spPAY_GetEmpMasterCCDetails")}}}PrintVoucher(Re){let De=this;if(De.DisplayMessage="",!I.J0.IsEmpty(De.sDocIDs)){let Be=null;Be=De.drSelectedPrintLayout,null!=Be&&de.d.report.VoucherExport_PDF(40054,De.IsPDFExport,De.sDocIDs,"",De.IsPDFExport,I.J0.IntTryParse(this.cmbPayslipLayout.SelectedValue)).subscribe(Se=>{console.log(Se),De.IsPDFExport?Re?de.d.SessionManager.printTab(Se.FileName):de.d.SessionManager.Download(Se.FileName,"payslip"):setTimeout(()=>{de.d.SessionManager.printTab(Se.FileName)},500),I.J0.IsEmpty(Se.Message)&&!I.J0.IsEmpty(Se.FileName)&&(this.DisplayMessage="Exported Successfully")},Se=>{console.log(Se)})}return""}}}}]);